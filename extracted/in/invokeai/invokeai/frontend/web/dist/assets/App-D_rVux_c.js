var GX=Object.defineProperty;var y4=e=>{throw TypeError(e)};var HX=(e,t,n)=>t in e?GX(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var j=(e,t,n)=>HX(e,typeof t!="symbol"?t+"":t,n),zb=(e,t,n)=>t.has(e)||y4("Cannot "+n);var X=(e,t,n)=>(zb(e,t,"read from private field"),n?n.call(e):t.get(e)),At=(e,t,n)=>t.has(e)?y4("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Qe=(e,t,n,s)=>(zb(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),ze=(e,t,n)=>(zb(e,t,"access private method"),n);var Cg=(e,t,n,s)=>({set _(o){Qe(e,t,o,n)},get _(){return X(e,t,s)}});import{g as hu,w as s8,a as i8,b as WX,r as c,i as nf,c as Gb,d as yd,I as UX,u as Dl,t as qX,e as KX,S as ZX,f as YX,h as XX,j as QX,k as b4,l as o8,m as r8,n as JX,o as eQ,p as tQ,q as nQ,v as sQ,s as iQ,x as sf,y as oQ,z as rQ,A as Di,B as aQ,C as uo,D as Wn,E as Pt,F as re,$ as lQ,G as A,H as a8,J as l8,K as c8,L as cQ,M as Le,N as jn,O as Jn,P as pS,Q as M,R as ge,T as He,U as G,V as d8,W as fS,X as mS,Y as Ax,Z as u8,_ as cs,a0 as he,a1 as h8,a2 as dQ,a3 as Xe,a4 as ve,a5 as Rn,a6 as uQ,a7 as pu,a8 as Vf,a9 as hQ,aa as ln,ab as p8,ac as f8,ad as m8,ae as g8,af as na,ag as of,ah as qs,ai as Mx,aj as x8,ak as y8,al as gS,am as b8,an as v8,ao as xS,ap as C8,aq as w8,ar as yS,as as S8,at as k8,au as cn,av as bS,aw as pQ,ax as vS,ay as fu,az as $l,aA as zf,aB as Me,aC as j8,aD as _8,aE as I8,aF as T8,aG as U0,aH as A8,aI as q0,aJ as M8,aK as Ri,aL as xc,aM as E8,aN as Ye,aO as mu,aP as P8,aQ as L8,aR as Gf,aS as Ex,aT as Fs,aU as st,aV as K0,aW as D8,aX as R8,aY as O8,aZ as N8,a_ as F8,a$ as CS,b0 as Zn,b1 as $n,b2 as _o,b3 as fQ,b4 as mQ,b5 as Yt,b6 as gQ,b7 as B8,b8 as v4,b9 as Hb,ba as Wb,bb as Ub,bc as C4,bd as i,be as T,bf as ci,bg as W,bh as gt,bi as $8,bj as xe,bk as Ce,bl as gu,bm as aa,bn as V8,bo as Oe,bp as de,bq as wS,br as xQ,bs as ai,bt as Ft,bu as Hn,bv as le,bw as SS,bx as at,by as Cr,bz as St,bA as Mo,bB as yQ,bC as z8,bD as Q,bE as J,bF as Js,bG as ii,bH as xu,bI as bQ,bJ as vQ,bK as Ct,bL as zt,bM as CQ,bN as G8,bO as H8,bP as _n,bQ as wQ,bR as W8,bS as SQ,bT as kQ,bU as jQ,bV as _Q,bW as IQ,bX as yc,bY as bc,bZ as Tn,b_ as yu,b$ as Vn,c0 as TQ,c1 as AQ,c2 as MQ,c3 as EQ,c4 as PQ,c5 as LQ,c6 as DQ,c7 as RQ,c8 as OQ,c9 as NQ,ca as Hf,cb as FQ,cc as BQ,cd as $Q,ce as kS,cf as VQ,cg as Px,ch as U8,ci as jS,cj as zQ,ck as GQ,cl as HQ,cm as WQ,cn as UQ,co as qQ,cp as KQ,cq as Z0,cr as Lx,cs as Dx,ct as _S,cu as vc,cv as Cc,cw as q8,cx as wc,cy as Sc,cz as Ra,cA as Wf,cB as zr,cC as rd,cD as ti,cE as b0,cF as ZQ,cG as YQ,cH as Xd,cI as XQ,cJ as QQ,cK as JQ,cL as w4,cM as IS,cN as rf,cO as K8,cP as U2,cQ as Z8,cR as eJ,cS as qo,cT as Te,cU as Ho,cV as tJ,cW as nJ,cX as sJ,cY as Y8,cZ as Uf,c_ as S4,c$ as iJ,d0 as oJ,d1 as rJ,d2 as aJ,d3 as Ta,d4 as bu,d5 as k4,d6 as X8,d7 as j4,d8 as lJ,d9 as cJ,da as Rx,db as dJ,dc as uJ,dd as hJ,de as pJ,df as fJ,dg as mJ,dh as qf,di as li,dj as Kf,dk as Y0,dl as _4,dm as xt,dn as gJ,dp as ol,dq as xJ,dr as Q8,ds as Zf,dt as Yf,du as fn,dv as yJ,dw as bJ,dx as I4,dy as TS,dz as ho,dA as Ke,dB as J8,dC as la,dD as eP,dE as ro,dF as vJ,dG as Ox,dH as Ka,dI as vu,dJ as kc,dK as Xf,dL as Nx,dM as CJ,dN as wJ,dO as SJ,dP as q2,dQ as K2,dR as rl,dS as kJ,dT as T4,dU as ga,dV as Mn,dW as Yi,dX as pr,dY as ir,dZ as jJ,d_ as tP,d$ as AS,e0 as nP,e1 as xs,e2 as ao,e3 as Fx,e4 as ic,e5 as MS,e6 as ES,e7 as X0,e8 as Z2,e9 as Qf,ea as PS,eb as Bx,ec as _J,ed as IJ,ee as er,ef as bd,eg as Hc,eh as wp,ei as sP,ej as Lt,ek as iP,el as Oi,em as di,en as Ni,eo as ui,ep as Do,eq as Ks,er as wr,es as jc,et as Jf,eu as LS,ev as $t,ew as TJ,ex as ji,ey as AJ,ez as As,eA as oP,eB as A4,eC as MJ,eD as EJ,eE as et,eF as rP,eG as PJ,eH as aP,eI as LJ,eJ as DJ,eK as DS,eL as lP,eM as em,eN as Ve,eO as cP,eP as es,eQ as ds,eR as al,eS as dP,eT as ts,eU as uP,eV as us,eW as Zt,eX as Je,eY as RJ,eZ as OJ,e_ as NJ,e$ as Ze,f0 as _e,f1 as FJ,f2 as hP,f3 as $x,f4 as BJ,f5 as $J,f6 as VJ,f7 as zJ,f8 as GJ,f9 as HJ,fa as WJ,fb as UJ,fc as qJ,fd as pP,fe as RS,ff as OS,fg as NS,fh as FS,fi as BS,fj as fP,fk as fe,fl as bs,fm as KJ,fn as ZJ,fo as mP,fp as on,fq as rn,fr as Et,fs as Sr,ft as Wc,fu as YJ,fv as Ai,fw as XJ,fx as tm,fy as $S,fz as VS,fA as gP,fB as _c,fC as Vx,fD as xP,fE as Za,fF as zS,fG as Ic,fH as zx,fI as ll,fJ as Gx,fK as Sp,fL as GS,fM as QJ,fN as Qn,fO as JJ,fP as yP,fQ as bP,fR as eee,fS as vP,fT as M4,fU as CP,fV as wP,fW as tee,fX as E4,fY as P4,fZ as lo,f_ as nee,f$ as see,g0 as SP,g1 as HS,g2 as iee,g3 as oee,g4 as Mi,g5 as vt,g6 as L4,g7 as ree,g8 as aee,g9 as Jl,ga as ls,gb as lee,gc as cee,gd as kP,ge as dee,gf as uee,gg as hee,gh as pee,gi as fee,gj as jP,gk as mee,gl as gee,gm as _P,gn as xee,go as Xo,gp as yee,gq as IP,gr as TP,gs as nm,gt as bee,gu as Cs,gv as vee,gw as Hx,gx as v0,gy as af,gz as Tc,gA as Cee,gB as AP,gC as MP,gD as EP,gE as ss,gF as ki,gG as wee,gH as See,gI as kee,gJ as jee,gK as WS,gL as PP,gM as _ee,gN as Y2,gO as Iee,gP as ni,gQ as X2,gR as C0,gS as LP,gT as DP,gU as RP,gV as Tee,gW as OP,gX as NP,gY as FP,gZ as BP,g_ as Aee,g$ as $P,h0 as Wx,h1 as Q2,h2 as sm,h3 as Mee,h4 as Q0,h5 as VP,h6 as Ux,h7 as vd,h8 as zP,h9 as Eee,ha as J2,hb as lf,hc as eC,hd as Pee,he as GP,hf as HP,hg as WP,hh as US,hi as Lee,hj as Dee,hk as Ree,hl as tC,hm as Oee,hn as UP,ho as qP,hp as KP,hq as nC,hr as Nee,hs as Fee,ht as Bee,hu as D4,hv as qb,hw as R4,hx as O4,hy as N4,hz as F4,hA as sC,hB as $ee,hC as iC,hD as ZP,hE as oc,hF as YP,hG as Cu,hH as wg,hI as Vee,hJ as Gr,hK as XP,hL as QP,hM as JP,hN as eL,hO as tL,hP as zee,hQ as Gee,hR as cl,hS as oC,hT as Hee,hU as B4,hV as $4,hW as J0,hX as Wee,hY as Uee,hZ as nL,h_ as qee,h$ as Kee,i0 as Zee,i1 as Yee,i2 as Xee,i3 as sL,i4 as iL,i5 as rC,i6 as im,i7 as Qee,i8 as Jee,i9 as ete,ia as tte,ib as nte,ic as qS,id as ste,ie as ite,ig as ote,ih as rte,ii as aC,ij as ate,ik as lte,il as cte,im as V4,io as dte,ip as qx,iq as om,ir as KS,is as oL,it as ute,iu as hte,iv as pte,iw as fte,ix as mte,iy as gte,iz as xte,iA as yte,iB as bte,iC as vte,iD as Cte,iE as wte,iF as Ste,iG as kte,iH as jte,iI as _te,iJ as Ite,iK as Tte,iL as po,iM as dl,iN as rm,iO as Kx,iP as Zx,iQ as Ate,iR as Mte,iS as rL,iT as aL,iU as lL,iV as cL,iW as dL,iX as Ete,iY as Dd,iZ as lC,i_ as uL,i$ as hL,j0 as ZS,j1 as Kb,j2 as Pte,j3 as Lte,j4 as Dte,j5 as kp,j6 as pL,j7 as fL,j8 as wu,j9 as Rte,ja as Ote,jb as Uc,jc as Al,jd as am,je as Nte,jf as Su,jg as Fte,jh as Bte,ji as $te,jj as Vte,jk as zte,jl as mL,jm as Gte,jn as ul,jo as Hte,jp as gL,jq as Wte,jr as xL,js as yL,jt as Ute,ju as bL,jv as vL,jw as CL,jx as hi,jy as qte,jz as Kte,jA as Yx,jB as Xx,jC as YS,jD as XS,jE as QS,jF as Qx,jG as Zte,jH as Yte,jI as Xte,jJ as Qte,jK as z4,jL as Jte,jM as JS,jN as ene,jO as tne,jP as nne,jQ as Ya,jR as sne,jS as ine,jT as one,jU as rne,jV as ane,jW as lne,jX as wL,jY as SL,jZ as kL,j_ as jL,j$ as cne,k0 as dne,k1 as une,k2 as hne,k3 as pne,k4 as fne,k5 as mne,k6 as gne,k7 as xne,k8 as yne,k9 as bne,ka as _L,kb as IL,kc as vne,kd as Cne,ke as wne,kf as Sne,kg as kne,kh as jne,ki as _ne,kj as lm,kk as Ine,kl as Tne,km as Ane,kn as Mne,ko as Ene,kp as G4,kq as Pne,kr as Lne,ks as Dne,kt as Rne,ku as One,kv as Nne,kw as ek,kx as Fne,ky as Bne,kz as $ne,kA as e1,kB as ku,kC as TL,kD as cm,kE as AL,kF as Vne,kG as tk,kH as Jx,kI as zne,kJ as Gne,kK as Hne,kL as Wne,kM as Une,kN as qne,kO as Kne,kP as Zne,kQ as H4,kR as Yne,kS as Xne,kT as ML,kU as Qne,kV as Jne,kW as ese,kX as tse,kY as nse,kZ as ey,k_ as nk,k$ as ty,l0 as sse,l1 as ise,l2 as ose,l3 as rse,l4 as sk,l5 as ase,l6 as EL,l7 as ik,l8 as lse,l9 as ok,la as Ji,lb as cC,lc as W4,ld as dC,le as rk,lf as cse,lg as dse,lh as use,li as PL,lj as ak,lk as hse,ll as ju,lm as ny,ln as Qd,lo as lk,lp as _u,lq as LL,lr as as,ls as ck,lt as pse,lu as uC,lv as fse,lw as mse,lx as DL,ly as gse,lz as Op,lA as dk,lB as xse,lC as RL,lD as yse,lE as kr,lF as OL,lG as NL,lH as bse,lI as vse,lJ as FL,lK as BL,lL as tt,lM as Gt,lN as Cse,lO as uk,lP as wse,lQ as co,lR as U4,lS as Sse,lT as Zb,lU as q4,lV as K4,lW as Z4,lX as Y4,lY as kse,lZ as X4,l_ as jse,l$ as _se,m0 as Ise,m1 as Q4,m2 as Tse,m3 as Yb,m4 as J4,m5 as e5,m6 as t5,m7 as Ase,m8 as Xb,m9 as n5,ma as Mse,mb as s5,mc as i5,md as o5,me as Ese,mf as Pse,mg as Lse,mh as Ac,mi as Dse,mj as Rse,mk as $L,ml as Ose,mm as VL,mn as dm,mo as Nse,mp as Fse,mq as Bse,mr as $se,ms as Vse,mt as zse,mu as Gse,mv as Hse,mw as Wse,mx as Use,my as um,mz as qse,mA as fr,mB as Kse,mC as Zse,mD as Yse,mE as Xse,mF as Qse,mG as Jse,mH as eie,mI as tie,mJ as nie,mK as sie,mL as iie,mM as oie,mN as rie,mO as aie,mP as lie,mQ as cie,mR as die,mS as uie,mT as hie,mU as pie,mV as fie,mW as mie,mX as gie,mY as xie,mZ as yie,m_ as bie,m$ as vie,n0 as Cie,n1 as wie,n2 as Sie,n3 as kie,n4 as jie,n5 as _ie,n6 as Iie,n7 as Tie,n8 as Aie,n9 as Mie,na as Eie,nb as Pie,nc as Lie,nd as Die,ne as Rie,nf as Oie,ng as Nie,nh as Fie,ni as Bie,nj as $ie,nk as Vie,nl as zie,nm as Gie,nn as Hie,no as Wie,np as Uie,nq as qie,nr as Kie,ns as Zie,nt as Yie,nu as Xie,nv as Qie,nw as Jie,nx as eoe,ny as toe,nz as noe,nA as soe,nB as ioe,nC as ooe,nD as roe,nE as aoe,nF as loe,nG as coe,nH as zL,nI as Vl,nJ as hk,nK as GL,nL as HL,nM as doe,nN as WL,nO as UL,nP as qL,nQ as KL,nR as ZL,nS as uoe,nT as hoe,nU as poe,nV as YL,nW as foe,nX as moe,nY as goe,nZ as xoe,n_ as yoe,n$ as boe,o0 as sy,o1 as XL,o2 as voe,o3 as Coe,o4 as woe,o5 as Soe,o6 as koe,o7 as joe,o8 as _oe,o9 as Ioe,oa as Toe,ob as Aoe,oc as Moe,od as Es,oe as Eoe,of as Poe,og as Loe,oh as pk,oi as Doe,oj as Roe,ok as hC,ol as fk,om as Ooe,on as Noe,oo as mk,op as Foe,oq as Boe,or as iy,os as $oe,ot as w0,ou as gk,ov as hm,ow as QL,ox as Voe,oy as zoe,oz as JL,oA as Goe,oB as Hoe,oC as Woe,oD as Uoe,oE as qoe,oF as eD,oG as tD,oH as Koe,oI as Zoe,oJ as Yoe,oK as Xoe,oL as Qoe,oM as Joe,oN as ere,oO as tre,oP as nre,oQ as sre,oR as Sg,oS as ire,oT as ore,oU as rre,oV as are,oW as lre,oX as cre,oY as xk,oZ as nD,o_ as sD,o$ as dre,p0 as ure,p1 as hre,p2 as pre,p3 as iD,p4 as fre,p5 as oD,p6 as rD,p7 as mre,p8 as gre,p9 as xre,pa as Iu,pb as yre,pc as bre,pd as vre,pe as Cre,pf as wre,pg as Sre,ph as kre,pi as jre,pj as _re,pk as Ire,pl as Tre,pm,pn as aD,po as Are,pp as Mre,pq as Ere,pr as Pre,ps as Lre,pt as Dre,pu as Rre,pv as Ore,pw as Nre,px as Fre,py as Bre,pz as $re,pA as Vre,pB as zre,pC as Gre,pD as yk,pE as Hre,pF as lD,pG as oy,pH as Wre,pI as cD,pJ as dD,pK as Ure,pL as uD,pM as qre,pN as hD,pO as bk,pP as Kre,pQ as Zre,pR as Yre,pS as Xre,pT as Qre,pU as Jre,pV as vk,pW as Ck,pX as eae,pY as tae,pZ as wk,p_ as Sk,p$ as Ml,q0 as nae,q1 as sae,q2 as iae,q3 as kk,q4 as oae,q5 as rae,q6 as aae,q7 as fm,q8 as lae,q9 as cae,qa as dae,qb as uae,qc as hae,qd as pae,qe as fae,qf as mae,qg as gae,qh as xae,qi as pD,qj as yae,qk as bae,ql as vae,qm as Cae,qn as wae,qo as Sae,qp as kae,qq as fD,qr as jae,qs as _ae,qt as Iae,qu as Tae,qv as r5,qw as Aae,qx as Mae,qy as Eae,qz as Pae,qA as Lae,qB as Dae,qC as Rae,qD as Oae,qE as Nae,qF as Fae,qG as Bae,qH as $ae,qI as Vae,qJ as cf,qK as jk,qL as a5,qM as zae,qN as Gae,qO as Hae,qP as Wae,qQ as pC,qR as mD,qS as gD,qT as l5,qU as c5,qV as mm,qW as Uae,qX as qae,qY as ry,qZ as fC,q_ as ay,q$ as Kae,r0 as Zae,r1 as gm,r2 as Yae,r3 as Xae,r4 as Qae,r5 as Jae,r6 as ele,r7 as tle,r8 as nle,r9 as xD,ra as sle,rb as ile,rc as ole,rd as yD,re as rle,rf as ale,rg as lle,rh as cle,ri as dle,rj as bD,rk as mC,rl as ule,rm as hle,rn as ad,ro as kg,rp as Aa,rq as Rd,rr as Ci,rs as _k,rt as Od,ru as Qo,rv as ec,rw as vD,rx as CD,ry as ple,rz as fle,rA as mle,rB as wD,rC as SD,rD as kD,rE as ly,rF as jD,rG as _D,rH as gle,rI as xle,rJ as yle,rK as ble,rL as vle,rM as Cle,rN as wle,rO as Ik,rP as Cd,rQ as ID,rR as TD,rS as AD,rT as Sle,rU as Tk,rV as MD,rW as ED,rX as PD,rY as xm,rZ as kle,r_ as LD,r$ as Tu,s0 as Oa,s1 as Na,s2 as DD,s3 as jle,s4 as _le,s5 as Ile,s6 as Tle,s7 as Ale,s8 as Mle,s9 as d5,sa as u5,sb as Ele,sc as Ple,sd as h5,se as p5,sf as Lle,sg as Dle,sh as Rle,si as Ole,sj as Qb,sk as Nle,sl as Fle,sm as Ble,sn as $le,so as Vle,sp as zle,sq as RD,sr as Gle,ss as Hle,st as Wle,su as cy,sv as Ule,sw as qle,sx as Kle,sy as Zle,sz as Yle,sA as Xle,sB as Qle,sC as Jle,sD as ece,sE as tce,sF as nce,sG as sce,sH as ice,sI as oce,sJ as rce,sK as ace,sL as lce,sM as cce,sN as dce,sO as uce,sP as hce,sQ as pce,sR as fce,sS as mce,sT as gce,sU as xce,sV as OD,sW as yce,sX as bce,sY as vce,sZ as Cce,s_ as wce,s$ as ND,t0 as Sce,t1 as kce,t2 as jce,t3 as _ce,t4 as Ice,t5 as FD,t6 as Tce,t7 as Ace,t8 as Mce,t9 as Ece,ta as f5,tb as Pce,tc as Lce,td as m5,te as Dce}from"./index-WSq_95VX.js";var Jb,g5;function Rce(){return g5||(g5=1,Jb={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),Jb}var Oce=Rce();const Nce=hu(Oce);var Fce=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function x5(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(Nce[n[1]]||e.charAt(e.length-2)==="/")&&(t.voidElement=!0),t.name.startsWith("!--"))){var s=e.indexOf("-->");return{type:"comment",comment:s!==-1?e.slice(4,s):""}}for(var o=new RegExp(Fce),r=null;(r=o.exec(e))!==null;)if(r[0].trim())if(r[1]){var a=r[1].trim(),l=[a,""];a.indexOf("=")>-1&&(l=a.split("=")),t.attrs[l[0]]=l[1],o.lastIndex--}else r[2]&&(t.attrs[r[2]]=r[3].trim().substring(1,r[3].length-1));return t}var Bce=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,$ce=/^\s*$/,Vce=Object.create(null);function BD(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(n){var s=[];for(var o in n)s.push(o+'="'+n[o]+'"');return s.length?" "+s.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(BD,"")+"</"+t.name+">";case"comment":return e+"<!--"+t.comment+"-->"}}var zce={parse:function(e,t){t||(t={}),t.components||(t.components=Vce);var n,s=[],o=[],r=-1,a=!1;if(e.indexOf("<")!==0){var l=e.indexOf("<");s.push({type:"text",content:l===-1?e:e.substring(0,l)})}return e.replace(Bce,function(d,u){if(a){if(d!=="</"+n.name+">")return;a=!1}var h,p=d.charAt(1)!=="/",f=d.startsWith("<!--"),m=u+d.length,g=e.charAt(m);if(f){var x=x5(d);return r<0?(s.push(x),s):((h=o[r]).children.push(x),s)}if(p&&(r++,(n=x5(d)).type==="tag"&&t.components[n.name]&&(n.type="component",a=!0),n.voidElement||a||!g||g==="<"||n.children.push({type:"text",content:e.slice(m,e.indexOf("<",m))}),r===0&&s.push(n),(h=o[r-1])&&h.children.push(n),o[r]=n),(!p||n.voidElement)&&(r>-1&&(n.voidElement||n.name===d.slice(2,-1))&&(r--,n=r===-1?s:o[r]),!a&&g!=="<"&&g)){h=r===-1?s:o[r].children;var b=e.indexOf("<",m),C=e.slice(m,b===-1?void 0:b);$ce.test(C)&&(C=" "),(b>-1&&r+h.length>=0||C!==" ")&&h.push({type:"text",content:C})}}),s},stringify:function(e){return e.reduce(function(t,n){return t+BD("",n)},"")}};const ev=(e,t)=>{var s;if(!e)return!1;const n=((s=e.props)==null?void 0:s.children)??e.children;return t?n.length>0:!!n},tv=e=>{var n,s;if(!e)return[];const t=((n=e.props)==null?void 0:n.children)??e.children;return(s=e.props)!=null&&s.i18nIsDynamicList?wd(t):t},Gce=e=>Array.isArray(e)&&e.every(c.isValidElement),wd=e=>Array.isArray(e)?e:[e],Hce=(e,t)=>{const n={...t};return n.props=Object.assign(e.props,t.props),n},$D=(e,t,n,s)=>{if(!e)return"";let o="";const r=wd(e),a=t!=null&&t.transSupportBasicHtmlNodes?t.transKeepBasicHtmlNodesFor??[]:[];return r.forEach((l,d)=>{if(nf(l)){o+=`${l}`;return}if(c.isValidElement(l)){const{props:u,type:h}=l,p=Object.keys(u).length,f=a.indexOf(h)>-1,m=u.children;if(!m&&f&&!p){o+=`<${h}/>`;return}if(!m&&(!f||p)||u.i18nIsDynamicList){o+=`<${d}></${d}>`;return}if(f&&p===1&&nf(m)){o+=`<${h}>${m}</${h}>`;return}const g=$D(m,t,n,s);o+=`<${d}>${g}</${d}>`;return}if(l===null){Gb(n,"TRANS_NULL_VALUE","Passed in a null value as child",{i18nKey:s});return}if(yd(l)){const{format:u,...h}=l,p=Object.keys(h);if(p.length===1){const f=u?`${p[0]}, ${u}`:p[0];o+=`{{${f}}}`;return}Gb(n,"TRANS_INVALID_OBJ","Invalid child - Object should only have keys {{ value, format }} (format is optional).",{i18nKey:s,child:l});return}Gb(n,"TRANS_INVALID_VAR","Passed in a variable like {number} - pass variables for interpolation as full objects like {{number}}.",{i18nKey:s,child:l})}),o},Wce=(e,t,n,s,o,r)=>{if(t==="")return[];const a=s.transKeepBasicHtmlNodesFor||[],l=t&&new RegExp(a.map(b=>`<${b}`).join("|")).test(t);if(!e&&!l&&!r)return[t];const d={},u=b=>{wd(b).forEach(y=>{nf(y)||(ev(y)?u(tv(y)):yd(y)&&!c.isValidElement(y)&&Object.assign(d,y))})};u(e);const h=zce.parse(`<0>${t}</0>`),p={...d,...o},f=(b,C,y)=>{var k;const v=tv(b),w=g(v,C.children,y);return Gce(v)&&w.length===0||(k=b.props)!=null&&k.i18nIsDynamicList?v:w},m=(b,C,y,v,w)=>{b.dummy?(b.children=C,y.push(c.cloneElement(b,{key:v},w?void 0:C))):y.push(...c.Children.map([b],k=>{const S={...k.props};return delete S.i18nIsDynamicList,c.createElement(k.type,{...S,key:v,ref:k.ref},w?null:C)}))},g=(b,C,y)=>{const v=wd(b);return wd(C).reduce((k,S,P)=>{var L,I;const E=((I=(L=S.children)==null?void 0:L[0])==null?void 0:I.content)&&n.services.interpolator.interpolate(S.children[0].content,p,n.language);if(S.type==="tag"){let O=v[parseInt(S.name,10)];y.length===1&&!O&&(O=y[0][S.name]),O||(O={});const N=Object.keys(S.attrs).length!==0?Hce({props:S.attrs},O):O,_=c.isValidElement(N),R=_&&ev(S,!0)&&!S.voidElement,D=l&&yd(N)&&N.dummy&&!_,B=yd(e)&&Object.hasOwnProperty.call(e,S.name);if(nf(N)){const V=n.services.interpolator.interpolate(N,p,n.language);k.push(V)}else if(ev(N)||R){const V=f(N,S,y);m(N,V,k,P)}else if(D){const V=g(v,S.children,y);m(N,V,k,P)}else if(Number.isNaN(parseFloat(S.name)))if(B){const V=f(N,S,y);m(N,V,k,P,S.voidElement)}else if(s.transSupportBasicHtmlNodes&&a.indexOf(S.name)>-1)if(S.voidElement)k.push(c.createElement(S.name,{key:`${S.name}-${P}`}));else{const V=g(v,S.children,y);k.push(c.createElement(S.name,{key:`${S.name}-${P}`},V))}else if(S.voidElement)k.push(`<${S.name} />`);else{const V=g(v,S.children,y);k.push(`<${S.name}>${V}</${S.name}>`)}else if(yd(N)&&!_){const V=S.children[0]?E:null;V&&k.push(V)}else m(N,E,k,P,S.children.length!==1||!E)}else if(S.type==="text"){const O=s.transWrapTextNodes,N=r?s.unescape(n.services.interpolator.interpolate(S.content,p,n.language)):n.services.interpolator.interpolate(S.content,p,n.language);O?k.push(c.createElement(O,{key:`${S.name}-${P}`},N)):k.push(N)}return k},[])},x=g([{dummy:!0,children:e||[]}],h,wd(e||[]));return tv(x[0])},VD=(e,t,n)=>{const s=e.key||t,o=c.cloneElement(e,{key:s});if(!o.props||!o.props.children||n.indexOf(`${t}/>`)<0&&n.indexOf(`${t} />`)<0)return o;function r(){return c.createElement(c.Fragment,null,o)}return c.createElement(r,{key:s})},Uce=(e,t)=>e.map((n,s)=>VD(n,s,t)),qce=(e,t)=>{const n={};return Object.keys(e).forEach(s=>{Object.assign(n,{[s]:VD(e[s],s,t)})}),n},Kce=(e,t,n,s)=>e?Array.isArray(e)?Uce(e,t):yd(e)?qce(e,t):(s8(n,"TRANS_INVALID_COMPONENTS",'<Trans /> "components" prop expects an object or array',{i18nKey:s}),null):null;function Zce({children:e,count:t,parent:n,i18nKey:s,context:o,tOptions:r={},values:a,defaults:l,components:d,ns:u,i18n:h,t:p,shouldUnescape:f,...m}){var N,_,R,D,B,V;const g=h||i8();if(!g)return s8(g,"NO_I18NEXT_INSTANCE","Trans: You need to pass in an i18next instance using i18nextReactModule",{i18nKey:s}),e;const x=p||g.t.bind(g)||(ee=>ee),b={...WX(),...(N=g.options)==null?void 0:N.react};let C=u||x.ns||((_=g.options)==null?void 0:_.defaultNS);C=nf(C)?[C]:C||["translation"];const y=$D(e,b,g,s),v=l||y||b.transEmptyNodeValue||s,{hashTransKey:w}=b,k=s||(w?w(y||v):y||v);(D=(R=g.options)==null?void 0:R.interpolation)!=null&&D.defaultVariables&&(a=a&&Object.keys(a).length>0?{...a,...g.options.interpolation.defaultVariables}:{...g.options.interpolation.defaultVariables});const S=a||t!==void 0&&!((V=(B=g.options)==null?void 0:B.interpolation)!=null&&V.alwaysFormat)||!e?r.interpolation:{interpolation:{...r.interpolation,prefix:"#$?",suffix:"?$#"}},P={...r,context:o||r.context,count:t,...a,...S,defaultValue:v,ns:C},E=k?x(k,P):v,L=Kce(d,E,g,s),I=Wce(L||e,E,g,b,P,f),O=n??b.defaultTransParent;return O?c.createElement(O,m,I):I}function Wt({children:e,count:t,parent:n,i18nKey:s,context:o,tOptions:r={},values:a,defaults:l,components:d,ns:u,i18n:h,t:p,shouldUnescape:f,...m}){var y;const{i18n:g,defaultNS:x}=c.useContext(UX)||{},b=h||g||i8(),C=p||(b==null?void 0:b.t.bind(b));return Zce({children:e,count:t,parent:n,i18nKey:s,context:o,tOptions:r,values:a,defaults:l,components:d,ns:u||(C==null?void 0:C.ns)||x||((y=b==null?void 0:b.options)==null?void 0:y.defaultNS),i18n:b,t:p,shouldUnescape:f,...m})}function Ak(e){return Object.keys(e)}function gC(e){return Object.entries(e)}function Yce(e){return Dl(qX(e).toLowerCase())}var Xce=KX(function(e,t,n){return t=t.toLowerCase(),e+(n?Yce(t):t)}),Qce=200;function Jce(e,t,n,s){var o=-1,r=YX,a=!0,l=e.length,d=[],u=t.length;if(!l)return d;t.length>=Qce&&(r=XX,a=!1,t=new ZX(t));e:for(;++o<l;){var h=e[o],p=h;if(h=h!==0?h:0,a&&p===p){for(var f=u;f--;)if(t[f]===p)continue e;d.push(h)}else r(t,p,s)||d.push(h)}return d}var ede=QX(function(e,t){return b4(e)?Jce(e,o8(t,1,b4,!0)):[]});function tde(e,t){var n=-1,s=r8(e)?Array(e.length):[];return JX(e,function(o,r,a){s[++n]=t(o,r,a)}),s}function mr(e,t){var n=nQ(e)?eQ:tde;return n(e,tQ(t))}function nde(e,t){return o8(mr(e,t))}var sde=Math.max;function ide(e,t,n,s){e=r8(e)?e:sQ(e),n=n?iQ(n):0;var o=e.length;return n<0&&(n=sde(o+n,0)),sf(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&oQ(e,t,n)>-1}var ode="Expected a function";function zD(e){if(typeof e!="function")throw new TypeError(ode);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}var rde="Expected a function";function xC(e,t,n){var s=!0,o=!0;if(typeof e!="function")throw new TypeError(rde);return rQ(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),Di(e,t,{leading:s,maxWait:t,trailing:o})}function GD(e,t){return t=typeof t=="function"?t:void 0,e&&e.length?aQ(e,void 0,t):[]}const y5=document.title,ade="assets/images/invoke-favicon.svg",lde="assets/images/invoke-alert-favicon.svg",cde=()=>{const{queueSize:e}=uo(void 0,{selectFromResult:t=>({queueSize:t.data?t.data.queue.pending+t.data.queue.in_progress:0})});c.useEffect(()=>{document.title=e>0?`(${e}) ${y5}`:y5;const t=document.getElementById("invoke-favicon");t instanceof HTMLLinkElement&&(t.href=e>0?lde:ade)},[e])},dde=e=>c.useMemo(()=>Wn(e),[e]),ude=()=>{Pt("useSyncLoggingConfig");const e=re(lQ),t=A(a8),n=A(l8),s=A(c8);c.useLayoutEffect(()=>{cQ((e==null?void 0:e.logIsEnabled)??s,(e==null?void 0:e.logLevel)??t,(e==null?void 0:e.logNamespaces)??n)},[s,t,n,e==null?void 0:e.logIsEnabled,e==null?void 0:e.logLevel,e==null?void 0:e.logNamespaces])},HD=Wn("system"),Nd={gallery:new Set,layers:new Set,canvas:new Set,workflows:new Set,viewer:new Set},ym=Le(null),hde=Ak(Nd).reduce((e,t)=>(e[`$${t}`]=jn(ym,n=>n===t),e),{}),yC=e=>{ym.set(e),HD.trace(`Focus changed: ${e}`)},bm=(e,t,n)=>{c.useEffect(()=>{if(!t.current)return;const{focusOnMount:s=!1}={focusOnMount:!1,...n},o=t.current;return Nd[e].add(o),s&&yC(e),()=>{Nd[e].delete(o),Nd[e].size===0&&ym.get()===e&&yC(null)}},[n,t,e])},Os=e=>re(hde[`$${e}`]),b5=e=>{var o;const t=document.activeElement;if(!(t instanceof HTMLElement))return;const n=[];for(const r of Ak(Nd))for(const a of Nd[r])a.contains(t)&&n.push({region:r,element:a});if(n.length===0)return;n.sort((r,a)=>a.element.contains(r.element)?-1:r.element.contains(a.element)?1:0);const s=(o=n[0])==null?void 0:o.region;if(!s){HD.warn("No focused region found");return}yC(s)},pde=()=>{Pt("useFocusRegionWatcher"),c.useEffect(()=>(window.addEventListener("focus",b5,{capture:!0}),()=>{window.removeEventListener("focus",b5,{capture:!0})}),[])},dy=()=>{const e=re(Jn),{data:t}=uo(),[n,{isLoading:s}]=pS(),{t:o}=M(),r=c.useMemo(()=>t==null?void 0:t.queue.item_id,[t==null?void 0:t.queue.item_id]),a=c.useCallback(async()=>{if(r)try{await n(r).unwrap(),ge({id:"QUEUE_CANCEL_SUCCEEDED",title:o("queue.cancelSucceeded"),status:"success"})}catch{ge({id:"QUEUE_CANCEL_FAILED",title:o("queue.cancelFailed"),status:"error"})}},[r,o,n]),l=c.useMemo(()=>!e||He(r),[e,r]);return{cancelQueueItem:a,isLoading:s,currentQueueItemId:r,isDisabled:l}},WD=()=>{const{t:e}=M(),t=G(),{data:n}=uo(),s=re(Jn),[o,{isLoading:r}]=d8({fixedCacheKey:"clearQueue"}),a=c.useCallback(async()=>{if(n!=null&&n.queue.total)try{await o().unwrap(),ge({id:"QUEUE_CLEAR_SUCCEEDED",title:e("queue.clearSucceeded"),status:"success"}),t(fS(void 0)),t(mS(void 0))}catch{ge({id:"QUEUE_CLEAR_FAILED",title:e("queue.clearFailed"),status:"error"})}},[n==null?void 0:n.queue.total,o,t,e]),l=c.useMemo(()=>!s||!(n!=null&&n.queue.total),[s,n==null?void 0:n.queue.total]);return{clearQueue:a,isLoading:r,queueStatus:n,isDisabled:l}},ca=Le(!1),sa=Le(null),Xa=Le(!1),fde=jn([ca,sa,Xa],(e,t,n)=>e&&t!==null&&!n),t1=Le(null),UD=()=>{const e=re(t1),{isValidationRunInProgress:t}=h8(e!=null&&e.batchId?{batch_id:e.batchId}:cs,{selectFromResult:({currentData:n})=>n?n&&n.in_progress>0?{isValidationRunInProgress:!0}:{isValidationRunInProgress:!1}:{isValidationRunInProgress:!1}});return e!==null||t},qD=he(dQ,Xe,(e,t)=>{const n=[];for(const s of e){const o=t.nodes.find(r=>r.id===s.nodeId);ve(Rn(o),`Node ${s.nodeId} not found`),n.push({nodeId:s.nodeId,fieldName:s.fieldName,type:o.data.type})}return n}),KD=(e,t)=>{var o;const n=[],s=[];for(const r of e){const a=(o=t[r.type])==null?void 0:o.inputs[r.fieldName];if(!a){s.push(r);continue}if(uQ(a.type)){s.push(r);continue}n.push(r)}return{publishable:n,unpublishable:s}},uy=()=>{const e=re(ln),t=A(qD);return c.useMemo(()=>KD(t,e),[t,e])},mde={selectFromResult:({currentData:e})=>e?{isPublished:e.is_published}:{isPublished:!1}},Mc=()=>{const e=A(Ax),{isPublished:t}=u8(e??cs,mde);return t},gde=["metadata_to_model","metadata_to_sdxl_model","metadata_to_vae","metadata_to_lora_collection","metadata_to_loras","metadata_to_sdlx_loras","metadata_to_controlnets","metadata_to_ip_adapters","metadata_to_t2i_adapters","google_imagen3_generate","google_imagen3_edit","google_imagen4_generate","chatgpt_create_image","chatgpt_edit_image"],ZD=he(pu,e=>{for(const t of e)if(!Rn(t)||Vf(t)||hQ(t)||gde.includes(t.data.type))return!0;return!1}),jr=()=>{const e=re(ca),t=Mc(),n=UD();return e||t||n},nv=Wn("workflows"),xde=(e,t)=>{const{value:n}=e;if(n==="auto"||!n){const s=qs(t);return s==="none"?void 0:{board_id:s}}if(n!=="none")return n},yde=(e,t)=>{const{nodes:n,edges:s}=Xe(e),o=n.filter(Rn).filter(p8),r=o.reduce((h,p)=>{const{id:f,data:m}=p,{type:g,inputs:x,isIntermediate:b}=m,C=t[g];if(!C)return nv.warn({id:f,type:g},"Node template not found!"),h;const y=f8(x,(w,k,S)=>{const P=C.inputs[S];return P?(m8(P)&&g8(k)?w[S]=xde(k,e):w[S]=k.value,w):(nv.warn({id:f,name:S},"Field template not found!"),w)},{});y.use_cache=p.data.useCache;const v={type:g,id:f,...y,is_intermediate:b};return Object.assign(h,{[f]:v}),h},{}),a=o.map(({id:h})=>h),d=s.filter(h=>h.type!=="collapsed").filter(h=>a.includes(h.source)&&a.includes(h.target)).reduce((h,p)=>{const{source:f,target:m,sourceHandle:g,targetHandle:x}=p;return!g||!x?(nv.warn({source:f,target:m,sourceHandle:g,targetHandle:x},"Missing source or taget handle for edge"),h):(h.push({source:{node_id:f,field:g},destination:{node_id:m,field:x}}),h)},[]);return d.forEach(h=>{const p=r[h.destination.node_id],f=h.destination.field;r[h.destination.node_id]=na(p,f)}),{id:of(),nodes:r,edges:d}},_a=async e=>{const{node:t,dispatch:n,nodesState:s}=e,{nodes:o,edges:r}=s,a=o.filter(Rn);if(t.data.type==="image_batch"){ve(Mx(t.data.inputs.images));const l=t.data.inputs.images.value??[],d=r.find(f=>f.target===t.id&&f.targetHandle==="images");if(!d)return l??[];const u=a.find(f=>f.id===d.source);ve(u,"Missing edge from image generator to image batch");const h=u.data.inputs.generator;return ve(x8(h),"Invalid image generator field"),await y8(h,n)}else if(t.data.type==="string_batch"){ve(gS(t.data.inputs.strings));const l=t.data.inputs.strings.value,d=r.find(f=>f.target===t.id&&f.targetHandle==="strings");if(!d)return l??[];const u=a.find(f=>f.id===d.source);ve(u,"Missing edge from string generator to string batch");const h=u.data.inputs.generator;return ve(b8(h),"Invalid string generator"),await v8(h,n)}else if(t.data.type==="float_batch"){ve(xS(t.data.inputs.floats));const l=t.data.inputs.floats.value,d=r.find(f=>f.target===t.id&&f.targetHandle==="floats");if(!d)return l??[];const u=a.find(f=>f.id===d.source);ve(u,"Missing edge from float generator to float batch");const h=u.data.inputs.generator;return ve(C8(h),"Invalid float generator"),w8(h)}else if(t.data.type==="integer_batch"){ve(yS(t.data.inputs.integers));const l=t.data.inputs.integers.value,d=r.find(f=>f.target===t.id&&f.targetHandle==="integers");if(!d)return l??[];const u=a.find(f=>f.id===d.source);ve(u,"Missing edge from integer generator to integer batch");const h=u.data.inputs.generator;return ve(S8(h),"Invalid integer generator field"),k8(h)}ve(!1,"Invalid batch node type")},bde=async(e,t)=>{const{nodes:n}=e,s=n.filter(Rn).filter(Vf),o=s.filter(y=>{var v;return((v=y.data.inputs.batch_group_id)==null?void 0:v.value)==="None"}),r=s.filter(y=>{var v;return((v=y.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 1"}),a=s.filter(y=>{var v;return((v=y.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 2"}),l=s.filter(y=>{var v;return((v=y.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 3"}),d=s.filter(y=>{var v;return((v=y.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 4"}),u=s.filter(y=>{var v;return((v=y.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 5"}),h=await Promise.all(o.map(async y=>(await _a({nodesState:e,dispatch:t,node:y})).length)),p=await Promise.all(r.map(async y=>(await _a({nodesState:e,dispatch:t,node:y})).length)),f=await Promise.all(a.map(async y=>(await _a({nodesState:e,dispatch:t,node:y})).length)),m=await Promise.all(l.map(async y=>(await _a({nodesState:e,dispatch:t,node:y})).length)),g=await Promise.all(d.map(async y=>(await _a({nodesState:e,dispatch:t,node:y})).length)),x=await Promise.all(u.map(async y=>(await _a({nodesState:e,dispatch:t,node:y})).length)),b=[...h,...p,...f,...m,...g,...x];if(b.length===0)return"NO_BATCHES";if(b.some(y=>y===0))return"EMPTY_BATCHES";for(const y of[p,f,m,g,x])if(y.length!==0&&y.some(v=>v!==y[0]))return"MISMATCHED_BATCH_GROUP";return[...h,p[0]??1,f[0]??1,m[0]??1,g[0]??1,x[0]??1].reduce((y,v)=>y*v,1)},vde=bS("app/enqueueRequestedWorkflows"),YD=()=>{const{getState:e,dispatch:t}=cn();return c.useCallback(async(s,o)=>{t(vde());const r=e(),a=Xe(r),l=ln.get(),d=yde(r,l),u=pQ(a);u&&delete u.id;const h=[],f=a.nodes.filter(Rn).filter(Vf),m=vS(f,C=>{var y;return(y=C.data.inputs.batch_group_id)==null?void 0:y.value});for(const[C,y]of Object.entries(m)){const v=[];for(const w of y){const k=await _a({nodesState:a,node:w,dispatch:t}),S=w.data.type==="image_batch"?"image":"value",P=a.edges.filter(E=>E.source===w.id&&E.sourceHandle===S);if(C!=="None")for(const E of P){if(!E.targetHandle)break;v.push({node_path:E.target,field_name:E.targetHandle,items:k})}else{const E=[];for(const L of P){if(!L.targetHandle)break;E.push({node_path:L.target,field_name:L.targetHandle,items:k})}E.length>0&&h.push(E)}}C!=="None"&&v.length>0&&h.push(v)}const g={batch:{graph:d,workflow:u,runs:r.params.iterations,origin:"workflows",destination:"gallery",data:h},prepend:s};if(o){const C=qD(r),v=KD(C,l).publishable.map(({nodeId:L,fieldName:I})=>({kind:"input",node_id:L,field_name:I})),w=sa.get();ve(w!==null,"Output node not selected");const k=fu(Xe(r),w).type,S=l[k];ve(S,`Template for node type ${k} not found`);const E=Object.keys(S.outputs).map(L=>({kind:"output",node_id:w,field_name:L}));ve(a.id,"Workflow without ID cannot be used for API validation run"),g.validation_run_data={workflow_id:a.id,input_fields:v,output_fields:E},g.batch.runs=1}const b=await t($l.endpoints.enqueueBatch.initiate(g,{...zf,track:!1})).unwrap();return{batchConfig:g,enqueueResult:b}},[t,e])},Cde=Le(!1),uh=Le(!0),wde=/.*\{[\s\S]*\}.*/,Mk=e=>wde.test(e),Sde=(e,t)=>{const n=[],{minItems:s,maxItems:o}=t,r=e.length;return s!==void 0&&s>0&&r===0?n.push(Me("parameters.invoke.collectionEmpty")):(s!==void 0&&r<s&&n.push(Me("parameters.invoke.collectionTooFewItems",{count:r,minItems:s})),o!==void 0&&r>o&&n.push(Me("parameters.invoke.collectionTooManyItems",{count:r,maxItems:o}))),n},kde=(e,t)=>{const n=[],{minItems:s,maxItems:o,minLength:r,maxLength:a}=t,l=e.length;s!==void 0&&s>0&&l===0?n.push(Me("parameters.invoke.collectionEmpty")):(s!==void 0&&l<s&&n.push(Me("parameters.invoke.collectionTooFewItems",{count:l,minItems:s})),o!==void 0&&l>o&&n.push(Me("parameters.invoke.collectionTooManyItems",{count:l,maxItems:o})));for(const d of e)a!==void 0&&d.length>a&&n.push(Me("parameters.invoke.collectionStringTooLong",{value:e,maxLength:a})),r!==void 0&&d.length<r&&n.push(Me("parameters.invoke.collectionStringTooShort",{value:e,minLength:r}));return n},v5=(e,t)=>{const n=[],{minItems:s,maxItems:o,minimum:r,maximum:a,exclusiveMinimum:l,exclusiveMaximum:d,multipleOf:u}=t,h=e.length;s!==void 0&&s>0&&h===0?n.push(Me("parameters.invoke.collectionEmpty")):(s!==void 0&&h<s&&n.push(Me("parameters.invoke.collectionTooFewItems",{count:h,minItems:s})),o!==void 0&&h>o&&n.push(Me("parameters.invoke.collectionTooManyItems",{count:h,maxItems:o})));for(const p of e)a!==void 0&&p>a&&n.push(Me("parameters.invoke.collectionNumberGTMax",{value:e,maximum:a})),r!==void 0&&p<r&&n.push(Me("parameters.invoke.collectionNumberLTMin",{value:e,minimum:r})),d!==void 0&&p>=d&&n.push(Me("parameters.invoke.collectionNumberGTExclusiveMax",{value:e,exclusiveMaximum:d})),l!==void 0&&p<=l&&n.push(Me("parameters.invoke.collectionNumberLTExclusiveMin",{value:e,exclusiveMinimum:l})),u!==void 0&&p%u!==0&&n.push(Me("parameters.invoke.collectionNumberNotMultipleOf",{value:e,multipleOf:u}));return n},C5=(e,t)=>{const n=[],{minimum:s,maximum:o,exclusiveMinimum:r,exclusiveMaximum:a,multipleOf:l}=t;return o!==void 0&&e>o&&n.push(Me("parameters.invoke.collectionNumberGTMax",{value:e,maximum:o})),s!==void 0&&e<s&&n.push(Me("parameters.invoke.collectionNumberLTMin",{value:e,minimum:s})),a!==void 0&&e>=a&&n.push(Me("parameters.invoke.collectionNumberGTExclusiveMax",{value:e,exclusiveMaximum:a})),r!==void 0&&e<=r&&n.push(Me("parameters.invoke.collectionNumberLTExclusiveMin",{value:e,exclusiveMinimum:r})),l!==void 0&&e%l!==0&&n.push(Me("parameters.invoke.collectionNumberNotMultipleOf",{value:e,multipleOf:l})),n},jde=(e,t,n,s)=>`${e.data.label||t.title} -> ${n.label||s.title}`,_de=(e,t,n)=>s=>({type:"field-error",nodeId:e,fieldName:t,prefix:n,issue:s}),Ek=(e,t,n,s,o)=>{const r=[],a=jde(e,t,n,s),l=_de(e.data.id,n.name,a),d=e.data.id,u=n.name,h=o.edges.find(p=>p.target===d&&p.targetHandle===u)!==void 0;return s.required&&!h&&n.value===void 0?r.push({type:"field-error",nodeId:d,fieldName:u,prefix:a,issue:Me("parameters.invoke.missingInputForField")}):h||n.value!==void 0&&(j8(s)&&Mx(n)?r.push(...Sde(n.value,s).map(l)):_8(s)&&gS(n)?r.push(...kde(n.value,s).map(l)):I8(s)&&yS(n)?r.push(...v5(n.value,s).map(l)):T8(s)&&xS(n)?r.push(...v5(n.value,s).map(l)):U0(s)&&A8(n)?r.push(...C5(n.value,s).map(l)):q0(s)&&M8(n)&&r.push(...C5(n.value,s).map(l))),r},XD=(e,t,n)=>{const s=[],o=n.nodes.find(a=>a.id===e);ve(Rn(o),`Node ${e} is not an invocation node`);const r=t[o.data.type];if(!r)return s.push({type:"node-error",nodeId:e,issue:Me("parameters.invoke.missingNodeTemplate")}),s;for(const[a,l]of Object.entries(o.data.inputs)){const d=r.inputs[a];if(!d){s.push({type:"node-error",nodeId:e,issue:Me("parameters.invoke.missingFieldTemplate")});continue}s.push(...Ek(o,r,l,d,n))}return s},Bt=e=>{const t=c.useMemo(()=>he(Ri,s=>!(s.disabledFeatures.includes(e)||s.disabledSDFeatures.includes(e)||s.disabledTabs.includes(e))),[e]);return A(t)},QD=()=>{const e=Bt("chatGPT4oHigh");return{isChatGPT4oHighModelDisabled:c.useCallback(n=>(n==null?void 0:n.base)==="chatgpt-4o"&&n.name.toLowerCase().includes("high")&&!e,[e])}},On=he(xc,e=>e.activeTab),JD=he(xc,e=>e.shouldShowImageDetails),Pk=he(xc,e=>e.shouldShowProgressInViewer),df=he(xc,e=>e.activeTabCanvasRightPanel),hh={reference_image:"controlLayers.referenceImage",inpaint_mask:"controlLayers.inpaintMask",regional_guidance:"controlLayers.regionalGuidance",raster_layer:"controlLayers.rasterLayer",control_layer:"controlLayers.controlLayer"},Fa=Le([]),Au=jn(Fa,e=>e.length===0),Ide=Di(async(e,t,n,s,o,r,a,l,d,u,h,p,f,m,g,x,b,C)=>{if(e==="canvas"){const y=Ex(x.getState()),v=await Ede({isConnected:t,model:y,canvas:n,params:s,dynamicPrompts:o,canvasIsFiltering:r,canvasIsTransforming:a,canvasIsRasterizing:l,canvasIsCompositing:d,canvasIsSelectingObject:u,isChatGPT4oHighModelDisabled:C});Fa.set(v)}else if(e==="workflows"){const y=await Ade({dispatch:x.dispatch,nodesState:h,workflowSettingsState:p,isConnected:t,templates:f,isInPublishFlow:b});Fa.set(y)}else if(e==="upscaling"){const y=Mde({isConnected:t,upscale:m,config:g,params:s});Fa.set(y)}else Fa.set(Fs)},300),Tde=()=>{Pt("useReadinessWatcher");const e=cn(),t=E8(),n=A(On),s=A(Ye),o=A(mu),r=A(P8),a=A(Xe),l=A(L8),d=A(Gf),u=A(Ri),h=re(ln),p=re(Jn),f=re((t==null?void 0:t.stateApi.$isFiltering)??uh),m=re((t==null?void 0:t.stateApi.$isTransforming)??uh),g=re((t==null?void 0:t.stateApi.$isRasterizing)??uh),x=re((t==null?void 0:t.stateApi.$isSegmenting)??uh),b=re((t==null?void 0:t.compositor.$isBusy)??uh),C=re(ca),{isChatGPT4oHighModelDisabled:y}=QD();c.useEffect(()=>{Ide(n,p,s,o,r,f,m,g,b,x,a,l,h,d,u,e,C,y)},[e,s,b,f,g,x,m,u,r,p,a,o,n,h,d,l,C,y])},Lk=e=>({content:e("parameters.invoke.systemDisconnected")}),Ade=async e=>{const{dispatch:t,nodesState:n,workflowSettingsState:s,isConnected:o,templates:r,isInPublishFlow:a}=e,l=[];if(o||l.push(Lk(st.t)),s.shouldValidateGraph||a){const{nodes:d,edges:u}=n,h=d.filter(Rn),p=h.filter(Vf);h.filter(p8).length||l.push({content:st.t("parameters.invoke.noNodesInGraph")});for(const m of p)u.find(g=>g.source===m.id)===void 0&&l.push({content:st.t("parameters.invoke.batchNodeNotConnected",{label:m.data.label})});if(p.length>0){const m=[],g=vS(p,x=>{var b;return(b=x.data.inputs.batch_group_id)==null?void 0:b.value});for(const[x,b]of Object.entries(g)){const C=[];for(const y of b){const v=(await _a({dispatch:t,nodesState:n,node:y})).length;x==="None"?m.push(v):C.push(v)}C.some(y=>y!==C[0])&&l.push({content:st.t("parameters.invoke.batchNodeCollectionSizeMismatch",{batchGroupId:x})}),C[0]!==void 0&&m.push(C[0])}m.some(x=>x===0)&&l.push({content:st.t("parameters.invoke.batchNodeEmptyCollection")})}h.forEach(m=>{if(!Rn(m))return;const g=XD(m.data.id,r,n);for(const x of g)x.type==="node-error"?l.push({content:x.issue}):l.push({prefix:x.prefix,content:x.issue})})}return l},Mde=e=>{const{isConnected:t,upscale:n,config:s,params:o}=e,r=[];if(t||r.push(Lk(st.t)),!n.upscaleInitialImage)r.push({content:st.t("upscaling.missingUpscaleInitialImage")});else if(s.maxUpscaleDimension){const{width:l,height:d}=n.upscaleInitialImage,{scale:u}=n,h=s.maxUpscaleDimension**2;l*u*d*u>h&&r.push({content:st.t("upscaling.exceedsMaxSize")})}const a=o.model;return a&&!["sd-1","sdxl"].includes(a.base)?r.push({content:st.t("upscaling.incompatibleBaseModel")}):(a||r.push({content:st.t("parameters.invoke.noModelSelected")}),n.upscaleModel||r.push({content:st.t("upscaling.missingUpscaleModel")}),n.tileControlnetModel||r.push({content:st.t("upscaling.missingTileControlNetModel")})),r},Ede=e=>{const{isConnected:t,model:n,canvas:s,params:o,dynamicPrompts:r,canvasIsFiltering:a,canvasIsTransforming:l,canvasIsRasterizing:d,canvasIsCompositing:u,canvasIsSelectingObject:h,isChatGPT4oHighModelDisabled:p}=e,{positivePrompt:f}=o,m=[];if(t||m.push(Lk(st.t)),a&&m.push({content:st.t("parameters.invoke.canvasIsFiltering")}),l&&m.push({content:st.t("parameters.invoke.canvasIsTransforming")}),d&&m.push({content:st.t("parameters.invoke.canvasIsRasterizing")}),u&&m.push({content:st.t("parameters.invoke.canvasIsCompositing")}),h&&m.push({content:st.t("parameters.invoke.canvasIsSelectingObject")}),r.prompts.length===0&&Mk(f)&&m.push({content:st.t("parameters.invoke.noPrompts")}),n||m.push({content:st.t("parameters.invoke.noModelSelected")}),(n==null?void 0:n.base)==="flux"){o.t5EncoderModel||m.push({content:st.t("parameters.invoke.noT5EncoderModelSelected")}),o.clipEmbedModel||m.push({content:st.t("parameters.invoke.noCLIPEmbedModelSelected")}),o.fluxVAE||m.push({content:st.t("parameters.invoke.noFLUXVAEModelSelected")});const{bbox:b}=s,C=K0("flux");b.scaleMethod==="none"?(b.rect.width%C!==0&&m.push({content:st.t("parameters.invoke.modelIncompatibleBboxWidth",{model:"FLUX",width:b.rect.width,multiple:C})}),b.rect.height%C!==0&&m.push({content:st.t("parameters.invoke.modelIncompatibleBboxHeight",{model:"FLUX",height:b.rect.height,multiple:C})})):(b.scaledSize.width%C!==0&&m.push({content:st.t("parameters.invoke.modelIncompatibleScaledBboxWidth",{model:"FLUX",width:b.scaledSize.width,multiple:C})}),b.scaledSize.height%C!==0&&m.push({content:st.t("parameters.invoke.modelIncompatibleScaledBboxHeight",{model:"FLUX",height:b.scaledSize.height,multiple:C})}))}if((n==null?void 0:n.base)==="cogview4"){const{bbox:b}=s,C=K0("cogview4");b.scaleMethod==="none"?(b.rect.width%C!==0&&m.push({content:st.t("parameters.invoke.modelIncompatibleBboxWidth",{model:"CogView4",width:b.rect.width,multiple:C})}),b.rect.height%C!==0&&m.push({content:st.t("parameters.invoke.modelIncompatibleBboxHeight",{model:"CogView4",height:b.rect.height,multiple:C})})):(b.scaledSize.width%C!==0&&m.push({content:st.t("parameters.invoke.modelIncompatibleScaledBboxWidth",{model:"CogView4",width:b.scaledSize.width,multiple:C})}),b.scaledSize.height%C!==0&&m.push({content:st.t("parameters.invoke.modelIncompatibleScaledBboxHeight",{model:"CogView4",height:b.scaledSize.height,multiple:C})}))}n&&p(n)&&m.push({content:st.t("parameters.invoke.modelDisabledForTrial",{modelName:n.name})});const g=s.controlLayers.entities.filter(b=>b.isEnabled),x=g.filter(b=>{var C,y;return((y=(C=b.controlAdapter)==null?void 0:C.model)==null?void 0:y.type)==="control_lora"}).length;return(n==null?void 0:n.base)==="flux"&&x>1&&m.push({content:st.t("parameters.invoke.fluxModelMultipleControlLoRAs")}),g.forEach((b,C)=>{const y=st.t("controlLayers.layer_one"),v=C+1,w=st.t(hh.control_layer),k=`${y} #${v} (${w})`,S=D8(b,n);if(S.length){const P=Dl(S.map(E=>st.t(E)).join(", "));m.push({prefix:k,content:P})}}),s.referenceImages.entities.filter(b=>b.isEnabled).forEach((b,C)=>{const y=st.t("controlLayers.layer_one"),v=C+1,w=st.t(hh[b.type]),k=`${y} #${v} (${w})`,S=R8(b,n);if(S.length){const P=Dl(S.map(E=>st.t(E)).join(", "));m.push({prefix:k,content:P})}}),s.regionalGuidance.entities.filter(b=>b.isEnabled).forEach((b,C)=>{const y=st.t("controlLayers.layer_one"),v=C+1,w=st.t(hh[b.type]),k=`${y} #${v} (${w})`,S=O8(b,n);if(S.length){const P=Dl(S.map(E=>st.t(E)).join(", "));m.push({prefix:k,content:P})}}),s.rasterLayers.entities.filter(b=>b.isEnabled).forEach((b,C)=>{const y=st.t("controlLayers.layer_one"),v=C+1,w=st.t(hh[b.type]),k=`${y} #${v} (${w})`,S=N8();if(S.length){const P=Dl(S.map(E=>st.t(E)).join(", "));m.push({prefix:k,content:P})}}),s.inpaintMasks.entities.filter(b=>b.isEnabled).forEach((b,C)=>{const y=st.t("controlLayers.layer_one"),v=C+1,w=st.t(hh[b.type]),k=`${y} #${v} (${w})`,S=F8();if(S.length){const P=Dl(S.map(E=>st.t(E)).join(", "));m.push({prefix:k,content:P})}}),m},Pde=he(mu,P8,(e,t)=>Mk(e.positivePrompt)?t.prompts.length:1),w5=Wn("generation"),Dk=()=>{const e=G(),t=A(On),n=re(Au),s=jr(),o=YD(),[r,{isLoading:a}]=CS(zf),l=c.useCallback(async(h,p)=>{if(n){if(t==="workflows"){const f=await Zn(()=>o(h,p));f.isErr()?w5.error({error:$n(f.error)},"Failed to enqueue batch"):w5.debug(_o(f.value),"Enqueued batch")}if(t==="upscaling"){e(fQ({prepend:h}));return}if(t==="canvas"){e(mQ({prepend:h}));return}}},[e,o,n,t]),d=c.useCallback(()=>{l(!1,!1)},[l]),u=c.useCallback(()=>{l(!0,!1)},[l]);return{enqueueBack:d,enqueueFront:u,isLoading:a,isDisabled:!n||s,enqueue:l}};function bC(){return bC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},bC.apply(this,arguments)}var eR=["shift","alt","meta","mod","ctrl"],Lde={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function Ba(e){return(Lde[e]||e).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function Dde(e){return eR.includes(e)}function sv(e,t){return t===void 0&&(t=","),e.split(t)}function iv(e,t,n){t===void 0&&(t="+");var s=e.toLocaleLowerCase().split(t).map(function(a){return Ba(a)}),o={alt:s.includes("alt"),ctrl:s.includes("ctrl")||s.includes("control"),shift:s.includes("shift"),meta:s.includes("meta"),mod:s.includes("mod")},r=s.filter(function(a){return!eR.includes(a)});return bC({},o,{keys:r,description:n})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&tR([Ba(e.key),Ba(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&nR([Ba(e.key),Ba(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){$a.clear()})})();var $a=new Set;function Rk(e){return Array.isArray(e)}function Rde(e,t){t===void 0&&(t=",");var n=Rk(e)?e:e.split(t);return n.every(function(s){return $a.has(s.trim().toLowerCase())})}function tR(e){var t=Array.isArray(e)?e:[e];$a.has("meta")&&$a.forEach(function(n){return!Dde(n)&&$a.delete(n.toLowerCase())}),t.forEach(function(n){return $a.add(n.toLowerCase())})}function nR(e){var t=Array.isArray(e)?e:[e];e==="meta"?$a.clear():t.forEach(function(n){return $a.delete(n.toLowerCase())})}function Ode(e,t,n){(typeof n=="function"&&n(e,t)||n===!0)&&e.preventDefault()}function Nde(e,t,n){return typeof n=="function"?n(e,t):n===!0||n===void 0}function Fde(e){return sR(e,["input","textarea","select"])}function sR(e,t){var n=e.target;t===void 0&&(t=!1);var s=n&&n.tagName;return Rk(t)?!!(s&&t&&t.some(function(o){return o.toLowerCase()===s.toLowerCase()})):!!(s&&t&&t===!0)}function Bde(e,t){return e.length===0&&t?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):t?e.some(function(n){return t.includes(n)})||e.includes("*"):!0}var $de=function(t,n,s){s===void 0&&(s=!1);var o=n.alt,r=n.meta,a=n.mod,l=n.shift,d=n.ctrl,u=n.keys,h=t.key,p=t.code,f=t.ctrlKey,m=t.metaKey,g=t.shiftKey,x=t.altKey,b=Ba(p),C=h.toLowerCase();if(!(u!=null&&u.includes(b))&&!(u!=null&&u.includes(C))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(b))return!1;if(!s){if(o===!x&&C!=="alt"||l===!g&&C!=="shift")return!1;if(a){if(!m&&!f)return!1}else if(r===!m&&C!=="meta"&&C!=="os"||d===!f&&C!=="ctrl"&&C!=="control")return!1}return u&&u.length===1&&(u.includes(C)||u.includes(b))?!0:u?Rde(u):!u},Vde=c.createContext(void 0),zde=function(){return c.useContext(Vde)};function iR(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(n,s){return n&&iR(e[s],t[s])},!0):e===t}var Gde=c.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),Hde=function(){return c.useContext(Gde)};function Wde(e){var t=c.useRef(void 0);return iR(t.current,e)||(t.current=e),t.current}var S5=function(t){t.stopPropagation(),t.preventDefault(),t.stopImmediatePropagation()},Ude=typeof window<"u"?c.useLayoutEffect:c.useEffect;function Eo(e,t,n,s){var o=c.useRef(null),r=c.useRef(!1),a=n instanceof Array?s instanceof Array?void 0:s:n,l=Rk(e)?e.join(a==null?void 0:a.splitKey):e,d=n instanceof Array?n:s instanceof Array?s:void 0,u=c.useCallback(t,d??[]),h=c.useRef(u);d?h.current=u:h.current=t;var p=Wde(a),f=Hde(),m=f.enabledScopes,g=zde();return Ude(function(){if(!((p==null?void 0:p.enabled)===!1||!Bde(m,p==null?void 0:p.scopes))){var x=function(w,k){var S;if(k===void 0&&(k=!1),!(Fde(w)&&!sR(w,p==null?void 0:p.enableOnFormTags))){if(o.current!==null){var P=o.current.getRootNode();if((P instanceof Document||P instanceof ShadowRoot)&&P.activeElement!==o.current&&!o.current.contains(P.activeElement)){S5(w);return}}(S=w.target)!=null&&S.isContentEditable&&!(p!=null&&p.enableOnContentEditable)||sv(l,p==null?void 0:p.splitKey).forEach(function(E){var L,I=iv(E,p==null?void 0:p.combinationKey);if($de(w,I,p==null?void 0:p.ignoreModifiers)||(L=I.keys)!=null&&L.includes("*")){if(p!=null&&p.ignoreEventWhen!=null&&p.ignoreEventWhen(w)||k&&r.current)return;if(Ode(w,I,p==null?void 0:p.preventDefault),!Nde(w,I,p==null?void 0:p.enabled)){S5(w);return}h.current(w,I),k||(r.current=!0)}})}},b=function(w){w.key!==void 0&&(tR(Ba(w.code)),((p==null?void 0:p.keydown)===void 0&&(p==null?void 0:p.keyup)!==!0||p!=null&&p.keydown)&&x(w))},C=function(w){w.key!==void 0&&(nR(Ba(w.code)),r.current=!1,p!=null&&p.keyup&&x(w,!0))},y=o.current||(a==null?void 0:a.document)||document;return y.addEventListener("keyup",C),y.addEventListener("keydown",b),g&&sv(l,p==null?void 0:p.splitKey).forEach(function(v){return g.addHotkey(iv(v,p==null?void 0:p.combinationKey,p==null?void 0:p.description))}),function(){y.removeEventListener("keyup",C),y.removeEventListener("keydown",b),g&&sv(l,p==null?void 0:p.splitKey).forEach(function(v){return g.removeHotkey(iv(v,p==null?void 0:p.combinationKey,p==null?void 0:p.description))})}}},[l,p,m]),o}const qde=(e,t)=>e.map(n=>t?n.split("+").map(s=>s.replaceAll("mod","cmd").replaceAll("alt","option")):n.split("+").map(s=>s.replaceAll("mod","ctrl"))),oR=()=>{const{t:e}=M(),t=Bt("modelManager"),n=c.useMemo(()=>navigator.userAgent.toLowerCase().includes("mac"),[]);return c.useMemo(()=>{const o={app:{title:e("hotkeys.app.title"),hotkeys:{}},canvas:{title:e("hotkeys.canvas.title"),hotkeys:{}},viewer:{title:e("hotkeys.viewer.title"),hotkeys:{}},gallery:{title:e("hotkeys.gallery.title"),hotkeys:{}},workflows:{title:e("hotkeys.workflows.title"),hotkeys:{}}},r=(a,l,d,u=!0)=>{o[a].hotkeys[l]={id:l,category:a,title:e(`hotkeys.${a}.${l}.title`),desc:e(`hotkeys.${a}.${l}.desc`),hotkeys:d,platformKeys:qde(d,n),isEnabled:u}};return r("app","invoke",["mod+enter"]),r("app","invokeFront",["mod+shift+enter"]),r("app","cancelQueueItem",["shift+x"]),r("app","clearQueue",["mod+shift+x"]),r("app","selectCanvasTab",["1"]),r("app","selectUpscalingTab",["2"]),r("app","selectWorkflowsTab",["3"]),r("app","selectModelsTab",["4"],t),r("app","selectQueueTab",t?["5"]:["4"]),r("app","focusPrompt",["alt+a"]),r("app","toggleLeftPanel",["t","o"]),r("app","toggleRightPanel",["g"]),r("app","resetPanelLayout",["shift+r"]),r("app","togglePanels",["f"]),r("canvas","selectBrushTool",["b"]),r("canvas","selectBboxTool",["c"]),r("canvas","decrementToolWidth",["["]),r("canvas","incrementToolWidth",["]"]),r("canvas","selectEraserTool",["e"]),r("canvas","selectMoveTool",["v"]),r("canvas","selectRectTool",["u"]),r("canvas","selectViewTool",["h"]),r("canvas","selectColorPickerTool",["i"]),r("canvas","setFillToWhite",["d"]),r("canvas","fitLayersToCanvas",["mod+0"]),r("canvas","fitBboxToCanvas",["mod+shift+0"]),r("canvas","setZoomTo100Percent",["mod+1"]),r("canvas","setZoomTo200Percent",["mod+2"]),r("canvas","setZoomTo400Percent",["mod+3"]),r("canvas","setZoomTo800Percent",["mod+4"]),r("canvas","quickSwitch",["q"]),r("canvas","deleteSelected",["delete","backspace"]),r("canvas","resetSelected",["shift+c"]),r("canvas","transformSelected",["shift+t"]),r("canvas","filterSelected",["shift+f"]),r("canvas","undo",["mod+z"]),r("canvas","redo",["mod+shift+z","mod+y"]),r("canvas","nextEntity",["alt+]"]),r("canvas","prevEntity",["alt+["]),r("canvas","applyFilter",["enter"]),r("canvas","cancelFilter",["esc"]),r("canvas","applyTransform",["enter"]),r("canvas","cancelTransform",["esc"]),r("canvas","applySegmentAnything",["enter"]),r("canvas","cancelSegmentAnything",["esc"]),r("workflows","addNode",["shift+a","space"]),r("workflows","copySelection",["mod+c"]),r("workflows","pasteSelection",["mod+v"]),r("workflows","pasteSelectionWithEdges",["mod+shift+v"]),r("workflows","selectAll",["mod+a"]),r("workflows","deleteSelection",["delete","backspace"]),r("workflows","undo",["mod+z"]),r("workflows","redo",["mod+shift+z","mod+y"]),r("viewer","toggleViewer",["z"]),r("viewer","swapImages",["c"]),r("viewer","nextComparisonMode",["m"]),r("viewer","loadWorkflow",["w"]),r("viewer","recallAll",["a"]),r("viewer","recallSeed",["s"]),r("viewer","recallPrompts",["p"]),r("viewer","remix",["r"]),r("viewer","useSize",["d"]),r("viewer","runPostprocessing",["shift+u"]),r("viewer","toggleMetadata",["i"]),r("gallery","selectAllOnPage",["mod+a"]),r("gallery","clearSelection",["esc"]),r("gallery","galleryNavUp",["up"]),r("gallery","galleryNavRight",["right"]),r("gallery","galleryNavDown",["down"]),r("gallery","galleryNavLeft",["left"]),r("gallery","galleryNavUpAlt",["alt+up"]),r("gallery","galleryNavRightAlt",["alt+right"]),r("gallery","galleryNavDownAlt",["alt+down"]),r("gallery","galleryNavLeftAlt",["alt+left"]),r("gallery","deleteSelection",["delete","backspace"]),o},[n,t,e])},De=({id:e,category:t,callback:n,options:s,dependencies:o})=>{const r=oR(),a=c.useMemo(()=>{const d=r[t].hotkeys[e];return ve(d!==void 0,`Hotkey ${t}.${e} not found`),d},[t,r,e]),l=c.useMemo(()=>s?{...s,enabled:a.isEnabled?s.enabled:!1}:{enabled:a.isEnabled},[a.isEnabled,s]);return Eo(a.hotkeys,n,l,o)},Kde=()=>{const e=G(),t=Bt("modelManager"),n=Dk();De({id:"invoke",category:"app",callback:n.enqueueBack,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]}),De({id:"invokeFront",category:"app",callback:n.enqueueFront,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]});const{cancelQueueItem:s,isDisabled:o,isLoading:r}=dy();De({id:"cancelQueueItem",category:"app",callback:s,options:{enabled:!o&&!r,preventDefault:!0},dependencies:[s,o,r]});const{clearQueue:a,isDisabled:l,isLoading:d}=WD();De({id:"clearQueue",category:"app",callback:a,options:{enabled:!l&&!d,preventDefault:!0},dependencies:[a,l,d]}),De({id:"selectCanvasTab",category:"app",callback:()=>{e(Yt("canvas"))},dependencies:[e]}),De({id:"selectUpscalingTab",category:"app",callback:()=>{e(Yt("upscaling"))},dependencies:[e]}),De({id:"selectWorkflowsTab",category:"app",callback:()=>{e(Yt("workflows"))},dependencies:[e]}),De({id:"selectModelsTab",category:"app",callback:()=>{e(Yt("models"))},options:{enabled:t},dependencies:[e,t]}),De({id:"selectQueueTab",category:"app",callback:()=>{e(Yt("queue"))},dependencies:[e,t]})},Zde=1e3,Yde=()=>{const{getState:e,dispatch:t}=cn(),n=A(gQ),s=A(B8),o=Bt("dynamicPrompting"),r=c.useMemo(()=>Di(async(a,l)=>{try{const u=await t(v4.endpoints.dynamicPrompts.initiate({prompt:a,max_prompts:l},{subscribe:!1})).unwrap();t(Hb(u.prompts)),t(Wb(u.error)),t(Ub(!1))}catch{t(Ub(!0)),t(C4(!1))}},Zde),[t]);c.useEffect(()=>{if(!o)return;const{positivePrompt:a}=n,l=e(),d=v4.endpoints.dynamicPrompts.select({prompt:a,max_prompts:s})(l).data;if(d){t(Hb(d.prompts)),t(Wb(d.error));return}if(!Mk(a)){t(Hb([a])),t(Wb(void 0)),t(Ub(!1));return}l.dynamicPrompts.isLoading||t(C4(!0)),r(a,s)},[r,t,o,e,s,n])},is=c.memo(({loadingMessage:e})=>i.jsx(T,{flexDirection:"column",gap:4,borderRadius:"base",p:4,bg:"base.800",children:i.jsxs(T,{justifyContent:"center",alignItems:"center",flexDirection:"column",p:4,gap:8,children:[i.jsx(ci,{}),i.jsx(W,{variant:"subtext",children:e||"Fetching..."})]})}));is.displayName="FetchingModelsLoader";function Xn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){t.forEach(function(o){return o()})}}function Xde(e){if(Array.isArray(e))return e}function Qde(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,o,r,a,l=[],d=!0,u=!1;try{if(r=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;d=!1}else for(;!(d=(s=r.call(n)).done)&&(l.push(s.value),l.length!==t);d=!0);}catch(h){u=!0,o=h}finally{try{if(!d&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return l}}function vC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function rR(e,t){if(e){if(typeof e=="string")return vC(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vC(e,t):void 0}}function Jde(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ok(e,t){return Xde(e)||Qde(e,t)||rR(e,t)||Jde()}var ov={},ph={},k5;function aR(){if(k5)return ph;k5=1,Object.defineProperty(ph,"__esModule",{value:!0}),ph.bind=void 0;function e(t,n){var s=n.type,o=n.listener,r=n.options;return t.addEventListener(s,o,r),function(){t.removeEventListener(s,o,r)}}return ph.bind=e,ph}var kl={},j5;function eue(){if(j5)return kl;j5=1;var e=kl&&kl.__assign||function(){return e=Object.assign||function(r){for(var a,l=1,d=arguments.length;l<d;l++){a=arguments[l];for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(r[u]=a[u])}return r},e.apply(this,arguments)};Object.defineProperty(kl,"__esModule",{value:!0}),kl.bindAll=void 0;var t=aR();function n(r){if(!(typeof r>"u"))return typeof r=="boolean"?{capture:r}:r}function s(r,a){if(a==null)return r;var l=e(e({},r),{options:e(e({},n(a)),n(r.options))});return l}function o(r,a,l){var d=a.map(function(u){var h=s(u,l);return(0,t.bind)(r,h)});return function(){d.forEach(function(h){return h()})}}return kl.bindAll=o,kl}var _5;function tue(){return _5||(_5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bindAll=e.bind=void 0;var t=aR();Object.defineProperty(e,"bind",{enumerable:!0,get:function(){return t.bind}});var n=eue();Object.defineProperty(e,"bindAll",{enumerable:!0,get:function(){return n.bindAll}})}(ov)),ov}var gr=tue(),lR="data-pdnd-honey-pot";function cR(e){return e instanceof Element&&e.hasAttribute(lR)}function Nk(e){var t=document.elementsFromPoint(e.x,e.y),n=Ok(t,2),s=n[0],o=n[1];return s?cR(s)?o??null:s:null}function uf(e){"@babel/helpers - typeof";return uf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uf(e)}function nue(e,t){if(uf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(uf(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function sue(e){var t=nue(e,"string");return uf(t)=="symbol"?t:t+""}function Ur(e,t,n){return(t=sue(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var dR=2147483647;function I5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function T5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?I5(Object(n),!0).forEach(function(s){Ur(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var hf=2,A5=hf/2;function iue(e){return{x:Math.floor(e.x),y:Math.floor(e.y)}}function oue(e){return{x:e.x-A5,y:e.y-A5}}function rue(e){return{x:Math.max(e.x,0),y:Math.max(e.y,0)}}function aue(e){return{x:Math.min(e.x,window.innerWidth-hf),y:Math.min(e.y,window.innerHeight-hf)}}function M5(e){var t=e.client,n=aue(rue(oue(iue(t))));return DOMRect.fromRect({x:n.x,y:n.y,width:hf,height:hf})}function E5(e){var t=e.clientRect;return{left:"".concat(t.left,"px"),top:"".concat(t.top,"px"),width:"".concat(t.width,"px"),height:"".concat(t.height,"px")}}function lue(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function cue(e){var t=e.initial,n=document.createElement("div");n.setAttribute(lR,"true");var s=M5({client:t});Object.assign(n.style,T5(T5({backgroundColor:"transparent",position:"fixed",padding:0,margin:0,boxSizing:"border-box"},E5({clientRect:s})),{},{pointerEvents:"auto",zIndex:dR})),document.body.appendChild(n);var o=gr.bind(window,{type:"pointermove",listener:function(a){var l={x:a.clientX,y:a.clientY};s=M5({client:l}),Object.assign(n.style,E5({clientRect:s}))},options:{capture:!0}});return function(a){var l=a.current;if(o(),lue({client:l,clientRect:s})){n.remove();return}function d(){u(),n.remove()}var u=gr.bindAll(window,[{type:"pointerdown",listener:d},{type:"pointermove",listener:d},{type:"focusin",listener:d},{type:"focusout",listener:d},{type:"dragstart",listener:d},{type:"dragenter",listener:d},{type:"dragover",listener:d}],{capture:!0})}}function due(){var e=null;function t(){return e=null,gr.bind(window,{type:"pointermove",listener:function(o){e={x:o.clientX,y:o.clientY}},options:{capture:!0}})}function n(){var s=null;return function(r){var a=r.eventName,l=r.payload;if(a==="onDragStart"){var d=l.location.initial.input,u=e??{x:d.clientX,y:d.clientY};s=cue({initial:u})}if(a==="onDrop"){var h,p=l.location.current.input;(h=s)===null||h===void 0||h({current:{x:p.clientX,y:p.clientY}}),s=null,e=null}}}return{bindEvents:t,getOnPostDispatch:n}}function uue(e){if(Array.isArray(e))return vC(e)}function hue(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function pue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hy(e){return uue(e)||hue(e)||rR(e)||pue()}function Fk(e){var t=null;return function(){if(!t){for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];var a=e.apply(this,o);t={result:a}}return t.result}}var uR=Fk(function(){return navigator.userAgent.includes("Firefox")}),Mu=Fk(function(){var t=navigator,n=t.userAgent;return n.includes("AppleWebKit")&&!n.includes("Chrome")}),n1={isLeavingWindow:Symbol("leaving"),isEnteringWindow:Symbol("entering")};function fue(e){var t=e.dragEnter;return Mu()?t.hasOwnProperty(n1.isEnteringWindow):!1}function mue(e){var t=e.dragLeave;return Mu()?t.hasOwnProperty(n1.isLeavingWindow):!1}(function(){if(typeof window>"u"||!Mu())return;function t(){return{enterCount:0,isOverWindow:!1}}var n=t();function s(){n=t()}gr.bindAll(window,[{type:"dragstart",listener:function(){n.enterCount=0,n.isOverWindow=!0}},{type:"drop",listener:s},{type:"dragend",listener:s},{type:"dragenter",listener:function(r){!n.isOverWindow&&n.enterCount===0&&(r[n1.isEnteringWindow]=!0),n.isOverWindow=!0,n.enterCount++}},{type:"dragleave",listener:function(r){n.enterCount--,n.isOverWindow&&n.enterCount===0&&(r[n1.isLeavingWindow]=!0,n.isOverWindow=!1)}}],{capture:!0})})();function gue(e){return"nodeName"in e}function hR(e){return gue(e)&&e.ownerDocument!==document}function xue(e){var t=e.dragLeave,n=t.type,s=t.relatedTarget;return n!=="dragleave"?!1:Mu()?mue({dragLeave:t}):s==null?!0:uR()?hR(s):s instanceof HTMLIFrameElement}function Bk(e){var t=e.onDragEnd;return[{type:"pointermove",listener:function(){var n=0;return function(){if(n<20){n++;return}t()}}()},{type:"pointerdown",listener:t}]}function Np(e){return{altKey:e.altKey,button:e.button,buttons:e.buttons,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}}var yue=function(t){var n=[],s=null,o=function(){for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];n=l,!s&&(s=requestAnimationFrame(function(){s=null,t.apply(void 0,n)}))};return o.cancel=function(){s&&(cancelAnimationFrame(s),s=null)},o},rv=yue(function(e){return e()}),jg=function(){var e=null;function t(s){var o=requestAnimationFrame(function(){e=null,s()});e={frameId:o,fn:s}}function n(){e&&(cancelAnimationFrame(e.frameId),e.fn(),e=null)}return{schedule:t,flush:n}}();function bue(e){var t=e.source,n=e.initial,s=e.dispatchEvent,o={dropTargets:[]};function r(l){s(l),o={dropTargets:l.payload.location.current.dropTargets}}var a={start:function(d){var u=d.nativeSetDragImage,h={current:n,previous:o,initial:n};r({eventName:"onGenerateDragPreview",payload:{source:t,location:h,nativeSetDragImage:u}}),jg.schedule(function(){r({eventName:"onDragStart",payload:{source:t,location:h}})})},dragUpdate:function(d){var u=d.current;jg.flush(),rv.cancel(),r({eventName:"onDropTargetChange",payload:{source:t,location:{initial:n,previous:o,current:u}}})},drag:function(d){var u=d.current;rv(function(){jg.flush();var h={initial:n,previous:o,current:u};r({eventName:"onDrag",payload:{source:t,location:h}})})},drop:function(d){var u=d.current,h=d.updatedSourcePayload;jg.flush(),rv.cancel(),r({eventName:"onDrop",payload:{source:h??t,location:{current:u,previous:o,initial:n}}})}};return a}var CC={isActive:!1};function pR(){return!CC.isActive}function vue(e){return e.dataTransfer?e.dataTransfer.setDragImage.bind(e.dataTransfer):null}function Cue(e){var t=e.current,n=e.next;if(t.length!==n.length)return!0;for(var s=0;s<t.length;s++)if(t[s].element!==n[s].element)return!0;return!1}function wue(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,o=e.dispatchEvent;if(!pR())return;var r=Sue({event:t,dragType:n,getDropTargetsOver:s});CC.isActive=!0;var a={current:r};av({event:t,current:r.dropTargets});var l=bue({source:n.payload,dispatchEvent:o,initial:r});function d(m){var g=Cue({current:a.current.dropTargets,next:m.dropTargets});a.current=m,g&&l.dragUpdate({current:a.current})}function u(m){var g=Np(m),x=cR(m.target)?Nk({x:g.clientX,y:g.clientY}):m.target,b=s({target:x,input:g,source:n.payload,current:a.current.dropTargets});b.length&&(m.preventDefault(),av({event:m,current:b})),d({dropTargets:b,input:g})}function h(){a.current.dropTargets.length&&d({dropTargets:[],input:a.current.input}),l.drop({current:a.current,updatedSourcePayload:null}),p()}function p(){CC.isActive=!1,f()}var f=gr.bindAll(window,[{type:"dragover",listener:function(g){u(g),l.drag({current:a.current})}},{type:"dragenter",listener:u},{type:"dragleave",listener:function(g){xue({dragLeave:g})&&(d({input:a.current.input,dropTargets:[]}),n.startedFrom==="external"&&h())}},{type:"drop",listener:function(g){if(a.current={dropTargets:a.current.dropTargets,input:Np(g)},!a.current.dropTargets.length){h();return}g.preventDefault(),av({event:g,current:a.current.dropTargets}),l.drop({current:a.current,updatedSourcePayload:n.type==="external"?n.getDropPayload(g):null}),p()}},{type:"dragend",listener:function(g){a.current={dropTargets:a.current.dropTargets,input:Np(g)},h()}}].concat(hy(Bk({onDragEnd:h}))),{capture:!0});l.start({nativeSetDragImage:vue(t)})}function av(e){var t,n=e.event,s=e.current,o=(t=s[0])===null||t===void 0?void 0:t.dropEffect;o!=null&&n.dataTransfer&&(n.dataTransfer.dropEffect=o)}function Sue(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,o=Np(t);if(n.startedFrom==="external")return{input:o,dropTargets:[]};var r=s({input:o,source:n.payload,target:t.target,current:[]});return{input:o,dropTargets:r}}var P5={canStart:pR,start:wue},wC=new Map;function kue(e){var t=e.typeKey,n=e.mount,s=wC.get(t);if(s)return s.usageCount++,s;var o={typeKey:t,unmount:n(),usageCount:1};return wC.set(t,o),o}function jue(e){var t=kue(e);return function(){t.usageCount--,!(t.usageCount>0)&&(t.unmount(),wC.delete(e.typeKey))}}function fR(e,t){var n=t.attribute,s=t.value;return e.setAttribute(n,s),function(){return e.removeAttribute(n)}}function L5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function xa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?L5(Object(n),!0).forEach(function(s){Ur(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function lv(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_ue(e))||t){n&&(e=n);var s=0,o=function(){};return{s:o,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(u){throw u},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var u=n.next();return a=u.done,u},e:function(u){l=!0,r=u},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw r}}}}function _ue(e,t){if(e){if(typeof e=="string")return D5(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D5(e,t):void 0}}function D5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function cv(e){return e.slice(0).reverse()}function Iue(e){var t=e.typeKey,n=e.defaultDropEffect,s=new WeakMap,o="data-drop-target-for-".concat(t),r="[".concat(o,"]");function a(m){return s.set(m.element,m),function(){return s.delete(m.element)}}function l(m){return Xn(fR(m.element,{attribute:o,value:"true"}),a(m))}function d(m){var g,x,b,C,y=m.source,v=m.target,w=m.input,k=m.result,S=k===void 0?[]:k;if(v==null)return S;if(!(v instanceof Element))return v instanceof Node?d({source:y,target:v.parentElement,input:w,result:S}):S;var P=v.closest(r);if(P==null)return S;var E=s.get(P);if(E==null)return S;var L={input:w,source:y,element:E.element};if(E.canDrop&&!E.canDrop(L))return d({source:y,target:E.element.parentElement,input:w,result:S});var I=(g=(x=E.getData)===null||x===void 0?void 0:x.call(E,L))!==null&&g!==void 0?g:{},O=(b=(C=E.getDropEffect)===null||C===void 0?void 0:C.call(E,L))!==null&&b!==void 0?b:n,N={data:I,element:E.element,dropEffect:O,isActiveDueToStickiness:!1};return d({source:y,target:E.element.parentElement,input:w,result:[].concat(hy(S),[N])})}function u(m){var g=m.eventName,x=m.payload,b=lv(x.location.current.dropTargets),C;try{for(b.s();!(C=b.n()).done;){var y,v=C.value,w=s.get(v.element),k=xa(xa({},x),{},{self:v});w==null||(y=w[g])===null||y===void 0||y.call(w,k)}}catch(S){b.e(S)}finally{b.f()}}var h={onGenerateDragPreview:u,onDrag:u,onDragStart:u,onDrop:u,onDropTargetChange:function(g){var x=g.payload,b=new Set(x.location.current.dropTargets.map(function(V){return V.element})),C=new Set,y=lv(x.location.previous.dropTargets),v;try{for(y.s();!(v=y.n()).done;){var w,k=v.value;C.add(k.element);var S=s.get(k.element),P=b.has(k.element),E=xa(xa({},x),{},{self:k});if(S==null||(w=S.onDropTargetChange)===null||w===void 0||w.call(S,E),!P){var L;S==null||(L=S.onDragLeave)===null||L===void 0||L.call(S,E)}}}catch(V){y.e(V)}finally{y.f()}var I=lv(x.location.current.dropTargets),O;try{for(I.s();!(O=I.n()).done;){var N,_,R=O.value;if(!C.has(R.element)){var D=xa(xa({},x),{},{self:R}),B=s.get(R.element);B==null||(N=B.onDropTargetChange)===null||N===void 0||N.call(B,D),B==null||(_=B.onDragEnter)===null||_===void 0||_.call(B,D)}}}catch(V){I.e(V)}finally{I.f()}}};function p(m){h[m.eventName](m)}function f(m){var g=m.source,x=m.target,b=m.input,C=m.current,y=d({source:g,target:x,input:b});if(y.length>=C.length)return y;for(var v=cv(C),w=cv(y),k=[],S=0;S<v.length;S++){var P,E=v[S],L=w[S];if(L!=null){k.push(L);continue}var I=k[S-1],O=v[S-1];if((I==null?void 0:I.element)!==(O==null?void 0:O.element))break;var N=s.get(E.element);if(!N)break;var _={input:b,source:g,element:N.element};if(N.canDrop&&!N.canDrop(_)||!((P=N.getIsSticky)!==null&&P!==void 0&&P.call(N,_)))break;k.push(xa(xa({},E),{},{isActiveDueToStickiness:!0}))}return cv(k)}return{dropTargetForConsumers:l,getIsOver:f,dispatchEvent:p}}function Tue(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Aue(e))||t){n&&(e=n);var s=0,o=function(){};return{s:o,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(u){throw u},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var u=n.next();return a=u.done,u},e:function(u){l=!0,r=u},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw r}}}}function Aue(e,t){if(e){if(typeof e=="string")return R5(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R5(e,t):void 0}}function R5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function O5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Mue(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?O5(Object(n),!0).forEach(function(s){Ur(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Eue(){var e=new Set,t=null;function n(r){t&&(!r.canMonitor||r.canMonitor(t.canMonitorArgs))&&t.active.add(r)}function s(r){var a=Mue({},r);return e.add(a),n(a),function(){e.delete(a),t&&t.active.delete(a)}}function o(r){var a=r.eventName,l=r.payload;if(a==="onGenerateDragPreview"){t={canMonitorArgs:{initial:l.location.initial,source:l.source},active:new Set};var d=Tue(e),u;try{for(d.s();!(u=d.n()).done;){var h=u.value;n(h)}}catch(b){d.e(b)}finally{d.f()}}if(t){for(var p=Array.from(t.active),f=0,m=p;f<m.length;f++){var g=m[f];if(t.active.has(g)){var x;(x=g[a])===null||x===void 0||x.call(g,l)}}a==="onDrop"&&(t.active.clear(),t=null)}}return{dispatchEvent:o,monitorForConsumers:s}}function mR(e){var t=e.typeKey,n=e.mount,s=e.dispatchEventToSource,o=e.onPostDispatch,r=e.defaultDropEffect,a=Eue(),l=Iue({typeKey:t,defaultDropEffect:r});function d(p){s==null||s(p),l.dispatchEvent(p),a.dispatchEvent(p),o==null||o(p)}function u(p){var f=p.event,m=p.dragType;P5.start({event:f,dragType:m,getDropTargetsOver:l.getIsOver,dispatchEvent:d})}function h(){function p(){var f={canStart:P5.canStart,start:u};return n(f)}return jue({typeKey:t,mount:p})}return{registerUsage:h,dropTarget:l.dropTargetForConsumers,monitor:a.monitorForConsumers}}var Pue=Fk(function(){return navigator.userAgent.toLocaleLowerCase().includes("android")}),gR="pdnd:android-fallback",SC="text/plain",Lue="text/uri-list",xR="application/vnd.pdnd",s1=new WeakMap;function Due(e){return s1.set(e.element,e),function(){s1.delete(e.element)}}var N5=due(),$k=mR({typeKey:"element",defaultDropEffect:"move",mount:function(t){return Xn(N5.bindEvents(),gr.bind(document,{type:"dragstart",listener:function(s){var o,r,a,l,d,u;if(t.canStart(s)&&!s.defaultPrevented&&s.dataTransfer){var h=s.target;if(!(h instanceof HTMLElement))return null;var p=s1.get(h);if(!p)return null;var f=Np(s),m={element:p.element,dragHandle:(o=p.dragHandle)!==null&&o!==void 0?o:null,input:f};if(p.canDrag&&!p.canDrag(m))return s.preventDefault(),null;if(p.dragHandle){var g=Nk({x:f.clientX,y:f.clientY});if(!p.dragHandle.contains(g))return s.preventDefault(),null}var x=(r=(a=p.getInitialDataForExternal)===null||a===void 0?void 0:a.call(p,m))!==null&&r!==void 0?r:null;if(x)for(var b=0,C=Object.entries(x);b<C.length;b++){var y=Ok(C[b],2),v=y[0],w=y[1];s.dataTransfer.setData(v,w??"")}Pue()&&!s.dataTransfer.types.includes(SC)&&!s.dataTransfer.types.includes(Lue)&&s.dataTransfer.setData(SC,gR),s.dataTransfer.setData(xR,"");var k={element:p.element,dragHandle:(l=p.dragHandle)!==null&&l!==void 0?l:null,data:(d=(u=p.getInitialData)===null||u===void 0?void 0:u.call(p,m))!==null&&d!==void 0?d:{}},S={type:"element",payload:k,startedFrom:"internal"};t.start({event:s,dragType:S})}}}))},dispatchEventToSource:function(t){var n,s,o=t.eventName,r=t.payload;(n=s1.get(r.source.element))===null||n===void 0||(s=n[o])===null||s===void 0||s.call(n,r)},onPostDispatch:N5.getOnPostDispatch()}),Jd=$k.dropTarget,or=$k.monitor;function Eu(e){return Xn($k.registerUsage(),Due(e),fR(e.element,{attribute:"draggable",value:"true"}))}var pf=new Map,S0=new Set;function yR(e){Rue(e);var t=pf.get(e);if(t)return t;var n={timeOfEngagementStart:Date.now()};return pf.set(e,n),n}function Rue(e){S0.add(e)}function Oue(e){S0.clear(),e(),pf.forEach(function(t,n){S0.has(n)||pf.delete(n)}),S0.clear()}function Nue(){pf.clear()}var F5=new Map;function Fue(e){var t=F5.get(e);if(t)return t;var n=Bue(e);return F5.set(e,n),n}function Bue(e){var t={type:"idle"},n=[];function s(d){if(t.type==="running"){var u=d-t.timeLastFrameFinished,h=t,p=h.latestArgs,f=Nk({x:p.location.current.input.clientX,y:p.location.current.input.clientY});Oue(function(){n.forEach(function(m){return m({underUsersPointer:f,latestArgs:p,timeSinceLastFrame:u})})}),t.timeLastFrameFinished=d,t.frameId=requestAnimationFrame(s)}}function o(){t.type!=="idle"&&(cancelAnimationFrame(t.frameId),Nue(),t={type:"idle"})}function r(d){t.type==="idle"&&(t={type:"initializing",latestArgs:d,frameId:requestAnimationFrame(function(u){t.type==="initializing"&&(t={type:"running",timeLastFrameFinished:u,latestArgs:t.latestArgs,frameId:requestAnimationFrame(s)})})})}function a(d){if(t.type==="idle"){r(d);return}t.latestArgs=d}e({onDragStart:r,onDropTargetChange:a,onDrag:a,onDrop:o});var l={onFrame:function(u){n.push(u)}};return l}var kC="data-auto-scrollable",$ue="[".concat(kC,'="true"]');function Vue(e){return e.setAttribute(kC,"true"),function(){return e.removeAttribute(kC)}}function B5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function $5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?B5(Object(n),!0).forEach(function(s){Ur(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var zue={startHitboxAtPercentageRemainingOfElement:{top:.25,right:.25,bottom:.25,left:.25},maxScrollAtPercentageRemainingOfHitbox:{top:.5,right:.5,bottom:.5,left:.5},timeDampeningDurationMs:400,maxMainAxisHitboxSize:180},Gue={standard:15*60,fast:25*60};function bR(e){var t;return $5($5({},zue),{},{maxPixelScrollPerSecond:Gue[(t=e==null?void 0:e.maxScrollSpeed)!==null&&t!==void 0?t:"standard"]})}var Hue={top:function(t){return t.scrollTop>0},right:function(t){return Math.ceil(t.scrollLeft)+t.clientWidth<t.scrollWidth},bottom:function(t){return Math.ceil(t.scrollTop)+t.clientHeight<t.scrollHeight},left:function(t){return t.scrollLeft>0}},Wue=["top","right","bottom","left"],Uue={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"},V5={start:"top",end:"bottom",point:"y",size:"height"},z5={start:"left",end:"right",point:"x",size:"width"},vR={vertical:{mainAxis:V5,crossAxis:z5},horizontal:{mainAxis:z5,crossAxis:V5}},Vk={top:"start",right:"end",bottom:"end",left:"start"};function _g(e){var t=e.edge,n=e.axis;return function(o){var r,a=o.clientRect,l=o.config,d=vR[n],u=d.mainAxis,h=d.crossAxis,p=Vk[t],f=Math.min(l.startHitboxAtPercentageRemainingOfElement[t]*a[u.size],l.maxMainAxisHitboxSize);return DOMRect.fromRect((r={},Ur(r,u.point,p==="start"?a[u.point]:a[u.point]+a[u.size]-f),Ur(r,h.point,a[h.point]),Ur(r,u.size,f),Ur(r,h.size,a[h.size]),r))}}var que={top:_g({axis:"vertical",edge:"top"}),right:_g({axis:"horizontal",edge:"right"}),bottom:_g({axis:"vertical",edge:"bottom"}),left:_g({axis:"horizontal",edge:"left"})};function jC(e){var t=e.startOfRange,n=e.endOfRange,s=e.value,o=t<n;if(!o||s<t)return 0;if(s>n)return 1;var r=n-t;return(s-t)/r}function Kue(e){var t=e.timeSinceLastFrame,n=e.config,s=n.maxPixelScrollPerSecond/1e3,o=Math.ceil(s*t),r=n.maxPixelScrollPerSecond/60;return Math.min(o,r)}function Zue(e){var t=e.client,n=e.axis,s=e.edge,o=e.hitbox,r=e.config,a=vR[n].mainAxis,l=Vk[s],d=o[a.size]*r.maxScrollAtPercentageRemainingOfHitbox[s];if(l==="end")return jC({startOfRange:o[a.start],endOfRange:o[a.end]-d,value:t[a.point]});var u=jC({startOfRange:o[a.start]+d,endOfRange:o[a.end],value:t[a.point]});return 1-u}function Ig(e){var t=e.client,n=e.timeSinceLastFrame,s=e.engagement,o=e.axis,r=e.hitbox,a=e.edge,l=e.isDistanceDampeningEnabled,d=e.config,u=Kue({timeSinceLastFrame:n,config:d}),h=l?Zue({client:t,edge:a,hitbox:r,axis:o,config:d}):1,p=jC({startOfRange:s.timeOfEngagementStart,endOfRange:s.timeOfEngagementStart+d.timeDampeningDurationMs,value:Date.now()}),f=h*p,m=Math.max(u*f,1),g=Vk[a];return g==="end"?m:-1*m}function Yue(e,t){return t==="all"||e===t}function Xue(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function Que(e){return e.getBoundingClientRect()}function CR(e){var t=e.element,n=e.input,s=e.timeSinceLastFrame,o=e.engagement,r=e.config,a=e.allowedAxis,l=e.getRect,d=l===void 0?Que:l,u={x:n.clientX,y:n.clientY},h=d(t),p=Wue.reduce(function(g,x){var b=que[x]({clientRect:h,config:r}),C=Uue[x];return!Yue(C,a)||!Xue({client:u,clientRect:b})||!Hue[x](t)||g.set(x,{edge:x,hitbox:b}),g},new Map),f=function(){var g="horizontal",x=p.get("left");if(x)return Ig({client:u,edge:x.edge,hitbox:x.hitbox,axis:g,timeSinceLastFrame:s,engagement:o,isDistanceDampeningEnabled:!0,config:r});var b=p.get("right");return b?Ig({client:u,edge:b.edge,hitbox:b.hitbox,axis:g,timeSinceLastFrame:s,engagement:o,isDistanceDampeningEnabled:!0,config:r}):0}(),m=function(){var g="vertical",x=p.get("bottom");if(x)return Ig({client:u,edge:x.edge,hitbox:x.hitbox,axis:g,timeSinceLastFrame:s,engagement:o,isDistanceDampeningEnabled:!0,config:r});var b=p.get("top");return b?Ig({client:u,edge:b.edge,hitbox:b.hitbox,axis:g,timeSinceLastFrame:s,engagement:o,isDistanceDampeningEnabled:!0,config:r}):0}();return{left:f,top:m}}function Jue(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ehe(e))||t){n&&(e=n);var s=0,o=function(){};return{s:o,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(u){throw u},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var u=n.next();return a=u.done,u},e:function(u){l=!0,r=u},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw r}}}}function ehe(e,t){if(e){if(typeof e=="string")return G5(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G5(e,t):void 0}}function G5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function wR(e){return!!(e.top||e.left)}function SR(e){var t,n,s,o=e.target,r=e.input,a=e.source,l=e.findEntry,d=e.timeSinceLastFrame,u=e.available,h=u===void 0?{top:!0,left:!0}:u;if(!wR(h)||!o)return h;var p=o.closest($ue);if(!p)return h;var f=l(p);if(!f)return h;function m(){var w;return SR({target:(w=p==null?void 0:p.parentElement)!==null&&w!==void 0?w:null,findEntry:l,source:a,timeSinceLastFrame:d,input:r,available:h})}var g={input:r,source:a,element:p};if(f.canScroll&&!f.canScroll(g))return m();var x=yR(p),b=bR((t=f.getConfiguration)===null||t===void 0?void 0:t.call(f,g)),C=(n=(s=f.getAllowedAxis)===null||s===void 0?void 0:s.call(f,g))!==null&&n!==void 0?n:"all",y=CR({element:p,engagement:x,input:r,timeSinceLastFrame:d,allowedAxis:C,config:b}),v={top:0,left:0};return h.top&&y.top!==0&&(v.top=y.top,h.top=!1),h.left&&y.left!==0&&(v.left=y.left,h.left=!1),(v.top!==0||v.left!==0)&&p.scrollBy(v),m()}function the(e){var t=e.input,n=e.timeSinceLastFrame,s=e.available,o=e.source,r=e.entries,a=document.documentElement,l={input:t,source:o,element:a},d=Jue(r),u;try{for(d.s();!(u=d.n()).done;){var h,p,f,m=u.value;if(!(m.canScroll&&!m.canScroll(l))){var g=yR(a),x=bR((h=m.getConfiguration)===null||h===void 0?void 0:h.call(m,l)),b=(p=(f=m.getAllowedAxis)===null||f===void 0?void 0:f.call(m,l))!==null&&p!==void 0?p:"all",C=CR({element:a,engagement:g,input:t,config:x,allowedAxis:b,getRect:function(w){return DOMRect.fromRect({y:0,x:0,width:w.clientWidth,height:w.clientHeight})},timeSinceLastFrame:n}),y={top:s.top?C.top:0,left:s.left?C.left:0};(y.top!==0||y.left!==0)&&a.scrollBy(y);break}}}catch(v){d.e(v)}finally{d.f()}}function nhe(e){var t=e.input,n=e.findEntry,s=e.timeSinceLastFrame,o=e.source,r=e.getWindowScrollEntries,a=e.underUsersPointer,l=SR({target:a,timeSinceLastFrame:s,input:t,source:o,findEntry:n});wR(l)&&the({input:t,source:o,entries:r(),timeSinceLastFrame:s,available:l})}function H5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function she(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?H5(Object(n),!0).forEach(function(s){Ur(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function kR(e){var t=e.monitor,n=new Map,s=new Set;function o(u){return n.set(u.element,u),Xn(Vue(u.element),function(){return n.delete(u.element)})}function r(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=she({},u);return s.add(h),function(){return s.delete(h)}}function a(u){var h;return(h=n.get(u))!==null&&h!==void 0?h:null}function l(){return Array.from(s)}function d(u){var h=u.latestArgs,p=u.underUsersPointer,f=u.timeSinceLastFrame;nhe({input:h.location.current.input,source:h.source,findEntry:a,underUsersPointer:p,timeSinceLastFrame:f,getWindowScrollEntries:l})}return Fue(t).onFrame(d),{autoScroll:o,autoScrollWindow:r}}var ihe=kR({monitor:or}),zk=ihe.autoScroll;function ohe(e){var t=e.dragEnter,n=t.type,s=t.relatedTarget;return n!=="dragenter"?!1:Mu()?fue({dragEnter:t}):s==null?!0:uR()?hR(s):s instanceof HTMLIFrameElement}function Gk(e){var t=e.type,n=e.value;return!(t===xR||t===SC&&n===gR)}function rhe(e){return Array.from(e.types).filter(function(t){return Gk({type:t,value:e.getData(t)})})}function ahe(e){return Array.from(e.items).filter(function(t){return t.kind==="file"||Gk({type:t.type,value:e.getData(t.type)})})}var _C=!1,Hk=mR({typeKey:"external",defaultDropEffect:"copy",mount:function(t){return gr.bind(window,{type:"dragenter",listener:function(s){if(!_C&&s.dataTransfer&&t.canStart(s)&&ohe({dragEnter:s})){var o=rhe(s.dataTransfer);if(o.length){var r={types:o,items:[],getStringData:function(){return null}};t.start({event:s,dragType:{type:"external",startedFrom:"external",payload:r,getDropPayload:function(l){if(!l.dataTransfer)return r;var d=ahe(l.dataTransfer),u=l.dataTransfer.getData.bind(l.dataTransfer);return{types:o,items:d,getStringData:function(p){if(!o.includes(p))return null;var f=u(p);return Gk({type:p,value:f})?f:null}}}}})}}}})}});function IC(e){return Hk.dropTarget(e)}function Fp(e){return Hk.monitor(e)}(function(){if(typeof window>"u")return;Hk.registerUsage();var t={type:"idle"},n=t;function s(){n.type==="dragging"&&(_C=!1,n.cleanup(),n=t)}function o(){return gr.bindAll(window,[{type:"dragend",listener:s}].concat(hy(Bk({onDragEnd:s}))),{capture:!0})}gr.bind(window,{type:"dragstart",listener:function(){n.type==="idle"&&(_C=!0,n={type:"dragging",cleanup:o()})},options:{capture:!0}})})();var lhe=kR({monitor:Fp}),jR=lhe.autoScroll;/*!
 * OverlayScrollbars
 * Version: 2.11.1
 *
 * Copyright (c) Rene Haas | KingSora.
 * https://github.com/KingSora
 *
 * Released under the MIT license.
 */const xi=(e,t)=>{const{o:n,i:s,u:o}=e;let r=n,a;const l=(h,p)=>{const f=r,m=h,g=p||(s?!s(f,m):f!==m);return(g||o)&&(r=m,a=f),[r,g,a]};return[t?h=>l(t(r,a),h):l,h=>[r,!!h,a]]},che=typeof window<"u"&&typeof HTMLElement<"u"&&!!window.document,si=che?window:{},i1=Math.max,dhe=Math.min,TC=Math.round,o1=Math.abs,W5=Math.sign,Wk=si.cancelAnimationFrame,py=si.requestAnimationFrame,r1=si.setTimeout,AC=si.clearTimeout,fy=e=>typeof si[e]<"u"?si[e]:void 0,uhe=fy("MutationObserver"),U5=fy("IntersectionObserver"),Sd=fy("ResizeObserver"),jp=fy("ScrollTimeline"),Uk=e=>e===void 0,my=e=>e===null,rr=e=>typeof e=="number",vm=e=>typeof e=="string",gy=e=>typeof e=="boolean",Ei=e=>typeof e=="function",xr=e=>Array.isArray(e),a1=e=>typeof e=="object"&&!xr(e)&&!my(e),qk=e=>{const t=!!e&&e.length,n=rr(t)&&t>-1&&t%1==0;return xr(e)||!Ei(e)&&n?t>0&&a1(e)?t-1 in e:!0:!1},l1=e=>!!e&&e.constructor===Object,c1=e=>e instanceof HTMLElement,xy=e=>e instanceof Element,q5=()=>performance.now(),dv=(e,t,n,s,o)=>{let r=0;const a=q5(),l=i1(0,n),d=u=>{const h=q5(),f=h-a>=l,m=u?1:1-(i1(0,a+l-h)/l||0),g=(t-e)*(Ei(o)?o(m,m*l,0,1,l):m)+e,x=f||m===1;s&&s(g,m,x),r=x?0:py(()=>d())};return d(),u=>{Wk(r),u&&d(u)}};function Qt(e,t){if(qk(e))for(let n=0;n<e.length&&t(e[n],n,e)!==!1;n++);else e&&Qt(Object.keys(e),n=>t(e[n],n,e));return e}const _R=(e,t)=>e.indexOf(t)>=0,ff=(e,t)=>e.concat(t),Sn=(e,t,n)=>(!vm(t)&&qk(t)?Array.prototype.push.apply(e,t):e.push(t),e),hl=e=>Array.from(e||[]),Kk=e=>xr(e)?e:!vm(e)&&qk(e)?hl(e):[e],MC=e=>!!e&&!e.length,EC=e=>hl(new Set(e)),_i=(e,t,n)=>{Qt(e,o=>o?o.apply(void 0,t||[]):!0),n||(e.length=0)},IR="paddingTop",TR="paddingRight",AR="paddingLeft",MR="paddingBottom",ER="marginLeft",PR="marginRight",LR="marginBottom",DR="overflowX",RR="overflowY",yy="width",by="height",Ma="visible",zl="hidden",eu="scroll",hhe=e=>{const t=String(e||"");return t?t[0].toUpperCase()+t.slice(1):""},vy=(e,t,n,s)=>{if(e&&t){let o=!0;return Qt(n,r=>{const a=e[r],l=t[r];a!==l&&(o=!1)}),o}return!1},OR=(e,t)=>vy(e,t,["w","h"]),k0=(e,t)=>vy(e,t,["x","y"]),phe=(e,t)=>vy(e,t,["t","r","b","l"]),Zr=()=>{},it=(e,...t)=>e.bind(0,...t),Gl=e=>{let t;const n=e?r1:py,s=e?AC:Wk;return[o=>{s(t),t=n(()=>o(),Ei(e)?e():e)},()=>s(t)]},d1=(e,t)=>{const{_:n,p:s,v:o,S:r}=t||{};let a,l,d,u,h=Zr;const p=function(b){h(),AC(a),u=a=l=void 0,h=Zr,e.apply(this,b)},f=x=>r&&l?r(l,x):x,m=()=>{h!==Zr&&p(f(d)||d)},g=function(){const b=hl(arguments),C=Ei(n)?n():n;if(rr(C)&&C>=0){const v=Ei(s)?s():s,w=rr(v)&&v>=0,k=C>0?r1:py,S=C>0?AC:Wk,E=f(b)||b,L=p.bind(0,E);let I;h(),o&&!u?(L(),u=!0,I=k(()=>u=void 0,C)):(I=k(L,C),w&&!a&&(a=r1(m,v))),h=()=>S(I),l=d=E}else p(b)};return g.m=m,g},NR=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Po=e=>e?Object.keys(e):[],Nt=(e,t,n,s,o,r,a)=>{const l=[t,n,s,o,r,a];return(typeof e!="object"||my(e))&&!Ei(e)&&(e={}),Qt(l,d=>{Qt(d,(u,h)=>{const p=d[h];if(e===p)return!0;const f=xr(p);if(p&&l1(p)){const m=e[h];let g=m;f&&!xr(m)?g=[]:!f&&!l1(m)&&(g={}),e[h]=Nt(g,p)}else e[h]=f?p.slice():p})}),e},FR=(e,t)=>Qt(Nt({},e),(n,s,o)=>{n===void 0?delete o[s]:n&&l1(n)&&(o[s]=FR(n))}),Zk=e=>!Po(e).length,BR=(e,t,n)=>i1(e,dhe(t,n)),tc=e=>EC((xr(e)?e:(e||"").split(" ")).filter(t=>t)),Yk=(e,t)=>e&&e.getAttribute(t),K5=(e,t)=>e&&e.hasAttribute(t),Or=(e,t,n)=>{Qt(tc(t),s=>{e&&e.setAttribute(s,String(n||""))})},Go=(e,t)=>{Qt(tc(t),n=>e&&e.removeAttribute(n))},Cy=(e,t)=>{const n=tc(Yk(e,t)),s=it(Or,e,t),o=(r,a)=>{const l=new Set(n);return Qt(tc(r),d=>{l[a](d)}),hl(l).join(" ")};return{O:r=>s(o(r,"delete")),$:r=>s(o(r,"add")),C:r=>{const a=tc(r);return a.reduce((l,d)=>l&&n.includes(d),a.length>0)}}},$R=(e,t,n)=>(Cy(e,t).O(n),it(Xk,e,t,n)),Xk=(e,t,n)=>(Cy(e,t).$(n),it($R,e,t,n)),u1=(e,t,n,s)=>(s?Xk:$R)(e,t,n),Qk=(e,t,n)=>Cy(e,t).C(n),VR=e=>Cy(e,"class"),zR=(e,t)=>{VR(e).O(t)},Jk=(e,t)=>(VR(e).$(t),it(zR,e,t)),GR=(e,t)=>{const n=t?xy(t)&&t:document;return n?hl(n.querySelectorAll(e)):[]},fhe=(e,t)=>{const n=t?xy(t)&&t:document;return n&&n.querySelector(e)},PC=(e,t)=>xy(e)&&e.matches(t),HR=e=>PC(e,"body"),LC=e=>e?hl(e.childNodes):[],mf=e=>e&&e.parentElement,kd=(e,t)=>xy(e)&&e.closest(t),DC=e=>document.activeElement,mhe=(e,t,n)=>{const s=kd(e,t),o=e&&fhe(n,s),r=kd(o,t)===s;return s&&o?s===e||o===e||r&&kd(kd(e,n),t)!==s:!1},tu=e=>{Qt(Kk(e),t=>{const n=mf(t);t&&n&&n.removeChild(t)})},ei=(e,t)=>it(tu,e&&t&&Qt(Kk(t),n=>{n&&e.appendChild(n)}));let WR;const ghe=()=>WR,xhe=e=>{WR=e},Fd=e=>{const t=document.createElement("div");return Or(t,"class",e),t},UR=e=>{const t=Fd(),n=ghe(),s=e.trim();return t.innerHTML=n?n.createHTML(s):s,Qt(LC(t),o=>tu(o))},Z5=(e,t)=>e.getPropertyValue(t)||e[t]||"",qR=e=>{const t=e||0;return isFinite(t)?t:0},Tg=e=>qR(parseFloat(e||"")),RC=e=>Math.round(e*1e4)/1e4,KR=e=>`${RC(qR(e))}px`;function gf(e,t){e&&t&&Qt(t,(n,s)=>{try{const o=e.style,r=my(n)||gy(n)?"":rr(n)?KR(n):n;s.indexOf("--")===0?o.setProperty(s,r):o[s]=r}catch{}})}function ia(e,t,n){const s=vm(t);let o=s?"":{};if(e){const r=si.getComputedStyle(e,n)||e.style;o=s?Z5(r,t):hl(t).reduce((a,l)=>(a[l]=Z5(r,l),a),o)}return o}const Y5=(e,t,n)=>{const s=t?`${t}-`:"",o=n?`-${n}`:"",r=`${s}top${o}`,a=`${s}right${o}`,l=`${s}bottom${o}`,d=`${s}left${o}`,u=ia(e,[r,a,l,d]);return{t:Tg(u[r]),r:Tg(u[a]),b:Tg(u[l]),l:Tg(u[d])}},uv=(e,t)=>`translate${a1(e)?`(${e.x},${e.y})`:`${t?"X":"Y"}(${e})`}`,yhe=e=>!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),bhe={w:0,h:0},wy=(e,t)=>t?{w:t[`${e}Width`],h:t[`${e}Height`]}:bhe,vhe=e=>wy("inner",e||si),Bd=it(wy,"offset"),ZR=it(wy,"client"),h1=it(wy,"scroll"),ej=e=>{const t=parseFloat(ia(e,yy))||0,n=parseFloat(ia(e,by))||0;return{w:t-TC(t),h:n-TC(n)}},hv=e=>e.getBoundingClientRect(),Che=e=>!!e&&yhe(e),OC=e=>!!(e&&(e[by]||e[yy])),YR=(e,t)=>{const n=OC(e);return!OC(t)&&n},X5=(e,t,n,s)=>{Qt(tc(t),o=>{e&&e.removeEventListener(o,n,s)})},xn=(e,t,n,s)=>{var o;const r=(o=s&&s.H)!=null?o:!0,a=s&&s.I||!1,l=s&&s.A||!1,d={passive:r,capture:a};return it(_i,tc(t).map(u=>{const h=l?p=>{X5(e,u,h,a),n&&n(p)}:n;return e&&e.addEventListener(u,h,d),it(X5,e,u,h,a)}))},XR=e=>e.stopPropagation(),NC=e=>e.preventDefault(),QR=e=>XR(e)||NC(e),tr=(e,t)=>{const{x:n,y:s}=rr(t)?{x:t,y:t}:t||{};rr(n)&&(e.scrollLeft=n),rr(s)&&(e.scrollTop=s)},wi=e=>({x:e.scrollLeft,y:e.scrollTop}),JR=()=>({D:{x:0,y:0},M:{x:0,y:0}}),whe=(e,t)=>{const{D:n,M:s}=e,{w:o,h:r}=t,a=(p,f,m)=>{let g=W5(p)*m,x=W5(f)*m;if(g===x){const b=o1(p),C=o1(f);x=b>C?0:x,g=b<C?0:g}return g=g===x?0:g,[g+0,x+0]},[l,d]=a(n.x,s.x,o),[u,h]=a(n.y,s.y,r);return{D:{x:l,y:u},M:{x:d,y:h}}},pv=({D:e,M:t})=>{const n=(s,o)=>s===0&&s<=o;return{x:n(e.x,t.x),y:n(e.y,t.y)}},Q5=({D:e,M:t},n)=>{const s=(o,r,a)=>BR(0,1,(o-a)/(o-r)||0);return{x:s(e.x,t.x,n.x),y:s(e.y,t.y,n.y)}},FC=e=>{e&&e.focus&&e.focus({preventScroll:!0})},J5=(e,t)=>{Qt(Kk(t),e)},BC=e=>{const t=new Map,n=(r,a)=>{if(r){const l=t.get(r);J5(d=>{l&&l[d?"delete":"clear"](d)},a)}else t.forEach(l=>{l.clear()}),t.clear()},s=(r,a)=>{if(vm(r)){const u=t.get(r)||new Set;return t.set(r,u),J5(h=>{Ei(h)&&u.add(h)},a),it(n,r,a)}gy(a)&&a&&n();const l=Po(r),d=[];return Qt(l,u=>{const h=r[u];h&&Sn(d,s(u,h))}),it(_i,d)},o=(r,a)=>{Qt(hl(t.get(r)),l=>{a&&!MC(a)?l.apply(0,a):l()})};return s(e||{}),[s,n,o]},e7={},t7={},She=e=>{Qt(e,t=>Qt(t,(n,s)=>{e7[s]=t[s]}))},n7=(e,t,n)=>Po(e).map(s=>{const{static:o,instance:r}=e[s],[a,l,d]=n||[],u=n?r:o;if(u){const h=n?u(a,l,t):u(t);return(d||t7)[s]=h}}),Cm=e=>t7[e],khe="__osOptionsValidationPlugin",Pu="data-overlayscrollbars",j0="os-environment",Ag=`${j0}-scrollbar-hidden`,fv=`${Pu}-initialize`,_0="noClipping",eT=`${Pu}-body`,Ha=Pu,jhe="host",Nr=`${Pu}-viewport`,_he=DR,Ihe=RR,The="arrange",s7="measuring",Ahe="scrolling",i7="scrollbarHidden",Mhe="noContent",$C=`${Pu}-padding`,tT=`${Pu}-content`,tj="os-size-observer",Ehe=`${tj}-appear`,Phe=`${tj}-listener`,Lhe="os-trinsic-observer",Dhe="os-theme-none",Fi="os-scrollbar",Rhe=`${Fi}-rtl`,Ohe=`${Fi}-horizontal`,Nhe=`${Fi}-vertical`,o7=`${Fi}-track`,nj=`${Fi}-handle`,Fhe=`${Fi}-visible`,Bhe=`${Fi}-cornerless`,nT=`${Fi}-interaction`,sT=`${Fi}-unusable`,VC=`${Fi}-auto-hide`,iT=`${VC}-hidden`,oT=`${Fi}-wheel`,$he=`${o7}-interactive`,Vhe=`${nj}-interactive`,zhe="__osSizeObserverPlugin",Ghe=(e,t)=>{const{T:n}=t,[s,o]=e("showNativeOverlaidScrollbars");return[s&&n.x&&n.y,o]},nu=e=>e.indexOf(Ma)===0,Hhe=(e,t)=>{const n=(o,r,a,l)=>{const d=o===Ma?zl:o.replace(`${Ma}-`,""),u=nu(o),h=nu(a);return!r&&!l?zl:u&&h?Ma:u?r&&l?d:r?Ma:zl:r?d:h&&l?Ma:zl},s={x:n(t.x,e.x,t.y,e.y),y:n(t.y,e.y,t.x,e.x)};return{k:s,R:{x:s.x===eu,y:s.y===eu}}},r7="__osScrollbarsHidingPlugin",a7="__osClickScrollPlugin",Whe={[a7]:{static:()=>(e,t,n,s)=>{let o=!1,r=Zr;const a=133,l=222,[d,u]=Gl(a),h=Math.sign(t),p=n*h,f=p/2,m=C=>1-(1-C)*(1-C),g=(C,y)=>dv(C,y,l,e,m),x=(C,y)=>dv(C,t-p,a*y,(v,w,k)=>{e(v),k&&(r=g(v,t))}),b=dv(0,p,l,(C,y,v)=>{if(e(C),v&&(s(o),!o)){const w=t-C;Math.sign(w-f)===h&&d(()=>{const S=w-p;r=Math.sign(S)===h?x(C,Math.abs(S)/n):g(C,t)})}},m);return C=>{o=!0,C&&b(),u(),r()}}}},rT=e=>JSON.stringify(e,(t,n)=>{if(Ei(n))throw 0;return n}),aT=(e,t)=>e?`${t}`.split(".").reduce((n,s)=>n&&NR(n,s)?n[s]:void 0,e):void 0,Uhe={paddingAbsolute:!1,showNativeOverlaidScrollbars:!1,update:{elementEvents:[["img","load"]],debounce:[0,33],attributes:null,ignoreMutation:null},overflow:{x:"scroll",y:"scroll"},scrollbars:{theme:"os-theme-dark",visibility:"auto",autoHide:"never",autoHideDelay:1300,autoHideSuspend:!1,dragScroll:!0,clickScroll:!1,pointers:["mouse","touch","pen"]}},l7=(e,t)=>{const n={},s=ff(Po(t),Po(e));return Qt(s,o=>{const r=e[o],a=t[o];if(a1(r)&&a1(a))Nt(n[o]={},l7(r,a)),Zk(n[o])&&delete n[o];else if(NR(t,o)&&a!==r){let l=!0;if(xr(r)||xr(a))try{rT(r)===rT(a)&&(l=!1)}catch{}l&&(n[o]=a)}}),n},lT=(e,t,n)=>s=>[aT(e,s),n||aT(t,s)!==void 0];let c7;const qhe=()=>c7,Khe=e=>{c7=e};let mv;const Zhe=()=>{const e=(w,k,S)=>{ei(document.body,w),ei(document.body,w);const P=ZR(w),E=Bd(w),L=ej(k);return S&&tu(w),{x:E.h-P.h+L.h,y:E.w-P.w+L.w}},t=w=>{let k=!1;const S=Jk(w,Ag);try{k=ia(w,"scrollbar-width")==="none"||ia(w,"display","::-webkit-scrollbar")==="none"}catch{}return S(),k},n=`.${j0}{scroll-behavior:auto!important;position:fixed;opacity:0;visibility:hidden;overflow:scroll;height:200px;width:200px;z-index:-1}.${j0} div{width:200%;height:200%;margin:10px 0}.${Ag}{scrollbar-width:none!important}.${Ag}::-webkit-scrollbar,.${Ag}::-webkit-scrollbar-corner{appearance:none!important;display:none!important;width:0!important;height:0!important}`,o=UR(`<div class="${j0}"><div></div><style>${n}</style></div>`)[0],r=o.firstChild,a=o.lastChild,l=qhe();l&&(a.nonce=l);const[d,,u]=BC(),[h,p]=xi({o:e(o,r),i:k0},it(e,o,r,!0)),[f]=p(),m=t(o),g={x:f.x===0,y:f.y===0},x={elements:{host:null,padding:!m,viewport:w=>m&&HR(w)&&w,content:!1},scrollbars:{slot:!0},cancel:{nativeScrollbarsOverlaid:!1,body:null}},b=Nt({},Uhe),C=it(Nt,{},b),y=it(Nt,{},x),v={N:f,T:g,P:m,G:!!jp,K:it(d,"r"),Z:y,tt:w=>Nt(x,w)&&y(),nt:C,ot:w=>Nt(b,w)&&C(),st:Nt({},x),et:Nt({},b)};if(Go(o,"style"),tu(o),xn(si,"resize",()=>{u("r",[])}),Ei(si.matchMedia)&&!m&&(!g.x||!g.y)){const w=k=>{const S=si.matchMedia(`(resolution: ${si.devicePixelRatio}dppx)`);xn(S,"change",()=>{k(),w(k)},{A:!0})};w(()=>{const[k,S]=h();Nt(v.N,k),u("r",[S])})}return v},_r=()=>(mv||(mv=Zhe()),mv),Yhe=(e,t,n)=>{let s=!1;const o=n?new WeakMap:!1,r=()=>{s=!0},a=l=>{if(o&&n){const d=n.map(u=>{const[h,p]=u||[];return[p&&h?(l||GR)(h,e):[],p]});Qt(d,u=>Qt(u[0],h=>{const p=u[1],f=o.get(h)||[];if(e.contains(h)&&p){const g=xn(h,p,x=>{s?(g(),o.delete(h)):t(x)});o.set(h,Sn(f,g))}else _i(f),o.delete(h)}))}};return a(),[r,a]},cT=(e,t,n,s)=>{let o=!1;const{ct:r,rt:a,lt:l,it:d,ut:u,ft:h}=s||{},p=d1(()=>o&&n(!0),{_:33,p:99}),[f,m]=Yhe(e,p,l),g=r||[],x=a||[],b=ff(g,x),C=(v,w)=>{if(!MC(w)){const k=u||Zr,S=h||Zr,P=[],E=[];let L=!1,I=!1;if(Qt(w,O=>{const{attributeName:N,target:_,type:R,oldValue:D,addedNodes:B,removedNodes:V}=O,ee=R==="attributes",se=R==="childList",oe=e===_,te=ee&&N,H=te&&Yk(_,N||""),z=vm(H)?H:null,Z=te&&D!==z,U=_R(x,N)&&Z;if(t&&(se||!oe)){const Y=ee&&Z,$=Y&&d&&PC(_,d),q=($?!k(_,N,D,z):!ee||Y)&&!S(O,!!$,e,s);Qt(B,ie=>Sn(P,ie)),Qt(V,ie=>Sn(P,ie)),I=I||q}!t&&oe&&Z&&!k(_,N,D,z)&&(Sn(E,N),L=L||U)}),m(O=>EC(P).reduce((N,_)=>(Sn(N,GR(O,_)),PC(_,O)?Sn(N,_):N),[])),t)return!v&&I&&n(!1),[!1];if(!MC(E)||L){const O=[EC(E),L];return v||n.apply(0,O),O}}},y=new uhe(it(C,!1));return[()=>(y.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:b,subtree:t,childList:t,characterData:t}),o=!0,()=>{o&&(f(),y.disconnect(),o=!1)}),()=>{if(o)return p.m(),C(!0,y.takeRecords())}]};let jl=null;const d7=(e,t,n)=>{const{_t:s}=n||{},o=Cm(zhe),[r]=xi({o:!1,u:!0});return()=>{const a=[],d=UR(`<div class="${tj}"><div class="${Phe}"></div></div>`)[0],u=d.firstChild,h=p=>{const f=p instanceof ResizeObserverEntry;let m=!1,g=!1;if(f){const[x,,b]=r(p.contentRect),C=OC(x);g=YR(x,b),m=!g&&!C}else g=p===!0;m||t({dt:!0,_t:g})};if(Sd){if(!gy(jl)){const g=new Sd(Zr);g.observe(e,{get box(){jl=!0}}),jl=jl||!1,g.disconnect()}const p=d1(h,{_:0,p:0}),f=g=>p(g.pop()),m=new Sd(f);if(m.observe(jl?e:u),Sn(a,[()=>m.disconnect(),!jl&&ei(e,d)]),jl){const g=new Sd(f);g.observe(e,{box:"border-box"}),Sn(a,()=>g.disconnect())}}else if(o){const[p,f]=o(u,h,s);Sn(a,ff([Jk(d,Ehe),xn(d,"animationstart",p),ei(e,d)],f))}else return Zr;return it(_i,a)}},Xhe=(e,t)=>{let n;const s=d=>d.h===0||d.isIntersecting||d.intersectionRatio>0,o=Fd(Lhe),[r]=xi({o:!1}),a=(d,u)=>{if(d){const h=r(s(d)),[,p]=h;return p&&!u&&t(h)&&[h]}},l=(d,u)=>a(u.pop(),d);return[()=>{const d=[];if(U5)n=new U5(it(l,!1),{root:e}),n.observe(o),Sn(d,()=>{n.disconnect()});else{const u=()=>{const h=Bd(o);a(h)};Sn(d,d7(o,u)()),u()}return it(_i,Sn(d,ei(e,o)))},()=>n&&l(!0,n.takeRecords())]},Qhe=(e,t,n,s)=>{let o,r,a,l,d,u;const h=`[${Ha}]`,p=`[${Nr}]`,f=["id","class","style","open","wrap","cols","rows"],{vt:m,ht:g,U:x,gt:b,bt:C,L:y,wt:v,yt:w,St:k,Ot:S}=e,P=U=>ia(U,"direction")==="rtl",E={$t:!1,F:P(m)},L=_r(),I=Cm(r7),[O]=xi({i:OR,o:{w:0,h:0}},()=>{const U=I&&I.V(e,t,E,L,n).W,$=!(v&&y)&&Qk(g,Ha,_0),F=!y&&w(The),q=F&&wi(b),ie=q&&S(),ce=k(s7,$),me=F&&U&&U()[0],Ie=h1(x),we=ej(x);return me&&me(),tr(b,q),ie&&ie(),$&&ce(),{w:Ie.w+we.w,h:Ie.h+we.h}}),N=d1(s,{_:()=>o,p:()=>r,S(U,Y){const[$]=U,[F]=Y;return[ff(Po($),Po(F)).reduce((q,ie)=>(q[ie]=$[ie]||F[ie],q),{})]}}),_=U=>{const Y=P(m);Nt(U,{Ct:u!==Y}),Nt(E,{F:Y}),u=Y},R=(U,Y)=>{const[$,F]=U,q={xt:F};return Nt(E,{$t:$}),Y||s(q),q},D=({dt:U,_t:Y})=>{const F=!(U&&!Y)&&L.P?N:s,q={dt:U||Y,_t:Y};_(q),F(q)},B=(U,Y)=>{const[,$]=O(),F={Ht:$};return _(F),$&&!Y&&(U?s:N)(F),F},V=(U,Y,$)=>{const F={Et:Y};return _(F),Y&&!$&&N(F),F},[ee,se]=C?Xhe(g,R):[],oe=!y&&d7(g,D,{_t:!0}),[te,H]=cT(g,!1,V,{rt:f,ct:f}),z=y&&Sd&&new Sd(U=>{const Y=U[U.length-1].contentRect;D({dt:!0,_t:YR(Y,d)}),d=Y}),Z=d1(()=>{const[,U]=O();s({Ht:U})},{_:222,v:!0});return[()=>{z&&z.observe(g);const U=oe&&oe(),Y=ee&&ee(),$=te(),F=L.K(q=>{q?N({zt:q}):Z()});return()=>{z&&z.disconnect(),U&&U(),Y&&Y(),l&&l(),$(),F()}},({It:U,At:Y,Dt:$})=>{const F={},[q]=U("update.ignoreMutation"),[ie,ce]=U("update.attributes"),[me,Ie]=U("update.elementEvents"),[we,Ee]=U("update.debounce"),ot=Ie||ce,Fe=Y||$,Be=ut=>Ei(q)&&q(ut);if(ot){a&&a(),l&&l();const[ut,rt]=cT(C||x,!0,B,{ct:ff(f,ie||[]),lt:me,it:h,ft:(ht,K)=>{const{target:ae,attributeName:ne}=ht;return(!K&&ne&&!y?mhe(ae,h,p):!1)||!!kd(ae,`.${Fi}`)||!!Be(ht)}});l=ut(),a=rt}if(Ee)if(N.m(),xr(we)){const ut=we[0],rt=we[1];o=rr(ut)&&ut,r=rr(rt)&&rt}else rr(we)?(o=we,r=!1):(o=!1,r=!1);if(Fe){const ut=H(),rt=se&&se(),ht=a&&a();ut&&Nt(F,V(ut[0],ut[1],Fe)),rt&&Nt(F,R(rt[0],Fe)),ht&&Nt(F,B(ht[0],Fe))}return _(F),F},E]},u7=(e,t)=>Ei(t)?t.apply(0,e):t,Jhe=(e,t,n,s)=>{const o=Uk(s)?n:s;return u7(e,o)||t.apply(0,e)},h7=(e,t,n,s)=>{const o=Uk(s)?n:s,r=u7(e,o);return!!r&&(c1(r)?r:t.apply(0,e))},epe=(e,t)=>{const{nativeScrollbarsOverlaid:n,body:s}=t||{},{T:o,P:r,Z:a}=_r(),{nativeScrollbarsOverlaid:l,body:d}=a().cancel,u=n??l,h=Uk(s)?d:s,p=(o.x||o.y)&&u,f=e&&(my(h)?!r:h);return!!p||!!f},tpe=(e,t,n,s)=>{const o="--os-viewport-percent",r="--os-scroll-percent",a="--os-scroll-direction",{Z:l}=_r(),{scrollbars:d}=l(),{slot:u}=d,{vt:h,ht:p,U:f,Mt:m,gt:g,wt:x,L:b}=t,{scrollbars:C}=m?{}:e,{slot:y}=C||{},v=[],w=[],k=[],S=h7([h,p,f],()=>b&&x?h:p,u,y),P=te=>{if(jp){let H=null,z=[];const Z=new jp({source:g,axis:te}),U=()=>{H&&H.cancel(),H=null};return{Rt:$=>{const{Tt:F}=n,q=pv(F)[te],ie=te==="x",ce=[uv(0,ie),uv(`calc(100cq${ie?"w":"h"} + -100%)`,ie)],me=q?ce:ce.reverse();return z[0]===me[0]&&z[1]===me[1]||(U(),z=me,H=$.kt.animate({clear:["left"],transform:me},{timeline:Z})),U}}}},E={x:P("x"),y:P("y")},L=()=>{const{Vt:te,Lt:H}=n,z=(Z,U)=>BR(0,1,Z/(Z+U)||0);return{x:z(H.x,te.x),y:z(H.y,te.y)}},I=(te,H,z)=>{const Z=z?Jk:zR;Qt(te,U=>{Z(U.Ut,H)})},O=(te,H)=>{Qt(te,z=>{const[Z,U]=H(z);gf(Z,U)})},N=(te,H,z)=>{const Z=gy(z),U=Z?z:!0,Y=Z?!z:!0;U&&I(w,te,H),Y&&I(k,te,H)},_=()=>{const te=L(),H=z=>Z=>[Z.Ut,{[o]:RC(z)+""}];O(w,H(te.x)),O(k,H(te.y))},R=()=>{if(!jp){const{Tt:te}=n,H=Q5(te,wi(g)),z=Z=>U=>[U.Ut,{[r]:RC(Z)+""}];O(w,z(H.x)),O(k,z(H.y))}},D=()=>{const{Tt:te}=n,H=pv(te),z=Z=>U=>[U.Ut,{[a]:Z?"0":"1"}];O(w,z(H.x)),O(k,z(H.y)),jp&&(w.forEach(E.x.Rt),k.forEach(E.y.Rt))},B=()=>{if(b&&!x){const{Vt:te,Tt:H}=n,z=pv(H),Z=Q5(H,wi(g)),U=Y=>{const{Ut:$}=Y,F=mf($)===f&&$,q=(ie,ce,me)=>{const Ie=ce*ie;return KR(me?Ie:-Ie)};return[F,F&&{transform:uv({x:q(Z.x,te.x,z.x),y:q(Z.y,te.y,z.y)})}]};O(w,U),O(k,U)}},V=te=>{const H=te?"x":"y",Z=Fd(`${Fi} ${te?Ohe:Nhe}`),U=Fd(o7),Y=Fd(nj),$={Ut:Z,Pt:U,kt:Y},F=E[H];return Sn(te?w:k,$),Sn(v,[ei(Z,U),ei(U,Y),it(tu,Z),F&&F.Rt($),s($,N,te)]),$},ee=it(V,!0),se=it(V,!1),oe=()=>(ei(S,w[0].Ut),ei(S,k[0].Ut),it(_i,v));return ee(),se(),[{Nt:_,qt:R,Bt:D,Ft:B,jt:N,Xt:{Yt:w,Wt:ee,Jt:it(O,w)},Gt:{Yt:k,Wt:se,Jt:it(O,k)}},oe]},npe=(e,t,n,s)=>(o,r,a)=>{const{ht:l,U:d,L:u,gt:h,Kt:p,Ot:f}=t,{Ut:m,Pt:g,kt:x}=o,[b,C]=Gl(333),[y,v]=Gl(444),w=P=>{Ei(h.scrollBy)&&h.scrollBy({behavior:"smooth",left:P.x,top:P.y})},k=()=>{const P="pointerup pointercancel lostpointercapture",E=`client${a?"X":"Y"}`,L=a?yy:by,I=a?"left":"top",O=a?"w":"h",N=a?"x":"y",_=(D,B)=>V=>{const{Vt:ee}=n,se=Bd(g)[O]-Bd(x)[O],te=B*V/se*ee[N];tr(h,{[N]:D+te})},R=[];return xn(g,"pointerdown",D=>{const B=kd(D.target,`.${nj}`)===x,V=B?x:g,ee=e.scrollbars,se=ee[B?"dragScroll":"clickScroll"],{button:oe,isPrimary:te,pointerType:H}=D,{pointers:z}=ee;if(oe===0&&te&&se&&(z||[]).includes(H)){_i(R),v();const U=!B&&(D.shiftKey||se==="instant"),Y=it(hv,x),$=it(hv,g),F=(K,ae)=>(K||Y())[I]-(ae||$())[I],q=TC(hv(h)[L])/Bd(h)[O]||1,ie=_(wi(h)[N],1/q),ce=D[E],me=Y(),Ie=$(),we=me[L],Ee=F(me,Ie)+we/2,ot=ce-Ie[I],Fe=B?0:ot-Ee,Be=K=>{_i(ht),V.releasePointerCapture(K.pointerId)},ut=B||U,rt=f(),ht=[xn(p,P,Be),xn(p,"selectstart",K=>NC(K),{H:!1}),xn(g,P,Be),ut&&xn(g,"pointermove",K=>ie(Fe+(K[E]-ce))),ut&&(()=>{const K=wi(h);rt();const ae=wi(h),ne={x:ae.x-K.x,y:ae.y-K.y};(o1(ne.x)>3||o1(ne.y)>3)&&(f(),tr(h,K),w(ne),y(rt))})];if(V.setPointerCapture(D.pointerId),U)ie(Fe);else if(!B){const K=Cm(a7);if(K){const ae=K(ie,Fe,we,ne=>{ne?rt():Sn(ht,rt)});Sn(ht,ae),Sn(R,it(ae,!0))}}}})};let S=!0;return it(_i,[xn(x,"pointermove pointerleave",s),xn(m,"pointerenter",()=>{r(nT,!0)}),xn(m,"pointerleave pointercancel",()=>{r(nT,!1)}),!u&&xn(m,"mousedown",()=>{const P=DC();(K5(P,Nr)||K5(P,Ha)||P===document.body)&&r1(it(FC,d),25)}),xn(m,"wheel",P=>{const{deltaX:E,deltaY:L,deltaMode:I}=P;S&&I===0&&mf(m)===l&&w({x:E,y:L}),S=!1,r(oT,!0),b(()=>{S=!0,r(oT)}),NC(P)},{H:!1,I:!0}),xn(m,"pointerdown",it(xn,p,"click",QR,{A:!0,I:!0,H:!1}),{I:!0}),k(),C,v])},spe=(e,t,n,s,o,r)=>{let a,l,d,u,h,p=Zr,f=0;const m=["mouse","pen"],g=H=>m.includes(H.pointerType),[x,b]=Gl(),[C,y]=Gl(100),[v,w]=Gl(100),[k,S]=Gl(()=>f),[P,E]=tpe(e,o,s,npe(t,o,s,H=>g(H)&&ee())),{ht:L,Qt:I,wt:O}=o,{jt:N,Nt:_,qt:R,Bt:D,Ft:B}=P,V=(H,z)=>{if(S(),H)N(iT);else{const Z=it(N,iT,!0);f>0&&!z?k(Z):Z()}},ee=()=>{(d?!a:!u)&&(V(!0),C(()=>{V(!1)}))},se=H=>{N(VC,H,!0),N(VC,H,!1)},oe=H=>{g(H)&&(a=d,d&&V(!0))},te=[S,y,w,b,()=>p(),xn(L,"pointerover",oe,{A:!0}),xn(L,"pointerenter",oe),xn(L,"pointerleave",H=>{g(H)&&(a=!1,d&&V(!1))}),xn(L,"pointermove",H=>{g(H)&&l&&ee()}),xn(I,"scroll",H=>{x(()=>{R(),ee()}),r(H),B()})];return[()=>it(_i,Sn(te,E())),({It:H,Dt:z,Zt:Z,tn:U})=>{const{nn:Y,sn:$,en:F,cn:q}=U||{},{Ct:ie,_t:ce}=Z||{},{F:me}=n,{T:Ie}=_r(),{k:we,rn:Ee}=s,[ot,Fe]=H("showNativeOverlaidScrollbars"),[Be,ut]=H("scrollbars.theme"),[rt,ht]=H("scrollbars.visibility"),[K,ae]=H("scrollbars.autoHide"),[ne,ue]=H("scrollbars.autoHideSuspend"),[be]=H("scrollbars.autoHideDelay"),[ye,ke]=H("scrollbars.dragScroll"),[Ue,pt]=H("scrollbars.clickScroll"),[_t,vn]=H("overflow"),Cn=ce&&!z,gn=Ee.x||Ee.y,Fn=Y||$||q||ie||z,Hi=F||ht||vn,$o=ot&&Ie.x&&Ie.y,mo=(Vo,ch,dh)=>{const gg=Vo.includes(eu)&&(rt===Ma||rt==="auto"&&ch===eu);return N(Fhe,gg,dh),gg};if(f=be,Cn&&(ne&&gn?(se(!1),p(),v(()=>{p=xn(I,"scroll",it(se,!0),{A:!0})})):se(!0)),Fe&&N(Dhe,$o),ut&&(N(h),N(Be,!0),h=Be),ue&&!ne&&se(!0),ae&&(l=K==="move",d=K==="leave",u=K==="never",V(u,!0)),ke&&N(Vhe,ye),pt&&N($he,!!Ue),Hi){const Vo=mo(_t.x,we.x,!0),ch=mo(_t.y,we.y,!1);N(Bhe,!(Vo&&ch))}Fn&&(R(),_(),B(),q&&D(),N(sT,!Ee.x,!0),N(sT,!Ee.y,!1),N(Rhe,me&&!O))},{},P]},ipe=e=>{const t=_r(),{Z:n,P:s}=t,{elements:o}=n(),{padding:r,viewport:a,content:l}=o,d=c1(e),u=d?{}:e,{elements:h}=u,{padding:p,viewport:f,content:m}=h||{},g=d?e:u.target,x=HR(g),b=g.ownerDocument,C=b.documentElement,y=()=>b.defaultView||si,v=it(Jhe,[g]),w=it(h7,[g]),k=it(Fd,""),S=it(v,k,a),P=it(w,k,l),E=we=>{const Ee=Bd(we),ot=h1(we),Fe=ia(we,DR),Be=ia(we,RR);return ot.w-Ee.w>0&&!nu(Fe)||ot.h-Ee.h>0&&!nu(Be)},L=S(f),I=L===g,O=I&&x,N=!I&&P(m),_=!I&&L===N,R=O?C:L,D=O?R:g,B=!I&&w(k,r,p),V=!_&&N,ee=[V,R,B,D].map(we=>c1(we)&&!mf(we)&&we),se=we=>we&&_R(ee,we),oe=!se(R)&&E(R)?R:g,te=O?C:R,z={vt:g,ht:D,U:R,ln:B,bt:V,gt:te,Qt:O?b:R,an:x?C:oe,Kt:b,wt:x,Mt:d,L:I,un:y,yt:we=>Qk(R,Nr,we),St:(we,Ee)=>u1(R,Nr,we,Ee),Ot:()=>u1(te,Nr,Ahe,!0)},{vt:Z,ht:U,ln:Y,U:$,bt:F}=z,q=[()=>{Go(U,[Ha,fv]),Go(Z,fv),x&&Go(C,[fv,Ha])}];let ie=LC([F,$,Y,U,Z].find(we=>we&&!se(we)));const ce=O?Z:F||$,me=it(_i,q);return[z,()=>{const we=y(),Ee=DC(),ot=ht=>{ei(mf(ht),LC(ht)),tu(ht)},Fe=ht=>xn(ht,"focusin focusout focus blur",QR,{I:!0,H:!1}),Be="tabindex",ut=Yk($,Be),rt=Fe(Ee);return Or(U,Ha,I?"":jhe),Or(Y,$C,""),Or($,Nr,""),Or(F,tT,""),I||(Or($,Be,ut||"-1"),x&&Or(C,eT,"")),ei(ce,ie),ei(U,Y),ei(Y||U,!I&&$),ei($,F),Sn(q,[rt,()=>{const ht=DC(),K=se($),ae=K&&ht===$?Z:ht,ne=Fe(ae);Go(Y,$C),Go(F,tT),Go($,Nr),x&&Go(C,eT),ut?Or($,Be,ut):Go($,Be),se(F)&&ot(F),K&&ot($),se(Y)&&ot(Y),FC(ae),ne()}]),s&&!I&&(Xk($,Nr,i7),Sn(q,it(Go,$,Nr))),FC(!I&&x&&Ee===Z&&we.top===we?$:Ee),rt(),ie=0,me},me]},ope=({bt:e})=>({Zt:t,fn:n,Dt:s})=>{const{xt:o}=t||{},{$t:r}=n;e&&(o||s)&&gf(e,{[by]:r&&"100%"})},rpe=({ht:e,ln:t,U:n,L:s},o)=>{const[r,a]=xi({i:phe,o:Y5()},it(Y5,e,"padding",""));return({It:l,Zt:d,fn:u,Dt:h})=>{let[p,f]=a(h);const{P:m}=_r(),{dt:g,Ht:x,Ct:b}=d||{},{F:C}=u,[y,v]=l("paddingAbsolute");(g||f||(h||x))&&([p,f]=r(h));const k=!s&&(v||b||f);if(k){const S=!y||!t&&!m,P=p.r+p.l,E=p.t+p.b,L={[PR]:S&&!C?-P:0,[LR]:S?-E:0,[ER]:S&&C?-P:0,top:S?-p.t:0,right:S?C?-p.r:"auto":0,left:S?C?"auto":-p.l:0,[yy]:S&&`calc(100% + ${P}px)`},I={[IR]:S?p.t:0,[TR]:S?p.r:0,[MR]:S?p.b:0,[AR]:S?p.l:0};gf(t||n,L),gf(n,I),Nt(o,{ln:p,_n:!S,j:t?I:Nt({},L,I)})}return{dn:k}}},ape=(e,t)=>{const n=_r(),{ht:s,ln:o,U:r,L:a,Qt:l,gt:d,wt:u,St:h,un:p}=e,{P:f}=n,m=u&&a,g=it(i1,0),x={display:()=>!1,direction:H=>H!=="ltr",flexDirection:H=>H.endsWith("-reverse"),writingMode:H=>H!=="horizontal-tb"},b=Po(x),C={i:OR,o:{w:0,h:0}},y={i:k0,o:{}},v=H=>{h(s7,!m&&H)},w=H=>{if(!b.some(ce=>{const me=H[ce];return me&&x[ce](me)}))return{D:{x:0,y:0},M:{x:1,y:1}};v(!0);const Z=wi(d),U=h(Mhe,!0),Y=xn(l,eu,ce=>{const me=wi(d);ce.isTrusted&&me.x===Z.x&&me.y===Z.y&&XR(ce)},{I:!0,A:!0});tr(d,{x:0,y:0}),U();const $=wi(d),F=h1(d);tr(d,{x:F.w,y:F.h});const q=wi(d);tr(d,{x:q.x-$.x<1&&-F.w,y:q.y-$.y<1&&-F.h});const ie=wi(d);return tr(d,Z),py(()=>Y()),{D:$,M:ie}},k=(H,z)=>{const Z=si.devicePixelRatio%1!==0?1:0,U={w:g(H.w-z.w),h:g(H.h-z.h)};return{w:U.w>Z?U.w:0,h:U.h>Z?U.h:0}},[S,P]=xi(C,it(ej,r)),[E,L]=xi(C,it(h1,r)),[I,O]=xi(C),[N]=xi(y),[_,R]=xi(C),[D]=xi(y),[B]=xi({i:(H,z)=>vy(H,z,b),o:{}},()=>Che(r)?ia(r,b):{}),[V,ee]=xi({i:(H,z)=>k0(H.D,z.D)&&k0(H.M,z.M),o:JR()}),se=Cm(r7),oe=(H,z)=>`${z?_he:Ihe}${hhe(H)}`,te=H=>{const z=U=>[Ma,zl,eu].map(Y=>oe(Y,U)),Z=z(!0).concat(z()).join(" ");h(Z),h(Po(H).map(U=>oe(H[U],U==="x")).join(" "),!0)};return({It:H,Zt:z,fn:Z,Dt:U},{dn:Y})=>{const{dt:$,Ht:F,Ct:q,_t:ie,zt:ce}=z||{},me=se&&se.V(e,t,Z,n,H),{Y:Ie,W:we,J:Ee}=me||{},[ot,Fe]=Ghe(H,n),[Be,ut]=H("overflow"),rt=nu(Be.x),ht=nu(Be.y),K=$||Y||F||q||ce||Fe;let ae=P(U),ne=L(U),ue=O(U),be=R(U);if(Fe&&f&&h(i7,!ot),K){Qk(s,Ha,_0)&&v(!0);const[g4]=we?we():[],[xg]=ae=S(U),[yg]=ne=E(U),bg=ZR(r),vg=m&&vhe(p()),zX={w:g(yg.w+xg.w),h:g(yg.h+xg.h)},x4={w:g((vg?vg.w:bg.w+g(bg.w-yg.w))+xg.w),h:g((vg?vg.h:bg.h+g(bg.h-yg.h))+xg.h)};g4&&g4(),be=_(x4),ue=I(k(zX,x4),U)}const[ye,ke]=be,[Ue,pt]=ue,[_t,vn]=ne,[Cn,gn]=ae,[Fn,Hi]=N({x:Ue.w>0,y:Ue.h>0}),$o=rt&&ht&&(Fn.x||Fn.y)||rt&&Fn.x&&!Fn.y||ht&&Fn.y&&!Fn.x,mo=Y||q||ce||gn||vn||ke||pt||ut||Fe||K,Vo=Hhe(Fn,Be),[ch,dh]=D(Vo.k),[gg,BX]=B(U),m4=q||ie||BX||Hi||U,[$X,VX]=m4?V(w(gg),U):ee();return mo&&(dh&&te(Vo.k),Ee&&Ie&&gf(r,Ee(Vo,Z,Ie(Vo,_t,Cn)))),v(!1),u1(s,Ha,_0,$o),u1(o,$C,_0,$o),Nt(t,{k:ch,Lt:{x:ye.w,y:ye.h},Vt:{x:Ue.w,y:Ue.h},rn:Fn,Tt:whe($X,Ue)}),{en:dh,nn:ke,sn:pt,cn:VX||pt,pn:m4}}},lpe=e=>{const[t,n,s]=ipe(e),o={ln:{t:0,r:0,b:0,l:0},_n:!1,j:{[PR]:0,[LR]:0,[ER]:0,[IR]:0,[TR]:0,[MR]:0,[AR]:0},Lt:{x:0,y:0},Vt:{x:0,y:0},k:{x:zl,y:zl},rn:{x:!1,y:!1},Tt:JR()},{vt:r,gt:a,L:l,Ot:d}=t,{P:u,T:h}=_r(),p=!u&&(h.x||h.y),f=[ope(t),rpe(t,o),ape(t,o)];return[n,m=>{const g={},b=p&&wi(a),C=b&&d();return Qt(f,y=>{Nt(g,y(m,g)||{})}),tr(a,b),C&&C(),l||tr(r,0),g},o,t,s]},cpe=(e,t,n,s,o)=>{let r=!1;const a=lT(t,{}),[l,d,u,h,p]=lpe(e),[f,m,g]=Qhe(h,u,a,w=>{v({},w)}),[x,b,,C]=spe(e,t,g,u,h,o),y=w=>Po(w).some(k=>!!w[k]),v=(w,k)=>{if(n())return!1;const{vn:S,Dt:P,At:E,hn:L}=w,I=S||{},O=!!P||!r,N={It:lT(t,I,O),vn:I,Dt:O};if(L)return b(N),!1;const _=k||m(Nt({},N,{At:E})),R=d(Nt({},N,{fn:g,Zt:_}));b(Nt({},N,{Zt:_,tn:R}));const D=y(_),B=y(R),V=D||B||!Zk(I)||O;return r=!0,V&&s(w,{Zt:_,tn:R}),V};return[()=>{const{an:w,gt:k,Ot:S}=h,P=wi(w),E=[f(),l(),x()],L=S();return tr(k,P),L(),it(_i,E)},v,()=>({gn:g,bn:u}),{wn:h,yn:C},p]},sj=new WeakMap,dpe=(e,t)=>{sj.set(e,t)},upe=e=>{sj.delete(e)},p7=e=>sj.get(e),eo=(e,t,n)=>{const{nt:s}=_r(),o=c1(e),r=o?e:e.target,a=p7(r);if(t&&!a){let l=!1;const d=[],u={},h=I=>{const O=FR(I),N=Cm(khe);return N?N(O,!0):O},p=Nt({},s(),h(t)),[f,m,g]=BC(),[x,b,C]=BC(n),y=(I,O)=>{C(I,O),g(I,O)},[v,w,k,S,P]=cpe(e,p,()=>l,({vn:I,Dt:O},{Zt:N,tn:_})=>{const{dt:R,Ct:D,xt:B,Ht:V,Et:ee,_t:se}=N,{nn:oe,sn:te,en:H,cn:z}=_;y("updated",[L,{updateHints:{sizeChanged:!!R,directionChanged:!!D,heightIntrinsicChanged:!!B,overflowEdgeChanged:!!oe,overflowAmountChanged:!!te,overflowStyleChanged:!!H,scrollCoordinatesChanged:!!z,contentMutation:!!V,hostMutation:!!ee,appear:!!se},changedOptions:I||{},force:!!O}])},I=>y("scroll",[L,I])),E=I=>{upe(r),_i(d),l=!0,y("destroyed",[L,I]),m(),b()},L={options(I,O){if(I){const N=O?s():{},_=l7(p,Nt(N,h(I)));Zk(_)||(Nt(p,_),w({vn:_}))}return Nt({},p)},on:x,off:(I,O)=>{I&&O&&b(I,O)},state(){const{gn:I,bn:O}=k(),{F:N}=I,{Lt:_,Vt:R,k:D,rn:B,ln:V,_n:ee,Tt:se}=O;return Nt({},{overflowEdge:_,overflowAmount:R,overflowStyle:D,hasOverflow:B,scrollCoordinates:{start:se.D,end:se.M},padding:V,paddingAbsolute:ee,directionRTL:N,destroyed:l})},elements(){const{vt:I,ht:O,ln:N,U:_,bt:R,gt:D,Qt:B}=S.wn,{Xt:V,Gt:ee}=S.yn,se=te=>{const{kt:H,Pt:z,Ut:Z}=te;return{scrollbar:Z,track:z,handle:H}},oe=te=>{const{Yt:H,Wt:z}=te,Z=se(H[0]);return Nt({},Z,{clone:()=>{const U=se(z());return w({hn:!0}),U}})};return Nt({},{target:I,host:O,padding:N||_,viewport:_,content:R||_,scrollOffsetElement:D,scrollEventElement:B,scrollbarHorizontal:oe(V),scrollbarVertical:oe(ee)})},update:I=>w({Dt:I,At:!0}),destroy:it(E,!1),plugin:I=>u[Po(I)[0]]};return Sn(d,[P]),dpe(r,L),n7(e7,eo,[L,f,u]),epe(S.wn.wt,!o&&e.cancel)?(E(!0),L):(Sn(d,v()),y("initialized",[L]),L.update(),L)}return a};eo.plugin=e=>{const t=xr(e),n=t?e:[e],s=n.map(o=>n7(o,eo)[0]);return She(n),t?s:s[0]};eo.valid=e=>{const t=e&&e.elements,n=Ei(t)&&t();return l1(n)&&!!p7(n.target)};eo.env=()=>{const{N:e,T:t,P:n,G:s,st:o,et:r,Z:a,tt:l,nt:d,ot:u}=_r();return Nt({},{scrollbarsSize:e,scrollbarsOverlaid:t,scrollbarsHiding:n,scrollTimeline:s,staticDefaultInitialization:o,staticDefaultOptions:r,getDefaultInitialization:a,setDefaultInitialization:l,getDefaultOptions:d,setDefaultOptions:u})};eo.nonce=Khe;eo.trustedTypePolicy=xhe;eo.plugin(Whe);const rc={defer:!0,options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark",clickScroll:!0},overflow:{x:"hidden"}}},fo=({overflowX:e="hidden",overflowY:t="scroll",visibility:n="auto"})=>{const s=gt(rc);return $8(s,{options:{overflow:{y:t,x:e},scrollbars:{visibility:n,autoHide:n==="visible"?"never":"scroll"}}}),s},Ir={height:"100%",width:"100%"},hpe=()=>{if(typeof window>"u"){const u=()=>{};return[u,u]}let e,t;const n=window,s=typeof n.requestIdleCallback=="function",o=n.requestAnimationFrame,r=n.cancelAnimationFrame,a=s?n.requestIdleCallback:o,l=s?n.cancelIdleCallback:r,d=()=>{l(e),r(t)};return[(u,h)=>{d(),e=a(s?()=>{d(),t=o(u)}:u,typeof h=="object"?h:{timeout:2233})},d]},f7=e=>{const{options:t,events:n,defer:s}=e||{},[o,r]=c.useMemo(hpe,[]),a=c.useRef(null),l=c.useRef(s),d=c.useRef(t),u=c.useRef(n);return c.useEffect(()=>{l.current=s},[s]),c.useEffect(()=>{const{current:h}=a;d.current=t,eo.valid(h)&&h.options(t||{},!0)},[t]),c.useEffect(()=>{const{current:h}=a;u.current=n,eo.valid(h)&&h.on(n||{},!0)},[n]),c.useEffect(()=>()=>{var h;r(),(h=a.current)==null||h.destroy()},[]),c.useMemo(()=>[h=>{const p=a.current;if(eo.valid(p))return;const f=l.current,m=d.current||{},g=u.current||{},x=()=>a.current=eo(h,m,g);f?o(x,f):x()},()=>a.current],[])},ppe=(e,t)=>{const{element:n="div",options:s,events:o,defer:r,children:a,...l}=e,d=n,u=c.useRef(null),h=c.useRef(null),[p,f]=f7({options:s,events:o,defer:r});return c.useEffect(()=>{const{current:m}=u,{current:g}=h;if(!m)return;const x=m;return p(n==="body"?{target:x,cancel:{body:null}}:{target:x,elements:{viewport:g,content:g}}),()=>{var b;return(b=f())==null?void 0:b.destroy()}},[p,n]),c.useImperativeHandle(t,()=>({osInstance:f,getElement:()=>u.current}),[]),xe.createElement(d,{"data-overlayscrollbars-initialize":"",ref:u,...l},n==="body"?a:xe.createElement("div",{"data-overlayscrollbars-contents":"",ref:h},a))},vs=c.forwardRef(ppe),fpe={position:"absolute",top:0,left:0,right:0,bottom:0},mpe=({children:e,maxHeight:t,overflowX:n="hidden",overflowY:s="scroll"})=>{const o=c.useMemo(()=>fo({overflowX:n,overflowY:s}).options,[n,s]),[r,a]=c.useState(null);return c.useEffect(()=>{const l=r==null?void 0:r.osInstance();if(!l)return;const d=l.elements().viewport,u=d.style.overflowY;d.style.setProperty("overflow-y","scroll","important");const h=Xn(zk({element:d}),jR({element:d}));return d.style.setProperty("overflow-y",u),h},[r]),i.jsx(T,{w:"full",h:"full",maxHeight:t,position:"relative",children:i.jsx(Ce,{position:"absolute",top:0,left:0,right:0,bottom:0,children:i.jsx(vs,{ref:a,style:fpe,options:o,children:e})})})},ns=c.memo(mpe);var m7={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},dT=xe.createContext&&xe.createContext(m7),gpe=["attr","size","title"];function xpe(e,t){if(e==null)return{};var n=ype(e,t),s,o;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)s=r[o],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function ype(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function p1(){return p1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},p1.apply(this,arguments)}function uT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function f1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uT(Object(n),!0).forEach(function(s){bpe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uT(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function bpe(e,t,n){return t=vpe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vpe(e){var t=Cpe(e,"string");return typeof t=="symbol"?t:t+""}function Cpe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function g7(e){return e&&e.map((t,n)=>xe.createElement(t.tag,f1({key:n},t.attr),g7(t.child)))}function pe(e){return t=>xe.createElement(wpe,p1({attr:f1({},e.attr)},t),g7(e.child))}function wpe(e){var t=n=>{var{attr:s,size:o,title:r}=e,a=xpe(e,gpe),l=o||n.size||"1em",d;return n.className&&(d=n.className),e.className&&(d=(d?d+" ":"")+e.className),xe.createElement("svg",p1({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,a,{className:d,style:f1(f1({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),r&&xe.createElement("title",null,r),e.children)};return dT!==void 0?xe.createElement(dT.Consumer,null,n=>t(n)):t(m7)}function x7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V88a20,20,0,0,0,16,19.6V192a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V107.6A20,20,0,0,0,244,88V64A20,20,0,0,0,224,44ZM36,68H220V84H36ZM52,188V108H204v80Zm112-52a12,12,0,0,1-12,12H104a12,12,0,0,1,0-24h48A12,12,0,0,1,164,136Z"},child:[]}]})(e)}function y7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,200a12,12,0,0,1-24,0,84.09,84.09,0,0,0-84-84H61l27.52,27.51a12,12,0,0,1-17,17l-48-48a12,12,0,0,1,0-17l48-48a12,12,0,0,1,17,17L61,92h67A108.12,108.12,0,0,1,236,200Z"},child:[]}]})(e)}function Spe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function Zs(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a100,100,0,0,1-98.66,100H128a99.39,99.39,0,0,1-68.62-27.29,12,12,0,0,1,16.48-17.45,76,76,0,1,0-1.57-109c-.13.13-.25.25-.39.37L54.89,92H72a12,12,0,0,1,0,24H24a12,12,0,0,1-12-12V56a12,12,0,0,1,24,0V76.72L57.48,57.06A100,100,0,0,1,228,128Z"},child:[]}]})(e)}function kpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,152.49l-72,72a12,12,0,0,1-17,0l-72-72a12,12,0,0,1,17-17L116,187V40a12,12,0,0,1,24,0V187l51.51-51.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function jpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H69l51.52,51.51a12,12,0,0,1-17,17l-72-72a12,12,0,0,1,0-17l72-72a12,12,0,0,1,17,17L69,116H216A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function _pe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M47.51,112.49a12,12,0,0,1,17-17L116,147V32a12,12,0,0,1,24,0V147l51.51-51.52a12,12,0,0,1,17,17l-72,72a12,12,0,0,1-17,0ZM216,204H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function Ipe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,119.51a12,12,0,0,1,0,17l-72,72a12,12,0,0,1-17-17L147,140H32a12,12,0,0,1,0-24H147L95.51,64.49a12,12,0,0,1,17-17ZM216,28a12,12,0,0,0-12,12V216a12,12,0,0,0,24,0V40A12,12,0,0,0,216,28Z"},child:[]}]})(e)}function Tpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,143.51a12,12,0,0,1-17,17L140,109V224a12,12,0,0,1-24,0V109L64.49,160.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0ZM216,28H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function Ape(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.49,136.49l-72,72a12,12,0,0,1-17-17L187,140H40a12,12,0,0,1,0-24H187L135.51,64.48a12,12,0,0,1,17-17l72,72A12,12,0,0,1,224.49,136.49Z"},child:[]}]})(e)}function Sy(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,104a12,12,0,0,1-24,0V69l-59.51,59.51a12,12,0,0,1-17-17L187,52H152a12,12,0,0,1,0-24h64a12,12,0,0,1,12,12Zm-44,24a12,12,0,0,0-12,12v64H52V84h64a12,12,0,0,0,0-24H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V140A12,12,0,0,0,184,128Z"},child:[]}]})(e)}function b7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,120.49a12,12,0,0,1-17,0L140,69V216a12,12,0,0,1-24,0V69L64.49,120.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0l72,72A12,12,0,0,1,208.49,120.49Z"},child:[]}]})(e)}function Mpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V96a12,12,0,0,1-12,12H168a12,12,0,0,1,0-24h19l-7.8-7.8a75.55,75.55,0,0,0-53.32-22.26h-.43A75.49,75.49,0,0,0,72.39,75.57,12,12,0,1,1,55.61,58.41a99.38,99.38,0,0,1,69.87-28.47H126A99.42,99.42,0,0,1,196.2,59.23L204,67V48a12,12,0,0,1,24,0ZM183.61,180.43a75.49,75.49,0,0,1-53.09,21.63h-.43A75.55,75.55,0,0,1,76.77,179.8L69,172H88a12,12,0,0,0,0-24H40a12,12,0,0,0-12,12v48a12,12,0,0,0,24,0V189l7.8,7.8A99.42,99.42,0,0,0,130,226.06h.56a99.38,99.38,0,0,0,69.87-28.47,12,12,0,0,0-16.78-17.16Z"},child:[]}]})(e)}function m1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"},child:[]}]})(e)}function Epe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120.49,167.51a12,12,0,0,1,0,17l-32,32a12,12,0,0,1-17,0l-32-32a12,12,0,1,1,17-17L68,179V48a12,12,0,0,1,24,0V179l11.51-11.52A12,12,0,0,1,120.49,167.51Zm96-96-32-32a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17L164,77V208a12,12,0,0,0,24,0V77l11.51,11.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function Ppe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM119.51,96.49a12,12,0,0,0,17,0l32-32a12,12,0,0,0-17-17L140,59V16a12,12,0,0,0-24,0V59L104.49,47.51a12,12,0,0,0-17,17Zm17,63a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17L116,197v43a12,12,0,0,0,24,0V197l11.51,11.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function Lpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},child:[]}]})(e)}function ky(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M220,48V96a12,12,0,0,1-24,0V77l-35.51,35.52a12,12,0,0,1-17-17L179,60H160a12,12,0,0,1,0-24h48A12,12,0,0,1,220,48ZM95.51,143.51,60,179V160a12,12,0,0,0-24,0v48a12,12,0,0,0,12,12H96a12,12,0,0,0,0-24H77l35.52-35.51a12,12,0,0,0-17-17ZM208,148a12,12,0,0,0-12,12v19l-35.51-35.52a12,12,0,0,0-17,17L179,196H160a12,12,0,0,0,0,24h48a12,12,0,0,0,12-12V160A12,12,0,0,0,208,148ZM77,60H96a12,12,0,0,0,0-24H48A12,12,0,0,0,36,48V96a12,12,0,0,0,24,0V77l35.51,35.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function Dpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM104.49,56.48,116,45V88a12,12,0,0,0,24,0V45l11.51,11.51a12,12,0,0,0,17-17l-32-32a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17Zm47,143L140,211V168a12,12,0,0,0-24,0v43l-11.51-11.52a12,12,0,0,0-17,17l32,32a12,12,0,0,0,17,0l32-32a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function v7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.29,182.17a12,12,0,0,1-16.47,4.12L140,149.19V216a12,12,0,0,1-24,0V149.19l-61.82,37.1a12,12,0,1,1-12.35-20.58L104.68,128,41.83,90.29A12,12,0,1,1,54.18,69.71L116,106.81V40a12,12,0,0,1,24,0v66.81l61.82-37.1a12,12,0,1,1,12.35,20.58L151.32,128l62.85,37.71A12,12,0,0,1,218.29,182.17Z"},child:[]}]})(e)}function Rpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,28H72A20,20,0,0,0,52,48V224a12,12,0,0,0,18.36,10.18l57.63-36,57.65,36A12,12,0,0,0,204,224V48A20,20,0,0,0,184,28Zm-4,174.35-45.65-28.53a12,12,0,0,0-12.72,0L76,202.35V52H180Z"},child:[]}]})(e)}function pl(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,100a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H176a20,20,0,0,0-20,20v4H100V48A20,20,0,0,0,80,28H48A20,20,0,0,0,28,48V80a20,20,0,0,0,20,20h4v56H48a20,20,0,0,0-20,20v32a20,20,0,0,0,20,20H80a20,20,0,0,0,20-20v-4h56v4a20,20,0,0,0,20,20h32a20,20,0,0,0,20-20V176a20,20,0,0,0-20-20h-4V100ZM180,52h24V76H180ZM52,52H76V76H52ZM76,204H52V180H76Zm128,0H180V180h24Zm-24-48h-4a20,20,0,0,0-20,20v4H100v-4a20,20,0,0,0-20-20H76V100h4a20,20,0,0,0,20-20V76h56v4a20,20,0,0,0,20,20h4Z"},child:[]}]})(e)}function Ope(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M54.8,119.49A35.06,35.06,0,0,1,49.05,128a35.06,35.06,0,0,1,5.75,8.51C60,147.24,60,159.83,60,172c0,25.94,1.84,32,20,32a12,12,0,0,1,0,24c-19.14,0-32.2-6.9-38.8-20.51C36,196.76,36,184.17,36,172c0-25.94-1.84-32-20-32a12,12,0,0,1,0-24c18.16,0,20-6.06,20-32,0-12.17,0-24.76,5.2-35.49C47.8,34.9,60.86,28,80,28a12,12,0,0,1,0,24c-18.16,0-20,6.06-20,32C60,96.17,60,108.76,54.8,119.49ZM240,116c-18.16,0-20-6.06-20-32,0-12.17,0-24.76-5.2-35.49C208.2,34.9,195.14,28,176,28a12,12,0,0,0,0,24c18.16,0,20,6.06,20,32,0,12.17,0,24.76,5.2,35.49A35.06,35.06,0,0,0,207,128a35.06,35.06,0,0,0-5.75,8.51C196,147.24,196,159.83,196,172c0,25.94-1.84,32-20,32a12,12,0,0,0,0,24c19.14,0,32.2-6.9,38.8-20.51C220,196.76,220,184.17,220,172c0-25.94,1.84-32,20-32a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function Npe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.24,213.21C216.12,203,204,180.64,204,152V134.73a19.94,19.94,0,0,0-12.62-18.59l-24.86-9.81a4,4,0,0,1-2.26-5.14l21.33-53A32,32,0,0,0,167.17,6,32.13,32.13,0,0,0,126.25,24.2l-.07.18-21,53.09a3.94,3.94,0,0,1-2.14,2.2,3.89,3.89,0,0,1-3,.06L74.6,69.43A19.89,19.89,0,0,0,52.87,74C31.06,96.43,20,122.68,20,152a115.46,115.46,0,0,0,32.29,80.3A12,12,0,0,0,61,236H232a12,12,0,0,0,5.24-22.79ZM68.19,92.73,91.06,102A28,28,0,0,0,127.5,86.31l20.95-53a8.32,8.32,0,0,1,10.33-4.81,8,8,0,0,1,4.61,10.57,1.17,1.17,0,0,0,0,.11L142,92.29a28.05,28.05,0,0,0,15.68,36.33L180,137.45V152c0,1,0,2.07.05,3.1l-122.44-49A101.91,101.91,0,0,1,68.19,92.73ZM116.74,212a83.73,83.73,0,0,1-22.09-39,12,12,0,0,0-23.25,6,110.27,110.27,0,0,0,14.49,33H66.25A91.53,91.53,0,0,1,44,152a84,84,0,0,1,3.41-24.11l136.67,54.66A86.58,86.58,0,0,0,198.66,212Z"},child:[]}]})(e)}function Fpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,160a12,12,0,0,0,0-24H212V120h12a12,12,0,0,0,0-24H210.45a83.7,83.7,0,0,0-18.78-38.7l16.82-16.81a12,12,0,1,0-17-17l-18,18a83.7,83.7,0,0,0-91.1,0l-18-18a12,12,0,0,0-17,17L64.33,57.3A83.7,83.7,0,0,0,45.55,96H32a12,12,0,0,0,0,24H44v16H32a12,12,0,0,0,0,24H44a83.55,83.55,0,0,0,1.55,16H32a12,12,0,0,0,0,24H54.15a84,84,0,0,0,147.7,0H224a12,12,0,0,0,0-24H210.45A83.55,83.55,0,0,0,212,160ZM128,52a60.1,60.1,0,0,1,57.82,44H70.18A60.1,60.1,0,0,1,128,52Zm12,166.79V148a12,12,0,0,0-24,0v70.79A60.09,60.09,0,0,1,68,160V120H188v40A60.09,60.09,0,0,1,140,218.79Z"},child:[]}]})(e)}function Bi(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,104.49l-80,80a12,12,0,0,1-17,0l-80-80a12,12,0,0,1,17-17L128,159l71.51-71.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function ij(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M168.49,199.51a12,12,0,0,1-17,17l-80-80a12,12,0,0,1,0-17l80-80a12,12,0,0,1,17,17L97,128Z"},child:[]}]})(e)}function jy(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"},child:[]}]})(e)}function C7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,168.49a12,12,0,0,1-17,0L128,97,56.49,168.49a12,12,0,0,1-17-17l80-80a12,12,0,0,1,17,0l80,80A12,12,0,0,1,216.49,168.49Z"},child:[]}]})(e)}function wm(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function Bpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Z"},child:[]}]})(e)}function $pe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,128a108,108,0,0,1-216,0c0-42.52,24.73-81.34,63-98.9A12,12,0,1,1,93,50.91C63.24,64.57,44,94.83,44,128a84,84,0,0,0,168,0c0-33.17-19.24-63.43-49-77.09A12,12,0,1,1,173,29.1C211.27,46.66,236,85.48,236,128Z"},child:[]}]})(e)}function w7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM52,52H76v95.22a24,24,0,1,0,24,0V125l40,40v39H52ZM204,204H164V160a12,12,0,0,0-3.51-8.49L100,91V52h24V72a12,12,0,0,0,3.51,8.49l17.31,17.3a24,24,0,1,0,17-17L148,67V52h56Z"},child:[]}]})(e)}function Vpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.68,97.22,34.74,128l36.94,30.78a12,12,0,1,1-15.36,18.44l-48-40a12,12,0,0,1,0-18.44l48-40A12,12,0,0,1,71.68,97.22Zm176,21.56-48-40a12,12,0,1,0-15.36,18.44L221.26,128l-36.94,30.78a12,12,0,1,0,15.36,18.44l48-40a12,12,0,0,0,0-18.44ZM164.1,28.72a12,12,0,0,0-15.38,7.18l-64,176a12,12,0,0,0,7.18,15.37A11.79,11.79,0,0,0,96,228a12,12,0,0,0,11.28-7.9l64-176A12,12,0,0,0,164.1,28.72Z"},child:[]}]})(e)}function pn(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,28H88A12,12,0,0,0,76,40V76H40A12,12,0,0,0,28,88V216a12,12,0,0,0,12,12H168a12,12,0,0,0,12-12V180h36a12,12,0,0,0,12-12V40A12,12,0,0,0,216,28ZM156,204H52V100H156Zm48-48H180V88a12,12,0,0,0-12-12H100V52H204Z"},child:[]}]})(e)}function S7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,192a12,12,0,0,1-12,12H204v28a12,12,0,0,1-24,0V204H64a12,12,0,0,1-12-12V76H24a12,12,0,0,1,0-24H52V24a12,12,0,0,1,24,0V180H232A12,12,0,0,1,244,192ZM104,76h76v76a12,12,0,0,0,24,0V64a12,12,0,0,0-12-12H104a12,12,0,0,0,0,24Z"},child:[]}]})(e)}function k7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.6,62.64l-88-48.17a19.91,19.91,0,0,0-19.2,0l-88,48.17A20,20,0,0,0,20,80.19v95.62a20,20,0,0,0,10.4,17.55l88,48.17a19.89,19.89,0,0,0,19.2,0l88-48.17A20,20,0,0,0,236,175.81V80.19A20,20,0,0,0,225.6,62.64ZM128,36.57,200,76,128,115.4,56,76ZM44,96.79l72,39.4v76.67L44,173.44Zm96,116.07V136.19l72-39.4v76.65Z"},child:[]}]})(e)}function zpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.15,179.17l-46.83-46.82,37.93-13.51.76-.3a20,20,0,0,0-1.76-37.27L54.16,29A20,20,0,0,0,29,54.16L81.27,214.24A20,20,0,0,0,118.54,216c.11-.25.21-.5.3-.76l13.51-37.92,46.83,46.82a20,20,0,0,0,28.28,0l16.69-16.68A20,20,0,0,0,224.15,179.17Zm-30.83,25.17-48.48-48.48A20,20,0,0,0,130.7,150a20.66,20.66,0,0,0-3.74.35A20,20,0,0,0,112.35,162c-.11.25-.21.5-.3.76L100.4,195.5,54.29,54.29l141.21,46.1-32.71,11.66c-.26.09-.51.19-.76.3a20,20,0,0,0-6.17,32.48h0l48.49,48.48Z"},child:[]}]})(e)}function j7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM60,112a16,16,0,1,0,16,16A16,16,0,0,0,60,112Zm136,0a16,16,0,1,0,16,16A16,16,0,0,0,196,112Z"},child:[]}]})(e)}function _7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.51,88.49a12,12,0,0,1,17-17L116,99V24a12,12,0,0,1,24,0V99l27.51-27.52a12,12,0,0,1,17,17l-48,48a12,12,0,0,1-17,0ZM224,116H188a12,12,0,0,0,0,24h32v56H36V140H68a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116Zm-20,52a16,16,0,1,0-16,16A16,16,0,0,0,204,168Z"},child:[]}]})(e)}function Lu(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0Zm-108.49,8.49a12,12,0,0,0,17,0l40-40a12,12,0,0,0-17-17L140,115V32a12,12,0,0,0-24,0v83L96.49,95.51a12,12,0,0,0-17,17Z"},child:[]}]})(e)}function Gpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M134.88,6.17a12,12,0,0,0-13.76,0,259,259,0,0,0-42.18,39C50.85,77.43,36,111.63,36,144a92,92,0,0,0,184,0C220,66.64,138.36,8.6,134.88,6.17ZM194.08,160H140V144h56A68,68,0,0,1,194.08,160ZM140,120V104h47a115,115,0,0,1,5.68,16Zm19.3-58.71A197.29,197.29,0,0,1,173.68,80H140V41.46A243.5,243.5,0,0,1,159.3,61.29ZM60,144c0-33.31,20-63.37,36.7-82.71A243.5,243.5,0,0,1,116,41.46V210.92A68.1,68.1,0,0,1,60,144Zm80,66.92V184h42.94A68,68,0,0,1,140,210.92Z"},child:[]}]})(e)}function Hpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,204H141l86.84-86.84a28,28,0,0,0,0-39.6L186.43,36.19a28,28,0,0,0-39.6,0L28.19,154.82a28,28,0,0,0,0,39.6l30.06,30.07A12,12,0,0,0,66.74,228H216a12,12,0,0,0,0-24ZM163.8,53.16a4,4,0,0,1,5.66,0l41.38,41.38a4,4,0,0,1,0,5.65L160,151l-47-47ZM71.71,204,45.16,177.45a4,4,0,0,1,0-5.65L96,121l47,47-36,36Z"},child:[]}]})(e)}function I7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M148,200a20,20,0,1,1-20-20A20,20,0,0,1,148,200Zm-20-40a12,12,0,0,0,12-12V48a12,12,0,0,0-24,0V148A12,12,0,0,0,128,160Z"},child:[]}]})(e)}function Du(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M251,123.13c-.37-.81-9.13-20.26-28.48-39.61C196.63,57.67,164,44,128,44S59.37,57.67,33.51,83.52C14.16,102.87,5.4,122.32,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212s68.63-13.66,94.48-39.51c19.36-19.35,28.12-38.79,28.49-39.61A12.08,12.08,0,0,0,251,123.13Zm-46.06,33C183.47,177.27,157.59,188,128,188s-55.47-10.73-76.91-31.88A130.36,130.36,0,0,1,29.52,128,130.45,130.45,0,0,1,51.09,99.89C72.54,78.73,98.41,68,128,68s55.46,10.73,76.91,31.89A130.36,130.36,0,0,1,226.48,128,130.45,130.45,0,0,1,204.91,156.12ZM128,84a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function Wpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.42,162A12,12,0,1,1,213.58,174l-16.86-29.5a127.19,127.19,0,0,1-30.17,13.86L171.84,190a12,12,0,0,1-9.87,13.8,11.22,11.22,0,0,1-2,.17,12,12,0,0,1-11.82-10L143,163.17a136.5,136.5,0,0,1-30.06,0L107.84,194A12,12,0,0,1,96,204a11.22,11.22,0,0,1-2-.17A12,12,0,0,1,84.16,190l5.29-31.72a127.19,127.19,0,0,1-30.17-13.86L42.42,174A12,12,0,1,1,21.58,162L40,129.85a159.73,159.73,0,0,1-17.31-18.31A12,12,0,0,1,41.34,96.46C57.38,116.32,85.44,140,128,140s70.62-23.68,86.66-43.54a12,12,0,0,1,18.67,15.08A159.73,159.73,0,0,1,216,129.85Z"},child:[]}]})(e)}function Upe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M56.88,31.93A12,12,0,1,0,39.12,48.07l16,17.65C20.67,88.66,5.72,121.58,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212a131.34,131.34,0,0,0,51-10l20.09,22.1a12,12,0,0,0,17.76-16.14ZM128,188c-29.59,0-55.47-10.73-76.91-31.88A130.69,130.69,0,0,1,29.52,128c5.27-9.31,18.79-29.9,42-44.29l90.09,99.11A109.33,109.33,0,0,1,128,188Zm123-55.12c-.36.81-9,20-28,39.16a12,12,0,1,1-17-16.9A130.48,130.48,0,0,0,226.48,128a130.36,130.36,0,0,0-21.57-28.12C183.46,78.73,157.59,68,128,68c-3.35,0-6.7.14-10,.42a12,12,0,1,1-2-23.91c3.93-.34,8-.51,12-.51,36,0,68.63,13.67,94.49,39.52,19.35,19.35,28.11,38.8,28.48,39.61A12.08,12.08,0,0,1,251,132.88Z"},child:[]}]})(e)}function qpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,67.24a39.77,39.77,0,0,0-12.51-28.52C199.91,24,174.71,24.5,159.29,39.93L142.48,56.84a28,28,0,0,0-35.64,3.29l-9,9a20,20,0,0,0-.73,27.49L48.9,144.84A43.76,43.76,0,0,0,37,185.28l-7.5,17.19a17.66,17.66,0,0,0,3.71,19.65,19.9,19.9,0,0,0,22.15,4.19l16.31-7.13a43.88,43.88,0,0,0,39.45-12.09l48.24-48.26a20,20,0,0,0,27.47-.73l9-9a28.06,28.06,0,0,0,3.26-35.72l17.23-17.33A39.69,39.69,0,0,0,228,67.24ZM94.15,190.11a20,20,0,0,1-20,5,11.93,11.93,0,0,0-8.32.47L57,199.38,60.69,191a12,12,0,0,0,.37-8.64,19.92,19.92,0,0,1,4.81-20.55l48.2-48.22,28.28,28.3Zm105.14-111-25.37,25.52a12,12,0,0,0,0,16.95l4.88,4.89a4,4,0,0,1,0,5.66l-6.14,6.15-55-55.05,6.14-6.14a4,4,0,0,1,5.65,0L134.35,82a12,12,0,0,0,8.49,3.51h0A12,12,0,0,0,151.34,82l24.94-25.08c6.3-6.3,16.48-6.63,22.71-.74a16,16,0,0,1,.3,23Z"},child:[]}]})(e)}function Mg(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Z"},child:[]}]})(e)}function xf(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.51l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.51ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm104-60a12,12,0,0,1-12,12H140v12a12,12,0,0,1-24,0V164H104a12,12,0,0,1,0-24h12V128a12,12,0,0,1,24,0v12h12A12,12,0,0,1,164,152Z"},child:[]}]})(e)}function oj(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.15,197.71,164,95.81V44h4a12,12,0,0,0,0-24H88a12,12,0,0,0,0,24h4V95.81L30.85,197.71A20,20,0,0,0,48,228H208a20,20,0,0,0,17.15-30.29ZM140,44V99.14a12,12,0,0,0,1.71,6.17l35.13,58.54c-10.79.86-25.15-1.31-43.42-10.56-14-7.08-27.46-11.33-40.27-12.76l21.14-35.22A12,12,0,0,0,116,99.14V44ZM55.06,204,79,164.19c13-1.11,27.62,2.42,43.62,10.52,19.61,9.92,36.25,13.31,49.85,13.31A75.44,75.44,0,0,0,190.11,186l10.83,18Z"},child:[]}]})(e)}function ar(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M222.14,69.17,186.83,33.86A19.86,19.86,0,0,0,172.69,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V83.31A19.86,19.86,0,0,0,222.14,69.17ZM164,204H92V160h72Zm40,0H188V156a20,20,0,0,0-20-20H88a20,20,0,0,0-20,20v48H52V52H171l33,33ZM164,84a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h56A12,12,0,0,1,164,84Z"},child:[]}]})(e)}function _y(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M248.49,71.51l-32-32a12,12,0,0,0-17,17L211,68h-3c-52,0-64.8,30.71-75.08,55.38-8.82,21.17-15.45,37.05-42.75,40.09a44,44,0,1,0,.28,24.08c43.34-3.87,55.07-32,64.63-54.93C164.9,109,172,92,208,92h3l-11.52,11.51a12,12,0,0,0,17,17l32-32A12,12,0,0,0,248.49,71.51ZM48,196a20,20,0,1,1,20-20A20,20,0,0,1,48,196Z"},child:[]}]})(e)}function T7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,56H160L133.33,36a20.12,20.12,0,0,0-12-4H76A20,20,0,0,0,56,52V72H36A20,20,0,0,0,16,92V204a20,20,0,0,0,20,20H188.89A19.13,19.13,0,0,0,208,204.89V184h20.89A19.13,19.13,0,0,0,248,164.89V76A20,20,0,0,0,228,56ZM184,200H40V96H80l28.8,21.6A12,12,0,0,0,116,120h68Zm40-40H208V116a20,20,0,0,0-20-20H120L93.33,76a20.12,20.12,0,0,0-12-4H80V56h40l28.8,21.6A12,12,0,0,0,156,80h68Z"},child:[]}]})(e)}function Sm(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,88a12,12,0,0,1,12-12h32a12,12,0,0,1,12,12v32a12,12,0,0,1-24,0V100H152A12,12,0,0,1,140,88ZM72,180h32a12,12,0,0,0,0-24H84V136a12,12,0,0,0-24,0v32A12,12,0,0,0,72,180ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},child:[]}]})(e)}function Kpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},child:[]}]})(e)}function Zpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,116H219.22A92.21,92.21,0,0,0,140,36.78V16a12,12,0,0,0-24,0V36.78A92.21,92.21,0,0,0,36.78,116H16a12,12,0,0,0,0,24H36.78A92.21,92.21,0,0,0,116,219.22V240a12,12,0,0,0,24,0V219.22A92.21,92.21,0,0,0,219.22,140H240a12,12,0,0,0,0-24ZM128,196a68,68,0,1,1,68-68A68.07,68.07,0,0,1,128,196Zm0-112a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function A7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M250.18,105.17,186.71,41.25a100.11,100.11,0,0,0-141.43,0l-.13.14L31.37,55.61a12,12,0,1,0,17.24,16.7L62.32,58.16A75.68,75.68,0,0,1,77.49,46.43L119,88,25.85,181.16a20,20,0,0,0,0,28.29l20.69,20.69a20,20,0,0,0,28.28,0L168,137l1.51,1.51h0l23.65,23.66a20,20,0,0,0,28.29,0l28.69-28.7A20,20,0,0,0,250.18,105.17ZM60.68,210.34l-15-15L108,133l15,15ZM140,131l-15-15,19.51-19.51a12,12,0,0,0,0-17L102.24,37.24a75.94,75.94,0,0,1,67.47,20.95l31.44,31.67L178,113l-1.51-1.51a12,12,0,0,0-17,0Zm67.32,11.31L195,130l23.09-23.09,12.3,12.39Z"},child:[]}]})(e)}function Ype(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,44a32,32,0,0,0-8,1V44a32,32,0,0,0-60.79-14A32,32,0,0,0,76,60v50.83a32,32,0,0,0-52,36.7C55.82,214.6,75.35,244,128,244a92.1,92.1,0,0,0,92-92V76A32,32,0,0,0,188,44Zm8,108a68.08,68.08,0,0,1-68,68c-35.83,0-49.71-14-82.48-83.14-.14-.29-.29-.58-.45-.86a8,8,0,0,1,13.85-8l.21.35,18.68,30A12,12,0,0,0,100,152V60a8,8,0,0,1,16,0v60a12,12,0,0,0,24,0V44a8,8,0,0,1,16,0v76a12,12,0,0,0,24,0V76a8,8,0,0,1,16,0Z"},child:[]}]})(e)}function Xpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,20H72A20,20,0,0,0,52,40V76a20.1,20.1,0,0,0,8,16l48,36L60,164a20.1,20.1,0,0,0-8,16v36a20,20,0,0,0,20,20H184a20,20,0,0,0,20-20V180.36a20.13,20.13,0,0,0-7.94-16L147.9,128l48.16-36.4a20.13,20.13,0,0,0,7.94-16V40A20,20,0,0,0,184,20Zm-4,24V60H76V44Zm-52,69L89.33,84h77Zm52,99H76V182l52-39,52,39.33Z"},child:[]}]})(e)}function su(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,96a16,16,0,1,1,16,16A16,16,0,0,1,144,96Zm92-40V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56ZM44,60v79.72l33.86-33.86a20,20,0,0,1,28.28,0L147.31,147l17.18-17.17a20,20,0,0,1,28.28,0L212,149.09V60Zm0,136H162.34L92,125.66l-48,48Zm168,0V183l-33.37-33.37L164.28,164l32,32Z"},child:[]}]})(e)}function M7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M160,88a16,16,0,1,1,16,16A16,16,0,0,1,160,88Zm76-32V160a20,20,0,0,1-20,20H204v20a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V88A20,20,0,0,1,40,68H60V56A20,20,0,0,1,80,36H216A20,20,0,0,1,236,56ZM180,180H80a20,20,0,0,1-20-20V92H44V196H180Zm-21.66-24L124,121.66,89.66,156ZM212,60H84v67.72l25.86-25.86a20,20,0,0,1,28.28,0L192.28,156H212Z"},child:[]}]})(e)}function Qpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H88A20,20,0,0,0,68,48V60H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V188h12a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM92,52H204v59.72l-9.86-9.86a20,20,0,0,0-28.28,0L103.72,164H92Zm80,152H52V84H68v84a20,20,0,0,0,20,20h84Zm-34.34-40L180,121.66l24,24V164ZM108,88a20,20,0,1,1,20,20A20,20,0,0,1,108,88Z"},child:[]}]})(e)}function Ru(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M108,84a16,16,0,1,1,16,16A16,16,0,0,1,108,84Zm128,44A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Zm-72,36.68V132a20,20,0,0,0-20-20,12,12,0,0,0-4,23.32V168a20,20,0,0,0,20,20,12,12,0,0,0,4-23.32Z"},child:[]}]})(e)}function Jpe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V192a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V64A20,20,0,0,0,224,44Zm-4,144H36V68H220ZM52,128a12,12,0,0,1,12-12H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,128Zm0-36A12,12,0,0,1,64,80H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,92Zm0,72a12,12,0,0,1,12-12h8a12,12,0,0,1,0,24H64A12,12,0,0,1,52,164Zm108,0a12,12,0,0,1-12,12H108a12,12,0,0,1,0-24h40A12,12,0,0,1,160,164Zm44,0a12,12,0,0,1-12,12h-8a12,12,0,0,1,0-24h8A12,12,0,0,1,204,164Z"},child:[]}]})(e)}function efe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M180,232a12,12,0,0,1-12,12H88a12,12,0,0,1,0-24h80A12,12,0,0,1,180,232Zm40-128a92.47,92.47,0,0,1-37,73.73,7.81,7.81,0,0,0-3,6.27,20,20,0,0,1-20,20H96a20,20,0,0,1-20-20v-.23a7.76,7.76,0,0,0-3.25-6.2,91.36,91.36,0,0,1-36.75-73C35.73,54.69,76,13.2,125.79,12A92,92,0,0,1,220,104Zm-24,0a68,68,0,0,0-69.65-68C89.56,36.89,59.8,67.56,60,104.39a67.52,67.52,0,0,0,27.18,54h0A32.14,32.14,0,0,1,99.77,180H116V149L87.51,120.49a12,12,0,0,1,17-17L128,127l23.51-23.51a12,12,0,0,1,17,17L140,149v31h16.25a31.89,31.89,0,0,1,12.41-21.49A67.45,67.45,0,0,0,196,104Z"},child:[]}]})(e)}function tfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M87.5,151.52l64-64a12,12,0,0,1,17,17l-64,64a12,12,0,0,1-17-17Zm131-114a60.08,60.08,0,0,0-84.87,0L103.51,67.61a12,12,0,0,0,17,17l30.07-30.06a36,36,0,0,1,50.93,50.92L171.4,135.52a12,12,0,1,0,17,17l30.08-30.06A60.09,60.09,0,0,0,218.45,37.55ZM135.52,171.4l-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function nfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.45,122.43l-30.08,30.06a12,12,0,0,1-17-17l30.08-30.07a36,36,0,0,0-50.93-50.92L120.48,84.59a12,12,0,0,1-17-17l30.07-30.06a60,60,0,0,1,84.87,84.88Zm-82.93,49-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function sfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM40,76H216a12,12,0,0,0,0-24H40a12,12,0,0,0,0,24ZM216,180H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function ife(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H180V56A52,52,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76ZM100,56a28,28,0,0,1,56,0V76H100ZM204,204H52V100H204Zm-60-52a16,16,0,1,1-16-16A16,16,0,0,1,144,152Z"},child:[]}]})(e)}function ofe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H100V56a28,28,0,0,1,28-28c13.51,0,25.65,9.62,28.24,22.39a12,12,0,1,0,23.52-4.78C174.87,21.5,153.1,4,128,4A52.06,52.06,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76Zm-4,128H52V100H204Zm-92-52a16,16,0,1,1,16,16A16,16,0,0,1,112,152Z"},child:[]}]})(e)}function E7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H100V56a28,28,0,0,1,28-28c13.51,0,25.65,9.62,28.24,22.39a12,12,0,1,0,23.52-4.78C174.87,21.5,153.1,4,128,4A52.06,52.06,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76Zm-4,128H52V100H204Z"},child:[]}]})(e)}function P7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},child:[]}]})(e)}function L7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H80a12,12,0,0,1,0-24h64A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function D7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H124v20a12,12,0,0,1-24,0V124H80a12,12,0,0,1,0-24h20V80a12,12,0,0,1,24,0v20h20A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function rfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,60a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,60Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,124Zm0-112a92.1,92.1,0,0,0-92,92c0,77.36,81.64,135.4,85.12,137.83a12,12,0,0,0,13.76,0,259,259,0,0,0,42.18-39C205.15,170.57,220,136.37,220,104A92.1,92.1,0,0,0,128,12Zm31.3,174.71A249.35,249.35,0,0,1,128,216.89a249.35,249.35,0,0,1-31.3-30.18C80,167.37,60,137.31,60,104a68,68,0,0,1,136,0C196,137.31,176,167.37,159.3,186.71Z"},child:[]}]})(e)}function afe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M84,108A12,12,0,0,1,96,96h64a12,12,0,0,1,0,24H96A12,12,0,0,1,84,108Zm32,28H96a12,12,0,0,0,0,24h20a12,12,0,0,0,0-24ZM228,48V156.69a19.86,19.86,0,0,1-5.86,14.14l-51.31,51.31A19.86,19.86,0,0,1,156.69,228H48a20,20,0,0,1-20-20V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48ZM52,204h92V156a12,12,0,0,1,12-12h48V52H52Zm139-36H168v23Z"},child:[]}]})(e)}function rj(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,32a12,12,0,0,0-12-12c-44.78,0-90,48.54-115.9,82a64,64,0,0,0-80,62c0,12-3.1,22.71-9.23,31.76A43,43,0,0,1,9.4,206.05a11.88,11.88,0,0,0-4.91,13.38A12.07,12.07,0,0,0,16.11,228h76A64,64,0,0,0,154,148C187.49,122.05,236,76.8,236,32ZM209.62,46.39c-4,12.92-13.15,27.49-26.92,42.91-3,3.39-6.16,6.7-9.35,9.89a104.31,104.31,0,0,0-16.5-16.51c3.19-3.19,6.49-6.32,9.88-9.35C182.15,59.55,196.71,50.43,209.62,46.39ZM92.07,204H42a80.17,80.17,0,0,0,10.14-40,40,40,0,1,1,40,40Zm38.18-91.32c3.12-3.93,6.55-8.09,10.23-12.35a80.52,80.52,0,0,1,15.23,15.24c-4.26,3.68-8.42,7.11-12.35,10.23A64.43,64.43,0,0,0,130.25,112.68Z"},child:[]}]})(e)}function Iy(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M230.14,70.54,185.46,25.85a20,20,0,0,0-28.29,0L33.86,149.17A19.85,19.85,0,0,0,28,163.31V208a20,20,0,0,0,20,20H92.69a19.86,19.86,0,0,0,14.14-5.86L230.14,98.82a20,20,0,0,0,0-28.28ZM93,180l71-71,11,11-71,71ZM76,163,65,152l71-71,11,11ZM52,173l15.51,15.51h0L83,204H52ZM192,103,153,64l18.34-18.34,39,39Z"},child:[]}]})(e)}function R7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M255.62,51.65a12,12,0,0,0-11.27-11.27c-53.27-3.13-96.2,13.36-114.84,44.14-12.14,20-12.56,44.17-1.46,67.3a75.14,75.14,0,0,0-12.28,23l-12.66-12.66c7.19-16.77,6.43-34.11-2.4-48.69C86.73,90.36,54.89,78,15.55,80.27A12,12,0,0,0,4.28,91.55C2,130.89,14.36,162.73,37.45,176.71a49.76,49.76,0,0,0,26,7.27,57.54,57.54,0,0,0,22.7-4.87L112,205v23a12,12,0,0,0,24,0V198.51a51.63,51.63,0,0,1,9.49-29.95,76.82,76.82,0,0,0,32.1,7.39,64.91,64.91,0,0,0,33.89-9.46C242.25,147.85,258.76,104.92,255.62,51.65ZM49.88,156.18c-13.19-8-21.18-27.46-21.83-52.13,24.67.65,44.14,8.64,52.13,21.83a26,26,0,0,1,3.63,17L72.48,131.51a12,12,0,0,0-17,17l11.34,11.34A26.27,26.27,0,0,1,49.88,156.18ZM199.05,146c-10.66,6.45-23,7.67-35.81,3.76l37.25-37.24a12,12,0,0,0-17-17l-37.25,37.24C142.37,120,143.59,107.61,150,97c12.7-21,42.65-33,81.32-33H232C232.14,103,220.14,133.18,199.05,146Z"},child:[]}]})(e)}function Vt(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function O7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M28,64A12,12,0,0,1,40,52H216a12,12,0,0,1,0,24H40A12,12,0,0,1,28,64Zm104,52H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm0,64H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm120-20a12,12,0,0,1-5.64,10.18l-64,40A12,12,0,0,1,164,200V120a12,12,0,0,1,18.36-10.18l64,40A12,12,0,0,1,252,160Zm-34.64,0L188,141.65v36.7Z"},child:[]}]})(e)}function N7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M100,52H40A20,20,0,0,0,20,72v64a20,20,0,0,0,20,20H96v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,100,52Zm-4,80H44V76H96ZM216,52H156a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20h56v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,216,52Zm-4,80H160V76h52Z"},child:[]}]})(e)}function lfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,36H40A20,20,0,0,0,20,56V200a20,20,0,0,0,20,20H216a20,20,0,0,0,20-20V56A20,20,0,0,0,216,36Zm-4,160H44V60H212Z"},child:[]}]})(e)}function cfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,108H48a12,12,0,0,0-12,12v88a12,12,0,0,0,12,12h88a12,12,0,0,0,12-12V120A12,12,0,0,0,136,108Zm-12,88H60V132h64Zm96-8v12a20,20,0,0,1-20,20H180a12,12,0,0,1,0-24h16v-8a12,12,0,0,1,24,0Zm0-72v24a12,12,0,0,1-24,0V116a12,12,0,0,1,24,0Zm0-60V72a12,12,0,0,1-24,0V60H184a12,12,0,0,1,0-24h16A20,20,0,0,1,220,56Zm-68-8a12,12,0,0,1-12,12H116a12,12,0,0,1,0-24h24A12,12,0,0,1,152,48ZM36,76V56A20,20,0,0,1,56,36H68a12,12,0,0,1,0,24H60V76a12,12,0,0,1-24,0Z"},child:[]}]})(e)}function dfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M238.15,70.54,185.46,17.86a20,20,0,0,0-28.29,0L17.85,157.17a20,20,0,0,0,0,28.29l52.69,52.68a20,20,0,0,0,28.29,0L238.15,98.83A20,20,0,0,0,238.15,70.54ZM84.68,218.34l-47-47L64,145l23.52,23.52a12,12,0,0,0,17-17L81,128l15-15,23.51,23.52a12,12,0,0,0,17-17L113,96l15-15,23.52,23.52a12,12,0,0,0,17-17L145,64l26.35-26.34,47,47Z"},child:[]}]})(e)}function ufe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,216a12,12,0,0,1-12,12H112a12,12,0,0,1,0-24h32A12,12,0,0,1,156,216ZM40,156a12,12,0,0,0,12-12V112a12,12,0,0,0-24,0v32A12,12,0,0,0,40,156Zm32,48H52V184a12,12,0,0,0-24,0v24a20,20,0,0,0,20,20H72a12,12,0,0,0,0-24ZM228,48V208a20,20,0,0,1-20,20H184a12,12,0,0,1,0-24h3L52,69v3a12,12,0,0,1-24,0V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48Zm-24,4H69L204,187Z"},child:[]}]})(e)}function F7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,103.52l-80-80A12,12,0,0,0,140,32V68.74c-25.76,3.12-53.66,15.89-76.75,35.47-29.16,24.74-47.32,56.69-51.14,90A16,16,0,0,0,39.67,207h0c10.46-11.14,47-45.74,100.33-50.42V192a12,12,0,0,0,20.48,8.48l80-80A12,12,0,0,0,240.49,103.52ZM164,163V144a12,12,0,0,0-12-12c-49,0-86.57,21.56-109.79,40.11,7.13-18.16,19.63-35.22,36.57-49.59C101.3,103.41,128.67,92,152,92a12,12,0,0,0,12-12V61l51,51Z"},child:[]}]})(e)}function hfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,175.51a12,12,0,0,1,0,17l-24,24a12,12,0,0,1-17-17L203,196h-2.09a76.17,76.17,0,0,1-61.85-31.83L97.38,105.78A52.1,52.1,0,0,0,55.06,84H32a12,12,0,0,1,0-24H55.06a76.17,76.17,0,0,1,61.85,31.83l41.71,58.39A52.1,52.1,0,0,0,200.94,172H203l-3.52-3.51a12,12,0,0,1,17-17Zm-95.62-72.62a12,12,0,0,0,16.93-1.13A52,52,0,0,1,200.94,84H203l-3.52,3.51a12,12,0,0,0,17,17l24-24a12,12,0,0,0,0-17l-24-24a12,12,0,0,0-17,17L203,60h-2.09a76,76,0,0,0-57.2,26A12,12,0,0,0,144.87,102.89Zm-33.74,50.22a12,12,0,0,0-16.93,1.13A52,52,0,0,1,55.06,172H32a12,12,0,0,0,0,24H55.06a76,76,0,0,0,57.2-26A12,12,0,0,0,111.13,153.11Z"},child:[]}]})(e)}function pfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M40,92H70.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24H137.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24Zm64-24A12,12,0,1,1,92,80,12,12,0,0,1,104,68Zm112,96H201.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24h94.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24Zm-48,24a12,12,0,1,1,12-12A12,12,0,0,1,168,188Z"},child:[]}]})(e)}function ffe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.36,170A12,12,0,0,1,230,186.37l-96,56a12,12,0,0,1-12.1,0l-96-56a12,12,0,0,1,12.09-20.74l90,52.48L218,165.63A12,12,0,0,1,234.36,170ZM218,117.63,128,170.11,38.05,117.63A12,12,0,0,0,26,138.37l96,56a12,12,0,0,0,12.1,0l96-56A12,12,0,0,0,218,117.63ZM20,80a12,12,0,0,1,6-10.37l96-56a12.06,12.06,0,0,1,12.1,0l96,56a12,12,0,0,1,0,20.74l-96,56a12,12,0,0,1-12.1,0l-96-56A12,12,0,0,1,20,80Zm35.82,0L128,122.11,200.18,80,128,37.89Z"},child:[]}]})(e)}function B7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10.05,110.42l112,64a12,12,0,0,0,11.9,0l112-64a12,12,0,0,0,0-20.84l-112-64a12,12,0,0,0-11.9,0l-112,64a12,12,0,0,0,0,20.84Zm118-60.6L215.81,100,128,150.18,40.19,100Zm122.42,92.23A12,12,0,0,1,246,158.42l-112,64a12,12,0,0,1-11.9,0l-112-64A12,12,0,1,1,22,137.58l106,60.6,106-60.6A12,12,0,0,1,250.42,142.05Z"},child:[]}]})(e)}function aj(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243,96a20.33,20.33,0,0,0-17.74-14l-56.59-4.57L146.83,24.62a20.36,20.36,0,0,0-37.66,0L87.35,77.44,30.76,82A20.45,20.45,0,0,0,19.1,117.88l43.18,37.24-13.2,55.7A20.37,20.37,0,0,0,79.57,233L128,203.19,176.43,233a20.39,20.39,0,0,0,30.49-22.15l-13.2-55.7,43.18-37.24A20.43,20.43,0,0,0,243,96ZM172.53,141.7a12,12,0,0,0-3.84,11.86L181.58,208l-47.29-29.08a12,12,0,0,0-12.58,0L74.42,208l12.89-54.4a12,12,0,0,0-3.84-11.86L41.2,105.24l55.4-4.47a12,12,0,0,0,10.13-7.38L128,41.89l21.27,51.5a12,12,0,0,0,10.13,7.38l55.4,4.47Z"},child:[]}]})(e)}function to(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V152a20,20,0,0,1-20,20H112.92a12,12,0,0,1-17.41,16.49l-20-20a12,12,0,0,1,0-17l20-20A12,12,0,0,1,112.92,148H204V52H100a12,12,0,0,1-24,0V48A20,20,0,0,1,96,28H208A20,20,0,0,1,228,48ZM168,192a12,12,0,0,0-12,12H52V108h91.08a12,12,0,0,0,17.41,16.49l20-20a12,12,0,0,0,0-17l-20-20A12,12,0,0,0,143.08,84H48a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20H160a20,20,0,0,0,20-20v-4A12,12,0,0,0,168,192Z"},child:[]}]})(e)}function lj(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H180V36A28,28,0,0,0,152,8H104A28,28,0,0,0,76,36V48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM100,36a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V48H100Zm88,168H68V72H188ZM116,104v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Zm48,0v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function Pi(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM188,204H68V72H188ZM76,20A12,12,0,0,1,88,8h80a12,12,0,0,1,0,24H88A12,12,0,0,1,76,20Z"},child:[]}]})(e)}function km(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,184a16,16,0,1,1,16-16A16,16,0,0,1,188,184Zm36-68H180a12,12,0,0,0,0,24h40v56H36V140H76a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116ZM88.49,80.49,116,53v75a12,12,0,0,0,24,0V53l27.51,27.52a12,12,0,1,0,17-17l-48-48a12,12,0,0,0-17,0l-48,48a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function jm(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0ZM96.49,80.49,116,61v83a12,12,0,0,0,24,0V61l19.51,19.52a12,12,0,1,0,17-17l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function cj(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M125.18,156.94a64,64,0,1,0-82.36,0,100.23,100.23,0,0,0-39.49,32,12,12,0,0,0,19.35,14.2,76,76,0,0,1,122.64,0,12,12,0,0,0,19.36-14.2A100.33,100.33,0,0,0,125.18,156.94ZM44,108a40,40,0,1,1,40,40A40,40,0,0,1,44,108Zm206.1,97.67a12,12,0,0,1-16.78-2.57A76.31,76.31,0,0,0,172,172a12,12,0,0,1,0-24,40,40,0,1,0-10.3-78.67,12,12,0,1,1-6.16-23.19,64,64,0,0,1,57.64,110.8,100.23,100.23,0,0,1,39.49,32A12,12,0,0,1,250.1,205.67Z"},child:[]}]})(e)}function _m(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.26,186.1,152.81,34.23h0a28.74,28.74,0,0,0-49.62,0L15.74,186.1a27.45,27.45,0,0,0,0,27.71A28.31,28.31,0,0,0,40.55,228h174.9a28.31,28.31,0,0,0,24.79-14.19A27.45,27.45,0,0,0,240.26,186.1Zm-20.8,15.7a4.46,4.46,0,0,1-4,2.2H40.55a4.46,4.46,0,0,1-4-2.2,3.56,3.56,0,0,1,0-3.73L124,46.2a4.77,4.77,0,0,1,8,0l87.44,151.87A3.56,3.56,0,0,1,219.46,201.8ZM116,136V104a12,12,0,0,1,24,0v32a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,176Z"},child:[]}]})(e)}function $7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},child:[]}]})(e)}function Rt(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,191.51a12,12,0,0,1-17,17L128,145,64.49,208.49a12,12,0,0,1-17-17L111,128,47.51,64.49a12,12,0,0,1,17-17L128,111l63.51-63.52a12,12,0,0,1,17,17L145,128Z"},child:[]}]})(e)}function mfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,48H32A16,16,0,0,0,16,64V88a16,16,0,0,0,16,16v88a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V104a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48Zm-72,96H104a8,8,0,0,1,0-16h48a8,8,0,0,1,0,16Zm72-56H32V64H224V88Z"},child:[]}]})(e)}function gfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Z"},child:[]}]})(e)}function xfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z"},child:[]}]})(e)}function V7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32Zm-8,128H176V88a8,8,0,0,0-8-8H96V48H208Z"},child:[]}]})(e)}function yfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128Z"},child:[]}]})(e)}function dj(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM48,100a28,28,0,1,0,28,28A28,28,0,0,0,48,100Zm160,0a28,28,0,1,0,28,28A28,28,0,0,0,208,100Z"},child:[]}]})(e)}function bfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM128,76a28,28,0,1,0-28-28A28,28,0,0,0,128,76Zm0,104a28,28,0,1,0,28,28A28,28,0,0,0,128,180Z"},child:[]}]})(e)}function vfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Z"},child:[]}]})(e)}function Im(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.94,107.21a8,8,0,0,0-3.89-5.4l-29.83-17-.12-33.62a8,8,0,0,0-2.83-6.08,111.91,111.91,0,0,0-36.72-20.67,8,8,0,0,0-6.46.59L128,41.85,97.88,25a8,8,0,0,0-6.47-.6A111.92,111.92,0,0,0,54.73,45.15a8,8,0,0,0-2.83,6.07l-.15,33.65-29.83,17a8,8,0,0,0-3.89,5.4,106.47,106.47,0,0,0,0,41.56,8,8,0,0,0,3.89,5.4l29.83,17,.12,33.63a8,8,0,0,0,2.83,6.08,111.91,111.91,0,0,0,36.72,20.67,8,8,0,0,0,6.46-.59L128,214.15,158.12,231a7.91,7.91,0,0,0,3.9,1,8.09,8.09,0,0,0,2.57-.42,112.1,112.1,0,0,0,36.68-20.73,8,8,0,0,0,2.83-6.07l.15-33.65,29.83-17a8,8,0,0,0,3.89-5.4A106.47,106.47,0,0,0,237.94,107.21ZM128,168a40,40,0,1,1,40-40A40,40,0,0,1,128,168Z"},child:[]}]})(e)}function Ou(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M213.85,125.46l-112,120a8,8,0,0,1-13.69-7l14.66-73.33L45.19,143.49a8,8,0,0,1-3-13l112-120a8,8,0,0,1,13.69,7L153.18,90.9l57.63,21.61a8,8,0,0,1,3,12.95Z"},child:[]}]})(e)}function z7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},child:[]}]})(e)}function G7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"},child:[]}]})(e)}function Cfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM192,108.68,147.31,64l24-24L216,84.68Z"},child:[]}]})(e)}function H7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"},child:[]}]})(e)}function wfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM80,192H64a16,16,0,0,1-16-16V144a8,8,0,0,1,16,0v32H80a8,8,0,0,1,0,16ZM80,80H64v32a8,8,0,0,1-16,0V80A16,16,0,0,1,64,64H80a8,8,0,0,1,0,16Zm64,112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm0-112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm64,96a16,16,0,0,1-16,16H176a8,8,0,0,1,0-16h16V144a8,8,0,0,1,16,0Zm0-64a8,8,0,0,1-16,0V80H176a8,8,0,0,1,0-16h16a16,16,0,0,1,16,16Z"},child:[]}]})(e)}function W7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M111.59,181.47A8,8,0,0,1,104,192H24a8,8,0,0,1-7.59-10.53l40-120a8,8,0,0,1,15.18,0ZM208,76a52,52,0,1,0-52,52A52.06,52.06,0,0,0,208,76Zm16,68H136a8,8,0,0,0-8,8v56a8,8,0,0,0,8,8h88a8,8,0,0,0,8-8V152A8,8,0,0,0,224,144Z"},child:[]}]})(e)}function Sfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M212,200a36,36,0,1,1-69.85-12.25l-53-34.05a36,36,0,1,1,0-51.4l53-34a36.09,36.09,0,1,1,8.67,13.45l-53,34.05a36,36,0,0,1,0,24.5l53,34.05A36,36,0,0,1,212,200Z"},child:[]}]})(e)}function uj(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M235.24,84.38l-28.06,23.68,8.56,35.39a13.34,13.34,0,0,1-5.09,13.91,13.54,13.54,0,0,1-15,.69L164,139l-31.65,19.06a13.51,13.51,0,0,1-15-.69,13.32,13.32,0,0,1-5.1-13.91l8.56-35.39L92.76,84.38a13.39,13.39,0,0,1,7.66-23.58l36.94-2.92,14.21-33.66a13.51,13.51,0,0,1,24.86,0l14.21,33.66,36.94,2.92a13.39,13.39,0,0,1,7.66,23.58ZM88.11,111.89a8,8,0,0,0-11.32,0L18.34,170.34a8,8,0,0,0,11.32,11.32l58.45-58.45A8,8,0,0,0,88.11,111.89Zm-.5,61.19L34.34,226.34a8,8,0,0,0,11.32,11.32l53.26-53.27a8,8,0,0,0-11.31-11.31Zm73-1-54.29,54.28a8,8,0,0,0,11.32,11.32l54.28-54.28a8,8,0,0,0-11.31-11.32Z"},child:[]}]})(e)}function Ty(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,144a15.78,15.78,0,0,1-10.42,14.94L146,178l-19,51.62a15.92,15.92,0,0,1-29.88,0L78,178l-51.62-19a15.92,15.92,0,0,1,0-29.88L78,110l19-51.62a15.92,15.92,0,0,1,29.88,0L146,110l51.62,19A15.78,15.78,0,0,1,208,144ZM152,48h16V64a8,8,0,0,0,16,0V48h16a8,8,0,0,0,0-16H184V16a8,8,0,0,0-16,0V32H152a8,8,0,0,0,0,16Zm88,32h-8V72a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0V96h8a8,8,0,0,0,0-16Z"},child:[]}]})(e)}function Ay(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,114.85l-45,38.83L203,211.75a16.4,16.4,0,0,1-24.5,17.82L128,198.49,77.47,229.57A16.4,16.4,0,0,1,53,211.75l13.76-58.07-45-38.83A16.46,16.46,0,0,1,31.08,86l59-4.76,22.76-55.08a16.36,16.36,0,0,1,30.27,0l22.75,55.08,59,4.76a16.46,16.46,0,0,1,9.37,28.86Z"},child:[]}]})(e)}function kfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,112a40,40,0,1,1,40-40A40,40,0,0,1,176,168Z"},child:[]}]})(e)}function My(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,56a8,8,0,0,1-8,8h-8V208a16,16,0,0,1-16,16H64a16,16,0,0,1-16-16V64H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,56ZM88,32h80a8,8,0,0,0,0-16H88a8,8,0,0,0,0,16Z"},child:[]}]})(e)}function jfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M74.34,77.66a8,8,0,0,1,0-11.32l48-48a8,8,0,0,1,11.32,0l48,48a8,8,0,0,1-11.32,11.32L136,43.31V128a8,8,0,0,1-16,0V43.31L85.66,77.66A8,8,0,0,1,74.34,77.66ZM240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a16,16,0,0,1,16-16h68a4,4,0,0,1,4,4v3.46c0,13.45,11,24.79,24.46,24.54A24,24,0,0,0,152,128v-4a4,4,0,0,1,4-4h68A16,16,0,0,1,240,136Zm-40,32a12,12,0,1,0-12,12A12,12,0,0,0,200,168Z"},child:[]}]})(e)}function U7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,96a72,72,0,0,1-100.94,66L79,222.22c-.12.14-.26.29-.39.42a32,32,0,0,1-45.26-45.26c.14-.13.28-.27.43-.39L94,124.94a72.07,72.07,0,0,1,83.54-98.78,8,8,0,0,1,3.93,13.19L144,80l5.66,26.35L176,112l40.65-37.52a8,8,0,0,1,13.19,3.93A72.6,72.6,0,0,1,232,96Z"},child:[]}]})(e)}function _fe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.33,69.52a24,24,0,0,0-14.49-16.4C185.56,39.88,131,40,128,40s-57.56-.12-91.84,13.12a24,24,0,0,0-14.49,16.4C19.08,79.5,16,97.74,16,128s3.08,48.5,5.67,58.48a24,24,0,0,0,14.49,16.41C69,215.56,120.4,216,127.34,216h1.32c6.94,0,58.37-.44,91.18-13.11a24,24,0,0,0,14.49-16.41c2.59-10,5.67-28.22,5.67-58.48S236.92,79.5,234.33,69.52Zm-73.74,65-40,28A8,8,0,0,1,108,156V100a8,8,0,0,1,12.59-6.55l40,28a8,8,0,0,1,0,13.1Z"},child:[]}]})(e)}function hT(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M104,60A12,12,0,1,1,92,48,12,12,0,0,1,104,60Zm60,12a12,12,0,1,0-12-12A12,12,0,0,0,164,72ZM92,116a12,12,0,1,0,12,12A12,12,0,0,0,92,116Zm72,0a12,12,0,1,0,12,12A12,12,0,0,0,164,116ZM92,184a12,12,0,1,0,12,12A12,12,0,0,0,92,184Zm72,0a12,12,0,1,0,12,12A12,12,0,0,0,164,184Z"},child:[]}]})(e)}function pT(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M72,92A12,12,0,1,1,60,80,12,12,0,0,1,72,92Zm56-12a12,12,0,1,0,12,12A12,12,0,0,0,128,80Zm68,24a12,12,0,1,0-12-12A12,12,0,0,0,196,104ZM60,152a12,12,0,1,0,12,12A12,12,0,0,0,60,152Zm68,0a12,12,0,1,0,12,12A12,12,0,0,0,128,152Zm68,0a12,12,0,1,0,12,12A12,12,0,0,0,196,152Z"},child:[]}]})(e)}function Ife(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM48,48H208v77.38l-24.69-24.7a16,16,0,0,0-22.62,0L53.37,208H48ZM208,208H76l96-96,36,36v60ZM96,120A24,24,0,1,0,72,96,24,24,0,0,0,96,120Zm0-32a8,8,0,1,1-8,8A8,8,0,0,1,96,88Z"},child:[]}]})(e)}function hj(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,16V158.75l-26.07-26.06a16,16,0,0,0-22.63,0l-20,20-44-44a16,16,0,0,0-22.62,0L40,149.37V56ZM40,172l52-52,80,80H40Zm176,28H194.63l-36-36,20-20L216,181.38V200ZM144,100a12,12,0,1,1,12,12A12,12,0,0,1,144,100Z"},child:[]}]})(e)}function Tfe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}function q7(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,32V64a8,8,0,0,1-16,0V32a8,8,0,0,1,16,0Zm37.25,58.75a8,8,0,0,0,5.66-2.35l22.63-22.62a8,8,0,0,0-11.32-11.32L167.6,77.09a8,8,0,0,0,5.65,13.66ZM224,120H192a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16Zm-45.09,47.6a8,8,0,0,0-11.31,11.31l22.62,22.63a8,8,0,0,0,11.32-11.32ZM128,184a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V192A8,8,0,0,0,128,184ZM77.09,167.6,54.46,190.22a8,8,0,0,0,11.32,11.32L88.4,178.91A8,8,0,0,0,77.09,167.6ZM72,128a8,8,0,0,0-8-8H32a8,8,0,0,0,0,16H64A8,8,0,0,0,72,128ZM65.78,54.46A8,8,0,0,0,54.46,65.78L77.09,88.4A8,8,0,0,0,88.4,77.09Z"},child:[]}]})(e)}function Ey(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}const zC=e=>[e,...e.dependencies||[]],K7=()=>{const{modelList:e}=gu(void 0,{selectFromResult:({data:s})=>({modelList:s?aa.selectAll(s):Fs})}),t=c.useCallback(({source:s,name:o,base:r,type:a,is_installed:l,previous_names:d})=>e.some(u=>l||s===u.source||r===u.base&&(o===u.name||(d==null?void 0:d.includes(o)))&&a===u.type),[e]),n=c.useCallback(s=>{const{name:o,base:r,type:a,source:l,description:d,format:u}=s;return{config:{name:o,base:r,type:a,description:d,format:u},source:l}},[]);return{getIsInstalled:t,buildModelInstallArg:n}},Afe=({bundleName:e,bundle:t})=>{const[n]=V8(),{getIsInstalled:s,buildModelInstallArg:o}=K7(),{t:r}=M(),a=c.useMemo(()=>{const d=nde(t,zC),u=GD(d,(f,m)=>f.source===m.source||f.name===m.name&&f.base===m.base&&f.type===m.type),h=u.filter(zD(s)).map(o),p=u.filter(s).map(o);return{install:h,skip:p}},[o,t,s]),l=c.useCallback(()=>{a.install.forEach(n);let d=r("modelManager.installingXModels",{count:a.install.length});a.skip.length>1&&(d+=r("modelManager.skippingXDuplicates",{count:a.skip.length-1})),ge({status:"info",title:r("modelManager.installingBundle"),description:d})},[a.install,a.skip.length,n,r]);return i.jsx(Oe,{label:i.jsxs(T,{flexDir:"column",p:1,children:[i.jsxs(W,{children:[r("modelManager.includesNModels",{n:t.length}),":"]}),i.jsx(ai,{children:t.map((d,u)=>i.jsx(Ft,{wordBreak:"break-all",children:d.name},u))})]}),children:i.jsx(de,{size:"sm",onClick:l,py:6,isDisabled:a.install.length===0,children:i.jsxs(T,{flexDir:"column",children:[i.jsx(W,{children:xQ(e)?wS[e]:e}),a.install.length>0&&i.jsxs(W,{fontSize:"xs",children:["(",t.length," ",r("settings.models"),")"]}),a.install.length===0&&i.jsx(W,{fontSize:"xs",children:r("common.installed")})]})})})},Nu=()=>{const{t:e}=M(),[t,n]=V8();return[c.useCallback(({source:o,inplace:r,config:a,onSuccess:l,onError:d})=>{a||(a={}),t({source:o,inplace:r,config:a}).unwrap().then(u=>{l&&l(),ge({id:"MODEL_INSTALL_QUEUED",title:e("toast.modelAddedSimple"),status:"success"})}).catch(u=>{d&&d(u),u&&ge({id:"MODEL_INSTALL_QUEUE_FAILED",title:`${u.data.detail} `,status:"error"})})},[t,e]),n]},Z7={any:"base","sd-1":"green","sd-2":"teal","sd-3":"purple",sdxl:"invokeBlue","sdxl-refiner":"invokeBlue",flux:"gold",cogview4:"red",imagen3:"pink",imagen4:"pink","chatgpt-4o":"pink"},Mfe=({base:e})=>i.jsx(Hn,{flexGrow:0,flexShrink:0,colorScheme:Z7[e],variant:"subtle",h:"min-content",children:wS[e]}),Y7=c.memo(Mfe),X7=c.memo(({starterModel:e})=>{const{t}=M(),{getIsInstalled:n,buildModelInstallArg:s}=K7(),o=c.useMemo(()=>zC(e).every(n),[n,e]),r=c.useMemo(()=>zC(e).filter(zD(n)).map(s),[n,e,s]),[a]=Nu(),l=c.useCallback(()=>{r.forEach(a),ge({status:"info",title:t("modelManager.installingModel"),description:t("modelManager.installingXModels",{count:r.length})})},[r,a,t]);return i.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[i.jsxs(T,{fontSize:"sm",flexDir:"column",children:[i.jsxs(T,{gap:3,children:[i.jsx(Hn,{h:"min-content",children:e.type.replaceAll("_"," ")}),i.jsx(Y7,{base:e.base}),i.jsx(W,{fontWeight:"semibold",children:e.name})]}),i.jsx(W,{variant:"subtext",children:e.description})]}),i.jsx(Ce,{children:o?i.jsx(Hn,{children:t("common.installed")}):i.jsx(le,{"aria-label":t("modelManager.install"),icon:i.jsx(Vt,{}),onClick:l,size:"sm"})})]})});X7.displayName="StarterModelsResultItem";const Q7=c.memo(({results:e})=>{const{t}=M(),[n,s]=c.useState(""),o=c.useMemo(()=>e.starter_models.filter(l=>{const d=n.trim().toLowerCase(),u=[l.name.toLowerCase(),l.type.toLowerCase().replaceAll("_"," "),l.description.toLowerCase(),l.base.toLowerCase()];return l.type==="spandrel_image_to_image"&&(u.push("upscale"),u.push("post-processing"),u.push("postprocessing"),u.push("post processing")),u.some(h=>h.includes(d))}),[e,n]),r=c.useCallback(l=>{s(l.target.value)},[]),a=c.useCallback(()=>{s("")},[]);return i.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[i.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[SS(e.starter_bundles)>0&&i.jsxs(T,{gap:4,alignItems:"center",children:[i.jsxs(T,{gap:2,alignItems:"center",children:[i.jsx(W,{color:"base.200",fontWeight:"semibold",children:t("modelManager.starterBundles")}),i.jsx(Oe,{label:t("modelManager.starterBundleHelpText"),children:i.jsx(T,{alignItems:"center",children:i.jsx(at,{as:Ru,color:"base.200"})})})]}),i.jsx(T,{gap:2,children:mr(e.starter_bundles,(l,d)=>i.jsx(Afe,{bundleName:d,bundle:l},d))})]}),i.jsxs(Cr,{w:64,size:"xs",children:[i.jsx(St,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:r,size:"xs"}),n&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:i.jsx(Rt,{}),onClick:a,flexShrink:0})})]})]}),i.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:i.jsx(ns,{children:i.jsx(T,{flexDir:"column",gap:3,children:o.map(l=>i.jsx(X7,{starterModel:l},l.source))})})})]})});Q7.displayName="StarterModelsResults";const J7=c.memo(()=>{const{isLoading:e,data:t}=yQ(),{t:n}=M();return i.jsxs(T,{flexDir:"column",height:"100%",gap:3,children:[e&&i.jsx(is,{loadingMessage:n("common.loading")}),t&&i.jsx(Q7,{results:t})]})});J7.displayName="StarterModelsForm";const Efe=()=>{const{t:e}=M(),t=Bt("hfToken"),{currentData:n}=z8(t?void 0:cs),s=c.useMemo(()=>{switch(n){case"invalid":return e("modelManager.hfTokenInvalidErrorMessage");case"unknown":return e("modelManager.hfTokenUnableToVerifyErrorMessage");case"valid":case void 0:return null;default:ve(!1,"Unexpected HF token status")}},[n,e]);return n?i.jsx(T,{borderRadius:"base",w:"full",children:i.jsxs(Q,{isInvalid:!!s,orientation:"vertical",children:[i.jsx(J,{children:e("modelManager.hfTokenLabel")}),s&&i.jsx(t9,{}),!s&&i.jsx(e9,{}),i.jsx(Js,{children:i.jsx(ii,{label:e("modelManager.hfTokenHelperText"),href:"https://huggingface.co/settings/tokens"})}),i.jsx(xu,{children:s})]})}):null},Pfe=Array.from({length:37},()=>"a").join(""),e9=c.memo(()=>{const{t:e}=M(),[t,{isLoading:n}]=vQ(),s=c.useCallback(()=>{t().unwrap().then(()=>{ge({title:e("modelManager.hfTokenReset"),status:"info"})})},[t,e]);return i.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[i.jsx(St,{type:"password",value:Pfe,isDisabled:!0}),i.jsx(de,{onClick:s,size:"sm",isLoading:n,children:e("common.reset")})]})});e9.displayName="ResetHFTokenButton";const t9=c.memo(()=>{const{t:e}=M(),[t,n]=c.useState(""),[s,{isLoading:o}]=bQ(),r=c.useCallback(l=>{n(l.target.value)},[]),a=c.useCallback(()=>{s({token:t}).unwrap().then(l=>{switch(l){case"valid":n(""),ge({title:e("modelManager.hfTokenSaved"),status:"success"});break;case"invalid":case"unknown":default:ge({title:e("modelManager.hfTokenUnableToVerify"),status:"error"});break}})},[e,t,s]);return i.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[i.jsx(St,{type:"password",value:t,onChange:r}),i.jsx(de,{onClick:a,size:"sm",isDisabled:t.trim().length===0,isLoading:o,children:e("common.save")})]})});t9.displayName="SetHFTokenInput";const n9=c.memo(({result:e})=>{const{t}=M(),[n]=Nu(),s=c.useCallback(()=>{n({source:e})},[n,e]);return i.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[i.jsxs(T,{fontSize:"sm",flexDir:"column",children:[i.jsx(W,{fontWeight:"semibold",children:e.split("/").slice(-1)[0]}),i.jsx(W,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:e})]}),i.jsx(le,{"aria-label":t("modelManager.install"),icon:i.jsx(Vt,{}),onClick:s,size:"sm"})]})});n9.displayName="HuggingFaceResultItem";const s9=c.memo(({results:e})=>{const{t}=M(),[n,s]=c.useState(""),[o]=Nu(),r=c.useMemo(()=>e.filter(u=>{const h=u.split("/").slice(-1)[0];return h==null?void 0:h.toLowerCase().includes(n.toLowerCase())}),[e,n]),a=c.useCallback(u=>{s(u.target.value.trim())},[]),l=c.useCallback(()=>{s("")},[]),d=c.useCallback(()=>{for(const u of r)o({source:u})},[r,o]);return i.jsxs(i.Fragment,{children:[i.jsx(Ct,{}),i.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[i.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[i.jsx(zt,{size:"sm",children:t("modelManager.availableModels")}),i.jsxs(T,{alignItems:"center",gap:3,children:[i.jsx(de,{size:"sm",onClick:d,isDisabled:e.length===0,flexShrink:0,children:t("modelManager.installAll")}),i.jsxs(Cr,{w:64,size:"xs",children:[i.jsx(St,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:a,size:"xs"}),n&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:i.jsx(Rt,{}),onClick:l})})]})]})]}),i.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:i.jsx(ns,{children:i.jsx(T,{flexDir:"column",gap:3,children:r.map(u=>i.jsx(n9,{result:u},u))})})})]})]})});s9.displayName="HuggingFaceResults";const i9=c.memo(()=>{const[e,t]=c.useState(""),[n,s]=c.useState(!1),[o,r]=c.useState(""),{t:a}=M(),l=Bt("hfToken"),[d,{isLoading:u,data:h}]=CQ(),[p]=Nu(),f=c.useCallback(()=>{d(e).unwrap().then(g=>{var x;g.is_diffusers?(p({source:e}),s(!1)):((x=g.urls)==null?void 0:x.length)===1&&g.urls[0]?(p({source:g.urls[0]}),s(!1)):s(!0)}).catch(g=>{r(g.data.detail||"")})},[d,p,e]),m=c.useCallback(g=>{t(g.target.value),r("")},[]);return i.jsxs(T,{flexDir:"column",height:"100%",gap:4,children:[i.jsxs(Q,{isInvalid:!!o.length,w:"full",orientation:"vertical",flexShrink:0,children:[i.jsx(J,{children:a("modelManager.huggingFaceRepoID")}),i.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[i.jsx(St,{placeholder:a("modelManager.huggingFacePlaceholder"),value:e,onChange:m}),i.jsx(de,{onClick:f,isLoading:u,isDisabled:e.length===0,size:"sm",flexShrink:0,children:a("modelManager.installRepo")})]}),i.jsx(Js,{children:a("modelManager.huggingFaceHelper")}),!!o.length&&i.jsx(xu,{children:o})]}),l&&i.jsx(Efe,{}),h&&h.urls&&n&&i.jsx(s9,{results:h.urls})]})});i9.displayName="HuggingFaceForm";var Tm=e=>e.type==="checkbox",Hl=e=>e instanceof Date,Ws=e=>e==null;const o9=e=>typeof e=="object";var Dn=e=>!Ws(e)&&!Array.isArray(e)&&o9(e)&&!Hl(e),r9=e=>Dn(e)&&e.target?Tm(e.target)?e.target.checked:e.target.value:e,Lfe=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,a9=(e,t)=>e.has(Lfe(t)),Dfe=e=>{const t=e.constructor&&e.constructor.prototype;return Dn(t)&&t.hasOwnProperty("isPrototypeOf")},pj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function fs(e){let t;const n=Array.isArray(e),s=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(pj&&(e instanceof Blob||s))&&(n||Dn(e)))if(t=n?[]:{},!n&&!Dfe(e))t=e;else for(const o in e)e.hasOwnProperty(o)&&(t[o]=fs(e[o]));else return e;return t}var Py=e=>Array.isArray(e)?e.filter(Boolean):[],Ln=e=>e===void 0,Ne=(e,t,n)=>{if(!t||!Dn(e))return n;const s=Py(t.split(/[,[\].]+?/)).reduce((o,r)=>Ws(o)?o:o[r],e);return Ln(s)||s===e?Ln(e[t])?n:e[t]:s},bi=e=>typeof e=="boolean",fj=e=>/^\w*$/.test(e),l9=e=>Py(e.replace(/["|']|\]/g,"").split(/\.|\[/)),nn=(e,t,n)=>{let s=-1;const o=fj(t)?[t]:l9(t),r=o.length,a=r-1;for(;++s<r;){const l=o[s];let d=n;if(s!==a){const u=e[l];d=Dn(u)||Array.isArray(u)?u:isNaN(+o[s+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;e[l]=d,e=e[l]}};const g1={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Io={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Mr={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Rfe=xe.createContext(null),mj=()=>xe.useContext(Rfe);var c9=(e,t,n,s=!0)=>{const o={defaultValues:t._defaultValues};for(const r in e)Object.defineProperty(o,r,{get:()=>{const a=r;return t._proxyFormState[a]!==Io.all&&(t._proxyFormState[a]=!s||Io.all),n&&(n[a]=!0),e[a]}});return o},GC=e=>Ws(e)||!o9(e);function Hr(e,t){if(GC(e)||GC(t))return e===t;if(Hl(e)&&Hl(t))return e.getTime()===t.getTime();const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(const o of n){const r=e[o];if(!s.includes(o))return!1;if(o!=="ref"){const a=t[o];if(Hl(r)&&Hl(a)||Dn(r)&&Dn(a)||Array.isArray(r)&&Array.isArray(a)?!Hr(r,a):r!==a)return!1}}return!0}const d9=(e,t)=>{const n=c.useRef(t);Hr(t,n.current)||(n.current=t),c.useEffect(e,n.current)};function Ofe(e){const t=mj(),{control:n=t.control,disabled:s,name:o,exact:r}=e||{},[a,l]=xe.useState(n._formState),d=xe.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return d9(()=>n._subscribe({name:o,formState:d.current,exact:r,callback:u=>{!s&&l({...n._formState,...u})}}),[o,s,r]),xe.useEffect(()=>{d.current.isValid&&n._setValid(!0)},[n]),xe.useMemo(()=>c9(a,n,d.current,!1),[a,n])}var nr=e=>typeof e=="string",u9=(e,t,n,s,o)=>nr(e)?(s&&t.watch.add(e),Ne(n,e,o)):Array.isArray(e)?e.map(r=>(s&&t.watch.add(r),Ne(n,r))):(s&&(t.watchAll=!0),n);function Nfe(e){const t=mj(),{control:n=t.control,name:s,defaultValue:o,disabled:r,exact:a}=e||{},[l,d]=xe.useState(n._getWatch(s,o));return d9(()=>n._subscribe({name:s,formState:{values:!0},exact:a,callback:u=>!r&&d(u9(s,n._names,u.values||n._formValues,!1,o))}),[s,o,r,a]),xe.useEffect(()=>n._removeUnmounted()),l}function ws(e){const t=mj(),{name:n,disabled:s,control:o=t.control,shouldUnregister:r}=e,a=a9(o._names.array,n),l=Nfe({control:o,name:n,defaultValue:Ne(o._formValues,n,Ne(o._defaultValues,n,e.defaultValue)),exact:!0}),d=Ofe({control:o,name:n,exact:!0}),u=xe.useRef(e),h=xe.useRef(o.register(n,{...e.rules,value:l,...bi(e.disabled)?{disabled:e.disabled}:{}})),p=xe.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Ne(d.errors,n)},isDirty:{enumerable:!0,get:()=>!!Ne(d.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!Ne(d.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!Ne(d.validatingFields,n)},error:{enumerable:!0,get:()=>Ne(d.errors,n)}}),[d,n]),f=xe.useCallback(b=>h.current.onChange({target:{value:r9(b),name:n},type:g1.CHANGE}),[n]),m=xe.useCallback(()=>h.current.onBlur({target:{value:Ne(o._formValues,n),name:n},type:g1.BLUR}),[n,o._formValues]),g=xe.useCallback(b=>{const C=Ne(o._fields,n);C&&b&&(C._f.ref={focus:()=>b.focus(),select:()=>b.select(),setCustomValidity:y=>b.setCustomValidity(y),reportValidity:()=>b.reportValidity()})},[o._fields,n]),x=xe.useMemo(()=>({name:n,value:l,...bi(s)||d.disabled?{disabled:d.disabled||s}:{},onChange:f,onBlur:m,ref:g}),[n,s,d.disabled,f,m,g,l]);return xe.useEffect(()=>{const b=o._options.shouldUnregister||r;o.register(n,{...u.current.rules,...bi(u.current.disabled)?{disabled:u.current.disabled}:{}});const C=(y,v)=>{const w=Ne(o._fields,y);w&&w._f&&(w._f.mount=v)};if(C(n,!0),b){const y=fs(Ne(o._options.defaultValues,n));nn(o._defaultValues,n,y),Ln(Ne(o._formValues,n))&&nn(o._formValues,n,y)}return!a&&o.register(n),()=>{(a?b&&!o._state.action:b)?o.unregister(n):C(n,!1)}},[n,o,a,r]),xe.useEffect(()=>{o._setDisabledField({disabled:s,name:n})},[s,n,o]),xe.useMemo(()=>({field:x,formState:d,fieldState:p}),[x,d,p])}var Ffe=(e,t,n,s,o)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[s]:o||!0}}:{},Bp=e=>Array.isArray(e)?e:[e],fT=()=>{let e=[];return{get observers(){return e},next:o=>{for(const r of e)r.next&&r.next(o)},subscribe:o=>(e.push(o),{unsubscribe:()=>{e=e.filter(r=>r!==o)}}),unsubscribe:()=>{e=[]}}},Hs=e=>Dn(e)&&!Object.keys(e).length,gj=e=>e.type==="file",To=e=>typeof e=="function",x1=e=>{if(!pj)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},h9=e=>e.type==="select-multiple",xj=e=>e.type==="radio",Bfe=e=>xj(e)||Tm(e),gv=e=>x1(e)&&e.isConnected;function $fe(e,t){const n=t.slice(0,-1).length;let s=0;for(;s<n;)e=Ln(e)?s++:e[t[s++]];return e}function Vfe(e){for(const t in e)if(e.hasOwnProperty(t)&&!Ln(e[t]))return!1;return!0}function Un(e,t){const n=Array.isArray(t)?t:fj(t)?[t]:l9(t),s=n.length===1?e:$fe(e,n),o=n.length-1,r=n[o];return s&&delete s[r],o!==0&&(Dn(s)&&Hs(s)||Array.isArray(s)&&Vfe(s))&&Un(e,n.slice(0,-1)),e}var p9=e=>{for(const t in e)if(To(e[t]))return!0;return!1};function y1(e,t={}){const n=Array.isArray(e);if(Dn(e)||n)for(const s in e)Array.isArray(e[s])||Dn(e[s])&&!p9(e[s])?(t[s]=Array.isArray(e[s])?[]:{},y1(e[s],t[s])):Ws(e[s])||(t[s]=!0);return t}function f9(e,t,n){const s=Array.isArray(e);if(Dn(e)||s)for(const o in e)Array.isArray(e[o])||Dn(e[o])&&!p9(e[o])?Ln(t)||GC(n[o])?n[o]=Array.isArray(e[o])?y1(e[o],[]):{...y1(e[o])}:f9(e[o],Ws(t)?{}:t[o],n[o]):n[o]=!Hr(e[o],t[o]);return n}var fh=(e,t)=>f9(e,t,y1(t));const mT={value:!1,isValid:!1},gT={value:!0,isValid:!0};var m9=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Ln(e[0].attributes.value)?Ln(e[0].value)||e[0].value===""?gT:{value:e[0].value,isValid:!0}:gT:mT}return mT},g9=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:s})=>Ln(e)?e:t?e===""?NaN:e&&+e:n&&nr(e)?new Date(e):s?s(e):e;const xT={isValid:!1,value:null};var x9=e=>Array.isArray(e)?e.reduce((t,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:t,xT):xT;function yT(e){const t=e.ref;return gj(t)?t.files:xj(t)?x9(e.refs).value:h9(t)?[...t.selectedOptions].map(({value:n})=>n):Tm(t)?m9(e.refs).value:g9(Ln(t.value)?e.ref.value:t.value,e)}var zfe=(e,t,n,s)=>{const o={};for(const r of e){const a=Ne(t,r);a&&nn(o,r,a._f)}return{criteriaMode:n,names:[...e],fields:o,shouldUseNativeValidation:s}},b1=e=>e instanceof RegExp,mh=e=>Ln(e)?e:b1(e)?e.source:Dn(e)?b1(e.value)?e.value.source:e.value:e,bT=e=>({isOnSubmit:!e||e===Io.onSubmit,isOnBlur:e===Io.onBlur,isOnChange:e===Io.onChange,isOnAll:e===Io.all,isOnTouch:e===Io.onTouched});const vT="AsyncFunction";var Gfe=e=>!!e&&!!e.validate&&!!(To(e.validate)&&e.validate.constructor.name===vT||Dn(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===vT)),Hfe=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),CT=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const $p=(e,t,n,s)=>{for(const o of n||Object.keys(e)){const r=Ne(e,o);if(r){const{_f:a,...l}=r;if(a){if(a.refs&&a.refs[0]&&t(a.refs[0],o)&&!s)return!0;if(a.ref&&t(a.ref,a.name)&&!s)return!0;if($p(l,t))break}else if(Dn(l)&&$p(l,t))break}}};function wT(e,t,n){const s=Ne(e,n);if(s||fj(n))return{error:s,name:n};const o=n.split(".");for(;o.length;){const r=o.join("."),a=Ne(t,r),l=Ne(e,r);if(a&&!Array.isArray(a)&&n!==r)return{name:n};if(l&&l.type)return{name:r,error:l};o.pop()}return{name:n}}var Wfe=(e,t,n,s)=>{n(e);const{name:o,...r}=e;return Hs(r)||Object.keys(r).length>=Object.keys(t).length||Object.keys(r).find(a=>t[a]===(!s||Io.all))},Ufe=(e,t,n)=>!e||!t||e===t||Bp(e).some(s=>s&&(n?s===t:s.startsWith(t)||t.startsWith(s))),qfe=(e,t,n,s,o)=>o.isOnAll?!1:!n&&o.isOnTouch?!(t||e):(n?s.isOnBlur:o.isOnBlur)?!e:(n?s.isOnChange:o.isOnChange)?e:!0,Kfe=(e,t)=>!Py(Ne(e,t)).length&&Un(e,t),Zfe=(e,t,n)=>{const s=Bp(Ne(e,n));return nn(s,"root",t[n]),nn(e,n,s),e},I0=e=>nr(e);function ST(e,t,n="validate"){if(I0(e)||Array.isArray(e)&&e.every(I0)||bi(e)&&!e)return{type:n,message:I0(e)?e:"",ref:t}}var qc=e=>Dn(e)&&!b1(e)?e:{value:e,message:""},kT=async(e,t,n,s,o,r)=>{const{ref:a,refs:l,required:d,maxLength:u,minLength:h,min:p,max:f,pattern:m,validate:g,name:x,valueAsNumber:b,mount:C}=e._f,y=Ne(n,x);if(!C||t.has(x))return{};const v=l?l[0]:a,w=N=>{o&&v.reportValidity&&(v.setCustomValidity(bi(N)?"":N||""),v.reportValidity())},k={},S=xj(a),P=Tm(a),E=S||P,L=(b||gj(a))&&Ln(a.value)&&Ln(y)||x1(a)&&a.value===""||y===""||Array.isArray(y)&&!y.length,I=Ffe.bind(null,x,s,k),O=(N,_,R,D=Mr.maxLength,B=Mr.minLength)=>{const V=N?_:R;k[x]={type:N?D:B,message:V,ref:a,...I(N?D:B,V)}};if(r?!Array.isArray(y)||!y.length:d&&(!E&&(L||Ws(y))||bi(y)&&!y||P&&!m9(l).isValid||S&&!x9(l).isValid)){const{value:N,message:_}=I0(d)?{value:!!d,message:d}:qc(d);if(N&&(k[x]={type:Mr.required,message:_,ref:v,...I(Mr.required,_)},!s))return w(_),k}if(!L&&(!Ws(p)||!Ws(f))){let N,_;const R=qc(f),D=qc(p);if(!Ws(y)&&!isNaN(y)){const B=a.valueAsNumber||y&&+y;Ws(R.value)||(N=B>R.value),Ws(D.value)||(_=B<D.value)}else{const B=a.valueAsDate||new Date(y),V=oe=>new Date(new Date().toDateString()+" "+oe),ee=a.type=="time",se=a.type=="week";nr(R.value)&&y&&(N=ee?V(y)>V(R.value):se?y>R.value:B>new Date(R.value)),nr(D.value)&&y&&(_=ee?V(y)<V(D.value):se?y<D.value:B<new Date(D.value))}if((N||_)&&(O(!!N,R.message,D.message,Mr.max,Mr.min),!s))return w(k[x].message),k}if((u||h)&&!L&&(nr(y)||r&&Array.isArray(y))){const N=qc(u),_=qc(h),R=!Ws(N.value)&&y.length>+N.value,D=!Ws(_.value)&&y.length<+_.value;if((R||D)&&(O(R,N.message,_.message),!s))return w(k[x].message),k}if(m&&!L&&nr(y)){const{value:N,message:_}=qc(m);if(b1(N)&&!y.match(N)&&(k[x]={type:Mr.pattern,message:_,ref:a,...I(Mr.pattern,_)},!s))return w(_),k}if(g){if(To(g)){const N=await g(y,n),_=ST(N,v);if(_&&(k[x]={..._,...I(Mr.validate,_.message)},!s))return w(_.message),k}else if(Dn(g)){let N={};for(const _ in g){if(!Hs(N)&&!s)break;const R=ST(await g[_](y,n),v,_);R&&(N={...R,...I(_,R.message)},w(R.message),s&&(k[x]=N))}if(!Hs(N)&&(k[x]={ref:v,...N},!s))return k}}return w(!0),k};const Yfe={mode:Io.onSubmit,reValidateMode:Io.onChange,shouldFocusError:!0};function Xfe(e={}){let t={...Yfe,...e},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:To(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1};const s={};let o=Dn(t.defaultValues)||Dn(t.values)?fs(t.values||t.defaultValues)||{}:{},r=t.shouldUnregister?{}:fs(o),a={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},d,u=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let p={...h};const f={array:fT(),state:fT()},m=bT(t.mode),g=bT(t.reValidateMode),x=t.criteriaMode===Io.all,b=K=>ae=>{clearTimeout(u),u=setTimeout(K,ae)},C=async K=>{if(!t.disabled&&(h.isValid||p.isValid||K)){const ae=t.resolver?Hs((await L()).errors):await O(s,!0);ae!==n.isValid&&f.state.next({isValid:ae})}},y=(K,ae)=>{!t.disabled&&(h.isValidating||h.validatingFields||p.isValidating||p.validatingFields)&&((K||Array.from(l.mount)).forEach(ne=>{ne&&(ae?nn(n.validatingFields,ne,ae):Un(n.validatingFields,ne))}),f.state.next({validatingFields:n.validatingFields,isValidating:!Hs(n.validatingFields)}))},v=(K,ae=[],ne,ue,be=!0,ye=!0)=>{if(ue&&ne&&!t.disabled){if(a.action=!0,ye&&Array.isArray(Ne(s,K))){const ke=ne(Ne(s,K),ue.argA,ue.argB);be&&nn(s,K,ke)}if(ye&&Array.isArray(Ne(n.errors,K))){const ke=ne(Ne(n.errors,K),ue.argA,ue.argB);be&&nn(n.errors,K,ke),Kfe(n.errors,K)}if((h.touchedFields||p.touchedFields)&&ye&&Array.isArray(Ne(n.touchedFields,K))){const ke=ne(Ne(n.touchedFields,K),ue.argA,ue.argB);be&&nn(n.touchedFields,K,ke)}(h.dirtyFields||p.dirtyFields)&&(n.dirtyFields=fh(o,r)),f.state.next({name:K,isDirty:_(K,ae),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else nn(r,K,ae)},w=(K,ae)=>{nn(n.errors,K,ae),f.state.next({errors:n.errors})},k=K=>{n.errors=K,f.state.next({errors:n.errors,isValid:!1})},S=(K,ae,ne,ue)=>{const be=Ne(s,K);if(be){const ye=Ne(r,K,Ln(ne)?Ne(o,K):ne);Ln(ye)||ue&&ue.defaultChecked||ae?nn(r,K,ae?ye:yT(be._f)):B(K,ye),a.mount&&C()}},P=(K,ae,ne,ue,be)=>{let ye=!1,ke=!1;const Ue={name:K};if(!t.disabled){if(!ne||ue){(h.isDirty||p.isDirty)&&(ke=n.isDirty,n.isDirty=Ue.isDirty=_(),ye=ke!==Ue.isDirty);const pt=Hr(Ne(o,K),ae);ke=!!Ne(n.dirtyFields,K),pt?Un(n.dirtyFields,K):nn(n.dirtyFields,K,!0),Ue.dirtyFields=n.dirtyFields,ye=ye||(h.dirtyFields||p.dirtyFields)&&ke!==!pt}if(ne){const pt=Ne(n.touchedFields,K);pt||(nn(n.touchedFields,K,ne),Ue.touchedFields=n.touchedFields,ye=ye||(h.touchedFields||p.touchedFields)&&pt!==ne)}ye&&be&&f.state.next(Ue)}return ye?Ue:{}},E=(K,ae,ne,ue)=>{const be=Ne(n.errors,K),ye=(h.isValid||p.isValid)&&bi(ae)&&n.isValid!==ae;if(t.delayError&&ne?(d=b(()=>w(K,ne)),d(t.delayError)):(clearTimeout(u),d=null,ne?nn(n.errors,K,ne):Un(n.errors,K)),(ne?!Hr(be,ne):be)||!Hs(ue)||ye){const ke={...ue,...ye&&bi(ae)?{isValid:ae}:{},errors:n.errors,name:K};n={...n,...ke},f.state.next(ke)}},L=async K=>{y(K,!0);const ae=await t.resolver(r,t.context,zfe(K||l.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return y(K),ae},I=async K=>{const{errors:ae}=await L(K);if(K)for(const ne of K){const ue=Ne(ae,ne);ue?nn(n.errors,ne,ue):Un(n.errors,ne)}else n.errors=ae;return ae},O=async(K,ae,ne={valid:!0})=>{for(const ue in K){const be=K[ue];if(be){const{_f:ye,...ke}=be;if(ye){const Ue=l.array.has(ye.name),pt=be._f&&Gfe(be._f);pt&&h.validatingFields&&y([ue],!0);const _t=await kT(be,l.disabled,r,x,t.shouldUseNativeValidation&&!ae,Ue);if(pt&&h.validatingFields&&y([ue]),_t[ye.name]&&(ne.valid=!1,ae))break;!ae&&(Ne(_t,ye.name)?Ue?Zfe(n.errors,_t,ye.name):nn(n.errors,ye.name,_t[ye.name]):Un(n.errors,ye.name))}!Hs(ke)&&await O(ke,ae,ne)}}return ne.valid},N=()=>{for(const K of l.unMount){const ae=Ne(s,K);ae&&(ae._f.refs?ae._f.refs.every(ne=>!gv(ne)):!gv(ae._f.ref))&&q(K)}l.unMount=new Set},_=(K,ae)=>!t.disabled&&(K&&ae&&nn(r,K,ae),!Hr(H(),o)),R=(K,ae,ne)=>u9(K,l,{...a.mount?r:Ln(ae)?o:nr(K)?{[K]:ae}:ae},ne,ae),D=K=>Py(Ne(a.mount?r:o,K,t.shouldUnregister?Ne(o,K,[]):[])),B=(K,ae,ne={})=>{const ue=Ne(s,K);let be=ae;if(ue){const ye=ue._f;ye&&(!ye.disabled&&nn(r,K,g9(ae,ye)),be=x1(ye.ref)&&Ws(ae)?"":ae,h9(ye.ref)?[...ye.ref.options].forEach(ke=>ke.selected=be.includes(ke.value)):ye.refs?Tm(ye.ref)?ye.refs.length>1?ye.refs.forEach(ke=>(!ke.defaultChecked||!ke.disabled)&&(ke.checked=Array.isArray(be)?!!be.find(Ue=>Ue===ke.value):be===ke.value)):ye.refs[0]&&(ye.refs[0].checked=!!be):ye.refs.forEach(ke=>ke.checked=ke.value===be):gj(ye.ref)?ye.ref.value="":(ye.ref.value=be,ye.ref.type||f.state.next({name:K,values:fs(r)})))}(ne.shouldDirty||ne.shouldTouch)&&P(K,be,ne.shouldTouch,ne.shouldDirty,!0),ne.shouldValidate&&te(K)},V=(K,ae,ne)=>{for(const ue in ae){const be=ae[ue],ye=`${K}.${ue}`,ke=Ne(s,ye);(l.array.has(K)||Dn(be)||ke&&!ke._f)&&!Hl(be)?V(ye,be,ne):B(ye,be,ne)}},ee=(K,ae,ne={})=>{const ue=Ne(s,K),be=l.array.has(K),ye=fs(ae);nn(r,K,ye),be?(f.array.next({name:K,values:fs(r)}),(h.isDirty||h.dirtyFields||p.isDirty||p.dirtyFields)&&ne.shouldDirty&&f.state.next({name:K,dirtyFields:fh(o,r),isDirty:_(K,ye)})):ue&&!ue._f&&!Ws(ye)?V(K,ye,ne):B(K,ye,ne),CT(K,l)&&f.state.next({...n}),f.state.next({name:a.mount?K:void 0,values:fs(r)})},se=async K=>{a.mount=!0;const ae=K.target;let ne=ae.name,ue=!0;const be=Ne(s,ne),ye=ke=>{ue=Number.isNaN(ke)||Hl(ke)&&isNaN(ke.getTime())||Hr(ke,Ne(r,ne,ke))};if(be){let ke,Ue;const pt=ae.type?yT(be._f):r9(K),_t=K.type===g1.BLUR||K.type===g1.FOCUS_OUT,vn=!Hfe(be._f)&&!t.resolver&&!Ne(n.errors,ne)&&!be._f.deps||qfe(_t,Ne(n.touchedFields,ne),n.isSubmitted,g,m),Cn=CT(ne,l,_t);nn(r,ne,pt),_t?(be._f.onBlur&&be._f.onBlur(K),d&&d(0)):be._f.onChange&&be._f.onChange(K);const gn=P(ne,pt,_t),Fn=!Hs(gn)||Cn;if(!_t&&f.state.next({name:ne,type:K.type,values:fs(r)}),vn)return(h.isValid||p.isValid)&&(t.mode==="onBlur"?_t&&C():_t||C()),Fn&&f.state.next({name:ne,...Cn?{}:gn});if(!_t&&Cn&&f.state.next({...n}),t.resolver){const{errors:Hi}=await L([ne]);if(ye(pt),ue){const $o=wT(n.errors,s,ne),mo=wT(Hi,s,$o.name||ne);ke=mo.error,ne=mo.name,Ue=Hs(Hi)}}else y([ne],!0),ke=(await kT(be,l.disabled,r,x,t.shouldUseNativeValidation))[ne],y([ne]),ye(pt),ue&&(ke?Ue=!1:(h.isValid||p.isValid)&&(Ue=await O(s,!0)));ue&&(be._f.deps&&te(be._f.deps),E(ne,Ue,ke,gn))}},oe=(K,ae)=>{if(Ne(n.errors,ae)&&K.focus)return K.focus(),1},te=async(K,ae={})=>{let ne,ue;const be=Bp(K);if(t.resolver){const ye=await I(Ln(K)?K:be);ne=Hs(ye),ue=K?!be.some(ke=>Ne(ye,ke)):ne}else K?(ue=(await Promise.all(be.map(async ye=>{const ke=Ne(s,ye);return await O(ke&&ke._f?{[ye]:ke}:ke)}))).every(Boolean),!(!ue&&!n.isValid)&&C()):ue=ne=await O(s);return f.state.next({...!nr(K)||(h.isValid||p.isValid)&&ne!==n.isValid?{}:{name:K},...t.resolver||!K?{isValid:ne}:{},errors:n.errors}),ae.shouldFocus&&!ue&&$p(s,oe,K?be:l.mount),ue},H=K=>{const ae={...a.mount?r:o};return Ln(K)?ae:nr(K)?Ne(ae,K):K.map(ne=>Ne(ae,ne))},z=(K,ae)=>({invalid:!!Ne((ae||n).errors,K),isDirty:!!Ne((ae||n).dirtyFields,K),error:Ne((ae||n).errors,K),isValidating:!!Ne(n.validatingFields,K),isTouched:!!Ne((ae||n).touchedFields,K)}),Z=K=>{K&&Bp(K).forEach(ae=>Un(n.errors,ae)),f.state.next({errors:K?n.errors:{}})},U=(K,ae,ne)=>{const ue=(Ne(s,K,{_f:{}})._f||{}).ref,be=Ne(n.errors,K)||{},{ref:ye,message:ke,type:Ue,...pt}=be;nn(n.errors,K,{...pt,...ae,ref:ue}),f.state.next({name:K,errors:n.errors,isValid:!1}),ne&&ne.shouldFocus&&ue&&ue.focus&&ue.focus()},Y=(K,ae)=>To(K)?f.state.subscribe({next:ne=>K(R(void 0,ae),ne)}):R(K,ae,!0),$=K=>f.state.subscribe({next:ae=>{Ufe(K.name,ae.name,K.exact)&&Wfe(ae,K.formState||h,ut,K.reRenderRoot)&&K.callback({values:{...r},...n,...ae})}}).unsubscribe,F=K=>(a.mount=!0,p={...p,...K.formState},$({...K,formState:p})),q=(K,ae={})=>{for(const ne of K?Bp(K):l.mount)l.mount.delete(ne),l.array.delete(ne),ae.keepValue||(Un(s,ne),Un(r,ne)),!ae.keepError&&Un(n.errors,ne),!ae.keepDirty&&Un(n.dirtyFields,ne),!ae.keepTouched&&Un(n.touchedFields,ne),!ae.keepIsValidating&&Un(n.validatingFields,ne),!t.shouldUnregister&&!ae.keepDefaultValue&&Un(o,ne);f.state.next({values:fs(r)}),f.state.next({...n,...ae.keepDirty?{isDirty:_()}:{}}),!ae.keepIsValid&&C()},ie=({disabled:K,name:ae})=>{(bi(K)&&a.mount||K||l.disabled.has(ae))&&(K?l.disabled.add(ae):l.disabled.delete(ae))},ce=(K,ae={})=>{let ne=Ne(s,K);const ue=bi(ae.disabled)||bi(t.disabled);return nn(s,K,{...ne||{},_f:{...ne&&ne._f?ne._f:{ref:{name:K}},name:K,mount:!0,...ae}}),l.mount.add(K),ne?ie({disabled:bi(ae.disabled)?ae.disabled:t.disabled,name:K}):S(K,!0,ae.value),{...ue?{disabled:ae.disabled||t.disabled}:{},...t.progressive?{required:!!ae.required,min:mh(ae.min),max:mh(ae.max),minLength:mh(ae.minLength),maxLength:mh(ae.maxLength),pattern:mh(ae.pattern)}:{},name:K,onChange:se,onBlur:se,ref:be=>{if(be){ce(K,ae),ne=Ne(s,K);const ye=Ln(be.value)&&be.querySelectorAll&&be.querySelectorAll("input,select,textarea")[0]||be,ke=Bfe(ye),Ue=ne._f.refs||[];if(ke?Ue.find(pt=>pt===ye):ye===ne._f.ref)return;nn(s,K,{_f:{...ne._f,...ke?{refs:[...Ue.filter(gv),ye,...Array.isArray(Ne(o,K))?[{}]:[]],ref:{type:ye.type,name:K}}:{ref:ye}}}),S(K,!1,void 0,ye)}else ne=Ne(s,K,{}),ne._f&&(ne._f.mount=!1),(t.shouldUnregister||ae.shouldUnregister)&&!(a9(l.array,K)&&a.action)&&l.unMount.add(K)}}},me=()=>t.shouldFocusError&&$p(s,oe,l.mount),Ie=K=>{bi(K)&&(f.state.next({disabled:K}),$p(s,(ae,ne)=>{const ue=Ne(s,ne);ue&&(ae.disabled=ue._f.disabled||K,Array.isArray(ue._f.refs)&&ue._f.refs.forEach(be=>{be.disabled=ue._f.disabled||K}))},0,!1))},we=(K,ae)=>async ne=>{let ue;ne&&(ne.preventDefault&&ne.preventDefault(),ne.persist&&ne.persist());let be=fs(r);if(f.state.next({isSubmitting:!0}),t.resolver){const{errors:ye,values:ke}=await L();n.errors=ye,be=ke}else await O(s);if(l.disabled.size)for(const ye of l.disabled)nn(be,ye,void 0);if(Un(n.errors,"root"),Hs(n.errors)){f.state.next({errors:{}});try{await K(be,ne)}catch(ye){ue=ye}}else ae&&await ae({...n.errors},ne),me(),setTimeout(me);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Hs(n.errors)&&!ue,submitCount:n.submitCount+1,errors:n.errors}),ue)throw ue},Ee=(K,ae={})=>{Ne(s,K)&&(Ln(ae.defaultValue)?ee(K,fs(Ne(o,K))):(ee(K,ae.defaultValue),nn(o,K,fs(ae.defaultValue))),ae.keepTouched||Un(n.touchedFields,K),ae.keepDirty||(Un(n.dirtyFields,K),n.isDirty=ae.defaultValue?_(K,fs(Ne(o,K))):_()),ae.keepError||(Un(n.errors,K),h.isValid&&C()),f.state.next({...n}))},ot=(K,ae={})=>{const ne=K?fs(K):o,ue=fs(ne),be=Hs(K),ye=be?o:ue;if(ae.keepDefaultValues||(o=ne),!ae.keepValues){if(ae.keepDirtyValues){const ke=new Set([...l.mount,...Object.keys(fh(o,r))]);for(const Ue of Array.from(ke))Ne(n.dirtyFields,Ue)?nn(ye,Ue,Ne(r,Ue)):ee(Ue,Ne(ye,Ue))}else{if(pj&&Ln(K))for(const ke of l.mount){const Ue=Ne(s,ke);if(Ue&&Ue._f){const pt=Array.isArray(Ue._f.refs)?Ue._f.refs[0]:Ue._f.ref;if(x1(pt)){const _t=pt.closest("form");if(_t){_t.reset();break}}}}for(const ke of l.mount)ee(ke,Ne(ye,ke))}r=fs(ye),f.array.next({values:{...ye}}),f.state.next({values:{...ye}})}l={mount:ae.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!h.isValid||!!ae.keepIsValid||!!ae.keepDirtyValues,a.watch=!!t.shouldUnregister,f.state.next({submitCount:ae.keepSubmitCount?n.submitCount:0,isDirty:be?!1:ae.keepDirty?n.isDirty:!!(ae.keepDefaultValues&&!Hr(K,o)),isSubmitted:ae.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:be?{}:ae.keepDirtyValues?ae.keepDefaultValues&&r?fh(o,r):n.dirtyFields:ae.keepDefaultValues&&K?fh(o,K):ae.keepDirty?n.dirtyFields:{},touchedFields:ae.keepTouched?n.touchedFields:{},errors:ae.keepErrors?n.errors:{},isSubmitSuccessful:ae.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},Fe=(K,ae)=>ot(To(K)?K(r):K,ae),Be=(K,ae={})=>{const ne=Ne(s,K),ue=ne&&ne._f;if(ue){const be=ue.refs?ue.refs[0]:ue.ref;be.focus&&(be.focus(),ae.shouldSelect&&To(be.select)&&be.select())}},ut=K=>{n={...n,...K}},ht={control:{register:ce,unregister:q,getFieldState:z,handleSubmit:we,setError:U,_subscribe:$,_runSchema:L,_getWatch:R,_getDirty:_,_setValid:C,_setFieldArray:v,_setDisabledField:ie,_setErrors:k,_getFieldArray:D,_reset:ot,_resetDefaultValues:()=>To(t.defaultValues)&&t.defaultValues().then(K=>{Fe(K,t.resetOptions),f.state.next({isLoading:!1})}),_removeUnmounted:N,_disableForm:Ie,_subjects:f,_proxyFormState:h,get _fields(){return s},get _formValues(){return r},get _state(){return a},set _state(K){a=K},get _defaultValues(){return o},get _names(){return l},set _names(K){l=K},get _formState(){return n},get _options(){return t},set _options(K){t={...t,...K}}},subscribe:F,trigger:te,register:ce,handleSubmit:we,watch:Y,setValue:ee,getValues:H,reset:Fe,resetField:Ee,clearErrors:Z,unregister:q,setError:U,setFocus:Be,getFieldState:z};return{...ht,formControl:ht}}const Qfe=typeof window<"u"?xe.useLayoutEffect:xe.useEffect;function Am(e={}){const t=xe.useRef(void 0),n=xe.useRef(void 0),[s,o]=xe.useState({isDirty:!1,isValidating:!1,isLoading:To(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:To(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...e.formControl?e.formControl:Xfe(e),formState:s},e.formControl&&e.defaultValues&&!To(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions));const r=t.current.control;return r._options=e,Qfe(()=>{const a=r._subscribe({formState:r._proxyFormState,callback:()=>o({...r._formState}),reRenderRoot:!0});return o(l=>({...l,isReady:!0})),r._formState.isReady=!0,a},[r]),xe.useEffect(()=>r._disableForm(e.disabled),[r,e.disabled]),xe.useEffect(()=>{e.mode&&(r._options.mode=e.mode),e.reValidateMode&&(r._options.reValidateMode=e.reValidateMode),e.errors&&!Hs(e.errors)&&r._setErrors(e.errors)},[r,e.errors,e.mode,e.reValidateMode]),xe.useEffect(()=>{e.shouldUnregister&&r._subjects.state.next({values:r._getWatch()})},[r,e.shouldUnregister]),xe.useEffect(()=>{if(r._proxyFormState.isDirty){const a=r._getDirty();a!==s.isDirty&&r._subjects.state.next({isDirty:a})}},[r,s.isDirty]),xe.useEffect(()=>{e.values&&!Hr(e.values,n.current)?(r._reset(e.values,r._options.resetOptions),n.current=e.values,o(a=>({...a}))):r._resetDefaultValues()},[r,e.values]),xe.useEffect(()=>{r._state.mount||(r._setValid(),r._state.mount=!0),r._state.watch&&(r._state.watch=!1,r._subjects.state.next({...r._formState})),r._removeUnmounted()}),t.current.formState=c9(s,r),t.current}const y9=c.memo(()=>{const e=A(G8),t=G(),[n,{isLoading:s}]=Nu(),{register:o,handleSubmit:r,formState:a,reset:l}=Am({defaultValues:{location:""},mode:"onChange"}),d=c.useCallback(()=>l(void 0,{keepValues:!0}),[l]),u=c.useCallback(p=>{p!=null&&p.location&&n({source:p.location,inplace:e,onSuccess:d,onError:d})},[n,d,e]),h=c.useCallback(p=>{t(H8(p.target.checked))},[t]);return i.jsx("form",{onSubmit:r(u),children:i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsx(T,{gap:2,alignItems:"flex-end",justifyContent:"space-between",children:i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:Me("modelManager.urlOrLocalPath")}),i.jsxs(T,{alignItems:"center",gap:3,w:"full",children:[i.jsx(St,{placeholder:Me("modelManager.simpleModelPlaceholder"),...o("location")}),i.jsx(de,{onClick:r(u),isDisabled:!a.dirtyFields.location,isLoading:s,size:"sm",children:Me("modelManager.install")})]}),i.jsx(Js,{children:Me("modelManager.urlOrLocalPathHelper")})]})}),i.jsx(Q,{children:i.jsxs(T,{flexDir:"column",gap:2,children:[i.jsxs(T,{gap:4,children:[i.jsx(_n,{isChecked:e,onChange:h}),i.jsxs(J,{children:[Me("modelManager.inplaceInstall")," (",Me("modelManager.localOnly"),")"]})]}),i.jsx(Js,{children:Me("modelManager.inplaceInstallDesc")})]})})]})})});y9.displayName="InstallModelForm";const xv={waiting:{colorScheme:"cyan",translationKey:"queue.pending"},downloading:{colorScheme:"yellow",translationKey:"queue.in_progress"},downloads_done:{colorScheme:"yellow",translationKey:"queue.in_progress"},running:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},error:{colorScheme:"red",translationKey:"queue.failed"},cancelled:{colorScheme:"orange",translationKey:"queue.canceled"}},Jfe=({status:e})=>{const{t}=M();return!e||!Object.keys(xv).includes(e)?null:i.jsx(Hn,{textAlign:"center",w:"134px",colorScheme:xv[e].colorScheme,children:t(xv[e].translationKey)})},eme=c.memo(Jfe),jT=e=>{const t=["B","KB","MB","GB","TB"];let n=0;for(n;e>=1024&&n<4;n++)e/=1024;return`${e.toFixed(2)} ${t[n]}`},b9=c.memo(e=>{const{installJob:t}=e,[n]=wQ(),s=c.useCallback(()=>{n(t.id).unwrap().then(l=>{ge({id:"MODEL_INSTALL_CANCELED",title:Me("toast.modelImportCanceled"),status:"success"})}).catch(l=>{l&&ge({id:"MODEL_INSTALL_CANCEL_FAILED",title:`${l.data.detail} `,status:"error"})})},[n,t]),o=c.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url;case"local":return t.source.path;default:return Me("common.unknown")}},[t.source]),r=c.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url.split("/").slice(-1)[0]??Me("common.unknown");case"local":return t.source.path.split("\\").slice(-1)[0]??Me("common.unknown");default:return Me("common.unknown")}},[t.source]),a=c.useMemo(()=>t.status==="completed"||t.status==="error"||t.status==="cancelled"?100:He(t.bytes)||He(t.total_bytes)?null:t.total_bytes===0?0:t.bytes/t.total_bytes*100,[t.bytes,t.status,t.total_bytes]);return i.jsxs(T,{gap:3,w:"full",alignItems:"center",children:[i.jsx(Oe,{maxW:600,label:i.jsx(v9,{name:r,source:o,installJob:t}),children:i.jsxs(T,{gap:3,w:"full",alignItems:"center",children:[i.jsx(W,{w:96,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:r}),i.jsx(W8,{w:"full",flexGrow:1,value:a??0,isIndeterminate:a===null,"aria-label":Me("accessibility.invokeProgressBar"),h:2}),i.jsx(eme,{status:t.status})]})}),i.jsx(le,{isDisabled:t.status!=="downloading"&&t.status!=="waiting"&&t.status!=="running",size:"xs",tooltip:Me("modelManager.cancel"),"aria-label":Me("modelManager.cancel"),icon:i.jsx(Rt,{}),onClick:s,variant:"ghost"})]})});b9.displayName="ModelInstallQueueItem";const v9=c.memo(({name:e,source:t,installJob:n})=>{const s=c.useMemo(()=>n.status!=="downloading"||n.bytes===void 0||n.total_bytes===void 0?"":`${jT(n.bytes)} / ${jT(n.total_bytes)}`,[n.bytes,n.total_bytes,n.status]);return i.jsxs(i.Fragment,{children:[i.jsxs(T,{gap:3,justifyContent:"space-between",children:[i.jsx(W,{fontWeight:"semibold",children:e}),s&&i.jsx(W,{children:s})]}),i.jsx(W,{fontStyle:"italic",wordBreak:"break-all",children:t}),n.error_reason&&i.jsxs(W,{color:"error.500",children:[Me("queue.failed"),": ",n.error]})]})});v9.displayName="TooltipLabel";const C9=c.memo(()=>{const{data:e}=SQ(),[t]=kQ(),n=c.useCallback(()=>{t().unwrap().then(o=>{ge({id:"MODEL_INSTALL_QUEUE_PRUNED",title:Me("toast.prunedQueue"),status:"success"})}).catch(o=>{o&&ge({id:"MODEL_INSTALL_QUEUE_PRUNE_FAILED",title:`${o.data.detail} `,status:"error"})})},[t]),s=c.useMemo(()=>e==null?void 0:e.some(o=>o.status==="cancelled"||o.status==="error"||o.status==="completed"),[e]);return i.jsxs(T,{flexDir:"column",p:3,h:"full",gap:3,children:[i.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[i.jsx(zt,{size:"sm",children:Me("modelManager.installQueue")}),i.jsx(de,{size:"sm",isDisabled:!s,onClick:n,tooltip:Me("modelManager.pruneTooltip"),children:Me("modelManager.prune")})]}),i.jsx(Ce,{layerStyle:"first",p:3,borderRadius:"base",w:"full",h:"full",children:i.jsx(ns,{children:i.jsx(T,{flexDir:"column-reverse",gap:"2",w:"full",children:e==null?void 0:e.map(o=>i.jsx(b9,{installJob:o},o.id))})})})]})});C9.displayName="ModelInstallQueue";const w9=c.memo(({result:e,installModel:t})=>{const{t:n}=M(),s=c.useCallback(()=>{t(e.path)},[t,e]);return i.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[i.jsxs(T,{fontSize:"sm",flexDir:"column",children:[i.jsx(W,{fontWeight:"semibold",children:e.path.split("\\").slice(-1)[0]}),i.jsx(W,{variant:"subtext",children:e.path})]}),i.jsx(Ce,{children:e.is_installed?i.jsx(Hn,{children:n("common.installed")}):i.jsx(le,{"aria-label":n("modelManager.install"),icon:i.jsx(Vt,{}),onClick:s,size:"sm"})})]})});w9.displayName="ScanModelResultItem";const S9=c.memo(({results:e})=>{const t=A(G8),n=G(),{t:s}=M(),[o,r]=c.useState(""),[a]=Nu(),l=c.useMemo(()=>e.filter(m=>{const g=m.path.split("\\").slice(-1)[0];return g==null?void 0:g.toLowerCase().includes(o.toLowerCase())}),[e,o]),d=c.useCallback(m=>{r(m.target.value.trim())},[]),u=c.useCallback(m=>{n(H8(m.target.checked))},[n]),h=c.useCallback(()=>{r("")},[]),p=c.useCallback(()=>{for(const m of l)m.is_installed||a({source:m.path,inplace:t})},[l,a,t]),f=c.useCallback(m=>{a({source:m,inplace:t})},[a,t]);return i.jsxs(i.Fragment,{children:[i.jsx(Ct,{}),i.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[i.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[i.jsx(zt,{size:"sm",children:s("modelManager.scanResults")}),i.jsxs(T,{alignItems:"center",gap:3,children:[i.jsxs(Q,{w:"min-content",children:[i.jsx(J,{m:0,children:s("modelManager.inplaceInstall")}),i.jsx(_n,{isChecked:t,onChange:u,size:"md"})]}),i.jsx(de,{size:"sm",onClick:p,isDisabled:l.length===0,children:s("modelManager.installAll")}),i.jsxs(Cr,{w:64,size:"xs",children:[i.jsx(St,{placeholder:s("modelManager.search"),value:o,"data-testid":"board-search-input",onChange:d,size:"xs"}),o&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:i.jsx(Rt,{}),onClick:h,flexShrink:0})})]})]})]}),i.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:i.jsx(ns,{children:i.jsx(T,{flexDir:"column",gap:3,children:l.map(m=>i.jsx(w9,{result:m,installModel:f},m.path))})})})]})]})});S9.displayName="ScanModelsResults";const tme=jQ(e=>e.scanPath),k9=c.memo(()=>{const e=A(tme),t=G(),[n,s]=c.useState(""),{t:o}=M(),[r,{isLoading:a,data:l}]=_Q(),d=c.useCallback(()=>{r({scan_path:e}).unwrap().catch(h=>{h&&s(h.data.detail)})},[r,e]),u=c.useCallback(h=>{t(IQ(h.target.value)),s("")},[t]);return i.jsxs(T,{flexDir:"column",height:"100%",gap:3,children:[i.jsxs(Q,{isInvalid:!!n.length,w:"full",orientation:"vertical",flexShrink:0,children:[i.jsx(J,{children:o("common.folder")}),i.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[i.jsx(St,{placeholder:o("modelManager.scanPlaceholder"),value:e,onChange:u}),i.jsx(de,{onClick:d,isLoading:a,isDisabled:e===void 0||e.length===0,size:"sm",flexShrink:0,children:o("modelManager.scanFolder")})]}),i.jsx(Js,{children:o("modelManager.scanFolderHelper")}),!!n.length&&i.jsx(xu,{children:n})]}),l&&i.jsx(S9,{results:l})]})});k9.displayName="ScanModelsForm";const Qa=Le(0),j9=c.memo(()=>{const{t:e}=M(),t=re(Qa),n=c.useCallback(o=>{Qa.set(o)},[]),s=c.useCallback(()=>{window.open("https://support.invoke.ai/support/solutions/articles/151000170961-supported-models")},[]);return i.jsxs(T,{layerStyle:"first",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:4,children:[i.jsxs(T,{alignItems:"center",justifyContent:"space-between",children:[i.jsx(zt,{fontSize:"xl",children:e("modelManager.addModel")}),i.jsx(de,{alignItems:"center",variant:"link",leftIcon:i.jsx(Ru,{}),onClick:s,children:i.jsx(W,{variant:"subtext",children:e("modelManager.learnMoreAboutSupportedModels")})})]}),i.jsxs(yc,{variant:"collapse",height:"50%",display:"flex",flexDir:"column",index:t,onChange:n,children:[i.jsxs(bc,{children:[i.jsx(Tn,{children:e("modelManager.urlOrLocalPath")}),i.jsx(Tn,{children:e("modelManager.huggingFace")}),i.jsx(Tn,{children:e("modelManager.scanFolder")}),i.jsx(Tn,{children:e("modelManager.starterModels")})]}),i.jsxs(yu,{p:3,height:"100%",children:[i.jsx(Vn,{children:i.jsx(y9,{})}),i.jsx(Vn,{height:"100%",children:i.jsx(i9,{})}),i.jsx(Vn,{height:"100%",children:i.jsx(k9,{})}),i.jsx(Vn,{height:"100%",children:i.jsx(J7,{})})]})]}),i.jsx(Ce,{layerStyle:"second",borderRadius:"base",h:"50%",children:i.jsx(C9,{})})]})});j9.displayName="InstallModels";const Jt=(e,t)=>(n=()=>!0)=>{const s=gu(void 0);return[c.useMemo(()=>s.data?aa.selectAll(s.data).filter(r=>e(r,t)).filter(n):Fs,[n,s.data]),s]},Ly=Jt(Z0),nme=Jt(zQ),Dy=Jt(AQ),sme=Jt(WQ),ime=Jt(UQ),ome=Jt(qQ),rme=Jt(KQ),Ry=Jt(TQ),_9=Jt(BQ),ame=Jt(jS),yj=Jt(RQ),I9=Jt(NQ),bj=e=>Jt(PQ,e==null?void 0:e.excludeSubmodels)(),Ec=e=>Jt(LQ,e==null?void 0:e.excludeSubmodels)(),Mm=Jt(DQ),T9=Jt(Hf),A9=Jt(OQ),Oy=e=>Jt(EQ,e==null?void 0:e.excludeSubmodels)(),M9=e=>Jt(MQ,e==null?void 0:e.excludeSubmodels)(),lme=Jt(FQ),E9=Jt($Q),P9=Jt(kS),cme=Jt(e=>Hf(e)||kS(e)||U8(e)),dme=Jt(e=>Hf(e)||kS(e)),L9=Jt(VQ),ume=Jt(GQ),hme=Jt(HQ),pme=Jt(U8),fme=(e,t)=>he(Px,n=>n.data?aa.selectAll(n.data).filter(t).find(s=>s.key===e)??null:null),T0="starterModels",mme=()=>{const{t:e}=M(),t=Bt("starterModels"),[n,s]=c.useState(!1),[o,{data:r}]=Ly(),a=Lx();c.useEffect(()=>{if(a.isActive(T0)){if(o.length===0)return;a.close(T0)}r&&o.length===0&&!n&&t&&a({id:T0,title:e("modelManager.noModelsInstalled"),description:i.jsx(gme,{}),status:"info",isClosable:!0,duration:null,onCloseComplete:()=>s(!0)})},[r,n,t,o.length,e,a])},gme=()=>{const{t:e}=M(),t=G(),n=Lx(),s=c.useCallback(()=>{t(Yt("models")),Qa.set(3),n.close(T0)},[t,n]);return i.jsxs(W,{fontSize:"md",children:[e("modelManager.noModelsInstalledDesc1")," ",i.jsxs(de,{onClick:s,variant:"link",color:"base.50",flexGrow:0,children:[e("ui.tabs.modelsTab"),"."]})]})},D9=he(Dx,e=>e.language),xme="default",yme=Le(xme),bme="https://invoke-ai.github.io/InvokeAI/faq/#unable-to-copy-on-firefox",fl=()=>{const{t:e}=M(),t=c.useCallback(()=>{ge({id:"CLIPBOARD_UNAVAILABLE",title:e("toast.unableToCopy"),description:i.jsx(i.Fragment,{children:i.jsxs(W,{fontSize:"md",children:[e("toast.unableToCopyDesc"),i.jsx(ii,{display:"inline",fontWeight:"semibold",href:bme,label:e("toast.unableToCopyDesc_theseSteps")}),"."]})}),status:"error"})},[e]),n=c.useMemo(()=>!(!navigator.clipboard||!window.ClipboardItem),[]),s=c.useCallback((a,l)=>{if(!n){t();return}navigator.clipboard.writeText(a),l==null||l()},[t,n]),o=c.useCallback((a,l)=>{if(!n){t();return}navigator.clipboard.write(a),l==null||l()},[t,n]),r=c.useCallback((a,l)=>{if(!n){t();return}const d=[new ClipboardItem({"image/png":a})];navigator.clipboard.write(d),l==null||l()},[t,n]);return{isAvailable:n,writeText:s,write:o,writeImage:r}},vme=c.memo(e=>e.image?i.jsx(_S,{w:`${e.image.width}px`,h:"auto",objectFit:"contain",aspectRatio:`${e.image.width}/${e.image.height}`}):i.jsx(T,{opacity:.7,w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",bg:"base.900",children:i.jsx(ci,{size:"xl"})}));vme.displayName="IAILoadingImageFallback";const Ot=c.memo(e=>{const{icon:t=su,boxSize:n=16,...s}=e;return i.jsxs(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",fontSize:"md",...s,children:[t&&i.jsx(at,{as:t,boxSize:n,opacity:.7}),e.label&&i.jsx(W,{textAlign:"center",children:e.label})]})});Ot.displayName="IAINoContentFallback";const Ny=c.memo(e=>{const{sx:t,...n}=e,s=c.useMemo(()=>({w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",...t}),[t]);return i.jsxs(T,{sx:s,...n,children:[i.jsx(ci,{size:"xl"}),e.label&&i.jsx(W,{textAlign:"center",children:e.label})]})});Ny.displayName="IAINoContentFallbackWithSpinner";const R9=c.memo(e=>i.jsx(at,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",...e,children:i.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})}));R9.displayName="InvokeLogoIcon";const O9=Symbol("LOADING"),Cme=()=>{const{data:e,isLoading:t}=vc({include_archived:!0}),{data:n,isLoading:s}=Cc({board_id:"none",offset:0,limit:0,is_intermediate:!1});return c.useMemo(()=>t||s?O9:e&&e.length>0&&e.filter(a=>a.image_count>0).length>0?!0:n?n.total>0:!0,[e,n,t,s])},N9=c.memo(()=>{const e=Cme(),[t,{data:n}]=Ly(),s=A(q8),o=Bt("starterModels"),r=A(On),{t:a}=M(),l=c.useMemo(()=>o&&n&&t.length===0,[t.length,n,o]);return e===O9?i.jsx(wme,{}):e?i.jsx(Ot,{icon:su,label:a("gallery.noImageSelected")}):i.jsxs(T,{flexDir:"column",gap:8,alignItems:"center",textAlign:"center",maxW:"400px",children:[i.jsx(R9,{w:32,h:32}),i.jsxs(T,{flexDir:"column",gap:4,alignItems:"center",textAlign:"center",children:[s?i.jsx(Sme,{}):r==="workflows"?i.jsx(jme,{}):i.jsx(kme,{}),l&&i.jsx(Ime,{}),i.jsx(Ct,{}),i.jsx(_me,{}),s&&i.jsx(Tme,{})]})]})});N9.displayName="NoContentForViewer";const wme=()=>i.jsx(T,{position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center",children:i.jsx(ci,{label:"Loading",color:"grey",position:"absolute",size:"sm",width:8,height:8,right:4,bottom:4})}),Fy=e=>i.jsx(de,{as:Wf,variant:"unstyled",isExternal:!0,display:"inline-flex",alignItems:"center",rightIcon:i.jsx(Sy,{}),color:"base.50",mt:-1,...e}),_T=e=>i.jsx(de,{variant:"link",size:"md",onClick:e.onClick,color:"base.50",children:e.children}),vj=i.jsx(W,{as:"span",color:"base.50",fontSize:"md"}),Sme=()=>i.jsx(W,{fontSize:"md",color:"base.200",children:i.jsx(Wt,{i18nKey:"newUserExperience.toGetStartedLocal",components:{StrongComponent:vj}})}),kme=()=>i.jsx(W,{fontSize:"md",color:"base.200",children:i.jsx(Wt,{i18nKey:"newUserExperience.toGetStarted",components:{StrongComponent:vj}})}),jme=()=>i.jsx(W,{fontSize:"md",color:"base.200",children:i.jsx(Wt,{i18nKey:"newUserExperience.toGetStartedWorkflow",components:{StrongComponent:vj}})}),_me=()=>i.jsx(W,{fontSize:"md",color:"base.200",children:i.jsx(Wt,{i18nKey:"newUserExperience.gettingStartedSeries",components:{LinkComponent:i.jsx(Fy,{href:"https://www.youtube.com/playlist?list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO"})}})}),Ime=()=>{const e=G(),t=c.useCallback(()=>{e(Yt("models")),Qa.set(3)},[e]),n=c.useCallback(()=>{e(Yt("models")),Qa.set(0)},[e]);return i.jsx(W,{fontSize:"md",color:"base.200",children:i.jsx(Wt,{i18nKey:"newUserExperience.noModelsInstalled",components:{DownloadStarterModelsButton:i.jsx(_T,{onClick:t}),ImportModelsButton:i.jsx(_T,{onClick:n})}})})},Tme=()=>i.jsxs(wc,{status:"warning",borderRadius:"base",fontSize:"md",shadow:"md",w:"fit-content",children:[i.jsx(Sc,{}),i.jsx(Ra,{children:i.jsx(Wt,{i18nKey:"newUserExperience.lowVRAMMode",components:{LinkComponent:i.jsx(Fy,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}})})]}),Ame=e=>e==="OutOfMemoryError"?Me("toast.outOfMemoryError"):Me("toast.serverError");function Mme({errorType:e,isLocal:t,sessionId:n,errorMessage:s}){const{t:o}=M(),r=fl(),a=c.useMemo(()=>{if(e==="OutOfMemoryError")return t?i.jsx(Wt,{i18nKey:"toast.outOfMemoryErrorDescLocal",components:{LinkComponent:i.jsx(Fy,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}}):o("toast.outOfMemoryErrorDesc");if(s)return`${e}: ${s}`},[s,e,t,o]),l=c.useCallback(()=>r.writeText(n),[n,r]);return i.jsxs(T,{flexDir:"column",children:[a&&i.jsx(W,{noOfLines:4,fontSize:"md",children:a}),!t&&i.jsxs(T,{gap:"2",alignItems:"center",children:[i.jsx(W,{fontSize:"sm",fontStyle:"italic",children:o("toast.sessionRef",{sessionId:n})}),i.jsx(le,{size:"sm","aria-label":"Copy",icon:i.jsx(pn,{}),onClick:l,variant:"ghost",sx:{svg:{fill:"base.50"}}})]})]})}const IT=Wn("events"),Eme=e=>e.invocation_source_id.split(":")[0]===eJ,Pme=["load_image","image"],Lme=(e,t)=>{const n=(l,d)=>{var S;if(Pme.includes(l.invocation.type)){IT.trace(`Skipping denylisted node type (${l.invocation.type})`);return}const u={},h=new Set,p=new Set;for(const P of d){if(P.is_intermediate)return;const E=P.board_id??"none";u[E]=(u[E]||0)+1,h.add(E),p.add(QQ({board_id:E,categories:JQ(P)}))}const f=[];for(const[P,E]of gC(u)){const L=(S=w4.endpoints.getBoardImagesTotal.select(P)(e()).data)==null?void 0:S.total;L!==void 0&&f.push({endpointName:"getBoardImagesTotal",arg:P,value:{total:L+E}})}t(w4.util.upsertQueryEntries(f));const m=Array.from(h).map(P=>({type:"Board",id:P})),g=Array.from(p).map(P=>({type:"ImageList",id:P}));t(IS.util.invalidateTags([...m,...g]));const x=d.at(-1);if(!x)return;const{image_name:b,board_id:C}=x,{shouldAutoSwitch:y,selectedBoardId:v,galleryView:w,offset:k}=e().gallery;y&&(C&&C!==v?t(rf({boardId:C,selectedImageName:b})):!C&&v!=="none"?t(rf({boardId:"none",selectedImageName:b})):(t(K8(x)),w!=="images"?t(U2("images")):k>0&&t(Z8({offset:0}))))},s=async l=>{const{result:d}=l,u=[];for(const[h,p]of gC(d))if(YQ(p)){const f=await Xd(p.image_name);f&&u.push(f)}else if(XQ(p))for(const f of p){const m=await Xd(f.image_name);m&&u.push(m)}return u},o=async l=>{const{result:d,invocation_source_id:u}=l,h=gt(rd.get()[u]);h&&(h.status=ti.enum.COMPLETED,h.progress!==null&&(h.progress=1),h.outputs.push(d),b0(h.nodeId,h));const p=await s(l);n(l,p)},r=async l=>{const u=(await s(l))[0];u&&(l.destination==="canvas"?Eme(l)&&(l.result.type==="image_output"&&t(ZQ({stagingAreaImage:{imageDTO:u,offsetX:0,offsetY:0}})),n(l,[u])):u.is_intermediate||n(l,[u]))},a=async l=>{const d=await s(l);n(l,d)};return async l=>{IT.debug({data:l},`Invocation complete (${l.invocation.type}, ${l.invocation_source_id})`),l.origin==="workflows"?await o(l):l.origin==="canvas"?await r(l):await a(l),zr.set(null)}},TT=Wn("events"),Dme=qo.endpoints.listModelInstalls.select(),HC=Te("unauthorized-toast"),AT=Te("forbidden-toast"),Rme=e=>{switch(e){case"invalid":return Me("modelManager.hfTokenInvalid");case"unknown":return Me("modelManager.hfTokenUnableToVerify");case"valid":return"HF Token is valid, but does not have access to model"}},Ome=async e=>{const t=e(qo.endpoints.getHFTokenStatus.initiate(void 0,{subscribe:!1}));try{return await t.unwrap()}catch{return null}},Nme=(e,t)=>async n=>{TT.error({data:n},"Model install error");const s=Dme(e()).data;if(n.error==="Unauthorized")if(n.source.type==="hf"){const r=await Ome(t);if(r===null)TT.error("Error getting HF token status");else{const a=Rme(r);ge({id:HC,title:a,description:i.jsx(Fme,{}),status:"error",isClosable:!0,duration:null})}}else n.source.type==="url"?ge({id:HC,title:"Model requires authorization",description:i.jsxs(W,{fontSize:"md",children:[Me("modelManager.urlUnauthorizedErrorMessage"),i.jsx(ii,{label:Me("modelManager.urlUnauthorizedErrorMessage2"),href:"https://invoke-ai.github.io/InvokeAI/configuration/#model-marketplace-api-keys"})]}),status:"error",isClosable:!0,duration:null}):ve(!1,"Unexpected unauthorized error for path source");else n.error==="Forbidden"?n.source.type==="hf"?ge({id:AT,title:Me("modelManager.hfForbidden"),description:i.jsxs(W,{fontSize:"md",children:[Me("modelManager.hfForbiddenErrorMessage"),i.jsx(ii,{label:n.source.repo_id,href:`https://huggingface.co/${n.source.repo_id}`})]}),status:"error",isClosable:!0,duration:null}):n.source.type==="url"?ge({id:AT,title:Me("modelManager.urlForbidden"),description:Me("modelManager.urlForbiddenErrorMessage"),status:"error",isClosable:!0,duration:null}):ve(!1,"Unexpected forbidden error for path source"):ge({title:"Model install error",description:n.error,status:"error",isClosable:!0,duration:null});const o=s==null?void 0:s.find(r=>r.id===n.id);o?(o.source,t(qo.util.updateQueryData("listModelInstalls",void 0,r=>{const a=r.find(l=>l.id===n.id);return a&&(a.status="error",a.error_reason=n.error_type,a.error=n.error),r}))):t(Ho.util.invalidateTags([{type:"ModelInstalls"}]))},Fme=()=>{const e=Bt("hfToken"),{data:t}=z8(e?void 0:cs),{t:n}=M(),s=G(),o=c.useCallback(()=>{s(Yt("models")),tJ.close(HC)},[s]);if(!t)return i.jsx(ci,{});if(t==="invalid")return i.jsxs(W,{fontSize:"md",children:[n("modelManager.hfTokenInvalidErrorMessage")," ",n("modelManager.hfTokenRequired")," ",n("modelManager.hfTokenInvalidErrorMessage2"),i.jsxs(de,{onClick:o,variant:"link",color:"base.50",flexGrow:0,children:[n("modelManager.modelManager"),"."]})]});if(t==="unknown")return i.jsxs(W,{fontSize:"md",children:[n("modelManager.hfTokenUnableToErrorMessage")," ",i.jsxs(de,{onClick:o,variant:"link",color:"base.50",flexGrow:0,children:[n("modelManager.modelManager"),"."]})]});ve(!1,"Unexpected valid HF token with unauthorized error")},an=Wn("events"),Kc=qo.endpoints.listModelInstalls.select(),Bme=({socket:e,store:t,setIsConnected:n})=>{const{dispatch:s,getState:o}=t;e.on("connect",()=>{an.debug("Connected"),n(!0),s(nJ());const l=sJ.get();if(e.emit("subscribe_queue",{queue_id:l}),!Y8.get()){const d=yme.get();e.emit("subscribe_bulk_download",{bulk_download_id:d})}zr.set(null)}),e.on("connect_error",l=>{an.debug("Connect error"),n(!1),zr.set(null),l&&l.message&&l.data==="ERR_UNAUTHENTICATED"&&ge({id:`connect-error-${l.message}`,title:l.message,status:"error",duration:1e4})}),e.on("disconnect",()=>{an.debug("Disconnected"),zr.set(null),n(!1)}),e.on("invocation_started",l=>{const{invocation_source_id:d,invocation:u}=l;an.debug({data:l},`Invocation started (${u.type}, ${d})`);const h=gt(rd.get()[d]);h&&(h.status=ti.enum.IN_PROGRESS,b0(h.nodeId,h))}),e.on("invocation_progress",l=>{const{invocation_source_id:d,invocation:u,image:h,origin:p,percentage:f,message:m}=l;let g="Invocation progress";if(m&&(g+=`: ${m}`),He(f)||(g+=` ${Uf(f*100,2)}%`),g+=` (${u.type}, ${d})`,an.trace({data:l},g),zr.set(l),p==="workflows"){const x=gt(rd.get()[d]);x&&(x.status=ti.enum.IN_PROGRESS,x.progress=f,x.progressImage=h??null,b0(x.nodeId,x))}}),e.on("invocation_error",l=>{const{invocation_source_id:d,invocation:u,error_type:h,error_message:p,error_traceback:f}=l;an.error({data:l},`Invocation error (${u.type}, ${d})`);const m=gt(rd.get()[d]);m&&(m.status=ti.enum.FAILED,m.progress=null,m.progressImage=null,m.error={error_type:h,error_message:p,error_traceback:f},b0(m.nodeId,m))});const r=Lme(o,s);e.on("invocation_complete",r),e.on("model_load_started",l=>{const{config:d,submodel_type:u}=l,{name:h,base:p,type:f}=d,m=[p,f];u&&m.push(u);const g=`Model load started: ${h} (${m.join(", ")})`;an.debug({data:l},g)}),e.on("model_load_complete",l=>{const{config:d,submodel_type:u}=l,{name:h,base:p,type:f}=d,m=[p,f];u&&m.push(u);const g=`Model load complete: ${h} (${m.join(", ")})`;an.debug({data:l},g)}),e.on("download_started",l=>{an.debug({data:l},"Download started")}),e.on("download_progress",l=>{an.trace({data:l},"Download progress")}),e.on("download_complete",l=>{an.debug({data:l},"Download complete")}),e.on("download_cancelled",l=>{an.warn({data:l},"Download cancelled")}),e.on("download_error",l=>{an.error({data:l},"Download error")}),e.on("model_install_started",l=>{an.debug({data:l},"Model install started");const{id:d}=l,u=Kc(o()).data;u!=null&&u.find(h=>h.id===d)?s(qo.util.updateQueryData("listModelInstalls",void 0,h=>{const p=h.find(f=>f.id===d);return p&&(p.status="running"),h})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_started",l=>{an.debug({data:l},"Model install download started");const{id:d}=l,u=Kc(o()).data;u!=null&&u.find(h=>h.id===d)?s(qo.util.updateQueryData("listModelInstalls",void 0,h=>{const p=h.find(f=>f.id===d);return p&&(p.status="downloading"),h})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_progress",l=>{an.trace({data:l},"Model install download progress");const{bytes:d,total_bytes:u,id:h}=l,p=Kc(o()).data;p!=null&&p.find(f=>f.id===h)?s(qo.util.updateQueryData("listModelInstalls",void 0,f=>{const m=f.find(g=>g.id===h);return m&&(m.bytes=d,m.total_bytes=u,m.status="downloading"),f})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_downloads_complete",l=>{an.debug({data:l},"Model install downloads complete");const{id:d}=l,u=Kc(o()).data;u!=null&&u.find(h=>h.id===d)?s(qo.util.updateQueryData("listModelInstalls",void 0,h=>{const p=h.find(f=>f.id===d);return p&&(p.status="downloads_done"),h})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_complete",l=>{an.debug({data:l},"Model install complete");const{id:d}=l,u=Kc(o()).data;u!=null&&u.find(h=>h.id===d)?s(qo.util.updateQueryData("listModelInstalls",void 0,h=>{const p=h.find(f=>f.id===d);return p&&(p.status="completed"),h})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}])),s(Ho.util.invalidateTags([{type:"ModelConfig",id:S4}])),s(Ho.util.invalidateTags([{type:"ModelScanFolderResults",id:S4}]))});const a=Nme(o,s);e.on("model_install_error",a),e.on("model_install_cancelled",l=>{an.warn({data:l},"Model install cancelled");const{id:d}=l,u=Kc(o()).data;u!=null&&u.find(h=>h.id===d)?s(qo.util.updateQueryData("listModelInstalls",void 0,h=>{const p=h.find(f=>f.id===d);return p&&(p.status="cancelled"),h})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("queue_item_status_changed",l=>{const{item_id:d,session_id:u,status:h,started_at:p,updated_at:f,completed_at:m,batch_status:g,queue_status:x,error_type:b,error_message:C,error_traceback:y,destination:v,credits:w}=l;an.debug({data:l},`Queue item ${d} status updated: ${h}`),s($l.util.updateQueryData("listQueueItems",void 0,S=>{iJ.updateOne(S,{id:String(d),changes:{status:h,started_at:p,updated_at:f??void 0,completed_at:m??void 0,error_type:b,error_message:C,error_traceback:y,credits:w}})})),s($l.util.updateQueryData("getQueueStatus",void 0,S=>{S&&Object.assign(S.queue,x)})),s($l.util.updateQueryData("getBatchStatus",{batch_id:g.batch_id},()=>g));const k=["CurrentSessionQueueItem","NextSessionQueueItem","InvocationCacheStatus",{type:"SessionQueueItem",id:d}];if(v&&k.push({type:"QueueCountsByDestination",id:v}),s($l.util.invalidateTags(k)),h==="in_progress")oJ(rd.get(),S=>{if(!S)return;const P=gt(S);P.status=ti.enum.PENDING,P.error=null,P.progress=null,P.progressImage=null,P.outputs=[],rd.setKey(P.nodeId,P)});else if(h==="completed"||h==="failed"||h==="canceled"){if(h==="failed"&&b){const P=o().config.isLocal??!0,E=u;ge({id:`INVOCATION_ERROR_${b}`,title:Ame(b),status:"error",duration:null,updateDescription:P,description:i.jsx(Mme,{errorType:b,errorMessage:C,sessionId:E,isLocal:P})})}zr.set(null);const S=t1.get();if(!S||g.batch_id!==S.batchId||h!=="completed")return;rJ.startListening({matcher:aJ(Ta.endpoints.getWorkflow.matchFulfilled,Ta.endpoints.getWorkflow.matchRejected),effect:(P,E)=>{Ta.endpoints.getWorkflow.matchFulfilled(P)?P.payload.workflow_id===S.workflowId&&(E.unsubscribe(),t1.set(null),ca.set(!1),sa.set(null)):Ta.endpoints.getWorkflow.matchRejected(P)&&E.unsubscribe()}}),s(Ta.util.invalidateTags([{type:"Workflow",id:S.workflowId}]))}}),e.on("queue_cleared",l=>{an.debug({data:l},"Queue cleared")}),e.on("batch_enqueued",l=>{an.debug({data:l},"Batch enqueued")}),e.on("queue_items_retried",l=>{an.debug({data:l},"Queue items retried")}),e.on("bulk_download_started",l=>{an.debug({data:l},"Bulk gallery download preparation started")}),e.on("bulk_download_complete",l=>{an.debug({data:l},"Bulk gallery download ready");const{bulk_download_item_name:d}=l,u=`/api/v1/images/download/${d}`;ge({id:d,title:Me("gallery.bulkDownloadReady","Download ready"),status:"success",description:i.jsx(ii,{label:Me("gallery.clickToDownload","Click here to download"),href:u,download:d}),duration:null})}),e.on("bulk_download_error",l=>{an.error({data:l},"Bulk gallery download error");const{bulk_download_item_name:d,error:u}=l;ge({id:d,title:Me("gallery.bulkDownloadFailed"),status:"error",description:u,duration:null})})},yr=Object.create(null);yr.open="0";yr.close="1";yr.ping="2";yr.pong="3";yr.message="4";yr.upgrade="5";yr.noop="6";const A0=Object.create(null);Object.keys(yr).forEach(e=>{A0[yr[e]]=e});const WC={type:"error",data:"parser error"},F9=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",B9=typeof ArrayBuffer=="function",$9=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Cj=({type:e,data:t},n,s)=>F9&&t instanceof Blob?n?s(t):MT(t,s):B9&&(t instanceof ArrayBuffer||$9(t))?n?s(t):MT(new Blob([t]),s):s(yr[e]+(t||"")),MT=(e,t)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];t("b"+(s||""))},n.readAsDataURL(e)};function ET(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let yv;function $me(e,t){if(F9&&e.data instanceof Blob)return e.data.arrayBuffer().then(ET).then(t);if(B9&&(e.data instanceof ArrayBuffer||$9(e.data)))return t(ET(e.data));Cj(e,!1,n=>{yv||(yv=new TextEncoder),t(yv.encode(n))})}const PT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_p=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<PT.length;e++)_p[PT.charCodeAt(e)]=e;const Vme=e=>{let t=e.length*.75,n=e.length,s,o=0,r,a,l,d;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const u=new ArrayBuffer(t),h=new Uint8Array(u);for(s=0;s<n;s+=4)r=_p[e.charCodeAt(s)],a=_p[e.charCodeAt(s+1)],l=_p[e.charCodeAt(s+2)],d=_p[e.charCodeAt(s+3)],h[o++]=r<<2|a>>4,h[o++]=(a&15)<<4|l>>2,h[o++]=(l&3)<<6|d&63;return u},zme=typeof ArrayBuffer=="function",wj=(e,t)=>{if(typeof e!="string")return{type:"message",data:V9(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:Gme(e.substring(1),t)}:A0[n]?e.length>1?{type:A0[n],data:e.substring(1)}:{type:A0[n]}:WC},Gme=(e,t)=>{if(zme){const n=Vme(e);return V9(n,t)}else return{base64:!0,data:e}},V9=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},z9="",Hme=(e,t)=>{const n=e.length,s=new Array(n);let o=0;e.forEach((r,a)=>{Cj(r,!1,l=>{s[a]=l,++o===n&&t(s.join(z9))})})},Wme=(e,t)=>{const n=e.split(z9),s=[];for(let o=0;o<n.length;o++){const r=wj(n[o],t);if(s.push(r),r.type==="error")break}return s};function Ume(){return new TransformStream({transform(e,t){$me(e,n=>{const s=n.length;let o;if(s<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,s);else if(s<65536){o=new Uint8Array(3);const r=new DataView(o.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{o=new Uint8Array(9);const r=new DataView(o.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(o[0]|=128),t.enqueue(o),t.enqueue(n)})}})}let bv;function Eg(e){return e.reduce((t,n)=>t+n.length,0)}function Pg(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let o=0;o<t;o++)n[o]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function qme(e,t){bv||(bv=new TextDecoder);const n=[];let s=0,o=-1,r=!1;return new TransformStream({transform(a,l){for(n.push(a);;){if(s===0){if(Eg(n)<1)break;const d=Pg(n,1);r=(d[0]&128)===128,o=d[0]&127,o<126?s=3:o===126?s=1:s=2}else if(s===1){if(Eg(n)<2)break;const d=Pg(n,2);o=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),s=3}else if(s===2){if(Eg(n)<8)break;const d=Pg(n,8),u=new DataView(d.buffer,d.byteOffset,d.length),h=u.getUint32(0);if(h>Math.pow(2,21)-1){l.enqueue(WC);break}o=h*Math.pow(2,32)+u.getUint32(4),s=3}else{if(Eg(n)<o)break;const d=Pg(n,o);l.enqueue(wj(r?d:bv.decode(d),t)),s=0}if(o===0||o>e){l.enqueue(WC);break}}}})}const G9=4;function zn(e){if(e)return Kme(e)}function Kme(e){for(var t in zn.prototype)e[t]=zn.prototype[t];return e}zn.prototype.on=zn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};zn.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};zn.prototype.off=zn.prototype.removeListener=zn.prototype.removeAllListeners=zn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,o=0;o<n.length;o++)if(s=n[o],s===t||s.fn===t){n.splice(o,1);break}return n.length===0&&delete this._callbacks["$"+e],this};zn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,o=n.length;s<o;++s)n[s].apply(this,t)}return this};zn.prototype.emitReserved=zn.prototype.emit;zn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};zn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const By=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),Xi=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Zme="arraybuffer";function H9(e,...t){return t.reduce((n,s)=>(e.hasOwnProperty(s)&&(n[s]=e[s]),n),{})}const Yme=Xi.setTimeout,Xme=Xi.clearTimeout;function $y(e,t){t.useNativeTimers?(e.setTimeoutFn=Yme.bind(Xi),e.clearTimeoutFn=Xme.bind(Xi)):(e.setTimeoutFn=Xi.setTimeout.bind(Xi),e.clearTimeoutFn=Xi.clearTimeout.bind(Xi))}const Qme=1.33;function Jme(e){return typeof e=="string"?ege(e):Math.ceil((e.byteLength||e.size)*Qme)}function ege(e){let t=0,n=0;for(let s=0,o=e.length;s<o;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}function W9(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function tge(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function nge(e){let t={},n=e.split("&");for(let s=0,o=n.length;s<o;s++){let r=n[s].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}class sge extends Error{constructor(t,n,s){super(t),this.description=n,this.context=s,this.type="TransportError"}}class Sj extends zn{constructor(t){super(),this.writable=!1,$y(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,s){return super.emitReserved("error",new sge(t,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=wj(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=tge(t);return n.length?"?"+n:""}}class ige extends Sj{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Wme(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Hme(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=W9()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let U9=!1;try{U9=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const oge=U9;function rge(){}class age extends ige{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,n){const s=this.request({method:"POST",data:t});s.on("success",n),s.on("error",(o,r)=>{this.onError("xhr post error",o,r)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=t}}class lr extends zn{constructor(t,n,s){super(),this.createRequest=t,$y(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const n=H9(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&s.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var o;s.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=lr.requestsCount++,lr.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=rge,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete lr.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}lr.requestsCount=0;lr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",LT);else if(typeof addEventListener=="function"){const e="onpagehide"in Xi?"pagehide":"unload";addEventListener(e,LT,!1)}}function LT(){for(let e in lr.requests)lr.requests.hasOwnProperty(e)&&lr.requests[e].abort()}const lge=function(){const e=q9({xdomain:!1});return e&&e.responseType!==null}();class cge extends age{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=lge&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new lr(q9,this.uri(),t)}}function q9(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||oge))return new XMLHttpRequest}catch{}if(!t)try{return new Xi[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const K9=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class dge extends Sj{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,s=K9?{}:H9(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,s)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],o=n===t.length-1;Cj(s,this.supportsBinary,r=>{try{this.doWrite(s,r)}catch{}o&&By(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=W9()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const vv=Xi.WebSocket||Xi.MozWebSocket;let uge=class extends dge{createSocket(t,n,s){return K9?new vv(t,n,s):n?new vv(t,n):new vv(t)}doWrite(t,n){this.ws.send(n)}};class hge extends Sj{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=qme(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(n).getReader(),o=Ume();o.readable.pipeTo(t.writable),this._writer=o.writable.getWriter();const r=()=>{s.read().then(({done:l,value:d})=>{l||(this.onPacket(d),r())}).catch(l=>{})};r();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],o=n===t.length-1;this._writer.write(s).then(()=>{o&&By(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const pge={websocket:uge,webtransport:hge,polling:cge},fge=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,mge=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function UC(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");n!=-1&&s!=-1&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let o=fge.exec(e||""),r={},a=14;for(;a--;)r[mge[a]]=o[a]||"";return n!=-1&&s!=-1&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=gge(r,r.path),r.queryKey=xge(r,r.query),r}function gge(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function xge(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,o,r){o&&(n[o]=r)}),n}const qC=typeof addEventListener=="function"&&typeof removeEventListener=="function",M0=[];qC&&addEventListener("offline",()=>{M0.forEach(e=>e())},!1);class Wa extends zn{constructor(t,n){if(super(),this.binaryType=Zme,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const s=UC(t);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=UC(n.host).host);$y(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const o=s.prototype.name;this.transports.push(o),this._transportsByName[o]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=nge(this.opts.query)),qC&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},M0.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=G9,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Wa.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Wa.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const o=this.writeBuffer[s].data;if(o&&(n+=Jme(o)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,By(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,s){return this._sendPacket("message",t,n,s),this}send(t,n,s){return this._sendPacket("message",t,n,s),this}_sendPacket(t,n,s,o){if(typeof n=="function"&&(o=n,n=void 0),typeof s=="function"&&(o=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const r={type:t,data:n,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(Wa.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),qC&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=M0.indexOf(this._offlineEventListener);s!==-1&&M0.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}Wa.protocol=G9;class yge extends Wa{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),s=!1;Wa.priorWebsocketSuccess=!1;const o=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",p=>{if(!s)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Wa.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=n.name,this.emitReserved("upgradeError",f)}}))};function r(){s||(s=!0,h(),n.close(),n=null)}const a=p=>{const f=new Error("probe error: "+p);f.transport=n.name,r(),this.emitReserved("upgradeError",f)};function l(){a("transport closed")}function d(){a("socket closed")}function u(p){n&&p.name!==n.name&&r()}const h=()=>{n.removeListener("open",o),n.removeListener("error",a),n.removeListener("close",l),this.off("close",d),this.off("upgrading",u)};n.once("open",o),n.once("error",a),n.once("close",l),this.once("close",d),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}let bge=class extends yge{constructor(t,n={}){const s=typeof t=="object"?t:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(o=>pge[o]).filter(o=>!!o)),super(t,s)}};function vge(e,t="",n){let s=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),s=UC(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+t,s.href=s.protocol+"://"+r+(n&&n.port===s.port?"":":"+s.port),s}const Cge=typeof ArrayBuffer=="function",wge=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Z9=Object.prototype.toString,Sge=typeof Blob=="function"||typeof Blob<"u"&&Z9.call(Blob)==="[object BlobConstructor]",kge=typeof File=="function"||typeof File<"u"&&Z9.call(File)==="[object FileConstructor]";function kj(e){return Cge&&(e instanceof ArrayBuffer||wge(e))||Sge&&e instanceof Blob||kge&&e instanceof File}function E0(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,s=e.length;n<s;n++)if(E0(e[n]))return!0;return!1}if(kj(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return E0(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&E0(e[n]))return!0;return!1}function jge(e){const t=[],n=e.data,s=e;return s.data=KC(n,t),s.attachments=t.length,{packet:s,buffers:t}}function KC(e,t){if(!e)return e;if(kj(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=KC(e[s],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=KC(e[s],t));return n}return e}function _ge(e,t){return e.data=ZC(e.data,t),delete e.attachments,e}function ZC(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=ZC(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=ZC(e[n],t));return e}const Ige=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Tge=5;var Mt;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(Mt||(Mt={}));class Age{constructor(t){this.replacer=t}encode(t){return(t.type===Mt.EVENT||t.type===Mt.ACK)&&E0(t)?this.encodeAsBinary({type:t.type===Mt.EVENT?Mt.BINARY_EVENT:Mt.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===Mt.BINARY_EVENT||t.type===Mt.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=jge(t),s=this.encodeAsString(n.packet),o=n.buffers;return o.unshift(s),o}}function DT(e){return Object.prototype.toString.call(e)==="[object Object]"}class jj extends zn{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const s=n.type===Mt.BINARY_EVENT;s||n.type===Mt.BINARY_ACK?(n.type=s?Mt.EVENT:Mt.ACK,this.reconstructor=new Mge(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(kj(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const s={type:Number(t.charAt(0))};if(Mt[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===Mt.BINARY_EVENT||s.type===Mt.BINARY_ACK){const r=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const a=t.substring(r,n);if(a!=Number(a)||t.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(a)}if(t.charAt(n+1)==="/"){const r=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););s.nsp=t.substring(r,n)}else s.nsp="/";const o=t.charAt(n+1);if(o!==""&&Number(o)==o){const r=n+1;for(;++n;){const a=t.charAt(n);if(a==null||Number(a)!=a){--n;break}if(n===t.length)break}s.id=Number(t.substring(r,n+1))}if(t.charAt(++n)){const r=this.tryParse(t.substr(n));if(jj.isPayloadValid(s.type,r))s.data=r;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case Mt.CONNECT:return DT(n);case Mt.DISCONNECT:return n===void 0;case Mt.CONNECT_ERROR:return typeof n=="string"||DT(n);case Mt.EVENT:case Mt.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&Ige.indexOf(n[0])===-1);case Mt.ACK:case Mt.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Mge{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=_ge(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ege=Object.freeze(Object.defineProperty({__proto__:null,Decoder:jj,Encoder:Age,get PacketType(){return Mt},protocol:Tge},Symbol.toStringTag,{value:"Module"}));function jo(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Pge=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Y9 extends zn{constructor(t,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[jo(t,"open",this.onopen.bind(this)),jo(t,"packet",this.onpacket.bind(this)),jo(t,"error",this.onerror.bind(this)),jo(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var s,o,r;if(Pge.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:Mt.EVENT,data:n};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const h=this.ids++,p=n.pop();this._registerAckCallback(h,p),a.id=h}const l=(o=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||o===void 0?void 0:o.writable,d=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!l||(d?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(t,n){var s;const o=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(o===void 0){this.acks[t]=n;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===t&&this.sendBuffer.splice(l,1);n.call(this,new Error("operation has timed out"))},o),a=(...l)=>{this.io.clearTimeoutFn(r),n.apply(this,l)};a.withError=!0,this.acks[t]=a}emitWithAck(t,...n){return new Promise((s,o)=>{const r=(a,l)=>a?o(a):s(l);r.withError=!0,n.push(r),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((o,...r)=>s!==this._queue[0]?void 0:(o!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(o)):(this._queue.shift(),n&&n(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Mt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Mt.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Mt.EVENT:case Mt.BINARY_EVENT:this.onevent(t);break;case Mt.ACK:case Mt.BINARY_ACK:this.onack(t);break;case Mt.DISCONNECT:this.ondisconnect();break;case Mt.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let s=!1;return function(...o){s||(s=!0,n.packet({type:Mt.ACK,id:t,data:o}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Mt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,t.data)}}}function Fu(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Fu.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-n:e+n}return Math.min(e,this.max)|0};Fu.prototype.reset=function(){this.attempts=0};Fu.prototype.setMin=function(e){this.ms=e};Fu.prototype.setMax=function(e){this.max=e};Fu.prototype.setJitter=function(e){this.jitter=e};class YC extends zn{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,$y(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Fu({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const o=n.parser||Ege;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new bge(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const o=jo(n,"open",function(){s.onopen(),t&&t()}),r=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),t?t(l):this.maybeReconnectOnOpen()},a=jo(n,"error",r);if(this._timeout!==!1){const l=this._timeout,d=this.setTimeoutFn(()=>{o(),r(new Error("timeout")),n.close()},l);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(o),this.subs.push(a),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(jo(t,"ping",this.onping.bind(this)),jo(t,"data",this.ondata.bind(this)),jo(t,"error",this.onerror.bind(this)),jo(t,"close",this.onclose.bind(this)),jo(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){By(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new Y9(this,t,n),this.nsps[t]=s),s}_destroy(t){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let s=0;s<n.length;s++)this.engine.write(n[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(o=>{o?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",o)):t.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const gh={};function P0(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=vge(e,t.path||"/socket.io"),s=n.source,o=n.id,r=n.path,a=gh[o]&&r in gh[o].nsps,l=t.forceNew||t["force new connection"]||t.multiplex===!1||a;let d;return l?d=new YC(s,t):(gh[o]||(gh[o]=new YC(s,t)),d=gh[o]),n.query&&!t.query&&(t.query=n.queryKey),d.socket(n.path,t)}Object.assign(P0,{Manager:YC,Socket:Y9,io:P0,connect:P0});const Lge=()=>{Pt("useSocketIO");const e=cn(),t=re(Y8),n=re(bu),s=re(k4),o=c.useMemo(()=>{const a=window.location.protocol==="https:"?"wss":"ws";return t?t.replace(/^https?:\/\//i,""):`${a}://${window.location.host}`},[t]),r=c.useMemo(()=>{const a={timeout:6e4,path:t?"/ws/socket.io":`${window.location.pathname}ws/socket.io`,autoConnect:!1,forceNew:!0};return n&&(a.auth={token:n},a.transports=["websocket","polling"]),{...a,...s}},[n,s,t]);c.useEffect(()=>{const a=P0(o,r);X8.set(a),Bme({socket:a,store:e,setIsConnected:Jn.set}),a.connect(),j4.get()&&(window.$socketOptions=k4,console.log("Socket initialized",a));const l=e.subscribe(()=>{const d=lJ(e.getState()).data;(!d||d.queue.in_progress===0)&&zr.set(null)});return()=>{j4.get()&&(window.$socketOptions=void 0,console.log("Socket teardown",a)),l(),a.disconnect()}},[r,o,e])},X9=c.memo(({config:e,studioInitAction:t})=>{const n=A(D9),s=dde("system"),o=G();return Tde(),Lge(),cJ(),Kde(),Rx(),ude(),c.useEffect(()=>{st.changeLanguage(n)},[n]),c.useEffect(()=>{SS(e)&&(s.info({config:e},"Received config"),o(dJ(e)))},[o,e,s]),c.useEffect(()=>{o(uJ())},[o]),hJ(t),mme(),cde(),pde(),pJ(),Yde(),null});X9.displayName="GlobalHookIsolator";const Dge={isModalOpen:!1,updatingStylePresetId:null,prefilledFormData:null},Ja=Le(Dge);function Q9(e,t,n){var s=this,o=c.useRef(null),r=c.useRef(0),a=c.useRef(null),l=c.useRef([]),d=c.useRef(),u=c.useRef(),h=c.useRef(e),p=c.useRef(!0);h.current=e;var f=typeof window<"u",m=!t&&t!==0&&f;if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0;var g=!!(n=n||{}).leading,x=!("trailing"in n)||!!n.trailing,b="maxWait"in n,C="debounceOnServer"in n&&!!n.debounceOnServer,y=b?Math.max(+n.maxWait||0,t):null;c.useEffect(function(){return p.current=!0,function(){p.current=!1}},[]);var v=c.useMemo(function(){var w=function(I){var O=l.current,N=d.current;return l.current=d.current=null,r.current=I,u.current=h.current.apply(N,O)},k=function(I,O){m&&cancelAnimationFrame(a.current),a.current=m?requestAnimationFrame(I):setTimeout(I,O)},S=function(I){if(!p.current)return!1;var O=I-o.current;return!o.current||O>=t||O<0||b&&I-r.current>=y},P=function(I){return a.current=null,x&&l.current?w(I):(l.current=d.current=null,u.current)},E=function I(){var O=Date.now();if(S(O))return P(O);if(p.current){var N=t-(O-o.current),_=b?Math.min(N,y-(O-r.current)):N;k(I,_)}},L=function(){if(f||C){var I=Date.now(),O=S(I);if(l.current=[].slice.call(arguments),d.current=s,o.current=I,O){if(!a.current&&p.current)return r.current=o.current,k(E,t),g?w(o.current):u.current;if(b)return k(E,t),w(o.current)}return a.current||k(E,t),u.current}};return L.cancel=function(){a.current&&(m?cancelAnimationFrame(a.current):clearTimeout(a.current)),r.current=0,l.current=o.current=d.current=a.current=null},L.isPending=function(){return!!a.current},L.flush=function(){return a.current?P(Date.now()):u.current},L},[g,b,t,y,x,m,f,C]);return v}function Rge(e,t){return e===t}function ml(e,t,n){var s=Rge,o=c.useRef(e),r=c.useState({})[1],a=Q9(c.useCallback(function(d){o.current=d,r({})},[r]),t,n),l=c.useRef(e);return s(l.current,e)||(a(e),l.current=e),[o.current,a]}const J9=e=>{const t=A(fJ),[n]=ml(e,t),{data:s,isLoading:o}=mJ(n??cs);return{metadata:s,isLoading:o}},_j=e=>{const t=G(),{t:n}=M(),s=A(qf),o=A(li),r=A(On),{metadata:a}=J9(e.image_name),[l,d]=c.useState(!1),[u,h]=c.useState(!1),[p,f]=c.useState(!1),m=re(Kf);c.useEffect(()=>{(async()=>{if(a){d(!0);try{await xt.seed.parse(a),h(!0)}catch{h(!1)}(await Promise.allSettled([xt.positivePrompt.parse(a).catch(()=>{}),xt.negativePrompt.parse(a).catch(()=>{}),xt.sdxlPositiveStylePrompt.parse(a).catch(()=>{}),xt.sdxlNegativeStylePrompt.parse(a).catch(()=>{})])).some(O=>O.status==="fulfilled")?f(!0):f(!1)}else d(!1),h(!1),f(!1)})()},[a]);const g=c.useCallback(()=>{s&&(t(Y0(null)),ge({status:"info",title:n("stylePresets.promptTemplateCleared")}))},[t,s,n]),x=c.useCallback(()=>{a&&(_4(a,r==="canvas",o?["width","height"]:[]),g())},[a,r,o,g]),b=c.useCallback(()=>{a&&(_4(a,r==="canvas",["seed"]),g())},[r,a,g]),C=c.useCallback(()=>{a&&xt.seed.parse(a).then(L=>{var I,O;(O=(I=xt.seed).recall)==null||O.call(I,L,!0)}).catch(()=>{})},[a]),y=c.useCallback(()=>{a&&(gJ(a),g())},[a,g]),v=c.useCallback(async()=>{if(!a)return;let L,I;try{L=await xt.positivePrompt.parse(a)}catch{L=""}try{I=await xt.negativePrompt.parse(a)}catch{I=""}Ja.set({prefilledFormData:{name:"",positivePrompt:L,negativePrompt:I,imageUrl:e.image_url,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[a,e]),w=ol(),k=c.useCallback(()=>{!e.has_workflow||!m||w({type:"image",data:e.image_name})},[m,e.has_workflow,e.image_name,w]),S=c.useCallback(()=>{o||xJ(e)},[e,o]),P=c.useCallback(()=>{t(Q8({imageDTO:e}))},[t,e]),E=c.useCallback(()=>{t(Zf([e]))},[t,e]);return{hasMetadata:l,hasSeed:u,hasPrompts:p,recallAll:x,remix:b,recallSeed:C,recallPrompts:y,createAsPreset:v,loadWorkflow:k,hasWorkflow:e.has_workflow,recallSize:S,upscale:P,delete:E}},eO=c.memo(()=>{Pt("GlobalImageHotkeys");const e=A(Yf);return e?i.jsx(tO,{imageDTO:e}):null});eO.displayName="GlobalImageHotkeys";const tO=c.memo(({imageDTO:e})=>{const t=Os("gallery"),n=Os("viewer"),s=_j(e),o=A(li),r=Bt("upscaling");return De({id:"loadWorkflow",category:"viewer",callback:s.loadWorkflow,options:{enabled:t||n},dependencies:[s.loadWorkflow,t,n]}),De({id:"recallAll",category:"viewer",callback:s.recallAll,options:{enabled:!o&&(t||n)},dependencies:[s.recallAll,o,t,n]}),De({id:"recallSeed",category:"viewer",callback:s.recallSeed,options:{enabled:t||n},dependencies:[s.recallSeed,t,n]}),De({id:"recallPrompts",category:"viewer",callback:s.recallPrompts,options:{enabled:t||n},dependencies:[s.recallPrompts,t,n]}),De({id:"remix",category:"viewer",callback:s.remix,options:{enabled:t||n},dependencies:[s.remix,t,n]}),De({id:"useSize",category:"viewer",callback:s.recallSize,options:{enabled:!o&&(t||n)},dependencies:[s.recallSize,o,t,n]}),De({id:"runPostprocessing",category:"viewer",callback:s.upscale,options:{enabled:r&&n},dependencies:[r,e,n]}),null});tO.displayName="GlobalImageHotkeysInternal";const Oge=fn(J8,e=>e.imagesToChange),Nge=he(J8,e=>e.isModalOpen),Fge=()=>{Pt("ChangeBoardModal");const e=G(),[t,n]=c.useState(),{data:s,isFetching:o}=vc({include_archived:!0}),r=A(Nge),a=A(Oge),[l]=yJ(),[d]=bJ(),{t:u}=M(),h=c.useMemo(()=>[{label:u("boards.uncategorized"),value:"none"}].concat((s??[]).map(x=>({label:x.board_name,value:x.board_id}))),[s,u]),p=c.useMemo(()=>h.find(x=>x.value===t),[h,t]),f=c.useCallback(()=>{e(I4()),e(TS(!1))},[e]),m=c.useCallback(()=>{!a.length||!t||(t==="none"?d({imageDTOs:a}):l({imageDTOs:a,board_id:t}),n(null),e(I4()))},[l,e,a,d,t]),g=c.useCallback(x=>{x&&n(x.value)},[]);return i.jsx(ho,{isOpen:r,onClose:f,title:u("boards.changeBoard"),acceptCallback:m,acceptButtonText:u("boards.move"),cancelButtonText:u("boards.cancel"),useInert:!1,children:i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsxs(W,{children:[u("boards.movingImagesToBoard",{count:a.length}),":"]}),i.jsx(Q,{isDisabled:o,children:i.jsx(Ke,{placeholder:u(o?"boards.loading":"boards.selectBoard"),onChange:g,value:p,options:h})})]})})},Bge=c.memo(Fge);he(Px,la,(e,t)=>{const{data:n}=e;let s=null;if(n){const r=aa.selectAll(n).filter(jS).sort(l=>l.type==="controlnet"?-1:1);s=r.filter(l=>t?l.base===t:!0)[0]??r[0]??null}const o=(s==null?void 0:s.type)==="t2i_adapter"?gt(kJ):gt(kc);return s&&(o.model=ro.parse(s)),o});const Vy=he(Ex,Px,la,(e,t,n)=>{if((e==null?void 0:e.base)==="chatgpt-4o"){const a=gt(vJ);return a.model=ro.parse(e),a}const{data:s}=t;let o=null;if(s){const a=aa.selectAll(s).filter(Hf);o=a.filter(d=>n?d.base===n:!0)[0]??a[0]??null}const r=gt(eP);return o&&(r.model=ro.parse(o),o.base==="flux"&&(r.clipVisionModel="ViT-L")),r}),Em=he(Px,la,(e,t)=>{const{data:n}=e;let s=null;if(n){const r=aa.selectAll(n).filter(Hf);s=r.filter(l=>t?l.base===t:!0)[0]??r[0]??null}const o=gt(eP);return s&&(o.model=ro.parse(s),s.base==="flux"&&(o.clipVisionModel="ViT-L")),o}),Ij=()=>{const e=G();return c.useCallback(()=>{const n={controlAdapter:gt(kc)};e(Xf({isSelected:!0,overrides:n}))},[e])},Tj=()=>{const e=G();return c.useCallback(()=>{e(vu({isSelected:!0}))},[e])},Aj=()=>{const e=G();return c.useCallback(()=>{e(Ox({isSelected:!0}))},[e])},Mj=()=>{const e=G();return c.useCallback(()=>{e(Ka({isSelected:!0}))},[e])},nO=()=>{const e=G(),t=A(Em);return c.useCallback(()=>{const s={referenceImages:[{id:Te("regional_guidance_reference_image"),ipAdapter:gt(t)}]};e(Ka({isSelected:!0,overrides:s}))},[t,e])},Ej=()=>{const e=G(),t=A(Vy);return c.useCallback(()=>{const s={ipAdapter:gt(t)};e(Nx({isSelected:!0,overrides:s}))},[t,e])},sO=e=>{const t=G(),n=A(Em);return c.useCallback(()=>{t(SJ({entityIdentifier:e,overrides:{ipAdapter:gt(n)}}))},[n,t,e])},iO=e=>{const t=G();return c.useCallback(()=>{t(q2({entityIdentifier:e,prompt:""}))},[t,e])},oO=e=>{const t=G();return c.useCallback(()=>{t(K2({entityIdentifier:e,prompt:""}))},[t,e])},$ge=e=>{const t=G();return c.useCallback(()=>{t(CJ({entityIdentifier:e}))},[t,e])},Vge=e=>{const t=G();return c.useCallback(()=>{t(wJ({entityIdentifier:e}))},[t,e])},rO=e=>fn(Ye,t=>{const n=rl(t,e);return{canAddPositivePrompt:(n==null?void 0:n.positivePrompt)===null,canAddNegativePrompt:(n==null?void 0:n.negativePrompt)===null}}),zge=new Error("request for lock canceled");var Gge=function(e,t,n,s){function o(r){return r instanceof n?r:new n(function(a){a(r)})}return new(n||(n=Promise))(function(r,a){function l(h){try{u(s.next(h))}catch(p){a(p)}}function d(h){try{u(s.throw(h))}catch(p){a(p)}}function u(h){h.done?r(h.value):o(h.value).then(l,d)}u((s=s.apply(e,t||[])).next())})};class Hge{constructor(t,n=zge){this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}acquire(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,o)=>{const r={resolve:s,reject:o,weight:t,priority:n},a=aO(this._queue,l=>n<=l.priority);a===-1&&t<=this._value?this._dispatchItem(r):this._queue.splice(a+1,0,r)})}runExclusive(t){return Gge(this,arguments,void 0,function*(n,s=1,o=0){const[r,a]=yield this.acquire(s,o);try{return yield n(r)}finally{a()}})}waitForUnlock(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),Wge(this._weightedWaiters[t-1],{resolve:s,priority:n})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const n=this._value;this._value-=t.weight,t.resolve([n,this._newReleaser(t.weight)])}_newReleaser(t){let n=!1;return()=>{n||(n=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];n&&(n.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let n=this._value;n>0;n--){const s=this._weightedWaiters[n-1];if(!s)continue;const o=s.findIndex(r=>r.priority<=t);(o===-1?s:s.splice(0,o)).forEach(r=>r.resolve())}}}_couldLockImmediately(t,n){return(this._queue.length===0||this._queue[0].priority<n)&&t<=this._value}}function Wge(e,t){const n=aO(e,s=>t.priority<=s.priority);e.splice(n+1,0,t)}function aO(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}var Uge=function(e,t,n,s){function o(r){return r instanceof n?r:new n(function(a){a(r)})}return new(n||(n=Promise))(function(r,a){function l(h){try{u(s.next(h))}catch(p){a(p)}}function d(h){try{u(s.throw(h))}catch(p){a(p)}}function u(h){h.done?r(h.value):o(h.value).then(l,d)}u((s=s.apply(e,t||[])).next())})};class Pj{constructor(t){this._semaphore=new Hge(1,t)}acquire(){return Uge(this,arguments,void 0,function*(t=0){const[,n]=yield this._semaphore.acquire(1,t);return n})}runExclusive(t,n=0){return this._semaphore.runExclusive(()=>t(),1,n)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}class Ut{constructor(){j(this,"initialize");j(this,"getLoggingContext",()=>({...this.parent.getLoggingContext(),path:this.path.join(" > ")}));j(this,"destroy",()=>{this.log("Destroying module")});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path}))}}var L0={exports:{}},xh={},Cv={},wv={},RT;function jt(){return RT||(RT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const t=Math.PI/180;function n(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}e.glob=typeof T4<"u"?T4:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},e.Konva={_global:e.glob,version:"9.3.20",isBrowser:n(),isUnminified:/param/.test((function(o){}).toString()),dblClickWindow:400,getAngle(o){return e.Konva.angleDeg?o*t:o},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return e.Konva.DD.isDragging},isTransforming(){var o;return(o=e.Konva.Transformer)===null||o===void 0?void 0:o.isTransforming()},isDragReady(){return!!e.Konva.DD.node},releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(o){e.glob.Konva=o}};const s=o=>{e.Konva[o.prototype.getClassName()]=o};e._registerNode=s,e.Konva._injectGlobal(e.Konva)}(wv)),wv}var Sv={},OT;function En(){return OT||(OT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Util=e.Transform=void 0;const t=jt();class n{constructor(w=[1,0,0,1,0,0]){this.dirty=!1,this.m=w&&w.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(w){w.m[0]=this.m[0],w.m[1]=this.m[1],w.m[2]=this.m[2],w.m[3]=this.m[3],w.m[4]=this.m[4],w.m[5]=this.m[5]}point(w){const k=this.m;return{x:k[0]*w.x+k[2]*w.y+k[4],y:k[1]*w.x+k[3]*w.y+k[5]}}translate(w,k){return this.m[4]+=this.m[0]*w+this.m[2]*k,this.m[5]+=this.m[1]*w+this.m[3]*k,this}scale(w,k){return this.m[0]*=w,this.m[1]*=w,this.m[2]*=k,this.m[3]*=k,this}rotate(w){const k=Math.cos(w),S=Math.sin(w),P=this.m[0]*k+this.m[2]*S,E=this.m[1]*k+this.m[3]*S,L=this.m[0]*-S+this.m[2]*k,I=this.m[1]*-S+this.m[3]*k;return this.m[0]=P,this.m[1]=E,this.m[2]=L,this.m[3]=I,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(w,k){const S=this.m[0]+this.m[2]*k,P=this.m[1]+this.m[3]*k,E=this.m[2]+this.m[0]*w,L=this.m[3]+this.m[1]*w;return this.m[0]=S,this.m[1]=P,this.m[2]=E,this.m[3]=L,this}multiply(w){const k=this.m[0]*w.m[0]+this.m[2]*w.m[1],S=this.m[1]*w.m[0]+this.m[3]*w.m[1],P=this.m[0]*w.m[2]+this.m[2]*w.m[3],E=this.m[1]*w.m[2]+this.m[3]*w.m[3],L=this.m[0]*w.m[4]+this.m[2]*w.m[5]+this.m[4],I=this.m[1]*w.m[4]+this.m[3]*w.m[5]+this.m[5];return this.m[0]=k,this.m[1]=S,this.m[2]=P,this.m[3]=E,this.m[4]=L,this.m[5]=I,this}invert(){const w=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),k=this.m[3]*w,S=-this.m[1]*w,P=-this.m[2]*w,E=this.m[0]*w,L=w*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),I=w*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=k,this.m[1]=S,this.m[2]=P,this.m[3]=E,this.m[4]=L,this.m[5]=I,this}getMatrix(){return this.m}decompose(){const w=this.m[0],k=this.m[1],S=this.m[2],P=this.m[3],E=this.m[4],L=this.m[5],I=w*P-k*S,O={x:E,y:L,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(w!=0||k!=0){const N=Math.sqrt(w*w+k*k);O.rotation=k>0?Math.acos(w/N):-Math.acos(w/N),O.scaleX=N,O.scaleY=I/N,O.skewX=(w*S+k*P)/I,O.skewY=0}else if(S!=0||P!=0){const N=Math.sqrt(S*S+P*P);O.rotation=Math.PI/2-(P>0?Math.acos(-S/N):-Math.acos(S/N)),O.scaleX=I/N,O.scaleY=N,O.skewX=0,O.skewY=(w*S+k*P)/I}return O.rotation=e.Util._getRotation(O.rotation),O}}e.Transform=n;const s="[object Array]",o="[object Number]",r="[object String]",a="[object Boolean]",l=Math.PI/180,d=180/Math.PI,u="#",h="",p="0",f="Konva warning: ",m="Konva error: ",g="rgb(",x={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let C=[];const y=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(v){setTimeout(v,60)};e.Util={_isElement(v){return!!(v&&v.nodeType==1)},_isFunction(v){return!!(v&&v.constructor&&v.call&&v.apply)},_isPlainObject(v){return!!v&&v.constructor===Object},_isArray(v){return Object.prototype.toString.call(v)===s},_isNumber(v){return Object.prototype.toString.call(v)===o&&!isNaN(v)&&isFinite(v)},_isString(v){return Object.prototype.toString.call(v)===r},_isBoolean(v){return Object.prototype.toString.call(v)===a},isObject(v){return v instanceof Object},isValidSelector(v){if(typeof v!="string")return!1;const w=v[0];return w==="#"||w==="."||w===w.toUpperCase()},_sign(v){return v===0||v>0?1:-1},requestAnimFrame(v){C.push(v),C.length===1&&y(function(){const w=C;C=[],w.forEach(function(k){k()})})},createCanvasElement(){const v=document.createElement("canvas");try{v.style=v.style||{}}catch{}return v},createImageElement(){return document.createElement("img")},_isInDocument(v){for(;v=v.parentNode;)if(v==document)return!0;return!1},_urlToImage(v,w){const k=e.Util.createImageElement();k.onload=function(){w(k)},k.src=v},_rgbToHex(v,w,k){return((1<<24)+(v<<16)+(w<<8)+k).toString(16).slice(1)},_hexToRgb(v){v=v.replace(u,h);const w=parseInt(v,16);return{r:w>>16&255,g:w>>8&255,b:w&255}},getRandomColor(){let v=(Math.random()*16777215<<0).toString(16);for(;v.length<6;)v=p+v;return u+v},getRGB(v){let w;return v in x?(w=x[v],{r:w[0],g:w[1],b:w[2]}):v[0]===u?this._hexToRgb(v.substring(1)):v.substr(0,4)===g?(w=b.exec(v.replace(/ /g,"")),{r:parseInt(w[1],10),g:parseInt(w[2],10),b:parseInt(w[3],10)}):{r:0,g:0,b:0}},colorToRGBA(v){return v=v||"black",e.Util._namedColorToRBA(v)||e.Util._hex3ColorToRGBA(v)||e.Util._hex4ColorToRGBA(v)||e.Util._hex6ColorToRGBA(v)||e.Util._hex8ColorToRGBA(v)||e.Util._rgbColorToRGBA(v)||e.Util._rgbaColorToRGBA(v)||e.Util._hslColorToRGBA(v)},_namedColorToRBA(v){const w=x[v.toLowerCase()];return w?{r:w[0],g:w[1],b:w[2],a:1}:null},_rgbColorToRGBA(v){if(v.indexOf("rgb(")===0){v=v.match(/rgb\(([^)]+)\)/)[1];const w=v.split(/ *, */).map(Number);return{r:w[0],g:w[1],b:w[2],a:1}}},_rgbaColorToRGBA(v){if(v.indexOf("rgba(")===0){v=v.match(/rgba\(([^)]+)\)/)[1];const w=v.split(/ *, */).map((k,S)=>k.slice(-1)==="%"?S===3?parseInt(k)/100:parseInt(k)/100*255:Number(k));return{r:w[0],g:w[1],b:w[2],a:w[3]}}},_hex8ColorToRGBA(v){if(v[0]==="#"&&v.length===9)return{r:parseInt(v.slice(1,3),16),g:parseInt(v.slice(3,5),16),b:parseInt(v.slice(5,7),16),a:parseInt(v.slice(7,9),16)/255}},_hex6ColorToRGBA(v){if(v[0]==="#"&&v.length===7)return{r:parseInt(v.slice(1,3),16),g:parseInt(v.slice(3,5),16),b:parseInt(v.slice(5,7),16),a:1}},_hex4ColorToRGBA(v){if(v[0]==="#"&&v.length===5)return{r:parseInt(v[1]+v[1],16),g:parseInt(v[2]+v[2],16),b:parseInt(v[3]+v[3],16),a:parseInt(v[4]+v[4],16)/255}},_hex3ColorToRGBA(v){if(v[0]==="#"&&v.length===4)return{r:parseInt(v[1]+v[1],16),g:parseInt(v[2]+v[2],16),b:parseInt(v[3]+v[3],16),a:1}},_hslColorToRGBA(v){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(v)){const[w,...k]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(v),S=Number(k[0])/360,P=Number(k[1])/100,E=Number(k[2])/100;let L,I,O;if(P===0)return O=E*255,{r:Math.round(O),g:Math.round(O),b:Math.round(O),a:1};E<.5?L=E*(1+P):L=E+P-E*P;const N=2*E-L,_=[0,0,0];for(let R=0;R<3;R++)I=S+1/3*-(R-1),I<0&&I++,I>1&&I--,6*I<1?O=N+(L-N)*6*I:2*I<1?O=L:3*I<2?O=N+(L-N)*(2/3-I)*6:O=N,_[R]=O*255;return{r:Math.round(_[0]),g:Math.round(_[1]),b:Math.round(_[2]),a:1}}},haveIntersection(v,w){return!(w.x>v.x+v.width||w.x+w.width<v.x||w.y>v.y+v.height||w.y+w.height<v.y)},cloneObject(v){const w={};for(const k in v)this._isPlainObject(v[k])?w[k]=this.cloneObject(v[k]):this._isArray(v[k])?w[k]=this.cloneArray(v[k]):w[k]=v[k];return w},cloneArray(v){return v.slice(0)},degToRad(v){return v*l},radToDeg(v){return v*d},_degToRad(v){return e.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),e.Util.degToRad(v)},_radToDeg(v){return e.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),e.Util.radToDeg(v)},_getRotation(v){return t.Konva.angleDeg?e.Util.radToDeg(v):v},_capitalize(v){return v.charAt(0).toUpperCase()+v.slice(1)},throw(v){throw new Error(m+v)},error(v){console.error(m+v)},warn(v){t.Konva.showWarnings&&console.warn(f+v)},each(v,w){for(const k in v)w(k,v[k])},_inRange(v,w,k){return w<=v&&v<k},_getProjectionToSegment(v,w,k,S,P,E){let L,I,O;const N=(v-k)*(v-k)+(w-S)*(w-S);if(N==0)L=v,I=w,O=(P-k)*(P-k)+(E-S)*(E-S);else{const _=((P-v)*(k-v)+(E-w)*(S-w))/N;_<0?(L=v,I=w,O=(v-P)*(v-P)+(w-E)*(w-E)):_>1?(L=k,I=S,O=(k-P)*(k-P)+(S-E)*(S-E)):(L=v+_*(k-v),I=w+_*(S-w),O=(L-P)*(L-P)+(I-E)*(I-E))}return[L,I,O]},_getProjectionToLine(v,w,k){const S=e.Util.cloneObject(v);let P=Number.MAX_VALUE;return w.forEach(function(E,L){if(!k&&L===w.length-1)return;const I=w[(L+1)%w.length],O=e.Util._getProjectionToSegment(E.x,E.y,I.x,I.y,v.x,v.y),N=O[0],_=O[1],R=O[2];R<P&&(S.x=N,S.y=_,P=R)}),S},_prepareArrayForTween(v,w,k){const S=[],P=[];if(v.length>w.length){const L=w;w=v,v=L}for(let L=0;L<v.length;L+=2)S.push({x:v[L],y:v[L+1]});for(let L=0;L<w.length;L+=2)P.push({x:w[L],y:w[L+1]});const E=[];return P.forEach(function(L){const I=e.Util._getProjectionToLine(L,S,k);E.push(I.x),E.push(I.y)}),E},_prepareToStringify(v){let w;v.visitedByCircularReferenceRemoval=!0;for(const k in v)if(v.hasOwnProperty(k)&&v[k]&&typeof v[k]=="object"){if(w=Object.getOwnPropertyDescriptor(v,k),v[k].visitedByCircularReferenceRemoval||e.Util._isElement(v[k]))if(w.configurable)delete v[k];else return null;else if(e.Util._prepareToStringify(v[k])===null)if(w.configurable)delete v[k];else return null}return delete v.visitedByCircularReferenceRemoval,v},_assign(v,w){for(const k in w)v[k]=w[k];return v},_getFirstPointerId(v){return v.touches?v.changedTouches[0].identifier:v.pointerId||999},releaseCanvas(...v){t.Konva.releaseCanvasOnDestroy&&v.forEach(w=>{w.width=0,w.height=0})},drawRoundedRectPath(v,w,k,S){let P=0,E=0,L=0,I=0;typeof S=="number"?P=E=L=I=Math.min(S,w/2,k/2):(P=Math.min(S[0]||0,w/2,k/2),E=Math.min(S[1]||0,w/2,k/2),I=Math.min(S[2]||0,w/2,k/2),L=Math.min(S[3]||0,w/2,k/2)),v.moveTo(P,0),v.lineTo(w-E,0),v.arc(w-E,E,E,Math.PI*3/2,0,!1),v.lineTo(w,k-I),v.arc(w-I,k-I,I,0,Math.PI/2,!1),v.lineTo(L,k),v.arc(L,k-L,L,Math.PI/2,Math.PI,!1),v.lineTo(0,P),v.arc(P,P,P,Math.PI,Math.PI*3/2,!1)}}}(Sv)),Sv}var yh={},kv={},Xs={},NT;function Tt(){if(NT)return Xs;NT=1,Object.defineProperty(Xs,"__esModule",{value:!0}),Xs.RGBComponent=s,Xs.alphaComponent=o,Xs.getNumberValidator=r,Xs.getNumberOrArrayOfNumbersValidator=a,Xs.getNumberOrAutoValidator=l,Xs.getStringValidator=d,Xs.getStringOrGradientValidator=u,Xs.getFunctionValidator=h,Xs.getNumberArrayValidator=p,Xs.getBooleanValidator=f,Xs.getComponentValidator=m;const e=jt(),t=En();function n(g){return t.Util._isString(g)?'"'+g+'"':Object.prototype.toString.call(g)==="[object Number]"||t.Util._isBoolean(g)?g:Object.prototype.toString.call(g)}function s(g){return g>255?255:g<0?0:Math.round(g)}function o(g){return g>1?1:g<1e-4?1e-4:g}function r(){if(e.Konva.isUnminified)return function(g,x){return t.Util._isNumber(g)||t.Util.warn(n(g)+' is a not valid value for "'+x+'" attribute. The value should be a number.'),g}}function a(g){if(e.Konva.isUnminified)return function(x,b){let C=t.Util._isNumber(x),y=t.Util._isArray(x)&&x.length==g;return!C&&!y&&t.Util.warn(n(x)+' is a not valid value for "'+b+'" attribute. The value should be a number or Array<number>('+g+")"),x}}function l(){if(e.Konva.isUnminified)return function(g,x){var b=t.Util._isNumber(g),C=g==="auto";return b||C||t.Util.warn(n(g)+' is a not valid value for "'+x+'" attribute. The value should be a number or "auto".'),g}}function d(){if(e.Konva.isUnminified)return function(g,x){return t.Util._isString(g)||t.Util.warn(n(g)+' is a not valid value for "'+x+'" attribute. The value should be a string.'),g}}function u(){if(e.Konva.isUnminified)return function(g,x){const b=t.Util._isString(g),C=Object.prototype.toString.call(g)==="[object CanvasGradient]"||g&&g.addColorStop;return b||C||t.Util.warn(n(g)+' is a not valid value for "'+x+'" attribute. The value should be a string or a native gradient.'),g}}function h(){if(e.Konva.isUnminified)return function(g,x){return t.Util._isFunction(g)||t.Util.warn(n(g)+' is a not valid value for "'+x+'" attribute. The value should be a function.'),g}}function p(){if(e.Konva.isUnminified)return function(g,x){const b=Int8Array?Object.getPrototypeOf(Int8Array):null;return b&&g instanceof b||(t.Util._isArray(g)?g.forEach(function(C){t.Util._isNumber(C)||t.Util.warn('"'+x+'" attribute has non numeric element '+C+". Make sure that all elements are numbers.")}):t.Util.warn(n(g)+' is a not valid value for "'+x+'" attribute. The value should be a array of numbers.')),g}}function f(){if(e.Konva.isUnminified)return function(g,x){var b=g===!0||g===!1;return b||t.Util.warn(n(g)+' is a not valid value for "'+x+'" attribute. The value should be a boolean.'),g}}function m(g){if(e.Konva.isUnminified)return function(x,b){return x==null||t.Util.isObject(x)||t.Util.warn(n(x)+' is a not valid value for "'+b+'" attribute. The value should be an object with properties '+g),x}}return Xs}var FT;function It(){return FT||(FT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const t=En(),n=Tt(),s="get",o="set";e.Factory={addGetterSetter(r,a,l,d,u){e.Factory.addGetter(r,a,l),e.Factory.addSetter(r,a,d,u),e.Factory.addOverloadedGetterSetter(r,a)},addGetter(r,a,l){var d=s+t.Util._capitalize(a);r.prototype[d]=r.prototype[d]||function(){const u=this.attrs[a];return u===void 0?l:u}},addSetter(r,a,l,d){var u=o+t.Util._capitalize(a);r.prototype[u]||e.Factory.overWriteSetter(r,a,l,d)},overWriteSetter(r,a,l,d){var u=o+t.Util._capitalize(a);r.prototype[u]=function(h){return l&&h!==void 0&&h!==null&&(h=l.call(this,h,a)),this._setAttr(a,h),d&&d.call(this),this}},addComponentsGetterSetter(r,a,l,d,u){const h=l.length,p=t.Util._capitalize,f=s+p(a),m=o+p(a);r.prototype[f]=function(){const x={};for(let b=0;b<h;b++){const C=l[b];x[C]=this.getAttr(a+p(C))}return x};const g=(0,n.getComponentValidator)(l);r.prototype[m]=function(x){const b=this.attrs[a];d&&(x=d.call(this,x,a)),g&&g.call(this,x,a);for(const C in x)x.hasOwnProperty(C)&&this._setAttr(a+p(C),x[C]);return x||l.forEach(C=>{this._setAttr(a+p(C),void 0)}),this._fireChangeEvent(a,b,x),u&&u.call(this),this},e.Factory.addOverloadedGetterSetter(r,a)},addOverloadedGetterSetter(r,a){var l=t.Util._capitalize(a),d=o+l,u=s+l;r.prototype[a]=function(){return arguments.length?(this[d](arguments[0]),this):this[u]()}},addDeprecatedGetterSetter(r,a,l,d){t.Util.error("Adding deprecated "+a);const u=s+t.Util._capitalize(a),h=a+" property is deprecated and will be removed soon. Look at Konva change log for more information.";r.prototype[u]=function(){t.Util.error(h);const p=this.attrs[a];return p===void 0?l:p},e.Factory.addSetter(r,a,d,function(){t.Util.error(h)}),e.Factory.addOverloadedGetterSetter(r,a)},backCompat(r,a){t.Util.each(a,function(l,d){const u=r.prototype[d],h=s+t.Util._capitalize(l),p=o+t.Util._capitalize(l);function f(){u.apply(this,arguments),t.Util.error('"'+l+'" method is deprecated and will be removed soon. Use ""'+d+'" instead.')}r.prototype[l]=f,r.prototype[h]=f,r.prototype[p]=f})},afterSetFilter(){this._filterUpToDate=!1}}}(kv)),kv}var Er={},Pr={},BT;function lO(){if(BT)return Pr;BT=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.HitContext=Pr.SceneContext=Pr.Context=void 0;const e=En(),t=jt();function n(C){const y=[],v=C.length,w=e.Util;for(let k=0;k<v;k++){let S=C[k];w._isNumber(S)?S=Math.round(S*1e3)/1e3:w._isString(S)||(S=S+""),y.push(S)}return y}const s=",",o="(",r=")",a="([",l="])",d=";",u="()",h="=",p=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],f=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],m=100;let g=class{constructor(y){this.canvas=y,t.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(y){y.fillEnabled()&&this._fill(y)}_fill(y){}strokeShape(y){y.hasStroke()&&this._stroke(y)}_stroke(y){}fillStrokeShape(y){y.attrs.fillAfterStrokeEnabled?(this.strokeShape(y),this.fillShape(y)):(this.fillShape(y),this.strokeShape(y))}getTrace(y,v){let w=this.traceArr,k=w.length,S="",P,E,L,I;for(P=0;P<k;P++)E=w[P],L=E.method,L?(I=E.args,S+=L,y?S+=u:e.Util._isArray(I[0])?S+=a+I.join(s)+l:(v&&(I=I.map(O=>typeof O=="number"?Math.floor(O):O)),S+=o+I.join(s)+r)):(S+=E.property,y||(S+=h+E.val)),S+=d;return S}clearTrace(){this.traceArr=[]}_trace(y){let v=this.traceArr,w;v.push(y),w=v.length,w>=m&&v.shift()}reset(){const y=this.getCanvas().getPixelRatio();this.setTransform(1*y,0,0,1*y,0,0)}getCanvas(){return this.canvas}clear(y){const v=this.getCanvas();y?this.clearRect(y.x||0,y.y||0,y.width||0,y.height||0):this.clearRect(0,0,v.getWidth()/v.pixelRatio,v.getHeight()/v.pixelRatio)}_applyLineCap(y){const v=y.attrs.lineCap;v&&this.setAttr("lineCap",v)}_applyOpacity(y){const v=y.getAbsoluteOpacity();v!==1&&this.setAttr("globalAlpha",v)}_applyLineJoin(y){const v=y.attrs.lineJoin;v&&this.setAttr("lineJoin",v)}setAttr(y,v){this._context[y]=v}arc(y,v,w,k,S,P){this._context.arc(y,v,w,k,S,P)}arcTo(y,v,w,k,S){this._context.arcTo(y,v,w,k,S)}beginPath(){this._context.beginPath()}bezierCurveTo(y,v,w,k,S,P){this._context.bezierCurveTo(y,v,w,k,S,P)}clearRect(y,v,w,k){this._context.clearRect(y,v,w,k)}clip(...y){this._context.clip.apply(this._context,y)}closePath(){this._context.closePath()}createImageData(y,v){const w=arguments;if(w.length===2)return this._context.createImageData(y,v);if(w.length===1)return this._context.createImageData(y)}createLinearGradient(y,v,w,k){return this._context.createLinearGradient(y,v,w,k)}createPattern(y,v){return this._context.createPattern(y,v)}createRadialGradient(y,v,w,k,S,P){return this._context.createRadialGradient(y,v,w,k,S,P)}drawImage(y,v,w,k,S,P,E,L,I){const O=arguments,N=this._context;O.length===3?N.drawImage(y,v,w):O.length===5?N.drawImage(y,v,w,k,S):O.length===9&&N.drawImage(y,v,w,k,S,P,E,L,I)}ellipse(y,v,w,k,S,P,E,L){this._context.ellipse(y,v,w,k,S,P,E,L)}isPointInPath(y,v,w,k){return w?this._context.isPointInPath(w,y,v,k):this._context.isPointInPath(y,v,k)}fill(...y){this._context.fill.apply(this._context,y)}fillRect(y,v,w,k){this._context.fillRect(y,v,w,k)}strokeRect(y,v,w,k){this._context.strokeRect(y,v,w,k)}fillText(y,v,w,k){k?this._context.fillText(y,v,w,k):this._context.fillText(y,v,w)}measureText(y){return this._context.measureText(y)}getImageData(y,v,w,k){return this._context.getImageData(y,v,w,k)}lineTo(y,v){this._context.lineTo(y,v)}moveTo(y,v){this._context.moveTo(y,v)}rect(y,v,w,k){this._context.rect(y,v,w,k)}roundRect(y,v,w,k,S){this._context.roundRect(y,v,w,k,S)}putImageData(y,v,w){this._context.putImageData(y,v,w)}quadraticCurveTo(y,v,w,k){this._context.quadraticCurveTo(y,v,w,k)}restore(){this._context.restore()}rotate(y){this._context.rotate(y)}save(){this._context.save()}scale(y,v){this._context.scale(y,v)}setLineDash(y){this._context.setLineDash?this._context.setLineDash(y):"mozDash"in this._context?this._context.mozDash=y:"webkitLineDash"in this._context&&(this._context.webkitLineDash=y)}getLineDash(){return this._context.getLineDash()}setTransform(y,v,w,k,S,P){this._context.setTransform(y,v,w,k,S,P)}stroke(y){y?this._context.stroke(y):this._context.stroke()}strokeText(y,v,w,k){this._context.strokeText(y,v,w,k)}transform(y,v,w,k,S,P){this._context.transform(y,v,w,k,S,P)}translate(y,v){this._context.translate(y,v)}_enableTrace(){let y=this,v=p.length,w=this.setAttr,k,S;const P=function(E){let L=y[E],I;y[E]=function(){return S=n(Array.prototype.slice.call(arguments,0)),I=L.apply(y,arguments),y._trace({method:E,args:S}),I}};for(k=0;k<v;k++)P(p[k]);y.setAttr=function(){w.apply(y,arguments);const E=arguments[0];let L=arguments[1];(E==="shadowOffsetX"||E==="shadowOffsetY"||E==="shadowBlur")&&(L=L/this.canvas.getPixelRatio()),y._trace({property:E,val:L})}}_applyGlobalCompositeOperation(y){const v=y.attrs.globalCompositeOperation;!v||v==="source-over"||this.setAttr("globalCompositeOperation",v)}};Pr.Context=g,f.forEach(function(C){Object.defineProperty(g.prototype,C,{get(){return this._context[C]},set(y){this._context[C]=y}})});class x extends g{constructor(y,{willReadFrequently:v=!1}={}){super(y),this._context=y._canvas.getContext("2d",{willReadFrequently:v})}_fillColor(y){const v=y.fill();this.setAttr("fillStyle",v),y._fillFunc(this)}_fillPattern(y){this.setAttr("fillStyle",y._getFillPattern()),y._fillFunc(this)}_fillLinearGradient(y){const v=y._getLinearGradient();v&&(this.setAttr("fillStyle",v),y._fillFunc(this))}_fillRadialGradient(y){const v=y._getRadialGradient();v&&(this.setAttr("fillStyle",v),y._fillFunc(this))}_fill(y){const v=y.fill(),w=y.getFillPriority();if(v&&w==="color"){this._fillColor(y);return}const k=y.getFillPatternImage();if(k&&w==="pattern"){this._fillPattern(y);return}const S=y.getFillLinearGradientColorStops();if(S&&w==="linear-gradient"){this._fillLinearGradient(y);return}const P=y.getFillRadialGradientColorStops();if(P&&w==="radial-gradient"){this._fillRadialGradient(y);return}v?this._fillColor(y):k?this._fillPattern(y):S?this._fillLinearGradient(y):P&&this._fillRadialGradient(y)}_strokeLinearGradient(y){const v=y.getStrokeLinearGradientStartPoint(),w=y.getStrokeLinearGradientEndPoint(),k=y.getStrokeLinearGradientColorStops(),S=this.createLinearGradient(v.x,v.y,w.x,w.y);if(k){for(let P=0;P<k.length;P+=2)S.addColorStop(k[P],k[P+1]);this.setAttr("strokeStyle",S)}}_stroke(y){const v=y.dash(),w=y.getStrokeScaleEnabled();if(y.hasStroke()){if(!w){this.save();const S=this.getCanvas().getPixelRatio();this.setTransform(S,0,0,S,0,0)}this._applyLineCap(y),v&&y.dashEnabled()&&(this.setLineDash(v),this.setAttr("lineDashOffset",y.dashOffset())),this.setAttr("lineWidth",y.strokeWidth()),y.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),y.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(y):this.setAttr("strokeStyle",y.stroke()),y._strokeFunc(this),w||this.restore()}}_applyShadow(y){var v,w,k;const S=(v=y.getShadowRGBA())!==null&&v!==void 0?v:"black",P=(w=y.getShadowBlur())!==null&&w!==void 0?w:5,E=(k=y.getShadowOffset())!==null&&k!==void 0?k:{x:0,y:0},L=y.getAbsoluteScale(),I=this.canvas.getPixelRatio(),O=L.x*I,N=L.y*I;this.setAttr("shadowColor",S),this.setAttr("shadowBlur",P*Math.min(Math.abs(O),Math.abs(N))),this.setAttr("shadowOffsetX",E.x*O),this.setAttr("shadowOffsetY",E.y*N)}}Pr.SceneContext=x;class b extends g{constructor(y){super(y),this._context=y._canvas.getContext("2d",{willReadFrequently:!0})}_fill(y){this.save(),this.setAttr("fillStyle",y.colorKey),y._fillFuncHit(this),this.restore()}strokeShape(y){y.hasHitStroke()&&this._stroke(y)}_stroke(y){if(y.hasHitStroke()){const v=y.getStrokeScaleEnabled();if(!v){this.save();const S=this.getCanvas().getPixelRatio();this.setTransform(S,0,0,S,0,0)}this._applyLineCap(y);const w=y.hitStrokeWidth(),k=w==="auto"?y.strokeWidth():w;this.setAttr("lineWidth",k),this.setAttr("strokeStyle",y.colorKey),y._strokeFuncHit(this),v||this.restore()}}}return Pr.HitContext=b,Pr}var $T;function zy(){if($T)return Er;$T=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.HitCanvas=Er.SceneCanvas=Er.Canvas=void 0;const e=En(),t=lO(),n=jt();let s;function o(){if(s)return s;const d=e.Util.createCanvasElement(),u=d.getContext("2d");return s=function(){const h=n.Konva._global.devicePixelRatio||1,p=u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1;return h/p}(),e.Util.releaseCanvas(d),s}let r=class{constructor(u){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const p=(u||{}).pixelRatio||n.Konva.pixelRatio||o();this.pixelRatio=p,this._canvas=e.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(u){const h=this.pixelRatio;this.pixelRatio=u,this.setSize(this.getWidth()/h,this.getHeight()/h)}setWidth(u){this.width=this._canvas.width=u*this.pixelRatio,this._canvas.style.width=u+"px";const h=this.pixelRatio;this.getContext()._context.scale(h,h)}setHeight(u){this.height=this._canvas.height=u*this.pixelRatio,this._canvas.style.height=u+"px";const h=this.pixelRatio;this.getContext()._context.scale(h,h)}getWidth(){return this.width}getHeight(){return this.height}setSize(u,h){this.setWidth(u||0),this.setHeight(h||0)}toDataURL(u,h){try{return this._canvas.toDataURL(u,h)}catch{try{return this._canvas.toDataURL()}catch(f){return e.Util.error("Unable to get data URL. "+f.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};Er.Canvas=r;class a extends r{constructor(u={width:0,height:0,willReadFrequently:!1}){super(u),this.context=new t.SceneContext(this,{willReadFrequently:u.willReadFrequently}),this.setSize(u.width,u.height)}}Er.SceneCanvas=a;class l extends r{constructor(u={width:0,height:0}){super(u),this.hitCanvas=!0,this.context=new t.HitContext(this),this.setSize(u.width,u.height)}}return Er.HitCanvas=l,Er}var jv={},VT;function Lj(){return VT||(VT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;const t=jt(),n=En();e.DD={get isDragging(){let s=!1;return e.DD._dragElements.forEach(o=>{o.dragStatus==="dragging"&&(s=!0)}),s},justDragged:!1,get node(){let s;return e.DD._dragElements.forEach(o=>{s=o.node}),s},_dragElements:new Map,_drag(s){const o=[];e.DD._dragElements.forEach((r,a)=>{const{node:l}=r,d=l.getStage();d.setPointersPositions(s),r.pointerId===void 0&&(r.pointerId=n.Util._getFirstPointerId(s));const u=d._changedPointerPositions.find(h=>h.id===r.pointerId);if(u){if(r.dragStatus!=="dragging"){const h=l.dragDistance();if(Math.max(Math.abs(u.x-r.startPointerPos.x),Math.abs(u.y-r.startPointerPos.y))<h||(l.startDrag({evt:s}),!l.isDragging()))return}l._setDragPosition(s,r),o.push(l)}}),o.forEach(r=>{r.fire("dragmove",{type:"dragmove",target:r,evt:s},!0)})},_endDragBefore(s){const o=[];e.DD._dragElements.forEach(r=>{const{node:a}=r,l=a.getStage();if(s&&l.setPointersPositions(s),!l._changedPointerPositions.find(h=>h.id===r.pointerId))return;(r.dragStatus==="dragging"||r.dragStatus==="stopped")&&(e.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,r.dragStatus="stopped");const u=r.node.getLayer()||r.node instanceof t.Konva.Stage&&r.node;u&&o.indexOf(u)===-1&&o.push(u)}),o.forEach(r=>{r.draw()})},_endDragAfter(s){e.DD._dragElements.forEach((o,r)=>{o.dragStatus==="stopped"&&o.node.fire("dragend",{type:"dragend",target:o.node,evt:s},!0),o.dragStatus!=="dragging"&&e.DD._dragElements.delete(r)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("touchcancel",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1),window.addEventListener("touchcancel",e.DD._endDragAfter,!1))}(jv)),jv}var zT;function Nn(){if(zT)return yh;zT=1,Object.defineProperty(yh,"__esModule",{value:!0}),yh.Node=void 0;const e=En(),t=It(),n=zy(),s=jt(),o=Lj(),r=Tt(),a="absoluteOpacity",l="allEventListeners",d="absoluteTransform",u="absoluteScale",h="canvas",p="Change",f="children",m="konva",g="listening",x="mouseenter",b="mouseleave",C="set",y="Shape",v=" ",w="stage",k="transform",S="Stage",P="visible",E=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(v);let L=1;class I{constructor(_){this._id=L++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(_),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(_){(_===k||_===d)&&this._cache.get(_)?this._cache.get(_).dirty=!0:_?this._cache.delete(_):this._cache.clear()}_getCache(_,R){let D=this._cache.get(_);return(D===void 0||(_===k||_===d)&&D.dirty===!0)&&(D=R.call(this),this._cache.set(_,D)),D}_calculate(_,R,D){if(!this._attachedDepsListeners.get(_)){const B=R.map(V=>V+"Change.konva").join(v);this.on(B,()=>{this._clearCache(_)}),this._attachedDepsListeners.set(_,!0)}return this._getCache(_,D)}_getCanvasCache(){return this._cache.get(h)}_clearSelfAndDescendantCache(_){this._clearCache(_),_===d&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(h)){const{scene:_,filter:R,hit:D}=this._cache.get(h);e.Util.releaseCanvas(_,R,D),this._cache.delete(h)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(_){const R=_||{};let D={};(R.x===void 0||R.y===void 0||R.width===void 0||R.height===void 0)&&(D=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let B=Math.ceil(R.width||D.width),V=Math.ceil(R.height||D.height),ee=R.pixelRatio,se=R.x===void 0?Math.floor(D.x):R.x,oe=R.y===void 0?Math.floor(D.y):R.y,te=R.offset||0,H=R.drawBorder||!1,z=R.hitCanvasPixelRatio||1;if(!B||!V){e.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const Z=Math.abs(Math.round(D.x)-se)>.5?1:0,U=Math.abs(Math.round(D.y)-oe)>.5?1:0;B+=te*2+Z,V+=te*2+U,se-=te,oe-=te;const Y=new n.SceneCanvas({pixelRatio:ee,width:B,height:V}),$=new n.SceneCanvas({pixelRatio:ee,width:0,height:0,willReadFrequently:!0}),F=new n.HitCanvas({pixelRatio:z,width:B,height:V}),q=Y.getContext(),ie=F.getContext();return F.isCache=!0,Y.isCache=!0,this._cache.delete(h),this._filterUpToDate=!1,R.imageSmoothingEnabled===!1&&(Y.getContext()._context.imageSmoothingEnabled=!1,$.getContext()._context.imageSmoothingEnabled=!1),q.save(),ie.save(),q.translate(-se,-oe),ie.translate(-se,-oe),this._isUnderCache=!0,this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(u),this.drawScene(Y,this),this.drawHit(F,this),this._isUnderCache=!1,q.restore(),ie.restore(),H&&(q.save(),q.beginPath(),q.rect(0,0,B,V),q.closePath(),q.setAttr("strokeStyle","red"),q.setAttr("lineWidth",5),q.stroke(),q.restore()),this._cache.set(h,{scene:Y,filter:$,hit:F,x:se,y:oe}),this._requestDraw(),this}isCached(){return this._cache.has(h)}getClientRect(_){throw new Error('abstract "getClientRect" method call')}_transformedRect(_,R){const D=[{x:_.x,y:_.y},{x:_.x+_.width,y:_.y},{x:_.x+_.width,y:_.y+_.height},{x:_.x,y:_.y+_.height}];let B=1/0,V=1/0,ee=-1/0,se=-1/0;const oe=this.getAbsoluteTransform(R);return D.forEach(function(te){const H=oe.point(te);B===void 0&&(B=ee=H.x,V=se=H.y),B=Math.min(B,H.x),V=Math.min(V,H.y),ee=Math.max(ee,H.x),se=Math.max(se,H.y)}),{x:B,y:V,width:ee-B,height:se-V}}_drawCachedSceneCanvas(_){_.save(),_._applyOpacity(this),_._applyGlobalCompositeOperation(this);const R=this._getCanvasCache();_.translate(R.x,R.y);const D=this._getCachedSceneCanvas(),B=D.pixelRatio;_.drawImage(D._canvas,0,0,D.width/B,D.height/B),_.restore()}_drawCachedHitCanvas(_){const R=this._getCanvasCache(),D=R.hit;_.save(),_.translate(R.x,R.y),_.drawImage(D._canvas,0,0,D.width/D.pixelRatio,D.height/D.pixelRatio),_.restore()}_getCachedSceneCanvas(){let _=this.filters(),R=this._getCanvasCache(),D=R.scene,B=R.filter,V=B.getContext(),ee,se,oe,te;if(_){if(!this._filterUpToDate){const H=D.pixelRatio;B.setSize(D.width/D.pixelRatio,D.height/D.pixelRatio);try{for(ee=_.length,V.clear(),V.drawImage(D._canvas,0,0,D.getWidth()/H,D.getHeight()/H),se=V.getImageData(0,0,B.getWidth(),B.getHeight()),oe=0;oe<ee;oe++){if(te=_[oe],typeof te!="function"){e.Util.error("Filter should be type of function, but got "+typeof te+" instead. Please check correct filters");continue}te.call(this,se),V.putImageData(se,0,0)}}catch(z){e.Util.error("Unable to apply filter. "+z.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return B}return D}on(_,R){if(this._cache&&this._cache.delete(l),arguments.length===3)return this._delegate.apply(this,arguments);let D=_.split(v),B=D.length,V,ee,se,oe,te;for(V=0;V<B;V++)ee=D[V],se=ee.split("."),oe=se[0],te=se[1]||"",this.eventListeners[oe]||(this.eventListeners[oe]=[]),this.eventListeners[oe].push({name:te,handler:R});return this}off(_,R){let D=(_||"").split(v),B=D.length,V,ee,se,oe,te,H;if(this._cache&&this._cache.delete(l),!_)for(ee in this.eventListeners)this._off(ee);for(V=0;V<B;V++)if(se=D[V],oe=se.split("."),te=oe[0],H=oe[1],te)this.eventListeners[te]&&this._off(te,H,R);else for(ee in this.eventListeners)this._off(ee,H,R);return this}dispatchEvent(_){const R={target:this,type:_.type,evt:_};return this.fire(_.type,R),this}addEventListener(_,R){return this.on(_,function(D){R.call(this,D.evt)}),this}removeEventListener(_){return this.off(_),this}_delegate(_,R,D){const B=this;this.on(_,function(V){const ee=V.target.findAncestors(R,!0,B);for(let se=0;se<ee.length;se++)V=e.Util.cloneObject(V),V.currentTarget=ee[se],D.call(ee[se],V)})}remove(){return this.isDragging()&&this.stopDrag(),o.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(d),this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(w),this._clearSelfAndDescendantCache(P),this._clearSelfAndDescendantCache(g)}_remove(){this._clearCaches();const _=this.getParent();_&&_.children&&(_.children.splice(this.index,1),_._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(_){const R="get"+e.Util._capitalize(_);return e.Util._isFunction(this[R])?this[R]():this.attrs[_]}getAncestors(){let _=this.getParent(),R=[];for(;_;)R.push(_),_=_.getParent();return R}getAttrs(){return this.attrs||{}}setAttrs(_){return this._batchTransformChanges(()=>{let R,D;if(!_)return this;for(R in _)R!==f&&(D=C+e.Util._capitalize(R),e.Util._isFunction(this[D])?this[D](_[R]):this._setAttr(R,_[R]))}),this}isListening(){return this._getCache(g,this._isListening)}_isListening(_){if(!this.listening())return!1;const D=this.getParent();return D&&D!==_&&this!==_?D._isListening(_):!0}isVisible(){return this._getCache(P,this._isVisible)}_isVisible(_){if(!this.visible())return!1;const D=this.getParent();return D&&D!==_&&this!==_?D._isVisible(_):!0}shouldDrawHit(_,R=!1){if(_)return this._isVisible(_)&&this._isListening(_);const D=this.getLayer();let B=!1;o.DD._dragElements.forEach(ee=>{ee.dragStatus==="dragging"&&(ee.node.nodeType==="Stage"||ee.node.getLayer()===D)&&(B=!0)});const V=!R&&!s.Konva.hitOnDragEnabled&&(B||s.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!V}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let _=this.getDepth(),R=this,D=0,B,V,ee,se;function oe(H){for(B=[],V=H.length,ee=0;ee<V;ee++)se=H[ee],D++,se.nodeType!==y&&(B=B.concat(se.getChildren().slice())),se._id===R._id&&(ee=V);B.length>0&&B[0].getDepth()<=_&&oe(B)}const te=this.getStage();return R.nodeType!==S&&te&&oe(te.getChildren()),D}getDepth(){let _=0,R=this.parent;for(;R;)_++,R=R.parent;return _}_batchTransformChanges(_){this._batchingTransformChange=!0,_(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(k),this._clearSelfAndDescendantCache(d)),this._needClearTransformCache=!1}setPosition(_){return this._batchTransformChanges(()=>{this.x(_.x),this.y(_.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const _=this.getStage();if(!_)return null;const R=_.getPointerPosition();if(!R)return null;const D=this.getAbsoluteTransform().copy();return D.invert(),D.point(R)}getAbsolutePosition(_){let R=!1,D=this.parent;for(;D;){if(D.isCached()){R=!0;break}D=D.parent}R&&!_&&(_=!0);const B=this.getAbsoluteTransform(_).getMatrix(),V=new e.Transform,ee=this.offset();return V.m=B.slice(),V.translate(ee.x,ee.y),V.getTranslation()}setAbsolutePosition(_){const{x:R,y:D,...B}=this._clearTransform();this.attrs.x=R,this.attrs.y=D,this._clearCache(k);const V=this._getAbsoluteTransform().copy();return V.invert(),V.translate(_.x,_.y),_={x:this.attrs.x+V.getTranslation().x,y:this.attrs.y+V.getTranslation().y},this._setTransform(B),this.setPosition({x:_.x,y:_.y}),this._clearCache(k),this._clearSelfAndDescendantCache(d),this}_setTransform(_){let R;for(R in _)this.attrs[R]=_[R]}_clearTransform(){const _={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,_}move(_){let R=_.x,D=_.y,B=this.x(),V=this.y();return R!==void 0&&(B+=R),D!==void 0&&(V+=D),this.setPosition({x:B,y:V}),this}_eachAncestorReverse(_,R){let D=[],B=this.getParent(),V,ee;if(!(R&&R._id===this._id)){for(D.unshift(this);B&&(!R||B._id!==R._id);)D.unshift(B),B=B.parent;for(V=D.length,ee=0;ee<V;ee++)_(D[ee])}}rotate(_){return this.rotation(this.rotation()+_),this}moveToTop(){if(!this.parent)return e.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const _=this.index,R=this.parent.getChildren().length;return _<R-1?(this.parent.children.splice(_,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return e.Util.warn("Node has no parent. moveUp function is ignored."),!1;const _=this.index,R=this.parent.getChildren().length;return _<R-1?(this.parent.children.splice(_,1),this.parent.children.splice(_+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return e.Util.warn("Node has no parent. moveDown function is ignored."),!1;const _=this.index;return _>0?(this.parent.children.splice(_,1),this.parent.children.splice(_-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return e.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const _=this.index;return _>0?(this.parent.children.splice(_,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(_){if(!this.parent)return e.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(_<0||_>=this.parent.children.length)&&e.Util.warn("Unexpected value "+_+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const R=this.index;return this.parent.children.splice(R,1),this.parent.children.splice(_,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(a,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let _=this.opacity();const R=this.getParent();return R&&!R._isUnderCache&&(_*=R.getAbsoluteOpacity()),_}moveTo(_){return this.getParent()!==_&&(this._remove(),_.add(this)),this}toObject(){let _=this.getAttrs(),R,D,B,V,ee;const se={attrs:{},className:this.getClassName()};for(R in _)D=_[R],ee=e.Util.isObject(D)&&!e.Util._isPlainObject(D)&&!e.Util._isArray(D),!ee&&(B=typeof this[R]=="function"&&this[R],delete _[R],V=B?B.call(this):null,_[R]=D,V!==D&&(se.attrs[R]=D));return e.Util._prepareToStringify(se)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(_,R,D){const B=[];R&&this._isMatch(_)&&B.push(this);let V=this.parent;for(;V;){if(V===D)return B;V._isMatch(_)&&B.push(V),V=V.parent}return B}isAncestorOf(_){return!1}findAncestor(_,R,D){return this.findAncestors(_,R,D)[0]}_isMatch(_){if(!_)return!1;if(typeof _=="function")return _(this);let R=_.replace(/ /g,"").split(","),D=R.length,B,V;for(B=0;B<D;B++)if(V=R[B],e.Util.isValidSelector(V)||(e.Util.warn('Selector "'+V+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),e.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),e.Util.warn("Konva is awesome, right?")),V.charAt(0)==="#"){if(this.id()===V.slice(1))return!0}else if(V.charAt(0)==="."){if(this.hasName(V.slice(1)))return!0}else if(this.className===V||this.nodeType===V)return!0;return!1}getLayer(){const _=this.getParent();return _?_.getLayer():null}getStage(){return this._getCache(w,this._getStage)}_getStage(){const _=this.getParent();return _?_.getStage():null}fire(_,R={},D){return R.target=R.target||this,D?this._fireAndBubble(_,R):this._fire(_,R),this}getAbsoluteTransform(_){return _?this._getAbsoluteTransform(_):this._getCache(d,this._getAbsoluteTransform)}_getAbsoluteTransform(_){let R;if(_)return R=new e.Transform,this._eachAncestorReverse(function(D){const B=D.transformsEnabled();B==="all"?R.multiply(D.getTransform()):B==="position"&&R.translate(D.x()-D.offsetX(),D.y()-D.offsetY())},_),R;{R=this._cache.get(d)||new e.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(R):R.reset();const D=this.transformsEnabled();if(D==="all")R.multiply(this.getTransform());else if(D==="position"){const B=this.attrs.x||0,V=this.attrs.y||0,ee=this.attrs.offsetX||0,se=this.attrs.offsetY||0;R.translate(B-ee,V-se)}return R.dirty=!1,R}}getAbsoluteScale(_){let R=this;for(;R;)R._isUnderCache&&(_=R),R=R.getParent();const B=this.getAbsoluteTransform(_).decompose();return{x:B.scaleX,y:B.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(k,this._getTransform)}_getTransform(){var _,R;const D=this._cache.get(k)||new e.Transform;D.reset();const B=this.x(),V=this.y(),ee=s.Konva.getAngle(this.rotation()),se=(_=this.attrs.scaleX)!==null&&_!==void 0?_:1,oe=(R=this.attrs.scaleY)!==null&&R!==void 0?R:1,te=this.attrs.skewX||0,H=this.attrs.skewY||0,z=this.attrs.offsetX||0,Z=this.attrs.offsetY||0;return(B!==0||V!==0)&&D.translate(B,V),ee!==0&&D.rotate(ee),(te!==0||H!==0)&&D.skew(te,H),(se!==1||oe!==1)&&D.scale(se,oe),(z!==0||Z!==0)&&D.translate(-1*z,-1*Z),D.dirty=!1,D}clone(_){let R=e.Util.cloneObject(this.attrs),D,B,V,ee,se;for(D in _)R[D]=_[D];const oe=new this.constructor(R);for(D in this.eventListeners)for(B=this.eventListeners[D],V=B.length,ee=0;ee<V;ee++)se=B[ee],se.name.indexOf(m)<0&&(oe.eventListeners[D]||(oe.eventListeners[D]=[]),oe.eventListeners[D].push(se));return oe}_toKonvaCanvas(_){_=_||{};const R=this.getClientRect(),D=this.getStage(),B=_.x!==void 0?_.x:Math.floor(R.x),V=_.y!==void 0?_.y:Math.floor(R.y),ee=_.pixelRatio||1,se=new n.SceneCanvas({width:_.width||Math.ceil(R.width)||(D?D.width():0),height:_.height||Math.ceil(R.height)||(D?D.height():0),pixelRatio:ee}),oe=se.getContext(),te=new n.SceneCanvas({width:se.width/se.pixelRatio+Math.abs(B),height:se.height/se.pixelRatio+Math.abs(V),pixelRatio:se.pixelRatio});return _.imageSmoothingEnabled===!1&&(oe._context.imageSmoothingEnabled=!1),oe.save(),(B||V)&&oe.translate(-1*B,-1*V),this.drawScene(se,void 0,te),oe.restore(),se}toCanvas(_){return this._toKonvaCanvas(_)._canvas}toDataURL(_){_=_||{};const R=_.mimeType||null,D=_.quality||null,B=this._toKonvaCanvas(_).toDataURL(R,D);return _.callback&&_.callback(B),B}toImage(_){return new Promise((R,D)=>{try{const B=_==null?void 0:_.callback;B&&delete _.callback,e.Util._urlToImage(this.toDataURL(_),function(V){R(V),B==null||B(V)})}catch(B){D(B)}})}toBlob(_){return new Promise((R,D)=>{try{const B=_==null?void 0:_.callback;B&&delete _.callback,this.toCanvas(_).toBlob(V=>{R(V),B==null||B(V)},_==null?void 0:_.mimeType,_==null?void 0:_.quality)}catch(B){D(B)}})}setSize(_){return this.width(_.width),this.height(_.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():s.Konva.dragDistance}_off(_,R,D){let B=this.eventListeners[_],V,ee,se;for(V=0;V<B.length;V++)if(ee=B[V].name,se=B[V].handler,(ee!=="konva"||R==="konva")&&(!R||ee===R)&&(!D||D===se)){if(B.splice(V,1),B.length===0){delete this.eventListeners[_];break}V--}}_fireChangeEvent(_,R,D){this._fire(_+p,{oldVal:R,newVal:D})}addName(_){if(!this.hasName(_)){const R=this.name(),D=R?R+" "+_:_;this.name(D)}return this}hasName(_){if(!_)return!1;const R=this.name();return R?(R||"").split(/\s/g).indexOf(_)!==-1:!1}removeName(_){const R=(this.name()||"").split(/\s/g),D=R.indexOf(_);return D!==-1&&(R.splice(D,1),this.name(R.join(" "))),this}setAttr(_,R){const D=this[C+e.Util._capitalize(_)];return e.Util._isFunction(D)?D.call(this,R):this._setAttr(_,R),this}_requestDraw(){if(s.Konva.autoDrawEnabled){const _=this.getLayer()||this.getStage();_==null||_.batchDraw()}}_setAttr(_,R){const D=this.attrs[_];D===R&&!e.Util.isObject(R)||(R==null?delete this.attrs[_]:this.attrs[_]=R,this._shouldFireChangeEvents&&this._fireChangeEvent(_,D,R),this._requestDraw())}_setComponentAttr(_,R,D){let B;D!==void 0&&(B=this.attrs[_],B||(this.attrs[_]=this.getAttr(_)),this.attrs[_][R]=D,this._fireChangeEvent(_,B,D))}_fireAndBubble(_,R,D){if(R&&this.nodeType===y&&(R.target=this),!((_===x||_===b)&&(D&&(this===D||this.isAncestorOf&&this.isAncestorOf(D))||this.nodeType==="Stage"&&!D))){this._fire(_,R);const V=(_===x||_===b)&&D&&D.isAncestorOf&&D.isAncestorOf(this)&&!D.isAncestorOf(this.parent);(R&&!R.cancelBubble||!R)&&this.parent&&this.parent.isListening()&&!V&&(D&&D.parent?this._fireAndBubble.call(this.parent,_,R,D):this._fireAndBubble.call(this.parent,_,R))}}_getProtoListeners(_){var R,D,B;const V=(R=this._cache.get(l))!==null&&R!==void 0?R:{};let ee=V==null?void 0:V[_];if(ee===void 0){ee=[];let se=Object.getPrototypeOf(this);for(;se;){const oe=(B=(D=se.eventListeners)===null||D===void 0?void 0:D[_])!==null&&B!==void 0?B:[];ee.push(...oe),se=Object.getPrototypeOf(se)}V[_]=ee,this._cache.set(l,V)}return ee}_fire(_,R){R=R||{},R.currentTarget=this,R.type=_;const D=this._getProtoListeners(_);if(D)for(var B=0;B<D.length;B++)D[B].handler.call(this,R);const V=this.eventListeners[_];if(V)for(var B=0;B<V.length;B++)V[B].handler.call(this,R)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(_){const R=_?_.pointerId:void 0,D=this.getStage(),B=this.getAbsolutePosition();if(!D)return;const V=D._getPointerById(R)||D._changedPointerPositions[0]||B;o.DD._dragElements.set(this._id,{node:this,startPointerPos:V,offset:{x:V.x-B.x,y:V.y-B.y},dragStatus:"ready",pointerId:R})}startDrag(_,R=!0){o.DD._dragElements.has(this._id)||this._createDragElement(_);const D=o.DD._dragElements.get(this._id);D.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:_&&_.evt},R)}_setDragPosition(_,R){const D=this.getStage()._getPointerById(R.pointerId);if(!D)return;let B={x:D.x-R.offset.x,y:D.y-R.offset.y};const V=this.dragBoundFunc();if(V!==void 0){const ee=V.call(this,B,_);ee?B=ee:e.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==B.x||this._lastPos.y!==B.y)&&(this.setAbsolutePosition(B),this._requestDraw()),this._lastPos=B}stopDrag(_){const R=o.DD._dragElements.get(this._id);R&&(R.dragStatus="stopped"),o.DD._endDragBefore(_),o.DD._endDragAfter(_)}setDraggable(_){this._setAttr("draggable",_),this._dragChange()}isDragging(){const _=o.DD._dragElements.get(this._id);return _?_.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(_){if(!(!(_.evt.button!==void 0)||s.Konva.dragButtons.indexOf(_.evt.button)>=0)||this.isDragging())return;let B=!1;o.DD._dragElements.forEach(V=>{this.isAncestorOf(V.node)&&(B=!0)}),B||this._createDragElement(_)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const R=o.DD._dragElements.get(this._id),D=R&&R.dragStatus==="dragging",B=R&&R.dragStatus==="ready";D?this.stopDrag():B&&o.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(_={x:0,y:0}){const R=this.getStage();if(!R)return!1;const D={x:-_.x,y:-_.y,width:R.width()+2*_.x,height:R.height()+2*_.y};return e.Util.haveIntersection(D,this.getClientRect())}static create(_,R){return e.Util._isString(_)&&(_=JSON.parse(_)),this._createNode(_,R)}static _createNode(_,R){let D=I.prototype.getClassName.call(_),B=_.children,V,ee,se;R&&(_.attrs.container=R),s.Konva[D]||(e.Util.warn('Can not find a node with class name "'+D+'". Fallback to "Shape".'),D="Shape");const oe=s.Konva[D];if(V=new oe(_.attrs),B)for(ee=B.length,se=0;se<ee;se++)V.add(I._createNode(B[se]));return V}}yh.Node=I,I.prototype.nodeType="Node",I.prototype._attrsAffectingSize=[],I.prototype.eventListeners={},I.prototype.on.call(I.prototype,E,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(k),this._clearSelfAndDescendantCache(d)}),I.prototype.on.call(I.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(P)}),I.prototype.on.call(I.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(g)}),I.prototype.on.call(I.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(a)});const O=t.Factory.addGetterSetter;return O(I,"zIndex"),O(I,"absolutePosition"),O(I,"position"),O(I,"x",0,(0,r.getNumberValidator)()),O(I,"y",0,(0,r.getNumberValidator)()),O(I,"globalCompositeOperation","source-over",(0,r.getStringValidator)()),O(I,"opacity",1,(0,r.getNumberValidator)()),O(I,"name","",(0,r.getStringValidator)()),O(I,"id","",(0,r.getStringValidator)()),O(I,"rotation",0,(0,r.getNumberValidator)()),t.Factory.addComponentsGetterSetter(I,"scale",["x","y"]),O(I,"scaleX",1,(0,r.getNumberValidator)()),O(I,"scaleY",1,(0,r.getNumberValidator)()),t.Factory.addComponentsGetterSetter(I,"skew",["x","y"]),O(I,"skewX",0,(0,r.getNumberValidator)()),O(I,"skewY",0,(0,r.getNumberValidator)()),t.Factory.addComponentsGetterSetter(I,"offset",["x","y"]),O(I,"offsetX",0,(0,r.getNumberValidator)()),O(I,"offsetY",0,(0,r.getNumberValidator)()),O(I,"dragDistance",void 0,(0,r.getNumberValidator)()),O(I,"width",0,(0,r.getNumberValidator)()),O(I,"height",0,(0,r.getNumberValidator)()),O(I,"listening",!0,(0,r.getBooleanValidator)()),O(I,"preventDefault",!0,(0,r.getBooleanValidator)()),O(I,"filters",void 0,function(N){return this._filterUpToDate=!1,N}),O(I,"visible",!0,(0,r.getBooleanValidator)()),O(I,"transformsEnabled","all",(0,r.getStringValidator)()),O(I,"size"),O(I,"dragBoundFunc"),O(I,"draggable",!1,(0,r.getBooleanValidator)()),t.Factory.backCompat(I,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),yh}var bh={},GT;function Gy(){if(GT)return bh;GT=1,Object.defineProperty(bh,"__esModule",{value:!0}),bh.Container=void 0;const e=It(),t=Nn(),n=Tt();let s=class extends t.Node{constructor(){super(...arguments),this.children=[]}getChildren(r){if(!r)return this.children||[];const a=this.children||[],l=[];return a.forEach(function(d){r(d)&&l.push(d)}),l}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(r=>{r.parent=null,r.index=0,r.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(r=>{r.parent=null,r.index=0,r.destroy()}),this.children=[],this._requestDraw(),this}add(...r){if(r.length===0)return this;if(r.length>1){for(let l=0;l<r.length;l++)this.add(r[l]);return this}const a=r[0];return a.getParent()?(a.moveTo(this),this):(this._validateAdd(a),a.index=this.getChildren().length,a.parent=this,a._clearCaches(),this.getChildren().push(a),this._fire("add",{child:a}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(r){return this._generalFind(r,!1)}findOne(r){const a=this._generalFind(r,!0);return a.length>0?a[0]:void 0}_generalFind(r,a){const l=[];return this._descendants(d=>{const u=d._isMatch(r);return u&&l.push(d),!!(u&&a)}),l}_descendants(r){let a=!1;const l=this.getChildren();for(const d of l){if(a=r(d),a)return!0;if(d.hasChildren()&&(a=d._descendants(r),a))return!0}return!1}toObject(){const r=t.Node.prototype.toObject.call(this);return r.children=[],this.getChildren().forEach(a=>{r.children.push(a.toObject())}),r}isAncestorOf(r){let a=r.getParent();for(;a;){if(a._id===this._id)return!0;a=a.getParent()}return!1}clone(r){const a=t.Node.prototype.clone.call(this,r);return this.getChildren().forEach(function(l){a.add(l.clone())}),a}getAllIntersections(r){const a=[];return this.find("Shape").forEach(l=>{l.isVisible()&&l.intersects(r)&&a.push(l)}),a}_clearSelfAndDescendantCache(r){var a;super._clearSelfAndDescendantCache(r),!this.isCached()&&((a=this.children)===null||a===void 0||a.forEach(function(l){l._clearSelfAndDescendantCache(r)}))}_setChildrenIndices(){var r;(r=this.children)===null||r===void 0||r.forEach(function(a,l){a.index=l}),this._requestDraw()}drawScene(r,a,l){const d=this.getLayer(),u=r||d&&d.getCanvas(),h=u&&u.getContext(),p=this._getCanvasCache(),f=p&&p.scene,m=u&&u.isCache;if(!this.isVisible()&&!m)return this;if(f){h.save();const g=this.getAbsoluteTransform(a).getMatrix();h.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._drawCachedSceneCanvas(h),h.restore()}else this._drawChildren("drawScene",u,a,l);return this}drawHit(r,a){if(!this.shouldDrawHit(a))return this;const l=this.getLayer(),d=r||l&&l.hitCanvas,u=d&&d.getContext(),h=this._getCanvasCache();if(h&&h.hit){u.save();const f=this.getAbsoluteTransform(a).getMatrix();u.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this._drawCachedHitCanvas(u),u.restore()}else this._drawChildren("drawHit",d,a);return this}_drawChildren(r,a,l,d){var u;const h=a&&a.getContext(),p=this.clipWidth(),f=this.clipHeight(),m=this.clipFunc(),g=typeof p=="number"&&typeof f=="number"||m,x=l===this;if(g){h.save();const C=this.getAbsoluteTransform(l);let y=C.getMatrix();h.transform(y[0],y[1],y[2],y[3],y[4],y[5]),h.beginPath();let v;if(m)v=m.call(this,h,this);else{const w=this.clipX(),k=this.clipY();h.rect(w||0,k||0,p,f)}h.clip.apply(h,v),y=C.copy().invert().getMatrix(),h.transform(y[0],y[1],y[2],y[3],y[4],y[5])}const b=!x&&this.globalCompositeOperation()!=="source-over"&&r==="drawScene";b&&(h.save(),h._applyGlobalCompositeOperation(this)),(u=this.children)===null||u===void 0||u.forEach(function(C){C[r](a,l,d)}),b&&h.restore(),g&&h.restore()}getClientRect(r={}){var a;const l=r.skipTransform,d=r.relativeTo;let u,h,p,f,m={x:1/0,y:1/0,width:0,height:0};const g=this;(a=this.children)===null||a===void 0||a.forEach(function(C){if(!C.visible())return;const y=C.getClientRect({relativeTo:g,skipShadow:r.skipShadow,skipStroke:r.skipStroke});y.width===0&&y.height===0||(u===void 0?(u=y.x,h=y.y,p=y.x+y.width,f=y.y+y.height):(u=Math.min(u,y.x),h=Math.min(h,y.y),p=Math.max(p,y.x+y.width),f=Math.max(f,y.y+y.height)))});const x=this.find("Shape");let b=!1;for(let C=0;C<x.length;C++)if(x[C]._isVisible(this)){b=!0;break}return b&&u!==void 0?m={x:u,y:h,width:p-u,height:f-h}:m={x:0,y:0,width:0,height:0},l?m:this._transformedRect(m,d)}};return bh.Container=s,e.Factory.addComponentsGetterSetter(s,"clip",["x","y","width","height"]),e.Factory.addGetterSetter(s,"clipX",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipY",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipWidth",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipHeight",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipFunc"),bh}var _v={},ya={},HT;function cO(){if(HT)return ya;HT=1,Object.defineProperty(ya,"__esModule",{value:!0}),ya.getCapturedShape=s,ya.createEvent=o,ya.hasPointerCapture=r,ya.setPointerCapture=a,ya.releaseCapture=l;const e=jt(),t=new Map,n=e.Konva._global.PointerEvent!==void 0;function s(d){return t.get(d)}function o(d){return{evt:d,pointerId:d.pointerId}}function r(d,u){return t.get(d)===u}function a(d,u){l(d),u.getStage()&&(t.set(d,u),n&&u._fire("gotpointercapture",o(new PointerEvent("gotpointercapture"))))}function l(d,u){const h=t.get(d);if(!h)return;const p=h.getStage();p&&p.content,t.delete(d),n&&h._fire("lostpointercapture",o(new PointerEvent("lostpointercapture")))}return ya}var WT;function qge(){return WT||(WT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stage=e.stages=void 0;const t=En(),n=It(),s=Gy(),o=jt(),r=zy(),a=Lj(),l=jt(),d=cO(),u="Stage",h="string",p="px",f="mouseout",m="mouseleave",g="mouseover",x="mouseenter",b="mousemove",C="mousedown",y="mouseup",v="pointermove",w="pointerdown",k="pointerup",S="pointercancel",P="lostpointercapture",E="pointerout",L="pointerleave",I="pointerover",O="pointerenter",N="contextmenu",_="touchstart",R="touchend",D="touchmove",B="touchcancel",V="wheel",ee=5,se=[[x,"_pointerenter"],[C,"_pointerdown"],[b,"_pointermove"],[y,"_pointerup"],[m,"_pointerleave"],[_,"_pointerdown"],[D,"_pointermove"],[R,"_pointerup"],[B,"_pointercancel"],[g,"_pointerover"],[V,"_wheel"],[N,"_contextmenu"],[w,"_pointerdown"],[v,"_pointermove"],[k,"_pointerup"],[S,"_pointercancel"],[P,"_lostpointercapture"]],oe={mouse:{[E]:f,[L]:m,[I]:g,[O]:x,[v]:b,[w]:C,[k]:y,[S]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[E]:"touchout",[L]:"touchleave",[I]:"touchover",[O]:"touchenter",[v]:D,[w]:_,[k]:R,[S]:B,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[E]:E,[L]:L,[I]:I,[O]:O,[v]:v,[w]:w,[k]:k,[S]:S,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},te=Y=>Y.indexOf("pointer")>=0?"pointer":Y.indexOf("touch")>=0?"touch":"mouse",H=Y=>{const $=te(Y);if($==="pointer")return o.Konva.pointerEventsEnabled&&oe.pointer;if($==="touch")return oe.touch;if($==="mouse")return oe.mouse};function z(Y={}){return(Y.clipFunc||Y.clipWidth||Y.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),Y}const Z="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";e.stages=[];class U extends s.Container{constructor($){super(z($)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),e.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{z(this.attrs)}),this._checkVisibility()}_validateAdd($){const F=$.getType()==="Layer",q=$.getType()==="FastLayer";F||q||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const $=this.visible()?"":"none";this.content.style.display=$}setContainer($){if(typeof $===h){if($.charAt(0)==="."){const q=$.slice(1);$=document.getElementsByClassName(q)[0]}else{var F;$.charAt(0)!=="#"?F=$:F=$.slice(1),$=document.getElementById(F)}if(!$)throw"Can not find container in document with id "+F}return this._setAttr("container",$),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),$.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const $=this.children,F=$.length;for(let q=0;q<F;q++)$[q].clear();return this}clone($){return $||($={}),$.container=typeof document<"u"&&document.createElement("div"),s.Container.prototype.clone.call(this,$)}destroy(){super.destroy();const $=this.content;$&&t.Util._isInDocument($)&&this.container().removeChild($);const F=e.stages.indexOf(this);return F>-1&&e.stages.splice(F,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const $=this._pointerPositions[0]||this._changedPointerPositions[0];return $?{x:$.x,y:$.y}:(t.Util.warn(Z),null)}_getPointerById($){return this._pointerPositions.find(F=>F.id===$)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas($){$=$||{},$.x=$.x||0,$.y=$.y||0,$.width=$.width||this.width(),$.height=$.height||this.height();const F=new r.SceneCanvas({width:$.width,height:$.height,pixelRatio:$.pixelRatio||1}),q=F.getContext()._context,ie=this.children;return($.x||$.y)&&q.translate(-1*$.x,-1*$.y),ie.forEach(function(ce){if(!ce.isVisible())return;const me=ce._toKonvaCanvas($);q.drawImage(me._canvas,$.x,$.y,me.getWidth()/me.getPixelRatio(),me.getHeight()/me.getPixelRatio())}),F}getIntersection($){if(!$)return null;const F=this.children,q=F.length,ie=q-1;for(let ce=ie;ce>=0;ce--){const me=F[ce].getIntersection($);if(me)return me}return null}_resizeDOM(){const $=this.width(),F=this.height();this.content&&(this.content.style.width=$+p,this.content.style.height=F+p),this.bufferCanvas.setSize($,F),this.bufferHitCanvas.setSize($,F),this.children.forEach(q=>{q.setSize({width:$,height:F}),q.draw()})}add($,...F){if(arguments.length>1){for(let ie=0;ie<arguments.length;ie++)this.add(arguments[ie]);return this}super.add($);const q=this.children.length;return q>ee&&t.Util.warn("The stage has "+q+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),$.setSize({width:this.width(),height:this.height()}),$.draw(),o.Konva.isBrowser&&this.content.appendChild($.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture($){return d.hasPointerCapture($,this)}setPointerCapture($){d.setPointerCapture($,this)}releaseCapture($){d.releaseCapture($,this)}getLayers(){return this.children}_bindContentEvents(){o.Konva.isBrowser&&se.forEach(([$,F])=>{this.content.addEventListener($,q=>{this[F](q)},{passive:!1})})}_pointerenter($){this.setPointersPositions($);const F=H($.type);F&&this._fire(F.pointerenter,{evt:$,target:this,currentTarget:this})}_pointerover($){this.setPointersPositions($);const F=H($.type);F&&this._fire(F.pointerover,{evt:$,target:this,currentTarget:this})}_getTargetShape($){let F=this[$+"targetShape"];return F&&!F.getStage()&&(F=null),F}_pointerleave($){const F=H($.type),q=te($.type);if(!F)return;this.setPointersPositions($);const ie=this._getTargetShape(q),ce=!(o.Konva.isDragging()||o.Konva.isTransforming())||o.Konva.hitOnDragEnabled;ie&&ce?(ie._fireAndBubble(F.pointerout,{evt:$}),ie._fireAndBubble(F.pointerleave,{evt:$}),this._fire(F.pointerleave,{evt:$,target:this,currentTarget:this}),this[q+"targetShape"]=null):ce&&(this._fire(F.pointerleave,{evt:$,target:this,currentTarget:this}),this._fire(F.pointerout,{evt:$,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown($){const F=H($.type),q=te($.type);if(!F)return;this.setPointersPositions($);let ie=!1;this._changedPointerPositions.forEach(ce=>{const me=this.getIntersection(ce);if(a.DD.justDragged=!1,o.Konva["_"+q+"ListenClick"]=!0,!me||!me.isListening()){this[q+"ClickStartShape"]=void 0;return}o.Konva.capturePointerEventsEnabled&&me.setPointerCapture(ce.id),this[q+"ClickStartShape"]=me,me._fireAndBubble(F.pointerdown,{evt:$,pointerId:ce.id}),ie=!0;const Ie=$.type.indexOf("touch")>=0;me.preventDefault()&&$.cancelable&&Ie&&$.preventDefault()}),ie||this._fire(F.pointerdown,{evt:$,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove($){const F=H($.type),q=te($.type);if(!F||(o.Konva.isDragging()&&a.DD.node.preventDefault()&&$.cancelable&&$.preventDefault(),this.setPointersPositions($),!(!(o.Konva.isDragging()||o.Konva.isTransforming())||o.Konva.hitOnDragEnabled)))return;const ce={};let me=!1;const Ie=this._getTargetShape(q);this._changedPointerPositions.forEach(we=>{const Ee=d.getCapturedShape(we.id)||this.getIntersection(we),ot=we.id,Fe={evt:$,pointerId:ot},Be=Ie!==Ee;if(Be&&Ie&&(Ie._fireAndBubble(F.pointerout,{...Fe},Ee),Ie._fireAndBubble(F.pointerleave,{...Fe},Ee)),Ee){if(ce[Ee._id])return;ce[Ee._id]=!0}Ee&&Ee.isListening()?(me=!0,Be&&(Ee._fireAndBubble(F.pointerover,{...Fe},Ie),Ee._fireAndBubble(F.pointerenter,{...Fe},Ie),this[q+"targetShape"]=Ee),Ee._fireAndBubble(F.pointermove,{...Fe})):Ie&&(this._fire(F.pointerover,{evt:$,target:this,currentTarget:this,pointerId:ot}),this[q+"targetShape"]=null)}),me||this._fire(F.pointermove,{evt:$,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup($){const F=H($.type),q=te($.type);if(!F)return;this.setPointersPositions($);const ie=this[q+"ClickStartShape"],ce=this[q+"ClickEndShape"],me={};let Ie=!1;this._changedPointerPositions.forEach(we=>{const Ee=d.getCapturedShape(we.id)||this.getIntersection(we);if(Ee){if(Ee.releaseCapture(we.id),me[Ee._id])return;me[Ee._id]=!0}const ot=we.id,Fe={evt:$,pointerId:ot};let Be=!1;o.Konva["_"+q+"InDblClickWindow"]?(Be=!0,clearTimeout(this[q+"DblTimeout"])):a.DD.justDragged||(o.Konva["_"+q+"InDblClickWindow"]=!0,clearTimeout(this[q+"DblTimeout"])),this[q+"DblTimeout"]=setTimeout(function(){o.Konva["_"+q+"InDblClickWindow"]=!1},o.Konva.dblClickWindow),Ee&&Ee.isListening()?(Ie=!0,this[q+"ClickEndShape"]=Ee,Ee._fireAndBubble(F.pointerup,{...Fe}),o.Konva["_"+q+"ListenClick"]&&ie&&ie===Ee&&(Ee._fireAndBubble(F.pointerclick,{...Fe}),Be&&ce&&ce===Ee&&Ee._fireAndBubble(F.pointerdblclick,{...Fe}))):(this[q+"ClickEndShape"]=null,o.Konva["_"+q+"ListenClick"]&&this._fire(F.pointerclick,{evt:$,target:this,currentTarget:this,pointerId:ot}),Be&&this._fire(F.pointerdblclick,{evt:$,target:this,currentTarget:this,pointerId:ot}))}),Ie||this._fire(F.pointerup,{evt:$,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),o.Konva["_"+q+"ListenClick"]=!1,$.cancelable&&q!=="touch"&&q!=="pointer"&&$.preventDefault()}_contextmenu($){this.setPointersPositions($);const F=this.getIntersection(this.getPointerPosition());F&&F.isListening()?F._fireAndBubble(N,{evt:$}):this._fire(N,{evt:$,target:this,currentTarget:this})}_wheel($){this.setPointersPositions($);const F=this.getIntersection(this.getPointerPosition());F&&F.isListening()?F._fireAndBubble(V,{evt:$}):this._fire(V,{evt:$,target:this,currentTarget:this})}_pointercancel($){this.setPointersPositions($);const F=d.getCapturedShape($.pointerId)||this.getIntersection(this.getPointerPosition());F&&F._fireAndBubble(k,d.createEvent($)),d.releaseCapture($.pointerId)}_lostpointercapture($){d.releaseCapture($.pointerId)}setPointersPositions($){const F=this._getContentPosition();let q=null,ie=null;$=$||window.event,$.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call($.touches,ce=>{this._pointerPositions.push({id:ce.identifier,x:(ce.clientX-F.left)/F.scaleX,y:(ce.clientY-F.top)/F.scaleY})}),Array.prototype.forEach.call($.changedTouches||$.touches,ce=>{this._changedPointerPositions.push({id:ce.identifier,x:(ce.clientX-F.left)/F.scaleX,y:(ce.clientY-F.top)/F.scaleY})})):(q=($.clientX-F.left)/F.scaleX,ie=($.clientY-F.top)/F.scaleY,this.pointerPos={x:q,y:ie},this._pointerPositions=[{x:q,y:ie,id:t.Util._getFirstPointerId($)}],this._changedPointerPositions=[{x:q,y:ie,id:t.Util._getFirstPointerId($)}])}_setPointerPosition($){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions($)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const $=this.content.getBoundingClientRect();return{top:$.top,left:$.left,scaleX:$.width/this.content.clientWidth||1,scaleY:$.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new r.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new r.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!o.Konva.isBrowser)return;const $=this.container();if(!$)throw"Stage has no container. A container is required.";$.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),$.appendChild(this.content),this._resizeDOM()}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function($){$.batchDraw()}),this}}e.Stage=U,U.prototype.nodeType=u,(0,l._registerNode)(U),n.Factory.addGetterSetter(U,"container"),o.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{e.stages.forEach(Y=>{Y.batchDraw()})})}(_v)),_v}var vh={},Iv={},UT;function hs(){return UT||(UT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Shape=e.shapes=void 0;const t=jt(),n=En(),s=It(),o=Nn(),r=Tt(),a=jt(),l=cO(),d="hasShadow",u="shadowRGBA",h="patternImage",p="linearGradient",f="radialGradient";let m;function g(){return m||(m=n.Util.createCanvasElement().getContext("2d"),m)}e.shapes={};function x(L){const I=this.attrs.fillRule;I?L.fill(I):L.fill()}function b(L){L.stroke()}function C(L){const I=this.attrs.fillRule;I?L.fill(I):L.fill()}function y(L){L.stroke()}function v(){this._clearCache(d)}function w(){this._clearCache(u)}function k(){this._clearCache(h)}function S(){this._clearCache(p)}function P(){this._clearCache(f)}class E extends o.Node{constructor(I){super(I);let O;for(;O=n.Util.getRandomColor(),!(O&&!(O in e.shapes)););this.colorKey=O,e.shapes[O]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(d,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(h,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const O=g().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(O&&O.setTransform){const N=new n.Transform;N.translate(this.fillPatternX(),this.fillPatternY()),N.rotate(t.Konva.getAngle(this.fillPatternRotation())),N.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),N.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const _=N.getMatrix(),R=typeof DOMMatrix>"u"?{a:_[0],b:_[1],c:_[2],d:_[3],e:_[4],f:_[5]}:new DOMMatrix(_);O.setTransform(R)}return O}}_getLinearGradient(){return this._getCache(p,this.__getLinearGradient)}__getLinearGradient(){const I=this.fillLinearGradientColorStops();if(I){const O=g(),N=this.fillLinearGradientStartPoint(),_=this.fillLinearGradientEndPoint(),R=O.createLinearGradient(N.x,N.y,_.x,_.y);for(let D=0;D<I.length;D+=2)R.addColorStop(I[D],I[D+1]);return R}}_getRadialGradient(){return this._getCache(f,this.__getRadialGradient)}__getRadialGradient(){const I=this.fillRadialGradientColorStops();if(I){const O=g(),N=this.fillRadialGradientStartPoint(),_=this.fillRadialGradientEndPoint(),R=O.createRadialGradient(N.x,N.y,this.fillRadialGradientStartRadius(),_.x,_.y,this.fillRadialGradientEndRadius());for(let D=0;D<I.length;D+=2)R.addColorStop(I[D],I[D+1]);return R}}getShadowRGBA(){return this._getCache(u,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const I=n.Util.colorToRGBA(this.shadowColor());if(I)return"rgba("+I.r+","+I.g+","+I.b+","+I.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const I=this.hitStrokeWidth();return I==="auto"?this.hasStroke():this.strokeEnabled()&&!!I}intersects(I){const O=this.getStage();if(!O)return!1;const N=O.bufferHitCanvas;return N.getContext().clear(),this.drawHit(N,void 0,!0),N.context.getImageData(Math.round(I.x),Math.round(I.y),1,1).data[3]>0}destroy(){return o.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(I){var O;if(!((O=this.attrs.perfectDrawEnabled)!==null&&O!==void 0?O:!0))return!1;const _=I||this.hasFill(),R=this.hasStroke(),D=this.getAbsoluteOpacity()!==1;if(_&&R&&D)return!0;const B=this.hasShadow(),V=this.shadowForStrokeEnabled();return!!(_&&R&&B&&V)}setStrokeHitEnabled(I){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),I?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const I=this.size();return{x:this._centroid?-I.width/2:0,y:this._centroid?-I.height/2:0,width:I.width,height:I.height}}getClientRect(I={}){let O=!1,N=this.getParent();for(;N;){if(N.isCached()){O=!0;break}N=N.getParent()}const _=I.skipTransform,R=I.relativeTo||O&&this.getStage()||void 0,D=this.getSelfRect(),V=!I.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,ee=D.width+V,se=D.height+V,oe=!I.skipShadow&&this.hasShadow(),te=oe?this.shadowOffsetX():0,H=oe?this.shadowOffsetY():0,z=ee+Math.abs(te),Z=se+Math.abs(H),U=oe&&this.shadowBlur()||0,Y=z+U*2,$=Z+U*2,F={width:Y,height:$,x:-(V/2+U)+Math.min(te,0)+D.x,y:-(V/2+U)+Math.min(H,0)+D.y};return _?F:this._transformedRect(F,R)}drawScene(I,O,N){const _=this.getLayer();let R=I||_.getCanvas(),D=R.getContext(),B=this._getCanvasCache(),V=this.getSceneFunc(),ee=this.hasShadow(),se,oe;const te=R.isCache,H=O===this;if(!this.isVisible()&&!H)return this;if(B){D.save();const Z=this.getAbsoluteTransform(O).getMatrix();return D.transform(Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]),this._drawCachedSceneCanvas(D),D.restore(),this}if(!V)return this;if(D.save(),this._useBufferCanvas()&&!te){se=this.getStage();const Z=N||se.bufferCanvas;oe=Z.getContext(),oe.clear(),oe.save(),oe._applyLineJoin(this);var z=this.getAbsoluteTransform(O).getMatrix();oe.transform(z[0],z[1],z[2],z[3],z[4],z[5]),V.call(this,oe,this),oe.restore();const U=Z.pixelRatio;ee&&D._applyShadow(this),D._applyOpacity(this),D._applyGlobalCompositeOperation(this),D.drawImage(Z._canvas,0,0,Z.width/U,Z.height/U)}else{if(D._applyLineJoin(this),!H){var z=this.getAbsoluteTransform(O).getMatrix();D.transform(z[0],z[1],z[2],z[3],z[4],z[5]),D._applyOpacity(this),D._applyGlobalCompositeOperation(this)}ee&&D._applyShadow(this),V.call(this,D,this)}return D.restore(),this}drawHit(I,O,N=!1){if(!this.shouldDrawHit(O,N))return this;const _=this.getLayer(),R=I||_.hitCanvas,D=R&&R.getContext(),B=this.hitFunc()||this.sceneFunc(),V=this._getCanvasCache(),ee=V&&V.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),ee){D.save();const oe=this.getAbsoluteTransform(O).getMatrix();return D.transform(oe[0],oe[1],oe[2],oe[3],oe[4],oe[5]),this._drawCachedHitCanvas(D),D.restore(),this}if(!B)return this;if(D.save(),D._applyLineJoin(this),!(this===O)){const oe=this.getAbsoluteTransform(O).getMatrix();D.transform(oe[0],oe[1],oe[2],oe[3],oe[4],oe[5])}return B.call(this,D,this),D.restore(),this}drawHitFromCache(I=0){const O=this._getCanvasCache(),N=this._getCachedSceneCanvas(),_=O.hit,R=_.getContext(),D=_.getWidth(),B=_.getHeight();R.clear(),R.drawImage(N._canvas,0,0,D,B);try{const V=R.getImageData(0,0,D,B),ee=V.data,se=ee.length,oe=n.Util._hexToRgb(this.colorKey);for(let te=0;te<se;te+=4)ee[te+3]>I?(ee[te]=oe.r,ee[te+1]=oe.g,ee[te+2]=oe.b,ee[te+3]=255):ee[te+3]=0;R.putImageData(V,0,0)}catch(V){n.Util.error("Unable to draw hit graph from cached scene canvas. "+V.message)}return this}hasPointerCapture(I){return l.hasPointerCapture(I,this)}setPointerCapture(I){l.setPointerCapture(I,this)}releaseCapture(I){l.releaseCapture(I,this)}}e.Shape=E,E.prototype._fillFunc=x,E.prototype._strokeFunc=b,E.prototype._fillFuncHit=C,E.prototype._strokeFuncHit=y,E.prototype._centroid=!1,E.prototype.nodeType="Shape",(0,a._registerNode)(E),E.prototype.eventListeners={},E.prototype.on.call(E.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",v),E.prototype.on.call(E.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",w),E.prototype.on.call(E.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",k),E.prototype.on.call(E.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",S),E.prototype.on.call(E.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",P),s.Factory.addGetterSetter(E,"stroke",void 0,(0,r.getStringOrGradientValidator)()),s.Factory.addGetterSetter(E,"strokeWidth",2,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillAfterStrokeEnabled",!1),s.Factory.addGetterSetter(E,"hitStrokeWidth","auto",(0,r.getNumberOrAutoValidator)()),s.Factory.addGetterSetter(E,"strokeHitEnabled",!0,(0,r.getBooleanValidator)()),s.Factory.addGetterSetter(E,"perfectDrawEnabled",!0,(0,r.getBooleanValidator)()),s.Factory.addGetterSetter(E,"shadowForStrokeEnabled",!0,(0,r.getBooleanValidator)()),s.Factory.addGetterSetter(E,"lineJoin"),s.Factory.addGetterSetter(E,"lineCap"),s.Factory.addGetterSetter(E,"sceneFunc"),s.Factory.addGetterSetter(E,"hitFunc"),s.Factory.addGetterSetter(E,"dash"),s.Factory.addGetterSetter(E,"dashOffset",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"shadowColor",void 0,(0,r.getStringValidator)()),s.Factory.addGetterSetter(E,"shadowBlur",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"shadowOpacity",1,(0,r.getNumberValidator)()),s.Factory.addComponentsGetterSetter(E,"shadowOffset",["x","y"]),s.Factory.addGetterSetter(E,"shadowOffsetX",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"shadowOffsetY",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillPatternImage"),s.Factory.addGetterSetter(E,"fill",void 0,(0,r.getStringOrGradientValidator)()),s.Factory.addGetterSetter(E,"fillPatternX",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillPatternY",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillLinearGradientColorStops"),s.Factory.addGetterSetter(E,"strokeLinearGradientColorStops"),s.Factory.addGetterSetter(E,"fillRadialGradientStartRadius",0),s.Factory.addGetterSetter(E,"fillRadialGradientEndRadius",0),s.Factory.addGetterSetter(E,"fillRadialGradientColorStops"),s.Factory.addGetterSetter(E,"fillPatternRepeat","repeat"),s.Factory.addGetterSetter(E,"fillEnabled",!0),s.Factory.addGetterSetter(E,"strokeEnabled",!0),s.Factory.addGetterSetter(E,"shadowEnabled",!0),s.Factory.addGetterSetter(E,"dashEnabled",!0),s.Factory.addGetterSetter(E,"strokeScaleEnabled",!0),s.Factory.addGetterSetter(E,"fillPriority","color"),s.Factory.addComponentsGetterSetter(E,"fillPatternOffset",["x","y"]),s.Factory.addGetterSetter(E,"fillPatternOffsetX",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillPatternOffsetY",0,(0,r.getNumberValidator)()),s.Factory.addComponentsGetterSetter(E,"fillPatternScale",["x","y"]),s.Factory.addGetterSetter(E,"fillPatternScaleX",1,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillPatternScaleY",1,(0,r.getNumberValidator)()),s.Factory.addComponentsGetterSetter(E,"fillLinearGradientStartPoint",["x","y"]),s.Factory.addComponentsGetterSetter(E,"strokeLinearGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(E,"fillLinearGradientStartPointX",0),s.Factory.addGetterSetter(E,"strokeLinearGradientStartPointX",0),s.Factory.addGetterSetter(E,"fillLinearGradientStartPointY",0),s.Factory.addGetterSetter(E,"strokeLinearGradientStartPointY",0),s.Factory.addComponentsGetterSetter(E,"fillLinearGradientEndPoint",["x","y"]),s.Factory.addComponentsGetterSetter(E,"strokeLinearGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(E,"fillLinearGradientEndPointX",0),s.Factory.addGetterSetter(E,"strokeLinearGradientEndPointX",0),s.Factory.addGetterSetter(E,"fillLinearGradientEndPointY",0),s.Factory.addGetterSetter(E,"strokeLinearGradientEndPointY",0),s.Factory.addComponentsGetterSetter(E,"fillRadialGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(E,"fillRadialGradientStartPointX",0),s.Factory.addGetterSetter(E,"fillRadialGradientStartPointY",0),s.Factory.addComponentsGetterSetter(E,"fillRadialGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(E,"fillRadialGradientEndPointX",0),s.Factory.addGetterSetter(E,"fillRadialGradientEndPointY",0),s.Factory.addGetterSetter(E,"fillPatternRotation",0),s.Factory.addGetterSetter(E,"fillRule",void 0,(0,r.getStringValidator)()),s.Factory.backCompat(E,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(Iv)),Iv}var qT;function dO(){if(qT)return vh;qT=1,Object.defineProperty(vh,"__esModule",{value:!0}),vh.Layer=void 0;const e=En(),t=Gy(),n=Nn(),s=It(),o=zy(),r=Tt(),a=hs(),l=jt(),d="#",u="beforeDraw",h="draw",p=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],f=p.length;let m=class extends t.Container{constructor(x){super(x),this.canvas=new o.SceneCanvas,this.hitCanvas=new o.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(x){return this.getContext().clear(x),this.getHitCanvas().getContext().clear(x),this}setZIndex(x){super.setZIndex(x);const b=this.getStage();return b&&b.content&&(b.content.removeChild(this.getNativeCanvasElement()),x<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[x+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){n.Node.prototype.moveToTop.call(this);const x=this.getStage();return x&&x.content&&(x.content.removeChild(this.getNativeCanvasElement()),x.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!n.Node.prototype.moveUp.call(this))return!1;const b=this.getStage();return!b||!b.content?!1:(b.content.removeChild(this.getNativeCanvasElement()),this.index<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[this.index+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(n.Node.prototype.moveDown.call(this)){const x=this.getStage();if(x){const b=x.children;x.content&&(x.content.removeChild(this.getNativeCanvasElement()),x.content.insertBefore(this.getNativeCanvasElement(),b[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(n.Node.prototype.moveToBottom.call(this)){const x=this.getStage();if(x){const b=x.children;x.content&&(x.content.removeChild(this.getNativeCanvasElement()),x.content.insertBefore(this.getNativeCanvasElement(),b[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const x=this.getNativeCanvasElement();return n.Node.prototype.remove.call(this),x&&x.parentNode&&e.Util._isInDocument(x)&&x.parentNode.removeChild(x),this}getStage(){return this.parent}setSize({width:x,height:b}){return this.canvas.setSize(x,b),this.hitCanvas.setSize(x,b),this._setSmoothEnabled(),this}_validateAdd(x){const b=x.getType();b!=="Group"&&b!=="Shape"&&e.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(x){return x=x||{},x.width=x.width||this.getWidth(),x.height=x.height||this.getHeight(),x.x=x.x!==void 0?x.x:this.x(),x.y=x.y!==void 0?x.y:this.y(),n.Node.prototype._toKonvaCanvas.call(this,x)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){e.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){e.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,e.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(x){if(!this.isListening()||!this.isVisible())return null;let b=1,C=!1;for(;;){for(let y=0;y<f;y++){const v=p[y],w=this._getIntersection({x:x.x+v.x*b,y:x.y+v.y*b}),k=w.shape;if(k)return k;if(C=!!w.antialiased,!w.antialiased)break}if(C)b+=1;else return null}}_getIntersection(x){const b=this.hitCanvas.pixelRatio,C=this.hitCanvas.context.getImageData(Math.round(x.x*b),Math.round(x.y*b),1,1).data,y=C[3];if(y===255){const v=e.Util._rgbToHex(C[0],C[1],C[2]),w=a.shapes[d+v];return w?{shape:w}:{antialiased:!0}}else if(y>0)return{antialiased:!0};return{}}drawScene(x,b){const C=this.getLayer(),y=x||C&&C.getCanvas();return this._fire(u,{node:this}),this.clearBeforeDraw()&&y.getContext().clear(),t.Container.prototype.drawScene.call(this,y,b),this._fire(h,{node:this}),this}drawHit(x,b){const C=this.getLayer(),y=x||C&&C.hitCanvas;return C&&C.clearBeforeDraw()&&C.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,y,b),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(x){e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(x)}getHitGraphEnabled(x){return e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const x=this.parent;!!this.hitCanvas._canvas.parentNode?x.content.removeChild(this.hitCanvas._canvas):x.content.appendChild(this.hitCanvas._canvas)}destroy(){return e.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return vh.Layer=m,m.prototype.nodeType="Layer",(0,l._registerNode)(m),s.Factory.addGetterSetter(m,"imageSmoothingEnabled",!0),s.Factory.addGetterSetter(m,"clearBeforeDraw",!0),s.Factory.addGetterSetter(m,"hitGraphEnabled",!0,(0,r.getBooleanValidator)()),vh}var Ch={},KT;function Kge(){if(KT)return Ch;KT=1,Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.FastLayer=void 0;const e=En(),t=dO(),n=jt();let s=class extends t.Layer{constructor(r){super(r),this.listening(!1),e.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return Ch.FastLayer=s,s.prototype.nodeType="FastLayer",(0,n._registerNode)(s),Ch}var wh={},ZT;function Dj(){if(ZT)return wh;ZT=1,Object.defineProperty(wh,"__esModule",{value:!0}),wh.Group=void 0;const e=En(),t=Gy(),n=jt();let s=class extends t.Container{_validateAdd(r){const a=r.getType();a!=="Group"&&a!=="Shape"&&e.Util.throw("You may only add groups and shapes to groups.")}};return wh.Group=s,s.prototype.nodeType="Group",(0,n._registerNode)(s),wh}var Sh={},YT;function Rj(){if(YT)return Sh;YT=1,Object.defineProperty(Sh,"__esModule",{value:!0}),Sh.Animation=void 0;const e=jt(),t=En(),n=function(){return e.glob.performance&&e.glob.performance.now?function(){return e.glob.performance.now()}:function(){return new Date().getTime()}}();let s=class ld{constructor(r,a){this.id=ld.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:n(),frameRate:0},this.func=r,this.setLayers(a)}setLayers(r){let a=[];return r&&(a=Array.isArray(r)?r:[r]),this.layers=a,this}getLayers(){return this.layers}addLayer(r){const a=this.layers,l=a.length;for(let d=0;d<l;d++)if(a[d]._id===r._id)return!1;return this.layers.push(r),!0}isRunning(){const a=ld.animations,l=a.length;for(let d=0;d<l;d++)if(a[d].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=n(),ld._addAnimation(this),this}stop(){return ld._removeAnimation(this),this}_updateFrameObject(r){this.frame.timeDiff=r-this.frame.lastTime,this.frame.lastTime=r,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(r){this.animations.push(r),this._handleAnimation()}static _removeAnimation(r){const a=r.id,l=this.animations,d=l.length;for(let u=0;u<d;u++)if(l[u].id===a){this.animations.splice(u,1);break}}static _runFrames(){const r={},a=this.animations;for(let l=0;l<a.length;l++){const d=a[l],u=d.layers,h=d.func;d._updateFrameObject(n());const p=u.length;let f;if(h?f=h.call(d,d.frame)!==!1:f=!0,!!f)for(let m=0;m<p;m++){const g=u[m];g._id!==void 0&&(r[g._id]=g)}}for(const l in r)r.hasOwnProperty(l)&&r[l].batchDraw()}static _animationLoop(){const r=ld;r.animations.length?(r._runFrames(),t.Util.requestAnimFrame(r._animationLoop)):r.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,t.Util.requestAnimFrame(this._animationLoop))}};return Sh.Animation=s,s.animations=[],s.animIdCounter=0,s.animRunning=!1,Sh}var Tv={},XT;function Zge(){return XT||(XT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Easings=e.Tween=void 0;const t=En(),n=Rj(),s=Nn(),o=jt(),r={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=1,l=2,d=3,u=["fill","stroke","shadowColor"];let h=0;class p{constructor(g,x,b,C,y,v,w){this.prop=g,this.propFunc=x,this.begin=C,this._pos=C,this.duration=v,this._change=0,this.prevPos=0,this.yoyo=w,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=b,this._change=y-this.begin,this.pause()}fire(g){const x=this[g];x&&x()}setTime(g){g>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():g<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=g,this.update())}getTime(){return this._time}setPosition(g){this.prevPos=this._pos,this.propFunc(g),this._pos=g}getPosition(g){return g===void 0&&(g=this._time),this.func(g,this.begin,this._change,this.duration)}play(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=d,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(g){this.pause(),this._time=g,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const g=this.getTimer()-this._startTime;this.state===l?this.setTime(g):this.state===d&&this.setTime(this.duration-g)}pause(){this.state=a,this.fire("onPause")}getTimer(){return new Date().getTime()}}class f{constructor(g){const x=this,b=g.node,C=b._id,y=g.easing||e.Easings.Linear,v=!!g.yoyo;let w,k;typeof g.duration>"u"?w=.3:g.duration===0?w=.001:w=g.duration,this.node=b,this._id=h++;const S=b.getLayer()||(b instanceof o.Konva.Stage?b.getLayers():null);S||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){x.tween.onEnterFrame()},S),this.tween=new p(k,function(P){x._tweenFunc(P)},y,0,1,w*1e3,v),this._addListeners(),f.attrs[C]||(f.attrs[C]={}),f.attrs[C][this._id]||(f.attrs[C][this._id]={}),f.tweens[C]||(f.tweens[C]={});for(k in g)r[k]===void 0&&this._addAttr(k,g[k]);this.reset(),this.onFinish=g.onFinish,this.onReset=g.onReset,this.onUpdate=g.onUpdate}_addAttr(g,x){const b=this.node,C=b._id;let y,v,w,k,S;const P=f.tweens[C][g];P&&delete f.attrs[C][P][g];let E=b.getAttr(g);if(t.Util._isArray(x))if(y=[],v=Math.max(x.length,E.length),g==="points"&&x.length!==E.length&&(x.length>E.length?(k=E,E=t.Util._prepareArrayForTween(E,x,b.closed())):(w=x,x=t.Util._prepareArrayForTween(x,E,b.closed()))),g.indexOf("fill")===0)for(let L=0;L<v;L++)if(L%2===0)y.push(x[L]-E[L]);else{const I=t.Util.colorToRGBA(E[L]);S=t.Util.colorToRGBA(x[L]),E[L]=I,y.push({r:S.r-I.r,g:S.g-I.g,b:S.b-I.b,a:S.a-I.a})}else for(let L=0;L<v;L++)y.push(x[L]-E[L]);else u.indexOf(g)!==-1?(E=t.Util.colorToRGBA(E),S=t.Util.colorToRGBA(x),y={r:S.r-E.r,g:S.g-E.g,b:S.b-E.b,a:S.a-E.a}):y=x-E;f.attrs[C][this._id][g]={start:E,diff:y,end:x,trueEnd:w,trueStart:k},f.tweens[C][g]=this._id}_tweenFunc(g){const x=this.node,b=f.attrs[x._id][this._id];let C,y,v,w,k,S,P,E;for(C in b){if(y=b[C],v=y.start,w=y.diff,E=y.end,t.Util._isArray(v))if(k=[],P=Math.max(v.length,E.length),C.indexOf("fill")===0)for(S=0;S<P;S++)S%2===0?k.push((v[S]||0)+w[S]*g):k.push("rgba("+Math.round(v[S].r+w[S].r*g)+","+Math.round(v[S].g+w[S].g*g)+","+Math.round(v[S].b+w[S].b*g)+","+(v[S].a+w[S].a*g)+")");else for(S=0;S<P;S++)k.push((v[S]||0)+w[S]*g);else u.indexOf(C)!==-1?k="rgba("+Math.round(v.r+w.r*g)+","+Math.round(v.g+w.g*g)+","+Math.round(v.b+w.b*g)+","+(v.a+w.a*g)+")":k=v+w*g;x.setAttr(C,k)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const g=this.node,x=f.attrs[g._id][this._id];x.points&&x.points.trueEnd&&g.setAttr("points",x.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const g=this.node,x=f.attrs[g._id][this._id];x.points&&x.points.trueStart&&g.points(x.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(g){return this.tween.seek(g*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const g=this.node._id,x=this._id,b=f.tweens[g];this.pause();for(const C in b)delete f.tweens[g][C];delete f.attrs[g][x]}}e.Tween=f,f.attrs={},f.tweens={},s.Node.prototype.to=function(m){const g=m.onFinish;m.node=this,m.onFinish=function(){this.destroy(),g&&g()},new f(m).play()},e.Easings={BackEaseIn(m,g,x,b){return x*(m/=b)*m*((1.70158+1)*m-1.70158)+g},BackEaseOut(m,g,x,b){return x*((m=m/b-1)*m*((1.70158+1)*m+1.70158)+1)+g},BackEaseInOut(m,g,x,b){let C=1.70158;return(m/=b/2)<1?x/2*(m*m*(((C*=1.525)+1)*m-C))+g:x/2*((m-=2)*m*(((C*=1.525)+1)*m+C)+2)+g},ElasticEaseIn(m,g,x,b,C,y){let v=0;return m===0?g:(m/=b)===1?g+x:(y||(y=b*.3),!C||C<Math.abs(x)?(C=x,v=y/4):v=y/(2*Math.PI)*Math.asin(x/C),-(C*Math.pow(2,10*(m-=1))*Math.sin((m*b-v)*(2*Math.PI)/y))+g)},ElasticEaseOut(m,g,x,b,C,y){let v=0;return m===0?g:(m/=b)===1?g+x:(y||(y=b*.3),!C||C<Math.abs(x)?(C=x,v=y/4):v=y/(2*Math.PI)*Math.asin(x/C),C*Math.pow(2,-10*m)*Math.sin((m*b-v)*(2*Math.PI)/y)+x+g)},ElasticEaseInOut(m,g,x,b,C,y){let v=0;return m===0?g:(m/=b/2)===2?g+x:(y||(y=b*(.3*1.5)),!C||C<Math.abs(x)?(C=x,v=y/4):v=y/(2*Math.PI)*Math.asin(x/C),m<1?-.5*(C*Math.pow(2,10*(m-=1))*Math.sin((m*b-v)*(2*Math.PI)/y))+g:C*Math.pow(2,-10*(m-=1))*Math.sin((m*b-v)*(2*Math.PI)/y)*.5+x+g)},BounceEaseOut(m,g,x,b){return(m/=b)<1/2.75?x*(7.5625*m*m)+g:m<2/2.75?x*(7.5625*(m-=1.5/2.75)*m+.75)+g:m<2.5/2.75?x*(7.5625*(m-=2.25/2.75)*m+.9375)+g:x*(7.5625*(m-=2.625/2.75)*m+.984375)+g},BounceEaseIn(m,g,x,b){return x-e.Easings.BounceEaseOut(b-m,0,x,b)+g},BounceEaseInOut(m,g,x,b){return m<b/2?e.Easings.BounceEaseIn(m*2,0,x,b)*.5+g:e.Easings.BounceEaseOut(m*2-b,0,x,b)*.5+x*.5+g},EaseIn(m,g,x,b){return x*(m/=b)*m+g},EaseOut(m,g,x,b){return-x*(m/=b)*(m-2)+g},EaseInOut(m,g,x,b){return(m/=b/2)<1?x/2*m*m+g:-x/2*(--m*(m-2)-1)+g},StrongEaseIn(m,g,x,b){return x*(m/=b)*m*m*m*m+g},StrongEaseOut(m,g,x,b){return x*((m=m/b-1)*m*m*m*m+1)+g},StrongEaseInOut(m,g,x,b){return(m/=b/2)<1?x/2*m*m*m*m*m+g:x/2*((m-=2)*m*m*m*m+2)+g},Linear(m,g,x,b){return x*m/b+g}}}(Tv)),Tv}var QT;function Yge(){return QT||(QT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;const t=jt(),n=En(),s=Nn(),o=Gy(),r=qge(),a=dO(),l=Kge(),d=Dj(),u=Lj(),h=hs(),p=Rj(),f=Zge(),m=lO(),g=zy();e.Konva=n.Util._assign(t.Konva,{Util:n.Util,Transform:n.Transform,Node:s.Node,Container:o.Container,Stage:r.Stage,stages:r.stages,Layer:a.Layer,FastLayer:l.FastLayer,Group:d.Group,DD:u.DD,Shape:h.Shape,shapes:h.shapes,Animation:p.Animation,Tween:f.Tween,Easings:f.Easings,Context:m.Context,Canvas:g.Canvas}),e.default=e.Konva}(Cv)),Cv}var kh={},JT;function Xge(){if(JT)return kh;JT=1,Object.defineProperty(kh,"__esModule",{value:!0}),kh.Arc=void 0;const e=It(),t=hs(),n=jt(),s=Tt(),o=jt();let r=class extends t.Shape{_sceneFunc(l){const d=n.Konva.getAngle(this.angle()),u=this.clockwise();l.beginPath(),l.arc(0,0,this.outerRadius(),0,d,u),l.arc(0,0,this.innerRadius(),d,0,!u),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}getSelfRect(){const l=this.innerRadius(),d=this.outerRadius(),u=this.clockwise(),h=n.Konva.getAngle(u?360-this.angle():this.angle()),p=Math.cos(Math.min(h,Math.PI)),f=1,m=Math.sin(Math.min(Math.max(Math.PI,h),3*Math.PI/2)),g=Math.sin(Math.min(h,Math.PI/2)),x=p*(p>0?l:d),b=f*d,C=m*(m>0?l:d),y=g*(g>0?d:l);return{x,y:u?-1*y:C,width:b-x,height:y-C}}};return kh.Arc=r,r.prototype._centroid=!0,r.prototype.className="Arc",r.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],(0,o._registerNode)(r),e.Factory.addGetterSetter(r,"innerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(r,"outerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(r,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(r,"clockwise",!1,(0,s.getBooleanValidator)()),kh}var jh={},_h={},eA;function uO(){if(eA)return _h;eA=1,Object.defineProperty(_h,"__esModule",{value:!0}),_h.Line=void 0;const e=It(),t=jt(),n=hs(),s=Tt();function o(l,d,u,h,p,f,m){const g=Math.sqrt(Math.pow(u-l,2)+Math.pow(h-d,2)),x=Math.sqrt(Math.pow(p-u,2)+Math.pow(f-h,2)),b=m*g/(g+x),C=m*x/(g+x),y=u-b*(p-l),v=h-b*(f-d),w=u+C*(p-l),k=h+C*(f-d);return[y,v,w,k]}function r(l,d){const u=l.length,h=[];for(let p=2;p<u-2;p+=2){const f=o(l[p-2],l[p-1],l[p],l[p+1],l[p+2],l[p+3],d);isNaN(f[0])||(h.push(f[0]),h.push(f[1]),h.push(l[p]),h.push(l[p+1]),h.push(f[2]),h.push(f[3]))}return h}let a=class extends n.Shape{constructor(d){super(d),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(d){let u=this.points(),h=u.length,p=this.tension(),f=this.closed(),m=this.bezier(),g,x,b;if(h){if(d.beginPath(),d.moveTo(u[0],u[1]),p!==0&&h>4){for(g=this.getTensionPoints(),x=g.length,b=f?0:4,f||d.quadraticCurveTo(g[0],g[1],g[2],g[3]);b<x-2;)d.bezierCurveTo(g[b++],g[b++],g[b++],g[b++],g[b++],g[b++]);f||d.quadraticCurveTo(g[x-2],g[x-1],u[h-2],u[h-1])}else if(m)for(b=2;b<h;)d.bezierCurveTo(u[b++],u[b++],u[b++],u[b++],u[b++],u[b++]);else for(b=2;b<h;b+=2)d.lineTo(u[b],u[b+1]);f?(d.closePath(),d.fillStrokeShape(this)):d.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():r(this.points(),this.tension())}_getTensionPointsClosed(){const d=this.points(),u=d.length,h=this.tension(),p=o(d[u-2],d[u-1],d[0],d[1],d[2],d[3],h),f=o(d[u-4],d[u-3],d[u-2],d[u-1],d[0],d[1],h),m=r(d,h);return[p[2],p[3]].concat(m).concat([f[0],f[1],d[u-2],d[u-1],f[2],f[3],p[0],p[1],d[0],d[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let d=this.points();if(d.length<4)return{x:d[0]||0,y:d[1]||0,width:0,height:0};this.tension()!==0?d=[d[0],d[1],...this._getTensionPoints(),d[d.length-2],d[d.length-1]]:d=this.points();let u=d[0],h=d[0],p=d[1],f=d[1],m,g;for(let x=0;x<d.length/2;x++)m=d[x*2],g=d[x*2+1],u=Math.min(u,m),h=Math.max(h,m),p=Math.min(p,g),f=Math.max(f,g);return{x:u,y:p,width:h-u,height:f-p}}};return _h.Line=a,a.prototype.className="Line",a.prototype._attrsAffectingSize=["points","bezier","tension"],(0,t._registerNode)(a),e.Factory.addGetterSetter(a,"closed",!1),e.Factory.addGetterSetter(a,"bezier",!1),e.Factory.addGetterSetter(a,"tension",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(a,"points",[],(0,s.getNumberArrayValidator)()),_h}var Ih={},Av={},tA;function Qge(){return tA||(tA=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.t2length=e.getQuadraticArcLength=e.getCubicArcLength=e.binomialCoefficients=e.cValues=e.tValues=void 0,e.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],e.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],e.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(a,l,d)=>{let u,h;const f=d/2;u=0;for(let m=0;m<20;m++)h=f*e.tValues[20][m]+f,u+=e.cValues[20][m]*s(a,l,h);return f*u};e.getCubicArcLength=t;const n=(a,l,d)=>{d===void 0&&(d=1);const u=a[0]-2*a[1]+a[2],h=l[0]-2*l[1]+l[2],p=2*a[1]-2*a[0],f=2*l[1]-2*l[0],m=4*(u*u+h*h),g=4*(u*p+h*f),x=p*p+f*f;if(m===0)return d*Math.sqrt(Math.pow(a[2]-a[0],2)+Math.pow(l[2]-l[0],2));const b=g/(2*m),C=x/m,y=d+b,v=C-b*b,w=y*y+v>0?Math.sqrt(y*y+v):0,k=b*b+v>0?Math.sqrt(b*b+v):0,S=b+Math.sqrt(b*b+v)!==0?v*Math.log(Math.abs((y+w)/(b+k))):0;return Math.sqrt(m)/2*(y*w-b*k+S)};e.getQuadraticArcLength=n;function s(a,l,d){const u=o(1,d,a),h=o(1,d,l),p=u*u+h*h;return Math.sqrt(p)}const o=(a,l,d)=>{const u=d.length-1;let h,p;if(u===0)return 0;if(a===0){p=0;for(let f=0;f<=u;f++)p+=e.binomialCoefficients[u][f]*Math.pow(1-l,u-f)*Math.pow(l,f)*d[f];return p}else{h=new Array(u);for(let f=0;f<u;f++)h[f]=u*(d[f+1]-d[f]);return o(a-1,l,h)}},r=(a,l,d)=>{let u=1,h=a/l,p=(a-d(h))/l,f=0;for(;u>.001;){const m=d(h+p),g=Math.abs(a-m)/l;if(g<u)u=g,h+=p;else{const x=d(h-p),b=Math.abs(a-x)/l;b<u?(u=b,h-=p):p/=2}if(f++,f>500)break}return h};e.t2length=r}(Av)),Av}var nA;function Oj(){if(nA)return Ih;nA=1,Object.defineProperty(Ih,"__esModule",{value:!0}),Ih.Path=void 0;const e=It(),t=hs(),n=jt(),s=Qge();let o=class Qs extends t.Shape{constructor(a){super(a),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Qs.parsePathData(this.data()),this.pathLength=Qs.getPathLength(this.dataArray)}_sceneFunc(a){const l=this.dataArray;a.beginPath();let d=!1;for(let w=0;w<l.length;w++){const k=l[w].command,S=l[w].points;switch(k){case"L":a.lineTo(S[0],S[1]);break;case"M":a.moveTo(S[0],S[1]);break;case"C":a.bezierCurveTo(S[0],S[1],S[2],S[3],S[4],S[5]);break;case"Q":a.quadraticCurveTo(S[0],S[1],S[2],S[3]);break;case"A":var u=S[0],h=S[1],p=S[2],f=S[3],m=S[4],g=S[5],x=S[6],b=S[7],C=p>f?p:f,y=p>f?1:p/f,v=p>f?f/p:1;a.translate(u,h),a.rotate(x),a.scale(y,v),a.arc(0,0,C,m,m+g,1-b),a.scale(1/y,1/v),a.rotate(-x),a.translate(-u,-h);break;case"z":d=!0,a.closePath();break}}!d&&!this.hasFill()?a.strokeShape(this):a.fillStrokeShape(this)}getSelfRect(){let a=[];this.dataArray.forEach(function(m){if(m.command==="A"){const g=m.points[4],x=m.points[5],b=m.points[4]+x;let C=Math.PI/180;if(Math.abs(g-b)<C&&(C=Math.abs(g-b)),x<0)for(let y=g-C;y>b;y-=C){const v=Qs.getPointOnEllipticalArc(m.points[0],m.points[1],m.points[2],m.points[3],y,0);a.push(v.x,v.y)}else for(let y=g+C;y<b;y+=C){const v=Qs.getPointOnEllipticalArc(m.points[0],m.points[1],m.points[2],m.points[3],y,0);a.push(v.x,v.y)}}else if(m.command==="C")for(let g=0;g<=1;g+=.01){const x=Qs.getPointOnCubicBezier(g,m.start.x,m.start.y,m.points[0],m.points[1],m.points[2],m.points[3],m.points[4],m.points[5]);a.push(x.x,x.y)}else a=a.concat(m.points)});let l=a[0],d=a[0],u=a[1],h=a[1],p,f;for(let m=0;m<a.length/2;m++)p=a[m*2],f=a[m*2+1],isNaN(p)||(l=Math.min(l,p),d=Math.max(d,p)),isNaN(f)||(u=Math.min(u,f),h=Math.max(h,f));return{x:l,y:u,width:d-l,height:h-u}}getLength(){return this.pathLength}getPointAtLength(a){return Qs.getPointAtLengthOfDataArray(a,this.dataArray)}static getLineLength(a,l,d,u){return Math.sqrt((d-a)*(d-a)+(u-l)*(u-l))}static getPathLength(a){let l=0;for(let d=0;d<a.length;++d)l+=a[d].pathLength;return l}static getPointAtLengthOfDataArray(a,l){let d,u=0,h=l.length;if(!h)return null;for(;u<h&&a>l[u].pathLength;)a-=l[u].pathLength,++u;if(u===h)return d=l[u-1].points.slice(-2),{x:d[0],y:d[1]};if(a<.01)return d=l[u].points.slice(0,2),{x:d[0],y:d[1]};const p=l[u],f=p.points;switch(p.command){case"L":return Qs.getPointOnLine(a,p.start.x,p.start.y,f[0],f[1]);case"C":return Qs.getPointOnCubicBezier((0,s.t2length)(a,Qs.getPathLength(l),w=>(0,s.getCubicArcLength)([p.start.x,f[0],f[2],f[4]],[p.start.y,f[1],f[3],f[5]],w)),p.start.x,p.start.y,f[0],f[1],f[2],f[3],f[4],f[5]);case"Q":return Qs.getPointOnQuadraticBezier((0,s.t2length)(a,Qs.getPathLength(l),w=>(0,s.getQuadraticArcLength)([p.start.x,f[0],f[2]],[p.start.y,f[1],f[3]],w)),p.start.x,p.start.y,f[0],f[1],f[2],f[3]);case"A":var m=f[0],g=f[1],x=f[2],b=f[3],C=f[4],y=f[5],v=f[6];return C+=y*a/p.pathLength,Qs.getPointOnEllipticalArc(m,g,x,b,C,v)}return null}static getPointOnLine(a,l,d,u,h,p,f){p=p??l,f=f??d;const m=this.getLineLength(l,d,u,h);if(m<1e-10)return{x:l,y:d};if(u===l)return{x:p,y:f+(h>d?a:-a)};const g=(h-d)/(u-l),x=Math.sqrt(a*a/(1+g*g))*(u<l?-1:1),b=g*x;if(Math.abs(f-d-g*(p-l))<1e-10)return{x:p+x,y:f+b};const C=((p-l)*(u-l)+(f-d)*(h-d))/(m*m),y=l+C*(u-l),v=d+C*(h-d),w=this.getLineLength(p,f,y,v),k=Math.sqrt(a*a-w*w),S=Math.sqrt(k*k/(1+g*g))*(u<l?-1:1),P=g*S;return{x:y+S,y:v+P}}static getPointOnCubicBezier(a,l,d,u,h,p,f,m,g){function x(k){return k*k*k}function b(k){return 3*k*k*(1-k)}function C(k){return 3*k*(1-k)*(1-k)}function y(k){return(1-k)*(1-k)*(1-k)}const v=m*x(a)+p*b(a)+u*C(a)+l*y(a),w=g*x(a)+f*b(a)+h*C(a)+d*y(a);return{x:v,y:w}}static getPointOnQuadraticBezier(a,l,d,u,h,p,f){function m(y){return y*y}function g(y){return 2*y*(1-y)}function x(y){return(1-y)*(1-y)}const b=p*m(a)+u*g(a)+l*x(a),C=f*m(a)+h*g(a)+d*x(a);return{x:b,y:C}}static getPointOnEllipticalArc(a,l,d,u,h,p){const f=Math.cos(p),m=Math.sin(p),g={x:d*Math.cos(h),y:u*Math.sin(h)};return{x:a+(g.x*f-g.y*m),y:l+(g.x*m+g.y*f)}}static parsePathData(a){if(!a)return[];let l=a;const d=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];l=l.replace(new RegExp(" ","g"),",");for(var u=0;u<d.length;u++)l=l.replace(new RegExp(d[u],"g"),"|"+d[u]);const h=l.split("|"),p=[],f=[];let m=0,g=0;const x=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let b;for(u=1;u<h.length;u++){let _=h[u],R=_.charAt(0);for(_=_.slice(1),f.length=0;b=x.exec(_);)f.push(b[0]);const D=[];for(let B=0,V=f.length;B<V;B++){if(f[B]==="00"){D.push(0,0);continue}const ee=parseFloat(f[B]);isNaN(ee)?D.push(0):D.push(ee)}for(;D.length>0&&!isNaN(D[0]);){let B="",V=[];const ee=m,se=g;var C,y,v,w,k,S,P,E,L,I;switch(R){case"l":m+=D.shift(),g+=D.shift(),B="L",V.push(m,g);break;case"L":m=D.shift(),g=D.shift(),V.push(m,g);break;case"m":var O=D.shift(),N=D.shift();if(m+=O,g+=N,B="M",p.length>2&&p[p.length-1].command==="z"){for(let oe=p.length-2;oe>=0;oe--)if(p[oe].command==="M"){m=p[oe].points[0]+O,g=p[oe].points[1]+N;break}}V.push(m,g),R="l";break;case"M":m=D.shift(),g=D.shift(),B="M",V.push(m,g),R="L";break;case"h":m+=D.shift(),B="L",V.push(m,g);break;case"H":m=D.shift(),B="L",V.push(m,g);break;case"v":g+=D.shift(),B="L",V.push(m,g);break;case"V":g=D.shift(),B="L",V.push(m,g);break;case"C":V.push(D.shift(),D.shift(),D.shift(),D.shift()),m=D.shift(),g=D.shift(),V.push(m,g);break;case"c":V.push(m+D.shift(),g+D.shift(),m+D.shift(),g+D.shift()),m+=D.shift(),g+=D.shift(),B="C",V.push(m,g);break;case"S":y=m,v=g,C=p[p.length-1],C.command==="C"&&(y=m+(m-C.points[2]),v=g+(g-C.points[3])),V.push(y,v,D.shift(),D.shift()),m=D.shift(),g=D.shift(),B="C",V.push(m,g);break;case"s":y=m,v=g,C=p[p.length-1],C.command==="C"&&(y=m+(m-C.points[2]),v=g+(g-C.points[3])),V.push(y,v,m+D.shift(),g+D.shift()),m+=D.shift(),g+=D.shift(),B="C",V.push(m,g);break;case"Q":V.push(D.shift(),D.shift()),m=D.shift(),g=D.shift(),V.push(m,g);break;case"q":V.push(m+D.shift(),g+D.shift()),m+=D.shift(),g+=D.shift(),B="Q",V.push(m,g);break;case"T":y=m,v=g,C=p[p.length-1],C.command==="Q"&&(y=m+(m-C.points[0]),v=g+(g-C.points[1])),m=D.shift(),g=D.shift(),B="Q",V.push(y,v,m,g);break;case"t":y=m,v=g,C=p[p.length-1],C.command==="Q"&&(y=m+(m-C.points[0]),v=g+(g-C.points[1])),m+=D.shift(),g+=D.shift(),B="Q",V.push(y,v,m,g);break;case"A":w=D.shift(),k=D.shift(),S=D.shift(),P=D.shift(),E=D.shift(),L=m,I=g,m=D.shift(),g=D.shift(),B="A",V=this.convertEndpointToCenterParameterization(L,I,m,g,P,E,w,k,S);break;case"a":w=D.shift(),k=D.shift(),S=D.shift(),P=D.shift(),E=D.shift(),L=m,I=g,m+=D.shift(),g+=D.shift(),B="A",V=this.convertEndpointToCenterParameterization(L,I,m,g,P,E,w,k,S);break}p.push({command:B||R,points:V,start:{x:ee,y:se},pathLength:this.calcLength(ee,se,B||R,V)})}(R==="z"||R==="Z")&&p.push({command:"z",points:[],start:void 0,pathLength:0})}return p}static calcLength(a,l,d,u){let h,p,f,m;const g=Qs;switch(d){case"L":return g.getLineLength(a,l,u[0],u[1]);case"C":return(0,s.getCubicArcLength)([a,u[0],u[2],u[4]],[l,u[1],u[3],u[5]],1);case"Q":return(0,s.getQuadraticArcLength)([a,u[0],u[2]],[l,u[1],u[3]],1);case"A":h=0;var x=u[4],b=u[5],C=u[4]+b,y=Math.PI/180;if(Math.abs(x-C)<y&&(y=Math.abs(x-C)),p=g.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],x,0),b<0)for(m=x-y;m>C;m-=y)f=g.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],m,0),h+=g.getLineLength(p.x,p.y,f.x,f.y),p=f;else for(m=x+y;m<C;m+=y)f=g.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],m,0),h+=g.getLineLength(p.x,p.y,f.x,f.y),p=f;return f=g.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],C,0),h+=g.getLineLength(p.x,p.y,f.x,f.y),h}return 0}static convertEndpointToCenterParameterization(a,l,d,u,h,p,f,m,g){const x=g*(Math.PI/180),b=Math.cos(x)*(a-d)/2+Math.sin(x)*(l-u)/2,C=-1*Math.sin(x)*(a-d)/2+Math.cos(x)*(l-u)/2,y=b*b/(f*f)+C*C/(m*m);y>1&&(f*=Math.sqrt(y),m*=Math.sqrt(y));let v=Math.sqrt((f*f*(m*m)-f*f*(C*C)-m*m*(b*b))/(f*f*(C*C)+m*m*(b*b)));h===p&&(v*=-1),isNaN(v)&&(v=0);const w=v*f*C/m,k=v*-m*b/f,S=(a+d)/2+Math.cos(x)*w-Math.sin(x)*k,P=(l+u)/2+Math.sin(x)*w+Math.cos(x)*k,E=function(D){return Math.sqrt(D[0]*D[0]+D[1]*D[1])},L=function(D,B){return(D[0]*B[0]+D[1]*B[1])/(E(D)*E(B))},I=function(D,B){return(D[0]*B[1]<D[1]*B[0]?-1:1)*Math.acos(L(D,B))},O=I([1,0],[(b-w)/f,(C-k)/m]),N=[(b-w)/f,(C-k)/m],_=[(-1*b-w)/f,(-1*C-k)/m];let R=I(N,_);return L(N,_)<=-1&&(R=Math.PI),L(N,_)>=1&&(R=0),p===0&&R>0&&(R=R-2*Math.PI),p===1&&R<0&&(R=R+2*Math.PI),[S,P,f,m,O,R,x,p]}};return Ih.Path=o,o.prototype.className="Path",o.prototype._attrsAffectingSize=["data"],(0,n._registerNode)(o),e.Factory.addGetterSetter(o,"data"),Ih}var sA;function Jge(){if(sA)return jh;sA=1,Object.defineProperty(jh,"__esModule",{value:!0}),jh.Arrow=void 0;const e=It(),t=uO(),n=Tt(),s=jt(),o=Oj();let r=class extends t.Line{_sceneFunc(l){super._sceneFunc(l);const d=Math.PI*2,u=this.points();let h=u;const p=this.tension()!==0&&u.length>4;p&&(h=this.getTensionPoints());const f=this.pointerLength(),m=u.length;let g,x;if(p){const y=[h[h.length-4],h[h.length-3],h[h.length-2],h[h.length-1],u[m-2],u[m-1]],v=o.Path.calcLength(h[h.length-4],h[h.length-3],"C",y),w=o.Path.getPointOnQuadraticBezier(Math.min(1,1-f/v),y[0],y[1],y[2],y[3],y[4],y[5]);g=u[m-2]-w.x,x=u[m-1]-w.y}else g=u[m-2]-u[m-4],x=u[m-1]-u[m-3];const b=(Math.atan2(x,g)+d)%d,C=this.pointerWidth();this.pointerAtEnding()&&(l.save(),l.beginPath(),l.translate(u[m-2],u[m-1]),l.rotate(b),l.moveTo(0,0),l.lineTo(-f,C/2),l.lineTo(-f,-C/2),l.closePath(),l.restore(),this.__fillStroke(l)),this.pointerAtBeginning()&&(l.save(),l.beginPath(),l.translate(u[0],u[1]),p?(g=(h[0]+h[2])/2-u[0],x=(h[1]+h[3])/2-u[1]):(g=u[2]-u[0],x=u[3]-u[1]),l.rotate((Math.atan2(-x,-g)+d)%d),l.moveTo(0,0),l.lineTo(-f,C/2),l.lineTo(-f,-C/2),l.closePath(),l.restore(),this.__fillStroke(l))}__fillStroke(l){const d=this.dashEnabled();d&&(this.attrs.dashEnabled=!1,l.setLineDash([])),l.fillStrokeShape(this),d&&(this.attrs.dashEnabled=!0)}getSelfRect(){const l=super.getSelfRect(),d=this.pointerWidth()/2;return{x:l.x,y:l.y-d,width:l.width,height:l.height+d*2}}};return jh.Arrow=r,r.prototype.className="Arrow",(0,s._registerNode)(r),e.Factory.addGetterSetter(r,"pointerLength",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(r,"pointerWidth",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(r,"pointerAtBeginning",!1),e.Factory.addGetterSetter(r,"pointerAtEnding",!0),jh}var Th={},iA;function e0e(){if(iA)return Th;iA=1,Object.defineProperty(Th,"__esModule",{value:!0}),Th.Circle=void 0;const e=It(),t=hs(),n=Tt(),s=jt();let o=class extends t.Shape{_sceneFunc(a){a.beginPath(),a.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(a){this.radius()!==a/2&&this.radius(a/2)}setHeight(a){this.radius()!==a/2&&this.radius(a/2)}};return Th.Circle=o,o.prototype._centroid=!0,o.prototype.className="Circle",o.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"radius",0,(0,n.getNumberValidator)()),Th}var Ah={},oA;function t0e(){if(oA)return Ah;oA=1,Object.defineProperty(Ah,"__esModule",{value:!0}),Ah.Ellipse=void 0;const e=It(),t=hs(),n=Tt(),s=jt();let o=class extends t.Shape{_sceneFunc(a){const l=this.radiusX(),d=this.radiusY();a.beginPath(),a.save(),l!==d&&a.scale(1,d/l),a.arc(0,0,l,0,Math.PI*2,!1),a.restore(),a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(a){this.radiusX(a/2)}setHeight(a){this.radiusY(a/2)}};return Ah.Ellipse=o,o.prototype.className="Ellipse",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,s._registerNode)(o),e.Factory.addComponentsGetterSetter(o,"radius",["x","y"]),e.Factory.addGetterSetter(o,"radiusX",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"radiusY",0,(0,n.getNumberValidator)()),Ah}var Mh={},rA;function n0e(){if(rA)return Mh;rA=1,Object.defineProperty(Mh,"__esModule",{value:!0}),Mh.Image=void 0;const e=En(),t=It(),n=hs(),s=jt(),o=Tt();class r extends n.Shape{constructor(l){super(l),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",d=>{this._removeImageLoad(d.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const l=this.image();l&&l.complete||l&&l.readyState===4||l&&l.addEventListener&&l.addEventListener("load",this._loadListener)}_removeImageLoad(l){l&&l.removeEventListener&&l.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const l=!!this.cornerRadius(),d=this.hasShadow();return l&&d?!0:super._useBufferCanvas(!0)}_sceneFunc(l){const d=this.getWidth(),u=this.getHeight(),h=this.cornerRadius(),p=this.attrs.image;let f;if(p){const m=this.attrs.cropWidth,g=this.attrs.cropHeight;m&&g?f=[p,this.cropX(),this.cropY(),m,g,0,0,d,u]:f=[p,0,0,d,u]}(this.hasFill()||this.hasStroke()||h)&&(l.beginPath(),h?e.Util.drawRoundedRectPath(l,d,u,h):l.rect(0,0,d,u),l.closePath(),l.fillStrokeShape(this)),p&&(h&&l.clip(),l.drawImage.apply(l,f))}_hitFunc(l){const d=this.width(),u=this.height(),h=this.cornerRadius();l.beginPath(),h?e.Util.drawRoundedRectPath(l,d,u,h):l.rect(0,0,d,u),l.closePath(),l.fillStrokeShape(this)}getWidth(){var l,d;return(l=this.attrs.width)!==null&&l!==void 0?l:(d=this.image())===null||d===void 0?void 0:d.width}getHeight(){var l,d;return(l=this.attrs.height)!==null&&l!==void 0?l:(d=this.image())===null||d===void 0?void 0:d.height}static fromURL(l,d,u=null){const h=e.Util.createImageElement();h.onload=function(){const p=new r({image:h});d(p)},h.onerror=u,h.crossOrigin="Anonymous",h.src=l}}return Mh.Image=r,r.prototype.className="Image",(0,s._registerNode)(r),t.Factory.addGetterSetter(r,"cornerRadius",0,(0,o.getNumberOrArrayOfNumbersValidator)(4)),t.Factory.addGetterSetter(r,"image"),t.Factory.addComponentsGetterSetter(r,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(r,"cropX",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(r,"cropY",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(r,"cropWidth",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(r,"cropHeight",0,(0,o.getNumberValidator)()),Mh}var _l={},aA;function s0e(){if(aA)return _l;aA=1,Object.defineProperty(_l,"__esModule",{value:!0}),_l.Tag=_l.Label=void 0;const e=It(),t=hs(),n=Dj(),s=Tt(),o=jt(),r=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],a="Change.konva",l="none",d="up",u="right",h="down",p="left",f=r.length;class m extends n.Group{constructor(b){super(b),this.on("add.konva",function(C){this._addListeners(C.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(b){let C=this,y;const v=function(){C._sync()};for(y=0;y<f;y++)b.on(r[y]+a,v)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let b=this.getText(),C=this.getTag(),y,v,w,k,S,P,E;if(b&&C){switch(y=b.width(),v=b.height(),w=C.pointerDirection(),k=C.pointerWidth(),E=C.pointerHeight(),S=0,P=0,w){case d:S=y/2,P=-1*E;break;case u:S=y+k,P=v/2;break;case h:S=y/2,P=v+E;break;case p:S=-1*k,P=v/2;break}C.setAttrs({x:-1*S,y:-1*P,width:y,height:v}),b.setAttrs({x:-1*S,y:-1*P})}}}_l.Label=m,m.prototype.className="Label",(0,o._registerNode)(m);class g extends t.Shape{_sceneFunc(b){const C=this.width(),y=this.height(),v=this.pointerDirection(),w=this.pointerWidth(),k=this.pointerHeight(),S=this.cornerRadius();let P=0,E=0,L=0,I=0;typeof S=="number"?P=E=L=I=Math.min(S,C/2,y/2):(P=Math.min(S[0]||0,C/2,y/2),E=Math.min(S[1]||0,C/2,y/2),I=Math.min(S[2]||0,C/2,y/2),L=Math.min(S[3]||0,C/2,y/2)),b.beginPath(),b.moveTo(P,0),v===d&&(b.lineTo((C-w)/2,0),b.lineTo(C/2,-1*k),b.lineTo((C+w)/2,0)),b.lineTo(C-E,0),b.arc(C-E,E,E,Math.PI*3/2,0,!1),v===u&&(b.lineTo(C,(y-k)/2),b.lineTo(C+w,y/2),b.lineTo(C,(y+k)/2)),b.lineTo(C,y-I),b.arc(C-I,y-I,I,0,Math.PI/2,!1),v===h&&(b.lineTo((C+w)/2,y),b.lineTo(C/2,y+k),b.lineTo((C-w)/2,y)),b.lineTo(L,y),b.arc(L,y-L,L,Math.PI/2,Math.PI,!1),v===p&&(b.lineTo(0,(y+k)/2),b.lineTo(-1*w,y/2),b.lineTo(0,(y-k)/2)),b.lineTo(0,P),b.arc(P,P,P,Math.PI,Math.PI*3/2,!1),b.closePath(),b.fillStrokeShape(this)}getSelfRect(){let b=0,C=0,y=this.pointerWidth(),v=this.pointerHeight(),w=this.pointerDirection(),k=this.width(),S=this.height();return w===d?(C-=v,S+=v):w===h?S+=v:w===p?(b-=y*1.5,k+=y):w===u&&(k+=y*1.5),{x:b,y:C,width:k,height:S}}}return _l.Tag=g,g.prototype.className="Tag",(0,o._registerNode)(g),e.Factory.addGetterSetter(g,"pointerDirection",l),e.Factory.addGetterSetter(g,"pointerWidth",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(g,"pointerHeight",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(g,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),_l}var Eh={},lA;function hO(){if(lA)return Eh;lA=1,Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.Rect=void 0;const e=It(),t=hs(),n=jt(),s=En(),o=Tt();let r=class extends t.Shape{_sceneFunc(l){const d=this.cornerRadius(),u=this.width(),h=this.height();l.beginPath(),d?s.Util.drawRoundedRectPath(l,u,h,d):l.rect(0,0,u,h),l.closePath(),l.fillStrokeShape(this)}};return Eh.Rect=r,r.prototype.className="Rect",(0,n._registerNode)(r),e.Factory.addGetterSetter(r,"cornerRadius",0,(0,o.getNumberOrArrayOfNumbersValidator)(4)),Eh}var Ph={},cA;function i0e(){if(cA)return Ph;cA=1,Object.defineProperty(Ph,"__esModule",{value:!0}),Ph.RegularPolygon=void 0;const e=It(),t=hs(),n=Tt(),s=jt();let o=class extends t.Shape{_sceneFunc(a){const l=this._getPoints();a.beginPath(),a.moveTo(l[0].x,l[0].y);for(let d=1;d<l.length;d++)a.lineTo(l[d].x,l[d].y);a.closePath(),a.fillStrokeShape(this)}_getPoints(){const a=this.attrs.sides,l=this.attrs.radius||0,d=[];for(let u=0;u<a;u++)d.push({x:l*Math.sin(u*2*Math.PI/a),y:-1*l*Math.cos(u*2*Math.PI/a)});return d}getSelfRect(){const a=this._getPoints();let l=a[0].x,d=a[0].y,u=a[0].x,h=a[0].y;return a.forEach(p=>{l=Math.min(l,p.x),d=Math.max(d,p.x),u=Math.min(u,p.y),h=Math.max(h,p.y)}),{x:l,y:u,width:d-l,height:h-u}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(a){this.radius(a/2)}setHeight(a){this.radius(a/2)}};return Ph.RegularPolygon=o,o.prototype.className="RegularPolygon",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"radius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"sides",0,(0,n.getNumberValidator)()),Ph}var Lh={},dA;function o0e(){if(dA)return Lh;dA=1,Object.defineProperty(Lh,"__esModule",{value:!0}),Lh.Ring=void 0;const e=It(),t=hs(),n=Tt(),s=jt(),o=Math.PI*2;let r=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.innerRadius(),0,o,!1),l.moveTo(this.outerRadius(),0),l.arc(0,0,this.outerRadius(),o,0,!0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}};return Lh.Ring=r,r.prototype.className="Ring",r.prototype._centroid=!0,r.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(r),e.Factory.addGetterSetter(r,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(r,"outerRadius",0,(0,n.getNumberValidator)()),Lh}var Dh={},uA;function r0e(){if(uA)return Dh;uA=1,Object.defineProperty(Dh,"__esModule",{value:!0}),Dh.Sprite=void 0;const e=It(),t=hs(),n=Rj(),s=Tt(),o=jt();let r=class extends t.Shape{constructor(l){super(l),this._updated=!0,this.anim=new n.Animation(()=>{const d=this._updated;return this._updated=!1,d}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(l){const d=this.animation(),u=this.frameIndex(),h=u*4,p=this.animations()[d],f=this.frameOffsets(),m=p[h+0],g=p[h+1],x=p[h+2],b=p[h+3],C=this.image();if((this.hasFill()||this.hasStroke())&&(l.beginPath(),l.rect(0,0,x,b),l.closePath(),l.fillStrokeShape(this)),C)if(f){const y=f[d],v=u*2;l.drawImage(C,m,g,x,b,y[v+0],y[v+1],x,b)}else l.drawImage(C,m,g,x,b,0,0,x,b)}_hitFunc(l){const d=this.animation(),u=this.frameIndex(),h=u*4,p=this.animations()[d],f=this.frameOffsets(),m=p[h+2],g=p[h+3];if(l.beginPath(),f){const x=f[d],b=u*2;l.rect(x[b+0],x[b+1],m,g)}else l.rect(0,0,m,g);l.closePath(),l.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const l=this;this.interval=setInterval(function(){l._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const l=this.getLayer();this.anim.setLayers(l),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const l=this.frameIndex(),d=this.animation(),u=this.animations(),h=u[d],p=h.length/4;l<p-1?this.frameIndex(l+1):this.frameIndex(0)}};return Dh.Sprite=r,r.prototype.className="Sprite",(0,o._registerNode)(r),e.Factory.addGetterSetter(r,"animation"),e.Factory.addGetterSetter(r,"animations"),e.Factory.addGetterSetter(r,"frameOffsets"),e.Factory.addGetterSetter(r,"image"),e.Factory.addGetterSetter(r,"frameIndex",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(r,"frameRate",17,(0,s.getNumberValidator)()),e.Factory.backCompat(r,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Dh}var Rh={},hA;function a0e(){if(hA)return Rh;hA=1,Object.defineProperty(Rh,"__esModule",{value:!0}),Rh.Star=void 0;const e=It(),t=hs(),n=Tt(),s=jt();let o=class extends t.Shape{_sceneFunc(a){const l=this.innerRadius(),d=this.outerRadius(),u=this.numPoints();a.beginPath(),a.moveTo(0,0-d);for(let h=1;h<u*2;h++){const p=h%2===0?d:l,f=p*Math.sin(h*Math.PI/u),m=-1*p*Math.cos(h*Math.PI/u);a.lineTo(f,m)}a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(a){this.outerRadius(a/2)}setHeight(a){this.outerRadius(a/2)}};return Rh.Star=o,o.prototype.className="Star",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"numPoints",5,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,n.getNumberValidator)()),Rh}var Zc={},pA;function pO(){if(pA)return Zc;pA=1,Object.defineProperty(Zc,"__esModule",{value:!0}),Zc.Text=void 0,Zc.stringToArray=a;const e=En(),t=It(),n=hs(),s=jt(),o=Tt(),r=jt();function a(H){return[...H].reduce((z,Z,U,Y)=>{if(new RegExp("\\p{Emoji}","u").test(Z)){const $=Y[U+1];$&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test($)?(z.push(Z+$),Y[U+1]=""):z.push(Z)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(Z+(Y[U+1]||""))?z.push(Z+Y[U+1]):U>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(Z)?z[z.length-1]+=Z:Z&&z.push(Z);return z},[])}const l="auto",d="center",u="inherit",h="justify",p="Change.konva",f="2d",m="-",g="left",x="text",b="Text",C="top",y="bottom",v="middle",w="normal",k="px ",S=" ",P="right",E="rtl",L="word",I="char",O="none",N="",_=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],R=_.length;function D(H){return H.split(",").map(z=>{z=z.trim();const Z=z.indexOf(" ")>=0,U=z.indexOf('"')>=0||z.indexOf("'")>=0;return Z&&!U&&(z=`"${z}"`),z}).join(", ")}let B;function V(){return B||(B=e.Util.createCanvasElement().getContext(f),B)}function ee(H){H.fillText(this._partialText,this._partialTextX,this._partialTextY)}function se(H){H.setAttr("miterLimit",2),H.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function oe(H){return H=H||{},!H.fillLinearGradientColorStops&&!H.fillRadialGradientColorStops&&!H.fillPatternImage&&(H.fill=H.fill||"black"),H}class te extends n.Shape{constructor(z){super(oe(z)),this._partialTextX=0,this._partialTextY=0;for(let Z=0;Z<R;Z++)this.on(_[Z]+p,this._setTextData);this._setTextData()}_sceneFunc(z){const Z=this.textArr,U=Z.length;if(!this.text())return;let Y=this.padding(),$=this.fontSize(),F=this.lineHeight()*$,q=this.verticalAlign(),ie=this.direction(),ce=0,me=this.align(),Ie=this.getWidth(),we=this.letterSpacing(),Ee=this.fill(),ot=this.textDecoration(),Fe=ot.indexOf("underline")!==-1,Be=ot.indexOf("line-through")!==-1,ut;ie=ie===u?z.direction:ie;let rt=F/2,ht=v;if(s.Konva._fixTextRendering){const pt=this.measureSize("M");ht="alphabetic",rt=(pt.fontBoundingBoxAscent-pt.fontBoundingBoxDescent)/2+F/2}var K=0,ae=0;for(ie===E&&z.setAttr("direction",ie),z.setAttr("font",this._getContextFont()),z.setAttr("textBaseline",ht),z.setAttr("textAlign",g),q===v?ce=(this.getHeight()-U*F-Y*2)/2:q===y&&(ce=this.getHeight()-U*F-Y*2),z.translate(Y,ce+Y),ut=0;ut<U;ut++){var K=0,ae=0,ne=Z[ut],ue=ne.text,be=ne.width,ye=ne.lastInParagraph,ke,Ue;if(z.save(),me===P?K+=Ie-be-Y*2:me===d&&(K+=(Ie-be-Y*2)/2),Fe){z.save(),z.beginPath();const vn=s.Konva._fixTextRendering?Math.round($/4):Math.round($/2),Cn=K,gn=rt+ae+vn;z.moveTo(Cn,gn),ke=ue.split(" ").length-1,Ue=me===h&&!ye?Ie-Y*2:be,z.lineTo(Cn+Math.round(Ue),gn),z.lineWidth=$/15;const Fn=this._getLinearGradient();z.strokeStyle=Fn||Ee,z.stroke(),z.restore()}if(Be){z.save(),z.beginPath();const vn=s.Konva._fixTextRendering?-Math.round($/4):0;z.moveTo(K,rt+ae+vn),ke=ue.split(" ").length-1,Ue=me===h&&!ye?Ie-Y*2:be,z.lineTo(K+Math.round(Ue),rt+ae+vn),z.lineWidth=$/15;const Cn=this._getLinearGradient();z.strokeStyle=Cn||Ee,z.stroke(),z.restore()}if(ie!==E&&(we!==0||me===h)){ke=ue.split(" ").length-1;const vn=a(ue);for(let Cn=0;Cn<vn.length;Cn++){const gn=vn[Cn];gn===" "&&!ye&&me===h&&(K+=(Ie-Y*2-be)/ke),this._partialTextX=K,this._partialTextY=rt+ae,this._partialText=gn,z.fillStrokeShape(this),K+=this.measureSize(gn).width+we}}else we!==0&&z.setAttr("letterSpacing",`${we}px`),this._partialTextX=K,this._partialTextY=rt+ae,this._partialText=ue,z.fillStrokeShape(this);z.restore(),U>1&&(rt+=F)}}_hitFunc(z){const Z=this.getWidth(),U=this.getHeight();z.beginPath(),z.rect(0,0,Z,U),z.closePath(),z.fillStrokeShape(this)}setText(z){const Z=e.Util._isString(z)?z:z==null?"":z+"";return this._setAttr(x,Z),this}getWidth(){return this.attrs.width===l||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===l||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(z){var Z,U,Y,$,F,q,ie,ce,me,Ie,we;let Ee=V(),ot=this.fontSize(),Fe;Ee.save(),Ee.font=this._getContextFont(),Fe=Ee.measureText(z),Ee.restore();const Be=ot/100;return{actualBoundingBoxAscent:(Z=Fe.actualBoundingBoxAscent)!==null&&Z!==void 0?Z:71.58203125*Be,actualBoundingBoxDescent:(U=Fe.actualBoundingBoxDescent)!==null&&U!==void 0?U:0,actualBoundingBoxLeft:(Y=Fe.actualBoundingBoxLeft)!==null&&Y!==void 0?Y:-7.421875*Be,actualBoundingBoxRight:($=Fe.actualBoundingBoxRight)!==null&&$!==void 0?$:75.732421875*Be,alphabeticBaseline:(F=Fe.alphabeticBaseline)!==null&&F!==void 0?F:0,emHeightAscent:(q=Fe.emHeightAscent)!==null&&q!==void 0?q:100*Be,emHeightDescent:(ie=Fe.emHeightDescent)!==null&&ie!==void 0?ie:-20*Be,fontBoundingBoxAscent:(ce=Fe.fontBoundingBoxAscent)!==null&&ce!==void 0?ce:91*Be,fontBoundingBoxDescent:(me=Fe.fontBoundingBoxDescent)!==null&&me!==void 0?me:21*Be,hangingBaseline:(Ie=Fe.hangingBaseline)!==null&&Ie!==void 0?Ie:72.80000305175781*Be,ideographicBaseline:(we=Fe.ideographicBaseline)!==null&&we!==void 0?we:-21*Be,width:Fe.width,height:ot}}_getContextFont(){return this.fontStyle()+S+this.fontVariant()+S+(this.fontSize()+k)+D(this.fontFamily())}_addTextLine(z){this.align()===h&&(z=z.trim());const U=this._getTextWidth(z);return this.textArr.push({text:z,width:U,lastInParagraph:!1})}_getTextWidth(z){const Z=this.letterSpacing(),U=z.length;return V().measureText(z).width+Z*U}_setTextData(){let z=this.text().split(`
`),Z=+this.fontSize(),U=0,Y=this.lineHeight()*Z,$=this.attrs.width,F=this.attrs.height,q=$!==l&&$!==void 0,ie=F!==l&&F!==void 0,ce=this.padding(),me=$-ce*2,Ie=F-ce*2,we=0,Ee=this.wrap(),ot=Ee!==O,Fe=Ee!==I&&ot,Be=this.ellipsis();this.textArr=[],V().font=this._getContextFont();const ut=Be?this._getTextWidth(N):0;for(let rt=0,ht=z.length;rt<ht;++rt){let K=z[rt],ae=this._getTextWidth(K);if(q&&ae>me)for(;K.length>0;){let ne=0,ue=a(K).length,be="",ye=0;for(;ne<ue;){const ke=ne+ue>>>1,Ue=a(K),pt=Ue.slice(0,ke+1).join(""),_t=this._getTextWidth(pt);(Be&&ie&&we+Y>Ie?_t+ut:_t)<=me?(ne=ke+1,be=pt,ye=_t):ue=ke}if(be){if(Fe){const pt=a(K),_t=a(be),vn=pt[_t.length],Cn=vn===S||vn===m;let gn;if(Cn&&ye<=me)gn=_t.length;else{const Fn=_t.lastIndexOf(S),Hi=_t.lastIndexOf(m);gn=Math.max(Fn,Hi)+1}gn>0&&(ne=gn,be=pt.slice(0,ne).join(""),ye=this._getTextWidth(be))}if(be=be.trimRight(),this._addTextLine(be),U=Math.max(U,ye),we+=Y,this._shouldHandleEllipsis(we)){this._tryToAddEllipsisToLastLine();break}if(K=a(K).slice(ne).join("").trimLeft(),K.length>0&&(ae=this._getTextWidth(K),ae<=me)){this._addTextLine(K),we+=Y,U=Math.max(U,ae);break}}else break}else this._addTextLine(K),we+=Y,U=Math.max(U,ae),this._shouldHandleEllipsis(we)&&rt<ht-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),ie&&we+Y>Ie)break}this.textHeight=Z,this.textWidth=U}_shouldHandleEllipsis(z){const Z=+this.fontSize(),U=this.lineHeight()*Z,Y=this.attrs.height,$=Y!==l&&Y!==void 0,F=this.padding(),q=Y-F*2;return!(this.wrap()!==O)||$&&z+U>q}_tryToAddEllipsisToLastLine(){const z=this.attrs.width,Z=z!==l&&z!==void 0,U=this.padding(),Y=z-U*2,$=this.ellipsis(),F=this.textArr[this.textArr.length-1];!F||!$||(Z&&(this._getTextWidth(F.text+N)<Y||(F.text=F.text.slice(0,F.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(F.text+N))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const z=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,Z=this.hasShadow();return z&&Z?!0:super._useBufferCanvas()}}return Zc.Text=te,te.prototype._fillFunc=ee,te.prototype._strokeFunc=se,te.prototype.className=b,te.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,r._registerNode)(te),t.Factory.overWriteSetter(te,"width",(0,o.getNumberOrAutoValidator)()),t.Factory.overWriteSetter(te,"height",(0,o.getNumberOrAutoValidator)()),t.Factory.addGetterSetter(te,"direction",u),t.Factory.addGetterSetter(te,"fontFamily","Arial"),t.Factory.addGetterSetter(te,"fontSize",12,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(te,"fontStyle",w),t.Factory.addGetterSetter(te,"fontVariant",w),t.Factory.addGetterSetter(te,"padding",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(te,"align",g),t.Factory.addGetterSetter(te,"verticalAlign",C),t.Factory.addGetterSetter(te,"lineHeight",1,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(te,"wrap",L),t.Factory.addGetterSetter(te,"ellipsis",!1,(0,o.getBooleanValidator)()),t.Factory.addGetterSetter(te,"letterSpacing",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(te,"text","",(0,o.getStringValidator)()),t.Factory.addGetterSetter(te,"textDecoration",""),Zc}var Oh={},fA;function l0e(){if(fA)return Oh;fA=1,Object.defineProperty(Oh,"__esModule",{value:!0}),Oh.TextPath=void 0;const e=En(),t=It(),n=hs(),s=Oj(),o=pO(),r=Tt(),a=jt(),l="",d="normal";function u(f){f.fillText(this.partialText,0,0)}function h(f){f.strokeText(this.partialText,0,0)}let p=class extends n.Shape{constructor(m){super(m),this.dummyCanvas=e.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return s.Path.getPathLength(this.dataArray)}_getPointAtLength(m){if(!this.attrs.data)return null;const g=this.pathLength;return m-1>g?null:s.Path.getPointAtLengthOfDataArray(m,this.dataArray)}_readDataAttribute(){this.dataArray=s.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(m){m.setAttr("font",this._getContextFont()),m.setAttr("textBaseline",this.textBaseline()),m.setAttr("textAlign","left"),m.save();const g=this.textDecoration(),x=this.fill(),b=this.fontSize(),C=this.glyphInfo;g==="underline"&&m.beginPath();for(let y=0;y<C.length;y++){m.save();const v=C[y].p0;m.translate(v.x,v.y),m.rotate(C[y].rotation),this.partialText=C[y].text,m.fillStrokeShape(this),g==="underline"&&(y===0&&m.moveTo(0,b/2+1),m.lineTo(b,b/2+1)),m.restore()}g==="underline"&&(m.strokeStyle=x,m.lineWidth=b/20,m.stroke()),m.restore()}_hitFunc(m){m.beginPath();const g=this.glyphInfo;if(g.length>=1){const x=g[0].p0;m.moveTo(x.x,x.y)}for(let x=0;x<g.length;x++){const b=g[x].p1;m.lineTo(b.x,b.y)}m.setAttr("lineWidth",this.fontSize()),m.setAttr("strokeStyle",this.colorKey),m.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(m){return o.Text.prototype.setText.call(this,m)}_getContextFont(){return o.Text.prototype._getContextFont.call(this)}_getTextSize(m){const x=this.dummyCanvas.getContext("2d");x.save(),x.font=this._getContextFont();const b=x.measureText(m);return x.restore(),{width:b.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:m,height:g}=this._getTextSize(this.attrs.text);if(this.textWidth=m,this.textHeight=g,this.glyphInfo=[],!this.attrs.data)return null;const x=this.letterSpacing(),b=this.align(),C=this.kerningFunc(),y=Math.max(this.textWidth+((this.attrs.text||"").length-1)*x,0);let v=0;b==="center"&&(v=Math.max(0,this.pathLength/2-y/2)),b==="right"&&(v=Math.max(0,this.pathLength-y));const w=(0,o.stringToArray)(this.text());let k=v;for(let S=0;S<w.length;S++){const P=this._getPointAtLength(k);if(!P)return;let E=this._getTextSize(w[S]).width+x;if(w[S]===" "&&b==="justify"){const R=this.text().split(" ").length-1;E+=(this.pathLength-y)/R}const L=this._getPointAtLength(k+E);if(!L)return;const I=s.Path.getLineLength(P.x,P.y,L.x,L.y);let O=0;if(C)try{O=C(w[S-1],w[S])*this.fontSize()}catch{O=0}P.x+=O,L.x+=O,this.textWidth+=O;const N=s.Path.getPointOnLine(O+I/2,P.x,P.y,L.x,L.y),_=Math.atan2(L.y-P.y,L.x-P.x);this.glyphInfo.push({transposeX:N.x,transposeY:N.y,text:w[S],rotation:_,p0:P,p1:L}),k+=E}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const m=[];this.glyphInfo.forEach(function(k){m.push(k.p0.x),m.push(k.p0.y),m.push(k.p1.x),m.push(k.p1.y)});let g=m[0]||0,x=m[0]||0,b=m[1]||0,C=m[1]||0,y,v;for(let k=0;k<m.length/2;k++)y=m[k*2],v=m[k*2+1],g=Math.min(g,y),x=Math.max(x,y),b=Math.min(b,v),C=Math.max(C,v);const w=this.fontSize();return{x:g-w/2,y:b-w/2,width:x-g+w,height:C-b+w}}destroy(){return e.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return Oh.TextPath=p,p.prototype._fillFunc=u,p.prototype._strokeFunc=h,p.prototype._fillFuncHit=u,p.prototype._strokeFuncHit=h,p.prototype.className="TextPath",p.prototype._attrsAffectingSize=["text","fontSize","data"],(0,a._registerNode)(p),t.Factory.addGetterSetter(p,"data"),t.Factory.addGetterSetter(p,"fontFamily","Arial"),t.Factory.addGetterSetter(p,"fontSize",12,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(p,"fontStyle",d),t.Factory.addGetterSetter(p,"align","left"),t.Factory.addGetterSetter(p,"letterSpacing",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(p,"textBaseline","middle"),t.Factory.addGetterSetter(p,"fontVariant",d),t.Factory.addGetterSetter(p,"text",l),t.Factory.addGetterSetter(p,"textDecoration",""),t.Factory.addGetterSetter(p,"kerningFunc",void 0),Oh}var Nh={},mA;function c0e(){if(mA)return Nh;mA=1,Object.defineProperty(Nh,"__esModule",{value:!0}),Nh.Transformer=void 0;const e=En(),t=It(),n=Nn(),s=hs(),o=hO(),r=Dj(),a=jt(),l=Tt(),d=jt(),u="tr-konva",h=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(E=>E+`.${u}`).join(" "),p="nodesRect",f=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],m={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},g="ontouchstart"in a.Konva._global;function x(E,L,I){if(E==="rotater")return I;L+=e.Util.degToRad(m[E]||0);const O=(e.Util.radToDeg(L)%360+360)%360;return e.Util._inRange(O,315+22.5,360)||e.Util._inRange(O,0,22.5)?"ns-resize":e.Util._inRange(O,45-22.5,45+22.5)?"nesw-resize":e.Util._inRange(O,90-22.5,90+22.5)?"ew-resize":e.Util._inRange(O,135-22.5,135+22.5)?"nwse-resize":e.Util._inRange(O,180-22.5,180+22.5)?"ns-resize":e.Util._inRange(O,225-22.5,225+22.5)?"nesw-resize":e.Util._inRange(O,270-22.5,270+22.5)?"ew-resize":e.Util._inRange(O,315-22.5,315+22.5)?"nwse-resize":(e.Util.error("Transformer has unknown angle for cursor detection: "+O),"pointer")}const b=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function C(E){return{x:E.x+E.width/2*Math.cos(E.rotation)+E.height/2*Math.sin(-E.rotation),y:E.y+E.height/2*Math.cos(E.rotation)+E.width/2*Math.sin(E.rotation)}}function y(E,L,I){const O=I.x+(E.x-I.x)*Math.cos(L)-(E.y-I.y)*Math.sin(L),N=I.y+(E.x-I.x)*Math.sin(L)+(E.y-I.y)*Math.cos(L);return{...E,rotation:E.rotation+L,x:O,y:N}}function v(E,L){const I=C(E);return y(E,L,I)}function w(E,L,I){let O=L;for(let N=0;N<E.length;N++){const _=a.Konva.getAngle(E[N]),R=Math.abs(_-L)%(Math.PI*2);Math.min(R,Math.PI*2-R)<I&&(O=_)}return O}let k=0,S=class extends r.Group{constructor(L){super(L),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(h,this.update),this.getNode()&&this.update()}attachTo(L){return this.setNode(L),this}setNode(L){return e.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([L])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return u+this._id}setNodes(L=[]){this._nodes&&this._nodes.length&&this.detach();const I=L.filter(N=>N.isAncestorOf(this)?(e.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=L=I,L.length===1&&this.useSingleNodeRotation()?this.rotation(L[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(N=>{const _=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(N._attrsAffectingSize.length){const R=N._attrsAffectingSize.map(D=>D+"Change."+this._getEventNamespace()).join(" ");N.on(R,_)}N.on(f.map(R=>R+`.${this._getEventNamespace()}`).join(" "),_),N.on(`absoluteTransformChange.${this._getEventNamespace()}`,_),this._proxyDrag(N)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(L){let I;L.on(`dragstart.${this._getEventNamespace()}`,O=>{I=L.getAbsolutePosition(),!this.isDragging()&&L!==this.findOne(".back")&&this.startDrag(O,!1)}),L.on(`dragmove.${this._getEventNamespace()}`,O=>{if(!I)return;const N=L.getAbsolutePosition(),_=N.x-I.x,R=N.y-I.y;this.nodes().forEach(D=>{if(D===L||D.isDragging())return;const B=D.getAbsolutePosition();D.setAbsolutePosition({x:B.x+_,y:B.y+R}),D.startDrag(O)}),I=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(L=>{L.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(p),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(p,this.__getNodeRect)}__getNodeShape(L,I=this.rotation(),O){const N=L.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),_=L.getAbsoluteScale(O),R=L.getAbsolutePosition(O),D=N.x*_.x-L.offsetX()*_.x,B=N.y*_.y-L.offsetY()*_.y,V=(a.Konva.getAngle(L.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),ee={x:R.x+D*Math.cos(V)+B*Math.sin(-V),y:R.y+B*Math.cos(V)+D*Math.sin(V),width:N.width*_.x,height:N.height*_.y,rotation:V};return y(ee,-a.Konva.getAngle(I),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const I=[];this.nodes().map(V=>{const ee=V.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),se=[{x:ee.x,y:ee.y},{x:ee.x+ee.width,y:ee.y},{x:ee.x+ee.width,y:ee.y+ee.height},{x:ee.x,y:ee.y+ee.height}],oe=V.getAbsoluteTransform();se.forEach(function(te){const H=oe.point(te);I.push(H)})});const O=new e.Transform;O.rotate(-a.Konva.getAngle(this.rotation()));let N=1/0,_=1/0,R=-1/0,D=-1/0;I.forEach(function(V){const ee=O.point(V);N===void 0&&(N=R=ee.x,_=D=ee.y),N=Math.min(N,ee.x),_=Math.min(_,ee.y),R=Math.max(R,ee.x),D=Math.max(D,ee.y)}),O.invert();const B=O.point({x:N,y:_});return{x:B.x,y:B.y,width:R-N,height:D-_,rotation:a.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),b.forEach(L=>{this._createAnchor(L)}),this._createAnchor("rotater")}_createAnchor(L){const I=new o.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:L+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:g?10:"auto"}),O=this;I.on("mousedown touchstart",function(N){O._handleMouseDown(N)}),I.on("dragstart",N=>{I.stopDrag(),N.cancelBubble=!0}),I.on("dragend",N=>{N.cancelBubble=!0}),I.on("mouseenter",()=>{const N=a.Konva.getAngle(this.rotation()),_=this.rotateAnchorCursor(),R=x(L,N,_);I.getStage().content&&(I.getStage().content.style.cursor=R),this._cursorChange=!0}),I.on("mouseout",()=>{I.getStage().content&&(I.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(I)}_createBack(){const L=new s.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(I,O){const N=O.getParent(),_=N.padding();I.beginPath(),I.rect(-_,-_,O.width()+_*2,O.height()+_*2),I.moveTo(O.width()/2,-_),N.rotateEnabled()&&N.rotateLineVisible()&&I.lineTo(O.width()/2,-N.rotateAnchorOffset()*e.Util._sign(O.height())-_),I.fillStrokeShape(O)},hitFunc:(I,O)=>{if(!this.shouldOverdrawWholeArea())return;const N=this.padding();I.beginPath(),I.rect(-N,-N,O.width()+N*2,O.height()+N*2),I.fillStrokeShape(O)}});this.add(L),this._proxyDrag(L),L.on("dragstart",I=>{I.cancelBubble=!0}),L.on("dragmove",I=>{I.cancelBubble=!0}),L.on("dragend",I=>{I.cancelBubble=!0}),this.on("dragmove",I=>{this.update()})}_handleMouseDown(L){if(this._transforming)return;this._movingAnchorName=L.target.name().split(" ")[0];const I=this._getNodeRect(),O=I.width,N=I.height,_=Math.sqrt(Math.pow(O,2)+Math.pow(N,2));this.sin=Math.abs(N/_),this.cos=Math.abs(O/_),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const R=L.target.getAbsolutePosition(),D=L.target.getStage().getPointerPosition();this._anchorDragOffset={x:D.x-R.x,y:D.y-R.y},k++,this._fire("transformstart",{evt:L.evt,target:this.getNode()}),this._nodes.forEach(B=>{B._fire("transformstart",{evt:L.evt,target:B})})}_handleMouseMove(L){let I,O,N;const _=this.findOne("."+this._movingAnchorName),R=_.getStage();R.setPointersPositions(L);const D=R.getPointerPosition();let B={x:D.x-this._anchorDragOffset.x,y:D.y-this._anchorDragOffset.y};const V=_.getAbsolutePosition();this.anchorDragBoundFunc()&&(B=this.anchorDragBoundFunc()(V,B,L)),_.setAbsolutePosition(B);const ee=_.getAbsolutePosition();if(V.x===ee.x&&V.y===ee.y)return;if(this._movingAnchorName==="rotater"){const q=this._getNodeRect();I=_.x()-q.width/2,O=-_.y()+q.height/2;let ie=Math.atan2(-O,I)+Math.PI/2;q.height<0&&(ie-=Math.PI);const me=a.Konva.getAngle(this.rotation())+ie,Ie=a.Konva.getAngle(this.rotationSnapTolerance()),Ee=w(this.rotationSnaps(),me,Ie)-q.rotation,ot=v(q,Ee);this._fitNodesInto(ot,L);return}const se=this.shiftBehavior();let oe;se==="inverted"?oe=this.keepRatio()&&!L.shiftKey:se==="none"?oe=this.keepRatio():oe=this.keepRatio()||L.shiftKey;var U=this.centeredScaling()||L.altKey;if(this._movingAnchorName==="top-left"){if(oe){var te=U?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};N=Math.sqrt(Math.pow(te.x-_.x(),2)+Math.pow(te.y-_.y(),2));var H=this.findOne(".top-left").x()>te.x?-1:1,z=this.findOne(".top-left").y()>te.y?-1:1;I=N*this.cos*H,O=N*this.sin*z,this.findOne(".top-left").x(te.x-I),this.findOne(".top-left").y(te.y-O)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(_.y());else if(this._movingAnchorName==="top-right"){if(oe){var te=U?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};N=Math.sqrt(Math.pow(_.x()-te.x,2)+Math.pow(te.y-_.y(),2));var H=this.findOne(".top-right").x()<te.x?-1:1,z=this.findOne(".top-right").y()>te.y?-1:1;I=N*this.cos*H,O=N*this.sin*z,this.findOne(".top-right").x(te.x+I),this.findOne(".top-right").y(te.y-O)}var Z=_.position();this.findOne(".top-left").y(Z.y),this.findOne(".bottom-right").x(Z.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(_.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(_.x());else if(this._movingAnchorName==="bottom-left"){if(oe){var te=U?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};N=Math.sqrt(Math.pow(te.x-_.x(),2)+Math.pow(_.y()-te.y,2));var H=te.x<_.x()?-1:1,z=_.y()<te.y?-1:1;I=N*this.cos*H,O=N*this.sin*z,_.x(te.x-I),_.y(te.y+O)}Z=_.position(),this.findOne(".top-left").x(Z.x),this.findOne(".bottom-right").y(Z.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(_.y());else if(this._movingAnchorName==="bottom-right"){if(oe){var te=U?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};N=Math.sqrt(Math.pow(_.x()-te.x,2)+Math.pow(_.y()-te.y,2));var H=this.findOne(".bottom-right").x()<te.x?-1:1,z=this.findOne(".bottom-right").y()<te.y?-1:1;I=N*this.cos*H,O=N*this.sin*z,this.findOne(".bottom-right").x(te.x+I),this.findOne(".bottom-right").y(te.y+O)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var U=this.centeredScaling()||L.altKey;if(U){const q=this.findOne(".top-left"),ie=this.findOne(".bottom-right"),ce=q.x(),me=q.y(),Ie=this.getWidth()-ie.x(),we=this.getHeight()-ie.y();ie.move({x:-ce,y:-me}),q.move({x:Ie,y:we})}const Y=this.findOne(".top-left").getAbsolutePosition();I=Y.x,O=Y.y;const $=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),F=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:I,y:O,width:$,height:F,rotation:a.Konva.getAngle(this.rotation())},L)}_handleMouseUp(L){this._removeEvents(L)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(L){var I;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const O=this.getNode();k--,this._fire("transformend",{evt:L,target:O}),(I=this.getLayer())===null||I===void 0||I.batchDraw(),O&&this._nodes.forEach(N=>{var _;N._fire("transformend",{evt:L,target:N}),(_=N.getLayer())===null||_===void 0||_.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(L,I){const O=this._getNodeRect(),N=1;if(e.Util._inRange(L.width,-this.padding()*2-N,N)){this.update();return}if(e.Util._inRange(L.height,-this.padding()*2-N,N)){this.update();return}const _=new e.Transform;if(_.rotate(a.Konva.getAngle(this.rotation())),this._movingAnchorName&&L.width<0&&this._movingAnchorName.indexOf("left")>=0){const oe=_.point({x:-this.padding()*2,y:0});L.x+=oe.x,L.y+=oe.y,L.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=oe.x,this._anchorDragOffset.y-=oe.y}else if(this._movingAnchorName&&L.width<0&&this._movingAnchorName.indexOf("right")>=0){const oe=_.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=oe.x,this._anchorDragOffset.y-=oe.y,L.width+=this.padding()*2}if(this._movingAnchorName&&L.height<0&&this._movingAnchorName.indexOf("top")>=0){const oe=_.point({x:0,y:-this.padding()*2});L.x+=oe.x,L.y+=oe.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=oe.x,this._anchorDragOffset.y-=oe.y,L.height+=this.padding()*2}else if(this._movingAnchorName&&L.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const oe=_.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=oe.x,this._anchorDragOffset.y-=oe.y,L.height+=this.padding()*2}if(this.boundBoxFunc()){const oe=this.boundBoxFunc()(O,L);oe?L=oe:e.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const R=1e7,D=new e.Transform;D.translate(O.x,O.y),D.rotate(O.rotation),D.scale(O.width/R,O.height/R);const B=new e.Transform,V=L.width/R,ee=L.height/R;this.flipEnabled()===!1?(B.translate(L.x,L.y),B.rotate(L.rotation),B.translate(L.width<0?L.width:0,L.height<0?L.height:0),B.scale(Math.abs(V),Math.abs(ee))):(B.translate(L.x,L.y),B.rotate(L.rotation),B.scale(V,ee));const se=B.multiply(D.invert());this._nodes.forEach(oe=>{var te;const H=oe.getParent().getAbsoluteTransform(),z=oe.getTransform().copy();z.translate(oe.offsetX(),oe.offsetY());const Z=new e.Transform;Z.multiply(H.copy().invert()).multiply(se).multiply(H).multiply(z);const U=Z.decompose();oe.setAttrs(U),(te=oe.getLayer())===null||te===void 0||te.batchDraw()}),this.rotation(e.Util._getRotation(L.rotation)),this._nodes.forEach(oe=>{this._fire("transform",{evt:I,target:oe}),oe._fire("transform",{evt:I,target:oe})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(L,I){this.findOne(L).setAttrs(I)}update(){var L;const I=this._getNodeRect();this.rotation(e.Util._getRotation(I.rotation));const O=I.width,N=I.height,_=this.enabledAnchors(),R=this.resizeEnabled(),D=this.padding(),B=this.anchorSize(),V=this.find("._anchor");V.forEach(se=>{se.setAttrs({width:B,height:B,offsetX:B/2,offsetY:B/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:B/2+D,offsetY:B/2+D,visible:R&&_.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:O/2,y:0,offsetY:B/2+D,visible:R&&_.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:O,y:0,offsetX:B/2-D,offsetY:B/2+D,visible:R&&_.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:N/2,offsetX:B/2+D,visible:R&&_.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:O,y:N/2,offsetX:B/2-D,visible:R&&_.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:N,offsetX:B/2+D,offsetY:B/2-D,visible:R&&_.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:O/2,y:N,offsetY:B/2-D,visible:R&&_.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:O,y:N,offsetX:B/2-D,offsetY:B/2-D,visible:R&&_.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:O/2,y:-this.rotateAnchorOffset()*e.Util._sign(N)-D,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:O,height:N,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const ee=this.anchorStyleFunc();ee&&V.forEach(se=>{ee(se)}),(L=this.getLayer())===null||L===void 0||L.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const L=this.findOne("."+this._movingAnchorName);L&&L.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),r.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return n.Node.prototype.toObject.call(this)}clone(L){return n.Node.prototype.clone.call(this,L)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};Nh.Transformer=S,S.isTransforming=()=>k>0;function P(E){return E instanceof Array||e.Util.warn("enabledAnchors value should be an array"),E instanceof Array&&E.forEach(function(L){b.indexOf(L)===-1&&e.Util.warn("Unknown anchor name: "+L+". Available names are: "+b.join(", "))}),E||[]}return S.prototype.className="Transformer",(0,d._registerNode)(S),t.Factory.addGetterSetter(S,"enabledAnchors",b,P),t.Factory.addGetterSetter(S,"flipEnabled",!0,(0,l.getBooleanValidator)()),t.Factory.addGetterSetter(S,"resizeEnabled",!0),t.Factory.addGetterSetter(S,"anchorSize",10,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"rotateEnabled",!0),t.Factory.addGetterSetter(S,"rotateLineVisible",!0),t.Factory.addGetterSetter(S,"rotationSnaps",[]),t.Factory.addGetterSetter(S,"rotateAnchorOffset",50,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"rotateAnchorCursor","crosshair"),t.Factory.addGetterSetter(S,"rotationSnapTolerance",5,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"borderEnabled",!0),t.Factory.addGetterSetter(S,"anchorStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(S,"anchorStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"anchorFill","white"),t.Factory.addGetterSetter(S,"anchorCornerRadius",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"borderStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(S,"borderStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"borderDash"),t.Factory.addGetterSetter(S,"keepRatio",!0),t.Factory.addGetterSetter(S,"shiftBehavior","default"),t.Factory.addGetterSetter(S,"centeredScaling",!1),t.Factory.addGetterSetter(S,"ignoreStroke",!1),t.Factory.addGetterSetter(S,"padding",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"nodes"),t.Factory.addGetterSetter(S,"node"),t.Factory.addGetterSetter(S,"boundBoxFunc"),t.Factory.addGetterSetter(S,"anchorDragBoundFunc"),t.Factory.addGetterSetter(S,"anchorStyleFunc"),t.Factory.addGetterSetter(S,"shouldOverdrawWholeArea",!1),t.Factory.addGetterSetter(S,"useSingleNodeRotation",!0),t.Factory.backCompat(S,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),Nh}var Fh={},gA;function d0e(){if(gA)return Fh;gA=1,Object.defineProperty(Fh,"__esModule",{value:!0}),Fh.Wedge=void 0;const e=It(),t=hs(),n=jt(),s=Tt(),o=jt();let r=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.radius(),0,n.Konva.getAngle(this.angle()),this.clockwise()),l.lineTo(0,0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius(l/2)}setHeight(l){this.radius(l/2)}};return Fh.Wedge=r,r.prototype.className="Wedge",r.prototype._centroid=!0,r.prototype._attrsAffectingSize=["radius"],(0,o._registerNode)(r),e.Factory.addGetterSetter(r,"radius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(r,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(r,"clockwise",!1),e.Factory.backCompat(r,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Fh}var Bh={},xA;function u0e(){if(xA)return Bh;xA=1,Object.defineProperty(Bh,"__esModule",{value:!0}),Bh.Blur=void 0;const e=It(),t=Nn(),n=Tt();function s(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const o=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function a(d,u){const h=d.data,p=d.width,f=d.height;let m,g,x,b,C,y,v,w,k,S,P,E,L,I,O,N,_,R,D,B,V,ee,se,oe;const te=u+u+1,H=p-1,z=f-1,Z=u+1,U=Z*(Z+1)/2,Y=new s,$=o[u],F=r[u];let q=null,ie=Y,ce=null,me=null;for(x=1;x<te;x++)ie=ie.next=new s,x===Z&&(q=ie);for(ie.next=Y,v=y=0,g=0;g<f;g++){for(N=_=R=D=w=k=S=P=0,E=Z*(B=h[y]),L=Z*(V=h[y+1]),I=Z*(ee=h[y+2]),O=Z*(se=h[y+3]),w+=U*B,k+=U*V,S+=U*ee,P+=U*se,ie=Y,x=0;x<Z;x++)ie.r=B,ie.g=V,ie.b=ee,ie.a=se,ie=ie.next;for(x=1;x<Z;x++)b=y+((H<x?H:x)<<2),w+=(ie.r=B=h[b])*(oe=Z-x),k+=(ie.g=V=h[b+1])*oe,S+=(ie.b=ee=h[b+2])*oe,P+=(ie.a=se=h[b+3])*oe,N+=B,_+=V,R+=ee,D+=se,ie=ie.next;for(ce=Y,me=q,m=0;m<p;m++)h[y+3]=se=P*$>>F,se!==0?(se=255/se,h[y]=(w*$>>F)*se,h[y+1]=(k*$>>F)*se,h[y+2]=(S*$>>F)*se):h[y]=h[y+1]=h[y+2]=0,w-=E,k-=L,S-=I,P-=O,E-=ce.r,L-=ce.g,I-=ce.b,O-=ce.a,b=v+((b=m+u+1)<H?b:H)<<2,N+=ce.r=h[b],_+=ce.g=h[b+1],R+=ce.b=h[b+2],D+=ce.a=h[b+3],w+=N,k+=_,S+=R,P+=D,ce=ce.next,E+=B=me.r,L+=V=me.g,I+=ee=me.b,O+=se=me.a,N-=B,_-=V,R-=ee,D-=se,me=me.next,y+=4;v+=p}for(m=0;m<p;m++){for(_=R=D=N=k=S=P=w=0,y=m<<2,E=Z*(B=h[y]),L=Z*(V=h[y+1]),I=Z*(ee=h[y+2]),O=Z*(se=h[y+3]),w+=U*B,k+=U*V,S+=U*ee,P+=U*se,ie=Y,x=0;x<Z;x++)ie.r=B,ie.g=V,ie.b=ee,ie.a=se,ie=ie.next;for(C=p,x=1;x<=u;x++)y=C+m<<2,w+=(ie.r=B=h[y])*(oe=Z-x),k+=(ie.g=V=h[y+1])*oe,S+=(ie.b=ee=h[y+2])*oe,P+=(ie.a=se=h[y+3])*oe,N+=B,_+=V,R+=ee,D+=se,ie=ie.next,x<z&&(C+=p);for(y=m,ce=Y,me=q,g=0;g<f;g++)b=y<<2,h[b+3]=se=P*$>>F,se>0?(se=255/se,h[b]=(w*$>>F)*se,h[b+1]=(k*$>>F)*se,h[b+2]=(S*$>>F)*se):h[b]=h[b+1]=h[b+2]=0,w-=E,k-=L,S-=I,P-=O,E-=ce.r,L-=ce.g,I-=ce.b,O-=ce.a,b=m+((b=g+Z)<z?b:z)*p<<2,w+=N+=ce.r=h[b],k+=_+=ce.g=h[b+1],S+=R+=ce.b=h[b+2],P+=D+=ce.a=h[b+3],ce=ce.next,E+=B=me.r,L+=V=me.g,I+=ee=me.b,O+=se=me.a,N-=B,_-=V,R-=ee,D-=se,me=me.next,y+=p}}const l=function(u){const h=Math.round(this.blurRadius());h>0&&a(u,h)};return Bh.Blur=l,e.Factory.addGetterSetter(t.Node,"blurRadius",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Bh}var $h={},yA;function h0e(){if(yA)return $h;yA=1,Object.defineProperty($h,"__esModule",{value:!0}),$h.Brighten=void 0;const e=It(),t=Nn(),n=Tt(),s=function(o){const r=this.brightness()*255,a=o.data,l=a.length;for(let d=0;d<l;d+=4)a[d]+=r,a[d+1]+=r,a[d+2]+=r};return $h.Brighten=s,e.Factory.addGetterSetter(t.Node,"brightness",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),$h}var Vh={},bA;function p0e(){if(bA)return Vh;bA=1,Object.defineProperty(Vh,"__esModule",{value:!0}),Vh.Contrast=void 0;const e=It(),t=Nn(),n=Tt(),s=function(o){const r=Math.pow((this.contrast()+100)/100,2),a=o.data,l=a.length;let d=150,u=150,h=150;for(let p=0;p<l;p+=4)d=a[p],u=a[p+1],h=a[p+2],d/=255,d-=.5,d*=r,d+=.5,d*=255,u/=255,u-=.5,u*=r,u+=.5,u*=255,h/=255,h-=.5,h*=r,h+=.5,h*=255,d=d<0?0:d>255?255:d,u=u<0?0:u>255?255:u,h=h<0?0:h>255?255:h,a[p]=d,a[p+1]=u,a[p+2]=h};return Vh.Contrast=s,e.Factory.addGetterSetter(t.Node,"contrast",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Vh}var zh={},vA;function f0e(){if(vA)return zh;vA=1,Object.defineProperty(zh,"__esModule",{value:!0}),zh.Emboss=void 0;const e=It(),t=Nn(),n=En(),s=Tt(),o=function(r){const a=this.embossStrength()*10,l=this.embossWhiteLevel()*255,d=this.embossDirection(),u=this.embossBlend(),h=r.data,p=r.width,f=r.height,m=p*4;let g=0,x=0,b=f;switch(d){case"top-left":g=-1,x=-1;break;case"top":g=-1,x=0;break;case"top-right":g=-1,x=1;break;case"right":g=0,x=1;break;case"bottom-right":g=1,x=1;break;case"bottom":g=1,x=0;break;case"bottom-left":g=1,x=-1;break;case"left":g=0,x=-1;break;default:n.Util.error("Unknown emboss direction: "+d)}do{const C=(b-1)*m;let y=g;b+y<1&&(y=0),b+y>f&&(y=0);const v=(b-1+y)*p*4;let w=p;do{const k=C+(w-1)*4;let S=x;w+S<1&&(S=0),w+S>p&&(S=0);const P=v+(w-1+S)*4,E=h[k]-h[P],L=h[k+1]-h[P+1],I=h[k+2]-h[P+2];let O=E;const N=O>0?O:-O,_=L>0?L:-L,R=I>0?I:-I;if(_>N&&(O=L),R>N&&(O=I),O*=a,u){const D=h[k]+O,B=h[k+1]+O,V=h[k+2]+O;h[k]=D>255?255:D<0?0:D,h[k+1]=B>255?255:B<0?0:B,h[k+2]=V>255?255:V<0?0:V}else{let D=l-O;D<0?D=0:D>255&&(D=255),h[k]=h[k+1]=h[k+2]=D}}while(--w)}while(--b)};return zh.Emboss=o,e.Factory.addGetterSetter(t.Node,"embossStrength",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossDirection","top-left",void 0,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossBlend",!1,void 0,e.Factory.afterSetFilter),zh}var Gh={},CA;function m0e(){if(CA)return Gh;CA=1,Object.defineProperty(Gh,"__esModule",{value:!0}),Gh.Enhance=void 0;const e=It(),t=Nn(),n=Tt();function s(r,a,l,d,u){const h=l-a,p=u-d;if(h===0)return d+p/2;if(p===0)return d;let f=(r-a)/h;return f=p*f+d,f}const o=function(r){const a=r.data,l=a.length;let d=a[0],u=d,h,p=a[1],f=p,m,g=a[2],x=g,b;const C=this.enhance();if(C===0)return;for(let O=0;O<l;O+=4)h=a[O+0],h<d?d=h:h>u&&(u=h),m=a[O+1],m<p?p=m:m>f&&(f=m),b=a[O+2],b<g?g=b:b>x&&(x=b);u===d&&(u=255,d=0),f===p&&(f=255,p=0),x===g&&(x=255,g=0);let y,v,w,k,S,P,E,L,I;C>0?(v=u+C*(255-u),w=d-C*(d-0),S=f+C*(255-f),P=p-C*(p-0),L=x+C*(255-x),I=g-C*(g-0)):(y=(u+d)*.5,v=u+C*(u-y),w=d+C*(d-y),k=(f+p)*.5,S=f+C*(f-k),P=p+C*(p-k),E=(x+g)*.5,L=x+C*(x-E),I=g+C*(g-E));for(let O=0;O<l;O+=4)a[O+0]=s(a[O+0],d,u,w,v),a[O+1]=s(a[O+1],p,f,P,S),a[O+2]=s(a[O+2],g,x,I,L)};return Gh.Enhance=o,e.Factory.addGetterSetter(t.Node,"enhance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Gh}var Hh={},wA;function g0e(){if(wA)return Hh;wA=1,Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.Grayscale=void 0;const e=function(t){const n=t.data,s=n.length;for(let o=0;o<s;o+=4){const r=.34*n[o]+.5*n[o+1]+.16*n[o+2];n[o]=r,n[o+1]=r,n[o+2]=r}};return Hh.Grayscale=e,Hh}var Wh={},SA;function x0e(){if(SA)return Wh;SA=1,Object.defineProperty(Wh,"__esModule",{value:!0}),Wh.HSL=void 0;const e=It(),t=Nn(),n=Tt();e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"luminance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter);const s=function(o){const r=o.data,a=r.length,l=1,d=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,h=this.luminance()*127,p=l*d*Math.cos(u*Math.PI/180),f=l*d*Math.sin(u*Math.PI/180),m=.299*l+.701*p+.167*f,g=.587*l-.587*p+.33*f,x=.114*l-.114*p-.497*f,b=.299*l-.299*p-.328*f,C=.587*l+.413*p+.035*f,y=.114*l-.114*p+.293*f,v=.299*l-.3*p+1.25*f,w=.587*l-.586*p-1.05*f,k=.114*l+.886*p-.2*f;let S,P,E,L;for(let I=0;I<a;I+=4)S=r[I+0],P=r[I+1],E=r[I+2],L=r[I+3],r[I+0]=m*S+g*P+x*E+h,r[I+1]=b*S+C*P+y*E+h,r[I+2]=v*S+w*P+k*E+h,r[I+3]=L};return Wh.HSL=s,Wh}var Uh={},kA;function y0e(){if(kA)return Uh;kA=1,Object.defineProperty(Uh,"__esModule",{value:!0}),Uh.HSV=void 0;const e=It(),t=Nn(),n=Tt(),s=function(o){const r=o.data,a=r.length,l=Math.pow(2,this.value()),d=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,h=l*d*Math.cos(u*Math.PI/180),p=l*d*Math.sin(u*Math.PI/180),f=.299*l+.701*h+.167*p,m=.587*l-.587*h+.33*p,g=.114*l-.114*h-.497*p,x=.299*l-.299*h-.328*p,b=.587*l+.413*h+.035*p,C=.114*l-.114*h+.293*p,y=.299*l-.3*h+1.25*p,v=.587*l-.586*h-1.05*p,w=.114*l+.886*h-.2*p;let k,S,P,E;for(let L=0;L<a;L+=4)k=r[L+0],S=r[L+1],P=r[L+2],E=r[L+3],r[L+0]=f*k+m*S+g*P,r[L+1]=x*k+b*S+C*P,r[L+2]=y*k+v*S+w*P,r[L+3]=E};return Uh.HSV=s,e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"value",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Uh}var qh={},jA;function b0e(){if(jA)return qh;jA=1,Object.defineProperty(qh,"__esModule",{value:!0}),qh.Invert=void 0;const e=function(t){const n=t.data,s=n.length;for(let o=0;o<s;o+=4)n[o]=255-n[o],n[o+1]=255-n[o+1],n[o+2]=255-n[o+2]};return qh.Invert=e,qh}var Kh={},_A;function v0e(){if(_A)return Kh;_A=1,Object.defineProperty(Kh,"__esModule",{value:!0}),Kh.Kaleidoscope=void 0;const e=It(),t=Nn(),n=En(),s=Tt(),o=function(l,d,u){const h=l.data,p=d.data,f=l.width,m=l.height,g=u.polarCenterX||f/2,x=u.polarCenterY||m/2;let b=Math.sqrt(g*g+x*x),C=f-g,y=m-x;const v=Math.sqrt(C*C+y*y);b=v>b?v:b;const w=m,k=f,S=360/k*Math.PI/180;for(let P=0;P<k;P+=1){const E=Math.sin(P*S),L=Math.cos(P*S);for(let I=0;I<w;I+=1){C=Math.floor(g+b*I/w*L),y=Math.floor(x+b*I/w*E);let O=(y*f+C)*4;const N=h[O+0],_=h[O+1],R=h[O+2],D=h[O+3];O=(P+I*f)*4,p[O+0]=N,p[O+1]=_,p[O+2]=R,p[O+3]=D}}},r=function(l,d,u){const h=l.data,p=d.data,f=l.width,m=l.height,g=u.polarCenterX||f/2,x=u.polarCenterY||m/2;let b=Math.sqrt(g*g+x*x),C=f-g,y=m-x;const v=Math.sqrt(C*C+y*y);b=v>b?v:b;const w=m,k=f,S=0;let P,E;for(C=0;C<f;C+=1)for(y=0;y<m;y+=1){const L=C-g,I=y-x,O=Math.sqrt(L*L+I*I)*w/b;let N=(Math.atan2(I,L)*180/Math.PI+360+S)%360;N=N*k/360,P=Math.floor(N),E=Math.floor(O);let _=(E*f+P)*4;const R=h[_+0],D=h[_+1],B=h[_+2],V=h[_+3];_=(y*f+C)*4,p[_+0]=R,p[_+1]=D,p[_+2]=B,p[_+3]=V}},a=function(l){const d=l.width,u=l.height;let h,p,f,m,g,x,b,C,y,v,w=Math.round(this.kaleidoscopePower());const k=Math.round(this.kaleidoscopeAngle()),S=Math.floor(d*(k%360)/360);if(w<1)return;const P=n.Util.createCanvasElement();P.width=d,P.height=u;const E=P.getContext("2d").getImageData(0,0,d,u);n.Util.releaseCanvas(P),o(l,E,{polarCenterX:d/2,polarCenterY:u/2});let L=d/Math.pow(2,w);for(;L<=8;)L=L*2,w-=1;L=Math.ceil(L);let I=L,O=0,N=I,_=1;for(S+L>d&&(O=I,N=0,_=-1),p=0;p<u;p+=1)for(h=O;h!==N;h+=_)f=Math.round(h+S)%d,y=(d*p+f)*4,g=E.data[y+0],x=E.data[y+1],b=E.data[y+2],C=E.data[y+3],v=(d*p+h)*4,E.data[v+0]=g,E.data[v+1]=x,E.data[v+2]=b,E.data[v+3]=C;for(p=0;p<u;p+=1)for(I=Math.floor(L),m=0;m<w;m+=1){for(h=0;h<I+1;h+=1)y=(d*p+h)*4,g=E.data[y+0],x=E.data[y+1],b=E.data[y+2],C=E.data[y+3],v=(d*p+I*2-h-1)*4,E.data[v+0]=g,E.data[v+1]=x,E.data[v+2]=b,E.data[v+3]=C;I*=2}r(E,l,{})};return Kh.Kaleidoscope=a,e.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),Kh}var Zh={},IA;function C0e(){if(IA)return Zh;IA=1,Object.defineProperty(Zh,"__esModule",{value:!0}),Zh.Mask=void 0;const e=It(),t=Nn(),n=Tt();function s(f,m,g){let x=(g*f.width+m)*4;const b=[];return b.push(f.data[x++],f.data[x++],f.data[x++],f.data[x++]),b}function o(f,m){return Math.sqrt(Math.pow(f[0]-m[0],2)+Math.pow(f[1]-m[1],2)+Math.pow(f[2]-m[2],2))}function r(f){const m=[0,0,0];for(let g=0;g<f.length;g++)m[0]+=f[g][0],m[1]+=f[g][1],m[2]+=f[g][2];return m[0]/=f.length,m[1]/=f.length,m[2]/=f.length,m}function a(f,m){const g=s(f,0,0),x=s(f,f.width-1,0),b=s(f,0,f.height-1),C=s(f,f.width-1,f.height-1),y=m||10;if(o(g,x)<y&&o(x,C)<y&&o(C,b)<y&&o(b,g)<y){const v=r([x,g,C,b]),w=[];for(let k=0;k<f.width*f.height;k++){const S=o(v,[f.data[k*4],f.data[k*4+1],f.data[k*4+2]]);w[k]=S<y?0:255}return w}}function l(f,m){for(let g=0;g<f.width*f.height;g++)f.data[4*g+3]=m[g]}function d(f,m,g){const x=[1,1,1,1,0,1,1,1,1],b=Math.round(Math.sqrt(x.length)),C=Math.floor(b/2),y=[];for(let v=0;v<g;v++)for(let w=0;w<m;w++){const k=v*m+w;let S=0;for(let P=0;P<b;P++)for(let E=0;E<b;E++){const L=v+P-C,I=w+E-C;if(L>=0&&L<g&&I>=0&&I<m){const O=L*m+I,N=x[P*b+E];S+=f[O]*N}}y[k]=S===255*8?255:0}return y}function u(f,m,g){const x=[1,1,1,1,1,1,1,1,1],b=Math.round(Math.sqrt(x.length)),C=Math.floor(b/2),y=[];for(let v=0;v<g;v++)for(let w=0;w<m;w++){const k=v*m+w;let S=0;for(let P=0;P<b;P++)for(let E=0;E<b;E++){const L=v+P-C,I=w+E-C;if(L>=0&&L<g&&I>=0&&I<m){const O=L*m+I,N=x[P*b+E];S+=f[O]*N}}y[k]=S>=255*4?255:0}return y}function h(f,m,g){const x=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],b=Math.round(Math.sqrt(x.length)),C=Math.floor(b/2),y=[];for(let v=0;v<g;v++)for(let w=0;w<m;w++){const k=v*m+w;let S=0;for(let P=0;P<b;P++)for(let E=0;E<b;E++){const L=v+P-C,I=w+E-C;if(L>=0&&L<g&&I>=0&&I<m){const O=L*m+I,N=x[P*b+E];S+=f[O]*N}}y[k]=S}return y}const p=function(f){const m=this.threshold();let g=a(f,m);return g&&(g=d(g,f.width,f.height),g=u(g,f.width,f.height),g=h(g,f.width,f.height),l(f,g)),f};return Zh.Mask=p,e.Factory.addGetterSetter(t.Node,"threshold",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Zh}var Yh={},TA;function w0e(){if(TA)return Yh;TA=1,Object.defineProperty(Yh,"__esModule",{value:!0}),Yh.Noise=void 0;const e=It(),t=Nn(),n=Tt(),s=function(o){const r=this.noise()*255,a=o.data,l=a.length,d=r/2;for(let u=0;u<l;u+=4)a[u+0]+=d-2*d*Math.random(),a[u+1]+=d-2*d*Math.random(),a[u+2]+=d-2*d*Math.random()};return Yh.Noise=s,e.Factory.addGetterSetter(t.Node,"noise",.2,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Yh}var Xh={},AA;function S0e(){if(AA)return Xh;AA=1,Object.defineProperty(Xh,"__esModule",{value:!0}),Xh.Pixelate=void 0;const e=It(),t=En(),n=Nn(),s=Tt(),o=function(r){let a=Math.ceil(this.pixelSize()),l=r.width,d=r.height,u,h,p,f,m,g,x,b=Math.ceil(l/a),C=Math.ceil(d/a),y,v,w,k,S,P,E,L=r.data;if(a<=0){t.Util.error("pixelSize value can not be <= 0");return}for(S=0;S<b;S+=1)for(P=0;P<C;P+=1){for(f=0,m=0,g=0,x=0,y=S*a,v=y+a,w=P*a,k=w+a,E=0,u=y;u<v;u+=1)if(!(u>=l))for(h=w;h<k;h+=1)h>=d||(p=(l*h+u)*4,f+=L[p+0],m+=L[p+1],g+=L[p+2],x+=L[p+3],E+=1);for(f=f/E,m=m/E,g=g/E,x=x/E,u=y;u<v;u+=1)if(!(u>=l))for(h=w;h<k;h+=1)h>=d||(p=(l*h+u)*4,L[p+0]=f,L[p+1]=m,L[p+2]=g,L[p+3]=x)}};return Xh.Pixelate=o,e.Factory.addGetterSetter(n.Node,"pixelSize",8,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),Xh}var Qh={},MA;function k0e(){if(MA)return Qh;MA=1,Object.defineProperty(Qh,"__esModule",{value:!0}),Qh.Posterize=void 0;const e=It(),t=Nn(),n=Tt(),s=function(o){const r=Math.round(this.levels()*254)+1,a=o.data,l=a.length,d=255/r;for(let u=0;u<l;u+=1)a[u]=Math.floor(a[u]/d)*d};return Qh.Posterize=s,e.Factory.addGetterSetter(t.Node,"levels",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Qh}var Jh={},EA;function j0e(){if(EA)return Jh;EA=1,Object.defineProperty(Jh,"__esModule",{value:!0}),Jh.RGB=void 0;const e=It(),t=Nn(),n=Tt(),s=function(o){const r=o.data,a=r.length,l=this.red(),d=this.green(),u=this.blue();for(let h=0;h<a;h+=4){const p=(.34*r[h]+.5*r[h+1]+.16*r[h+2])/255;r[h]=p*l,r[h+1]=p*d,r[h+2]=p*u,r[h+3]=r[h+3]}};return Jh.RGB=s,e.Factory.addGetterSetter(t.Node,"red",0,function(o){return this._filterUpToDate=!1,o>255?255:o<0?0:Math.round(o)}),e.Factory.addGetterSetter(t.Node,"green",0,function(o){return this._filterUpToDate=!1,o>255?255:o<0?0:Math.round(o)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),Jh}var ep={},PA;function _0e(){if(PA)return ep;PA=1,Object.defineProperty(ep,"__esModule",{value:!0}),ep.RGBA=void 0;const e=It(),t=Nn(),n=Tt(),s=function(o){const r=o.data,a=r.length,l=this.red(),d=this.green(),u=this.blue(),h=this.alpha();for(let p=0;p<a;p+=4){const f=1-h;r[p]=l*h+r[p]*f,r[p+1]=d*h+r[p+1]*f,r[p+2]=u*h+r[p+2]*f}};return ep.RGBA=s,e.Factory.addGetterSetter(t.Node,"red",0,function(o){return this._filterUpToDate=!1,o>255?255:o<0?0:Math.round(o)}),e.Factory.addGetterSetter(t.Node,"green",0,function(o){return this._filterUpToDate=!1,o>255?255:o<0?0:Math.round(o)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"alpha",1,function(o){return this._filterUpToDate=!1,o>1?1:o<0?0:o}),ep}var tp={},LA;function I0e(){if(LA)return tp;LA=1,Object.defineProperty(tp,"__esModule",{value:!0}),tp.Sepia=void 0;const e=function(t){const n=t.data,s=n.length;for(let o=0;o<s;o+=4){const r=n[o+0],a=n[o+1],l=n[o+2];n[o+0]=Math.min(255,r*.393+a*.769+l*.189),n[o+1]=Math.min(255,r*.349+a*.686+l*.168),n[o+2]=Math.min(255,r*.272+a*.534+l*.131)}};return tp.Sepia=e,tp}var np={},DA;function T0e(){if(DA)return np;DA=1,Object.defineProperty(np,"__esModule",{value:!0}),np.Solarize=void 0;const e=function(t){const n=t.data,s=t.width,o=t.height,r=s*4;let a=o;do{const l=(a-1)*r;let d=s;do{const u=l+(d-1)*4;let h=n[u],p=n[u+1],f=n[u+2];h>127&&(h=255-h),p>127&&(p=255-p),f>127&&(f=255-f),n[u]=h,n[u+1]=p,n[u+2]=f}while(--d)}while(--a)};return np.Solarize=e,np}var sp={},RA;function A0e(){if(RA)return sp;RA=1,Object.defineProperty(sp,"__esModule",{value:!0}),sp.Threshold=void 0;const e=It(),t=Nn(),n=Tt(),s=function(o){const r=this.threshold()*255,a=o.data,l=a.length;for(let d=0;d<l;d+=1)a[d]=a[d]<r?0:255};return sp.Threshold=s,e.Factory.addGetterSetter(t.Node,"threshold",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),sp}var OA;function M0e(){if(OA)return xh;OA=1,Object.defineProperty(xh,"__esModule",{value:!0}),xh.Konva=void 0;const e=Yge(),t=Xge(),n=Jge(),s=e0e(),o=t0e(),r=n0e(),a=s0e(),l=uO(),d=Oj(),u=hO(),h=i0e(),p=o0e(),f=r0e(),m=a0e(),g=pO(),x=l0e(),b=c0e(),C=d0e(),y=u0e(),v=h0e(),w=p0e(),k=f0e(),S=m0e(),P=g0e(),E=x0e(),L=y0e(),I=b0e(),O=v0e(),N=C0e(),_=w0e(),R=S0e(),D=k0e(),B=j0e(),V=_0e(),ee=I0e(),se=T0e(),oe=A0e();return xh.Konva=e.Konva.Util._assign(e.Konva,{Arc:t.Arc,Arrow:n.Arrow,Circle:s.Circle,Ellipse:o.Ellipse,Image:r.Image,Label:a.Label,Tag:a.Tag,Line:l.Line,Path:d.Path,Rect:u.Rect,RegularPolygon:h.RegularPolygon,Ring:p.Ring,Sprite:f.Sprite,Star:m.Star,Text:g.Text,TextPath:x.TextPath,Transformer:b.Transformer,Wedge:C.Wedge,Filters:{Blur:y.Blur,Brighten:v.Brighten,Contrast:w.Contrast,Emboss:k.Emboss,Enhance:S.Enhance,Grayscale:P.Grayscale,HSL:E.HSL,HSV:L.HSV,Invert:I.Invert,Kaleidoscope:O.Kaleidoscope,Mask:N.Mask,Noise:_.Noise,Pixelate:R.Pixelate,Posterize:D.Posterize,RGB:B.RGB,RGBA:V.RGBA,Sepia:ee.Sepia,Solarize:se.Solarize,Threshold:oe.Threshold}}),xh}var E0e=L0.exports,NA;function P0e(){if(NA)return L0.exports;NA=1,Object.defineProperty(E0e,"__esModule",{value:!0});const e=M0e();return L0.exports=e.Konva,L0.exports}var L0e=P0e();const Re=hu(L0e),D0e={RECT_CALC_DEBOUNCE_MS:300,ANCHOR_HIT_PADDING:10,OUTLINE_PADDING:0,OUTLINE_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_FILL_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_STROKE_COLOR:"hsl(200 76% 77% / 1)",SCALE_ANCHOR_CORNER_RADIUS_RATIO:.5,SCALE_ANCHOR_STROKE_WIDTH:2,SCALE_ANCHOR_SIZE:8,ROTATE_ANCHOR_FILL_COLOR:"hsl(200 76% 95% / 1)",ROTATE_ANCHOR_STROKE_COLOR:"hsl(200 76% 40% / 1)",ROTATE_ANCHOR_SIZE:12},Fr=class Fr extends Ut{constructor(n){super();j(this,"type","entity_transformer");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"config",D0e);j(this,"$nodeRect",Le(ga()));j(this,"$pixelRect",Le(ga()));j(this,"$isPendingRectCalculation",Le(!1));j(this,"subscriptions",new Set);j(this,"$isTransforming",Le(!1));j(this,"$interactionMode",Le("off"));j(this,"$isDragEnabled",Le(!1));j(this,"$isTransformEnabled",Le(!1));j(this,"$isProcessing",Le(!1));j(this,"$silentTransform",Le(!1));j(this,"transformMutex",new Pj);j(this,"konva");j(this,"initialize",()=>{this.log.debug("Initializing module"),this.syncInteractionState()});j(this,"syncCursorStyle",()=>{this.parent.renderer.hasObjects()?this.manager.stage.setCursor("default"):this.manager.stage.setCursor("not-allowed")});j(this,"anchorStyleFunc",n=>{n.hasName("rotater")&&n.setAttrs({height:this.config.ROTATE_ANCHOR_SIZE,width:this.config.ROTATE_ANCHOR_SIZE,cornerRadius:this.config.ROTATE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,fill:this.config.ROTATE_ANCHOR_FILL_COLOR,stroke:this.config.SCALE_ANCHOR_FILL_COLOR,offsetX:this.config.ROTATE_ANCHOR_SIZE/2,offsetY:this.config.ROTATE_ANCHOR_SIZE/2}),n.hitFunc(s=>{s.beginPath(),s.rect(-this.config.ANCHOR_HIT_PADDING,-this.config.ANCHOR_HIT_PADDING,n.width()+this.config.ANCHOR_HIT_PADDING*2,n.height()+this.config.ANCHOR_HIT_PADDING*2),s.closePath(),s.fillStrokeShape(n)})});j(this,"anchorDragBoundFunc",(n,s)=>{if(this.konva.transformer.getActiveAnchor()==="rotater")return s;const o=this.manager.stateApi.$shiftKey.get()?this.manager.stateApi.getPositionGridSize():1,r=this.manager.stage.getScale(),a=this.manager.stage.getPosition(),l=Yi(s.x/r,o),d=Yi(s.y/r,o),u=a.x%(r*o),h=a.y%(r*o),p=l*r+u,f=d*r+h;return{x:p,y:f}});j(this,"boxBoundFunc",(n,s)=>this.konva.transformer.getActiveAnchor()!=="rotater"?s:this.manager.stateApi.$shiftKey.get()&&Math.abs(s.rotation%(Math.PI/4))>0?n:s);j(this,"snapProxyRectToPixelGrid",()=>{const n=this.konva.proxyRect.x(),s=this.konva.proxyRect.y(),o=Math.round(n),r=Math.round(s),a=this.konva.proxyRect.width(),l=this.konva.proxyRect.height(),d=this.konva.proxyRect.scaleX(),u=this.konva.proxyRect.scaleY(),h=Math.max(Math.abs(Math.round(a*d)),1),p=Math.max(Math.abs(Math.round(l*u)),1),f=h/a*Math.sign(d),m=p/l*Math.sign(u);this.konva.proxyRect.setAttrs({x:o,y:r,scaleX:f,scaleY:m}),this.syncObjectGroupWithProxyRect()});j(this,"fitToBboxFill",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=n.width/this.konva.proxyRect.width(),o=n.height/this.konva.proxyRect.height();this.konva.proxyRect.setAttrs({x:n.x,y:n.y,scaleX:s,scaleY:o,rotation:0}),this.syncObjectGroupWithProxyRect()});j(this,"fitToBboxContain",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getPositionGridSize(),o=this.konva.proxyRect.width(),r=this.konva.proxyRect.height(),a=n.width/o,l=n.height/r,d=Math.min(a,l),u=(n.width-o*d)/2,h=(n.height-r*d)/2;this.konva.proxyRect.setAttrs({x:pr(Yi(n.x+u,s),n.x,n.x+n.width),y:pr(Yi(n.y+h,s),n.y,n.y+n.height),scaleX:d,scaleY:d,rotation:0}),this.syncObjectGroupWithProxyRect()});j(this,"fitToBboxCover",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getPositionGridSize(),o=this.konva.proxyRect.width(),r=this.konva.proxyRect.height(),a=n.width/o,l=n.height/r,d=Math.max(a,l),u=(n.width-o*d)/2,h=(n.height-r*d)/2;this.konva.proxyRect.setAttrs({x:Yi(n.x+u,s),y:Yi(n.y+h,s),scaleX:d,scaleY:d,rotation:0}),this.syncObjectGroupWithProxyRect()});j(this,"onDragMove",()=>{const n=this.manager.stateApi.getPositionGridSize();this.konva.proxyRect.x(Yi(this.konva.proxyRect.x(),n)),this.konva.proxyRect.y(Yi(this.konva.proxyRect.y(),n));const s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s}),this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y()})});j(this,"onDragEnd",()=>{if(this.$isTransforming.get())return;const n=this.$pixelRect.get(),s={x:this.konva.proxyRect.x()-n.x,y:this.konva.proxyRect.y()-n.y};this.log.trace({position:s},"Position changed"),this.manager.stateApi.setEntityPosition({entityIdentifier:this.parent.entityIdentifier,position:s})});j(this,"nudgeBy",n=>{const s=this.konva.proxyRect.position(),o=ir(s,n);this.konva.proxyRect.setAttrs(o),this.syncObjectGroupWithProxyRect(),this.manager.stateApi.moveEntityBy({entityIdentifier:this.parent.entityIdentifier,offset:n}),this.log.trace({offset:n},"Nudged")});j(this,"syncObjectGroupWithProxyRect",()=>{this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y(),scaleX:this.konva.proxyRect.scaleX(),scaleY:this.konva.proxyRect.scaleY(),rotation:this.konva.proxyRect.rotation()})});j(this,"update",(n,s)=>{const o=this.manager.stage.unscale(1),r=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:n.x+s.x-r,y:n.y+s.y-r,width:s.width+r*2,height:s.height+r*2,strokeWidth:o}),this.konva.proxyRect.setAttrs({x:n.x+s.x,y:n.y+s.y,width:s.width,height:s.height})});j(this,"syncInteractionState",()=>{var a,l;if(this.log.trace("Syncing interaction state"),this.manager.stagingArea.$isStaging.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if((a=this.parent.segmentAnything)!=null&&a.$isSegmenting.get()){this.parent.konva.layer.listening(!0),this._setInteractionMode("off");return}if((l=this.parent.filterer)!=null&&l.$isFiltering.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.manager.stateApi.$isTransforming.get()&&!this.$isTransforming.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const n=this.$pixelRect.get();if(this.$isPendingRectCalculation.get()||n.width===0||n.height===0){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const o=this.manager.tool.$tool.get();if(!this.manager.stateApi.getIsSelected(this.parent.id)){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isEmpty.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isLocked.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(!this.$isTransforming.get()&&o==="move"){this.parent.konva.layer.listening(!0),this._setInteractionMode("drag");return}if(this.$isTransforming.get()){o==="view"?(this.parent.konva.layer.listening(!1),this._setInteractionMode("off")):(this.parent.konva.layer.listening(!0),this._setInteractionMode("all"));return}this.parent.konva.layer.listening(!1),this._setInteractionMode("off")});j(this,"syncScale",()=>{const n=this.manager.stage.unscale(1),s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s,width:this.konva.proxyRect.width()*this.konva.proxyRect.scaleX()+s*2,height:this.konva.proxyRect.height()*this.konva.proxyRect.scaleY()+s*2,strokeWidth:n}),this.konva.transformer.forceUpdate()});j(this,"startTransform",async n=>{const s=this.manager.stateApi.$transformingAdapter.get();s&&ve(!1,`Already transforming an entity: ${s.id}`),await this.transformMutex.acquire(),this.log.debug("Starting transform");const{silent:o}={silent:!1,...n};this.$silentTransform.set(o),this.$isTransforming.set(!0),this.manager.stateApi.$transformingAdapter.set(this.parent),this.syncInteractionState()});j(this,"applyTransform",async()=>{if(!this.$isTransforming.get()){this.log.warn("Cannot apply transform when not transforming. Did you forget to call `await adapter.transformer.startTransform()`?");return}this.log.debug("Applying transform"),this.$isProcessing.set(!0),this._setInteractionMode("off");const n=this.getRelativeRect(),s=await Zn(()=>this.parent.renderer.rasterize({rect:jJ(n),replaceObjects:!0,ignoreCache:!0,attrs:{opacity:1,filters:[]}}));s.isErr()&&(ge({status:"error",title:"Failed to apply transform"}),this.log.error({error:$n(s.error)},"Failed to rasterize entity")),this.requestRectCalculation(),this.stopTransform()});j(this,"resetTransform",()=>{this.resetScale(),this.updatePosition(),this.updateBbox()});j(this,"stopTransform",()=>{this.log.debug("Stopping transform"),this.$isTransforming.set(!1),this.resetTransform(),this.syncInteractionState(),this.manager.stateApi.$transformingAdapter.set(null),this.$isProcessing.set(!1),this.transformMutex.release()});j(this,"resetScale",()=>{const n={scaleX:1,scaleY:1,rotation:0};this.parent.renderer.konva.objectGroup.setAttrs(n),this.parent.bufferRenderer.konva.group.setAttrs(n),this.konva.outlineRect.setAttrs(n),this.konva.proxyRect.setAttrs(n)});j(this,"updatePosition",n=>{this.log.trace("Updating position");const s=tP(n,"position",this.parent.state.position),o=this.$pixelRect.get(),r={x:s.x+o.x,y:s.y+o.y,offsetX:o.x,offsetY:o.y};this.parent.renderer.konva.objectGroup.setAttrs(r),this.parent.bufferRenderer.konva.group.setAttrs(r),this.update(s,o)});j(this,"_setInteractionMode",n=>{this.$interactionMode.set(n),n==="drag"?(this._enableDrag(),this._disableTransform(),this._showBboxOutline()):n==="all"?(this._enableDrag(),this._enableTransform(),this._hideBboxOutline()):n==="off"&&(this._disableDrag(),this._disableTransform(),this._hideBboxOutline())});j(this,"updateBbox",()=>{const n=this.$nodeRect.get(),s=this.$pixelRect.get();if(this.log.trace({nodeRect:n,pixelRect:s},"Updating bbox"),this.$isPendingRectCalculation.get()){this.syncInteractionState();return}if(s.width===0||s.height===0)this.parent.renderer.hasObjects()&&(this.manager.stateApi.resetEntity({entityIdentifier:this.parent.entityIdentifier}),this.syncInteractionState());else{this.syncInteractionState(),this.update(this.parent.state.position,s);const o={x:this.parent.state.position.x+s.x,y:this.parent.state.position.y+s.y,offsetX:s.x,offsetY:s.y};this.parent.renderer.konva.objectGroup.setAttrs(o),this.parent.bufferRenderer.konva.group.setAttrs(o)}Fr.runBboxUpdatedCallbacks(this.parent)});j(this,"calculateRect",Di(()=>{this.log.debug("Calculating bbox");const n=AS(()=>this.parent.getCanvas());if(n.isErr()){this.log.error({error:$n(n.error)},"Failed to get canvas, resetting bbox"),this.$nodeRect.set(ga()),this.$pixelRect.set(ga()),this.$isPendingRectCalculation.set(!1),this.transformMutex.release();return}const s=n.value;if(!this.parent.renderer.hasObjects()){this.log.trace("No objects, resetting bbox"),this.$nodeRect.set(ga()),this.$pixelRect.set(ga()),this.parent.$canvasCache.set(s),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const o=this.parent.renderer.konva.objectGroup.getClientRect({skipTransform:!0});if(!this.parent.renderer.needsPixelBbox()){this.$nodeRect.set({...o}),this.$pixelRect.set({...o}),this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get()},"Got bbox from client rect"),this.parent.$canvasCache.set(s),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const r=nP(s);this.manager.worker.requestBbox({buffer:r.data.buffer,width:r.width,height:r.height},a=>{if(a){const{minX:l,minY:d,maxX:u,maxY:h}=a;this.$nodeRect.set({...o}),this.$pixelRect.set({x:Math.round(o.x)+l,y:Math.round(o.y)+d,width:u-l,height:h-d})}else this.$nodeRect.set(ga()),this.$pixelRect.set(ga());this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get(),extents:a},"Got bbox from worker"),this.parent.$canvasCache.set(s),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release()})},this.config.RECT_CALC_DEBOUNCE_MS));j(this,"requestRectCalculation",async()=>{await this.transformMutex.acquire(),this.$isPendingRectCalculation.set(!0),this.syncInteractionState(),this.calculateRect()});j(this,"getRelativeRect",()=>this.konva.proxyRect.getClientRect({relativeTo:this.parent.konva.layer}));j(this,"_enableTransform",()=>{this.$isTransformEnabled.set(!0),this.konva.transformer.visible(!0),this.konva.transformer.listening(!0),this.konva.transformer.nodes([this.konva.proxyRect])});j(this,"_disableTransform",()=>{this.$isTransformEnabled.set(!1),this.konva.transformer.visible(!1),this.konva.transformer.listening(!1),this.konva.transformer.nodes([])});j(this,"_enableDrag",()=>{this.$isDragEnabled.set(!0),this.konva.proxyRect.visible(!0),this.konva.proxyRect.listening(!0)});j(this,"_disableDrag",()=>{this.$isDragEnabled.set(!1),this.konva.proxyRect.visible(!1),this.konva.proxyRect.listening(!1)});j(this,"_showBboxOutline",()=>{this.konva.outlineRect.visible(!0)});j(this,"_hideBboxOutline",()=>{this.konva.outlineRect.visible(!1)});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$nodeRect:this.$nodeRect.get(),$pixelRect:this.$pixelRect.get(),$isPendingRectCalculation:this.$isPendingRectCalculation.get(),$isTransforming:this.$isTransforming.get(),$interactionMode:this.$interactionMode.get(),$isDragEnabled:this.$isDragEnabled.get(),$isTransformEnabled:this.$isTransformEnabled.get(),$isProcessing:this.$isProcessing.get(),konva:{transformer:xs(this.konva.transformer),proxyRect:xs(this.konva.proxyRect),outlineRect:xs(this.konva.outlineRect)}}));j(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.outlineRect.destroy(),this.konva.transformer.destroy(),this.konva.proxyRect.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={outlineRect:new Re.Rect({listening:!1,draggable:!1,name:`${this.type}:outline_rect`,stroke:this.config.OUTLINE_COLOR,perfectDrawEnabled:!1,hitStrokeWidth:0}),transformer:new Re.Transformer({name:`${this.type}:transformer`,visible:!1,listening:!1,rotateEnabled:!0,flipEnabled:!0,keepRatio:!0,shiftBehavior:"inverted",padding:this.config.OUTLINE_PADDING,stroke:this.config.OUTLINE_COLOR,anchorFill:this.config.SCALE_ANCHOR_FILL_COLOR,anchorStroke:this.config.SCALE_ANCHOR_STROKE_COLOR,anchorStrokeWidth:this.config.SCALE_ANCHOR_STROKE_WIDTH,anchorSize:this.config.SCALE_ANCHOR_SIZE,anchorCornerRadius:this.config.SCALE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc,boundBoxFunc:this.boxBoundFunc}),proxyRect:new Re.Rect({name:`${this.type}:proxy_rect`,listening:!1,draggable:!0})},this.konva.transformer.on("transform",this.syncObjectGroupWithProxyRect),this.konva.transformer.on("transformend",this.snapProxyRectToPixelGrid),this.konva.transformer.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.transformer.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("dragend",this.onDragEnd),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.subscriptions.add(()=>{this.konva.transformer.off("transform transformend pointerenter pointerleave"),this.konva.proxyRect.off("dragmove dragend pointerenter pointerleave")}),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,o)=>{s.scale!==o.scale&&this.syncScale()})),this.subscriptions.add(this.manager.stateApi.$shiftKey.listen(s=>{this.konva.transformer.rotationSnaps(s?[0,45,90,135,180,225,270,315]:[])})),this.subscriptions.add(this.manager.tool.$tool.listen(this.syncInteractionState)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Mn,this.syncInteractionState)),this.subscriptions.add(this.manager.$isBusy.listen(this.syncInteractionState)),this.parent.konva.layer.add(this.konva.outlineRect),this.parent.konva.layer.add(this.konva.proxyRect),this.parent.konva.layer.add(this.konva.transformer)}};j(Fr,"bboxUpdatedCallbacks",new Set),j(Fr,"registerBboxUpdatedCallback",n=>{const s=async o=>{const r=await n(o);return r&&Fr.bboxUpdatedCallbacks.delete(s),r};Fr.bboxUpdatedCallbacks.add(s)}),j(Fr,"runBboxUpdatedCallbacks",n=>{for(const s of Fr.bboxUpdatedCallbacks)s(n)});let ac=Fr;const fO=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s}=e;s(MS({entityIdentifier:n,imageDTO:t}))},mO=e=>{const{imageDTO:t,entityIdentifier:n,referenceImageId:s,dispatch:o}=e;o(ES({entityIdentifier:n,referenceImageId:s,imageDTO:t}))},R0e=e=>{const{imageDTO:t,dispatch:n}=e;n(X0(t))},O0e=e=>{const{imageDTO:t,fieldIdentifier:n,dispatch:s}=e;s(Z2({...n,value:t}))},N0e=e=>{const{imageDTO:t,dispatch:n}=e;n(Qf(t))},Qi=e=>{const{type:t,imageDTO:n,dispatch:s,getState:o,overrides:r}=e,a=o(),l=ao(n),{x:d,y:u}=Fx(a),h={objects:[l],position:{x:d,y:u},...r};switch(t){case"raster_layer":{s(vu({overrides:h,isSelected:!0}));break}case"control_layer":{s(Xf({overrides:{...h,controlAdapter:gt(kc)},isSelected:!0}));break}case"inpaint_mask":{s(Ox({overrides:h,isSelected:!0}));break}case"regional_guidance":{s(Ka({overrides:h,isSelected:!0}));break}case"reference_image":{const p=gt(Vy(o()));p.image=ic(n),s(Nx({overrides:{ipAdapter:p},isSelected:!0}));break}case"regional_guidance_with_reference_image":{const p=gt(Em(o()));p.image=ic(n);const f=[{id:Te("regional_guidance_reference_image"),ipAdapter:p}];s(Ka({overrides:{referenceImages:f},isSelected:!0}));break}}},Lg=async e=>{const{type:t,imageDTO:n,withResize:s=!1,dispatch:o,getState:r}=e,a=r(),l=_J(a),d=n.width/n.height,u=sP(l),{width:h,height:p}=IJ(d,u**2,l);let f;if(s&&(h!==n.width||p!==n.height)){const g=await er({file:await bd(n),image_category:"general",is_intermediate:!0,silent:!0,resize_to:{width:h,height:p}});f=ao(g)}else f=ao(n);const m=g=>{ac.registerBboxUpdatedCallback(x=>x.id!==g?Promise.resolve(!1):(x.manager.stage.fitBboxAndLayersToStage(),Promise.resolve(!0)))};switch(t){case"raster_layer":{const g={id:Te("raster_layer"),objects:[f]};m(g.id),o(Hc()),o(wp({x:0,y:0,width:h,height:p})),o(vu({overrides:g,isSelected:!0}));break}case"control_layer":{const g={id:Te("control_layer"),objects:[f],controlAdapter:gt(kc)};m(g.id),o(Hc()),o(wp({x:0,y:0,width:h,height:p})),o(Xf({overrides:g,isSelected:!0}));break}case"inpaint_mask":{const g={id:Te("inpaint_mask"),objects:[f]};m(g.id),o(Hc()),o(wp({x:0,y:0,width:h,height:p})),o(Ox({overrides:g,isSelected:!0}));break}case"regional_guidance":{const g={id:Te("regional_guidance"),objects:[f]};m(g.id),o(Hc()),o(wp({x:0,y:0,width:h,height:p})),o(Ka({overrides:g,isSelected:!0}));break}case"reference_image":{const g=gt(Vy(r()));g.image=ic(n),o(Hc()),o(Nx({overrides:{ipAdapter:g},isSelected:!0}));break}case"regional_guidance_with_reference_image":{const g=gt(Em(r()));g.image=ic(n);const x=[{id:Te("regional_guidance_reference_image"),ipAdapter:g}];o(Hc()),o(Ka({overrides:{referenceImages:x},isSelected:!0}));break}default:ve(!1)}},Nj=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s,getState:o}=e,r=ao(t),{x:a,y:l}=Fx(o());s(PS({entityIdentifier:n,imageObject:r,position:{x:a,y:l},replaceObjects:!0,isSelected:!0}))},FA=e=>{const{imageDTOs:t,boardId:n,dispatch:s}=e;s(IS.endpoints.addImagesToBoard.initiate({imageDTOs:t,board_id:n},{track:!1})),s(Bx([]))},BA=e=>{const{imageDTOs:t,dispatch:n}=e;n(IS.endpoints.removeImagesFromBoard.initiate({imageDTOs:t},{track:!1})),n(Bx([]))},Fj=Le(null),F0e=e=>Fj.set(e),Mv=()=>Fj.set(null),gO=c.memo(()=>{Pt("CanvasPasteModal");const{dispatch:e,getState:t}=cn(),{t:n}=M(),s=re(Fj),o=Lt(),r=A(qs),[a,{isLoading:l}]=iP({fixedCacheKey:"canvasPasteModal"}),d=c.useCallback(m=>{const{x:g,y:x}=o.stateApi.getBbox().rect;if(m==="bbox")return{x:g,y:x};const b=o.compositor.getVisibleAdaptersOfType("raster_layer");if(b.length===0)return{x:g,y:x};{const{x:C,y}=o.compositor.getRectOfAdapters(b);return{x:C,y}}},[o.compositor,o.stateApi]),u=c.useCallback(async(m,g)=>{try{const b=await a({file:m,is_intermediate:g!=="assets",image_category:"user",board_id:r==="none"?void 0:r}).unwrap();g!=="assets"&&Qi({type:"raster_layer",imageDTO:b,dispatch:e,getState:t,overrides:{position:d(g)}})}catch{ge({title:n("toast.pasteFailed"),status:"error"})}finally{Mv(),ge({title:n("toast.pasteSuccess",{destination:n(g==="assets"?"controlLayers.pasteToAssets":g==="bbox"?"controlLayers.pasteToBbox":"controlLayers.pasteToCanvas")}),status:"success"})}},[r,e,d,t,n,a]),h=c.useCallback(()=>{s&&u(s,"assets")},[u,s]),p=c.useCallback(()=>{s&&u(s,"canvas")},[u,s]),f=c.useCallback(()=>{s&&u(s,"bbox")},[u,s]);return i.jsxs(Oi,{isOpen:s!==null,onClose:Mv,useInert:!1,isCentered:!0,size:"2xl",children:[i.jsx(di,{}),i.jsxs(Ni,{children:[i.jsx(ui,{children:n("controlLayers.pasteTo")}),i.jsx(Do,{}),i.jsx(Ks,{display:"flex",justifyContent:"center",children:i.jsxs(T,{flexDir:"column",gap:4,w:"min-content",children:[i.jsx(de,{size:"lg",onClick:p,isDisabled:l,leftIcon:i.jsx(su,{}),children:n("controlLayers.pasteToCanvasDesc")}),i.jsx(de,{size:"lg",onClick:f,isDisabled:l,leftIcon:i.jsx(pl,{}),children:n("controlLayers.pasteToBboxDesc")}),i.jsx(de,{size:"lg",onClick:h,isDisabled:l,variant:"ghost",children:n("controlLayers.pasteToAssetsDesc")})]})}),i.jsx(wr,{children:i.jsx(de,{onClick:Mv,variant:"ghost",isLoading:l,children:n("common.cancel")})})]})]})});gO.displayName="CanvasPasteModal";const[xO]=jc(!1),[yO]=jc(!1),bO=()=>{const e=G(),t=$t(),n=A(Jf),s=xO(),o=c.useCallback(()=>{e(TJ()),t.open(),e(ji("gallery"))},[e,t]),r=c.useCallback(()=>{if(n){s.setTrue();return}o()},[o,s,n]);return{newGallerySessionImmediate:o,newGallerySessionWithDialog:r}},vO=()=>{const e=G(),t=$t(),n=A(Jf),s=yO(),o=c.useCallback(()=>{e(AJ()),t.close(),e(ji("layers"))},[e,t]),r=c.useCallback(()=>{if(n){s.setTrue();return}o()},[o,s,n]);return{newCanvasSessionImmediate:o,newCanvasSessionWithDialog:r}},CO=c.memo(()=>{Pt("NewGallerySessionDialog");const{t:e}=M(),t=G(),n=xO(),{newGallerySessionImmediate:s}=bO(),o=A(Jf),r=c.useCallback(()=>{t(LS())},[t]);return i.jsx(ho,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newGallerySession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:i.jsxs(T,{direction:"column",gap:3,children:[i.jsx(W,{children:e("controlLayers.newGallerySessionDesc")}),i.jsx(W,{children:e("common.areYouSure")}),i.jsxs(Q,{children:[i.jsx(J,{children:e("common.dontAskMeAgain")}),i.jsx(_n,{isChecked:!o,onChange:r})]})]})})});CO.displayName="NewGallerySessionDialog";const wO=c.memo(()=>{Pt("NewCanvasSessionDialog");const{t:e}=M(),t=G(),n=yO(),{newCanvasSessionImmediate:s}=vO(),o=A(Jf),r=c.useCallback(()=>{t(LS())},[t]);return i.jsx(ho,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newCanvasSession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:i.jsxs(T,{direction:"column",gap:3,children:[i.jsx(W,{children:e("controlLayers.newCanvasSessionDesc")}),i.jsx(W,{children:e("common.areYouSure")}),i.jsxs(Q,{children:[i.jsx(J,{children:e("common.dontAskMeAgain")}),i.jsx(_n,{isChecked:!o,onChange:r})]})]})})});wO.displayName="NewCanvasSessionDialog";const B0e=e=>{const{t}=M(),{imageUsage:n,topMessage:s=t("gallery.currentlyInUse"),bottomMessage:o=t("gallery.featuresWillReset")}=e;return!n||!As(n)?null:i.jsxs(i.Fragment,{children:[i.jsx(W,{children:s}),i.jsxs(ai,{paddingInlineStart:6,fontSize:"sm",children:[n.isControlLayerImage&&i.jsx(Ft,{children:t("controlLayers.controlLayer")}),n.isReferenceImage&&i.jsx(Ft,{children:t("controlLayers.referenceImage")}),n.isInpaintMaskImage&&i.jsx(Ft,{children:t("controlLayers.inpaintMask")}),n.isRasterLayerImage&&i.jsx(Ft,{children:t("controlLayers.rasterLayer")}),n.isRegionalGuidanceImage&&i.jsx(Ft,{children:t("controlLayers.regionalGuidance")}),n.isUpscaleImage&&i.jsx(Ft,{children:t("ui.tabs.upscalingTab")}),n.isNodesImage&&i.jsx(Ft,{children:t("ui.tabs.workflowsTab")})]}),i.jsx(W,{children:o})]})},SO=c.memo(B0e),$0e=fn([rP,Xe,Ye,PJ,Gf],(e,t,n,s,o)=>{const{imagesToDelete:r}=e,a=(r??[]).map(({image_name:d})=>aP(t,n,o,d)),l={isUpscaleImage:As(a,d=>d.isUpscaleImage),isRasterLayerImage:As(a,d=>d.isRasterLayerImage),isInpaintMaskImage:As(a,d=>d.isInpaintMaskImage),isRegionalGuidanceImage:As(a,d=>d.isRegionalGuidanceImage),isNodesImage:As(a,d=>d.isNodesImage),isControlLayerImage:As(a,d=>d.isControlLayerImage),isReferenceImage:As(a,d=>d.isReferenceImage)};return{imagesToDelete:r,imagesUsage:s,imageUsageSummary:l}}),V0e=he(Dx,e=>e.shouldConfirmOnDelete),z0e=he(rP,e=>e.isModalOpen),G0e=()=>{Pt("DeleteImageModal");const e=G(),{t}=M(),n=A(V0e),s=A(z0e),{imagesToDelete:o,imagesUsage:r,imageUsageSummary:a}=A($0e),l=c.useCallback(h=>e(oP(!h.target.checked)),[e]),d=c.useCallback(()=>{e(A4()),e(MJ(!1))},[e]),u=c.useCallback(()=>{!o.length||!r.length||(e(A4()),e(EJ({imageDTOs:o,imagesUsage:r})))},[e,o,r]);return i.jsx(ho,{title:t("gallery.deleteImage",{count:o.length}),isOpen:s,onClose:d,cancelButtonText:t("common.cancel"),acceptButtonText:t("common.delete"),acceptCallback:u,useInert:!1,children:i.jsxs(T,{direction:"column",gap:3,children:[i.jsx(SO,{imageUsage:a}),i.jsx(Ct,{}),i.jsx(W,{children:t("gallery.deleteImagePermanent")}),i.jsx(W,{children:t("common.areYouSure")}),i.jsxs(Q,{children:[i.jsx(J,{children:t("common.dontAskMeAgain")}),i.jsx(et,{isChecked:!n,onChange:l})]})]})})},H0e=c.memo(G0e);function $A(e){var t=e.source;return t.types.includes("Files")}function W0e(e){var t=e.source;return t.items.filter(function(n){return n.kind==="file"}).map(function(n){return n.getAsFile()}).filter(function(n){return n!=null})}function VA(e){e.defaultPrevented||(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.preventDefault())}var XC=null;function U0e(){Ip(),XC=gr.bindAll(window,[{type:"dragover",listener:VA},{type:"dragenter",listener:VA},{type:"drop",listener:function(t){t.preventDefault(),Ip()}},{type:"dragend",listener:Ip}].concat(hy(Bk({onDragEnd:Ip}))),{capture:!1})}function Ip(){var e;(e=XC)===null||e===void 0||e(),XC=null}function q0e(){var e;if(((e=window.event)===null||e===void 0?void 0:e.type)==="drop"){var t;(t=window.event)===null||t===void 0||t.preventDefault()}Ip()}var zA={start:U0e,stop:q0e};const K0e=e=>typeof e=="object"&&e!==null&&"fullUrl"in e&&"thumbnailUrl"in e,kO=()=>{const e=G(),t=A(qs),n=re(bu),[s]=LJ();return c.useCallback(async(r,a)=>{const l=new Image,d=URL.createObjectURL(r);l.src=d;let u=0,h=0,p;await new Promise(C=>{l.onload=()=>{u=l.naturalWidth,h=l.naturalHeight;let y=u,v=h;u>h&&u>256?(y=256,v=Math.round(h*256/u)):h>256&&(v=256,y=Math.round(u*256/h));const w=document.createElement("canvas");w.width=y,w.height=v;const k=w.getContext("2d");k==null||k.drawImage(l,0,0,y,v),w.toBlob(S=>{S&&(p=S,URL.revokeObjectURL(d),l.src="",l.remove(),w.width=0,w.height=0,C())},"image/webp",.8)},l.onerror=()=>{URL.revokeObjectURL(d),l.remove(),C()}});const{presigned_url:f,image_dto:m}=await s({width:u,height:h,board_id:t==="none"?void 0:t}).unwrap(),g=await fetch(f,{method:"GET",...n&&{headers:{Authorization:`Bearer ${n}`}}}).then(C=>C.json());if(!K0e(g))throw new Error("Invalid response");const x=g.fullUrl,b=g.thumbnailUrl;return await fetch(x,{method:"PUT",body:r}),await fetch(b,{method:"PUT",body:p}),e(DJ({imageDTO:m,silent:!1,isFirstUploadOfBatch:a===0})),m},[t,n,s,e])},Z0e={position:"absolute",top:0,right:0,bottom:0,left:0,color:"base.300",borderColor:"base.300",transitionProperty:"common",transitionDuration:"0.1s",".dnd-drop-overlay-backdrop":{position:"absolute",top:0,right:0,bottom:0,left:0,bg:"base.900",opacity:.7,borderRadius:"base",alignItems:"center",justifyContent:"center",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-content":{position:"absolute",top:.5,right:.5,bottom:.5,left:.5,opacity:1,borderWidth:1.5,borderRadius:"base",borderStyle:"dashed",alignItems:"center",justifyContent:"center",borderColor:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-label":{fontSize:"lg",fontWeight:"semibold",textAlign:"center",color:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},'&[data-dnd-state="over"]':{color:"invokeYellow.300",borderColor:"invokeYellow.300"}},yf=c.memo(e=>{const{dndState:t,label:n,withBackdrop:s=!0}=e;return t==="idle"?null:i.jsxs(T,{className:"dnd-drop-overlay","data-dnd-state":t,sx:Z0e,children:[s&&i.jsx(T,{className:"dnd-drop-overlay-backdrop"}),i.jsxs(T,{className:"dnd-drop-overlay-content",children:[sf(n)&&i.jsx(W,{className:"dnd-drop-overlay-label",children:n}),!He(n)&&!sf(n)&&n]})]})});yf.displayName="DndDropOverlay";const Pm=e=>{const{boardName:t}=vc({include_archived:!0},{selectFromResult:({data:n})=>{const s=n==null?void 0:n.find(r=>r.board_id===e);return{boardName:(s==null?void 0:s.board_name)||Me("boards.uncategorized")}}});return t},Y0e=["image/png","image/jpg","image/jpeg","image/webp"],X0e=[".png",".jpg",".jpeg",".webp"],Q0e=Ve.custom().refine(e=>Y0e.includes(e.type),e=>({message:`File type ${e.type} is not supported`})).refine(e=>X0e.some(t=>e.name.endsWith(t)),e=>({message:`File extension .${e.name.split(".").at(-1)} is not supported`})),J0e={position:"absolute",top:2,right:2,bottom:2,left:2,'&[data-dnd-state="idle"]':{pointerEvents:"none"}},jO=c.memo(()=>{const{t:e}=M(),t=c.useRef(null),[n,s]=c.useState("idle"),o=A(On),r=re(DS),a=A(lP),l=kO(),d=c.useCallback(async h=>{const{getState:p}=em();if(!Ve.array(Q0e).safeParse(h).success){const b=e("toast.uploadFailedInvalidUploadDesc");ge({id:"UPLOAD_FAILED",title:e("toast.uploadFailed"),description:b,status:"error"});return}const m=ym.get(),[g]=h;if(m==="canvas"&&!r&&o==="canvas"&&h.length===1&&g){F0e(g);return}const x=qs(p());if(a&&h.length>1)for(const[b,C]of h.entries())await l(C,b);else{const b=h.map((C,y)=>({file:C,image_category:"user",is_intermediate:!1,board_id:x==="none"?void 0:x,isFirstUploadOfBatch:y===0}));cP(b)}},[o,r,e,a,l]),u=c.useCallback(h=>{var f;if(!((f=h.clipboardData)!=null&&f.files))return;const p=Array.from(h.clipboardData.files);d(p)},[d]);return c.useEffect(()=>{const h=t.current;if(h)return Xn(IC({element:h,canDrop:$A,onDrop:({source:p})=>{const f=W0e({source:p});d(f)},onDragEnter:()=>{s("over")},onDragLeave:()=>{s("idle")}}),Fp({canMonitor:$A,onDragStart:()=>{s("potential"),zA.start()},onDrop:()=>{s("idle"),zA.stop()}}))},[d]),c.useEffect(()=>(window.addEventListener("paste",u),()=>{window.removeEventListener("paste",u)}),[u]),i.jsx(Ce,{ref:t,"data-dnd-state":n,sx:J0e,children:i.jsx(yf,{dndState:n,label:i.jsx(_O,{})})})});jO.displayName="FullscreenDropzone";const _O=c.memo(()=>{const{t:e}=M(),t=A(qs),n=Pm(t);return i.jsxs(T,{flexDir:"column",gap:4,color:"base.100",alignItems:"center",children:[i.jsx(zt,{size:"lg",children:e("gallery.dropToUpload")}),i.jsx(zt,{size:"md",children:e("toast.imagesWillBeAddedTo",{boardName:n})})]})});_O.displayName="DropLabel";const Ev=Le(!1),IO=()=>{const e=re(Ev),t=c.useCallback(()=>{Ev.set(!0)},[]),n=c.useCallback(()=>{Ev.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},e1e=""+new URL("commercial-license-bg-C_dHp7on.png",import.meta.url).href,t1e=""+new URL("denoising-strength-4mznP2tj.png",import.meta.url).href,n1e={paramNegativeConditioning:{placement:"right"},clipSkip:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},inpainting:{href:"https://support.invoke.ai/support/solutions/articles/151000096702-inpainting-outpainting-and-bounding-box"},rasterLayer:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-raster-layers-and-initial-images"},regionalGuidance:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},regionalGuidanceAndReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},globalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},regionalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},controlNet:{href:"https://support.invoke.ai/support/solutions/articles/151000105880"},controlNetBeginEnd:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},lora:{href:"https://support.invoke.ai/support/solutions/articles/151000159072"},loraWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000159072-concepts-low-rank-adaptations-loras-"},compositingMaskBlur:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingBlurMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingCoherenceMode:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},infillMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},scaleBeforeProcessing:{href:"https://support.invoke.ai/support/solutions/articles/151000179777-scale-before-processing"},paramCFGScale:{href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramCFGRescaleMultiplier:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramDenoisingStrength:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-image-to-image",image:t1e},paramHrf:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},paramIterations:{href:"https://support.invoke.ai/support/solutions/articles/151000159073"},paramPositiveConditioning:{href:"https://support.invoke.ai/support/solutions/articles/151000096606-tips-on-crafting-prompts",placement:"right"},paramScheduler:{placement:"right",href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramSeed:{href:"https://support.invoke.ai/support/solutions/articles/151000096684-what-is-a-seed-how-do-i-use-it-to-recreate-the-same-image-"},paramModel:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000096601-what-is-a-model-which-should-i-use-"},paramRatio:{gutter:16},controlNetControlMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetProcessor:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000105880-using-controlnet"},controlNetResizeMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},paramVAE:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramVAEPrecision:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramUpscaleMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},refinerModel:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerNegativeAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerPositiveAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerScheduler:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerStart:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerSteps:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerCfgScale:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},seamlessTilingXAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},seamlessTilingYAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},fluxDevLicense:{href:"https://www.invoke.com/get-a-commercial-license-for-flux",image:e1e}},s1e=1e3,i1e=[{name:"preventOverflow",options:{padding:10}}],o1e=he(Dx,e=>e.shouldEnableInformationalPopovers),$e=c.memo(({feature:e,children:t,inPortal:n=!0,hideDisable:s=!1,...o})=>{const r=A(o1e),a=c.useMemo(()=>n1e[e],[e]),l=c.useMemo(()=>$8(na(a,["image","href","buttonLabel"]),o),[a,o]);return!s&&!r?t:i.jsxs(es,{isLazy:!0,closeOnBlur:!1,trigger:"hover",variant:"informational",openDelay:s1e,modifiers:i1e,placement:"top",...l,children:[i.jsx(ds,{children:t}),n?i.jsx(al,{children:i.jsx(GA,{data:a,feature:e,hideDisable:s})}):i.jsx(GA,{data:a,feature:e,hideDisable:s})]})});$e.displayName="InformationalPopover";const GA=({data:e,feature:t,hideDisable:n})=>{const{t:s}=M(),o=G(),r=c.useMemo(()=>s(`popovers.${t}.heading`),[t,s]),a=c.useMemo(()=>s(`popovers.${t}.paragraphs`,{returnObjects:!0})??[],[t,s]),l=c.useCallback(()=>{e!=null&&e.href&&window.open(e.href)},[e==null?void 0:e.href]),d=c.useCallback(()=>{o(dP(!1)),ge({title:s("settings.informationalPopoversDisabled"),description:s("settings.informationalPopoversDisabledDesc"),status:"info"})},[o,s]);return i.jsxs(ts,{maxW:300,children:[i.jsx(uP,{top:2}),i.jsx(us,{children:i.jsxs(T,{gap:2,flexDirection:"column",alignItems:"flex-start",children:[r&&i.jsxs(i.Fragment,{children:[i.jsx(zt,{size:"sm",children:r}),i.jsx(Ct,{})]}),(e==null?void 0:e.image)&&i.jsxs(i.Fragment,{children:[i.jsx(Zt,{objectFit:"contain",backgroundColor:"white",src:e.image,alt:"Optional Image"}),i.jsx(Ct,{})]}),a.map(u=>i.jsx(W,{children:u},u)),i.jsx(Ct,{}),i.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"full",children:[!n&&i.jsx(de,{onClick:d,variant:"link",size:"sm",children:s("common.dontShowMeThese")}),i.jsx(Je,{}),(e==null?void 0:e.href)&&i.jsx(de,{onClick:l,leftIcon:i.jsx(Sy,{}),variant:"link",size:"sm",children:s("common.learnMore")??r})]})]})})]})},r1e=()=>{const e=A(B8),t=A(RJ),n=A(OJ),s=G(),{t:o}=M(),r=c.useCallback(a=>{s(NJ(a))},[s]);return i.jsxs(Q,{isDisabled:!n,children:[i.jsx($e,{feature:"dynamicPromptsMaxPrompts",inPortal:!1,children:i.jsx(J,{children:o("dynamicPrompts.maxPrompts")})}),i.jsx(Ze,{min:t.sliderMin,max:t.sliderMax,value:e,defaultValue:t.initial,onChange:r,marks:!0}),i.jsx(_e,{min:t.numberInputMin,max:t.numberInputMax,value:e,defaultValue:t.initial,onChange:r})]})},a1e=c.memo(r1e),l1e={"&::marker":{color:"base.500"}},c1e=()=>{const{t:e}=M(),t=A(FJ),n=A(hP),s=A($x),o=A(BJ),r=c.useMemo(()=>{let a=`${e("dynamicPrompts.promptsPreview")} (${o.length})`;return t&&(a+=` - ${t}`),a},[t,o.length,e]);return n?i.jsx(T,{w:"full",h:"full",layerStyle:"second",alignItems:"center",justifyContent:"center",p:8,children:i.jsx(Ot,{icon:$7,label:"Problem generating prompts"})}):i.jsxs(Q,{orientation:"vertical",w:"full",h:"full",isInvalid:!!(t||n),children:[i.jsx($e,{feature:"dynamicPrompts",inPortal:!1,children:i.jsx(J,{children:r})}),i.jsxs(T,{w:"full",h:"full",pos:"relative",layerStyle:"first",p:4,borderRadius:"base",children:[i.jsx(ns,{children:i.jsx($J,{stylePosition:"inside",ms:0,children:o.map((a,l)=>i.jsx(Ft,{fontSize:"sm",sx:l1e,children:i.jsx(W,{as:"span",children:a})},`${a}.${l}`))})}),s&&i.jsx(T,{pos:"absolute",w:"full",h:"full",top:0,insetInlineStart:0,layerStyle:"second",opacity:.7,alignItems:"center",justifyContent:"center",children:i.jsx(ci,{})})]})]})},d1e=c.memo(c1e),u1e=()=>{const e=G(),{t}=M(),n=A(VJ),s=c.useMemo(()=>[{value:"PER_ITERATION",label:t("dynamicPrompts.seedBehaviour.perIterationLabel"),description:t("dynamicPrompts.seedBehaviour.perIterationDesc")},{value:"PER_PROMPT",label:t("dynamicPrompts.seedBehaviour.perPromptLabel"),description:t("dynamicPrompts.seedBehaviour.perPromptDesc")}],[t]),o=c.useCallback(a=>{zJ(a==null?void 0:a.value)&&e(GJ(a.value))},[e]),r=c.useMemo(()=>s.find(a=>a.value===n),[s,n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"dynamicPromptsSeedBehaviour",inPortal:!1,children:i.jsx(J,{children:t("dynamicPrompts.seedBehaviour.label")})}),i.jsx(Ke,{value:r,options:s,onChange:o})]})},h1e=c.memo(u1e),TO=c.memo(()=>{Pt("DynamicPromptsModal");const{t:e}=M(),{isOpen:t,onClose:n}=IO();return i.jsxs(Oi,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[i.jsx(di,{}),i.jsxs(Ni,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[i.jsx(ui,{children:e("dynamicPrompts.dynamicPrompts")}),i.jsx(Do,{}),i.jsxs(Ks,{as:T,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[i.jsxs(T,{gap:4,children:[i.jsx(h1e,{}),i.jsx(a1e,{})]}),i.jsx(d1e,{})]})]})]})});TO.displayName="DynamicPromptsModal";const Rl=Le(null),p1e=()=>{Pt("DeleteBoardModal");const e=re(Rl),{t}=M(),n=c.useMemo(()=>e==="none"?"none":e==null?void 0:e.board_id,[e]),{currentData:s,isFetching:o}=HJ(n?{board_id:n,categories:void 0,is_intermediate:void 0}:cs),r=c.useMemo(()=>fn([Xe,Ye,Gf],(v,w,k)=>{const S=(s??[]).map(E=>aP(v,w,k,E));return{isUpscaleImage:As(S,E=>E.isUpscaleImage),isRasterLayerImage:As(S,E=>E.isRasterLayerImage),isInpaintMaskImage:As(S,E=>E.isInpaintMaskImage),isRegionalGuidanceImage:As(S,E=>E.isRegionalGuidanceImage),isNodesImage:As(S,E=>E.isNodesImage),isControlLayerImage:As(S,E=>E.isControlLayerImage),isReferenceImage:As(S,E=>E.isReferenceImage)}}),[s]),[a,{isLoading:l}]=WJ(),[d,{isLoading:u}]=UJ(),[h,{isLoading:p}]=qJ(),f=A(r),m=c.useCallback(()=>{!e||e==="none"||(a(e.board_id),Rl.set(null))},[e,a]),g=c.useCallback(()=>{!e||e==="none"||(d(e.board_id),Rl.set(null))},[e,d]),x=c.useCallback(()=>{!e||e!=="none"||(h(),Rl.set(null))},[e,h]),b=c.useCallback(()=>{Rl.set(null)},[]),C=c.useRef(null),y=c.useMemo(()=>u||l||o||p,[u,l,o,p]);return e?i.jsx(pP,{isOpen:!!e,onClose:b,leastDestructiveRef:C,isCentered:!0,children:i.jsx(di,{children:i.jsxs(RS,{children:[i.jsxs(ui,{fontSize:"lg",fontWeight:"bold",children:[t("common.delete")," ",e==="none"?t("boards.uncategorizedImages"):e.board_name]}),i.jsx(Ks,{children:i.jsxs(T,{direction:"column",gap:3,children:[o?i.jsx(_S,{children:i.jsx(T,{w:"full",h:32})}):i.jsx(SO,{imageUsage:f,topMessage:t("boards.topMessage"),bottomMessage:t("boards.bottomMessage")}),e!=="none"&&i.jsx(W,{children:e.is_private?t("boards.deletedPrivateBoardsCannotbeRestored"):t("boards.deletedBoardsCannotbeRestored")}),i.jsx(W,{children:t("gallery.deleteImagePermanent")})]})}),i.jsx(wr,{children:i.jsxs(T,{w:"full",gap:2,justifyContent:"end",children:[i.jsx(de,{ref:C,onClick:b,children:t("boards.cancel")}),e!=="none"&&i.jsx(de,{colorScheme:"warning",isLoading:y,onClick:m,children:t("boards.deleteBoardOnly")}),e!=="none"&&i.jsx(de,{colorScheme:"error",isLoading:y,onClick:g,children:t("boards.deleteBoardAndImages")}),e==="none"&&i.jsx(de,{colorScheme:"error",isLoading:y,onClick:x,children:t("boards.deleteAllUncategorizedImages")})]})})]})})}):null},f1e=c.memo(p1e),m1e=()=>{const{t:e}=M(),t=G(),n=A(x=>x.gallery.selection),s=re(OS),o=Bt("bulkDownload"),[r]=NS(),[a]=FS(),[l]=BS(),d=c.useCallback(()=>{t(fP(n)),t(TS(!0))},[t,n]),u=c.useCallback(()=>{t(Zf(n))},[t,n]),h=c.useCallback(()=>{r({imageDTOs:n})},[r,n]),p=c.useCallback(()=>{a({imageDTOs:n})},[a,n]),f=c.useCallback(()=>{l({image_names:n.map(x=>x.image_name)})},[n,l]),m=c.useMemo(()=>n.every(x=>x.starred),[n]),g=c.useMemo(()=>n.every(x=>!x.starred),[n]);return i.jsxs(i.Fragment,{children:[m&&i.jsx(fe,{icon:s?s.on.icon:i.jsx(aj,{}),onClickCapture:p,children:s?s.off.text:"Unstar All"}),(g||!m&&!g)&&i.jsx(fe,{icon:s?s.on.icon:i.jsx(Ay,{}),onClickCapture:h,children:s?s.on.text:"Star All"}),o&&i.jsx(fe,{icon:i.jsx(Lu,{}),onClickCapture:f,children:e("gallery.downloadSelection")}),i.jsx(fe,{icon:i.jsx(T7,{}),onClickCapture:d,children:e("boards.changeBoard")}),i.jsx(bs,{}),i.jsx(fe,{color:"error.300",icon:i.jsx(Pi,{}),onClickCapture:u,children:e("gallery.deleteSelection")})]})},g1e=c.memo(m1e),no=({tooltip:e,icon:t,...n})=>i.jsx(Oe,{label:e,placement:"top",gutter:12,children:i.jsx(fe,{display:"flex",alignItems:"center",justifyContent:"center",w:"min-content",aspectRatio:"1",borderRadius:"base",...n,children:t})}),Bu=({children:e})=>i.jsx(T,{gap:2,justifyContent:"space-between",children:e}),AO=c.createContext(null),x1e=AO.Provider,$i=()=>{const e=c.useContext(AO);return ve(e!==null,"useImageDTOContext must be used within ImageDTOContextProvider"),e},MO=c.memo(()=>{const{t:e}=M(),t=G(),n=$i(),s=c.useCallback(()=>{t(fP([n])),t(TS(!0))},[t,n]);return i.jsx(fe,{icon:i.jsx(T7,{}),onClickCapture:s,children:e("boards.changeBoard")})});MO.displayName="ImageMenuItemChangeBoard";const Hy=e=>new Promise((t,n)=>{const s=new Image;s.onload=()=>{if(s.width===0||s.height===0){n(new Error("Image has no dimensions. The URL may be invalid or the object may not exist."));return}const o=document.createElement("canvas");o.width=s.width,o.height=s.height;const r=o.getContext("2d");if(!r){n(new Error("Failed to get canvas context"));return}r.drawImage(s,0,0),o.toBlob(a=>{a?t(a):n(new Error("Failed to convert image to blob"))},"image/png")},s.onerror=()=>{n(new Error("Image failed to load. The URL may be invalid or the object may not exist."))},s.crossOrigin=bu.get()?"use-credentials":"anonymous",s.src=e}),y1e=()=>{const{t:e}=M(),t=fl(),n=G();return c.useCallback(async o=>{try{const r=await Hy(o);if(!r)throw new Error("Unable to create Blob");t.writeImage(r,()=>{ge({id:"IMAGE_COPIED",title:e("toast.imageCopied"),status:"success"}),n(KJ())})}catch(r){ge({id:"PROBLEM_COPYING_IMAGE",title:e("toast.problemCopyingImage"),description:String(r),status:"error"})}},[t,e,n])},EO=c.memo(()=>{const{t:e}=M(),t=$i(),n=y1e(),s=c.useCallback(()=>{n(t.image_url)},[n,t.image_url]);return i.jsx(no,{icon:i.jsx(pn,{}),"aria-label":e("parameters.copyImage"),tooltip:e("parameters.copyImage"),onClickCapture:s})});EO.displayName="ImageMenuItemCopy";const PO=c.memo(()=>{const{t:e}=M(),t=G(),n=$i(),s=c.useCallback(()=>{t(Zf([n]))},[t,n]);return i.jsx(no,{icon:i.jsx(Pi,{}),onClickCapture:s,"aria-label":e("gallery.deleteImage",{count:1}),tooltip:e("gallery.deleteImage",{count:1}),isDestructive:!0})});PO.displayName="ImageMenuItemDelete";const b1e=()=>{const{t:e}=M(),t=G(),n=re(bu);return{downloadImage:c.useCallback(async(o,r)=>{try{const a=n?{headers:{Authorization:`Bearer ${n}`}}:{},l=await fetch(o,a).then(h=>h.blob());if(!l)throw new Error("Unable to create Blob");const d=window.URL.createObjectURL(l),u=document.createElement("a");u.style.display="none",u.href=d,u.download=r,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(d),t(ZJ())}catch(a){ge({id:"PROBLEM_DOWNLOADING_IMAGE",title:e("toast.problemDownloadingImage"),description:String(a),status:"error"})}},[e,t,n])}},LO=c.memo(()=>{const{t:e}=M(),t=$i(),{downloadImage:n}=b1e(),s=c.useCallback(()=>{n(t.image_url,t.image_name)},[n,t.image_name,t.image_url]);return i.jsx(no,{icon:i.jsx(Lu,{}),"aria-label":e("parameters.downloadImage"),tooltip:e("parameters.downloadImage"),onClick:s})});LO.displayName="ImageMenuItemDownload";const DO=c.memo(()=>{const{t:e}=M(),t=$i(),n=ol(),s=re(Kf),o=c.useCallback(()=>{n({type:"image",data:t.image_name})},[n,t.image_name]);return i.jsx(fe,{icon:i.jsx(_y,{}),onClickCapture:o,isDisabled:!t.has_workflow||!s,children:e("nodes.loadWorkflow")})});DO.displayName="ImageMenuItemLoadWorkflow";const v1e=[0,8],oi=()=>{const e=mP(!1),t=c.useRef(null),n=Q9(e.close,300),s=c.useCallback(()=>{n.cancel(),e.open()},[n,e]),o=c.useCallback(()=>{if(e.isOpen){e.close();return}else n.cancel(),e.toggle()},[n,e]),r=c.useCallback(l=>{if(l.currentTarget.contains(l.relatedTarget)){n.cancel();return}e.close()},[n,e]),a=c.useCallback(l=>{l.pointerType==="pen"||l.pointerType==="touch"||e.close()},[e]);return c.useEffect(()=>{if(!t.current)return;const d=new AbortController;return window.addEventListener("click",u=>{var h;(h=t.current)!=null&&h.contains(u.target)||e.close()},{signal:d.signal}),()=>{d.abort()}},[e]),{parentMenuItemProps:{onClick:o,onPointerEnter:s,onPointerLeave:a,closeOnSelect:!1},menuProps:{isOpen:e.isOpen,onClose:e.close,placement:"right",offset:v1e,closeOnBlur:!1},menuButtonProps:{as:Ce,width:"full",height:"full"},menuListProps:{ref:t,onPointerEnter:s,onPointerLeave:n,onBlur:r}}},ri=({label:e})=>i.jsxs(T,{w:"full",h:"full",flexDir:"row",justifyContent:"space-between",alignItems:"center",children:[i.jsx(W,{children:e}),i.jsx(at,{as:jy})]}),RO=c.memo(()=>{const{t:e}=M(),t=$i(),n=oi(),{recallAll:s,remix:o,recallSeed:r,recallPrompts:a,hasMetadata:l,hasSeed:d,hasPrompts:u,createAsPreset:h}=_j(t);return i.jsx(fe,{...n.parentMenuItemProps,icon:i.jsx(y7,{}),children:i.jsxs(on,{...n.menuProps,children:[i.jsx(rn,{...n.menuButtonProps,children:i.jsx(ri,{label:e("parameters.recallMetadata")})}),i.jsxs(Et,{...n.menuListProps,children:[i.jsx(fe,{icon:i.jsx(m1,{}),onClick:o,isDisabled:!l,children:e("parameters.remixImage")}),i.jsx(fe,{icon:i.jsx(N7,{}),onClick:a,isDisabled:!u,children:e("parameters.usePrompt")}),i.jsx(fe,{icon:i.jsx(R7,{}),onClick:r,isDisabled:!d,children:e("parameters.useSeed")}),i.jsx(fe,{icon:i.jsx(v7,{}),onClick:s,isDisabled:!l,children:e("parameters.useAll")}),i.jsx(fe,{icon:i.jsx(rj,{}),onClick:h,isDisabled:!u,children:e("stylePresets.useForTemplate")})]})]})})});RO.displayName="ImageMenuItemMetadataRecallActions";const lt=()=>{const e=Lt();return re(e.$isBusy)},OO=()=>{const e=E8();return re((e==null?void 0:e.$isBusy)??Cde)},NO=c.memo(()=>{const{t:e}=M(),t=oi(),n=cn(),s=$i(),o=$t(),r=OO(),a=c.useCallback(async()=>{const{dispatch:h,getState:p}=n;await Lg({imageDTO:s,withResize:!1,type:"raster_layer",dispatch:h,getState:p}),h(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]),l=c.useCallback(async()=>{const{dispatch:h,getState:p}=n;await Lg({imageDTO:s,withResize:!1,type:"control_layer",dispatch:h,getState:p}),h(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]),d=c.useCallback(async()=>{const{dispatch:h,getState:p}=n;await Lg({imageDTO:s,withResize:!0,type:"raster_layer",dispatch:h,getState:p}),h(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]),u=c.useCallback(async()=>{const{dispatch:h,getState:p}=n;await Lg({imageDTO:s,withResize:!0,type:"control_layer",dispatch:h,getState:p}),h(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(Vt,{}),children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.newCanvasFromImage")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(fe,{icon:i.jsx(Mg,{}),onClickCapture:a,isDisabled:r,children:e("controlLayers.asRasterLayer")}),i.jsx(fe,{icon:i.jsx(Mg,{}),onClickCapture:d,isDisabled:r,children:e("controlLayers.asRasterLayerResize")}),i.jsx(fe,{icon:i.jsx(Mg,{}),onClickCapture:l,isDisabled:r,children:e("controlLayers.asControlLayer")}),i.jsx(fe,{icon:i.jsx(Mg,{}),onClickCapture:u,isDisabled:r,children:e("controlLayers.asControlLayerResize")})]})]})})});NO.displayName="ImageMenuItemNewCanvasFromImageSubMenu";const C1e=Sr(wfe),Ms=()=>i.jsx(C1e,{transform:"rotate(90deg)"}),FO=c.memo(()=>{const{t:e}=M(),t=oi(),n=cn(),s=$i(),o=$t(),r=OO(),a=c.useCallback(()=>{const{dispatch:f,getState:m}=n;Qi({imageDTO:s,type:"raster_layer",dispatch:f,getState:m}),f(Wc()),f(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]),l=c.useCallback(()=>{const{dispatch:f,getState:m}=n;Qi({imageDTO:s,type:"control_layer",dispatch:f,getState:m}),f(Wc()),f(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]),d=c.useCallback(()=>{const{dispatch:f,getState:m}=n;Qi({imageDTO:s,type:"inpaint_mask",dispatch:f,getState:m}),f(Wc()),f(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]),u=c.useCallback(()=>{const{dispatch:f,getState:m}=n;Qi({imageDTO:s,type:"regional_guidance",dispatch:f,getState:m}),f(Wc()),f(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]),h=c.useCallback(()=>{const{dispatch:f,getState:m}=n;Qi({imageDTO:s,type:"reference_image",dispatch:f,getState:m}),f(Wc()),f(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]),p=c.useCallback(()=>{const{dispatch:f,getState:m}=n;Qi({imageDTO:s,type:"regional_guidance_with_reference_image",dispatch:f,getState:m}),f(Wc()),f(Yt("canvas")),o.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,o,n,e]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(Vt,{}),children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.newLayerFromImage")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:d,isDisabled:r,children:e("controlLayers.inpaintMask")}),i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:u,isDisabled:r,children:e("controlLayers.regionalGuidance")}),i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:l,isDisabled:r,children:e("controlLayers.controlLayer")}),i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:a,isDisabled:r,children:e("controlLayers.rasterLayer")}),i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:p,isDisabled:r,children:e("controlLayers.referenceImageRegional")}),i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:h,isDisabled:r,children:e("controlLayers.referenceImageGlobal")})]})]})})});FO.displayName="ImageMenuItemNewLayerFromImageSubMenu";const BO=c.memo(()=>{const{t:e}=M(),t=$i(),n=G(),s=c.useCallback(()=>{window.open(t.image_url,"_blank"),n(YJ())},[t.image_url,n]);return i.jsx(no,{onClickCapture:s,"aria-label":e("common.openInNewTab"),tooltip:e("common.openInNewTab"),icon:i.jsx(Sy,{})})});BO.displayName="ImageMenuItemOpenInNewTab";const $O=c.memo(()=>{const{t:e}=M(),t=$i(),n=$t(),s=c.useCallback(()=>{n.openImageInViewer(t)},[t,n]);return i.jsx(no,{icon:i.jsx(ky,{}),onClickCapture:s,"aria-label":e("common.openInViewer"),tooltip:e("common.openInViewer")})});$O.displayName="ImageMenuItemOpenInViewer";const VO=c.memo(()=>{const{t:e}=M(),t=G(),n=$i(),s=c.useMemo(()=>he(Ai,a=>{var l;return((l=a.imageToCompare)==null?void 0:l.image_name)!==n.image_name}),[n.image_name]),o=A(s),r=c.useCallback(()=>{t(Qf(n))},[t,n]);return i.jsx(no,{icon:i.jsx(M7,{}),isDisabled:!o,onClick:r,"aria-label":e("gallery.selectForCompare"),tooltip:e("gallery.selectForCompare")})});VO.displayName="ImageMenuItemSelectForCompare";const zO=c.memo(()=>{const{t:e}=M(),t=G(),n=$i(),s=c.useCallback(()=>{t(X0(n)),t(Yt("upscaling")),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToUpscale"),status:"success"})},[t,n,e]);return i.jsx(fe,{icon:i.jsx(F7,{}),onClickCapture:s,id:"send-to-upscale",children:e("parameters.sendToUpscale")})});zO.displayName="ImageMenuItemSendToUpscale";const GO=c.memo(()=>{const{t:e}=M(),t=$i(),n=re(OS),[s]=NS(),[o]=FS(),r=c.useCallback(()=>{t&&s({imageDTOs:[t]})},[s,t]),a=c.useCallback(()=>{t&&o({imageDTOs:[t]})},[o,t]);return t.starred?i.jsx(fe,{icon:n?n.off.icon:i.jsx(Ay,{}),onClickCapture:a,children:n?n.off.text:e("gallery.unstarImage")}):i.jsx(fe,{icon:n?n.on.icon:i.jsx(aj,{}),onClickCapture:r,children:n?n.on.text:e("gallery.starImage")})});GO.displayName="ImageMenuItemStarUnstar";const w1e=({imageDTO:e})=>i.jsxs(x1e,{value:e,children:[i.jsxs(Bu,{children:[i.jsx(BO,{}),i.jsx(EO,{}),i.jsx(LO,{}),i.jsx($O,{}),i.jsx(VO,{}),i.jsx(PO,{})]}),i.jsx(bs,{}),i.jsx(DO,{}),i.jsx(RO,{}),i.jsx(bs,{}),i.jsx(zO,{}),i.jsx(NO,{}),i.jsx(FO,{}),i.jsx(bs,{}),i.jsx(MO,{}),i.jsx(GO,{})]}),HO=c.memo(w1e),S1e=500,k1e=10,$d=XJ({isOpen:!1,imageDTO:null,position:{x:-1,y:-1}}),Vp=()=>{$d.setKey("isOpen",!1)},QC=new Map,j1e=e=>{const t=Array.from(QC.entries()).find(n=>n[0].contains(e));return t==null?void 0:t[1]},WO=(e,t)=>{c.useEffect(()=>{if(!t||!e)return;const n=t;return QC.set(n,e),()=>{QC.delete(n)}},[e,t])},UO=c.memo(()=>{Pt("ImageContextMenu");const e=re($d);return tm(Vp),i.jsxs(al,{children:[i.jsxs(on,{isOpen:e.isOpen,gutter:0,placement:"auto-end",onClose:Vp,children:[i.jsx(rn,{"aria-hidden":!0,w:1,h:1,position:"absolute",left:e.position.x,top:e.position.y,cursor:"default",bg:"transparent",_hover:_1e,pointerEvents:"none"}),i.jsx(KO,{})]}),i.jsx(qO,{})]})});UO.displayName="ImageContextMenu";const _1e={bg:"transparent"},qO=c.memo(()=>{const e=c.useRef({x:-1,y:-1}),t=c.useRef(0),n=c.useRef(0),s=c.useCallback(d=>{if(d.shiftKey){Vp();return}const u=j1e(d.target);if(!u){Vp();return}window.clearTimeout(n.current),d.preventDefault(),e.current.x!==d.pageX||e.current.y!==d.pageY?($d.get().isOpen&&Vp(),n.current=window.setTimeout(()=>{$d.set({isOpen:!0,position:{x:d.pageX,y:d.pageY},imageDTO:u})},100)):$d.set({isOpen:!0,position:{x:d.pageX,y:d.pageY},imageDTO:u}),e.current={x:d.pageX,y:d.pageY}},[]),o=c.useCallback(d=>{d.pointerType!=="mouse"&&(t.current=window.setTimeout(()=>{s(d)},S1e),e.current={x:d.pageX,y:d.pageY})},[s]),r=c.useCallback(d=>{if(d.pointerType==="mouse"||t.current===null)return;const u=e.current;Math.hypot(d.pageX-u.x,d.pageY-u.y)>k1e&&clearTimeout(t.current)},[]),a=c.useCallback(d=>{d.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]),l=c.useCallback(d=>{d.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]);return c.useEffect(()=>{const d=new AbortController;return window.addEventListener("contextmenu",s,{signal:d.signal}),window.addEventListener("pointerdown",o,{signal:d.signal}),window.addEventListener("pointerup",a,{signal:d.signal}),window.addEventListener("pointercancel",l,{signal:d.signal}),window.addEventListener("pointermove",r,{signal:d.signal}),()=>{d.abort()}},[s,l,o,r,a]),c.useEffect(()=>()=>{window.clearTimeout(n.current),window.clearTimeout(t.current)},[]),null});qO.displayName="ImageContextMenuEventLogical";const KO=c.memo(()=>{const e=A($S),t=re($d);return t.imageDTO?e>1?i.jsx(Et,{visibility:"visible",children:i.jsx(g1e,{})}):i.jsx(Et,{visibility:"visible",children:i.jsx(HO,{imageDTO:t.imageDTO})}):null});KO.displayName="MenuContent";const v1=Le(null),HA=()=>v1.set(null),I1e=()=>c.useCallback(t=>{v1.set(t)},[]),T1e=()=>{Pt("ShareWorkflowModal");const e=re(v1),t=re(VS),{t:n}=M(),s=fl(),o=c.useMemo(()=>!e||!t?null:`${window.location.origin}${t}/studio?selectedWorkflowId=${e.workflow_id}`,[t,e]),r=c.useCallback(()=>{o&&(s.writeText(o,()=>{ge({status:"success",title:n("toast.linkCopied")})}),v1.set(null))},[o,s,n]);return i.jsxs(Oi,{isOpen:e!==null,onClose:HA,isCentered:!0,size:"lg",useInert:!1,children:[i.jsx(di,{}),i.jsxs(Ni,{children:[i.jsx(ui,{children:i.jsxs(T,{flexDir:"column",gap:2,children:[i.jsx(zt,{fontSize:"xl",children:n("workflows.copyShareLinkForWorkflow")}),i.jsx(W,{fontSize:"md",children:e==null?void 0:e.name})]})}),i.jsx(Do,{}),i.jsx(Ks,{children:i.jsxs(T,{layerStyle:"third",p:4,borderRadius:"base",alignItems:"center",children:[i.jsx(W,{fontWeight:"semibold",children:o}),i.jsx(le,{variant:"ghost","aria-label":n("common.copy"),tooltip:n("common.copy"),icon:i.jsx(pn,{}),onClick:r})]})}),i.jsx(wr,{children:i.jsx(de,{onClick:HA,children:n("common.close")})})]})]})},[ZO]=gP(!1),Bj=()=>{const{t:e}=M(),t=G(),n=ZO(),s=_c(),o=Vx(),r=c.useCallback(()=>{t(xP()),t(Za("edit")),o.close(),ge({id:"NEW_WORKFLOW_CREATED",title:e("workflows.newWorkflowCreated"),status:"success"}),n.close()},[n,t,e,o]),a=c.useCallback(()=>{if(!s){r();return}n.open()},[s,n,r]);return{createImmediate:r,createWithDialog:a}},YO=c.memo(()=>{Pt("NewWorkflowConfirmationAlertDialog");const{t:e}=M(),t=ZO(),n=Bj();return i.jsx(ho,{isOpen:t.isOpen,onClose:t.close,title:e("nodes.newWorkflow"),acceptCallback:n.createImmediate,useInert:!1,acceptButtonText:e("common.load"),children:i.jsxs(T,{flexDir:"column",gap:2,children:[i.jsx(W,{children:e("nodes.newWorkflowDesc")}),i.jsx(W,{variant:"subtext",children:e("nodes.newWorkflowDesc2")})]})})});YO.displayName="NewWorkflowConfirmationAlertDialog";const XO=c.memo(()=>{const e=Bj(),{t}=M(),n=c.useCallback(s=>{s.stopPropagation(),e.createWithDialog()},[e]);return i.jsx(de,{onClick:n,variant:"ghost",leftIcon:i.jsx(xf,{}),justifyContent:"flex-start",children:t("nodes.newWorkflow")})});XO.displayName="NewWorkflowButton";var Pv={exports:{}},Lv,WA;function A1e(){if(WA)return Lv;WA=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Lv=e,Lv}var Dv,UA;function M1e(){if(UA)return Dv;UA=1;var e=A1e();function t(){}function n(){}return n.resetWarningCache=t,Dv=function(){function s(a,l,d,u,h,p){if(p!==e){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}s.isRequired=s;function o(){return s}var r={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:o,element:s,elementType:s,instanceOf:o,node:s,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:n,resetWarningCache:t};return r.PropTypes=r,r},Dv}var qA;function E1e(){return qA||(qA=1,Pv.exports=M1e()()),Pv.exports}var P1e=E1e();const tn=hu(P1e);var Jo=function(){return Jo=Object.assign||function(t){for(var n,s=1,o=arguments.length;s<o;s++){n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Jo.apply(this,arguments)};function QO(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]]);return n}function Pc(e,t,n,s){function o(r){return r instanceof n?r:new n(function(a){a(r)})}return new(n||(n=Promise))(function(r,a){function l(h){try{u(s.next(h))}catch(p){a(p)}}function d(h){try{u(s.throw(h))}catch(p){a(p)}}function u(h){h.done?r(h.value):o(h.value).then(l,d)}u((s=s.apply(e,t||[])).next())})}function L1e(e,t,n){if(n||arguments.length===2)for(var s=0,o=t.length,r;s<o;s++)(r||!(s in t))&&(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))}const D1e=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function iu(e,t,n){const s=R1e(e),{webkitRelativePath:o}=e,r=typeof t=="string"?t:typeof o=="string"&&o.length>0?o:`./${e.name}`;return typeof s.path!="string"&&KA(s,"path",r),KA(s,"relativePath",r),s}function R1e(e){const{name:t}=e;if(t&&t.lastIndexOf(".")!==-1&&!e.type){const s=t.split(".").pop().toLowerCase(),o=D1e.get(s);o&&Object.defineProperty(e,"type",{value:o,writable:!1,configurable:!1,enumerable:!0})}return e}function KA(e,t,n){Object.defineProperty(e,t,{value:n,writable:!1,configurable:!1,enumerable:!0})}const O1e=[".DS_Store","Thumbs.db"];function N1e(e){return Pc(this,void 0,void 0,function*(){return C1(e)&&F1e(e.dataTransfer)?z1e(e.dataTransfer,e.type):B1e(e)?$1e(e):Array.isArray(e)&&e.every(t=>"getFile"in t&&typeof t.getFile=="function")?V1e(e):[]})}function F1e(e){return C1(e)}function B1e(e){return C1(e)&&C1(e.target)}function C1(e){return typeof e=="object"&&e!==null}function $1e(e){return JC(e.target.files).map(t=>iu(t))}function V1e(e){return Pc(this,void 0,void 0,function*(){return(yield Promise.all(e.map(n=>n.getFile()))).map(n=>iu(n))})}function z1e(e,t){return Pc(this,void 0,void 0,function*(){if(e.items){const n=JC(e.items).filter(o=>o.kind==="file");if(t!=="drop")return n;const s=yield Promise.all(n.map(G1e));return ZA(JO(s))}return ZA(JC(e.files).map(n=>iu(n)))})}function ZA(e){return e.filter(t=>O1e.indexOf(t.name)===-1)}function JC(e){if(e===null)return[];const t=[];for(let n=0;n<e.length;n++){const s=e[n];t.push(s)}return t}function G1e(e){if(typeof e.webkitGetAsEntry!="function")return YA(e);const t=e.webkitGetAsEntry();return t&&t.isDirectory?eN(t):YA(e,t)}function JO(e){return e.reduce((t,n)=>[...t,...Array.isArray(n)?JO(n):[n]],[])}function YA(e,t){return Pc(this,void 0,void 0,function*(){var n;if(globalThis.isSecureContext&&typeof e.getAsFileSystemHandle=="function"){const r=yield e.getAsFileSystemHandle();if(r===null)throw new Error(`${e} is not a File`);if(r!==void 0){const a=yield r.getFile();return a.handle=r,iu(a)}}const s=e.getAsFile();if(!s)throw new Error(`${e} is not a File`);return iu(s,(n=t==null?void 0:t.fullPath)!==null&&n!==void 0?n:void 0)})}function H1e(e){return Pc(this,void 0,void 0,function*(){return e.isDirectory?eN(e):W1e(e)})}function eN(e){const t=e.createReader();return new Promise((n,s)=>{const o=[];function r(){t.readEntries(a=>Pc(this,void 0,void 0,function*(){if(a.length){const l=Promise.all(a.map(H1e));o.push(l),r()}else try{const l=yield Promise.all(o);n(l)}catch(l){s(l)}}),a=>{s(a)})}r()})}function W1e(e){return Pc(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.file(s=>{const o=iu(s,e.fullPath);t(o)},s=>{n(s)})})})}var Dg={},XA;function U1e(){return XA||(XA=1,Dg.__esModule=!0,Dg.default=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(",");if(n.length===0)return!0;var s=e.name||"",o=(e.type||"").toLowerCase(),r=o.replace(/\/.*$/,"");return n.some(function(a){var l=a.trim().toLowerCase();return l.charAt(0)==="."?s.toLowerCase().endsWith(l):l.endsWith("/*")?r===l.replace(/\/.*$/,""):o===l})}return!0}),Dg}var q1e=U1e();const Rv=hu(q1e);function QA(e){return Y1e(e)||Z1e(e)||nN(e)||K1e()}function K1e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z1e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Y1e(e){if(Array.isArray(e))return ew(e)}function JA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function e6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JA(Object(n),!0).forEach(function(s){tN(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JA(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function tN(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bf(e,t){return J1e(e)||Q1e(e,t)||nN(e,t)||X1e()}function X1e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nN(e,t){if(e){if(typeof e=="string")return ew(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ew(e,t)}}function ew(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function Q1e(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],o=!0,r=!1,a,l;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(s.push(a.value),!(t&&s.length===t));o=!0);}catch(d){r=!0,l=d}finally{try{!o&&n.return!=null&&n.return()}finally{if(r)throw l}}return s}}function J1e(e){if(Array.isArray(e))return e}var exe=typeof Rv=="function"?Rv:Rv.default,txe="file-invalid-type",nxe="file-too-large",sxe="file-too-small",ixe="too-many-files",oxe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=t.split(","),s=n.length>1?"one of ".concat(n.join(", ")):n[0];return{code:txe,message:"File type must be ".concat(s)}},t6=function(t){return{code:nxe,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},n6=function(t){return{code:sxe,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},rxe={code:ixe,message:"Too many files"};function sN(e,t){var n=e.type==="application/x-moz-file"||exe(e,t);return[n,n?null:oxe(t)]}function iN(e,t,n){if(Ol(e.size))if(Ol(t)&&Ol(n)){if(e.size>n)return[!1,t6(n)];if(e.size<t)return[!1,n6(t)]}else{if(Ol(t)&&e.size<t)return[!1,n6(t)];if(Ol(n)&&e.size>n)return[!1,t6(n)]}return[!0,null]}function Ol(e){return e!=null}function axe(e){var t=e.files,n=e.accept,s=e.minSize,o=e.maxSize,r=e.multiple,a=e.maxFiles,l=e.validator;return!r&&t.length>1||r&&a>=1&&t.length>a?!1:t.every(function(d){var u=sN(d,n),h=bf(u,1),p=h[0],f=iN(d,s,o),m=bf(f,1),g=m[0],x=l?l(d):null;return p&&g&&!x})}function w1(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function Rg(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!e.target&&!!e.target.files}function s6(e){e.preventDefault()}function lxe(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function cxe(e){return e.indexOf("Edge/")!==-1}function dxe(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return lxe(e)||cxe(e)}function zo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){for(var o=arguments.length,r=new Array(o>1?o-1:0),a=1;a<o;a++)r[a-1]=arguments[a];return t.some(function(l){return!w1(s)&&l&&l.apply(void 0,[s].concat(r)),w1(s)})}}function uxe(){return"showOpenFilePicker"in window}function hxe(e){if(Ol(e)){var t=Object.entries(e).filter(function(n){var s=bf(n,2),o=s[0],r=s[1],a=!0;return oN(o)||(console.warn('Skipped "'.concat(o,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),a=!1),(!Array.isArray(r)||!r.every(rN))&&(console.warn('Skipped "'.concat(o,'" because an invalid file extension was provided.')),a=!1),a}).reduce(function(n,s){var o=bf(s,2),r=o[0],a=o[1];return e6(e6({},n),{},tN({},r,a))},{});return[{description:"Files",accept:t}]}return e}function pxe(e){if(Ol(e))return Object.entries(e).reduce(function(t,n){var s=bf(n,2),o=s[0],r=s[1];return[].concat(QA(t),[o],QA(r))},[]).filter(function(t){return oN(t)||rN(t)}).join(",")}function fxe(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function mxe(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function oN(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||e==="application/*"||/\w+\/[-+.\w]+/g.test(e)}function rN(e){return/^.*\.[\w]+$/.test(e)}var gxe=["children"],xxe=["open"],yxe=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],bxe=["refKey","onChange","onClick"];function vxe(e){return Sxe(e)||wxe(e)||aN(e)||Cxe()}function Cxe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wxe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Sxe(e){if(Array.isArray(e))return tw(e)}function Ov(e,t){return _xe(e)||jxe(e,t)||aN(e,t)||kxe()}function kxe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aN(e,t){if(e){if(typeof e=="string")return tw(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tw(e,t)}}function tw(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function jxe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],o=!0,r=!1,a,l;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(s.push(a.value),!(t&&s.length===t));o=!0);}catch(d){r=!0,l=d}finally{try{!o&&n.return!=null&&n.return()}finally{if(r)throw l}}return s}}function _xe(e){if(Array.isArray(e))return e}function i6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function wn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?i6(Object(n),!0).forEach(function(s){nw(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i6(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function nw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S1(e,t){if(e==null)return{};var n=Ixe(e,t),s,o;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)s=r[o],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Ixe(e,t){if(e==null)return{};var n={},s=Object.keys(e),o,r;for(r=0;r<s.length;r++)o=s[r],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}var $j=c.forwardRef(function(e,t){var n=e.children,s=S1(e,gxe),o=da(s),r=o.open,a=S1(o,xxe);return c.useImperativeHandle(t,function(){return{open:r}},[r]),xe.createElement(c.Fragment,null,n(wn(wn({},a),{},{open:r})))});$j.displayName="Dropzone";var lN={disabled:!1,getFilesFromEvent:N1e,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};$j.defaultProps=lN;$j.propTypes={children:tn.func,accept:tn.objectOf(tn.arrayOf(tn.string)),multiple:tn.bool,preventDropOnDocument:tn.bool,noClick:tn.bool,noKeyboard:tn.bool,noDrag:tn.bool,noDragEventsBubbling:tn.bool,minSize:tn.number,maxSize:tn.number,maxFiles:tn.number,disabled:tn.bool,getFilesFromEvent:tn.func,onFileDialogCancel:tn.func,onFileDialogOpen:tn.func,useFsAccessApi:tn.bool,autoFocus:tn.bool,onDragEnter:tn.func,onDragLeave:tn.func,onDragOver:tn.func,onDrop:tn.func,onDropAccepted:tn.func,onDropRejected:tn.func,onError:tn.func,validator:tn.func};var sw={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function da(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=wn(wn({},lN),e),n=t.accept,s=t.disabled,o=t.getFilesFromEvent,r=t.maxSize,a=t.minSize,l=t.multiple,d=t.maxFiles,u=t.onDragEnter,h=t.onDragLeave,p=t.onDragOver,f=t.onDrop,m=t.onDropAccepted,g=t.onDropRejected,x=t.onFileDialogCancel,b=t.onFileDialogOpen,C=t.useFsAccessApi,y=t.autoFocus,v=t.preventDropOnDocument,w=t.noClick,k=t.noKeyboard,S=t.noDrag,P=t.noDragEventsBubbling,E=t.onError,L=t.validator,I=c.useMemo(function(){return pxe(n)},[n]),O=c.useMemo(function(){return hxe(n)},[n]),N=c.useMemo(function(){return typeof b=="function"?b:o6},[b]),_=c.useMemo(function(){return typeof x=="function"?x:o6},[x]),R=c.useRef(null),D=c.useRef(null),B=c.useReducer(Txe,sw),V=Ov(B,2),ee=V[0],se=V[1],oe=ee.isFocused,te=ee.isFileDialogActive,H=c.useRef(typeof window<"u"&&window.isSecureContext&&C&&uxe()),z=function(){!H.current&&te&&setTimeout(function(){if(D.current){var ue=D.current.files;ue.length||(se({type:"closeDialog"}),_())}},300)};c.useEffect(function(){return window.addEventListener("focus",z,!1),function(){window.removeEventListener("focus",z,!1)}},[D,te,_,H]);var Z=c.useRef([]),U=function(ue){R.current&&R.current.contains(ue.target)||(ue.preventDefault(),Z.current=[])};c.useEffect(function(){return v&&(document.addEventListener("dragover",s6,!1),document.addEventListener("drop",U,!1)),function(){v&&(document.removeEventListener("dragover",s6),document.removeEventListener("drop",U))}},[R,v]),c.useEffect(function(){return!s&&y&&R.current&&R.current.focus(),function(){}},[R,y,s]);var Y=c.useCallback(function(ne){E?E(ne):console.error(ne)},[E]),$=c.useCallback(function(ne){ne.preventDefault(),ne.persist(),rt(ne),Z.current=[].concat(vxe(Z.current),[ne.target]),Rg(ne)&&Promise.resolve(o(ne)).then(function(ue){if(!(w1(ne)&&!P)){var be=ue.length,ye=be>0&&axe({files:ue,accept:I,minSize:a,maxSize:r,multiple:l,maxFiles:d,validator:L}),ke=be>0&&!ye;se({isDragAccept:ye,isDragReject:ke,isDragActive:!0,type:"setDraggedFiles"}),u&&u(ne)}}).catch(function(ue){return Y(ue)})},[o,u,Y,P,I,a,r,l,d,L]),F=c.useCallback(function(ne){ne.preventDefault(),ne.persist(),rt(ne);var ue=Rg(ne);if(ue&&ne.dataTransfer)try{ne.dataTransfer.dropEffect="copy"}catch{}return ue&&p&&p(ne),!1},[p,P]),q=c.useCallback(function(ne){ne.preventDefault(),ne.persist(),rt(ne);var ue=Z.current.filter(function(ye){return R.current&&R.current.contains(ye)}),be=ue.indexOf(ne.target);be!==-1&&ue.splice(be,1),Z.current=ue,!(ue.length>0)&&(se({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Rg(ne)&&h&&h(ne))},[R,h,P]),ie=c.useCallback(function(ne,ue){var be=[],ye=[];ne.forEach(function(ke){var Ue=sN(ke,I),pt=Ov(Ue,2),_t=pt[0],vn=pt[1],Cn=iN(ke,a,r),gn=Ov(Cn,2),Fn=gn[0],Hi=gn[1],$o=L?L(ke):null;if(_t&&Fn&&!$o)be.push(ke);else{var mo=[vn,Hi];$o&&(mo=mo.concat($o)),ye.push({file:ke,errors:mo.filter(function(Vo){return Vo})})}}),(!l&&be.length>1||l&&d>=1&&be.length>d)&&(be.forEach(function(ke){ye.push({file:ke,errors:[rxe]})}),be.splice(0)),se({acceptedFiles:be,fileRejections:ye,isDragReject:ye.length>0,type:"setFiles"}),f&&f(be,ye,ue),ye.length>0&&g&&g(ye,ue),be.length>0&&m&&m(be,ue)},[se,l,I,a,r,d,f,m,g,L]),ce=c.useCallback(function(ne){ne.preventDefault(),ne.persist(),rt(ne),Z.current=[],Rg(ne)&&Promise.resolve(o(ne)).then(function(ue){w1(ne)&&!P||ie(ue,ne)}).catch(function(ue){return Y(ue)}),se({type:"reset"})},[o,ie,Y,P]),me=c.useCallback(function(){if(H.current){se({type:"openDialog"}),N();var ne={multiple:l,types:O};window.showOpenFilePicker(ne).then(function(ue){return o(ue)}).then(function(ue){ie(ue,null),se({type:"closeDialog"})}).catch(function(ue){fxe(ue)?(_(ue),se({type:"closeDialog"})):mxe(ue)?(H.current=!1,D.current?(D.current.value=null,D.current.click()):Y(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Y(ue)});return}D.current&&(se({type:"openDialog"}),N(),D.current.value=null,D.current.click())},[se,N,_,C,ie,Y,O,l]),Ie=c.useCallback(function(ne){!R.current||!R.current.isEqualNode(ne.target)||(ne.key===" "||ne.key==="Enter"||ne.keyCode===32||ne.keyCode===13)&&(ne.preventDefault(),me())},[R,me]),we=c.useCallback(function(){se({type:"focus"})},[]),Ee=c.useCallback(function(){se({type:"blur"})},[]),ot=c.useCallback(function(){w||(dxe()?setTimeout(me,0):me())},[w,me]),Fe=function(ue){return s?null:ue},Be=function(ue){return k?null:Fe(ue)},ut=function(ue){return S?null:Fe(ue)},rt=function(ue){P&&ue.stopPropagation()},ht=c.useMemo(function(){return function(){var ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ue=ne.refKey,be=ue===void 0?"ref":ue,ye=ne.role,ke=ne.onKeyDown,Ue=ne.onFocus,pt=ne.onBlur,_t=ne.onClick,vn=ne.onDragEnter,Cn=ne.onDragOver,gn=ne.onDragLeave,Fn=ne.onDrop,Hi=S1(ne,yxe);return wn(wn(nw({onKeyDown:Be(zo(ke,Ie)),onFocus:Be(zo(Ue,we)),onBlur:Be(zo(pt,Ee)),onClick:Fe(zo(_t,ot)),onDragEnter:ut(zo(vn,$)),onDragOver:ut(zo(Cn,F)),onDragLeave:ut(zo(gn,q)),onDrop:ut(zo(Fn,ce)),role:typeof ye=="string"&&ye!==""?ye:"presentation"},be,R),!s&&!k?{tabIndex:0}:{}),Hi)}},[R,Ie,we,Ee,ot,$,F,q,ce,k,S,s]),K=c.useCallback(function(ne){ne.stopPropagation()},[]),ae=c.useMemo(function(){return function(){var ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ue=ne.refKey,be=ue===void 0?"ref":ue,ye=ne.onChange,ke=ne.onClick,Ue=S1(ne,bxe),pt=nw({accept:I,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Fe(zo(ye,ce)),onClick:Fe(zo(ke,K)),tabIndex:-1},be,D);return wn(wn({},pt),Ue)}},[D,n,l,ce,s]);return wn(wn({},ee),{},{isFocused:oe&&!s,getRootProps:ht,getInputProps:ae,rootRef:R,inputRef:D,open:Fe(me)})}function Txe(e,t){switch(t.type){case"focus":return wn(wn({},e),{},{isFocused:!0});case"blur":return wn(wn({},e),{},{isFocused:!1});case"openDialog":return wn(wn({},sw),{},{isFileDialogActive:!0});case"closeDialog":return wn(wn({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return wn(wn({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return wn(wn({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections,isDragReject:t.isDragReject});case"reset":return wn({},sw);default:return e}}function o6(){}const cN=c.memo(()=>{const{t:e}=M(),t=ol(),n=c.useCallback(([r])=>{r&&t({type:"file",data:r})},[t]),{getInputProps:s,getRootProps:o}=da({accept:{"application/json":[".json"]},onDropAccepted:n,noDrag:!0,multiple:!1});return i.jsxs(i.Fragment,{children:[i.jsx(de,{leftIcon:i.jsx(jm,{}),...o(),pointerEvents:"auto",variant:"ghost",justifyContent:"flex-start",children:e("workflows.uploadWorkflow")}),i.jsx("input",{...s()})]})});cN.displayName="UploadWorkflowButton";const Axe=()=>{const{t:e}=M(),t=re(zS),n=A(Ic),s=A(zx);return i.jsxs(T,{h:"full",minH:0,overflow:"hidden",flexDir:"column",w:64,gap:0,children:[i.jsxs(T,{flexDir:"column",w:"full",pb:2,gap:2,children:[i.jsx(Ea,{view:"recent",children:e("workflows.recentlyOpened")}),i.jsx(Ea,{view:"yours",children:e("workflows.yourWorkflows")}),t.includes("project")&&i.jsx(ll,{in:n==="yours"||n==="shared"||n==="private",children:i.jsxs(T,{flexDir:"column",gap:2,pl:4,pt:2,children:[i.jsx(Ea,{size:"sm",view:"private",children:e("workflows.private")}),i.jsxs(Ea,{size:"sm",rightIcon:i.jsx(cj,{}),view:"shared",children:[e("workflows.shared"),i.jsx(Je,{})]})]})}),s&&i.jsx(Ea,{view:"published",children:e("workflows.published")})]}),i.jsxs(T,{h:"full",minH:0,overflow:"hidden",flexDir:"column",children:[i.jsx(dN,{}),i.jsx(uN,{})]}),i.jsx(Je,{}),i.jsx(XO,{}),i.jsx(cN,{})]})},dN=c.memo(()=>{const{t:e}=M(),t=A(Ic),n=G(),s=A(GS),o=c.useCallback(()=>{n(QJ())},[n]);return t==="defaults"&&s.length>0?i.jsxs(Qn,{children:[i.jsx(Ea,{view:"defaults",w:"auto",children:e("workflows.browseWorkflows")}),i.jsx(Oe,{label:e("workflows.deselectAll"),children:i.jsx(le,{onClick:o,size:"md","aria-label":e("workflows.deselectAll"),icon:i.jsx(Zs,{size:12}),variant:"ghost",bg:"base.700",color:"base.50"})})]}):i.jsx(Ea,{view:"defaults",children:e("workflows.browseWorkflows")})});dN.displayName="BrowseWorkflowsButton";const Mxe=fo({visibility:"visible"}).options,uN=c.memo(()=>{const e=re(JJ),t=A(Ic);return i.jsx(ll,{in:t==="defaults",children:i.jsx(T,{flexDir:"column",gap:2,pl:4,py:2,overflow:"hidden",h:"100%",minH:0,children:i.jsx(vs,{style:Ir,options:Mxe,children:i.jsx(T,{flexDir:"column",gap:2,overflow:"auto",children:e.map(n=>i.jsx(hN,{tagCategory:n},n.categoryTKey))})})})})});uN.displayName="DefaultsViewCheckboxes";const Exe=e=>{const t=re(yP),n=c.useMemo(()=>({tags:t.map(r=>r.label),categories:["default"]}),[t]),s=c.useMemo(()=>({selectFromResult:({data:r})=>({count:(r==null?void 0:r[e])??0})}),[e]),{count:o}=bP(n,s);return o},Pxe=e=>{const t=re(yP),n=c.useMemo(()=>({tags:t.map(r=>r.label),categories:["default"]}),[t]),s=c.useMemo(()=>({selectFromResult:({data:r})=>r?{count:e.tags.reduce((a,l)=>a+(r[l.label]??0),0)}:{count:0}}),[e]),{count:o}=bP(n,s);return o},Ea=c.memo(({view:e,...t})=>{const n=Gx(),s=A(Ic),o=c.useCallback(()=>{n(Sp(e))},[n,e]);return i.jsx(de,{variant:"ghost",justifyContent:"flex-start",size:"md",flexShrink:0,w:"full",onClick:o,...t,bg:s===e?"base.700":void 0,color:s===e?"base.50":void 0})});Ea.displayName="NavButton";const hN=c.memo(({tagCategory:e})=>{const{t}=M();return Pxe(e)===0?null:i.jsxs(T,{flexDir:"column",gap:2,children:[i.jsx(W,{fontWeight:"semibold",color:"base.300",flexShrink:0,children:t(e.categoryTKey)}),i.jsx(T,{flexDir:"column",gap:2,pl:4,children:e.tags.map(s=>i.jsx(pN,{tag:s},s.label))})]})});hN.displayName="TagCategory";const pN=c.memo(({tag:e,...t})=>{const n=G(),{t:s}=M(),r=A(GS).includes(e.label),a=Exe(e.label),l=c.useCallback(()=>{n(eee(e.label))},[n,e]);return a===0?null:i.jsxs(T,{alignItems:"center",gap:2,children:[i.jsx(_n,{isChecked:r,onChange:l,...t,flexShrink:0}),i.jsx(W,{children:`${e.label} (${a})`}),e.recommended&&i.jsx(Oe,{label:s("workflows.recommended"),children:i.jsx(Ce,{as:"span",lineHeight:0,children:i.jsx(at,{as:Ay,boxSize:4,fill:"invokeYellow.500"})})})]})});pN.displayName="TagCheckbox";const fN=c.memo(({searchInputRef:e})=>{const t=G(),n=A(vP),{t:s}=M(),o=c.useCallback(d=>{t(M4(d))},[t]),r=c.useCallback(()=>{t(M4(""))},[t]),a=c.useCallback(d=>{d.key==="Escape"&&r()},[r]),l=c.useCallback(d=>{o(d.target.value)},[o]);return c.useEffect(()=>{e.current&&e.current.focus()},[e]),i.jsx(T,{justifyContent:"flex-end",w:"300px",children:i.jsxs(Cr,{children:[i.jsx(St,{ref:e,placeholder:s("workflows.searchPlaceholder"),value:n,onKeyDown:a,onChange:l}),n&&n.length&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{onClick:r,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:i.jsx(Rt,{})})})]})})});fN.displayName="WorkflowSearch";const Lxe=Ve.enum(["opened_at","created_at","updated_at","name"]),Dxe=e=>Lxe.safeParse(e).success,Rxe=Ve.enum(["ASC","DESC"]),Oxe=e=>Rxe.safeParse(e).success,Nxe=()=>{const{t:e}=M(),t=A(CP),n=A(wP),s=re(tee),o=c.useMemo(()=>({opened_at:e("workflows.opened"),created_at:e("workflows.created"),updated_at:e("workflows.updated"),name:e("workflows.name")}),[e]),r=c.useMemo(()=>({ASC:e("workflows.ascending"),DESC:e("workflows.descending")}),[e]),a=G(),l=c.useCallback(u=>{Dxe(u.target.value)&&a(E4(u.target.value))},[a]),d=c.useCallback(u=>{Oxe(u.target.value)&&a(P4(u.target.value))},[a]);return c.useEffect(()=>{s.includes("opened_at")||(a(E4("name")),a(P4("ASC")))},[s,a]),i.jsxs(T,{flexDir:"row",gap:6,children:[i.jsxs(Q,{orientation:"horizontal",gap:0,w:"auto",children:[i.jsx(J,{children:e("common.orderBy")}),i.jsx(lo,{value:t??s[0],onChange:l,size:"sm",children:s.map(u=>i.jsx("option",{value:u,children:o[u]},u))})]}),i.jsxs(Q,{orientation:"horizontal",gap:0,w:"auto",children:[i.jsx(J,{children:e("common.direction")}),i.jsxs(lo,{value:n,onChange:d,size:"sm",children:[i.jsx("option",{value:"ASC",children:r.ASC}),i.jsx("option",{value:"DESC",children:r.DESC})]})]})]})},Fxe=()=>{const e=c.useRef(null),t=A(Ic);return i.jsxs(T,{gap:8,justifyContent:"space-between",children:[i.jsx(fN,{searchInputRef:e}),t!=="recent"&&i.jsx(Nxe,{})]})},mN=c.memo(()=>{const{t:e}=M();return i.jsx(Oe,{label:e("workflows.builder.publishedWorkflowsLocked"),closeOnScroll:!0,children:i.jsx(le,{size:"sm",cursor:"not-allowed",variant:"link",alignSelf:"stretch","aria-label":e("workflows.builder.publishedWorkflowsLocked"),icon:i.jsx(ife,{})})})});mN.displayName="LockedWorkflowIcon";const gN=c.memo(({workflow:e})=>{const t=I1e(),{t:n}=M(),s=c.useCallback(o=>{o.stopPropagation(),t(e)},[t,e]);return i.jsx(Oe,{label:n("workflows.copyShareLink"),closeOnScroll:!0,children:i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":n("workflows.copyShareLink"),onClick:s,icon:i.jsx(F7,{})})})});gN.displayName="ShareWorkflowButton";const Vj=Le(null),Bxe=()=>Vj.set(null),$xe=()=>c.useCallback(t=>{Vj.set(t)},[]),Vxe=()=>{Pt("DeleteWorkflowDialog");const{t:e}=M(),t=re(Vj),[n]=nee(),s=c.useCallback(async()=>{if(t)try{await n(t).unwrap(),ge({id:"WORKFLOW_DELETED",title:e("toast.workflowDeleted")})}catch{ge({id:`AUTH_ERROR_TOAST_${Ta.endpoints.deleteWorkflow.name}`,title:e("toast.problemDeletingWorkflow"),status:"error"})}},[n,e,t]);return i.jsx(ho,{isOpen:t!==null,onClose:Bxe,title:e("workflows.deleteWorkflow"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:i.jsx(W,{children:e("workflows.deleteWorkflow2")})})},zxe=({workflowId:e})=>{const{t}=M(),n=$xe(),s=c.useCallback(o=>{o.stopPropagation(),n(e)},[n,e]);return i.jsx(Oe,{label:t("workflows.delete"),closeOnScroll:!0,children:i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":t("workflows.delete"),onClick:s,colorScheme:"error",icon:i.jsx(lj,{})})})},Gxe=()=>{const{t:e}=M(),t=G(),[n,s]=see(),o=c.useCallback(()=>{ge({status:"error",description:e("nodes.downloadWorkflowError")})},[e]);return{downloadWorkflow:c.useCallback(async a=>{try{const{data:l}=await n(a);if(!l){o();return}const{workflow:d}=l,u=new Blob([JSON.stringify(d,null,2)]),h=document.createElement("a");h.href=URL.createObjectURL(u),h.download=`${d.name||"My Workflow"}.json`,document.body.appendChild(h),h.click(),h.remove(),t(SP())}catch{o()}},[t,o,n]),isLoading:s.isLoading}},Hxe=({workflowId:e})=>{const t=Gxe(),n=c.useCallback(o=>{o.stopPropagation(),t.downloadWorkflow(e)},[t,e]),{t:s}=M();return i.jsx(Oe,{label:s("workflows.download"),closeOnScroll:!0,children:i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.download"),onClick:n,icon:i.jsx(Lu,{}),isLoading:t.isLoading})})},Wxe=({workflowId:e})=>{const t=G(),n=ol(),{t:s}=M(),o=c.useCallback(r=>{r.stopPropagation(),n({type:"library",data:e,onSuccess:()=>{t(Za("edit"))}})},[t,n,e]);return i.jsx(Oe,{label:s("workflows.edit"),closeOnScroll:!0,children:i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.edit"),onClick:o,icon:i.jsx(Iy,{})})})},Uxe=({workflowId:e})=>{const t=G(),n=ol(),{t:s}=M(),o=c.useCallback(r=>{r.stopPropagation(),n({type:"library",data:e,onSuccess:()=>{t(Za("view"))}})},[t,n,e]);return i.jsx(Oe,{label:s("workflows.view"),closeOnScroll:!0,children:i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.view"),onClick:o,icon:i.jsx(Du,{})})})},Va="108px",xN="32px",yN="workflow-action-buttons",qxe={_hover:{bg:"base.700",[`& .${yN}`]:{display:"flex"}}},bN=c.memo(({workflow:e})=>{const{t}=M(),n=G(),s=A(Ax),o=ol(),r=c.useMemo(()=>s===e.workflow_id,[s,e.workflow_id]),a=c.useCallback(()=>{o({type:"library",data:e.workflow_id,onSuccess:()=>{n(Za("view"))}})},[n,o,e.workflow_id]);return i.jsxs(T,{position:"relative",role:"button",onClick:a,bg:"base.750",borderRadius:"base",w:"full",alignItems:"stretch",sx:qxe,gap:2,children:[i.jsx(T,{p:2,pr:0,children:i.jsx(Zt,{src:e.thumbnail_url??void 0,fallbackStrategy:"beforeLoadOrError",fallback:e.category==="default"?i.jsx(CN,{}):i.jsx(vN,{}),objectFit:"cover",objectPosition:"50% 50%",height:Va,width:Va,minHeight:Va,minWidth:Va,borderRadius:"base"})}),i.jsxs(T,{flexDir:"column",gap:1,justifyContent:"space-between",w:"full",children:[i.jsxs(T,{flexDir:"column",gap:1,alignItems:"flex-start",pt:2,pe:2,w:"full",children:[i.jsxs(T,{gap:2,alignItems:"flex-start",justifyContent:"space-between",w:"full",children:[i.jsx(W,{noOfLines:2,children:e.name}),i.jsxs(T,{gap:2,alignItems:"center",children:[r&&!e.is_published&&i.jsx(Hn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,variant:"subtle",children:t("workflows.opened")}),e.is_published&&i.jsx(Hn,{color:"invokeGreen.400",borderColor:"invokeGreen.700",borderWidth:1,bg:"transparent",flexShrink:0,variant:"subtle",children:t("workflows.builder.published")}),e.category==="project"&&i.jsx(at,{as:cj,color:"base.200"}),e.category==="default"&&i.jsx(Zt,{src:HS,alt:"invoke-logo",w:"14px",h:"14px",minW:"14px",minH:"14px",userSelect:"none",opacity:.5})]})]}),i.jsx(W,{variant:"subtext",fontSize:"xs",noOfLines:3,children:e.description})]}),i.jsxs(T,{className:yN,alignItems:"center",display:"none",h:8,children:[e.opened_at&&i.jsxs(W,{variant:"subtext",fontSize:"xs",noOfLines:1,justifySelf:"flex-end",pb:.5,children:[t("workflows.opened")," ",new Date(e.opened_at).toLocaleString()]}),i.jsx(Je,{}),e.category==="default"&&!e.is_published&&i.jsx(Uxe,{workflowId:e.workflow_id}),e.category!=="default"&&!e.is_published&&i.jsxs(i.Fragment,{children:[i.jsx(Wxe,{workflowId:e.workflow_id}),i.jsx(Hxe,{workflowId:e.workflow_id}),i.jsx(zxe,{workflowId:e.workflow_id})]}),e.category==="project"&&i.jsx(gN,{workflow:e}),e.is_published&&i.jsx(mN,{})]})]})]})});bN.displayName="WorkflowListItem";const vN=c.memo(()=>i.jsx(T,{height:Va,minWidth:Va,bg:"base.600",borderRadius:"base",alignItems:"center",justifyContent:"center",opacity:.3,children:i.jsx(at,{as:hj,boxSize:xN})}));vN.displayName="UserThumbnailFallback";const CN=c.memo(()=>i.jsx(T,{height:Va,minWidth:Va,bg:"base.600",borderRadius:"base",alignItems:"center",justifyContent:"center",opacity:.3,children:i.jsx(Zt,{src:HS,alt:"invoke-logo",userSelect:"none",boxSize:xN,p:1})}));CN.displayName="DefaultThumbnailFallback";const Kxe=30,Zxe=e=>{switch(e){case"defaults":return["default"];case"recent":return["user","project","default"];case"yours":return["user","project"];case"private":return["user"];case"shared":return["project"];case"published":return["user","project","default"];default:ve(!1)}},Yxe=e=>{if(e==="recent")return!0},Xxe=()=>{const e=A(CP),t=A(wP),n=A(vP),s=A(GS),o=A(Ic),[r]=ml(n,500);return c.useMemo(()=>({page:0,per_page:Kxe,order_by:e??"opened_at",direction:t,categories:Zxe(o),query:r,tags:o==="defaults"?s:[],has_been_opened:Yxe(o),is_published:o==="published"?!0:void 0}),[e,t,o,r,s])},Qxe={selectFromResult:({data:e,...t})=>({items:(e==null?void 0:e.pages.map(({items:n})=>n).flat())??Fs,...t})},wN=c.memo(()=>{const e=Xxe(),{items:t,isFetching:n,isLoading:s,fetchNextPage:o,hasNextPage:r}=iee(e,Qxe);return s?i.jsx(T,{alignItems:"center",justifyContent:"center",w:"full",h:"full",children:i.jsx(ci,{})}):t.length===0?i.jsx(SN,{}):i.jsx(kN,{items:t,hasNextPage:r,fetchNextPage:o,isFetching:n})});wN.displayName="WorkflowList";const SN=c.memo(()=>{const{t:e}=M(),t=A(oee);return i.jsx(Ot,{fontSize:"sm",py:4,label:e(t?"nodes.noMatchingWorkflows":"nodes.noWorkflows"),icon:null})});SN.displayName="NoItems";const kN=c.memo(({items:e,hasNextPage:t,isFetching:n,fetchNextPage:s})=>{const{t:o}=M(),r=c.useRef(null),a=c.useCallback(()=>{if(!t||n)return;const d=r.current;if(!d)return;const{scrollTop:u,scrollHeight:h,clientHeight:p}=d;Math.abs(h-(u+p))<=1&&s()},[t,n,s]),l=c.useCallback(()=>{!t||n||!r.current||s()},[t,n,s]);return i.jsxs(T,{flexDir:"column",gap:4,flex:1,minH:0,children:[i.jsx(Mi,{ref:r,templateColumns:"repeat(auto-fill, minmax(360px, 1fr))",gridAutoFlow:"dense",gap:4,overflow:"scroll",onScroll:a,children:e.map(d=>i.jsx(vt,{id:`grid-${d.workflow_id}`,children:i.jsx(bN,{workflow:d},d.workflow_id)},d.workflow_id))}),i.jsx(Je,{}),t&&i.jsx(de,{onClick:l,isLoading:n,loadingText:o("common.loading"),variant:"ghost",w:"min-content",alignSelf:"center",children:o("workflows.loadMore")})]})});kN.displayName="WorkflowListContent";const jN=c.memo(()=>{const{t:e}=M(),t=Vx(),n=Jxe();return i.jsxs(Oi,{isOpen:t.isOpen,onClose:t.close,isCentered:!0,children:[i.jsx(di,{}),i.jsxs(Ni,{w:"calc(100% - var(--invoke-sizes-40))",maxW:"calc(100% - var(--invoke-sizes-40))",h:"calc(100% - var(--invoke-sizes-40))",maxH:"calc(100% - var(--invoke-sizes-40))",children:[i.jsx(ui,{children:e("workflows.workflowLibrary")}),i.jsx(Do,{}),i.jsxs(Ks,{pb:6,children:[n&&i.jsxs(T,{gap:4,h:"100%",children:[i.jsx(Axe,{}),i.jsx(Ct,{orientation:"vertical"}),i.jsxs(T,{flexDir:"column",flex:1,gap:4,children:[i.jsx(Fxe,{}),i.jsx(wN,{})]})]}),!n&&i.jsx(Ot,{label:e("workflows.loading"),icon:null})]})]})]})});jN.displayName="WorkflowLibraryModal";const Jxe=()=>{const e=G(),t=A(Ic),n=re(zS),[s,o]=c.useState(!1),r=c.useMemo(()=>({categories:["user","project","default"],has_been_opened:!0}),[]),a=c.useMemo(()=>({categories:["user","project"]}),[]),l=c.useMemo(()=>({selectFromResult:({data:f,isLoading:m})=>f?{count:Object.values(f).reduce((g,x)=>g+x,0),isLoading:m}:{count:0,isLoading:!0}}),[]),{count:d,isLoading:u}=L4(r,l),{count:h,isLoading:p}=L4(a,l);return c.useEffect(()=>{s||u||p||(d===0&&t==="recent"?h>0?e(Sp("yours")):e(Sp("defaults")):h===0&&(t==="yours"||t==="shared"||t==="private")&&(d>0?e(Sp("recent")):e(Sp("defaults"))),o(!0))},[n,s,e,u,p,d,t,h]),s},eye=()=>{const{t:e}=M(),{data:t}=uo(),n=re(Jn),[s,{isLoading:o}]=ree({fixedCacheKey:"cancelAllExceptCurrent"}),r=c.useCallback(async()=>{if(t!=null&&t.queue.pending)try{await s().unwrap(),ge({id:"QUEUE_CANCEL_SUCCEEDED",title:e("queue.cancelSucceeded"),status:"success"})}catch{ge({id:"QUEUE_CANCEL_FAILED",title:e("queue.cancelFailed"),status:"error"})}},[t==null?void 0:t.queue.pending,s,e]),a=c.useMemo(()=>!n||!(t!=null&&t.queue.pending),[n,t==null?void 0:t.queue.pending]);return{cancelAllExceptCurrentQueueItem:r,isLoading:o,queueStatus:t,isDisabled:a}},[tye]=jc(!1),Lm=()=>{const e=tye(),{cancelAllExceptCurrentQueueItem:t,isLoading:n,isDisabled:s,queueStatus:o}=eye();return{cancelAllExceptCurrentQueueItem:t,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:n,queueStatus:o,isDisabled:s}},_N=c.memo(()=>{Pt("CancelAllExceptCurrentQueueItemConfirmationAlertDialog");const{t:e}=M(),t=Lm();return i.jsxs(ho,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.cancelAllExceptCurrentTooltip"),acceptCallback:t.cancelAllExceptCurrentQueueItem,acceptButtonText:e("queue.confirm"),useInert:!1,children:[i.jsx(W,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog")}),i.jsx("br",{}),i.jsx(W,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog2")})]})});_N.displayName="CancelAllExceptCurrentQueueItemConfirmationAlertDialog";const[nye]=jc(!1),Dm=()=>{const e=nye(),{clearQueue:t,isLoading:n,isDisabled:s,queueStatus:o}=WD();return{clearQueue:t,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:n,queueStatus:o,isDisabled:s}},IN=c.memo(()=>{Pt("ClearQueueConfirmationsAlertDialog");const{t:e}=M(),t=Dm();return i.jsxs(ho,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.clearTooltip"),acceptCallback:t.clearQueue,acceptButtonText:e("queue.clear"),useInert:!1,children:[i.jsx(W,{children:e("queue.clearQueueAlertDialog")}),i.jsx("br",{}),i.jsx(W,{children:e("queue.clearQueueAlertDialog2")})]})});IN.displayName="ClearQueueConfirmationsAlertDialog";const zj=Le(null),sye=()=>zj.set(null),iye=()=>c.useCallback(t=>{zj.set(t)},[]),TN=c.memo(()=>{Pt("DeleteStylePresetDialog");const{t:e}=M(),t=re(zj),[n]=aee(),s=c.useCallback(async()=>{if(t)try{await n(t.id).unwrap(),ge({status:"success",title:e("stylePresets.templateDeleted")})}catch{ge({status:"error",title:e("stylePresets.unableToDeleteTemplate")})}},[t,n,e]);return i.jsx(ho,{isOpen:t!==null,onClose:sye,title:e("stylePresets.deleteTemplate"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:i.jsx(W,{children:e("stylePresets.deleteTemplate2")})})});TN.displayName="DeleteStylePresetDialog";const oye=e=>{const{field:t}=ws(e),{t:n}=M(),s=c.useCallback(l=>{const d=l[0];d&&t.onChange(d)},[t]),o=c.useCallback(()=>{t.onChange(null)},[t]),{getInputProps:r,getRootProps:a}=da({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:s,noDrag:!0,multiple:!1});return t.value?i.jsxs(Ce,{position:"relative",flexShrink:0,children:[i.jsx(Zt,{src:URL.createObjectURL(t.value),objectFit:"cover",objectPosition:"50% 50%",w:65,h:65,minWidth:65,borderRadius:"base"}),i.jsx(le,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:o,"aria-label":n("stylePresets.deleteImage"),tooltip:n("stylePresets.deleteImage"),icon:i.jsx(Zs,{}),size:"md",variant:"ghost"})]}):i.jsxs(i.Fragment,{children:[i.jsx(Oe,{label:n("stylePresets.uploadImage"),children:i.jsx(T,{as:de,w:65,h:65,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...a(),children:i.jsx(at,{as:jm,w:8,h:8})})}),i.jsx("input",{...r()})]})},r6=e=>{const{field:t}=ws(e),n=c.useRef(null),{t:s}=M(),o=c.useCallback(d=>{t.onChange(d.target.value)},[t]),r=c.useMemo(()=>t.value,[t.value]),a=c.useCallback(()=>{var d;if(n.current){const u=n.current.selectionStart,h=r.slice(0,u),p=r.slice(u),f=h+Jl+p;t.onChange(f)}else t.onChange(r+Jl);(d=n.current)==null||d.focus()},[r,t,n]),l=c.useMemo(()=>r==null?void 0:r.includes(Jl),[r]);return i.jsxs(Q,{orientation:"vertical",gap:3,children:[i.jsxs(T,{alignItems:"center",gap:2,children:[i.jsx(J,{children:e.label}),i.jsx(de,{onClick:a,size:"xs","aria-label":s("stylePresets.insertPlaceholder"),isDisabled:l,children:s("stylePresets.insertPlaceholder")})]}),i.jsx(ls,{size:"sm",ref:n,value:r,onChange:o})]})},a6=[{label:Me("stylePresets.private"),value:"user"},{label:Me("stylePresets.shared"),value:"project"}],rye=e=>{var a;const{field:t}=ws(e),n=re(Ja),{t:s}=M(),o=c.useCallback(l=>{l&&t.onChange(l.value)},[t]),r=c.useMemo(()=>a6.find(l=>l.value===t.value),[t.value]);return i.jsxs(Q,{orientation:"vertical",maxW:48,isDisabled:((a=n.prefilledFormData)==null?void 0:a.type)==="project",children:[i.jsx(J,{children:s("stylePresets.type")}),i.jsx(Ke,{value:r,options:a6,onChange:o})]})},aye=({updatingStylePresetId:e,formData:t})=>{const[n,{isLoading:s}]=lee(),[o,{isLoading:r}]=cee(),{t:a}=M(),l=A(kP),{handleSubmit:d,control:u,register:h,formState:p}=Am({defaultValues:t||{name:"",positivePrompt:"",negativePrompt:"",image:null,type:"user"},mode:"onChange"}),f=c.useCallback(async m=>{const g={data:{name:m.name,positive_prompt:m.positivePrompt,negative_prompt:m.negativePrompt,type:m.type},image:m.image};try{e?await o({id:e,...g}).unwrap():await n(g).unwrap()}catch{ge({status:"error",title:"Failed to save style preset"})}Ja.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[e,o,n]);return i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsxs(T,{alignItems:"center",gap:4,children:[i.jsx(oye,{control:u,name:"image"}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:a("stylePresets.name")}),i.jsx(St,{size:"md",...h("name",{required:!0,minLength:1})})]})]}),i.jsx(r6,{label:a("stylePresets.positivePrompt"),control:u,name:"positivePrompt"}),i.jsx(r6,{label:a("stylePresets.negativePrompt"),control:u,name:"negativePrompt"}),i.jsxs(Ce,{children:[i.jsx(W,{variant:"subtext",children:a("stylePresets.promptTemplatesDesc1")}),i.jsx(W,{variant:"subtext",children:i.jsx(Wt,{i18nKey:"stylePresets.promptTemplatesDesc2",components:{Pre:i.jsx(lye,{})},values:{placeholder:Jl}})}),i.jsx(W,{variant:"subtext",children:a("stylePresets.promptTemplatesDesc3")})]}),i.jsxs(T,{justifyContent:"space-between",alignItems:"flex-end",gap:10,children:[l?i.jsx(rye,{control:u,name:"type"}):i.jsx(Je,{}),i.jsx(de,{onClick:d(f),isDisabled:!p.isValid,isLoading:s||r,children:a("common.save")})]})]})},lye=e=>i.jsx(W,{as:"span",fontFamily:"monospace",fontWeight:"semibold",children:e.children}),cye=()=>{Pt("StylePresetModal");const[e,t]=c.useState(null),{t:n}=M(),s=re(Ja),o=c.useMemo(()=>s.updatingStylePresetId?n("stylePresets.updatePromptTemplate"):n("stylePresets.createPromptTemplate"),[s.updatingStylePresetId,n]),r=c.useCallback(()=>{Ja.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[]);return c.useEffect(()=>{t(null)},[]),c.useEffect(()=>{(async l=>{if(!l)t(null);else{let d=null;if(l.imageUrl)try{const u=await Hy(l.imageUrl);u&&(d=new File([u],"style_preset.png",{type:"image/png"}))}catch{}t({...l,image:d})}})(s.prefilledFormData)},[s.prefilledFormData]),i.jsxs(Oi,{isOpen:s.isModalOpen,onClose:r,isCentered:!0,size:"2xl",useInert:!1,children:[i.jsx(di,{}),i.jsxs(Ni,{children:[i.jsx(ui,{children:o}),i.jsx(Do,{}),i.jsx(Ks,{display:"flex",flexDir:"column",gap:4,children:!s.prefilledFormData||e?i.jsx(aye,{updatingStylePresetId:s.updatingStylePresetId,formData:e}):i.jsx(ci,{})}),i.jsx(wr,{p:2})]})]})},[AN]=jc(!1),dye=()=>{Pt("RefreshAfterResetModal");const{t:e}=M(),[t,n]=c.useState(3),s=AN();return c.useEffect(()=>{if(!s.isTrue)return;const o=window.setInterval(()=>n(r=>r-1),1e3);return()=>{window.clearInterval(o)}},[s.isTrue]),c.useEffect(()=>{t<=0&&window.location.reload()},[t]),i.jsx(i.Fragment,{children:i.jsxs(Oi,{closeOnOverlayClick:!1,isOpen:s.isTrue,onClose:s.setFalse,isCentered:!0,closeOnEsc:!1,useInert:!1,children:[i.jsx(di,{backdropFilter:"blur(40px)"}),i.jsxs(Ni,{children:[i.jsx(ui,{}),i.jsx(Ks,{children:i.jsx(T,{justifyContent:"center",children:i.jsx(W,{fontSize:"lg",children:i.jsxs(W,{children:[e("settings.resetComplete")," ",e("settings.reloadingIn")," ",t,"..."]})})})}),i.jsx(wr,{})]})]})})},uye=c.memo(dye),MN=[{tKey:"creatingYourFirstImage",link:"https://www.youtube.com/watch?v=jVi2XgSGrfY&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=1&t=29s&pp=iAQB",length:{minutes:6,seconds:0}},{tKey:"usingControlLayersAndReferenceGuides",link:"https://www.youtube.com/watch?v=crgw6bEgyrw&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=2&t=70s&pp=iAQB",length:{minutes:5,seconds:30}},{tKey:"understandingImageToImageAndDenoising",link:"https://www.youtube.com/watch?v=tvj8-0s6S2U&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=3&t=1s&pp=iAQB",length:{minutes:2,seconds:37}},{tKey:"exploringAIModelsAndConceptAdapters",link:"https://www.youtube.com/watch?v=iwBmBQMZ0UA&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=4&pp=iAQB",length:{minutes:8,seconds:52}},{tKey:"creatingAndComposingOnInvokesControlCanvas",link:"https://www.youtube.com/watch?v=O4LaFcYFxlA",length:{minutes:2,seconds:52}},{tKey:"upscaling",link:"https://www.youtube.com/watch?v=OCb19_P0nro&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=6&t=2s&pp=iAQB",length:{minutes:4,seconds:0}}],hye=[{tKey:"howDoIGenerateAndSaveToTheGallery",link:"https://youtu.be/Tl-69JvwJ2s?si=dbjmBc1iDAUpE1k5&t=26",length:{minutes:0,seconds:49}},{tKey:"howDoIEditOnTheCanvas",link:"https://youtu.be/Tl-69JvwJ2s?si=U_bFl9HsvSuejbxp&t=76",length:{minutes:0,seconds:58}},{tKey:"howDoIDoImageToImageTransformation",link:"https://youtu.be/Tl-69JvwJ2s?si=fjhTeY-yZ3qsEzEM&t=138",length:{minutes:0,seconds:51}},{tKey:"howDoIUseControlNetsAndControlLayers",link:"https://youtu.be/Tl-69JvwJ2s?si=x5KcYvkHbvR9ifsX&t=192",length:{minutes:1,seconds:41}},{tKey:"howDoIUseGlobalIPAdaptersAndReferenceImages",link:"https://youtu.be/Tl-69JvwJ2s?si=O940rNHiHGKXknK2&t=297",length:{minutes:0,seconds:43}},{tKey:"howDoIUseInpaintMasks",link:"https://youtu.be/Tl-69JvwJ2s?si=3DZhmerkzUmvJJSn&t=345",length:{minutes:1,seconds:9}},{tKey:"howDoIOutpaint",link:"https://youtu.be/Tl-69JvwJ2s?si=IIwkGZLq1PfLf80Q&t=420",length:{minutes:0,seconds:48}}],pye="https://www.youtube.com/playlist?list=PLvWK1Kc8iXGq_8tWZqnwDVaf9uhlDC09U",EN=c.memo(e=>i.jsx(T,{ps:2,pb:4,position:"sticky",zIndex:1,top:0,bg:"base.800",sx:e.sx,children:i.jsx(zt,{size:"sm",children:e.title})}));EN.displayName="StickyScrollableHeading";const PN=c.memo(e=>i.jsx(T,{p:4,borderRadius:"base",bg:"base.750",flexDir:"column",gap:4,sx:e.sx,children:e.children}));PN.displayName="StickyScrollableContent";const Ko=c.memo(e=>i.jsxs(T,{flexDir:"column",children:[i.jsx(EN,{title:e.title,sx:e.headingSx}),i.jsx(PN,{sx:e.contentSx,children:e.children})]},e.title));Ko.displayName="StickyScrollable";const Gj=bS("system/videoModalLinkClicked"),fye=bS("system/videoModalOpened"),mye=({minutes:e,seconds:t})=>`${e}:${t.toString().padStart(2,"0")}`,LN=c.memo(({video:e})=>{const{t}=M(),n=G(),{tKey:s,link:o,length:r}=e,a=c.useCallback(()=>{n(Gj(t(`supportVideos.videos.${s}.title`)))},[n,t,s]);return i.jsxs(T,{flexDir:"column",gap:1,children:[i.jsxs(T,{alignItems:"center",gap:2,children:[i.jsx(W,{fontSize:"md",fontWeight:"semibold",children:t(`supportVideos.videos.${s}.title`)}),i.jsx(Je,{}),i.jsx(W,{variant:"subtext",children:mye(r)}),i.jsx(ii,{fontSize:"sm",href:o,label:t("supportVideos.watch"),onClick:a})]}),i.jsx(W,{fontSize:"md",variant:"subtext",children:t(`supportVideos.videos.${s}.description`)})]})});LN.displayName="VideoCard";const iw=c.memo(({category:e,videos:t})=>i.jsx(Ko,{title:e,children:t.map((n,s)=>i.jsxs(c.Fragment,{children:[i.jsx(LN,{video:n}),s<MN.length-1&&i.jsx(Ct,{})]},`${n.tKey}-${s}`))}));iw.displayName="VideoCardList";const ow="http://github.com/invoke-ai/InvokeAI",Hj="https://discord.gg/ZmtBAhwWhy",l6="https://www.invoke.com/",[DN]=gP(!1),gye=()=>{const e=G(),t=c.useCallback(()=>{e(Gj("Studio session playlist"))},[e]);return i.jsx(ii,{fontWeight:"semibold",href:pye,display:"inline-flex",label:"Studio Sessions playlist",onClick:t})},xye=()=>{const e=G(),t=c.useCallback(()=>{e(Gj("Discord"))},[e]);return i.jsx(ii,{fontWeight:"semibold",href:Hj,display:"inline-flex",label:"Discord",onClick:t})},c6={StudioSessionsPlaylistLink:i.jsx(gye,{}),DiscordLink:i.jsx(xye,{})},RN=c.memo(()=>{const{t:e}=M(),t=DN();return i.jsxs(Oi,{isOpen:t.isOpen,onClose:t.close,size:"2xl",isCentered:!0,useInert:!1,children:[i.jsx(di,{}),i.jsxs(Ni,{maxH:"80vh",h:"80vh",children:[i.jsx(ui,{bg:"none",children:e("supportVideos.supportVideos")}),i.jsx(Do,{}),i.jsx(Ks,{children:i.jsx(ns,{children:i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsxs(T,{flexDir:"column",gap:2,pb:2,children:[i.jsx(W,{fontSize:"md",children:i.jsx(Wt,{i18nKey:"supportVideos.studioSessionsDesc1",components:c6})}),i.jsx(W,{fontSize:"md",children:i.jsx(Wt,{i18nKey:"supportVideos.studioSessionsDesc2",components:c6})})]}),i.jsx(iw,{category:e("supportVideos.gettingStarted"),videos:MN}),i.jsx(iw,{category:e("supportVideos.controlCanvas"),videos:hye})]})})}),i.jsx(wr,{})]})]})});RN.displayName="VideosModal";const Nv=Le(!1),ON=()=>{const e=re(Nv),t=c.useCallback(()=>{Nv.set(!0)},[]),n=c.useCallback(()=>{Nv.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},yye=()=>{const{t:e}=M(),{isOpen:t,onClose:n}=ON(),s=ol(),[o,r]=c.useState(""),[a,l]=c.useState(),[d,u]=c.useState(""),[h,p]=c.useState(!0),f=c.useCallback(C=>{r(C.target.value)},[]),m=c.useCallback(C=>{l(C.target.value)},[]),g=c.useCallback(C=>{p(C.target.checked)},[]),x=c.useCallback(()=>{const C=JSON.parse(o),y=dee(C,h);l(y),u(JSON.stringify(y,null,2))},[o,h]),b=c.useCallback(async()=>{await s({type:"object",data:a}),n()},[s,a,n]);return i.jsxs(Oi,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[i.jsx(di,{}),i.jsxs(Ni,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[i.jsx(ui,{children:e("workflows.loadFromGraph")}),i.jsx(Do,{}),i.jsxs(Ks,{as:T,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[i.jsxs(T,{gap:4,children:[i.jsx(de,{onClick:x,size:"sm",flexShrink:0,children:e("workflows.convertGraph")}),i.jsxs(Q,{children:[i.jsx(J,{children:e("workflows.autoLayout")}),i.jsx(_n,{isChecked:h,onChange:g})]}),i.jsx(Je,{}),i.jsx(de,{onClick:b,size:"sm",flexShrink:0,children:e("workflows.loadWorkflow")})]}),i.jsxs(Q,{orientation:"vertical",h:"50%",children:[i.jsx(J,{children:e("nodes.graph")}),i.jsx(ls,{h:"full",value:o,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:f})]}),i.jsxs(Q,{orientation:"vertical",h:"50%",children:[i.jsx(J,{children:e("nodes.workflow")}),i.jsx(ls,{h:"full",value:d,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:m})]})]})]})]})},NN=()=>{const e=cn();return c.useCallback(()=>{const{nodes:n,form:s}=Xe(e.getState());return uee(s,n)},[e])},bye=e=>!e.id&&e.meta.category!=="default",vye=()=>{const{t:e}=M(),t=G(),[n,{isLoading:s,isError:o}]=hee(),[r]=pee(),a=NN(),l=Lx(),d=c.useRef();return{createNewWorkflow:c.useCallback(async({workflow:h,onSuccess:p,onError:f})=>{d.current=l({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{const m=await n(h).unwrap(),{id:g,name:x,meta:{category:b}}=m.workflow;t(fee(g)),t(jP(x)),t(mee(b)),t(gee({category:b})),t(_P({formFieldInitialValues:a()})),r({workflow_id:g}),p&&p(),l.update(d.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{f&&f(),l.isActive(`auth-error-toast-${Ta.endpoints.createWorkflow.name}`)?l.close(d.current):l.update(d.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}},[l,e,n,t,a,r]),isLoading:s,isError:o}},vf=Le(null),Cye=jn(vf,e=>e!==null),wye=e=>e.id?e.name.length?`${e.name.trim()} (copy)`:"":e.name,FN=e=>{vf.set(gt(e))},Sye=()=>{const e=re(Cye),t=re(vf),n=c.useRef(null),s=c.useCallback(()=>{vf.set(null)},[]);return i.jsxs(pP,{isOpen:e,onClose:s,leastDestructiveRef:n,isCentered:!0,children:[!t&&i.jsx($N,{}),t&&i.jsx(BN,{workflow:t,cancelRef:n})]})},BN=c.memo(({workflow:e,cancelRef:t})=>{const n=re(zS),[s,o]=c.useState(()=>e?wye(e):""),[r,a]=c.useState(()=>n.includes("project")),{createNewWorkflow:l}=vye(),d=c.useRef(null),u=c.useCallback(m=>{o(m.target.value)},[]),h=c.useCallback(m=>{a(m.target.checked)},[a]),p=c.useCallback(()=>{vf.set(null)},[]),f=c.useCallback(async()=>{e.id=void 0,e.name=s,e.meta.category=r?"project":"user",e.is_published=!1,ve(bye(e)),await l({workflow:e,onSuccess:p,onError:p})},[e,s,r,l,p]);return i.jsxs(RS,{children:[i.jsx(ui,{fontSize:"lg",fontWeight:"bold",children:Me("workflows.saveWorkflowAs")}),i.jsx(Ks,{children:i.jsxs(Q,{alignItems:"flex-start",children:[i.jsx(J,{mt:"2",children:Me("workflows.workflowName")}),i.jsxs(T,{flexDir:"column",width:"full",gap:"2",children:[i.jsx(St,{ref:d,value:s,onChange:u,placeholder:Me("workflows.workflowName")}),n.includes("project")&&i.jsx(_n,{isChecked:r,onChange:h,children:i.jsx(J,{children:Me("workflows.saveWorkflowToProject")})})]})]})}),i.jsxs(wr,{children:[i.jsx(de,{ref:t,onClick:p,children:Me("common.cancel")}),i.jsx(de,{colorScheme:"invokeBlue",onClick:f,ml:3,isDisabled:!s||!s.length,children:Me("common.saveAs")})]})]})});BN.displayName="Content";const $N=c.memo(()=>i.jsx(RS,{children:i.jsx(Ot,{icon:null,label:"No workflow to save"})}));$N.displayName="NoWorkflowToSaveContent";const VN=c.memo(()=>i.jsxs(i.Fragment,{children:[i.jsx(H0e,{}),i.jsx(Bge,{}),i.jsx(TO,{}),i.jsx(cye,{}),i.jsx(jN,{}),i.jsx(_N,{}),i.jsx(IN,{}),i.jsx(YO,{}),i.jsx(xee,{}),i.jsx(TN,{}),i.jsx(Vxe,{}),i.jsx(T1e,{}),i.jsx(uye,{}),i.jsx(f1e,{}),i.jsx(eO,{}),i.jsx(CO,{}),i.jsx(wO,{}),i.jsx(UO,{}),i.jsx(jO,{}),i.jsx(RN,{}),i.jsx(Sye,{}),i.jsx(Xo,{children:i.jsx(gO,{})}),i.jsx(yye,{})]}));VN.displayName="GlobalModalIsolator";const zN=()=>c.useCallback(()=>{yee(),localStorage.clear()},[]),kye={position:"relative",'&[data-highlighted="true"]::after':{borderColor:"blue.700"},"&::after":{content:'""',position:"absolute",inset:0,zIndex:1,borderRadius:"base",border:"2px solid",borderColor:"transparent",pointerEvents:"none",transition:"border-color 0.1s ease-in-out"}},$u=c.memo(({region:e,focusOnMount:t=!1,sx:n,children:s,...o})=>{const r=A(IP),a=c.useRef(null),l=c.useMemo(()=>({focusOnMount:t}),[t]);bm(e,a,l);const u=Os(e)&&r;return i.jsx(Ce,{ref:a,tabIndex:-1,sx:c.useMemo(()=>({...kye,...n}),[n]),"data-highlighted":u,...o,children:s})});$u.displayName="FocusRegionWrapper";const GN=c.memo(()=>{const{t:e}=M();return A(TP)?i.jsxs(wc,{status:"warning",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[i.jsx(Sc,{}),i.jsx(nm,{children:e("controlLayers.settings.preserveMask.alert")})]}):null});GN.displayName="CanvasAlertsPreserveMask";const ua=c.memo(e=>{const t=c.useMemo(()=>bee(e.entityIdentifier),[e.entityIdentifier]);return A(t)?e.children:null});ua.displayName="CanvasEntityStateGate";const Lc=c.createContext(null),We=e=>{const t=c.useContext(Lc);return ve(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),e&&ve(t.type===e,"useEntityIdentifier must be used with the correct type"),t},Rm=c.createContext(null),HN=c.memo(({children:e})=>{const t=Lt(),n=We(),s=c.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),o=c.useMemo(()=>s.get(n.id)??null,[s,n.id]);return o?i.jsx(Rm.Provider,{value:o,children:e}):null});HN.displayName="RasterLayerAdapterGate";const WN=c.memo(({children:e})=>{const t=Lt(),n=We(),s=c.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),o=c.useMemo(()=>s.get(n.id)??null,[s,n.id]);return o?i.jsx(Rm.Provider,{value:o,children:e}):null});WN.displayName="ControlLayerAdapterGate";const UN=c.memo(({children:e})=>{const t=Lt(),n=We(),s=c.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot),o=c.useMemo(()=>s.get(n.id)??null,[s,n.id]);return o?i.jsx(Rm.Provider,{value:o,children:e}):null});UN.displayName="InpaintMaskAdapterGate";const qN=c.memo(({children:e})=>{const t=Lt(),n=We(),s=c.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),o=c.useMemo(()=>s.get(n.id)??null,[s,n.id]);return o?i.jsx(Rm.Provider,{value:o,children:e}):null}),jye=e=>{const t=c.useContext(Rm);return ve(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),ve(t.entityIdentifier.type===e,"useEntityIdentifier must be used with the correct type"),t};qN.displayName="RegionalGuidanceAdapterGate";const Tr=e=>{const t=Lt(),n=c.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),s=c.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),o=c.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),r=c.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot);return c.useMemo(()=>e?e.type==="raster_layer"?s.get(e.id)??null:e.type==="control_layer"?o.get(e.id)??null:e.type==="inpaint_mask"?r.get(e.id)??null:e.type==="regional_guidance"?n.get(e.id)??null:null:null,[o,e,r,s,n])},_ye=e=>{const t=Tr(e);return ve(t,"useEntityAdapter must be used within a EntityAdapterContext"),t},Iye=()=>{const e=Lt(),t=c.useSyncExternalStore(e.adapters.regionMasks.subscribe,e.adapters.regionMasks.getSnapshot),n=c.useSyncExternalStore(e.adapters.rasterLayers.subscribe,e.adapters.rasterLayers.getSnapshot),s=c.useSyncExternalStore(e.adapters.controlLayers.subscribe,e.adapters.controlLayers.getSnapshot),o=c.useSyncExternalStore(e.adapters.inpaintMasks.subscribe,e.adapters.inpaintMasks.getSnapshot);return c.useMemo(()=>[...Array.from(n.values()),...Array.from(s.values()),...Array.from(o.values()),...Array.from(t.values())],[s,o,n,t])},Tye=e=>he(Ye,t=>{const n=rl(t,e);return n?n.name:null}),KN=e=>{const t=c.useMemo(()=>Tye(e),[e]);return A(t)},ZN=e=>{const{t}=M();return c.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.inpaintMask");case"control_layer":return t("controlLayers.controlLayer");case"raster_layer":return t("controlLayers.rasterLayer");case"reference_image":return t("controlLayers.globalReferenceImage");case"regional_guidance":return t("controlLayers.regionalGuidance");default:ve(!1,"Unexpected entity type")}},[e,t])},YN=e=>{const t=KN(e),n=ZN(e.type);return c.useMemo(()=>t||n,[t,n])},Wj=e=>{const t=c.useMemo(()=>he(Ye,s=>{switch(e){case"control_layer":return s.controlLayers.isHidden;case"raster_layer":return s.rasterLayers.isHidden;case"inpaint_mask":return s.inpaintMasks.isHidden;case"regional_guidance":return s.regionalGuidance.isHidden;case"reference_image":default:return!1}}),[e]);return A(t)},Aye=Le(!1),Mye=e=>he(Ye,t=>Cs(t,e,"CanvasAlertsSelectedEntityStatusContent").isEnabled),Eye=e=>he(Ye,t=>Cs(t,e,"CanvasAlertsSelectedEntityStatusContent").isLocked),XN=c.memo(({entityIdentifier:e,adapter:t})=>{var m;const{t:n}=M(),s=YN(e),o=c.useMemo(()=>Mye(e),[e]),r=c.useMemo(()=>Eye(e),[e]),a=A(o),l=A(r),d=Wj(e.type),u=re(((m=t.filterer)==null?void 0:m.$isFiltering)??Aye),h=re(t.transformer.$isTransforming),p=re(t.$isEmpty),f=c.useMemo(()=>u?{status:"info",title:n("controlLayers.HUD.entityStatus.isFiltering",{title:s})}:h?{status:"info",title:n("controlLayers.HUD.entityStatus.isTransforming",{title:s})}:p?{status:"info",title:n("controlLayers.HUD.entityStatus.isEmpty",{title:s})}:d?{status:"warning",title:n("controlLayers.HUD.entityStatus.isHidden",{title:s})}:l?{status:"warning",title:n("controlLayers.HUD.entityStatus.isLocked",{title:s})}:a?null:{status:"warning",title:n("controlLayers.HUD.entityStatus.isDisabled",{title:s})},[u,h,p,d,l,a,s,n]);return f?i.jsxs(wc,{status:f.status,borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[i.jsx(Sc,{}),i.jsx(nm,{children:f.title})]}):null});XN.displayName="CanvasAlertsSelectedEntityStatusContent";const QN=c.memo(()=>{const e=A(Mn),t=Tr(e);return!e||!t?null:i.jsx(ua,{entityIdentifier:e,children:i.jsx(XN,{entityIdentifier:e,adapter:t})})});QN.displayName="CanvasAlertsSelectedEntityStatus";const Uj=()=>{const{destination:e}=vee(void 0,{selectFromResult:({data:t})=>({destination:t?t.destination:null})});return e};function Pye(e){if(typeof Proxy>"u")return e;const t=new Map,n=(...s)=>e(...s);return new Proxy(n,{get:(s,o)=>o==="create"?e:(t.has(o)||t.set(o,e(o)),t.get(o))})}function Cf(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const rw=e=>Array.isArray(e);function JN(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}function wf(e){return typeof e=="string"||Array.isArray(e)}function d6(e){const t=[{},{}];return e==null||e.values.forEach((n,s)=>{t[0][s]=n.get(),t[1][s]=n.getVelocity()}),t}function qj(e,t,n,s){if(typeof t=="function"){const[o,r]=d6(s);t=t(n!==void 0?n:e.custom,o,r)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[o,r]=d6(s);t=t(n!==void 0?n:e.custom,o,r)}return t}function Wy(e,t,n){const s=e.getProps();return qj(s,t,n!==void 0?n:s.custom,e)}const Kj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Zj=["initial",...Kj],Om=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],gl=new Set(Om),Yr=e=>e*1e3,Xr=e=>e/1e3,Lye={type:"spring",stiffness:500,damping:25,restSpeed:10},Dye=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Rye={type:"keyframes",duration:.8},Oye={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Nye=(e,{keyframes:t})=>t.length>2?Rye:gl.has(e)?e.startsWith("scale")?Dye(t[1]):Lye:Oye;function Yj(e,t){return e[t]||e.default||e}const Fye={useManualTiming:!1},Bye=e=>e!==null;function Uy(e,{repeat:t,repeatType:n="loop"},s){const o=e.filter(Bye),r=t&&n!=="loop"&&t%2===1?0:o.length-1;return!r||s===void 0?o[r]:s}const Ns=e=>e;function $ye(e){let t=new Set,n=new Set,s=!1,o=!1;const r=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function l(u){r.has(u)&&(d.schedule(u),e()),u(a)}const d={schedule:(u,h=!1,p=!1)=>{const m=p&&s?t:n;return h&&r.add(u),m.has(u)||m.add(u),u},cancel:u=>{n.delete(u),r.delete(u)},process:u=>{if(a=u,s){o=!0;return}s=!0,[t,n]=[n,t],n.clear(),t.forEach(l),s=!1,o&&(o=!1,d.process(u))}};return d}const Og=["read","resolveKeyframes","update","preRender","render","postRender"],Vye=40;function eF(e,t){let n=!1,s=!0;const o={delta:0,timestamp:0,isProcessing:!1},r=()=>n=!0,a=Og.reduce((C,y)=>(C[y]=$ye(r),C),{}),{read:l,resolveKeyframes:d,update:u,preRender:h,render:p,postRender:f}=a,m=()=>{const C=performance.now();n=!1,o.delta=s?1e3/60:Math.max(Math.min(C-o.timestamp,Vye),1),o.timestamp=C,o.isProcessing=!0,l.process(o),d.process(o),u.process(o),h.process(o),p.process(o),f.process(o),o.isProcessing=!1,n&&t&&(s=!1,e(m))},g=()=>{n=!0,s=!0,o.isProcessing||e(m)};return{schedule:Og.reduce((C,y)=>{const v=a[y];return C[y]=(w,k=!1,S=!1)=>(n||g(),v.schedule(w,k,S)),C},{}),cancel:C=>{for(let y=0;y<Og.length;y++)a[Og[y]].cancel(C)},state:o,steps:a}}const{schedule:Xt,cancel:el,state:ms,steps:Fv}=eF(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ns,!0),tF=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,zye=1e-7,Gye=12;function Hye(e,t,n,s,o){let r,a,l=0;do a=t+(n-t)/2,r=tF(a,s,o)-e,r>0?n=a:t=a;while(Math.abs(r)>zye&&++l<Gye);return a}function Nm(e,t,n,s){if(e===t&&n===s)return Ns;const o=r=>Hye(r,0,1,e,n);return r=>r===0||r===1?r:tF(o(r),t,s)}const nF=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,sF=e=>t=>1-e(1-t),iF=Nm(.33,1.53,.69,.99),Xj=sF(iF),oF=nF(Xj),rF=e=>(e*=2)<1?.5*Xj(e):.5*(2-Math.pow(2,-10*(e-1))),Qj=e=>1-Math.sin(Math.acos(e)),aF=sF(Qj),lF=nF(Qj),cF=e=>/^0[^.\s]+$/u.test(e);function Wye(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||cF(e):!0}let dF=Ns;const uF=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),hF=e=>t=>typeof t=="string"&&t.startsWith(e),pF=hF("--"),Uye=hF("var(--"),Jj=e=>Uye(e)?qye.test(e.split("/*")[0].trim()):!1,qye=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Kye=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Zye(e){const t=Kye.exec(e);if(!t)return[,];const[,n,s,o]=t;return[`--${n??s}`,o]}function fF(e,t,n=1){const[s,o]=Zye(e);if(!s)return;const r=window.getComputedStyle(t).getPropertyValue(s);if(r){const a=r.trim();return uF(a)?parseFloat(a):a}return Jj(o)?fF(o,t,n+1):o}const tl=(e,t,n)=>n>t?t:n<e?e:n,Vu={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Sf={...Vu,transform:e=>tl(0,1,e)},Ng={...Vu,default:1},Fm=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),va=Fm("deg"),cr=Fm("%"),nt=Fm("px"),Yye=Fm("vh"),Xye=Fm("vw"),u6={...cr,parse:e=>cr.parse(e)/100,transform:e=>cr.transform(e*100)},Qye=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),h6=e=>e===Vu||e===nt,p6=(e,t)=>parseFloat(e.split(", ")[t]),f6=(e,t)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const o=s.match(/^matrix3d\((.+)\)$/u);if(o)return p6(o[1],t);{const r=s.match(/^matrix\((.+)\)$/u);return r?p6(r[1],e):0}},Jye=new Set(["x","y","z"]),ebe=Om.filter(e=>!Jye.has(e));function tbe(e){const t=[];return ebe.forEach(n=>{const s=e.getValue(n);s!==void 0&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}const ou={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:f6(4,13),y:f6(5,14)};ou.translateX=ou.x;ou.translateY=ou.y;const mF=e=>t=>t.test(e),nbe={test:e=>e==="auto",parse:e=>e},gF=[Vu,nt,cr,va,Xye,Yye,nbe],m6=e=>gF.find(mF(e)),nc=new Set;let aw=!1,lw=!1;function xF(){if(lw){const e=Array.from(nc).filter(s=>s.needsMeasurement),t=new Set(e.map(s=>s.element)),n=new Map;t.forEach(s=>{const o=tbe(s);o.length&&(n.set(s,o),s.render())}),e.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const o=n.get(s);o&&o.forEach(([r,a])=>{var l;(l=s.getValue(r))===null||l===void 0||l.set(a)})}),e.forEach(s=>s.measureEndState()),e.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}lw=!1,aw=!1,nc.forEach(e=>e.complete()),nc.clear()}function yF(){nc.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(lw=!0)})}function sbe(){yF(),xF()}class e_{constructor(t,n,s,o,r,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=s,this.motionValue=o,this.element=r,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(nc.add(this),aw||(aw=!0,Xt.read(yF),Xt.resolveKeyframes(xF))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:s,motionValue:o}=this;for(let r=0;r<t.length;r++)if(t[r]===null)if(r===0){const a=o==null?void 0:o.get(),l=t[t.length-1];if(a!==void 0)t[0]=a;else if(s&&n){const d=s.readValue(n,l);d!=null&&(t[0]=d)}t[0]===void 0&&(t[0]=l),o&&a===void 0&&o.set(t[0])}else t[r]=t[r-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),nc.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,nc.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const zp=e=>Math.round(e*1e5)/1e5,t_=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ibe(e){return e==null}const obe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,n_=(e,t)=>n=>!!(typeof n=="string"&&obe.test(n)&&n.startsWith(e)||t&&!ibe(n)&&Object.prototype.hasOwnProperty.call(n,t)),bF=(e,t,n)=>s=>{if(typeof s!="string")return s;const[o,r,a,l]=s.match(t_);return{[e]:parseFloat(o),[t]:parseFloat(r),[n]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},rbe=e=>tl(0,255,e),Bv={...Vu,transform:e=>Math.round(rbe(e))},Wl={test:n_("rgb","red"),parse:bF("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:s=1})=>"rgba("+Bv.transform(e)+", "+Bv.transform(t)+", "+Bv.transform(n)+", "+zp(Sf.transform(s))+")"};function abe(e){let t="",n="",s="",o="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),o=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),o=e.substring(4,5),t+=t,n+=n,s+=s,o+=o),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:o?parseInt(o,16)/255:1}}const cw={test:n_("#"),parse:abe,transform:Wl.transform},jd={test:n_("hsl","hue"),parse:bF("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:s=1})=>"hsla("+Math.round(e)+", "+cr.transform(zp(t))+", "+cr.transform(zp(n))+", "+zp(Sf.transform(s))+")"},Ts={test:e=>Wl.test(e)||cw.test(e)||jd.test(e),parse:e=>Wl.test(e)?Wl.parse(e):jd.test(e)?jd.parse(e):cw.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Wl.transform(e):jd.transform(e)},lbe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function cbe(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(t_))===null||t===void 0?void 0:t.length)||0)+(((n=e.match(lbe))===null||n===void 0?void 0:n.length)||0)>0}const vF="number",CF="color",dbe="var",ube="var(",g6="${}",hbe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function kf(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},o=[];let r=0;const l=t.replace(hbe,d=>(Ts.test(d)?(s.color.push(r),o.push(CF),n.push(Ts.parse(d))):d.startsWith(ube)?(s.var.push(r),o.push(dbe),n.push(d)):(s.number.push(r),o.push(vF),n.push(parseFloat(d))),++r,g6)).split(g6);return{values:n,split:l,indexes:s,types:o}}function wF(e){return kf(e).values}function SF(e){const{split:t,types:n}=kf(e),s=t.length;return o=>{let r="";for(let a=0;a<s;a++)if(r+=t[a],o[a]!==void 0){const l=n[a];l===vF?r+=zp(o[a]):l===CF?r+=Ts.transform(o[a]):r+=o[a]}return r}}const pbe=e=>typeof e=="number"?0:e;function fbe(e){const t=wF(e);return SF(e)(t.map(pbe))}const nl={test:cbe,parse:wF,createTransformer:SF,getAnimatableNone:fbe},mbe=new Set(["brightness","contrast","saturate","opacity"]);function gbe(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=n.match(t_)||[];if(!s)return e;const o=n.replace(s,"");let r=mbe.has(t)?1:0;return s!==n&&(r*=100),t+"("+r+o+")"}const xbe=/\b([a-z-]*)\(.*?\)/gu,dw={...nl,getAnimatableNone:e=>{const t=e.match(xbe);return t?t.map(gbe).join(" "):e}},ybe={borderWidth:nt,borderTopWidth:nt,borderRightWidth:nt,borderBottomWidth:nt,borderLeftWidth:nt,borderRadius:nt,radius:nt,borderTopLeftRadius:nt,borderTopRightRadius:nt,borderBottomRightRadius:nt,borderBottomLeftRadius:nt,width:nt,maxWidth:nt,height:nt,maxHeight:nt,top:nt,right:nt,bottom:nt,left:nt,padding:nt,paddingTop:nt,paddingRight:nt,paddingBottom:nt,paddingLeft:nt,margin:nt,marginTop:nt,marginRight:nt,marginBottom:nt,marginLeft:nt,backgroundPositionX:nt,backgroundPositionY:nt},bbe={rotate:va,rotateX:va,rotateY:va,rotateZ:va,scale:Ng,scaleX:Ng,scaleY:Ng,scaleZ:Ng,skew:va,skewX:va,skewY:va,distance:nt,translateX:nt,translateY:nt,translateZ:nt,x:nt,y:nt,z:nt,perspective:nt,transformPerspective:nt,opacity:Sf,originX:u6,originY:u6,originZ:nt},x6={...Vu,transform:Math.round},s_={...ybe,...bbe,zIndex:x6,size:nt,fillOpacity:Sf,strokeOpacity:Sf,numOctaves:x6},vbe={...s_,color:Ts,backgroundColor:Ts,outlineColor:Ts,fill:Ts,stroke:Ts,borderColor:Ts,borderTopColor:Ts,borderRightColor:Ts,borderBottomColor:Ts,borderLeftColor:Ts,filter:dw,WebkitFilter:dw},i_=e=>vbe[e];function kF(e,t){let n=i_(e);return n!==dw&&(n=nl),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const Cbe=new Set(["auto","none","0"]);function wbe(e,t,n){let s=0,o;for(;s<e.length&&!o;){const r=e[s];typeof r=="string"&&!Cbe.has(r)&&kf(r).values.length&&(o=e[s]),s++}if(o&&n)for(const r of t)e[r]=kF(n,o)}class jF extends e_{constructor(t,n,s,o,r){super(t,n,s,o,r,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let d=0;d<t.length;d++){let u=t[d];if(typeof u=="string"&&(u=u.trim(),Jj(u))){const h=fF(u,n.current);h!==void 0&&(t[d]=h),d===t.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!Qye.has(s)||t.length!==2)return;const[o,r]=t,a=m6(o),l=m6(r);if(a!==l)if(h6(a)&&h6(l))for(let d=0;d<t.length;d++){const u=t[d];typeof u=="string"&&(t[d]=parseFloat(u))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,s=[];for(let o=0;o<t.length;o++)Wye(t[o])&&s.push(o);s.length&&wbe(t,s,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:s}=this;if(!t||!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ou[s](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const o=n[n.length-1];o!==void 0&&t.getValue(s,o).jump(o,!1)}measureEndState(){var t;const{element:n,name:s,unresolvedKeyframes:o}=this;if(!n||!n.current)return;const r=n.getValue(s);r&&r.jump(this.measuredOrigin,!1);const a=o.length-1,l=o[a];o[a]=ou[s](n.measureViewportBox(),window.getComputedStyle(n.current)),l!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=l),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([d,u])=>{n.getValue(d).set(u)}),this.resolveNoneKeyframes()}}function o_(e){return typeof e=="function"}let D0;function Sbe(){D0=void 0}const dr={now:()=>(D0===void 0&&dr.set(ms.isProcessing||Fye.useManualTiming?ms.timestamp:performance.now()),D0),set:e=>{D0=e,queueMicrotask(Sbe)}},y6=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(nl.test(e)||e==="0")&&!e.startsWith("url("));function kbe(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function jbe(e,t,n,s){const o=e[0];if(o===null)return!1;if(t==="display"||t==="visibility")return!0;const r=e[e.length-1],a=y6(o,t),l=y6(r,t);return!a||!l?!1:kbe(e)||(n==="spring"||o_(n))&&s}const _be=40;class _F{constructor({autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:o=0,repeatDelay:r=0,repeatType:a="loop",...l}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=dr.now(),this.options={autoplay:t,delay:n,type:s,repeat:o,repeatDelay:r,repeatType:a,...l},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>_be?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&sbe(),this._resolved}onKeyframesResolved(t,n){this.resolvedAt=dr.now(),this.hasAttemptedResolve=!0;const{name:s,type:o,velocity:r,delay:a,onComplete:l,onUpdate:d,isGenerator:u}=this.options;if(!u&&!jbe(t,s,o,r))if(a)this.options.duration=0;else{d==null||d(Uy(t,this.options,n)),l==null||l(),this.resolveFinishedPromise();return}const h=this.initPlayback(t,n);h!==!1&&(this._resolved={keyframes:t,finalKeyframe:n,...h},this.onPostResolved())}onPostResolved(){}then(t,n){return this.currentFinishedPromise.then(t,n)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function IF(e,t){return t?e*(1e3/t):0}const Ibe=5;function TF(e,t,n){const s=Math.max(t-Ibe,0);return IF(n-e(s),t-s)}const b6=.001,Tbe=.01,Abe=10,Mbe=.05,Ebe=1;function Pbe({duration:e=800,bounce:t=.25,velocity:n=0,mass:s=1}){let o,r,a=1-t;a=tl(Mbe,Ebe,a),e=tl(Tbe,Abe,Xr(e)),a<1?(o=u=>{const h=u*a,p=h*e,f=h-n,m=uw(u,a),g=Math.exp(-p);return b6-f/m*g},r=u=>{const p=u*a*e,f=p*n+n,m=Math.pow(a,2)*Math.pow(u,2)*e,g=Math.exp(-p),x=uw(Math.pow(u,2),a);return(-o(u)+b6>0?-1:1)*((f-m)*g)/x}):(o=u=>{const h=Math.exp(-u*e),p=(u-n)*e+1;return-.001+h*p},r=u=>{const h=Math.exp(-u*e),p=(n-u)*(e*e);return h*p});const l=5/e,d=Dbe(o,r,l);if(e=Yr(e),isNaN(d))return{stiffness:100,damping:10,duration:e};{const u=Math.pow(d,2)*s;return{stiffness:u,damping:a*2*Math.sqrt(s*u),duration:e}}}const Lbe=12;function Dbe(e,t,n){let s=n;for(let o=1;o<Lbe;o++)s=s-e(s)/t(s);return s}function uw(e,t){return e*Math.sqrt(1-t*t)}const Rbe=["duration","bounce"],Obe=["stiffness","damping","mass"];function v6(e,t){return t.some(n=>e[n]!==void 0)}function Nbe(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!v6(e,Obe)&&v6(e,Rbe)){const n=Pbe(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}function AF({keyframes:e,restDelta:t,restSpeed:n,...s}){const o=e[0],r=e[e.length-1],a={done:!1,value:o},{stiffness:l,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:f}=Nbe({...s,velocity:-Xr(s.velocity||0)}),m=p||0,g=d/(2*Math.sqrt(l*u)),x=r-o,b=Xr(Math.sqrt(l/u)),C=Math.abs(x)<5;n||(n=C?.01:2),t||(t=C?.005:.5);let y;if(g<1){const v=uw(b,g);y=w=>{const k=Math.exp(-g*b*w);return r-k*((m+g*b*x)/v*Math.sin(v*w)+x*Math.cos(v*w))}}else if(g===1)y=v=>r-Math.exp(-b*v)*(x+(m+b*x)*v);else{const v=b*Math.sqrt(g*g-1);y=w=>{const k=Math.exp(-g*b*w),S=Math.min(v*w,300);return r-k*((m+g*b*x)*Math.sinh(S)+v*x*Math.cosh(S))/v}}return{calculatedDuration:f&&h||null,next:v=>{const w=y(v);if(f)a.done=v>=h;else{let k=0;g<1&&(k=v===0?Yr(m):TF(y,v,w));const S=Math.abs(k)<=n,P=Math.abs(r-w)<=t;a.done=S&&P}return a.value=a.done?r:w,a}}}function C6({keyframes:e,velocity:t=0,power:n=.8,timeConstant:s=325,bounceDamping:o=10,bounceStiffness:r=500,modifyTarget:a,min:l,max:d,restDelta:u=.5,restSpeed:h}){const p=e[0],f={done:!1,value:p},m=E=>l!==void 0&&E<l||d!==void 0&&E>d,g=E=>l===void 0?d:d===void 0||Math.abs(l-E)<Math.abs(d-E)?l:d;let x=n*t;const b=p+x,C=a===void 0?b:a(b);C!==b&&(x=C-p);const y=E=>-x*Math.exp(-E/s),v=E=>C+y(E),w=E=>{const L=y(E),I=v(E);f.done=Math.abs(L)<=u,f.value=f.done?C:I};let k,S;const P=E=>{m(f.value)&&(k=E,S=AF({keyframes:[f.value,g(f.value)],velocity:TF(v,E,f.value),damping:o,stiffness:r,restDelta:u,restSpeed:h}))};return P(0),{calculatedDuration:null,next:E=>{let L=!1;return!S&&k===void 0&&(L=!0,w(E),P(E)),k!==void 0&&E>=k?S.next(E-k):(!L&&w(E),f)}}}const Fbe=Nm(.42,0,1,1),Bbe=Nm(0,0,.58,1),MF=Nm(.42,0,.58,1),$be=e=>Array.isArray(e)&&typeof e[0]!="number",Vbe={linear:Ns,easeIn:Fbe,easeInOut:MF,easeOut:Bbe,circIn:Qj,circInOut:lF,circOut:aF,backIn:Xj,backInOut:oF,backOut:iF,anticipate:rF},w6=e=>{if(Array.isArray(e)){dF(e.length===4);const[t,n,s,o]=e;return Nm(t,n,s,o)}else if(typeof e=="string")return Vbe[e];return e},zbe=(e,t)=>n=>t(e(n)),Qr=(...e)=>e.reduce(zbe),ru=(e,t,n)=>{const s=t-e;return s===0?1:(n-e)/s},kn=(e,t,n)=>e+(t-e)*n;function $v(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Gbe({hue:e,saturation:t,lightness:n,alpha:s}){e/=360,t/=100,n/=100;let o=0,r=0,a=0;if(!t)o=r=a=n;else{const l=n<.5?n*(1+t):n+t-n*t,d=2*n-l;o=$v(d,l,e+1/3),r=$v(d,l,e),a=$v(d,l,e-1/3)}return{red:Math.round(o*255),green:Math.round(r*255),blue:Math.round(a*255),alpha:s}}function k1(e,t){return n=>n>0?t:e}const Vv=(e,t,n)=>{const s=e*e,o=n*(t*t-s)+s;return o<0?0:Math.sqrt(o)},Hbe=[cw,Wl,jd],Wbe=e=>Hbe.find(t=>t.test(e));function S6(e){const t=Wbe(e);if(!t)return!1;let n=t.parse(e);return t===jd&&(n=Gbe(n)),n}const k6=(e,t)=>{const n=S6(e),s=S6(t);if(!n||!s)return k1(e,t);const o={...n};return r=>(o.red=Vv(n.red,s.red,r),o.green=Vv(n.green,s.green,r),o.blue=Vv(n.blue,s.blue,r),o.alpha=kn(n.alpha,s.alpha,r),Wl.transform(o))},hw=new Set(["none","hidden"]);function Ube(e,t){return hw.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function qbe(e,t){return n=>kn(e,t,n)}function r_(e){return typeof e=="number"?qbe:typeof e=="string"?Jj(e)?k1:Ts.test(e)?k6:Ybe:Array.isArray(e)?EF:typeof e=="object"?Ts.test(e)?k6:Kbe:k1}function EF(e,t){const n=[...e],s=n.length,o=e.map((r,a)=>r_(r)(r,t[a]));return r=>{for(let a=0;a<s;a++)n[a]=o[a](r);return n}}function Kbe(e,t){const n={...e,...t},s={};for(const o in n)e[o]!==void 0&&t[o]!==void 0&&(s[o]=r_(e[o])(e[o],t[o]));return o=>{for(const r in s)n[r]=s[r](o);return n}}function Zbe(e,t){var n;const s=[],o={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){const a=t.types[r],l=e.indexes[a][o[a]],d=(n=e.values[l])!==null&&n!==void 0?n:0;s[r]=d,o[a]++}return s}const Ybe=(e,t)=>{const n=nl.createTransformer(t),s=kf(e),o=kf(t);return s.indexes.var.length===o.indexes.var.length&&s.indexes.color.length===o.indexes.color.length&&s.indexes.number.length>=o.indexes.number.length?hw.has(e)&&!o.values.length||hw.has(t)&&!s.values.length?Ube(e,t):Qr(EF(Zbe(s,o),o.values),n):k1(e,t)};function PF(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?kn(e,t,n):r_(e)(e,t)}function Xbe(e,t,n){const s=[],o=n||PF,r=e.length-1;for(let a=0;a<r;a++){let l=o(e[a],e[a+1]);if(t){const d=Array.isArray(t)?t[a]||Ns:t;l=Qr(d,l)}s.push(l)}return s}function Qbe(e,t,{clamp:n=!0,ease:s,mixer:o}={}){const r=e.length;if(dF(r===t.length),r===1)return()=>t[0];if(r===2&&e[0]===e[1])return()=>t[1];e[0]>e[r-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=Xbe(t,s,o),l=a.length,d=u=>{let h=0;if(l>1)for(;h<e.length-2&&!(u<e[h+1]);h++);const p=ru(e[h],e[h+1],u);return a[h](p)};return n?u=>d(tl(e[0],e[r-1],u)):d}function Jbe(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const o=ru(0,t,s);e.push(kn(n,1,o))}}function eve(e){const t=[0];return Jbe(t,e.length-1),t}function tve(e,t){return e.map(n=>n*t)}function nve(e,t){return e.map(()=>t||MF).splice(0,e.length-1)}function j1({duration:e=300,keyframes:t,times:n,ease:s="easeInOut"}){const o=$be(s)?s.map(w6):w6(s),r={done:!1,value:t[0]},a=tve(n&&n.length===t.length?n:eve(t),e),l=Qbe(a,t,{ease:Array.isArray(o)?o:nve(t,o)});return{calculatedDuration:e,next:d=>(r.value=l(d),r.done=d>=e,r)}}const j6=2e4;function sve(e){let t=0;const n=50;let s=e.next(t);for(;!s.done&&t<j6;)t+=n,s=e.next(t);return t>=j6?1/0:t}const ive=e=>{const t=({timestamp:n})=>e(n);return{start:()=>Xt.update(t,!0),stop:()=>el(t),now:()=>ms.isProcessing?ms.timestamp:dr.now()}},ove={decay:C6,inertia:C6,tween:j1,keyframes:j1,spring:AF},rve=e=>e/100;class a_ extends _F{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:d}=this.options;d&&d()};const{name:n,motionValue:s,element:o,keyframes:r}=this.options,a=(o==null?void 0:o.KeyframeResolver)||e_,l=(d,u)=>this.onKeyframesResolved(d,u);this.resolver=new a(r,l,n,s,o),this.resolver.scheduleResolve()}initPlayback(t){const{type:n="keyframes",repeat:s=0,repeatDelay:o=0,repeatType:r,velocity:a=0}=this.options,l=o_(n)?n:ove[n]||j1;let d,u;l!==j1&&typeof t[0]!="number"&&(d=Qr(rve,PF(t[0],t[1])),t=[0,100]);const h=l({...this.options,keyframes:t});r==="mirror"&&(u=l({...this.options,keyframes:[...t].reverse(),velocity:-a})),h.calculatedDuration===null&&(h.calculatedDuration=sve(h));const{calculatedDuration:p}=h,f=p+o,m=f*(s+1)-o;return{generator:h,mirroredGenerator:u,mapPercentToKeyframes:d,calculatedDuration:p,resolvedDuration:f,totalDuration:m}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,n=!1){const{resolved:s}=this;if(!s){const{keyframes:E}=this.options;return{done:!0,value:E[E.length-1]}}const{finalKeyframe:o,generator:r,mirroredGenerator:a,mapPercentToKeyframes:l,keyframes:d,calculatedDuration:u,totalDuration:h,resolvedDuration:p}=s;if(this.startTime===null)return r.next(0);const{delay:f,repeat:m,repeatType:g,repeatDelay:x,onUpdate:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-h/this.speed,this.startTime)),n?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const C=this.currentTime-f*(this.speed>=0?1:-1),y=this.speed>=0?C<0:C>h;this.currentTime=Math.max(C,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let v=this.currentTime,w=r;if(m){const E=Math.min(this.currentTime,h)/p;let L=Math.floor(E),I=E%1;!I&&E>=1&&(I=1),I===1&&L--,L=Math.min(L,m+1),!!(L%2)&&(g==="reverse"?(I=1-I,x&&(I-=x/p)):g==="mirror"&&(w=a)),v=tl(0,1,I)*p}const k=y?{done:!1,value:d[0]}:w.next(v);l&&(k.value=l(k.value));let{done:S}=k;!y&&u!==null&&(S=this.speed>=0?this.currentTime>=h:this.currentTime<=0);const P=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return P&&o!==void 0&&(k.value=Uy(d,this.options,o)),b&&b(k.value),P&&this.finish(),k}get duration(){const{resolved:t}=this;return t?Xr(t.calculatedDuration):0}get time(){return Xr(this.currentTime)}set time(t){t=Yr(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Xr(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=ive,onPlay:n,startTime:s}=this.options;this.driver||(this.driver=t(r=>this.tick(r))),n&&n();const o=this.driver.now();this.holdTime!==null?this.startTime=o-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=o):this.startTime=s??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const LF=new Set(["opacity","clipPath","filter","transform"]),DF=e=>Array.isArray(e)&&typeof e[0]=="number",ave=10,lve=(e,t)=>{let n="";const s=Math.max(Math.round(t/ave),2);for(let o=0;o<s;o++)n+=e(ru(0,s-1,o))+", ";return`linear(${n.substring(0,n.length-2)})`};function l_(e){let t;return()=>(t===void 0&&(t=e()),t)}const cve={linearEasing:void 0};function dve(e,t){const n=l_(e);return()=>{var s;return(s=cve[t])!==null&&s!==void 0?s:n()}}const _1=dve(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing");function RF(e){return!!(typeof e=="function"&&_1()||!e||typeof e=="string"&&(e in pw||_1())||DF(e)||Array.isArray(e)&&e.every(RF))}const Tp=([e,t,n,s])=>`cubic-bezier(${e}, ${t}, ${n}, ${s})`,pw={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Tp([0,.65,.55,1]),circOut:Tp([.55,0,1,.45]),backIn:Tp([.31,.01,.66,-.59]),backOut:Tp([.33,1.53,.69,.99])};function OF(e,t){if(e)return typeof e=="function"&&_1()?lve(e,t):DF(e)?Tp(e):Array.isArray(e)?e.map(n=>OF(n,t)||pw.easeOut):pw[e]}function uve(e,t,n,{delay:s=0,duration:o=300,repeat:r=0,repeatType:a="loop",ease:l,times:d}={}){const u={[t]:n};d&&(u.offset=d);const h=OF(l,o);return Array.isArray(h)&&(u.easing=h),e.animate(u,{delay:s,duration:o,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:r+1,direction:a==="reverse"?"alternate":"normal"})}function _6(e,t){e.timeline=t,e.onfinish=null}const hve=l_(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),I1=10,pve=2e4;function fve(e){return o_(e.type)||e.type==="spring"||!RF(e.ease)}function mve(e,t){const n=new a_({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:e[0]};const o=[];let r=0;for(;!s.done&&r<pve;)s=n.sample(r),o.push(s.value),r+=I1;return{times:void 0,keyframes:o,duration:r-I1,ease:"linear"}}const NF={anticipate:rF,backInOut:oF,circInOut:lF};function gve(e){return e in NF}class I6 extends _F{constructor(t){super(t);const{name:n,motionValue:s,element:o,keyframes:r}=this.options;this.resolver=new jF(r,(a,l)=>this.onKeyframesResolved(a,l),n,s,o),this.resolver.scheduleResolve()}initPlayback(t,n){var s;let{duration:o=300,times:r,ease:a,type:l,motionValue:d,name:u,startTime:h}=this.options;if(!(!((s=d.owner)===null||s===void 0)&&s.current))return!1;if(typeof a=="string"&&_1()&&gve(a)&&(a=NF[a]),fve(this.options)){const{onComplete:f,onUpdate:m,motionValue:g,element:x,...b}=this.options,C=mve(t,b);t=C.keyframes,t.length===1&&(t[1]=t[0]),o=C.duration,r=C.times,a=C.ease,l="keyframes"}const p=uve(d.owner.current,u,t,{...this.options,duration:o,times:r,ease:a});return p.startTime=h??this.calcStartTime(),this.pendingTimeline?(_6(p,this.pendingTimeline),this.pendingTimeline=void 0):p.onfinish=()=>{const{onComplete:f}=this.options;d.set(Uy(t,this.options,n)),f&&f(),this.cancel(),this.resolveFinishedPromise()},{animation:p,duration:o,times:r,type:l,ease:a,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:n}=t;return Xr(n)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:n}=t;return Xr(n.currentTime||0)}set time(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=Yr(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:n}=t;return n.playbackRate}set speed(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:n}=t;return n.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:n}=t;return n.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:n}=this;if(!n)return Ns;const{animation:s}=n;_6(s,t)}return Ns}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:n,keyframes:s,duration:o,type:r,ease:a,times:l}=t;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:u,onUpdate:h,onComplete:p,element:f,...m}=this.options,g=new a_({...m,keyframes:s,duration:o,type:r,ease:a,times:l,isGenerator:!0}),x=Yr(this.time);u.setWithVelocity(g.sample(x-I1).value,g.sample(x).value,I1)}const{onStop:d}=this.options;d&&d(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:n,name:s,repeatDelay:o,repeatType:r,damping:a,type:l}=t;return hve()&&s&&LF.has(s)&&n&&n.owner&&n.owner.current instanceof HTMLElement&&!n.owner.getProps().onUpdate&&!o&&r!=="mirror"&&a!==0&&l!=="inertia"}}const xve=l_(()=>window.ScrollTimeline!==void 0);class yve{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}then(t,n){return Promise.all(this.animations).then(t).catch(n)}getAll(t){return this.animations[0][t]}setAll(t,n){for(let s=0;s<this.animations.length;s++)this.animations[s][t]=n}attachTimeline(t,n){const s=this.animations.map(o=>xve()&&o.attachTimeline?o.attachTimeline(t):n(o));return()=>{s.forEach((o,r)=>{o&&o(),this.animations[r].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let n=0;n<this.animations.length;n++)t=Math.max(t,this.animations[n].duration);return t}runAll(t){this.animations.forEach(n=>n[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function bve({when:e,delay:t,delayChildren:n,staggerChildren:s,staggerDirection:o,repeat:r,repeatType:a,repeatDelay:l,from:d,elapsed:u,...h}){return!!Object.keys(h).length}const c_=(e,t,n,s={},o,r)=>a=>{const l=Yj(s,e)||{},d=l.delay||s.delay||0;let{elapsed:u=0}=s;u=u-Yr(d);let h={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-u,onUpdate:f=>{t.set(f),l.onUpdate&&l.onUpdate(f)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:r?void 0:o};bve(l)||(h={...h,...Nye(e,h)}),h.duration&&(h.duration=Yr(h.duration)),h.repeatDelay&&(h.repeatDelay=Yr(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let p=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(h.duration=0,h.delay===0&&(p=!0)),p&&!r&&t.get()!==void 0){const f=Uy(h.keyframes,l);if(f!==void 0)return Xt.update(()=>{h.onUpdate(f),h.onComplete()}),new yve([])}return!r&&I6.supports(h)?new I6(h):new a_(h)},vve=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),Cve=e=>rw(e)?e[e.length-1]||0:e;function d_(e,t){e.indexOf(t)===-1&&e.push(t)}function u_(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class h_{constructor(){this.subscriptions=[]}add(t){return d_(this.subscriptions,t),()=>u_(this.subscriptions,t)}notify(t,n,s){const o=this.subscriptions.length;if(o)if(o===1)this.subscriptions[0](t,n,s);else for(let r=0;r<o;r++){const a=this.subscriptions[r];a&&a(t,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const T6=30,wve=e=>!isNaN(parseFloat(e));class Sve{constructor(t,n={}){this.version="11.10.0",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,o=!0)=>{const r=dr.now();this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),o&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=dr.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=wve(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new h_);const s=this.events[t].add(n);return t==="change"?()=>{s(),Xt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t,n=!0){!n||!this.passiveEffect?this.updateAndNotify(t,n):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=dr.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>T6)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,T6);return IF(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function jf(e,t){return new Sve(e,t)}function kve(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,jf(n))}function jve(e,t){const n=Wy(e,t);let{transitionEnd:s={},transition:o={},...r}=n||{};r={...r,...s};for(const a in r){const l=Cve(r[a]);kve(e,a,l)}}const qy=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),_ve="framerAppearId",FF="data-"+qy(_ve);function BF(e){return e.props[FF]}const Ps=e=>!!(e&&e.getVelocity);function Ive(e){return!!(Ps(e)&&e.add)}function $F(e){if(gl.has(e))return"transform";if(LF.has(e))return qy(e)}function fw(e,t){var n;if(!e.applyWillChange)return;const s=e.getValue("willChange");if(Ive(s))return s.add(t);!(!((n=e.props.style)===null||n===void 0)&&n.willChange)&&$F(t)&&e.setStaticValue("willChange","transform")}function Tve({protectedKeys:e,needsAnimating:t},n){const s=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,s}function VF(e,t,{delay:n=0,transitionOverride:s,type:o}={}){var r;let{transition:a=e.getDefaultTransition(),transitionEnd:l,...d}=t;s&&(a=s);const u=[],h=o&&e.animationState&&e.animationState.getState()[o];for(const p in d){const f=e.getValue(p,(r=e.latestValues[p])!==null&&r!==void 0?r:null),m=d[p];if(m===void 0||h&&Tve(h,p))continue;const g={delay:n,...Yj(a||{},p)};let x=!1;if(window.MotionHandoffAnimation){const C=BF(e);if(C){const y=window.MotionHandoffAnimation(C,p,Xt);y!==null&&(g.startTime=y,x=!0)}}fw(e,p),f.start(c_(p,f,m,e.shouldReduceMotion&&gl.has(p)?{type:!1}:g,e,x));const b=f.animation;b&&u.push(b)}return l&&Promise.all(u).then(()=>{Xt.update(()=>{l&&jve(e,l)})}),u}function mw(e,t,n={}){var s;const o=Wy(e,t,n.type==="exit"?(s=e.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:r=e.getDefaultTransition()||{}}=o||{};n.transitionOverride&&(r=n.transitionOverride);const a=o?()=>Promise.all(VF(e,o,n)):()=>Promise.resolve(),l=e.variantChildren&&e.variantChildren.size?(u=0)=>{const{delayChildren:h=0,staggerChildren:p,staggerDirection:f}=r;return Ave(e,t,h+u,p,f,n)}:()=>Promise.resolve(),{when:d}=r;if(d){const[u,h]=d==="beforeChildren"?[a,l]:[l,a];return u().then(()=>h())}else return Promise.all([a(),l(n.delay)])}function Ave(e,t,n=0,s=0,o=1,r){const a=[],l=(e.variantChildren.size-1)*s,d=o===1?(u=0)=>u*s:(u=0)=>l-u*s;return Array.from(e.variantChildren).sort(Mve).forEach((u,h)=>{u.notify("AnimationStart",t),a.push(mw(u,t,{...r,delay:n+d(h)}).then(()=>u.notify("AnimationComplete",t)))}),Promise.all(a)}function Mve(e,t){return e.sortNodePosition(t)}function Eve(e,t,n={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const o=t.map(r=>mw(e,r,n));s=Promise.all(o)}else if(typeof t=="string")s=mw(e,t,n);else{const o=typeof t=="function"?Wy(e,t,n.custom):t;s=Promise.all(VF(e,o,n))}return s.then(()=>{e.notify("AnimationComplete",t)})}const Pve=Zj.length;function zF(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?zF(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<Pve;n++){const s=Zj[n],o=e.props[s];(wf(o)||o===!1)&&(t[s]=o)}return t}const Lve=[...Kj].reverse(),Dve=Kj.length;function Rve(e){return t=>Promise.all(t.map(({animation:n,options:s})=>Eve(e,n,s)))}function Ove(e){let t=Rve(e),n=A6(),s=!0;const o=d=>(u,h)=>{var p;const f=Wy(e,h,d==="exit"?(p=e.presenceContext)===null||p===void 0?void 0:p.custom:void 0);if(f){const{transition:m,transitionEnd:g,...x}=f;u={...u,...x,...g}}return u};function r(d){t=d(e)}function a(d){const{props:u}=e,h=zF(e.parent)||{},p=[],f=new Set;let m={},g=1/0;for(let b=0;b<Dve;b++){const C=Lve[b],y=n[C],v=u[C]!==void 0?u[C]:h[C],w=wf(v),k=C===d?y.isActive:null;k===!1&&(g=b);let S=v===h[C]&&v!==u[C]&&w;if(S&&s&&e.manuallyAnimateOnMount&&(S=!1),y.protectedKeys={...m},!y.isActive&&k===null||!v&&!y.prevProp||Cf(v)||typeof v=="boolean")continue;const P=Nve(y.prevProp,v);let E=P||C===d&&y.isActive&&!S&&w||b>g&&w,L=!1;const I=Array.isArray(v)?v:[v];let O=I.reduce(o(C),{});k===!1&&(O={});const{prevResolvedValues:N={}}=y,_={...N,...O},R=V=>{E=!0,f.has(V)&&(L=!0,f.delete(V)),y.needsAnimating[V]=!0;const ee=e.getValue(V);ee&&(ee.liveStyle=!1)};for(const V in _){const ee=O[V],se=N[V];if(m.hasOwnProperty(V))continue;let oe=!1;rw(ee)&&rw(se)?oe=!JN(ee,se):oe=ee!==se,oe?ee!=null?R(V):f.add(V):ee!==void 0&&f.has(V)?R(V):y.protectedKeys[V]=!0}y.prevProp=v,y.prevResolvedValues=O,y.isActive&&(m={...m,...O}),s&&e.blockInitialAnimation&&(E=!1),E&&(!(S&&P)||L)&&p.push(...I.map(V=>({animation:V,options:{type:C}})))}if(f.size){const b={};f.forEach(C=>{const y=e.getBaseTarget(C),v=e.getValue(C);v&&(v.liveStyle=!0),b[C]=y??null}),p.push({animation:b})}let x=!!p.length;return s&&(u.initial===!1||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(x=!1),s=!1,x?t(p):Promise.resolve()}function l(d,u){var h;if(n[d].isActive===u)return Promise.resolve();(h=e.variantChildren)===null||h===void 0||h.forEach(f=>{var m;return(m=f.animationState)===null||m===void 0?void 0:m.setActive(d,u)}),n[d].isActive=u;const p=a(d);for(const f in n)n[f].protectedKeys={};return p}return{animateChanges:a,setActive:l,setAnimateFunction:r,getState:()=>n,reset:()=>{n=A6(),s=!0}}}function Nve(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!JN(t,e):!1}function Il(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function A6(){return{animate:Il(!0),whileInView:Il(),whileHover:Il(),whileTap:Il(),whileDrag:Il(),whileFocus:Il(),exit:Il()}}class xl{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Fve extends xl{constructor(t){super(t),t.animationState||(t.animationState=Ove(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Cf(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let Bve=0;class $ve extends xl{constructor(){super(...arguments),this.id=Bve++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const o=this.node.animationState.setActive("exit",!t);n&&!t&&o.then(()=>n(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const Vve={animation:{Feature:Fve},exit:{Feature:$ve}},GF=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function Ky(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const zve=e=>t=>GF(t)&&e(t,Ky(t));function qr(e,t,n,s={passive:!0}){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}function Jr(e,t,n,s){return qr(e,t,zve(n),s)}const M6=(e,t)=>Math.abs(e-t);function Gve(e,t){const n=M6(e.x,t.x),s=M6(e.y,t.y);return Math.sqrt(n**2+s**2)}class HF{constructor(t,n,{transformPagePoint:s,contextWindow:o,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=Gv(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,m=Gve(p.offset,{x:0,y:0})>=3;if(!f&&!m)return;const{point:g}=p,{timestamp:x}=ms;this.history.push({...g,timestamp:x});const{onStart:b,onMove:C}=this.handlers;f||(b&&b(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),C&&C(this.lastMoveEvent,p)},this.handlePointerMove=(p,f)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=zv(f,this.transformPagePoint),Xt.update(this.updatePoint,!0)},this.handlePointerUp=(p,f)=>{this.end();const{onEnd:m,onSessionEnd:g,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=Gv(p.type==="pointercancel"?this.lastMoveEventInfo:zv(f,this.transformPagePoint),this.history);this.startEvent&&m&&m(p,b),g&&g(p,b)},!GF(t))return;this.dragSnapToOrigin=r,this.handlers=n,this.transformPagePoint=s,this.contextWindow=o||window;const a=Ky(t),l=zv(a,this.transformPagePoint),{point:d}=l,{timestamp:u}=ms;this.history=[{...d,timestamp:u}];const{onSessionStart:h}=n;h&&h(t,Gv(l,this.history)),this.removeListeners=Qr(Jr(this.contextWindow,"pointermove",this.handlePointerMove),Jr(this.contextWindow,"pointerup",this.handlePointerUp),Jr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),el(this.updatePoint)}}function zv(e,t){return t?{point:t(e.point)}:e}function E6(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Gv({point:e},t){return{point:e,delta:E6(e,WF(t)),offset:E6(e,Hve(t)),velocity:Wve(t,.1)}}function Hve(e){return e[0]}function WF(e){return e[e.length-1]}function Wve(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const o=WF(e);for(;n>=0&&(s=e[n],!(o.timestamp-s.timestamp>Yr(t)));)n--;if(!s)return{x:0,y:0};const r=Xr(o.timestamp-s.timestamp);if(r===0)return{x:0,y:0};const a={x:(o.x-s.x)/r,y:(o.y-s.y)/r};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function UF(e){let t=null;return()=>{const n=()=>{t=null};return t===null?(t=e,n):!1}}const P6=UF("dragHorizontal"),L6=UF("dragVertical");function qF(e){let t=!1;if(e==="y")t=L6();else if(e==="x")t=P6();else{const n=P6(),s=L6();n&&s?t=()=>{n(),s()}:(n&&n(),s&&s())}return t}function KF(){const e=qF(!0);return e?(e(),!1):!0}function _d(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}const ZF=1e-4,Uve=1-ZF,qve=1+ZF,YF=.01,Kve=0-YF,Zve=0+YF;function Li(e){return e.max-e.min}function Yve(e,t,n){return Math.abs(e-t)<=n}function D6(e,t,n,s=.5){e.origin=s,e.originPoint=kn(t.min,t.max,e.origin),e.scale=Li(n)/Li(t),e.translate=kn(n.min,n.max,e.origin)-e.originPoint,(e.scale>=Uve&&e.scale<=qve||isNaN(e.scale))&&(e.scale=1),(e.translate>=Kve&&e.translate<=Zve||isNaN(e.translate))&&(e.translate=0)}function Gp(e,t,n,s){D6(e.x,t.x,n.x,s?s.originX:void 0),D6(e.y,t.y,n.y,s?s.originY:void 0)}function R6(e,t,n){e.min=n.min+t.min,e.max=e.min+Li(t)}function Xve(e,t,n){R6(e.x,t.x,n.x),R6(e.y,t.y,n.y)}function O6(e,t,n){e.min=t.min-n.min,e.max=e.min+Li(t)}function Hp(e,t,n){O6(e.x,t.x,n.x),O6(e.y,t.y,n.y)}function Qve(e,{min:t,max:n},s){return t!==void 0&&e<t?e=s?kn(t,e,s.min):Math.max(e,t):n!==void 0&&e>n&&(e=s?kn(n,e,s.max):Math.min(e,n)),e}function N6(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Jve(e,{top:t,left:n,bottom:s,right:o}){return{x:N6(e.x,n,o),y:N6(e.y,t,s)}}function F6(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}function e2e(e,t){return{x:F6(e.x,t.x),y:F6(e.y,t.y)}}function t2e(e,t){let n=.5;const s=Li(e),o=Li(t);return o>s?n=ru(t.min,t.max-s,e.min):s>o&&(n=ru(e.min,e.max-o,t.min)),tl(0,1,n)}function n2e(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const gw=.35;function s2e(e=gw){return e===!1?e=0:e===!0&&(e=gw),{x:B6(e,"left","right"),y:B6(e,"top","bottom")}}function B6(e,t,n){return{min:$6(e,t),max:$6(e,n)}}function $6(e,t){return typeof e=="number"?e:e[t]||0}const V6=()=>({translate:0,scale:1,origin:0,originPoint:0}),Id=()=>({x:V6(),y:V6()}),z6=()=>({min:0,max:0}),Pn=()=>({x:z6(),y:z6()});function Ki(e){return[e("x"),e("y")]}function XF({top:e,left:t,right:n,bottom:s}){return{x:{min:t,max:n},y:{min:e,max:s}}}function i2e({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function o2e(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function Hv(e){return e===void 0||e===1}function xw({scale:e,scaleX:t,scaleY:n}){return!Hv(e)||!Hv(t)||!Hv(n)}function El(e){return xw(e)||QF(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function QF(e){return G6(e.x)||G6(e.y)}function G6(e){return e&&e!=="0%"}function T1(e,t,n){const s=e-n,o=t*s;return n+o}function H6(e,t,n,s,o){return o!==void 0&&(e=T1(e,o,s)),T1(e,n,s)+t}function yw(e,t=0,n=1,s,o){e.min=H6(e.min,t,n,s,o),e.max=H6(e.max,t,n,s,o)}function JF(e,{x:t,y:n}){yw(e.x,t.translate,t.scale,t.originPoint),yw(e.y,n.translate,n.scale,n.originPoint)}const W6=.999999999999,U6=1.0000000000001;function r2e(e,t,n,s=!1){const o=n.length;if(!o)return;t.x=t.y=1;let r,a;for(let l=0;l<o;l++){r=n[l],a=r.projectionDelta;const{visualElement:d}=r.options;d&&d.props.style&&d.props.style.display==="contents"||(s&&r.options.layoutScroll&&r.scroll&&r!==r.root&&Ad(e,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,JF(e,a)),s&&El(r.latestValues)&&Ad(e,r.latestValues))}t.x<U6&&t.x>W6&&(t.x=1),t.y<U6&&t.y>W6&&(t.y=1)}function Td(e,t){e.min=e.min+t,e.max=e.max+t}function q6(e,t,n,s,o=.5){const r=kn(e.min,e.max,o);yw(e,t,n,r,s)}function Ad(e,t){q6(e.x,t.x,t.scaleX,t.scale,t.originX),q6(e.y,t.y,t.scaleY,t.scale,t.originY)}function eB(e,t){return XF(o2e(e.getBoundingClientRect(),t))}function a2e(e,t,n){const s=eB(e,n),{scroll:o}=t;return o&&(Td(s.x,o.offset.x),Td(s.y,o.offset.y)),s}const tB=({current:e})=>e?e.ownerDocument.defaultView:null,l2e=new WeakMap;class c2e{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Pn(),this.visualElement=t}start(t,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const o=h=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Ky(h,"page").point)},r=(h,p)=>{const{drag:f,dragPropagation:m,onDragStart:g}=this.getProps();if(f&&!m&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=qF(f),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ki(b=>{let C=this.getAxisMotionValue(b).get()||0;if(cr.test(C)){const{projection:y}=this.visualElement;if(y&&y.layout){const v=y.layout.layoutBox[b];v&&(C=Li(v)*(parseFloat(C)/100))}}this.originPoint[b]=C}),g&&Xt.postRender(()=>g(h,p)),fw(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},a=(h,p)=>{const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:g,onDrag:x}=this.getProps();if(!f&&!this.openGlobalLock)return;const{offset:b}=p;if(m&&this.currentDirection===null){this.currentDirection=d2e(b),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,b),this.updateAxis("y",p.point,b),this.visualElement.render(),x&&x(h,p)},l=(h,p)=>this.stop(h,p),d=()=>Ki(h=>{var p;return this.getAnimationState(h)==="paused"&&((p=this.getAxisMotionValue(h).animation)===null||p===void 0?void 0:p.play())}),{dragSnapToOrigin:u}=this.getProps();this.panSession=new HF(t,{onSessionStart:o,onStart:r,onMove:a,onSessionEnd:l,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,contextWindow:tB(this.visualElement)})}stop(t,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:o}=n;this.startAnimation(o);const{onDragEnd:r}=this.getProps();r&&Xt.postRender(()=>r(t,n))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,s){const{drag:o}=this.getProps();if(!s||!Fg(t,o,this.currentDirection))return;const r=this.getAxisMotionValue(t);let a=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(a=Qve(a,this.constraints[t],this.elastic[t])),r.set(a)}resolveConstraints(){var t;const{dragConstraints:n,dragElastic:s}=this.getProps(),o=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,r=this.constraints;n&&_d(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&o?this.constraints=Jve(o.layoutBox,n):this.constraints=!1,this.elastic=s2e(s),r!==this.constraints&&o&&this.constraints&&!this.hasMutatedConstraints&&Ki(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=n2e(o.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!_d(t))return!1;const s=t.current,{projection:o}=this.visualElement;if(!o||!o.layout)return!1;const r=a2e(s,o.root,this.visualElement.getTransformPagePoint());let a=e2e(o.layout.layoutBox,r);if(n){const l=n(i2e(a));this.hasMutatedConstraints=!!l,l&&(a=XF(l))}return a}startAnimation(t){const{drag:n,dragMomentum:s,dragElastic:o,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),d=this.constraints||{},u=Ki(h=>{if(!Fg(h,n,this.currentDirection))return;let p=d&&d[h]||{};a&&(p={min:0,max:0});const f=o?200:1e6,m=o?40:1e7,g={type:"inertia",velocity:s?t[h]:0,bounceStiffness:f,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...r,...p};return this.startAxisValueAnimation(h,g)});return Promise.all(u).then(l)}startAxisValueAnimation(t,n){const s=this.getAxisMotionValue(t);return fw(this.visualElement,t),s.start(c_(t,s,0,n,this.visualElement,!1))}stopAnimation(){Ki(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Ki(t=>{var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),o=s[n];return o||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){Ki(n=>{const{drag:s}=this.getProps();if(!Fg(n,s,this.currentDirection))return;const{projection:o}=this.visualElement,r=this.getAxisMotionValue(n);if(o&&o.layout){const{min:a,max:l}=o.layout.layoutBox[n];r.set(t[n]-kn(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!_d(n)||!s||!this.constraints)return;this.stopAnimation();const o={x:0,y:0};Ki(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const d=l.get();o[a]=t2e({min:d,max:d},this.constraints[a])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Ki(a=>{if(!Fg(a,t,null))return;const l=this.getAxisMotionValue(a),{min:d,max:u}=this.constraints[a];l.set(kn(d,u,o[a]))})}addListeners(){if(!this.visualElement.current)return;l2e.set(this.visualElement,this);const t=this.visualElement.current,n=Jr(t,"pointerdown",d=>{const{drag:u,dragListener:h=!0}=this.getProps();u&&h&&this.start(d)}),s=()=>{const{dragConstraints:d}=this.getProps();_d(d)&&d.current&&(this.constraints=this.resolveRefConstraints())},{projection:o}=this.visualElement,r=o.addEventListener("measure",s);o&&!o.layout&&(o.root&&o.root.updateScroll(),o.updateLayout()),Xt.read(s);const a=qr(window,"resize",()=>this.scalePositionWithinConstraints()),l=o.addEventListener("didUpdate",({delta:d,hasLayoutChanged:u})=>{this.isDragging&&u&&(Ki(h=>{const p=this.getAxisMotionValue(h);p&&(this.originPoint[h]+=d[h].translate,p.set(p.get()+d[h].translate))}),this.visualElement.render())});return()=>{a(),n(),r(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:o=!1,dragConstraints:r=!1,dragElastic:a=gw,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:s,dragPropagation:o,dragConstraints:r,dragElastic:a,dragMomentum:l}}}function Fg(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function d2e(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class u2e extends xl{constructor(t){super(t),this.removeGroupControls=Ns,this.removeListeners=Ns,this.controls=new c2e(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ns}unmount(){this.removeGroupControls(),this.removeListeners()}}const K6=e=>(t,n)=>{e&&Xt.postRender(()=>e(t,n))};class h2e extends xl{constructor(){super(...arguments),this.removePointerDownListener=Ns}onPointerDown(t){this.session=new HF(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:tB(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:s,onPanEnd:o}=this.node.getProps();return{onSessionStart:K6(t),onStart:K6(n),onMove:s,onEnd:(r,a)=>{delete this.session,o&&Xt.postRender(()=>o(r,a))}}}mount(){this.removePointerDownListener=Jr(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Zy=c.createContext(null);function p2e(){const e=c.useContext(Zy);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:s}=e,o=c.useId();c.useEffect(()=>s(o),[]);const r=c.useCallback(()=>n&&n(o),[o,n]);return!t&&n?[!1,r]:[!0]}const p_=c.createContext({}),nB=c.createContext({}),R0={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Z6(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const ip={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(nt.test(e))e=parseFloat(e);else return e;const n=Z6(e,t.target.x),s=Z6(e,t.target.y);return`${n}% ${s}%`}},f2e={correct:(e,{treeScale:t,projectionDelta:n})=>{const s=e,o=nl.parse(e);if(o.length>5)return s;const r=nl.createTransformer(e),a=typeof o[0]!="number"?1:0,l=n.x.scale*t.x,d=n.y.scale*t.y;o[0+a]/=l,o[1+a]/=d;const u=kn(l,d,.5);return typeof o[2+a]=="number"&&(o[2+a]/=u),typeof o[3+a]=="number"&&(o[3+a]/=u),r(o)}},A1={};function m2e(e){Object.assign(A1,e)}const{schedule:f_}=eF(queueMicrotask,!1);class g2e extends c.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s,layoutId:o}=this.props,{projection:r}=t;m2e(x2e),r&&(n.group&&n.group.add(r),s&&s.register&&o&&s.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),R0.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:s,drag:o,isPresent:r}=this.props,a=s.projection;return a&&(a.isPresent=r,o||t.layoutDependency!==n||n===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==r&&(r?a.promote():a.relegate()||Xt.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),f_.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:o}=t;o&&(o.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(o),s&&s.deregister&&s.deregister(o))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function sB(e){const[t,n]=p2e(),s=c.useContext(p_);return i.jsx(g2e,{...e,layoutGroup:s,switchLayoutGroup:c.useContext(nB),isPresent:t,safeToRemove:n})}const x2e={borderRadius:{...ip,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ip,borderTopRightRadius:ip,borderBottomLeftRadius:ip,borderBottomRightRadius:ip,boxShadow:f2e},iB=["TopLeft","TopRight","BottomLeft","BottomRight"],y2e=iB.length,Y6=e=>typeof e=="string"?parseFloat(e):e,X6=e=>typeof e=="number"||nt.test(e);function b2e(e,t,n,s,o,r){o?(e.opacity=kn(0,n.opacity!==void 0?n.opacity:1,v2e(s)),e.opacityExit=kn(t.opacity!==void 0?t.opacity:1,0,C2e(s))):r&&(e.opacity=kn(t.opacity!==void 0?t.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let a=0;a<y2e;a++){const l=`border${iB[a]}Radius`;let d=Q6(t,l),u=Q6(n,l);if(d===void 0&&u===void 0)continue;d||(d=0),u||(u=0),d===0||u===0||X6(d)===X6(u)?(e[l]=Math.max(kn(Y6(d),Y6(u),s),0),(cr.test(u)||cr.test(d))&&(e[l]+="%")):e[l]=u}(t.rotate||n.rotate)&&(e.rotate=kn(t.rotate||0,n.rotate||0,s))}function Q6(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const v2e=oB(0,.5,aF),C2e=oB(.5,.95,Ns);function oB(e,t,n){return s=>s<e?0:s>t?1:n(ru(e,t,s))}function J6(e,t){e.min=t.min,e.max=t.max}function Wi(e,t){J6(e.x,t.x),J6(e.y,t.y)}function eM(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function tM(e,t,n,s,o){return e-=t,e=T1(e,1/n,s),o!==void 0&&(e=T1(e,1/o,s)),e}function w2e(e,t=0,n=1,s=.5,o,r=e,a=e){if(cr.test(t)&&(t=parseFloat(t),t=kn(a.min,a.max,t/100)-a.min),typeof t!="number")return;let l=kn(r.min,r.max,s);e===r&&(l-=t),e.min=tM(e.min,t,n,l,o),e.max=tM(e.max,t,n,l,o)}function nM(e,t,[n,s,o],r,a){w2e(e,t[n],t[s],t[o],t.scale,r,a)}const S2e=["x","scaleX","originX"],k2e=["y","scaleY","originY"];function sM(e,t,n,s){nM(e.x,t,S2e,n?n.x:void 0,s?s.x:void 0),nM(e.y,t,k2e,n?n.y:void 0,s?s.y:void 0)}function iM(e){return e.translate===0&&e.scale===1}function rB(e){return iM(e.x)&&iM(e.y)}function oM(e,t){return e.min===t.min&&e.max===t.max}function j2e(e,t){return oM(e.x,t.x)&&oM(e.y,t.y)}function rM(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function aB(e,t){return rM(e.x,t.x)&&rM(e.y,t.y)}function aM(e){return Li(e.x)/Li(e.y)}function lM(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class _2e{constructor(){this.members=[]}add(t){d_(this.members,t),t.scheduleRender()}remove(t){if(u_(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(o=>t===o);if(n===0)return!1;let s;for(let o=n;o>=0;o--){const r=this.members[o];if(r.isPresent!==!1){s=r;break}}return s?(this.promote(s),!0):!1}promote(t,n){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,n&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:o}=t.options;o===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:s}=t;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function I2e(e,t,n){let s="";const o=e.x.translate/t.x,r=e.y.translate/t.y,a=(n==null?void 0:n.z)||0;if((o||r||a)&&(s=`translate3d(${o}px, ${r}px, ${a}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:u,rotate:h,rotateX:p,rotateY:f,skewX:m,skewY:g}=n;u&&(s=`perspective(${u}px) ${s}`),h&&(s+=`rotate(${h}deg) `),p&&(s+=`rotateX(${p}deg) `),f&&(s+=`rotateY(${f}deg) `),m&&(s+=`skewX(${m}deg) `),g&&(s+=`skewY(${g}deg) `)}const l=e.x.scale*t.x,d=e.y.scale*t.y;return(l!==1||d!==1)&&(s+=`scale(${l}, ${d})`),s||"none"}const T2e=(e,t)=>e.depth-t.depth;class A2e{constructor(){this.children=[],this.isDirty=!1}add(t){d_(this.children,t),this.isDirty=!0}remove(t){u_(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(T2e),this.isDirty=!1,this.children.forEach(t)}}function O0(e){const t=Ps(e)?e.get():e;return vve(t)?t.toValue():t}function M2e(e,t){const n=dr.now(),s=({timestamp:o})=>{const r=o-n;r>=t&&(el(s),e(r-t))};return Xt.read(s,!0),()=>el(s)}function E2e(e){return e instanceof SVGElement&&e.tagName!=="svg"}function P2e(e,t,n){const s=Ps(e)?e:jf(e);return s.start(c_("",s,t,n)),s.animation}const Pl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Ap=typeof window<"u"&&window.MotionDebug!==void 0,Wv=["","X","Y","Z"],L2e={visibility:"hidden"},cM=1e3;let D2e=0;function Uv(e,t,n,s){const{latestValues:o}=t;o[e]&&(n[e]=o[e],t.setStaticValue(e,0),s&&(s[e]=0))}function lB(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=BF(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:o,layoutId:r}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",Xt,!(o||r))}const{parent:s}=e;s&&!s.hasCheckedOptimisedAppear&&lB(s)}function cB({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:s,resetTransform:o}){return class{constructor(a={},l=t==null?void 0:t()){this.id=D2e++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ap&&(Pl.totalNodes=Pl.resolvedTargetDeltas=Pl.recalculatedProjection=0),this.nodes.forEach(N2e),this.nodes.forEach(z2e),this.nodes.forEach(G2e),this.nodes.forEach(F2e),Ap&&window.MotionDebug.record(Pl)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let d=0;d<this.path.length;d++)this.path[d].shouldResetTransform=!0;this.root===this&&(this.nodes=new A2e)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new h_),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const d=this.eventHandlers.get(a);d&&d.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=E2e(a),this.instance=a;const{layoutId:d,layout:u,visualElement:h}=this.options;if(h&&!h.current&&h.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(u||d)&&(this.isLayoutDirty=!0),e){let p;const f=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,p&&p(),p=M2e(f,250),R0.hasAnimatedSinceResize&&(R0.hasAnimatedSinceResize=!1,this.nodes.forEach(uM))})}d&&this.root.registerSharedNode(d,this),this.options.animate!==!1&&h&&(d||u)&&this.addEventListener("didUpdate",({delta:p,hasLayoutChanged:f,hasRelativeTargetChanged:m,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||h.getDefaultTransition()||K2e,{onLayoutAnimationStart:b,onLayoutAnimationComplete:C}=h.getProps(),y=!this.targetLayout||!aB(this.targetLayout,g)||m,v=!f&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||v||f&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(p,v);const w={...Yj(x,"layout"),onPlay:b,onComplete:C};(h.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w)}else f||uM(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,el(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(H2e),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&lB(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const p=this.path[h];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:d}=this.options;if(l===void 0&&!d)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(dM);return}this.isUpdating||this.nodes.forEach($2e),this.isUpdating=!1,this.nodes.forEach(V2e),this.nodes.forEach(R2e),this.nodes.forEach(O2e),this.clearAllSnapshots();const l=dr.now();ms.delta=tl(0,1e3/60,l-ms.timestamp),ms.timestamp=l,ms.isProcessing=!0,Fv.update.process(ms),Fv.preRender.process(ms),Fv.render.process(ms),ms.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,f_.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(B2e),this.sharedNodes.forEach(W2e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Xt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Xt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let d=0;d<this.path.length;d++)this.path[d].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Pn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l){const d=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:d,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:d}}}resetTransform(){if(!o)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!rB(this.projectionDelta),d=this.getTransformTemplate(),u=d?d(this.latestValues,""):void 0,h=u!==this.prevTransformTemplateValue;a&&(l||El(this.latestValues)||h)&&(o(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let d=this.removeElementScroll(l);return a&&(d=this.removeTransform(d)),Z2e(d),{animationId:this.root.animationId,measuredBox:l,layoutBox:d,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:l}=this.options;if(!l)return Pn();const d=l.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(Y2e))){const{scroll:h}=this.root;h&&(Td(d.x,h.offset.x),Td(d.y,h.offset.y))}return d}removeElementScroll(a){var l;const d=Pn();if(Wi(d,a),!((l=this.scroll)===null||l===void 0)&&l.wasRoot)return d;for(let u=0;u<this.path.length;u++){const h=this.path[u],{scroll:p,options:f}=h;h!==this.root&&p&&f.layoutScroll&&(p.wasRoot&&Wi(d,a),Td(d.x,p.offset.x),Td(d.y,p.offset.y))}return d}applyTransform(a,l=!1){const d=Pn();Wi(d,a);for(let u=0;u<this.path.length;u++){const h=this.path[u];!l&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Ad(d,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),El(h.latestValues)&&Ad(d,h.latestValues)}return El(this.latestValues)&&Ad(d,this.latestValues),d}removeTransform(a){const l=Pn();Wi(l,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];if(!u.instance||!El(u.latestValues))continue;xw(u.latestValues)&&u.updateSnapshot();const h=Pn(),p=u.measurePageBox();Wi(h,p),sM(l,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,h)}return El(this.latestValues)&&sM(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ms.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var l;const d=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=d.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=d.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=d.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==d;if(!(a||u&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:p,layoutId:f}=this.options;if(!(!this.layout||!(p||f))){if(this.resolvedRelativeTargetAt=ms.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Pn(),this.relativeTargetOrigin=Pn(),Hp(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),Wi(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Pn(),this.targetWithTransforms=Pn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Xve(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Wi(this.target,this.layout.layoutBox),JF(this.target,this.targetDelta)):Wi(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Pn(),this.relativeTargetOrigin=Pn(),Hp(this.relativeTargetOrigin,this.target,m.target),Wi(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ap&&Pl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||xw(this.parent.latestValues)||QF(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const l=this.getLead(),d=!!this.resumingFrom||this!==l;let u=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(u=!1),d&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===ms.timestamp&&(u=!1),u)return;const{layout:h,layoutId:p}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||p))return;Wi(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,m=this.treeScale.y;r2e(this.layoutCorrected,this.treeScale,this.path,d),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox,l.targetWithTransforms=Pn());const{target:g}=l;if(!g){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(eM(this.prevProjectionDelta.x,this.projectionDelta.x),eM(this.prevProjectionDelta.y,this.projectionDelta.y)),Gp(this.projectionDelta,this.layoutCorrected,g,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==m||!lM(this.projectionDelta.x,this.prevProjectionDelta.x)||!lM(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),Ap&&Pl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var l;if((l=this.options.visualElement)===null||l===void 0||l.scheduleRender(),a){const d=this.getStack();d&&d.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Id(),this.projectionDelta=Id(),this.projectionDeltaWithTransform=Id()}setAnimationOrigin(a,l=!1){const d=this.snapshot,u=d?d.latestValues:{},h={...this.latestValues},p=Id();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const f=Pn(),m=d?d.source:void 0,g=this.layout?this.layout.source:void 0,x=m!==g,b=this.getStack(),C=!b||b.members.length<=1,y=!!(x&&!C&&this.options.crossfade===!0&&!this.path.some(q2e));this.animationProgress=0;let v;this.mixTargetDelta=w=>{const k=w/1e3;hM(p.x,a.x,k),hM(p.y,a.y,k),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Hp(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),U2e(this.relativeTarget,this.relativeTargetOrigin,f,k),v&&j2e(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=Pn()),Wi(v,this.relativeTarget)),x&&(this.animationValues=h,b2e(h,u,this.latestValues,k,y,C)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(el(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Xt.update(()=>{R0.hasAnimatedSinceResize=!0,this.currentAnimation=P2e(0,cM,{...a,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(cM),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:d,layout:u,latestValues:h}=a;if(!(!l||!d||!u)){if(this!==a&&this.layout&&u&&dB(this.options.animationType,this.layout.layoutBox,u.layoutBox)){d=this.target||Pn();const p=Li(this.layout.layoutBox.x);d.x.min=a.target.x.min,d.x.max=d.x.min+p;const f=Li(this.layout.layoutBox.y);d.y.min=a.target.y.min,d.y.max=d.y.min+f}Wi(l,d),Ad(l,h),Gp(this.projectionDeltaWithTransform,this.layoutCorrected,l,h)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new _2e),this.sharedNodes.get(a).add(l);const u=l.options.initialPromotionConfig;l.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:l}=this.options;return l?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:l}=this.options;return l?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:d}={}){const u=this.getStack();u&&u.promote(this,d),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:d}=a;if((d.z||d.rotate||d.rotateX||d.rotateY||d.rotateZ||d.skewX||d.skewY)&&(l=!0),!l)return;const u={};d.z&&Uv("z",a,u,this.animationValues);for(let h=0;h<Wv.length;h++)Uv(`rotate${Wv[h]}`,a,u,this.animationValues),Uv(`skew${Wv[h]}`,a,u,this.animationValues);a.render();for(const h in u)a.setStaticValue(h,u[h]),this.animationValues&&(this.animationValues[h]=u[h]);a.scheduleRender()}getProjectionStyles(a){var l,d;if(!this.instance||this.isSVG)return;if(!this.isVisible)return L2e;const u={visibility:""},h=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,u.opacity="",u.pointerEvents=O0(a==null?void 0:a.pointerEvents)||"",u.transform=h?h(this.latestValues,""):"none",u;const p=this.getLead();if(!this.projectionDelta||!this.layout||!p.target){const x={};return this.options.layoutId&&(x.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,x.pointerEvents=O0(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!El(this.latestValues)&&(x.transform=h?h({},""):"none",this.hasProjected=!1),x}const f=p.animationValues||p.latestValues;this.applyTransformsToTarget(),u.transform=I2e(this.projectionDeltaWithTransform,this.treeScale,f),h&&(u.transform=h(f,u.transform));const{x:m,y:g}=this.projectionDelta;u.transformOrigin=`${m.origin*100}% ${g.origin*100}% 0`,p.animationValues?u.opacity=p===this?(d=(l=f.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&d!==void 0?d:1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:u.opacity=p===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const x in A1){if(f[x]===void 0)continue;const{correct:b,applyTo:C}=A1[x],y=u.transform==="none"?f[x]:b(f[x],p);if(C){const v=C.length;for(let w=0;w<v;w++)u[C[w]]=y}else u[x]=y}return this.options.layoutId&&(u.pointerEvents=p===this?O0(a==null?void 0:a.pointerEvents)||"":"none"),u}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var l;return(l=a.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(dM),this.root.sharedNodes.clear()}}}function R2e(e){e.updateLayout()}function O2e(e){var t;const n=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:o}=e.layout,{animationType:r}=e.options,a=n.source!==e.layout.source;r==="size"?Ki(p=>{const f=a?n.measuredBox[p]:n.layoutBox[p],m=Li(f);f.min=s[p].min,f.max=f.min+m}):dB(r,n.layoutBox,s)&&Ki(p=>{const f=a?n.measuredBox[p]:n.layoutBox[p],m=Li(s[p]);f.max=f.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[p].max=e.relativeTarget[p].min+m)});const l=Id();Gp(l,s,n.layoutBox);const d=Id();a?Gp(d,e.applyTransform(o,!0),n.measuredBox):Gp(d,s,n.layoutBox);const u=!rB(l);let h=!1;if(!e.resumeFrom){const p=e.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:f,layout:m}=p;if(f&&m){const g=Pn();Hp(g,n.layoutBox,f.layoutBox);const x=Pn();Hp(x,s,m.layoutBox),aB(g,x)||(h=!0),p.options.layoutRoot&&(e.relativeTarget=x,e.relativeTargetOrigin=g,e.relativeParent=p)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:d,layoutDelta:l,hasLayoutChanged:u,hasRelativeTargetChanged:h})}else if(e.isLead()){const{onExitComplete:s}=e.options;s&&s()}e.options.transition=void 0}function N2e(e){Ap&&Pl.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function F2e(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function B2e(e){e.clearSnapshot()}function dM(e){e.clearMeasurements()}function $2e(e){e.isLayoutDirty=!1}function V2e(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function uM(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function z2e(e){e.resolveTargetDelta()}function G2e(e){e.calcProjection()}function H2e(e){e.resetSkewAndRotation()}function W2e(e){e.removeLeadSnapshot()}function hM(e,t,n){e.translate=kn(t.translate,0,n),e.scale=kn(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function pM(e,t,n,s){e.min=kn(t.min,n.min,s),e.max=kn(t.max,n.max,s)}function U2e(e,t,n,s){pM(e.x,t.x,n.x,s),pM(e.y,t.y,n.y,s)}function q2e(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const K2e={duration:.45,ease:[.4,0,.1,1]},fM=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),mM=fM("applewebkit/")&&!fM("chrome/")?Math.round:Ns;function gM(e){e.min=mM(e.min),e.max=mM(e.max)}function Z2e(e){gM(e.x),gM(e.y)}function dB(e,t,n){return e==="position"||e==="preserve-aspect"&&!Yve(aM(t),aM(n),.2)}function Y2e(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const X2e=cB({attachResizeListener:(e,t)=>qr(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),qv={current:void 0},uB=cB({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!qv.current){const e=new X2e({});e.mount(window),e.setOptions({layoutScroll:!0}),qv.current=e}return qv.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Q2e={pan:{Feature:h2e},drag:{Feature:u2e,ProjectionNode:uB,MeasureLayout:sB}};function xM(e,t){const n=t?"pointerenter":"pointerleave",s=t?"onHoverStart":"onHoverEnd",o=(r,a)=>{if(r.pointerType==="touch"||KF())return;const l=e.getProps();e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",t);const d=l[s];d&&Xt.postRender(()=>d(r,a))};return Jr(e.current,n,o,{passive:!e.getProps()[s]})}class J2e extends xl{mount(){this.unmount=Qr(xM(this.node,!0),xM(this.node,!1))}unmount(){}}class eCe extends xl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Qr(qr(this.node.current,"focus",()=>this.onFocus()),qr(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const hB=(e,t)=>t?e===t?!0:hB(e,t.parentElement):!1;function Kv(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,Ky(n))}class tCe extends xl{constructor(){super(...arguments),this.removeStartListeners=Ns,this.removeEndListeners=Ns,this.removeAccessibleListeners=Ns,this.startPointerPress=(t,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),r=Jr(window,"pointerup",(l,d)=>{if(!this.checkPressEnd())return;const{onTap:u,onTapCancel:h,globalTapTarget:p}=this.node.getProps(),f=!p&&!hB(this.node.current,l.target)?h:u;f&&Xt.update(()=>f(l,d))},{passive:!(s.onTap||s.onPointerUp)}),a=Jr(window,"pointercancel",(l,d)=>this.cancelPress(l,d),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=Qr(r,a),this.startPress(t,n)},this.startAccessiblePress=()=>{const t=r=>{if(r.key!=="Enter"||this.isPressing)return;const a=l=>{l.key!=="Enter"||!this.checkPressEnd()||Kv("up",(d,u)=>{const{onTap:h}=this.node.getProps();h&&Xt.postRender(()=>h(d,u))})};this.removeEndListeners(),this.removeEndListeners=qr(this.node.current,"keyup",a),Kv("down",(l,d)=>{this.startPress(l,d)})},n=qr(this.node.current,"keydown",t),s=()=>{this.isPressing&&Kv("cancel",(r,a)=>this.cancelPress(r,a))},o=qr(this.node.current,"blur",s);this.removeAccessibleListeners=Qr(n,o)}}startPress(t,n){this.isPressing=!0;const{onTapStart:s,whileTap:o}=this.node.getProps();o&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&Xt.postRender(()=>s(t,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!KF()}cancelPress(t,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&Xt.postRender(()=>s(t,n))}mount(){const t=this.node.getProps(),n=Jr(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),s=qr(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Qr(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const bw=new WeakMap,Zv=new WeakMap,nCe=e=>{const t=bw.get(e.target);t&&t(e)},sCe=e=>{e.forEach(nCe)};function iCe({root:e,...t}){const n=e||document;Zv.has(n)||Zv.set(n,{});const s=Zv.get(n),o=JSON.stringify(t);return s[o]||(s[o]=new IntersectionObserver(sCe,{root:e,...t})),s[o]}function oCe(e,t,n){const s=iCe(t);return bw.set(e,n),s.observe(e),()=>{bw.delete(e),s.unobserve(e)}}const rCe={some:0,all:1};class aCe extends xl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:s,amount:o="some",once:r}=t,a={root:n?n.current:void 0,rootMargin:s,threshold:typeof o=="number"?o:rCe[o]},l=d=>{const{isIntersecting:u}=d;if(this.isInView===u||(this.isInView=u,r&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:h,onViewportLeave:p}=this.node.getProps(),f=u?h:p;f&&f(d)};return oCe(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(lCe(t,n))&&this.startObserver()}unmount(){}}function lCe({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const cCe={inView:{Feature:aCe},tap:{Feature:tCe},focus:{Feature:eCe},hover:{Feature:J2e}},dCe={layout:{ProjectionNode:uB,MeasureLayout:sB}},m_=c.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),Yy=c.createContext({}),g_=typeof window<"u",pB=g_?c.useLayoutEffect:c.useEffect,fB=c.createContext({strict:!1});let yM=!1;function uCe(e,t,n,s,o){var r;const{visualElement:a}=c.useContext(Yy),l=c.useContext(fB),d=c.useContext(Zy),u=c.useContext(m_).reducedMotion,h=c.useRef();s=s||l.renderer,!h.current&&s&&(h.current=s(e,{visualState:t,parent:a,props:n,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:u}));const p=h.current,f=c.useContext(nB);p&&!p.projection&&o&&(p.type==="html"||p.type==="svg")&&pCe(h.current,n,o,f),c.useInsertionEffect(()=>{p&&p.update(n,d)});const m=n[FF],g=c.useRef(!!m&&!window.MotionHandoffIsComplete&&((r=window.MotionHasOptimisedAnimation)===null||r===void 0?void 0:r.call(window,m)));return pB(()=>{p&&(p.updateFeatures(),f_.render(p.render),g.current&&p.animationState&&p.animationState.animateChanges())}),c.useEffect(()=>{p&&(!g.current&&p.animationState&&p.animationState.animateChanges(),g.current=!1,yM||(yM=!0,queueMicrotask(hCe)))}),p}function hCe(){window.MotionHandoffIsComplete=!0}function pCe(e,t,n,s){const{layoutId:o,layout:r,drag:a,dragConstraints:l,layoutScroll:d,layoutRoot:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:mB(e.parent)),e.projection.setOptions({layoutId:o,layout:r,alwaysMeasureLayout:!!a||l&&_d(l),visualElement:e,animationType:typeof r=="string"?r:"both",initialPromotionConfig:s,layoutScroll:d,layoutRoot:u})}function mB(e){if(e)return e.options.allowProjection!==!1?e.projection:mB(e.parent)}function fCe(e,t,n){return c.useCallback(s=>{s&&e.mount&&e.mount(s),t&&(s?t.mount(s):t.unmount()),n&&(typeof n=="function"?n(s):_d(n)&&(n.current=s))},[t])}function Xy(e){return Cf(e.animate)||Zj.some(t=>wf(e[t]))}function gB(e){return!!(Xy(e)||e.variants)}function mCe(e,t){if(Xy(e)){const{initial:n,animate:s}=e;return{initial:n===!1||wf(n)?n:void 0,animate:wf(s)?s:void 0}}return e.inherit!==!1?t:{}}function gCe(e){const{initial:t,animate:n}=mCe(e,c.useContext(Yy));return c.useMemo(()=>({initial:t,animate:n}),[bM(t),bM(n)])}function bM(e){return Array.isArray(e)?e.join(" "):e}const vM={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},au={};for(const e in vM)au[e]={isEnabled:t=>vM[e].some(n=>!!t[n])};function xCe(e){for(const t in e)au[t]={...au[t],...e[t]}}const yCe=Symbol.for("motionComponentSymbol");function bCe({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:s,Component:o}){e&&xCe(e);function r(l,d){let u;const h={...c.useContext(m_),...l,layoutId:vCe(l)},{isStatic:p}=h,f=gCe(l),m=s(l,p);if(!p&&g_){CCe();const g=wCe(h);u=g.MeasureLayout,f.visualElement=uCe(o,m,h,t,g.ProjectionNode)}return i.jsxs(Yy.Provider,{value:f,children:[u&&f.visualElement?i.jsx(u,{visualElement:f.visualElement,...h}):null,n(o,l,fCe(m,f.visualElement,d),m,p,f.visualElement)]})}const a=c.forwardRef(r);return a[yCe]=o,a}function vCe({layoutId:e}){const t=c.useContext(p_).id;return t&&e!==void 0?t+"-"+e:e}function CCe(e,t){c.useContext(fB).strict}function wCe(e){const{drag:t,layout:n}=au;if(!t&&!n)return{};const s={...t,...n};return{MeasureLayout:t!=null&&t.isEnabled(e)||n!=null&&n.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}const SCe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function x_(e){return typeof e!="string"||e.includes("-")?!1:!!(SCe.indexOf(e)>-1||/[A-Z]/u.test(e))}function xB(e,{style:t,vars:n},s,o){Object.assign(e.style,t,o&&o.getProjectionStyles(s));for(const r in n)e.style.setProperty(r,n[r])}const yB=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function bB(e,t,n,s){xB(e,t,void 0,s);for(const o in t.attrs)e.setAttribute(yB.has(o)?o:qy(o),t.attrs[o])}function vB(e,{layout:t,layoutId:n}){return gl.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!A1[e]||e==="opacity")}function y_(e,t,n){var s;const{style:o}=e,r={};for(const a in o)(Ps(o[a])||t.style&&Ps(t.style[a])||vB(a,e)||((s=n==null?void 0:n.getValue(a))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(r[a]=o[a]);return n&&o&&typeof o.willChange=="string"&&(n.applyWillChange=!1),r}function CB(e,t,n){const s=y_(e,t,n);for(const o in e)if(Ps(e[o])||Ps(t[o])){const r=Om.indexOf(o)!==-1?"attr"+o.charAt(0).toUpperCase()+o.substring(1):o;s[r]=e[o]}return s}function b_(e){const t=c.useRef(null);return t.current===null&&(t.current=e()),t.current}function kCe({applyWillChange:e=!1,scrapeMotionValuesFromProps:t,createRenderState:n,onMount:s},o,r,a,l){const d={latestValues:jCe(o,r,a,l?!1:e,t),renderState:n()};return s&&(d.mount=u=>s(o,u,d)),d}const wB=e=>(t,n)=>{const s=c.useContext(Yy),o=c.useContext(Zy),r=()=>kCe(e,t,s,o,n);return n?r():b_(r)};function CM(e,t,n){const s=Array.isArray(t)?t:[t];for(let o=0;o<s.length;o++){const r=qj(e,s[o]);if(r){const{transitionEnd:a,transition:l,...d}=r;n(d,a)}}}function jCe(e,t,n,s,o){var r;const a={};let l=s&&((r=e.style)===null||r===void 0?void 0:r.willChange)===void 0;const d=o(e,{});for(const x in d)a[x]=O0(d[x]);let{initial:u,animate:h}=e;const p=Xy(e),f=gB(e);t&&f&&!p&&e.inherit!==!1&&(u===void 0&&(u=t.initial),h===void 0&&(h=t.animate));let m=n?n.initial===!1:!1;m=m||u===!1;const g=m?h:u;return g&&typeof g!="boolean"&&!Cf(g)&&CM(e,g,(x,b)=>{for(const C in x){let y=x[C];if(Array.isArray(y)){const v=m?y.length-1:0;y=y[v]}y!==null&&(a[C]=y)}for(const C in b)a[C]=b[C]}),l&&h&&u!==!1&&!Cf(h)&&CM(e,h,x=>{for(const b in x)if($F(b)){a.willChange="transform";return}}),a}const v_=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),SB=()=>({...v_(),attrs:{}}),kB=(e,t)=>t&&typeof e=="number"?t.transform(e):e,_Ce={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},ICe=Om.length;function TCe(e,t,n){let s="",o=!0;for(let r=0;r<ICe;r++){const a=Om[r],l=e[a];if(l===void 0)continue;let d=!0;if(typeof l=="number"?d=l===(a.startsWith("scale")?1:0):d=parseFloat(l)===0,!d||n){const u=kB(l,s_[a]);if(!d){o=!1;const h=_Ce[a]||a;s+=`${h}(${u}) `}n&&(t[a]=u)}}return s=s.trim(),n?s=n(t,o?"":s):o&&(s="none"),s}function C_(e,t,n){const{style:s,vars:o,transformOrigin:r}=e;let a=!1,l=!1;for(const d in t){const u=t[d];if(gl.has(d)){a=!0;continue}else if(pF(d)){o[d]=u;continue}else{const h=kB(u,s_[d]);d.startsWith("origin")?(l=!0,r[d]=h):s[d]=h}}if(t.transform||(a||n?s.transform=TCe(t,e.transform,n):s.transform&&(s.transform="none")),l){const{originX:d="50%",originY:u="50%",originZ:h=0}=r;s.transformOrigin=`${d} ${u} ${h}`}}function wM(e,t,n){return typeof e=="string"?e:nt.transform(t+n*e)}function ACe(e,t,n){const s=wM(t,e.x,e.width),o=wM(n,e.y,e.height);return`${s} ${o}`}const MCe={offset:"stroke-dashoffset",array:"stroke-dasharray"},ECe={offset:"strokeDashoffset",array:"strokeDasharray"};function PCe(e,t,n=1,s=0,o=!0){e.pathLength=1;const r=o?MCe:ECe;e[r.offset]=nt.transform(-s);const a=nt.transform(t),l=nt.transform(n);e[r.array]=`${a} ${l}`}function w_(e,{attrX:t,attrY:n,attrScale:s,originX:o,originY:r,pathLength:a,pathSpacing:l=1,pathOffset:d=0,...u},h,p){if(C_(e,u,p),h){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:f,style:m,dimensions:g}=e;f.transform&&(g&&(m.transform=f.transform),delete f.transform),g&&(o!==void 0||r!==void 0||m.transform)&&(m.transformOrigin=ACe(g,o!==void 0?o:.5,r!==void 0?r:.5)),t!==void 0&&(f.x=t),n!==void 0&&(f.y=n),s!==void 0&&(f.scale=s),a!==void 0&&PCe(f,a,l,d,!1)}const S_=e=>typeof e=="string"&&e.toLowerCase()==="svg",LCe={useVisualState:wB({scrapeMotionValuesFromProps:CB,createRenderState:SB,onMount:(e,t,{renderState:n,latestValues:s})=>{Xt.read(()=>{try{n.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),Xt.render(()=>{w_(n,s,S_(t.tagName),e.transformTemplate),bB(t,n)})}})},DCe={useVisualState:wB({applyWillChange:!0,scrapeMotionValuesFromProps:y_,createRenderState:v_})};function jB(e,t,n){for(const s in t)!Ps(t[s])&&!vB(s,n)&&(e[s]=t[s])}function RCe({transformTemplate:e},t){return c.useMemo(()=>{const n=v_();return C_(n,t,e),Object.assign({},n.vars,n.style)},[t])}function OCe(e,t){const n=e.style||{},s={};return jB(s,n,e),Object.assign(s,RCe(e,t)),s}function NCe(e,t){const n={},s=OCe(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const FCe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function M1(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||FCe.has(e)}let _B=e=>!M1(e);function BCe(e){e&&(_B=t=>t.startsWith("on")?!M1(t):e(t))}try{BCe(require("@emotion/is-prop-valid").default)}catch{}function $Ce(e,t,n){const s={};for(const o in e)o==="values"&&typeof e.values=="object"||(_B(o)||n===!0&&M1(o)||!t&&!M1(o)||e.draggable&&o.startsWith("onDrag"))&&(s[o]=e[o]);return s}function VCe(e,t,n,s){const o=c.useMemo(()=>{const r=SB();return w_(r,t,S_(s),e.transformTemplate),{...r.attrs,style:{...r.style}}},[t]);if(e.style){const r={};jB(r,e.style,e),o.style={...r,...o.style}}return o}function zCe(e=!1){return(n,s,o,{latestValues:r},a)=>{const d=(x_(n)?VCe:NCe)(s,r,a,n),u=$Ce(s,typeof n=="string",e),h=n!==c.Fragment?{...u,...d,ref:o}:{},{children:p}=s,f=c.useMemo(()=>Ps(p)?p.get():p,[p]);return c.createElement(n,{...h,children:f})}}function GCe(e,t){return function(s,{forwardMotionProps:o}={forwardMotionProps:!1}){const a={...x_(s)?LCe:DCe,preloadedFeatures:e,useRender:zCe(o),createVisualElement:t,Component:s};return bCe(a)}}const vw={current:null},IB={current:!1};function HCe(){if(IB.current=!0,!!g_)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>vw.current=e.matches;e.addListener(t),t()}else vw.current=!1}function WCe(e,t,n){for(const s in t){const o=t[s],r=n[s];if(Ps(o))e.addValue(s,o);else if(Ps(r))e.addValue(s,jf(o,{owner:e}));else if(r!==o)if(e.hasValue(s)){const a=e.getValue(s);a.liveStyle===!0?a.jump(o):a.hasAnimated||a.set(o)}else{const a=e.getStaticValue(s);e.addValue(s,jf(a!==void 0?a:o,{owner:e}))}}for(const s in n)t[s]===void 0&&e.removeValue(s);return t}const SM=new WeakMap,UCe=[...gF,Ts,nl],qCe=e=>UCe.find(mF(e)),kM=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class KCe{scrapeMotionValuesFromProps(t,n,s){return{}}constructor({parent:t,props:n,presenceContext:s,reducedMotionConfig:o,blockInitialAnimation:r,visualState:a},l={}){this.applyWillChange=!1,this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=e_,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=dr.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,Xt.render(this.render,!1,!0))};const{latestValues:d,renderState:u}=a;this.latestValues=d,this.baseTarget={...d},this.initialValues=n.initial?{...d}:{},this.renderState=u,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=o,this.options=l,this.blockInitialAnimation=!!r,this.isControllingVariants=Xy(n),this.isVariantNode=gB(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:h,...p}=this.scrapeMotionValuesFromProps(n,{},this);for(const f in p){const m=p[f];d[f]!==void 0&&Ps(m)&&m.set(d[f],!1)}}mount(t){this.current=t,SM.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),IB.current||HCe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:vw.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){SM.delete(this.current),this.projection&&this.projection.unmount(),el(this.notifyUpdate),el(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const s=gl.has(t),o=n.on("change",l=>{this.latestValues[t]=l,this.props.onUpdate&&Xt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),r=n.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{o(),r(),a&&a(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in au){const n=au[t];if(!n)continue;const{isEnabled:s,Feature:o}=n;if(!this.features[t]&&o&&s(this.props)&&(this.features[t]=new o(this)),this.features[t]){const r=this.features[t];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Pn()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<kM.length;s++){const o=kM[s];this.propEventSubscriptions[o]&&(this.propEventSubscriptions[o](),delete this.propEventSubscriptions[o]);const r="on"+o,a=t[r];a&&(this.propEventSubscriptions[o]=this.on(o,a))}this.prevMotionValues=WCe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const s=this.values.get(t);n!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&n!==void 0&&(s=jf(n===null?void 0:n,{owner:this}),this.addValue(t,s)),s}readValue(t,n){var s;let o=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(s=this.getBaseTargetFromProps(this.props,t))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,t,this.options);return o!=null&&(typeof o=="string"&&(uF(o)||cF(o))?o=parseFloat(o):!qCe(o)&&nl.test(n)&&(o=kF(t,n)),this.setBaseTarget(t,Ps(o)?o.get():o)),Ps(o)?o.get():o}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var n;const{initial:s}=this.props;let o;if(typeof s=="string"||typeof s=="object"){const a=qj(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);a&&(o=a[t])}if(s&&o!==void 0)return o;const r=this.getBaseTargetFromProps(this.props,t);return r!==void 0&&!Ps(r)?r:this.initialValues[t]!==void 0&&o===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new h_),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}}class TB extends KCe{constructor(){super(...arguments),this.KeyframeResolver=jF}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:s}){delete n[t],delete s[t]}}function ZCe(e){return window.getComputedStyle(e)}class YCe extends TB{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0,this.renderInstance=xB}readValueFromInstance(t,n){if(gl.has(n)){const s=i_(n);return s&&s.default||0}else{const s=ZCe(t),o=(pF(n)?s.getPropertyValue(n):s[n])||0;return typeof o=="string"?o.trim():o}}measureInstanceViewportBox(t,{transformPagePoint:n}){return eB(t,n)}build(t,n,s){C_(t,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,n,s){return y_(t,n,s)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Ps(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class XCe extends TB{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Pn}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(gl.has(n)){const s=i_(n);return s&&s.default||0}return n=yB.has(n)?n:qy(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,s){return CB(t,n,s)}build(t,n,s){w_(t,n,this.isSVGTag,s.transformTemplate)}renderInstance(t,n,s,o){bB(t,n,s,o)}mount(t){this.isSVGTag=S_(t.tagName),super.mount(t)}}const QCe=(e,t)=>x_(e)?new XCe(t):new YCe(t,{allowProjection:e!==c.Fragment}),JCe=GCe({...Vve,...cCe,...Q2e,...dCe},QCe),k_=Pye(JCe);class ewe extends c.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function twe({children:e,isPresent:t}){const n=c.useId(),s=c.useRef(null),o=c.useRef({width:0,height:0,top:0,left:0}),{nonce:r}=c.useContext(m_);return c.useInsertionEffect(()=>{const{width:a,height:l,top:d,left:u}=o.current;if(t||!s.current||!a||!l)return;s.current.dataset.motionPopId=n;const h=document.createElement("style");return r&&(h.nonce=r),document.head.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${l}px !important;
            top: ${d}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(h)}},[t]),i.jsx(ewe,{isPresent:t,childRef:s,sizeRef:o,children:c.cloneElement(e,{ref:s})})}const nwe=({children:e,initial:t,isPresent:n,onExitComplete:s,custom:o,presenceAffectsLayout:r,mode:a})=>{const l=b_(swe),d=c.useId(),u=c.useMemo(()=>({id:d,initial:t,isPresent:n,custom:o,onExitComplete:h=>{l.set(h,!0);for(const p of l.values())if(!p)return;s&&s()},register:h=>(l.set(h,!1),()=>l.delete(h))}),r?[Math.random()]:[n]);return c.useMemo(()=>{l.forEach((h,p)=>l.set(p,!1))},[n]),c.useEffect(()=>{!n&&!l.size&&s&&s()},[n]),a==="popLayout"&&(e=i.jsx(twe,{isPresent:n,children:e})),i.jsx(Zy.Provider,{value:u,children:e})};function swe(){return new Map}const Bg=e=>e.key||"";function jM(e){const t=[];return c.Children.forEach(e,n=>{c.isValidElement(n)&&t.push(n)}),t}const AB=({children:e,exitBeforeEnter:t,custom:n,initial:s=!0,onExitComplete:o,presenceAffectsLayout:r=!0,mode:a="sync"})=>{const l=c.useMemo(()=>jM(e),[e]),d=l.map(Bg),u=c.useRef(!0),h=c.useRef(l),p=b_(()=>new Map),[f,m]=c.useState(l),[g,x]=c.useState(l);pB(()=>{u.current=!1,h.current=l;for(let y=0;y<g.length;y++){const v=Bg(g[y]);d.includes(v)?p.delete(v):p.get(v)!==!0&&p.set(v,!1)}},[g,d.length,d.join("-")]);const b=[];if(l!==f){let y=[...l];for(let v=0;v<g.length;v++){const w=g[v],k=Bg(w);d.includes(k)||(y.splice(v,0,w),b.push(w))}a==="wait"&&b.length&&(y=b),x(jM(y)),m(l);return}const{forceRender:C}=c.useContext(p_);return i.jsx(i.Fragment,{children:g.map(y=>{const v=Bg(y),w=l===g||d.includes(v),k=()=>{if(p.has(v))p.set(v,!0);else return;let S=!0;p.forEach(P=>{P||(S=!1)}),S&&(C==null||C(),x(h.current),o&&o())};return i.jsx(nwe,{isPresent:w,initial:!u.current||s?void 0:!1,custom:w?void 0:n,presenceAffectsLayout:r,mode:a,onExitComplete:w?void 0:k,children:y},v)})})},iwe=e=>{const t=$t(),n=G(),s=c.useCallback(()=>{t.open(),n(ji("gallery"))},[t,n]);return i.jsx(de,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},owe=()=>{const{t:e}=M(),t=Uj(),n=A(On),s=c.useMemo(()=>n!=="canvas"||!t?!1:t==="gallery",[t,n]);return i.jsx(MB,{title:e("controlLayers.sendingToGallery"),description:i.jsx(Wt,{i18nKey:"controlLayers.viewProgressInViewer",components:{Btn:i.jsx(iwe,{})}}),isVisible:s})},rwe=e=>{const t=G(),n=$t(),s=c.useCallback(()=>{t(Yt("canvas")),t(ji("layers")),n.close()},[t,n]);return i.jsx(de,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},awe=()=>{const{t:e}=M(),t=Uj(),n=A(li),s=A(On),o=c.useMemo(()=>s!=="canvas"&&t!=="canvas"?!1:n?!0:t?t==="canvas":!1,[t,n,s]);return i.jsx(MB,{title:e("controlLayers.sendingToCanvas"),description:i.jsx(Wt,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:i.jsx(rwe,{})}}),isVisible:o})},MB=({title:e,description:t,isVisible:n})=>{const s=Hx(!1);return i.jsx(AB,{children:(n||s.isTrue)&&i.jsx(k_.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.1,ease:"easeOut"}},exit:{opacity:0,transition:{duration:.1,delay:s.isTrue?.1:1,ease:"easeIn"}},onMouseEnter:s.setTrue,onMouseLeave:s.setFalse,children:i.jsxs(wc,{status:"warning",flexDir:"column",pointerEvents:"auto",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[i.jsxs(T,{w:"full",alignItems:"center",children:[i.jsx(Sc,{}),i.jsx(nm,{children:e})]}),i.jsx(Ra,{children:t})]})})})},EB=c.memo(()=>{const e=Lt(),t=Iye(),n=c.useMemo(()=>jn(t.map(({transformer:a})=>a.$isPendingRectCalculation),(...a)=>a.some(l=>l)),[t]),s=re(n),o=re(e.stateApi.$isRasterizing),r=re(e.compositor.$isBusy);return o||r||s?i.jsx(ci,{opacity:.3}):null});EB.displayName="CanvasBusySpinner";const PB=c.memo(()=>{const{t:e}=M(),t=lt(),n=Lt(),s=c.useCallback(async()=>{const o=n.getAllAdapters();for(const r of o)await r.cropToBbox()},[n]);return i.jsx(fe,{icon:i.jsx(S7,{}),isDisabled:t,onClick:s,children:e("controlLayers.canvasContextMenu.cropCanvasToBbox")})});PB.displayName="CanvasContextMenuItemsCropCanvasToBbox";const E1=Wn("canvas"),lwe=()=>{const{t:e}=M(),t=fl();return c.useCallback(async s=>{if(s)try{const o=s.getCanvas(),r=await af(o);t.writeImage(r,()=>{E1.trace("Layer copied to clipboard"),ge({status:"info",title:e("toast.layerCopiedToClipboard")})})}catch(o){E1.error({error:$n(o)},"Problem copying layer to clipboard"),ge({status:"error",title:e("toast.problemCopyingLayer")})}},[t,e])},_M=e=>{const{t}=M(),n=fl(),s=Lt();return c.useCallback(async()=>{const r=e==="bbox"?s.stateApi.getBbox().rect:s.compositor.getVisibleRectOfType("raster_layer");if(r.width===0||r.height===0){ge({title:t("controlLayers.copyRegionError",{region:v0(e)}),description:t("controlLayers.regionIsEmpty"),status:"warning"});return}try{const a=s.compositor.getVisibleAdaptersOfType("raster_layer"),l=s.compositor.getCompositeCanvas(a,r),d=await af(l);n.writeImage(d,()=>{E1.trace("Region copied to clipboard"),ge({title:t("controlLayers.regionCopiedToClipboard",{region:v0(e)})})})}catch(a){E1.error({error:$n(a)},"Failed to save canvas to gallery"),ge({title:t("controlLayers.copyRegionError",{region:v0(e)}),status:"error"})}},[s.compositor,s.stateApi,n,e,t])},cwe=Wn("canvas"),ha=({region:e,saveToGallery:t,toastOk:n,toastError:s,onSave:o,withMetadata:r})=>{const{t:a}=M(),l=Tc(),d=Lt();return c.useCallback(async()=>{const h=e==="bbox"?d.stateApi.getBbox().rect:d.compositor.getVisibleRectOfType("raster_layer");if(h.width===0||h.height===0){ge({title:s,description:a("controlLayers.regionIsEmpty"),status:"warning"});return}let p;const f=l.getState();if(r){p=Cee(f),p.positive_prompt=AP(f),p.negative_prompt=MP(f),p.seed=EP(f);const x=Ex(f);x&&(p.model=ss.getModelMetadataField(x))}let m;t&&(m=qs(f));const g=await Zn(()=>{const x=d.compositor.getVisibleAdaptersOfType("raster_layer");return d.compositor.getCompositeImageDTO(x,h,{is_intermediate:!t,metadata:p,board_id:m,silent:!0},void 0,!0)});g.isOk()?(o&&o(g.value,h),ge({title:n})):(cwe.error({error:$n(g.error)},"Failed to save canvas to gallery"),ge({title:s,status:"error"}))},[d.compositor,d.stateApi,o,e,t,l,a,s,n,r])},LB=()=>{const{t:e}=M(),t=c.useMemo(()=>({region:"canvas",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return ha(t)},DB=()=>{const{t:e}=M(),t=c.useMemo(()=>({region:"bbox",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return ha(t)},dwe=()=>{const{t:e}=M(),t=G(),n=A(Em),s=c.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:a=>{const d={referenceImages:[{id:Te("regional_guidance_reference_image"),ipAdapter:{...gt(n),image:ic(a)}}]};t(Ka({overrides:d,isSelected:!0}))},toastOk:e("controlLayers.newRegionalReferenceImageOk"),toastError:e("controlLayers.newRegionalReferenceImageError")}),[n,t,e]);return ha(s)},uwe=()=>{const{t:e}=M(),t=G(),n=A(Vy),s=c.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:a=>{const l={ipAdapter:{...gt(n),image:ic(a)}};t(Nx({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newGlobalReferenceImageOk"),toastError:e("controlLayers.newGlobalReferenceImageError")}),[n,t,e]);return ha(s)},hwe=()=>{const{t:e}=M(),t=G(),n=c.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(r,a)=>{const l={objects:[ao(r)],position:{x:a.x,y:a.y}};t(vu({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newRasterLayerOk"),toastError:e("controlLayers.newRasterLayerError")}),[t,e]);return ha(n)},pwe=()=>{const{t:e}=M(),t=G(),n=c.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(r,a)=>{const l={objects:[ao(r)],controlAdapter:gt(kc),position:{x:a.x,y:a.y}};t(Xf({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newControlLayerOk"),toastError:e("controlLayers.newControlLayerError")}),[t,e]);return ha(n)},RB=e=>{const{t}=M(),n=G(),s=c.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,l)=>{n(PS({entityIdentifier:e,position:{x:l.x,y:l.y},imageObject:ao(a),replaceObjects:!0}))},toastOk:t("controlLayers.pullBboxIntoLayerOk"),toastError:t("controlLayers.pullBboxIntoLayerError")}),[n,e,t]);return ha(s)},j_=e=>{const{t}=M(),n=G(),s=c.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,l)=>{n(MS({entityIdentifier:e,imageDTO:a}))},toastOk:t("controlLayers.pullBboxIntoReferenceImageOk"),toastError:t("controlLayers.pullBboxIntoReferenceImageError")}),[n,e,t]);return ha(s)},OB=(e,t)=>{const{t:n}=M(),s=G(),o=c.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(l,d)=>{s(ES({entityIdentifier:e,referenceImageId:t,imageDTO:l}))},toastOk:n("controlLayers.pullBboxIntoReferenceImageOk"),toastError:n("controlLayers.pullBboxIntoReferenceImageError")}),[s,e,t,n]);return ha(o)},NB=c.memo(()=>{const{t:e}=M(),t=oi(),n=oi(),s=oi(),o=lt(),r=LB(),a=DB(),l=dwe(),d=uwe(),u=hwe(),h=pwe(),p=_M("canvas"),f=_M("bbox");return i.jsx(i.Fragment,{children:i.jsxs(ki,{title:e("controlLayers.canvasContextMenu.canvasGroup"),children:[i.jsx(PB,{}),i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(ar,{}),children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.canvasContextMenu.saveToGalleryGroup")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(fe,{icon:i.jsx(ar,{}),isDisabled:o,onClick:r,children:e("controlLayers.canvasContextMenu.saveCanvasToGallery")}),i.jsx(fe,{icon:i.jsx(ar,{}),isDisabled:o,onClick:a,children:e("controlLayers.canvasContextMenu.saveBboxToGallery")})]})]})}),i.jsx(fe,{...n.parentMenuItemProps,icon:i.jsx(Ms,{}),children:i.jsxs(on,{...n.menuProps,children:[i.jsx(rn,{...n.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.canvasContextMenu.bboxGroup")})}),i.jsxs(Et,{...n.menuListProps,children:[i.jsx(fe,{icon:i.jsx(Ms,{}),isDisabled:o,onClick:d,children:e("controlLayers.canvasContextMenu.newGlobalReferenceImage")}),i.jsx(fe,{icon:i.jsx(Ms,{}),isDisabled:o,onClick:l,children:e("controlLayers.canvasContextMenu.newRegionalReferenceImage")}),i.jsx(fe,{icon:i.jsx(Ms,{}),isDisabled:o,onClick:h,children:e("controlLayers.canvasContextMenu.newControlLayer")}),i.jsx(fe,{icon:i.jsx(Ms,{}),isDisabled:o,onClick:u,children:e("controlLayers.canvasContextMenu.newRasterLayer")})]})]})}),i.jsx(fe,{...s.parentMenuItemProps,icon:i.jsx(pn,{}),children:i.jsxs(on,{...s.menuProps,children:[i.jsx(rn,{...s.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.canvasContextMenu.copyToClipboard")})}),i.jsxs(Et,{...s.menuListProps,children:[i.jsx(fe,{icon:i.jsx(pn,{}),isDisabled:o,onClick:p,children:e("controlLayers.canvasContextMenu.copyCanvasToClipboard")}),i.jsx(fe,{icon:i.jsx(pn,{}),isDisabled:o,onClick:f,children:e("controlLayers.canvasContextMenu.copyBboxToClipboard")})]})]})})]})})});NB.displayName="CanvasContextMenuGlobalMenuItems";const fwe=(e,{id:t,type:n})=>n==="raster_layer"?{index:e.rasterLayers.entities.findIndex(s=>s.id===t),count:e.rasterLayers.entities.length}:n==="control_layer"?{index:e.controlLayers.entities.findIndex(s=>s.id===t),count:e.controlLayers.entities.length}:n==="regional_guidance"?{index:e.regionalGuidance.entities.findIndex(s=>s.id===t),count:e.regionalGuidance.entities.length}:n==="inpaint_mask"?{index:e.inpaintMasks.entities.findIndex(s=>s.id===t),count:e.inpaintMasks.entities.length}:n==="reference_image"?{index:e.referenceImages.entities.findIndex(s=>s.id===t),count:e.referenceImages.entities.length}:{index:-1,count:0},zu=c.memo(()=>{const{t:e}=M(),t=G(),n=We(),s=lt(),o=c.useMemo(()=>fn(Ye,h=>{const{index:p,count:f}=fwe(h,n);return{canMoveForwardOne:p<f-1,canMoveBackwardOne:p>0,canMoveToFront:p<f-1,canMoveToBack:p>0}}),[n]),r=A(o),a=c.useCallback(()=>{t(wee({entityIdentifier:n}))},[t,n]),l=c.useCallback(()=>{t(See({entityIdentifier:n}))},[t,n]),d=c.useCallback(()=>{t(kee({entityIdentifier:n}))},[t,n]),u=c.useCallback(()=>{t(jee({entityIdentifier:n}))},[t,n]);return i.jsxs(i.Fragment,{children:[i.jsx(no,{"aria-label":e("controlLayers.moveToFront"),tooltip:e("controlLayers.moveToFront"),onClick:l,isDisabled:!r.canMoveToFront||s,icon:i.jsx(Tpe,{})}),i.jsx(no,{"aria-label":e("controlLayers.moveForward"),tooltip:e("controlLayers.moveForward"),onClick:a,isDisabled:!r.canMoveForwardOne||s,icon:i.jsx(b7,{})}),i.jsx(no,{"aria-label":e("controlLayers.moveBackward"),tooltip:e("controlLayers.moveBackward"),onClick:d,isDisabled:!r.canMoveBackwardOne||s,icon:i.jsx(kpe,{})}),i.jsx(no,{"aria-label":e("controlLayers.moveToBack"),tooltip:e("controlLayers.moveToBack"),onClick:u,isDisabled:!r.canMoveToBack||s,icon:i.jsx(_pe,{})})]})});zu.displayName="CanvasEntityMenuItemsArrange";const Ro=e=>{const t=c.useMemo(()=>he(Ye,s=>{if(!e)return!1;const o=rl(s,e);return o?o.isLocked:!1}),[e]);return A(t)},Bm=c.memo(()=>{const{t:e}=M(),t=We(),n=Tr(t),s=lt(),o=Ro(t),r=c.useCallback(()=>{n&&n.cropToBbox()},[n]);return i.jsx(fe,{onClick:r,icon:i.jsx(S7,{}),isDisabled:s||o,children:e("controlLayers.cropLayerToBbox")})});Bm.displayName="CanvasEntityMenuItemsCropToBbox";const Gu=c.memo(({asIcon:e=!1})=>{const{t}=M(),n=G(),s=We(),o=lt(),r=c.useCallback(()=>{n(WS({entityIdentifier:s}))},[n,s]);return e?i.jsx(no,{"aria-label":t("common.delete"),tooltip:t("common.delete"),onClick:r,icon:i.jsx(Pi,{}),isDestructive:!0,isDisabled:o}):i.jsx(fe,{onClick:r,icon:i.jsx(Pi,{}),isDestructive:!0,isDisabled:o,children:t("common.delete")})});Gu.displayName="CanvasEntityMenuItemsDelete";const Hu=c.memo(()=>{const{t:e}=M(),t=G(),n=We(),s=lt(),o=c.useCallback(()=>{t(PP({entityIdentifier:n}))},[t,n]);return i.jsx(no,{"aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),onClick:o,icon:i.jsx(V7,{}),isDisabled:s})});Hu.displayName="CanvasEntityMenuItemsDuplicate";const $m=e=>{const t=c.useMemo(()=>e?_ee(e):()=>!1,[e]);return!A(t)},Qy=e=>{const t=Lt(),n=Tr(e),s=$t(),o=lt(),r=Ro(e),a=$m(e),l=c.useMemo(()=>!!(!e||!Y2(e)||!n||o||r||a),[e,n,o,r,a]),d=c.useCallback(()=>{if(l||!e||!Y2(e))return;const u=t.getAdapter(e);u&&(s.close(),u.filterer.start())},[l,e,t,s]);return{isDisabled:l,start:d}},__=c.memo(()=>{const{t:e}=M(),t=We(),n=Qy(t);return i.jsx(fe,{onClick:n.start,icon:i.jsx(uj,{}),isDisabled:n.isDisabled,children:e("controlLayers.filter.filter")})});__.displayName="CanvasEntityMenuItemsFilter";const mwe=e=>{const t=c.useMemo(()=>fn(Ye,s=>{const o=Iee(s,e);return o?ni(o):null}),[e]);return A(t)},Vm=c.memo(()=>{const{t:e}=M(),t=Lt(),n=lt(),s=We(),o=mwe(s),r=c.useCallback(()=>{o!==null&&t.compositor.mergeByEntityIdentifiers([o,s],!0)},[t.compositor,s,o]);return i.jsx(fe,{onClick:r,icon:i.jsx(B7,{}),isDisabled:n||o===null,children:e("controlLayers.mergeDown")})});Vm.displayName="CanvasEntityMenuItemsMergeDown";const gwe=Wn("canvas"),FB=()=>{const{t:e}=M(),t=A(qs);return c.useCallback(async s=>{if(s)try{const o=s.getCanvas(),r=await af(o),a=new File([r],`layer-${s.id}.png`,{type:"image/png"});er({file:a,image_category:"user",is_intermediate:!1,board_id:t==="none"?void 0:t})}catch(o){gwe.error({error:$n(o)},"Problem copying layer to clipboard"),ge({status:"error",title:e("toast.problemSavingLayer")})}},[t,e])},zm=c.memo(()=>{const{t:e}=M(),t=We(),n=Tr(t),s=lt(),o=FB(),r=c.useCallback(()=>{o(n)},[o,n]);return i.jsx(fe,{onClick:r,icon:i.jsx(ar,{}),isDisabled:s,children:e("controlLayers.saveLayerToAssets")})});zm.displayName="CanvasEntityMenuItemsSave";const BB=e=>{const t=Lt(),n=Tr(e),s=$t(),o=lt(),r=Ro(e),a=$m(e),l=c.useMemo(()=>!!(!e||!X2(e)||!n||o||r||a),[e,n,o,r,a]),d=c.useCallback(()=>{if(l||!e||!X2(e))return;const u=t.getAdapter(e);u&&(s.close(),u.segmentAnything.start())},[l,e,t,s]);return{isDisabled:l,start:d}},I_=c.memo(()=>{const{t:e}=M(),t=We(),n=BB(t);return i.jsx(fe,{onClick:n.start,icon:i.jsx(W7,{}),isDisabled:n.isDisabled,children:e("controlLayers.selectObject.selectObject")})});I_.displayName="CanvasEntityMenuItemsSelectObject";const T_=e=>{const t=Lt(),n=Tr(e),s=$t(),o=lt(),r=Ro(e),a=$m(e),l=c.useMemo(()=>!!(!e||!C0(e)||!n||o||r||a),[e,n,o,r,a]),d=c.useCallback(async()=>{if(l||!e||!C0(e))return;const h=t.getAdapter(e);h&&(s.close(),await h.transformer.startTransform())},[l,e,t,s]),u=c.useCallback(async()=>{if(l||!e||!C0(e))return;const h=t.getAdapter(e);h&&(s.close(),await h.transformer.startTransform({silent:!0}),h.transformer.fitToBboxContain(),await h.transformer.applyTransform())},[t,e,s,l]);return{isDisabled:l,start:d,fitToBbox:u}},Gm=c.memo(()=>{const{t:e}=M(),t=We(),n=T_(t);return i.jsxs(i.Fragment,{children:[i.jsx(fe,{onClick:n.start,icon:i.jsx(Sm,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.transform")}),i.jsx(fe,{onClick:n.fitToBbox,icon:i.jsx(pl,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.fitToBbox")})]})});Gm.displayName="CanvasEntityMenuItemsTransform";const $B=c.memo(()=>{const{t:e}=M(),t=oi(),n=G(),s=We("control_layer"),o=lt(),r=Ro(s),a=c.useCallback(()=>{n(LP({entityIdentifier:s,replace:!0}))},[n,s]),l=c.useCallback(()=>{n(DP({entityIdentifier:s,replace:!0}))},[n,s]),d=c.useCallback(()=>{n(RP({entityIdentifier:s,replace:!0}))},[n,s]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(to,{}),isDisabled:r||o,children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.convertControlLayerTo")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(fe,{onClick:a,icon:i.jsx(to,{}),isDisabled:r||o,children:e("controlLayers.inpaintMask")}),i.jsx(fe,{onClick:l,icon:i.jsx(to,{}),isDisabled:r||o,children:e("controlLayers.regionalGuidance")}),i.jsx(fe,{onClick:d,icon:i.jsx(to,{}),isDisabled:r||o,children:e("controlLayers.rasterLayer")})]})]})})});$B.displayName="ControlLayerMenuItemsConvertToSubMenu";const Hm=c.memo(()=>{const{t:e}=M(),t=We(),n=Tr(t),s=lt(),o=$m(t),r=lwe(),a=c.useCallback(()=>{r(n)},[r,n]);return i.jsx(fe,{onClick:a,icon:i.jsx(pn,{}),isDisabled:s||o,children:e("common.clipboard")})});Hm.displayName="CanvasEntityMenuItemsCopyToClipboard";const VB=c.memo(()=>{const{t:e}=M(),t=oi(),n=G(),s=We("control_layer"),o=lt(),r=c.useCallback(()=>{n(LP({entityIdentifier:s}))},[n,s]),a=c.useCallback(()=>{n(DP({entityIdentifier:s}))},[n,s]),l=c.useCallback(()=>{n(RP({entityIdentifier:s}))},[n,s]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(pn,{}),isDisabled:o,children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.copyControlLayerTo")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(Hm,{}),i.jsx(fe,{onClick:r,icon:i.jsx(pn,{}),isDisabled:o,children:e("controlLayers.newInpaintMask")}),i.jsx(fe,{onClick:a,icon:i.jsx(pn,{}),isDisabled:o,children:e("controlLayers.newRegionalGuidance")}),i.jsx(fe,{onClick:l,icon:i.jsx(pn,{}),isDisabled:o,children:e("controlLayers.newRasterLayer")})]})]})})});VB.displayName="ControlLayerMenuItemsCopyToSubMenu";const xwe=e=>he(Ye,t=>Cs(t,e,"ControlLayerMenuItemsTransparencyEffect").withTransparencyEffect),zB=c.memo(()=>{const{t:e}=M(),t=G(),n=We("control_layer"),s=Ro(n),o=c.useMemo(()=>xwe(n),[n]),r=A(o),a=c.useCallback(()=>{t(Tee({entityIdentifier:n}))},[t,n]);return i.jsx(fe,{onClick:a,icon:i.jsx(Gpe,{}),isDisabled:s,children:e(r?"controlLayers.disableTransparencyEffect":"controlLayers.enableTransparencyEffect")})});zB.displayName="ControlLayerMenuItemsTransparencyEffect";const A_=c.memo(()=>i.jsxs(i.Fragment,{children:[i.jsxs(Bu,{children:[i.jsx(zu,{}),i.jsx(Hu,{}),i.jsx(Gu,{asIcon:!0})]}),i.jsx(bs,{}),i.jsx(Gm,{}),i.jsx(__,{}),i.jsx(I_,{}),i.jsx(zB,{}),i.jsx(bs,{}),i.jsx(Vm,{}),i.jsx(VB,{}),i.jsx($B,{}),i.jsx(Bm,{}),i.jsx(zm,{})]}));A_.displayName="ControlLayerMenuItems";const GB=c.memo(()=>{const e=We("inpaint_mask"),{t}=M(),n=lt(),s=$ge(e),o=Vge(e);return i.jsxs(i.Fragment,{children:[i.jsx(fe,{onClick:s,isDisabled:n,children:t("controlLayers.addImageNoise")}),i.jsx(fe,{onClick:o,isDisabled:n,children:t("controlLayers.addDenoiseLimit")})]})});GB.displayName="InpaintMaskMenuItemsAddNoise";const HB=c.memo(()=>{const{t:e}=M(),t=oi(),n=G(),s=We("inpaint_mask"),o=lt(),r=Ro(s),a=c.useCallback(()=>{n(OP({entityIdentifier:s,replace:!0}))},[n,s]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(to,{}),isDisabled:o||r,children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.convertInpaintMaskTo")})}),i.jsx(Et,{...t.menuListProps,children:i.jsx(fe,{onClick:a,icon:i.jsx(to,{}),isDisabled:o||r,children:e("controlLayers.regionalGuidance")})})]})})});HB.displayName="InpaintMaskMenuItemsConvertToSubMenu";const WB=c.memo(()=>{const{t:e}=M(),t=oi(),n=G(),s=We("inpaint_mask"),o=lt(),r=c.useCallback(()=>{n(OP({entityIdentifier:s}))},[n,s]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(pn,{}),isDisabled:o,children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.copyInpaintMaskTo")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(Hm,{}),i.jsx(fe,{onClick:r,icon:i.jsx(pn,{}),isDisabled:o,children:e("controlLayers.newRegionalGuidance")})]})]})})});WB.displayName="InpaintMaskMenuItemsCopyToSubMenu";const M_=c.memo(()=>i.jsxs(i.Fragment,{children:[i.jsxs(Bu,{children:[i.jsx(zu,{}),i.jsx(Hu,{}),i.jsx(Gu,{asIcon:!0})]}),i.jsx(bs,{}),i.jsx(GB,{}),i.jsx(bs,{}),i.jsx(Gm,{}),i.jsx(bs,{}),i.jsx(Vm,{}),i.jsx(WB,{}),i.jsx(HB,{}),i.jsx(Bm,{}),i.jsx(zm,{})]}));M_.displayName="InpaintMaskMenuItems";const UB=c.memo(()=>{const{t:e}=M(),t=We("reference_image"),n=j_(t),s=lt();return i.jsx(fe,{onClick:n,icon:i.jsx(pl,{}),isDisabled:s,children:e("controlLayers.pullBboxIntoReferenceImage")})});UB.displayName="IPAdapterMenuItemPullBbox";const E_=c.memo(()=>i.jsxs(i.Fragment,{children:[i.jsxs(Bu,{children:[i.jsx(zu,{}),i.jsx(Hu,{}),i.jsx(Gu,{asIcon:!0})]}),i.jsx(bs,{}),i.jsx(UB,{})]}));E_.displayName="IPAdapterMenuItems";const qB=c.memo(()=>{const{t:e}=M(),t=oi(),n=G(),s=We("raster_layer"),o=lt(),r=Ro(s),a=c.useCallback(()=>{n(NP({entityIdentifier:s,replace:!0}))},[n,s]),l=c.useCallback(()=>{n(FP({entityIdentifier:s,replace:!0}))},[n,s]),d=c.useCallback(()=>{n(BP({entityIdentifier:s,replace:!0,overrides:{controlAdapter:gt(kc)}}))},[n,s]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(to,{}),isDisabled:o||r,children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.convertRasterLayerTo")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(fe,{onClick:a,icon:i.jsx(to,{}),isDisabled:o||r,children:e("controlLayers.inpaintMask")}),i.jsx(fe,{onClick:l,icon:i.jsx(to,{}),isDisabled:o||r,children:e("controlLayers.regionalGuidance")}),i.jsx(fe,{onClick:d,icon:i.jsx(to,{}),isDisabled:o||r,children:e("controlLayers.controlLayer")})]})]})})});qB.displayName="RasterLayerMenuItemsConvertToSubMenu";const KB=c.memo(()=>{const{t:e}=M(),t=oi(),n=G(),s=We("raster_layer"),o=lt(),r=c.useCallback(()=>{n(NP({entityIdentifier:s}))},[n,s]),a=c.useCallback(()=>{n(FP({entityIdentifier:s}))},[n,s]),l=c.useCallback(()=>{n(BP({entityIdentifier:s,overrides:{controlAdapter:gt(kc)}}))},[n,s]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(pn,{}),isDisabled:o,children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.copyRasterLayerTo")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(Hm,{}),i.jsx(fe,{onClick:r,icon:i.jsx(pn,{}),isDisabled:o,children:e("controlLayers.newInpaintMask")}),i.jsx(fe,{onClick:a,icon:i.jsx(pn,{}),isDisabled:o,children:e("controlLayers.newRegionalGuidance")}),i.jsx(fe,{onClick:l,icon:i.jsx(pn,{}),isDisabled:o,children:e("controlLayers.newControlLayer")})]})]})})});KB.displayName="RasterLayerMenuItemsCopyToSubMenu";const P_=c.memo(()=>i.jsxs(i.Fragment,{children:[i.jsxs(Bu,{children:[i.jsx(zu,{}),i.jsx(Hu,{}),i.jsx(Gu,{asIcon:!0})]}),i.jsx(bs,{}),i.jsx(Gm,{}),i.jsx(__,{}),i.jsx(I_,{}),i.jsx(bs,{}),i.jsx(Vm,{}),i.jsx(KB,{}),i.jsx(qB,{}),i.jsx(Bm,{}),i.jsx(zm,{})]}));P_.displayName="RasterLayerMenuItems";const ZB=c.memo(()=>{const e=We("regional_guidance"),{t}=M(),n=lt(),s=sO(e),o=iO(e),r=oO(e),a=c.useMemo(()=>rO(e),[e]),l=A(a);return i.jsxs(i.Fragment,{children:[i.jsx(fe,{onClick:o,isDisabled:!l.canAddPositivePrompt||n,children:t("controlLayers.addPositivePrompt")}),i.jsx(fe,{onClick:r,isDisabled:!l.canAddNegativePrompt||n,children:t("controlLayers.addNegativePrompt")}),i.jsx(fe,{onClick:s,isDisabled:n,children:t("controlLayers.addReferenceImage")})]})});ZB.displayName="RegionalGuidanceMenuItemsExtra";const YB=c.memo(()=>{const e=We("regional_guidance"),{t}=M(),n=G(),s=c.useMemo(()=>he(Ye,a=>Cs(a,e,"RegionalGuidanceMenuItemsAutoNegative").autoNegative),[e]),o=A(s),r=c.useCallback(()=>{n(Aee({entityIdentifier:e}))},[n,e]);return i.jsx(fe,{icon:i.jsx(ufe,{}),onClick:r,children:t(o?"controlLayers.disableAutoNegative":"controlLayers.enableAutoNegative")})});YB.displayName="RegionalGuidanceMenuItemsAutoNegative";const XB=c.memo(()=>{const{t:e}=M(),t=oi(),n=G(),s=We("regional_guidance"),o=lt(),r=Ro(s),a=c.useCallback(()=>{n($P({entityIdentifier:s,replace:!0}))},[n,s]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(to,{}),isDisabled:r||o,children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.convertRegionalGuidanceTo")})}),i.jsx(Et,{...t.menuListProps,children:i.jsx(fe,{onClick:a,icon:i.jsx(to,{}),isDisabled:r||o,children:e("controlLayers.inpaintMask")})})]})})});XB.displayName="RegionalGuidanceMenuItemsConvertToSubMenu";const QB=c.memo(()=>{const{t:e}=M(),t=oi(),n=G(),s=We("regional_guidance"),o=lt(),r=c.useCallback(()=>{n($P({entityIdentifier:s}))},[n,s]);return i.jsx(fe,{...t.parentMenuItemProps,icon:i.jsx(pn,{}),isDisabled:o,children:i.jsxs(on,{...t.menuProps,children:[i.jsx(rn,{...t.menuButtonProps,children:i.jsx(ri,{label:e("controlLayers.copyRegionalGuidanceTo")})}),i.jsxs(Et,{...t.menuListProps,children:[i.jsx(Hm,{}),i.jsx(fe,{onClick:r,icon:i.jsx(pn,{}),isDisabled:o,children:e("controlLayers.newInpaintMask")})]})]})})});QB.displayName="RegionalGuidanceMenuItemsCopyToSubMenu";const L_=c.memo(()=>i.jsxs(i.Fragment,{children:[i.jsxs(Bu,{children:[i.jsx(zu,{}),i.jsx(Hu,{}),i.jsx(Gu,{asIcon:!0})]}),i.jsx(bs,{}),i.jsx(ZB,{}),i.jsx(bs,{}),i.jsx(Gm,{}),i.jsx(YB,{}),i.jsx(bs,{}),i.jsx(Vm,{}),i.jsx(QB,{}),i.jsx(XB,{}),i.jsx(Bm,{}),i.jsx(zm,{})]}));L_.displayName="RegionalGuidanceMenuItems";const JB=(e,t=!1)=>{const{t:n}=M();return c.useMemo(()=>{switch(e){case"control_layer":return n(t?"controlLayers.controlLayer_withCount_other":"controlLayers.controlLayer");case"raster_layer":return n(t?"controlLayers.rasterLayer_withCount_other":"controlLayers.rasterLayer");case"inpaint_mask":return n(t?"controlLayers.inpaintMask_withCount_other":"controlLayers.inpaintMask");case"regional_guidance":return n(t?"controlLayers.regionalGuidance_withCount_other":"controlLayers.regionalGuidance");case"reference_image":return n(t?"controlLayers.globalReferenceImage_withCount_other":"controlLayers.globalReferenceImage");default:return""}},[e,t,n])},e$=c.memo(()=>{const e=We();if(e.type==="raster_layer")return i.jsx(P_,{});if(e.type==="control_layer")return i.jsx(A_,{});if(e.type==="inpaint_mask")return i.jsx(M_,{});if(e.type==="regional_guidance")return i.jsx(L_,{});if(e.type==="reference_image")return i.jsx(E_,{});ve(!1)});e$.displayName="CanvasContextMenuSelectedEntityMenuItemsContent";const t$=c.memo(e=>{const t=We(),n=JB(t.type);return i.jsx(ki,{title:n,children:e.children})});t$.displayName="CanvasContextMenuSelectedEntityMenuGroup";const n$=c.memo(()=>{const e=A(Mn);return e?i.jsx(Lc.Provider,{value:e,children:i.jsx(ua,{entityIdentifier:e,children:i.jsx(t$,{children:i.jsx(e$,{})})})}):null});n$.displayName="CanvasContextMenuSelectedEntityMenuItems";const Cw="drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))",s$=(e,t)=>{if(e.width===0||e.height===0)return{width:t.width,height:t.height};if(t.width<=e.width&&t.height<=e.height)return{width:t.width,height:t.height};const n=e.width/e.height,s=t.width/t.height;let o,r;return s>n?(o=e.width,r=o/s):(r=e.height,o=r*s),{width:o,height:r}},i$=(e,t,n,s)=>{const o=e==="fill"?t.width:t.width*s.width/n.width,r=e==="fill"?t.height:t.height*s.height/n.height;return{width:o,height:r}},o$=fn(Ai,e=>{const t=e.selection.slice(-1)[0]??null,n=e.imageToCompare;return{firstImage:t,secondImage:n}}),ywe=Wn("dnd"),Vi=e=>{const t=Symbol(e);return{type:e,key:t}},zi=e=>n=>!!n[e],Gi=(e,t)=>(s,o)=>({[e]:!0,id:o??Te(t),type:t,payload:s}),$g=Vi("single-image"),An={...$g,typeGuard:zi($g.key),getData:Gi($g.key,$g.type)},Vg=Vi("multiple-image"),oo={...Vg,typeGuard:zi(Vg.key),getData:Gi(Vg.key,Vg.type)},zg=Vi("single-canvas-entity"),Vd={...zg,typeGuard:zi(zg.key),getData:Gi(zg.key,zg.type)},Gg=Vi("set-global-reference-image"),_f={...Gg,typeGuard:zi(Gg.key),getData:Gi(Gg.key,Gg.type),isValid:({sourceData:e})=>!!An.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:o}=t.payload;fO({entityIdentifier:o,imageDTO:s,dispatch:n})}},Hg=Vi("set-regional-guidance-reference-image"),If={...Hg,typeGuard:zi(Hg.key),getData:Gi(Hg.key,Hg.type),isValid:({sourceData:e})=>!!An.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:o,referenceImageId:r}=t.payload;mO({imageDTO:s,entityIdentifier:o,referenceImageId:r,dispatch:n})}},Wg=Vi("set-upscale-initial-image"),ww={...Wg,typeGuard:zi(Wg.key),getData:Gi(Wg.key,Wg.type),isValid:({sourceData:e})=>!!An.typeGuard(e),handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;R0e({imageDTO:n,dispatch:t})}},Ug=Vi("set-node-image-field-image"),Sw={...Ug,typeGuard:zi(Ug.key),getData:Gi(Ug.key,Ug.type),isValid:({sourceData:e})=>!!An.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{fieldIdentifier:o}=t.payload;O0e({fieldIdentifier:o,imageDTO:s,dispatch:n})}},qg=Vi("add-images-to-image-collection-node-field"),kw={...qg,typeGuard:zi(qg.key),getData:Gi(qg.key,qg.type),isValid:({sourceData:e})=>!!(An.typeGuard(e)||oo.typeGuard(e)),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{if(!An.typeGuard(e)&&!oo.typeGuard(e))return;const{fieldIdentifier:o}=t.payload,r=Wx(Xe(s()),o.nodeId,o.fieldName);if(!Mx(r)){ywe.warn({fieldIdentifier:o},"Attempted to add images to a non-image field collection");return}const a=r.value?[...r.value]:[];An.typeGuard(e)?a.push({image_name:e.payload.imageDTO.image_name}):a.push(...e.payload.imageDTOs.map(({image_name:l})=>({image_name:l}))),n(Q2({...o,value:a}))}},Kg=Vi("set-comparison-image"),jw={...Kg,typeGuard:zi(Kg.key),getData:Gi(Kg.key,Kg.type),isValid:({sourceData:e,getState:t})=>{if(!An.typeGuard(e))return!1;const{firstImage:n,secondImage:s}=o$(t());return!(e.payload.imageDTO.image_name===(n==null?void 0:n.image_name)||e.payload.imageDTO.image_name===(s==null?void 0:s.image_name))},handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;N0e({imageDTO:n,dispatch:t})}},Zg=Vi("new-canvas-entity-from-image"),Kr={...Zg,typeGuard:zi(Zg.key),getData:Gi(Zg.key,Zg.type),isValid:({sourceData:e})=>!!An.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{type:o}=t.payload,{imageDTO:r}=e.payload;Qi({type:o,imageDTO:r,dispatch:n,getState:s})}},Yg=Vi("replace-canvas-entity-objects-with-image"),Tf={...Yg,typeGuard:zi(Yg.key),getData:Gi(Yg.key,Yg.type),isValid:({sourceData:e})=>!!An.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{imageDTO:o}=e.payload,{entityIdentifier:r}=t.payload;Nj({imageDTO:o,entityIdentifier:r,dispatch:n,getState:s})}},Xg=Vi("add-to-board"),P1={...Xg,typeGuard:zi(Xg.key),getData:Gi(Xg.key,Xg.type),isValid:({sourceData:e,targetData:t})=>{if(An.typeGuard(e)){const n=e.payload.imageDTO.board_id??"none",s=t.payload.boardId;return n!==s}if(oo.typeGuard(e)){const n=e.payload.boardId,s=t.payload.boardId;return n!==s}return!1},handler:({sourceData:e,targetData:t,dispatch:n})=>{if(An.typeGuard(e)){const{imageDTO:s}=e.payload,{boardId:o}=t.payload;FA({imageDTOs:[s],boardId:o,dispatch:n})}if(oo.typeGuard(e)){const{imageDTOs:s}=e.payload,{boardId:o}=t.payload;FA({imageDTOs:s,boardId:o,dispatch:n})}}},Qg=Vi("remove-from-board"),L1={...Qg,typeGuard:zi(Qg.key),getData:Gi(Qg.key,Qg.type),isValid:({sourceData:e})=>An.typeGuard(e)?(e.payload.imageDTO.board_id??"none")!=="none":oo.typeGuard(e)?e.payload.boardId!=="none":!1,handler:({sourceData:e,dispatch:t})=>{if(An.typeGuard(e)){const{imageDTO:n}=e.payload;BA({imageDTOs:[n],dispatch:t})}if(oo.typeGuard(e)){const{imageDTOs:n}=e.payload;BA({imageDTOs:n,dispatch:t})}}},bwe=[_f,If,ww,Sw,jw,Kr,Tf,P1,L1,P1,L1,kw],vwe={position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",pointerEvents:"auto",'&[data-dnd-state="idle"]':{pointerEvents:"none"}},Ls=c.memo(e=>{const{dndTarget:t,dndTargetData:n,label:s,isDisabled:o}=e,[r,a]=c.useState("idle"),l=c.useRef(null),d=G();return c.useEffect(()=>{const u=l.current;if(!u||o)return;const{dispatch:h,getState:p}=em();return Xn(Jd({element:u,canDrop:({source:f})=>{const m={sourceData:f.data,targetData:n,dispatch:h,getState:p};return t.isValid(m)},onDragEnter:()=>{a("over")},onDragLeave:()=>{a("potential")},getData:()=>n}),or({canMonitor:({source:f})=>{const m={sourceData:f.data,targetData:n,dispatch:h,getState:p};return t.isValid(m)},onDragStart:()=>{a("potential")},onDrop:()=>{a("idle")}}))},[d,o,t,n]),i.jsx(Ce,{ref:l,sx:vwe,"data-dnd-state":r,children:i.jsx(yf,{dndState:r,label:s})})});Ls.displayName="DndDropTarget";const Cwe=Kr.getData({type:"raster_layer"}),wwe=Kr.getData({type:"control_layer"}),Swe=Kr.getData({type:"regional_guidance_with_reference_image"}),kwe=Kr.getData({type:"reference_image"}),r$=c.memo(()=>{const{t:e}=M(),t=$t(),n=lt();return t.isOpen?null:i.jsx(i.Fragment,{children:i.jsxs(Mi,{gridTemplateRows:"1fr 1fr",gridTemplateColumns:"1fr 1fr",position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:[i.jsx(vt,{position:"relative",children:i.jsx(Ls,{dndTarget:Kr,dndTargetData:Cwe,label:e("controlLayers.canvasContextMenu.newRasterLayer"),isDisabled:n})}),i.jsx(vt,{position:"relative",children:i.jsx(Ls,{dndTarget:Kr,dndTargetData:wwe,label:e("controlLayers.canvasContextMenu.newControlLayer"),isDisabled:n})}),i.jsx(vt,{position:"relative",children:i.jsx(Ls,{dndTarget:Kr,dndTargetData:Swe,label:e("controlLayers.canvasContextMenu.newRegionalReferenceImage"),isDisabled:n})}),i.jsx(vt,{position:"relative",children:i.jsx(Ls,{dndTarget:Kr,dndTargetData:kwe,label:e("controlLayers.canvasContextMenu.newGlobalReferenceImage"),isDisabled:n})})]})})});r$.displayName="CanvasDropArea";const D_=c.memo(()=>{const{t:e}=M(),t=G(),n=A(sm),s=c.useCallback(()=>{t(Mee())},[t]);return i.jsxs(Q,{w:"min-content",children:[i.jsx(J,{m:0,children:e("controlLayers.filter.autoProcess")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});D_.displayName="CanvasAutoProcessSwitch";const Jy=c.memo(()=>{const{t:e}=M(),t=G(),n=A(Q0),s=c.useCallback(()=>{t(VP())},[t]);return i.jsx(Oe,{label:e("controlLayers.settings.isolatedLayerPreviewDesc"),children:i.jsxs(Q,{w:"min-content",children:[i.jsx(J,{m:0,children:e("controlLayers.settings.isolatedPreview")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})})});Jy.displayName="CanvasOperationIsolatedLayerPreviewSwitch";const a$=Ve.enum(["Red (RGBA)","Green (RGBA)","Blue (RGBA)","Alpha (RGBA)","Cyan (CMYK)","Magenta (CMYK)","Yellow (CMYK)","Black (CMYK)","Hue (HSV)","Saturation (HSV)","Value (HSV)","Luminosity (LAB)","A (LAB)","B (LAB)","Y (YCbCr)","Cb (YCbCr)","Cr (YCbCr)"]),jwe=e=>a$.safeParse(e).success,_we=Ve.object({type:Ve.literal("adjust_image"),channel:a$,value:Ve.number(),scale_values:Ve.boolean().optional()}),Iwe=Ve.object({type:Ve.literal("canny_edge_detection"),low_threshold:Ve.number().int().gte(0).lte(255),high_threshold:Ve.number().int().gte(0).lte(255)}),Twe=Ve.object({type:Ve.literal("color_map"),tile_size:Ve.number().int().gte(1)}),Awe=Ve.object({type:Ve.literal("content_shuffle"),scale_factor:Ve.number().int().gte(1)}),l$=Ve.enum(["large","base","small","small_v2"]),Mwe=e=>l$.safeParse(e).success,Ewe=Ve.object({type:Ve.literal("depth_anything_depth_estimation"),model_size:l$}),Pwe=Ve.object({type:Ve.literal("hed_edge_detection"),scribble:Ve.boolean()}),Lwe=Ve.object({type:Ve.literal("lineart_anime_edge_detection")}),Dwe=Ve.object({type:Ve.literal("lineart_edge_detection"),coarse:Ve.boolean()}),Rwe=Ve.object({type:Ve.literal("mediapipe_face_detection"),max_faces:Ve.number().int().gte(1),min_confidence:Ve.number().gte(0).lte(1)}),Owe=Ve.object({type:Ve.literal("mlsd_detection"),score_threshold:Ve.number().gte(0),distance_threshold:Ve.number().gte(0)}),Nwe=Ve.object({type:Ve.literal("normal_map")}),Fwe=Ve.object({type:Ve.literal("pidi_edge_detection"),quantize_edges:Ve.boolean(),scribble:Ve.boolean()}),Bwe=Ve.object({type:Ve.literal("dw_openpose_detection"),draw_body:Ve.boolean(),draw_face:Ve.boolean(),draw_hands:Ve.boolean()}),$we=Ve.object({type:Ve.literal("spandrel_filter"),model:ro.nullable(),autoScale:Ve.boolean(),scale:Ve.number().gte(1).lte(16)}),c$=Ve.enum(["gaussian","box"]),Vwe=e=>c$.safeParse(e).success,zwe=Ve.object({type:Ve.literal("img_blur"),blur_type:c$,radius:Ve.number().gte(0)}),d$=Ve.enum(["gaussian","salt_and_pepper"]),Gwe=e=>d$.safeParse(e).success,Hwe=Ve.object({type:Ve.literal("img_noise"),noise_type:d$,amount:Ve.number().gte(0).lte(1),noise_color:Ve.boolean(),size:Ve.number().int().gte(1)});Ve.discriminatedUnion("type",[_we,Iwe,Twe,Awe,Ewe,Pwe,Lwe,Dwe,Rwe,Owe,Nwe,Fwe,Bwe,$we,zwe,Hwe]);const Wwe=Ve.enum(["adjust_image","canny_edge_detection","color_map","content_shuffle","depth_anything_depth_estimation","hed_edge_detection","lineart_anime_edge_detection","lineart_edge_detection","mediapipe_face_detection","mlsd_detection","normal_map","pidi_edge_detection","dw_openpose_detection","spandrel_filter","img_blur","img_noise"]),u$=e=>Wwe.safeParse(e).success,Gn={adjust_image:{type:"adjust_image",buildDefaults:()=>({type:"adjust_image",channel:"Luminosity (LAB)",value:1,scale_values:!1}),buildGraph:({image_name:e},{channel:t,value:n,scale_values:s})=>{const o=new ss(Te("adjust_image_filter"));let r;return s?r=o.addNode({id:Te("img_channel_multiply"),type:"img_channel_multiply",image:{image_name:e},channel:t,scale:n,invert_channel:!1}):(n=Math.min(n,2),r=o.addNode({id:Te("img_channel_offset"),type:"img_channel_offset",image:{image_name:e},channel:t,offset:Math.round(255*(n-1))})),{graph:o,outputNodeId:r.id}}},canny_edge_detection:{type:"canny_edge_detection",buildDefaults:()=>({type:"canny_edge_detection",low_threshold:100,high_threshold:200}),buildGraph:({image_name:e},{low_threshold:t,high_threshold:n})=>{const s=new ss(Te("canny_edge_detection_filter")),o=s.addNode({id:Te("canny_edge_detection"),type:"canny_edge_detection",image:{image_name:e},low_threshold:t,high_threshold:n});return{graph:s,outputNodeId:o.id}}},color_map:{type:"color_map",buildDefaults:()=>({type:"color_map",tile_size:64}),buildGraph:({image_name:e},{tile_size:t})=>{const n=new ss(Te("color_map_filter")),s=n.addNode({id:Te("color_map"),type:"color_map",image:{image_name:e},tile_size:t});return{graph:n,outputNodeId:s.id}}},content_shuffle:{type:"content_shuffle",buildDefaults:()=>({type:"content_shuffle",scale_factor:256}),buildGraph:({image_name:e},{scale_factor:t})=>{const n=new ss(Te("content_shuffle_filter")),s=n.addNode({id:Te("content_shuffle"),type:"content_shuffle",image:{image_name:e},scale_factor:t});return{graph:n,outputNodeId:s.id}}},depth_anything_depth_estimation:{type:"depth_anything_depth_estimation",buildDefaults:()=>({type:"depth_anything_depth_estimation",model_size:"small_v2"}),buildGraph:({image_name:e},{model_size:t})=>{const n=new ss(Te("depth_anything_depth_estimation_filter")),s=n.addNode({id:Te("depth_anything_depth_estimation"),type:"depth_anything_depth_estimation",image:{image_name:e},model_size:t});return{graph:n,outputNodeId:s.id}}},hed_edge_detection:{type:"hed_edge_detection",buildDefaults:()=>({type:"hed_edge_detection",scribble:!1}),buildGraph:({image_name:e},{scribble:t})=>{const n=new ss(Te("hed_edge_detection_filter")),s=n.addNode({id:Te("hed_edge_detection"),type:"hed_edge_detection",image:{image_name:e},scribble:t});return{graph:n,outputNodeId:s.id}}},lineart_anime_edge_detection:{type:"lineart_anime_edge_detection",buildDefaults:()=>({type:"lineart_anime_edge_detection"}),buildGraph:({image_name:e})=>{const t=new ss(Te("lineart_anime_edge_detection_filter")),n=t.addNode({id:Te("lineart_anime_edge_detection"),type:"lineart_anime_edge_detection",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},lineart_edge_detection:{type:"lineart_edge_detection",buildDefaults:()=>({type:"lineart_edge_detection",coarse:!1}),buildGraph:({image_name:e},{coarse:t})=>{const n=new ss(Te("lineart_edge_detection_filter")),s=n.addNode({id:Te("lineart_edge_detection"),type:"lineart_edge_detection",image:{image_name:e},coarse:t});return{graph:n,outputNodeId:s.id}}},mediapipe_face_detection:{type:"mediapipe_face_detection",buildDefaults:()=>({type:"mediapipe_face_detection",max_faces:1,min_confidence:.5}),buildGraph:({image_name:e},{max_faces:t,min_confidence:n})=>{const s=new ss(Te("mediapipe_face_detection_filter")),o=s.addNode({id:Te("mediapipe_face_detection"),type:"mediapipe_face_detection",image:{image_name:e},max_faces:t,min_confidence:n});return{graph:s,outputNodeId:o.id}}},mlsd_detection:{type:"mlsd_detection",buildDefaults:()=>({type:"mlsd_detection",score_threshold:.1,distance_threshold:20}),buildGraph:({image_name:e},{score_threshold:t,distance_threshold:n})=>{const s=new ss(Te("mlsd_detection_filter")),o=s.addNode({id:Te("mlsd_detection"),type:"mlsd_detection",image:{image_name:e},score_threshold:t,distance_threshold:n});return{graph:s,outputNodeId:o.id}}},normal_map:{type:"normal_map",buildDefaults:()=>({type:"normal_map"}),buildGraph:({image_name:e})=>{const t=new ss(Te("normal_map_filter")),n=t.addNode({id:Te("normal_map"),type:"normal_map",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},pidi_edge_detection:{type:"pidi_edge_detection",buildDefaults:()=>({type:"pidi_edge_detection",quantize_edges:!1,scribble:!1}),buildGraph:({image_name:e},{quantize_edges:t,scribble:n})=>{const s=new ss(Te("pidi_edge_detection_filter")),o=s.addNode({id:Te("pidi_edge_detection"),type:"pidi_edge_detection",image:{image_name:e},quantize_edges:t,scribble:n});return{graph:s,outputNodeId:o.id}}},dw_openpose_detection:{type:"dw_openpose_detection",buildDefaults:()=>({type:"dw_openpose_detection",draw_body:!0,draw_face:!0,draw_hands:!0}),buildGraph:({image_name:e},{draw_body:t,draw_face:n,draw_hands:s})=>{const o=new ss(Te("dw_openpose_detection_filter")),r=o.addNode({id:Te("dw_openpose_detection"),type:"dw_openpose_detection",image:{image_name:e},draw_body:t,draw_face:n,draw_hands:s});return{graph:o,outputNodeId:r.id}}},spandrel_filter:{type:"spandrel_filter",buildDefaults:()=>({type:"spandrel_filter",model:null,autoScale:!0,scale:1}),buildGraph:({image_name:e},{model:t,scale:n,autoScale:s})=>{ve(t!==null);const o=new ss(Te("spandrel_filter")),r=o.addNode(s?{id:Te("spandrel_image_to_image_autoscale"),type:"spandrel_image_to_image_autoscale",image_to_image_model:t,image:{image_name:e},scale:n}:{id:Te("spandrel_image_to_image"),type:"spandrel_image_to_image",image_to_image_model:t,image:{image_name:e}});return{graph:o,outputNodeId:r.id}},validateConfig:e=>!!e.model},img_blur:{type:"img_blur",buildDefaults:()=>({type:"img_blur",blur_type:"gaussian",radius:8}),buildGraph:({image_name:e},{blur_type:t,radius:n})=>{const s=new ss(Te("img_blur")),o=s.addNode({id:Te("img_blur"),type:"img_blur",image:{image_name:e},blur_type:t,radius:n});return{graph:s,outputNodeId:o.id}}},img_noise:{type:"img_noise",buildDefaults:()=>({type:"img_noise",noise_type:"gaussian",amount:.3,noise_color:!0,size:1}),buildGraph:({image_name:e},{noise_type:t,amount:n,noise_color:s,size:o})=>{const r=new ss(Te("img_noise")),a=r.addNode({id:Te("img_noise"),type:"img_noise",image:{image_name:e},noise_type:t,amount:n,noise_color:s,size:o}),l=r.addNode({id:Te("rand_int"),use_cache:!1,type:"rand_int",low:0,high:2147483647});return r.addEdge(l,"value",a,"seed"),{graph:r,outputNodeId:a.id}}}},Uwe={canny_image_processor:"canny_edge_detection",mlsd_image_processor:"mlsd_detection",depth_anything_image_processor:"depth_anything_depth_estimation",normalbae_image_processor:"normal_map",pidi_image_processor:"pidi_edge_detection",lineart_image_processor:"lineart_edge_detection",lineart_anime_image_processor:"lineart_anime_edge_detection",hed_image_processor:"hed_edge_detection",content_shuffle_image_processor:"content_shuffle",dw_openpose_image_processor:"dw_openpose_detection",mediapipe_face_processor:"mediapipe_face_detection",zoe_depth_image_processor:"depth_anything_depth_estimation",color_map_image_processor:"color_map"},h$=e=>{var s;if(!e)return null;const t=(s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor;if(!t)return null;if(u$(t))return Gn[t];const n=Uwe[t];return n?Gn[n]:null},Yv=Gn.adjust_image.buildDefaults(),p$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(d=>{jwe(d==null?void 0:d.value)&&e({...t,channel:d.value})},[t,e]),o=c.useCallback(d=>{e({...t,value:d})},[t,e]),r=c.useCallback(d=>{e({...t,scale_values:d.target.checked})},[t,e]),a=c.useMemo(()=>[{label:n("controlLayers.filter.adjust_image.red"),value:"Red (RGBA)"},{label:n("controlLayers.filter.adjust_image.green"),value:"Green (RGBA)"},{label:n("controlLayers.filter.adjust_image.blue"),value:"Blue (RGBA)"},{label:n("controlLayers.filter.adjust_image.alpha"),value:"Alpha (RGBA)"},{label:n("controlLayers.filter.adjust_image.cyan"),value:"Cyan (CMYK)"},{label:n("controlLayers.filter.adjust_image.magenta"),value:"Magenta (CMYK)"},{label:n("controlLayers.filter.adjust_image.yellow"),value:"Yellow (CMYK)"},{label:n("controlLayers.filter.adjust_image.black"),value:"Black (CMYK)"},{label:n("controlLayers.filter.adjust_image.hue"),value:"Hue (HSV)"},{label:n("controlLayers.filter.adjust_image.saturation"),value:"Saturation (HSV)"},{label:n("controlLayers.filter.adjust_image.value"),value:"Value (HSV)"},{label:n("controlLayers.filter.adjust_image.luminosity"),value:"Luminosity (LAB)"},{label:n("controlLayers.filter.adjust_image.a"),value:"A (LAB)"},{label:n("controlLayers.filter.adjust_image.b"),value:"B (LAB)"},{label:n("controlLayers.filter.adjust_image.y"),value:"Y (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cb"),value:"Cb (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cr"),value:"Cr (YCbCr)"}],[n]),l=c.useMemo(()=>a.filter(d=>d.value===t.channel)[0],[a,t.channel]);return i.jsxs(i.Fragment,{children:[i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.adjust_image.channel")}),i.jsx(Ke,{value:l,options:a,onChange:s,isSearchable:!1})]}),i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.adjust_image.value_setting")}),i.jsx(Ze,{value:t.value,defaultValue:Yv.value,onChange:o,min:0,max:2,step:.0025,marks:!0}),i.jsx(_e,{value:t.value,defaultValue:Yv.value,onChange:o,min:0,max:255,step:.0025})]}),i.jsxs(Q,{w:"max-content",children:[i.jsx(J,{m:0,children:n("controlLayers.filter.adjust_image.scale_values")}),i.jsx(et,{defaultChecked:Yv.scale_values,isChecked:t.scale_values,onChange:r})]})]})});p$.displayName="FilterAdjustImage";const IM=Gn.img_blur.buildDefaults(),f$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(l=>{Vwe(l==null?void 0:l.value)&&e({...t,blur_type:l.value})},[t,e]),o=c.useCallback(l=>{e({...t,radius:l})},[t,e]),r=c.useMemo(()=>[{label:n("controlLayers.filter.img_blur.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_blur.box_type"),value:"box"}],[n]),a=c.useMemo(()=>r.filter(l=>l.value===t.blur_type)[0],[r,t.blur_type]);return i.jsxs(i.Fragment,{children:[i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.img_blur.blur_type")}),i.jsx(Ke,{value:a,options:r,onChange:s,isSearchable:!1})]}),i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.img_blur.blur_radius")}),i.jsx(Ze,{value:t.radius,defaultValue:IM.radius,onChange:o,min:1,max:64,step:.1,marks:!0}),i.jsx(_e,{value:t.radius,defaultValue:IM.radius,onChange:o,min:1,max:4096,step:.1})]})]})});f$.displayName="FilterBlur";const Jg=Gn.canny_edge_detection.buildDefaults(),m$=({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(r=>{e({...t,low_threshold:r})},[e,t]),o=c.useCallback(r=>{e({...t,high_threshold:r})},[e,t]);return i.jsxs(i.Fragment,{children:[i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.canny_edge_detection.low_threshold")}),i.jsx(Ze,{value:t.low_threshold,onChange:s,defaultValue:Jg.low_threshold,min:0,max:255}),i.jsx(_e,{value:t.low_threshold,onChange:s,defaultValue:Jg.low_threshold,min:0,max:255})]}),i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.canny_edge_detection.high_threshold")}),i.jsx(Ze,{value:t.high_threshold,onChange:o,defaultValue:Jg.high_threshold,min:0,max:255}),i.jsx(_e,{value:t.high_threshold,onChange:o,defaultValue:Jg.high_threshold,min:0,max:255})]})]})};m$.displayName="FilterCannyEdgeDetection";const TM=Gn.color_map.buildDefaults(),g$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(o=>{e({...t,tile_size:o})},[t,e]);return i.jsx(i.Fragment,{children:i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.color_map.tile_size")}),i.jsx(Ze,{value:t.tile_size,defaultValue:TM.tile_size,onChange:s,min:1,max:256,step:1,marks:!0}),i.jsx(_e,{value:t.tile_size,defaultValue:TM.tile_size,onChange:s,min:1,max:4096,step:1})]})})});g$.displayName="FilterColorMap";const AM=Gn.content_shuffle.buildDefaults(),x$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(o=>{e({...t,scale_factor:o})},[t,e]);return i.jsx(i.Fragment,{children:i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.content_shuffle.scale_factor")}),i.jsx(Ze,{value:t.scale_factor,defaultValue:AM.scale_factor,onChange:s,min:0,max:4096,marks:!0}),i.jsx(_e,{value:t.scale_factor,defaultValue:AM.scale_factor,onChange:s,min:0,max:4096})]})})});x$.displayName="FilterContentShuffle";const y$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(a=>{Mwe(a==null?void 0:a.value)&&e({...t,model_size:a.value})},[t,e]),o=c.useMemo(()=>[{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small_v2"),value:"small_v2"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small"),value:"small"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_base"),value:"base"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_large"),value:"large"}],[n]),r=c.useMemo(()=>o.filter(a=>a.value===t.model_size)[0],[o,t.model_size]);return i.jsx(i.Fragment,{children:i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.depth_anything_depth_estimation.model_size")}),i.jsx(Ke,{value:r,options:o,onChange:s,isSearchable:!1})]})})});y$.displayName="FilterDepthAnythingDepthEstimation";const Xv=Gn.dw_openpose_detection.buildDefaults(),b$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(a=>{e({...t,draw_body:a.target.checked})},[t,e]),o=c.useCallback(a=>{e({...t,draw_face:a.target.checked})},[t,e]),r=c.useCallback(a=>{e({...t,draw_hands:a.target.checked})},[t,e]);return i.jsx(i.Fragment,{children:i.jsxs(T,{sx:{flexDir:"row",gap:6},children:[i.jsxs(Q,{w:"max-content",children:[i.jsx(J,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_body")}),i.jsx(et,{defaultChecked:Xv.draw_body,isChecked:t.draw_body,onChange:s})]}),i.jsxs(Q,{w:"max-content",children:[i.jsx(J,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_face")}),i.jsx(et,{defaultChecked:Xv.draw_face,isChecked:t.draw_face,onChange:o})]}),i.jsxs(Q,{w:"max-content",children:[i.jsx(J,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_hands")}),i.jsx(et,{defaultChecked:Xv.draw_hands,isChecked:t.draw_hands,onChange:r})]})]})})});b$.displayName="FilterDWOpenposeDetection";const v$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(o=>{e({...t,scribble:o.target.checked})},[t,e]);return i.jsx(i.Fragment,{children:i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.hed_edge_detection.scribble")}),i.jsx(et,{isChecked:t.scribble,onChange:s})]})})});v$.displayName="FilterHEDEdgeDetection";const C$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(o=>{e({...t,coarse:o.target.checked})},[t,e]);return i.jsx(i.Fragment,{children:i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.lineart_edge_detection.coarse")}),i.jsx(et,{isChecked:t.coarse,onChange:s})]})})});C$.displayName="FilterLineartEdgeDetection";const e0=Gn.mediapipe_face_detection.buildDefaults(),w$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(r=>{e({...t,max_faces:r})},[t,e]),o=c.useCallback(r=>{e({...t,min_confidence:r})},[t,e]);return i.jsxs(i.Fragment,{children:[i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.max_faces")}),i.jsx(Ze,{value:t.max_faces,onChange:s,defaultValue:e0.max_faces,min:1,max:20,marks:!0}),i.jsx(_e,{value:t.max_faces,onChange:s,defaultValue:e0.max_faces,min:1,max:20})]}),i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.min_confidence")}),i.jsx(Ze,{value:t.min_confidence,onChange:o,defaultValue:e0.min_confidence,min:0,max:1,step:.01,marks:!0}),i.jsx(_e,{value:t.min_confidence,onChange:o,defaultValue:e0.min_confidence,min:0,max:1,step:.01})]})]})});w$.displayName="FilterMediaPipeFaceDetection";const t0=Gn.mlsd_detection.buildDefaults(),S$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(r=>{e({...t,distance_threshold:r})},[t,e]),o=c.useCallback(r=>{e({...t,score_threshold:r})},[t,e]);return i.jsxs(i.Fragment,{children:[i.jsxs(Q,{children:[i.jsxs(J,{m:0,children:[n("controlLayers.filter.mlsd_detection.score_threshold")," "]}),i.jsx(Ze,{value:t.score_threshold,onChange:o,defaultValue:t0.score_threshold,min:0,max:1,step:.01,marks:!0}),i.jsx(_e,{value:t.score_threshold,onChange:o,defaultValue:t0.score_threshold,min:0,max:1,step:.01})]}),i.jsxs(Q,{children:[i.jsxs(J,{m:0,children:[n("controlLayers.filter.mlsd_detection.distance_threshold")," "]}),i.jsx(Ze,{value:t.distance_threshold,onChange:s,defaultValue:t0.distance_threshold,min:0,max:100,step:1,marks:!0}),i.jsx(_e,{value:t.distance_threshold,onChange:s,defaultValue:t0.distance_threshold,min:0,max:1e3,step:1})]})]})});S$.displayName="FilterMLSDDetection";const op=Gn.img_noise.buildDefaults(),k$=c.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(u=>{Gwe(u==null?void 0:u.value)&&e({...t,noise_type:u.value})},[t,e]),o=c.useCallback(u=>{e({...t,amount:u})},[t,e]),r=c.useCallback(u=>{e({...t,noise_color:u.target.checked})},[t,e]),a=c.useCallback(u=>{e({...t,size:u})},[t,e]),l=c.useMemo(()=>[{label:n("controlLayers.filter.img_noise.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_noise.salt_and_pepper_type"),value:"salt_and_pepper"}],[n]),d=c.useMemo(()=>l.filter(u=>u.value===t.noise_type)[0],[l,t.noise_type]);return i.jsxs(i.Fragment,{children:[i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.img_noise.noise_type")}),i.jsx(Ke,{value:d,options:l,onChange:s,isSearchable:!1})]}),i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.img_noise.noise_amount")}),i.jsx(Ze,{value:t.amount,defaultValue:op.amount,onChange:o,min:0,max:1,step:.01,marks:!0}),i.jsx(_e,{value:t.amount,defaultValue:op.amount,onChange:o,min:0,max:1,step:.01})]}),i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.img_noise.size")}),i.jsx(Ze,{value:t.size,defaultValue:op.size,onChange:a,min:1,max:16,step:1,marks:!0}),i.jsx(_e,{value:t.size,defaultValue:op.size,onChange:a,min:1,max:256,step:1})]}),i.jsxs(Q,{w:"max-content",children:[i.jsx(J,{m:0,children:n("controlLayers.filter.img_noise.noise_color")}),i.jsx(et,{defaultChecked:op.noise_color,isChecked:t.noise_color,onChange:r})]})]})});k$.displayName="Filternoise";const j$=({onChange:e,config:t})=>{const{t:n}=M(),s=c.useCallback(r=>{e({...t,scribble:r.target.checked})},[t,e]),o=c.useCallback(r=>{e({...t,quantize_edges:r.target.checked})},[t,e]);return i.jsxs(i.Fragment,{children:[i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.pidi_edge_detection.scribble")}),i.jsx(et,{isChecked:t.scribble,onChange:s})]}),i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.pidi_edge_detection.quantize_edges")}),i.jsx(et,{isChecked:t.quantize_edges,onChange:o})]})]})};j$.displayName="FilterPiDiNetEdgeDetection";const yl=e=>{const{t}=M(),{modelConfigs:n,selectedModel:s,getIsDisabled:o,onChange:r,isLoading:a,optionsFilter:l=()=>!0}=e,d=A(Ux),u=c.useMemo(()=>n.filter(l).map(g=>({label:g.name,value:g.key,description:d&&g.description||void 0,isDisabled:o?o(g):!1})),[l,o,n,d]),h=c.useMemo(()=>u.find(g=>s?g.value===s.key:!1)??null,[u,s]),p=c.useCallback(g=>{if(!g){r(null);return}const x=n.find(b=>b.key===g.value);if(!x){r(null);return}r(x)},[n,r]),f=c.useMemo(()=>a?t("common.loading"):u.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[a,u,t]),m=c.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:u,value:h,onChange:p,placeholder:f,noOptionsMessage:m}},MM=Gn.spandrel_filter.buildDefaults(),_$=({onChange:e,config:t})=>{const{t:n}=M(),[s,{isLoading:o}]=Mm(),r=c.useMemo(()=>{var g;if(!(!s.length||!t.model))return(g=s.find(x=>{var b;return x.key===((b=t.model)==null?void 0:b.key)}))==null?void 0:g.description},[s,t.model]),a=c.useCallback(g=>{e({...t,model:g})},[t,e]),{options:l,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=yl({modelConfigs:s,onChange:a,selectedModel:t.model,isLoading:o}),f=c.useCallback(g=>{e({...t,scale:g})},[e,t]),m=c.useCallback(g=>{e({...t,autoScale:g.target.checked})},[e,t]);return c.useEffect(()=>{const g=l[0];!t.model&&g&&u(g)},[t.model,u,l]),i.jsxs(i.Fragment,{children:[i.jsxs(Q,{w:"full",orientation:"vertical",children:[i.jsxs(T,{w:"full",alignItems:"center",children:[i.jsx(J,{m:0,flexGrow:1,children:n("controlLayers.filter.spandrel_filter.autoScale")}),i.jsx(et,{size:"sm",isChecked:t.autoScale,onChange:m})]}),i.jsx(Js,{children:n("controlLayers.filter.spandrel_filter.autoScaleDesc")})]}),i.jsxs(Q,{isDisabled:!t.autoScale,children:[i.jsx(J,{m:0,children:n("controlLayers.filter.spandrel_filter.scale")}),i.jsx(Ze,{value:t.scale,onChange:f,defaultValue:MM.scale,min:1,max:16}),i.jsx(_e,{value:t.scale,onChange:f,defaultValue:MM.scale,min:1,max:16})]}),i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.filter.spandrel_filter.model")}),i.jsx(Oe,{label:r,children:i.jsx(Ce,{w:"full",children:i.jsx(Ke,{value:d,placeholder:h,options:l,onChange:u,noOptionsMessage:p,isDisabled:l.length===0})})})]})]})};_$.displayName="FilterSpandrel";const I$=c.memo(({filterConfig:e,onChange:t})=>{const{t:n}=M();return e.type==="adjust_image"?i.jsx(p$,{config:e,onChange:t}):e.type==="canny_edge_detection"?i.jsx(m$,{config:e,onChange:t}):e.type==="color_map"?i.jsx(g$,{config:e,onChange:t}):e.type==="content_shuffle"?i.jsx(x$,{config:e,onChange:t}):e.type==="depth_anything_depth_estimation"?i.jsx(y$,{config:e,onChange:t}):e.type==="dw_openpose_detection"?i.jsx(b$,{config:e,onChange:t}):e.type==="hed_edge_detection"?i.jsx(v$,{config:e,onChange:t}):e.type==="lineart_edge_detection"?i.jsx(C$,{config:e,onChange:t}):e.type==="mediapipe_face_detection"?i.jsx(w$,{config:e,onChange:t}):e.type==="mlsd_detection"?i.jsx(S$,{config:e,onChange:t}):e.type==="pidi_edge_detection"?i.jsx(j$,{config:e,onChange:t}):e.type==="img_blur"?i.jsx(f$,{config:e,onChange:t}):e.type==="img_noise"?i.jsx(k$,{config:e,onChange:t}):e.type==="spandrel_filter"?i.jsx(_$,{config:e,onChange:t}):i.jsx(Ot,{py:4,label:`${n(`controlLayers.filter.${e.type}.label`)} has no settings`,icon:null})});I$.displayName="Filter";const qwe=he(Ri,e=>e.sd.disabledControlNetProcessors),T$=c.memo(({filterType:e,onChange:t})=>{const{t:n}=M(),s=A(qwe),o=c.useMemo(()=>mr(Gn,(l,d)=>({value:d,label:n(`controlLayers.filter.${d}.label`)})).filter(l=>!ide(s,l.value)),[s,n]),r=c.useCallback(l=>{l&&(ve(u$(l.value)),t(l.value))},[t]),a=c.useMemo(()=>o.find(l=>l.value===e)??null,[o,e]);return i.jsx(T,{gap:2,children:i.jsxs(Q,{children:[i.jsx($e,{feature:"controlNetProcessor",children:i.jsx(J,{m:0,children:n("controlLayers.filter.filterType")})}),i.jsx(Ke,{value:a,options:o,onChange:r,isSearchable:!1,isClearable:!1})]})})});T$.displayName="FilterTypeSelect";const A$=c.memo(({adapter:e})=>{const{t}=M(),n=re(e.filterer.$filterConfig),s=re(e.filterer.$isProcessing),o=re(e.filterer.$hasImageState),r=A(sm),a=c.useCallback(m=>{e.filterer.$filterConfig.set(m)},[e.filterer.$filterConfig]),l=c.useCallback(m=>{e.filterer.$filterConfig.set(Gn[m].buildDefaults())},[e.filterer.$filterConfig]),d=c.useMemo(()=>{var m,g;return((g=(m=Gn[n.type]).validateConfig)==null?void 0:g.call(m,n))??!0},[n]),u=c.useCallback(()=>{e.filterer.saveAs("inpaint_mask")},[e.filterer]),h=c.useCallback(()=>{e.filterer.saveAs("regional_guidance")},[e.filterer]),p=c.useCallback(()=>{e.filterer.saveAs("raster_layer")},[e.filterer]),f=c.useCallback(()=>{e.filterer.saveAs("control_layer")},[e.filterer]);return i.jsxs(i.Fragment,{children:[i.jsxs(T,{w:"full",gap:4,children:[i.jsx(zt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),i.jsx(Je,{}),i.jsx(D_,{}),i.jsx(Jy,{})]}),i.jsx(T$,{filterType:n.type,onChange:l}),i.jsx(I$,{filterConfig:n,onChange:a}),i.jsxs(Qn,{isAttached:!1,size:"sm",w:"full",children:[i.jsxs(de,{variant:"ghost",onClick:e.filterer.processImmediate,loadingText:t("controlLayers.filter.process"),isDisabled:s||!d||r&&o,children:[t("controlLayers.filter.process"),s&&i.jsx(ci,{ms:3,boxSize:5,color:"base.600"})]}),i.jsx(Je,{}),i.jsx(de,{onClick:e.filterer.reset,isDisabled:s,loadingText:t("controlLayers.filter.reset"),variant:"ghost",children:t("controlLayers.filter.reset")}),i.jsx(de,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!d||!o,children:t("controlLayers.filter.apply")}),i.jsxs(on,{children:[i.jsx(rn,{as:de,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:s||!d||!o,rightIcon:i.jsx(Bi,{}),children:t("controlLayers.selectObject.saveAs")}),i.jsxs(Et,{children:[i.jsx(fe,{isDisabled:s||!d||!o,onClick:u,children:t("controlLayers.newInpaintMask")}),i.jsx(fe,{isDisabled:s||!d||!o,onClick:h,children:t("controlLayers.newRegionalGuidance")}),i.jsx(fe,{isDisabled:s||!d||!o,onClick:f,children:t("controlLayers.newControlLayer")}),i.jsx(fe,{isDisabled:s||!d||!o,onClick:p,children:t("controlLayers.newRasterLayer")})]})]}),i.jsx(de,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});A$.displayName="FilterContentAdvanced";const M$=c.memo(({adapter:e})=>{const{t}=M(),n=re(e.filterer.$filterConfig),s=re(e.filterer.$isProcessing),o=re(e.filterer.$hasImageState),r=c.useMemo(()=>{var l,d;return((d=(l=Gn[n.type]).validateConfig)==null?void 0:d.call(l,n))??!0},[n]),a=c.useCallback(()=>{e.filterer.$simple.set(!1)},[e.filterer.$simple]);return i.jsxs(i.Fragment,{children:[i.jsxs(T,{w:"full",gap:4,children:[i.jsx(zt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),i.jsx(Je,{})]}),i.jsxs(T,{flexDir:"column",w:"full",gap:2,pb:2,children:[i.jsx(W,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.processingLayerWith",{type:t(`controlLayers.filter.${n.type}.label`)})}),i.jsx(W,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.forMoreControl")})]}),i.jsxs(Qn,{isAttached:!1,size:"sm",w:"full",children:[i.jsx(de,{variant:"ghost",onClick:a,children:t("controlLayers.filter.advanced")}),i.jsx(Je,{}),i.jsx(de,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!r||!o,children:t("controlLayers.filter.apply")}),i.jsx(de,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});M$.displayName="FilterContentSimple";const E$=()=>{const e=Lt(),t=re(e.stateApi.$filteringAdapter);return t?i.jsx(P$,{adapter:t}):null};E$.displayName="Filter";const P$=c.memo(({adapter:e})=>{const t=re(e.filterer.$simple),n=Os("canvas"),s=re(e.filterer.$isProcessing),o=c.useRef(null);return bm("canvas",o,{focusOnMount:!0}),De({id:"applyFilter",category:"canvas",callback:e.filterer.apply,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),De({id:"cancelFilter",category:"canvas",callback:e.filterer.cancel,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),i.jsxs(T,{ref:o,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,w:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[t&&i.jsx(M$,{adapter:e}),!t&&i.jsx(A$,{adapter:e})]})});P$.displayName="FilterContent";const R_=c.memo(({label:e,value:t,color:n})=>i.jsxs(i.Fragment,{children:[i.jsx(vt,{children:i.jsxs(W,{textAlign:"end",children:[e,": "]})}),i.jsx(vt,{fontWeight:"semibold",children:i.jsx(W,{textAlign:"end",color:n,children:t})})]}));R_.displayName="CanvasHUDItem";const Kwe=he(vd,e=>e.rect),L$=c.memo(()=>{const{t:e}=M(),t=A(Kwe);return i.jsx(R_,{label:e("controlLayers.HUD.bbox"),value:`${t.width}${t.height} px`})});L$.displayName="CanvasHUDItemBbox";const D$=c.memo(()=>{const{t:e}=M(),t=A(zP),n=A(Eee);return t==="none"?null:i.jsx(R_,{label:e("controlLayers.HUD.scaledBbox"),value:`${n.width}${n.height} px`})});D$.displayName="CanvasHUDItemScaledBbox";const R$=c.memo(()=>i.jsxs(Mi,{bg:"base.900",borderBottomEndRadius:"base",p:2,gap:1,borderRadius:"base",templateColumns:"1fr 1fr",opacity:.6,minW:64,children:[i.jsx(L$,{}),i.jsx(D$,{})]}));R$.displayName="CanvasHUD";class Mp extends Map{constructor(n){super(n);j(this,"subscriptions",new Set);j(this,"lastSnapshot",null);j(this,"set",(n,s)=>(super.set(n,s),this.notifySubscribers(),this));j(this,"delete",n=>{const s=super.delete(n);return this.notifySubscribers(),s});j(this,"clear",()=>{super.clear(),this.notifySubscribers()});j(this,"notifySubscribers",()=>{for(const n of this.subscriptions)n()});j(this,"subscribe",n=>(this.subscriptions.add(n),()=>{this.subscriptions.delete(n)}));j(this,"getSnapshot",()=>{const n=new Map(this);return(!this.lastSnapshot||!this.areSnapshotsEqual(this.lastSnapshot,n))&&(this.lastSnapshot=n),this.lastSnapshot});j(this,"areSnapshotsEqual",(n,s)=>{if(n.size!==s.size)return!1;for(const[o,r]of n)if(!Object.is(r,s.get(o)))return!1;return!0})}}const Yc=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,O$=new Set,_w=typeof process=="object"&&process?process:{},N$=(e,t,n,s)=>{typeof _w.emitWarning=="function"?_w.emitWarning(e,t,n,s):console.error(`[${n}] ${t}: ${e}`)};let D1=globalThis.AbortController,EM=globalThis.AbortSignal;var e8;if(typeof D1>"u"){EM=class{constructor(){j(this,"onabort");j(this,"_onabort",[]);j(this,"reason");j(this,"aborted",!1)}addEventListener(s,o){this._onabort.push(o)}},D1=class{constructor(){j(this,"signal",new EM);t()}abort(s){var o,r;if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const a of this.signal._onabort)a(s);(r=(o=this.signal).onabort)==null||r.call(o,s)}}};let e=((e8=_w.env)==null?void 0:e8.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const t=()=>{e&&(e=!1,N$("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const Zwe=e=>!O$.has(e),Ca=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),F$=e=>Ca(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?N0:null:null;class N0 extends Array{constructor(t){super(t),this.fill(0)}}var Ud;const Bl=class Bl{constructor(t,n){j(this,"heap");j(this,"length");if(!X(Bl,Ud))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(t),this.length=0}static create(t){const n=F$(t);if(!n)return[];Qe(Bl,Ud,!0);const s=new Bl(t,n);return Qe(Bl,Ud,!1),s}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};Ud=new WeakMap,At(Bl,Ud,!1);let Iw=Bl;var t8,n8,xo,pi,yo,Yl,bo,qd,Kd,qn,vo,Bn,un,ft,zs,fi,Is,os,Co,rs,wo,So,mi,ko,Da,Gs,Zd,Pe,Tw,Xl,Vr,Bf,gi,B$,Ql,Yd,$f,wa,Sa,Aw,F0,B0,dn,Mw,Ep,ka,Ew;const f4=class f4{constructor(t){At(this,Pe);At(this,xo);At(this,pi);At(this,yo);At(this,Yl);At(this,bo);At(this,qd);At(this,Kd);j(this,"ttl");j(this,"ttlResolution");j(this,"ttlAutopurge");j(this,"updateAgeOnGet");j(this,"updateAgeOnHas");j(this,"allowStale");j(this,"noDisposeOnSet");j(this,"noUpdateTTL");j(this,"maxEntrySize");j(this,"sizeCalculation");j(this,"noDeleteOnFetchRejection");j(this,"noDeleteOnStaleGet");j(this,"allowStaleOnFetchAbort");j(this,"allowStaleOnFetchRejection");j(this,"ignoreFetchAbort");At(this,qn);At(this,vo);At(this,Bn);At(this,un);At(this,ft);At(this,zs);At(this,fi);At(this,Is);At(this,os);At(this,Co);At(this,rs);At(this,wo);At(this,So);At(this,mi);At(this,ko);At(this,Da);At(this,Gs);At(this,Zd);At(this,Xl,()=>{});At(this,Vr,()=>{});At(this,Bf,()=>{});At(this,gi,()=>!1);At(this,Ql,t=>{});At(this,Yd,(t,n,s)=>{});At(this,$f,(t,n,s,o)=>{if(s||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});j(this,t8,"LRUCache");const{max:n=0,ttl:s,ttlResolution:o=1,ttlAutopurge:r,updateAgeOnGet:a,updateAgeOnHas:l,allowStale:d,dispose:u,onInsert:h,disposeAfter:p,noDisposeOnSet:f,noUpdateTTL:m,maxSize:g=0,maxEntrySize:x=0,sizeCalculation:b,fetchMethod:C,memoMethod:y,noDeleteOnFetchRejection:v,noDeleteOnStaleGet:w,allowStaleOnFetchRejection:k,allowStaleOnFetchAbort:S,ignoreFetchAbort:P}=t;if(n!==0&&!Ca(n))throw new TypeError("max option must be a nonnegative integer");const E=n?F$(n):Array;if(!E)throw new Error("invalid max value: "+n);if(Qe(this,xo,n),Qe(this,pi,g),this.maxEntrySize=x||X(this,pi),this.sizeCalculation=b,this.sizeCalculation){if(!X(this,pi)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(y!==void 0&&typeof y!="function")throw new TypeError("memoMethod must be a function if defined");if(Qe(this,Kd,y),C!==void 0&&typeof C!="function")throw new TypeError("fetchMethod must be a function if specified");if(Qe(this,qd,C),Qe(this,Da,!!C),Qe(this,Bn,new Map),Qe(this,un,new Array(n).fill(void 0)),Qe(this,ft,new Array(n).fill(void 0)),Qe(this,zs,new E(n)),Qe(this,fi,new E(n)),Qe(this,Is,0),Qe(this,os,0),Qe(this,Co,Iw.create(n)),Qe(this,qn,0),Qe(this,vo,0),typeof u=="function"&&Qe(this,yo,u),typeof h=="function"&&Qe(this,Yl,h),typeof p=="function"?(Qe(this,bo,p),Qe(this,rs,[])):(Qe(this,bo,void 0),Qe(this,rs,void 0)),Qe(this,ko,!!X(this,yo)),Qe(this,Zd,!!X(this,Yl)),Qe(this,Gs,!!X(this,bo)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!m,this.noDeleteOnFetchRejection=!!v,this.allowStaleOnFetchRejection=!!k,this.allowStaleOnFetchAbort=!!S,this.ignoreFetchAbort=!!P,this.maxEntrySize!==0){if(X(this,pi)!==0&&!Ca(X(this,pi)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ca(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");ze(this,Pe,B$).call(this)}if(this.allowStale=!!d,this.noDeleteOnStaleGet=!!w,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!l,this.ttlResolution=Ca(o)||o===0?o:1,this.ttlAutopurge=!!r,this.ttl=s||0,this.ttl){if(!Ca(this.ttl))throw new TypeError("ttl must be a positive integer if specified");ze(this,Pe,Tw).call(this)}if(X(this,xo)===0&&this.ttl===0&&X(this,pi)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!X(this,xo)&&!X(this,pi)){const L="LRU_CACHE_UNBOUNDED";Zwe(L)&&(O$.add(L),N$("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",L,f4))}}static unsafeExposeInternals(t){return{starts:X(t,So),ttls:X(t,mi),sizes:X(t,wo),keyMap:X(t,Bn),keyList:X(t,un),valList:X(t,ft),next:X(t,zs),prev:X(t,fi),get head(){return X(t,Is)},get tail(){return X(t,os)},free:X(t,Co),isBackgroundFetch:n=>{var s;return ze(s=t,Pe,dn).call(s,n)},backgroundFetch:(n,s,o,r)=>{var a;return ze(a=t,Pe,B0).call(a,n,s,o,r)},moveToTail:n=>{var s;return ze(s=t,Pe,Ep).call(s,n)},indexes:n=>{var s;return ze(s=t,Pe,wa).call(s,n)},rindexes:n=>{var s;return ze(s=t,Pe,Sa).call(s,n)},isStale:n=>{var s;return X(s=t,gi).call(s,n)}}}get max(){return X(this,xo)}get maxSize(){return X(this,pi)}get calculatedSize(){return X(this,vo)}get size(){return X(this,qn)}get fetchMethod(){return X(this,qd)}get memoMethod(){return X(this,Kd)}get dispose(){return X(this,yo)}get onInsert(){return X(this,Yl)}get disposeAfter(){return X(this,bo)}getRemainingTTL(t){return X(this,Bn).has(t)?1/0:0}*entries(){for(const t of ze(this,Pe,wa).call(this))X(this,ft)[t]!==void 0&&X(this,un)[t]!==void 0&&!ze(this,Pe,dn).call(this,X(this,ft)[t])&&(yield[X(this,un)[t],X(this,ft)[t]])}*rentries(){for(const t of ze(this,Pe,Sa).call(this))X(this,ft)[t]!==void 0&&X(this,un)[t]!==void 0&&!ze(this,Pe,dn).call(this,X(this,ft)[t])&&(yield[X(this,un)[t],X(this,ft)[t]])}*keys(){for(const t of ze(this,Pe,wa).call(this)){const n=X(this,un)[t];n!==void 0&&!ze(this,Pe,dn).call(this,X(this,ft)[t])&&(yield n)}}*rkeys(){for(const t of ze(this,Pe,Sa).call(this)){const n=X(this,un)[t];n!==void 0&&!ze(this,Pe,dn).call(this,X(this,ft)[t])&&(yield n)}}*values(){for(const t of ze(this,Pe,wa).call(this))X(this,ft)[t]!==void 0&&!ze(this,Pe,dn).call(this,X(this,ft)[t])&&(yield X(this,ft)[t])}*rvalues(){for(const t of ze(this,Pe,Sa).call(this))X(this,ft)[t]!==void 0&&!ze(this,Pe,dn).call(this,X(this,ft)[t])&&(yield X(this,ft)[t])}[(n8=Symbol.iterator,t8=Symbol.toStringTag,n8)](){return this.entries()}find(t,n={}){for(const s of ze(this,Pe,wa).call(this)){const o=X(this,ft)[s],r=ze(this,Pe,dn).call(this,o)?o.__staleWhileFetching:o;if(r!==void 0&&t(r,X(this,un)[s],this))return this.get(X(this,un)[s],n)}}forEach(t,n=this){for(const s of ze(this,Pe,wa).call(this)){const o=X(this,ft)[s],r=ze(this,Pe,dn).call(this,o)?o.__staleWhileFetching:o;r!==void 0&&t.call(n,r,X(this,un)[s],this)}}rforEach(t,n=this){for(const s of ze(this,Pe,Sa).call(this)){const o=X(this,ft)[s],r=ze(this,Pe,dn).call(this,o)?o.__staleWhileFetching:o;r!==void 0&&t.call(n,r,X(this,un)[s],this)}}purgeStale(){let t=!1;for(const n of ze(this,Pe,Sa).call(this,{allowStale:!0}))X(this,gi).call(this,n)&&(ze(this,Pe,ka).call(this,X(this,un)[n],"expire"),t=!0);return t}info(t){const n=X(this,Bn).get(t);if(n===void 0)return;const s=X(this,ft)[n],o=ze(this,Pe,dn).call(this,s)?s.__staleWhileFetching:s;if(o===void 0)return;const r={value:o};if(X(this,mi)&&X(this,So)){const a=X(this,mi)[n],l=X(this,So)[n];if(a&&l){const d=a-(Yc.now()-l);r.ttl=d,r.start=Date.now()}}return X(this,wo)&&(r.size=X(this,wo)[n]),r}dump(){const t=[];for(const n of ze(this,Pe,wa).call(this,{allowStale:!0})){const s=X(this,un)[n],o=X(this,ft)[n],r=ze(this,Pe,dn).call(this,o)?o.__staleWhileFetching:o;if(r===void 0||s===void 0)continue;const a={value:r};if(X(this,mi)&&X(this,So)){a.ttl=X(this,mi)[n];const l=Yc.now()-X(this,So)[n];a.start=Math.floor(Date.now()-l)}X(this,wo)&&(a.size=X(this,wo)[n]),t.unshift([s,a])}return t}load(t){this.clear();for(const[n,s]of t){if(s.start){const o=Date.now()-s.start;s.start=Yc.now()-o}this.set(n,s.value,s)}}set(t,n,s={}){var f,m,g,x,b,C,y;if(n===void 0)return this.delete(t),this;const{ttl:o=this.ttl,start:r,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:d}=s;let{noUpdateTTL:u=this.noUpdateTTL}=s;const h=X(this,$f).call(this,t,n,s.size||0,l);if(this.maxEntrySize&&h>this.maxEntrySize)return d&&(d.set="miss",d.maxEntrySizeExceeded=!0),ze(this,Pe,ka).call(this,t,"set"),this;let p=X(this,qn)===0?void 0:X(this,Bn).get(t);if(p===void 0)p=X(this,qn)===0?X(this,os):X(this,Co).length!==0?X(this,Co).pop():X(this,qn)===X(this,xo)?ze(this,Pe,F0).call(this,!1):X(this,qn),X(this,un)[p]=t,X(this,ft)[p]=n,X(this,Bn).set(t,p),X(this,zs)[X(this,os)]=p,X(this,fi)[p]=X(this,os),Qe(this,os,p),Cg(this,qn)._++,X(this,Yd).call(this,p,h,d),d&&(d.set="add"),u=!1,X(this,Zd)&&((f=X(this,Yl))==null||f.call(this,n,t,"add"));else{ze(this,Pe,Ep).call(this,p);const v=X(this,ft)[p];if(n!==v){if(X(this,Da)&&ze(this,Pe,dn).call(this,v)){v.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:w}=v;w!==void 0&&!a&&(X(this,ko)&&((m=X(this,yo))==null||m.call(this,w,t,"set")),X(this,Gs)&&((g=X(this,rs))==null||g.push([w,t,"set"])))}else a||(X(this,ko)&&((x=X(this,yo))==null||x.call(this,v,t,"set")),X(this,Gs)&&((b=X(this,rs))==null||b.push([v,t,"set"])));if(X(this,Ql).call(this,p),X(this,Yd).call(this,p,h,d),X(this,ft)[p]=n,d){d.set="replace";const w=v&&ze(this,Pe,dn).call(this,v)?v.__staleWhileFetching:v;w!==void 0&&(d.oldValue=w)}}else d&&(d.set="update");X(this,Zd)&&((C=this.onInsert)==null||C.call(this,n,t,n===v?"update":"replace"))}if(o!==0&&!X(this,mi)&&ze(this,Pe,Tw).call(this),X(this,mi)&&(u||X(this,Bf).call(this,p,o,r),d&&X(this,Vr).call(this,d,p)),!a&&X(this,Gs)&&X(this,rs)){const v=X(this,rs);let w;for(;w=v==null?void 0:v.shift();)(y=X(this,bo))==null||y.call(this,...w)}return this}pop(){var t;try{for(;X(this,qn);){const n=X(this,ft)[X(this,Is)];if(ze(this,Pe,F0).call(this,!0),ze(this,Pe,dn).call(this,n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(X(this,Gs)&&X(this,rs)){const n=X(this,rs);let s;for(;s=n==null?void 0:n.shift();)(t=X(this,bo))==null||t.call(this,...s)}}}has(t,n={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:o}=n,r=X(this,Bn).get(t);if(r!==void 0){const a=X(this,ft)[r];if(ze(this,Pe,dn).call(this,a)&&a.__staleWhileFetching===void 0)return!1;if(X(this,gi).call(this,r))o&&(o.has="stale",X(this,Vr).call(this,o,r));else return s&&X(this,Xl).call(this,r),o&&(o.has="hit",X(this,Vr).call(this,o,r)),!0}else o&&(o.has="miss");return!1}peek(t,n={}){const{allowStale:s=this.allowStale}=n,o=X(this,Bn).get(t);if(o===void 0||!s&&X(this,gi).call(this,o))return;const r=X(this,ft)[o];return ze(this,Pe,dn).call(this,r)?r.__staleWhileFetching:r}async fetch(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:d=0,sizeCalculation:u=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:p=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:f=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:g=this.allowStaleOnFetchAbort,context:x,forceRefresh:b=!1,status:C,signal:y}=n;if(!X(this,Da))return C&&(C.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:o,noDeleteOnStaleGet:r,status:C});const v={allowStale:s,updateAgeOnGet:o,noDeleteOnStaleGet:r,ttl:a,noDisposeOnSet:l,size:d,sizeCalculation:u,noUpdateTTL:h,noDeleteOnFetchRejection:p,allowStaleOnFetchRejection:f,allowStaleOnFetchAbort:g,ignoreFetchAbort:m,status:C,signal:y};let w=X(this,Bn).get(t);if(w===void 0){C&&(C.fetch="miss");const k=ze(this,Pe,B0).call(this,t,w,v,x);return k.__returned=k}else{const k=X(this,ft)[w];if(ze(this,Pe,dn).call(this,k)){const I=s&&k.__staleWhileFetching!==void 0;return C&&(C.fetch="inflight",I&&(C.returnedStale=!0)),I?k.__staleWhileFetching:k.__returned=k}const S=X(this,gi).call(this,w);if(!b&&!S)return C&&(C.fetch="hit"),ze(this,Pe,Ep).call(this,w),o&&X(this,Xl).call(this,w),C&&X(this,Vr).call(this,C,w),k;const P=ze(this,Pe,B0).call(this,t,w,v,x),L=P.__staleWhileFetching!==void 0&&s;return C&&(C.fetch=S?"stale":"refresh",L&&S&&(C.returnedStale=!0)),L?P.__staleWhileFetching:P.__returned=P}}async forceFetch(t,n={}){const s=await this.fetch(t,n);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(t,n={}){const s=X(this,Kd);if(!s)throw new Error("no memoMethod provided to constructor");const{context:o,forceRefresh:r,...a}=n,l=this.get(t,a);if(!r&&l!==void 0)return l;const d=s(t,l,{options:a,context:o});return this.set(t,d,a),d}get(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:a}=n,l=X(this,Bn).get(t);if(l!==void 0){const d=X(this,ft)[l],u=ze(this,Pe,dn).call(this,d);return a&&X(this,Vr).call(this,a,l),X(this,gi).call(this,l)?(a&&(a.get="stale"),u?(a&&s&&d.__staleWhileFetching!==void 0&&(a.returnedStale=!0),s?d.__staleWhileFetching:void 0):(r||ze(this,Pe,ka).call(this,t,"expire"),a&&s&&(a.returnedStale=!0),s?d:void 0)):(a&&(a.get="hit"),u?d.__staleWhileFetching:(ze(this,Pe,Ep).call(this,l),o&&X(this,Xl).call(this,l),d))}else a&&(a.get="miss")}delete(t){return ze(this,Pe,ka).call(this,t,"delete")}clear(){return ze(this,Pe,Ew).call(this,"delete")}};xo=new WeakMap,pi=new WeakMap,yo=new WeakMap,Yl=new WeakMap,bo=new WeakMap,qd=new WeakMap,Kd=new WeakMap,qn=new WeakMap,vo=new WeakMap,Bn=new WeakMap,un=new WeakMap,ft=new WeakMap,zs=new WeakMap,fi=new WeakMap,Is=new WeakMap,os=new WeakMap,Co=new WeakMap,rs=new WeakMap,wo=new WeakMap,So=new WeakMap,mi=new WeakMap,ko=new WeakMap,Da=new WeakMap,Gs=new WeakMap,Zd=new WeakMap,Pe=new WeakSet,Tw=function(){const t=new N0(X(this,xo)),n=new N0(X(this,xo));Qe(this,mi,t),Qe(this,So,n),Qe(this,Bf,(r,a,l=Yc.now())=>{if(n[r]=a!==0?l:0,t[r]=a,a!==0&&this.ttlAutopurge){const d=setTimeout(()=>{X(this,gi).call(this,r)&&ze(this,Pe,ka).call(this,X(this,un)[r],"expire")},a+1);d.unref&&d.unref()}}),Qe(this,Xl,r=>{n[r]=t[r]!==0?Yc.now():0}),Qe(this,Vr,(r,a)=>{if(t[a]){const l=t[a],d=n[a];if(!l||!d)return;r.ttl=l,r.start=d,r.now=s||o();const u=r.now-d;r.remainingTTL=l-u}});let s=0;const o=()=>{const r=Yc.now();if(this.ttlResolution>0){s=r;const a=setTimeout(()=>s=0,this.ttlResolution);a.unref&&a.unref()}return r};this.getRemainingTTL=r=>{const a=X(this,Bn).get(r);if(a===void 0)return 0;const l=t[a],d=n[a];if(!l||!d)return 1/0;const u=(s||o())-d;return l-u},Qe(this,gi,r=>{const a=n[r],l=t[r];return!!l&&!!a&&(s||o())-a>l})},Xl=new WeakMap,Vr=new WeakMap,Bf=new WeakMap,gi=new WeakMap,B$=function(){const t=new N0(X(this,xo));Qe(this,vo,0),Qe(this,wo,t),Qe(this,Ql,n=>{Qe(this,vo,X(this,vo)-t[n]),t[n]=0}),Qe(this,$f,(n,s,o,r)=>{if(ze(this,Pe,dn).call(this,s))return 0;if(!Ca(o))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(o=r(s,n),!Ca(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o}),Qe(this,Yd,(n,s,o)=>{if(t[n]=s,X(this,pi)){const r=X(this,pi)-t[n];for(;X(this,vo)>r;)ze(this,Pe,F0).call(this,!0)}Qe(this,vo,X(this,vo)+t[n]),o&&(o.entrySize=s,o.totalCalculatedSize=X(this,vo))})},Ql=new WeakMap,Yd=new WeakMap,$f=new WeakMap,wa=function*({allowStale:t=this.allowStale}={}){if(X(this,qn))for(let n=X(this,os);!(!ze(this,Pe,Aw).call(this,n)||((t||!X(this,gi).call(this,n))&&(yield n),n===X(this,Is)));)n=X(this,fi)[n]},Sa=function*({allowStale:t=this.allowStale}={}){if(X(this,qn))for(let n=X(this,Is);!(!ze(this,Pe,Aw).call(this,n)||((t||!X(this,gi).call(this,n))&&(yield n),n===X(this,os)));)n=X(this,zs)[n]},Aw=function(t){return t!==void 0&&X(this,Bn).get(X(this,un)[t])===t},F0=function(t){var r,a;const n=X(this,Is),s=X(this,un)[n],o=X(this,ft)[n];return X(this,Da)&&ze(this,Pe,dn).call(this,o)?o.__abortController.abort(new Error("evicted")):(X(this,ko)||X(this,Gs))&&(X(this,ko)&&((r=X(this,yo))==null||r.call(this,o,s,"evict")),X(this,Gs)&&((a=X(this,rs))==null||a.push([o,s,"evict"]))),X(this,Ql).call(this,n),t&&(X(this,un)[n]=void 0,X(this,ft)[n]=void 0,X(this,Co).push(n)),X(this,qn)===1?(Qe(this,Is,Qe(this,os,0)),X(this,Co).length=0):Qe(this,Is,X(this,zs)[n]),X(this,Bn).delete(s),Cg(this,qn)._--,n},B0=function(t,n,s,o){const r=n===void 0?void 0:X(this,ft)[n];if(ze(this,Pe,dn).call(this,r))return r;const a=new D1,{signal:l}=s;l==null||l.addEventListener("abort",()=>a.abort(l.reason),{signal:a.signal});const d={signal:a.signal,options:s,context:o},u=(x,b=!1)=>{const{aborted:C}=a.signal,y=s.ignoreFetchAbort&&x!==void 0;if(s.status&&(C&&!b?(s.status.fetchAborted=!0,s.status.fetchError=a.signal.reason,y&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),C&&!y&&!b)return p(a.signal.reason);const v=m;return X(this,ft)[n]===m&&(x===void 0?v.__staleWhileFetching?X(this,ft)[n]=v.__staleWhileFetching:ze(this,Pe,ka).call(this,t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,x,d.options))),x},h=x=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=x),p(x)),p=x=>{const{aborted:b}=a.signal,C=b&&s.allowStaleOnFetchAbort,y=C||s.allowStaleOnFetchRejection,v=y||s.noDeleteOnFetchRejection,w=m;if(X(this,ft)[n]===m&&(!v||w.__staleWhileFetching===void 0?ze(this,Pe,ka).call(this,t,"fetch"):C||(X(this,ft)[n]=w.__staleWhileFetching)),y)return s.status&&w.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),w.__staleWhileFetching;if(w.__returned===w)throw x},f=(x,b)=>{var y;const C=(y=X(this,qd))==null?void 0:y.call(this,t,r,d);C&&C instanceof Promise&&C.then(v=>x(v===void 0?void 0:v),b),a.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(x(void 0),s.allowStaleOnFetchAbort&&(x=v=>u(v,!0)))})};s.status&&(s.status.fetchDispatched=!0);const m=new Promise(f).then(u,h),g=Object.assign(m,{__abortController:a,__staleWhileFetching:r,__returned:void 0});return n===void 0?(this.set(t,g,{...d.options,status:void 0}),n=X(this,Bn).get(t)):X(this,ft)[n]=g,g},dn=function(t){if(!X(this,Da))return!1;const n=t;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof D1},Mw=function(t,n){X(this,fi)[n]=t,X(this,zs)[t]=n},Ep=function(t){t!==X(this,os)&&(t===X(this,Is)?Qe(this,Is,X(this,zs)[t]):ze(this,Pe,Mw).call(this,X(this,fi)[t],X(this,zs)[t]),ze(this,Pe,Mw).call(this,X(this,os),t),Qe(this,os,t))},ka=function(t,n){var o,r,a,l;let s=!1;if(X(this,qn)!==0){const d=X(this,Bn).get(t);if(d!==void 0)if(s=!0,X(this,qn)===1)ze(this,Pe,Ew).call(this,n);else{X(this,Ql).call(this,d);const u=X(this,ft)[d];if(ze(this,Pe,dn).call(this,u)?u.__abortController.abort(new Error("deleted")):(X(this,ko)||X(this,Gs))&&(X(this,ko)&&((o=X(this,yo))==null||o.call(this,u,t,n)),X(this,Gs)&&((r=X(this,rs))==null||r.push([u,t,n]))),X(this,Bn).delete(t),X(this,un)[d]=void 0,X(this,ft)[d]=void 0,d===X(this,os))Qe(this,os,X(this,fi)[d]);else if(d===X(this,Is))Qe(this,Is,X(this,zs)[d]);else{const h=X(this,fi)[d];X(this,zs)[h]=X(this,zs)[d];const p=X(this,zs)[d];X(this,fi)[p]=X(this,fi)[d]}Cg(this,qn)._--,X(this,Co).push(d)}}if(X(this,Gs)&&((a=X(this,rs))!=null&&a.length)){const d=X(this,rs);let u;for(;u=d==null?void 0:d.shift();)(l=X(this,bo))==null||l.call(this,...u)}return s},Ew=function(t){var n,s,o;for(const r of ze(this,Pe,Sa).call(this,{allowStale:!0})){const a=X(this,ft)[r];if(ze(this,Pe,dn).call(this,a))a.__abortController.abort(new Error("deleted"));else{const l=X(this,un)[r];X(this,ko)&&((n=X(this,yo))==null||n.call(this,a,l,t)),X(this,Gs)&&((s=X(this,rs))==null||s.push([a,l,t]))}}if(X(this,Bn).clear(),X(this,ft).fill(void 0),X(this,un).fill(void 0),X(this,mi)&&X(this,So)&&(X(this,mi).fill(0),X(this,So).fill(0)),X(this,wo)&&X(this,wo).fill(0),Qe(this,Is,0),Qe(this,os,0),X(this,Co).length=0,Qe(this,vo,0),Qe(this,qn,0),X(this,Gs)&&X(this,rs)){const r=X(this,rs);let a;for(;a=r==null?void 0:r.shift();)(o=X(this,bo))==null||o.call(this,...a)}};let Nl=f4;const Ywe={imageNameCacheSize:1e3,imageDataCacheSize:32,transparencyCalculationCacheSize:1e3,canvasElementCacheSize:32,generationModeCacheSize:100};class R1 extends Ut{constructor(n){super();j(this,"type","cache");j(this,"id");j(this,"path");j(this,"log");j(this,"parent");j(this,"manager");j(this,"config",Ywe);j(this,"imageNameCache",new Nl({max:this.config.imageNameCacheSize}));j(this,"canvasElementCache",new Nl({max:this.config.canvasElementCacheSize}));j(this,"imageDataCache",new Nl({max:this.config.imageDataCacheSize}));j(this,"transparencyCalculationCache",new Nl({max:this.config.imageDataCacheSize}));j(this,"generationModeCache",new Nl({max:this.config.generationModeCacheSize}));j(this,"clearAll",()=>{this.canvasElementCache.clear(),this.imageNameCache.clear(),this.generationModeCache.clear()});j(this,"destroy",()=>{this.log.debug("Destroying cache module"),this.clearAll()});this.id=Te("cache"),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating cache module")}}j(R1,"getWithFallback",async({cache:n,getValue:s,key:o,onHit:r,onMiss:a})=>{let l=n.get(o);return l===void 0?(a==null||a(),l=await s(),n.set(o,l)):r==null||r(l),l});class Xwe extends Ut{constructor(n){super();j(this,"type","compositor");j(this,"id");j(this,"path");j(this,"log");j(this,"parent");j(this,"manager");j(this,"$isCompositing",Le(!1));j(this,"$isProcessing",Le(!1));j(this,"$isUploading",Le(!1));j(this,"$isBusy",jn([this.$isCompositing,this.$isProcessing,this.$isUploading],(n,s,o)=>n||s||o));j(this,"getVisibleRectOfType",n=>{const s=[];for(const o of this.manager.getAllAdapters())o.state.isEnabled&&(n&&o.state.type!==n||o.renderer.hasObjects()&&s.push(o.transformer.getRelativeRect()));return J2(...s)});j(this,"getRectOfAdapters",n=>{const s=[];for(const o of n)o.renderer.hasObjects()&&s.push(o.transformer.getRelativeRect());return J2(...s)});j(this,"getVisibleAdaptersOfType",n=>{let s;switch(n){case"raster_layer":s=this.manager.stateApi.getRasterLayersState().entities;break;case"inpaint_mask":s=this.manager.stateApi.getInpaintMasksState().entities;break;case"control_layer":s=this.manager.stateApi.getControlLayersState().entities;break;case"regional_guidance":s=this.manager.stateApi.getRegionsState().entities;break;default:ve(!1,`Unhandled entity type: ${n}`)}return s.map(r=>ni(r)).map(this.manager.getAdapter).filter(r=>!!r).filter(r=>!r.$isDisabled.get()&&r.renderer.hasObjects())});j(this,"getCompositeHash",(n,s)=>{const o=[];for(const a of n)o.push(a.getHashableState());return lf({extra:s,adapterHashes:o})});j(this,"getCompositeCanvas",(n,s,o)=>{const r=n.map(h=>h.entityIdentifier),a=this.getCompositeHash(n,{rect:s}),l=this.manager.cache.canvasElementCache.get(a);if(l)return this.log.debug({entityIdentifiers:r,rect:s},"Using cached composite canvas"),l;this.log.debug({entityIdentifiers:r,rect:s},"Building composite canvas"),this.$isCompositing.set(!0);const d=document.createElement("canvas");d.width=s.width,d.height=s.height;const u=d.getContext("2d");ve(u!==null,"Canvas 2D context is null"),u.imageSmoothingEnabled=!1,o!=null&&o.globalCompositeOperation&&(u.globalCompositeOperation=o.globalCompositeOperation);for(const h of n){this.log.debug({entityIdentifier:h.entityIdentifier},"Drawing entity to composite canvas");const p=h.getCanvas(s);u.drawImage(p,0,0)}return this.manager.cache.canvasElementCache.set(a,d),this.$isCompositing.set(!1),d});j(this,"getCompositeImageDTO",async(n,s,o,r,a)=>{ve(s.width>0&&s.height>0,"Unable to rasterize empty rect");const l=this.getCompositeHash(n,{rect:s}),d=a?void 0:this.manager.cache.imageNameCache.get(l);let u=null;if(d){if(u=await Xd(d),u)return this.log.debug({rect:s,imageName:d,imageDTO:u},"Using cached composite image"),u;this.log.warn({rect:s,imageName:d},"Cached image name not found, recompositing")}const h=AS(()=>this.getCompositeCanvas(n,s,r));if(h.isErr())throw this.log.error({error:$n(h.error)},"Failed to get composite canvas"),h.error;this.$isProcessing.set(!0);const p=await Zn(()=>af(h.value));if(this.$isProcessing.set(!1),p.isErr())throw this.log.error({error:$n(p.error)},"Failed to convert composite canvas to blob"),p.error;const f=p.value;this.manager._isDebugging&&eC(f,"Composite"),this.$isUploading.set(!0);const m=await Zn(()=>er({file:new File([f],"canvas-composite.png",{type:"image/png"}),image_category:"general",...o}));if(this.$isUploading.set(!1),m.isErr())throw m.error;return u=m.value,this.manager.cache.imageNameCache.set(l,u.image_name),u});j(this,"mergeByEntityIdentifiers",async(n,s)=>{var h;if(ge({id:"MERGE_LAYERS_TOAST",title:Me("controlLayers.mergingLayers"),withCount:!1}),n.length<=1)return this.log.warn({entityIdentifiers:n},"Cannot merge less than 2 entities"),null;const o=(h=n[0])==null?void 0:h.type;ve(o,"Cannot merge entities with no type (this should never happen)");const r=this.manager.getAdapters(n);ve(r.length===n.length,"Failed to get all adapters for entity identifiers");const a=this.getRectOfAdapters(r),l={globalCompositeOperation:o==="control_layer"?"lighter":void 0},d=await Zn(()=>this.getCompositeImageDTO(r,a,{is_intermediate:!0},l));if(d.isErr())return this.log.error({error:$n(d.error)},"Failed to merge selected entities"),ge({id:"MERGE_LAYERS_TOAST",title:Me("controlLayers.mergeVisibleError"),status:"error",withCount:!1}),null;const u={isSelected:!0,overrides:{objects:[ao(d.value)],position:{x:Math.floor(a.x),y:Math.floor(a.y)}},mergedEntitiesToDelete:s?n.map(Pee):[]};switch(o){case"raster_layer":this.manager.stateApi.addRasterLayer(u);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(u);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(u);break;case"control_layer":this.manager.stateApi.addControlLayer(u);break;default:ve(!1,"Unsupported type for merge")}return ge({id:"MERGE_LAYERS_TOAST",title:Me("controlLayers.mergeVisibleOk"),status:"success",withCount:!1}),d.value});j(this,"mergeVisibleOfType",n=>{let s;switch(n){case"raster_layer":s=this.manager.stateApi.runSelector(US);break;case"inpaint_mask":s=this.manager.stateApi.runSelector(WP);break;case"regional_guidance":s=this.manager.stateApi.runSelector(HP);break;case"control_layer":s=this.manager.stateApi.runSelector(GP);break;default:ve(!1,"Unsupported type for merge")}const o=s.map(ni);return this.mergeByEntityIdentifiers(o,!1)});j(this,"getGrayscaleMaskCompositeImageDTO",async(n,s,o="noiseLevel",r=!1,a={is_intermediate:!0},l)=>{ve(s.width>0&&s.height>0,"Unable to rasterize empty rect");const d=this.getCompositeHash(n,{rect:s,attribute:o,invertMask:r,grayscale:!0}),u=l?void 0:this.manager.cache.imageNameCache.get(d);let h=null;if(u){if(h=await Xd(u),h)return this.log.debug({rect:s,imageName:u,imageDTO:h},"Using cached grayscale composite image"),h;this.log.warn({rect:s,imageName:u},"Cached grayscale image name not found, recompositing")}const p=document.createElement("canvas");p.width=s.width,p.height=s.height;const f=p.getContext("2d");ve(f!==null,"Canvas 2D context is null"),f.fillStyle="white",f.fillRect(0,0,s.width,s.height),f.globalCompositeOperation="darken";for(const b of n){this.log.debug({entityIdentifier:b.entityIdentifier},"Drawing entity to grayscale composite canvas");const C=b.getCanvas(s),y=document.createElement("canvas");y.width=C.width,y.height=C.height;const v=y.getContext("2d");ve(v!==null,"Temp canvas 2D context is null"),v.drawImage(C,0,0);const w=v.getImageData(0,0,y.width,y.height),k=w.data,S=typeof b.state[o]=="number"?b.state[o]:1;for(let P=0;P<k.length;P+=4)if(P+3<k.length){let E=255;(r?(k[P+3]??0)<128:(k[P+3]??0)>127)&&(E=Math.max(0,Math.min(255,255-Math.round(255*S)))),k[P]=E,k[P+1]=E,k[P+2]=E,k[P+3]=255}w.data.set(k),v.putImageData(w,0,0),f.drawImage(y,0,0)}this.$isProcessing.set(!0);const m=await Zn(()=>af(p));if(this.$isProcessing.set(!1),m.isErr())throw this.log.error({error:$n(m.error)},"Failed to convert grayscale composite canvas to blob"),m.error;const g=m.value;this.manager._isDebugging&&eC(g,"Grayscale Composite"),this.$isUploading.set(!0);const x=await Zn(()=>er({file:new File([g],"canvas-grayscale-composite.png",{type:"image/png"}),image_category:"general",...a}));if(this.$isUploading.set(!1),x.isErr())throw x.error;return h=x.value,this.manager.cache.imageNameCache.set(d,h.image_name),h});j(this,"getTransparency",(n,s,o)=>{const a={entityIdentifiers:n.map(l=>l.entityIdentifier),rect:s};return R1.getWithFallback({cache:this.manager.cache.transparencyCalculationCache,key:o,getValue:async()=>{const l=this.getCompositeCanvas(n,s),d=await R1.getWithFallback({cache:this.manager.cache.imageDataCache,key:o,getValue:()=>Promise.resolve(nP(l)),onHit:()=>this.log.trace(a,"Using cached image data"),onMiss:()=>this.log.trace(a,"Calculating image data")});return Lee(d)},onHit:()=>this.log.trace(a,"Using cached transparency"),onMiss:()=>this.log.trace(a,"Calculating transparency")})});j(this,"getGenerationMode",async()=>{const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.compositor.getVisibleAdaptersOfType("raster_layer"),o=this.getCompositeHash(s,{rect:n}),r=this.manager.compositor.getVisibleAdaptersOfType("inpaint_mask"),a=this.getCompositeHash(r,{rect:n}),l=lf({rect:n,compositeInpaintMaskHash:a,compositeRasterLayerHash:o}),d=this.manager.cache.generationModeCache.get(l);if(d)return this.log.debug({rect:n,cachedGenerationMode:d},"Using cached generation mode"),d;this.log.debug({rect:n},"Calculating generation mode"),this.$isProcessing.set(!0);const u=await Zn(async()=>{const h=await this.getTransparency(s,n,o),p=await this.getTransparency(r,n,a);let f;return h==="FULLY_TRANSPARENT"?f="txt2img":h==="PARTIALLY_TRANSPARENT"?f="outpaint":p==="FULLY_TRANSPARENT"?f="img2img":f="inpaint",this.manager.cache.generationModeCache.set(l,f),f});if(this.$isProcessing.set(!1),u.isErr())throw this.log.error({error:$n(u.error)},"Failed to calculate generation mode"),u.error;return u.value});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isCompositing:this.$isCompositing.get(),$isProcessing:this.$isProcessing.get(),$isUploading:this.$isUploading.get(),$isBusy:this.$isBusy.get()}));this.id=Te("canvas_compositor"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating compositor module")}}var Qv,PM;function Qwe(){if(PM)return Qv;PM=1;var e=function(n){var s=null,o,r=function(d){return function(){s=null,n.apply(d,o)}},a=function(){for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];o=u,s===null&&(s=requestAnimationFrame(r(this)))};return a.cancel=function(){cancelAnimationFrame(s),s=null},a};return Qv=e,Qv}var Jwe=Qwe();const $$=hu(Jwe),Br=class Br extends Ut{constructor(n,s,o){super();j(this,"type");j(this,"id");j(this,"path");j(this,"manager");j(this,"parent");j(this,"log");j(this,"entityIdentifier");j(this,"selectIsTypeHidden");j(this,"selectIsSelected");j(this,"konva");j(this,"state");j(this,"subscriptions",new Set);j(this,"$isLocked",Le(!1));j(this,"$isDisabled",Le(!1));j(this,"$isEntityTypeHidden",Le(!1));j(this,"$isEmpty",Le(!0));j(this,"$canvasCache",Le(null));j(this,"$isOnScreen",Le(!0));j(this,"$intersectsBbox",Le(!1));j(this,"selectState",he(Ye,n=>rl(n,this.entityIdentifier)));j(this,"selectPosition",he(this.selectState,n=>n==null?void 0:n.position));j(this,"syncIsOnscreen",()=>{const n=this.manager.stage.getScaledStageRect(),s=this.checkIntersection(n),o=this.$isOnScreen.get();this.$isOnScreen.set(s),o!==s&&this.log.trace(`Moved ${s?"on-screen":"off-screen"}`),this.syncVisibility()});j(this,"syncIntersectsBbox",()=>{const n=this.manager.stateApi.getBbox().rect,s=this.checkIntersection(n),o=this.$intersectsBbox.get();this.$intersectsBbox.set(s),o!==s&&this.log.trace(`Moved ${s?"into bbox":"out of bbox"}`)});j(this,"checkIntersection",n=>{const s=this.transformer.$pixelRect.get(),o=this.manager.stateApi.runSelector(this.selectPosition);if(!o)return!1;const r={x:s.x+o.x,y:s.y+o.y,width:s.width,height:s.height},a=Oee(n,r);return a.width>0&&a.height>0});j(this,"initialize",async()=>{this.log.debug("Initializing module"),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIsOnscreen)),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIntersectsBbox)),await this.sync(this.manager.stateApi.runSelector(this.selectState),void 0),this.transformer.initialize(),await this.renderer.initialize(),this.syncZIndices(),this.syncVisibility(),Br.runInitCallbacks(this)});j(this,"syncZIndices",()=>{this.log.trace("Updating z-indices");let n=0;this.renderer.konva.objectGroup.zIndex(n++),this.bufferRenderer.konva.group.zIndex(n++),this.renderer.konva.compositing&&this.renderer.konva.compositing.group.zIndex(n++),this.transformer.konva.outlineRect.zIndex(n++),this.transformer.konva.proxyRect.zIndex(n++),this.transformer.konva.transformer.zIndex(n++)});j(this,"syncIsEnabled",()=>{this.log.trace("Updating visibility"),this.$isDisabled.set(!this.state.isEnabled),this.syncVisibility(),this.transformer.syncInteractionState()});j(this,"syncObjects",async()=>{this.$isEmpty.set(this.state.objects.length===0),await this.renderer.render()&&(this.transformer.requestRectCalculation(),this.transformer.syncInteractionState())});j(this,"syncPosition",()=>{this.transformer.updatePosition()});j(this,"syncOpacity",()=>{this.renderer.updateOpacity()});j(this,"syncVisibility",$$(()=>{if(this.manager.stateApi.runSelector(this.selectIsTypeHidden)){this.setVisibility(!1);return}if(this.manager.stateApi.runSelector(tC)){const n=this.manager.stateApi.runSelector(li),s=UP(this.entityIdentifier);if(n&&!s){this.setVisibility(!1);return}}if(this.manager.stateApi.runSelector(Q0)){const n=this.manager.stateApi.$filteringAdapter.get();if(n&&n!==this){this.setVisibility(!1);return}const s=this.manager.stateApi.$transformingAdapter.get();if(s&&s!==this&&!s.transformer.$silentTransform.get()){this.setVisibility(!1);return}const o=this.manager.stateApi.$segmentingAdapter.get();if(o&&o!==this){this.setVisibility(!1);return}}if(this.$isDisabled.get()){this.setVisibility(!1);return}if(!this.$isOnScreen.get()&&!this.manager.stateApi.getIsSelected(this.entityIdentifier.id)){this.setVisibility(!1);return}this.setVisibility(!0)}));j(this,"setVisibility",n=>{this.konva.layer.visible()!==n&&(this.log.trace(n?"Showing":"Hiding"),this.konva.layer.visible(n),n&&(this.renderer.updateCompositingRectSize(),this.renderer.updateCompositingRectPosition(),this.renderer.updateCompositingRectFill()),this.renderer.syncKonvaCache())});j(this,"syncIsLocked",()=>{this.$isLocked.set(this.state.isLocked),this.transformer.syncInteractionState()});j(this,"hash",n=>{const s={state:this.getHashableState(),extra:n};return lf(s)});j(this,"cropToBbox",async()=>{const{rect:n}=this.manager.stateApi.getBbox(),s=await Zn(()=>this.renderer.rasterize({rect:n,replaceObjects:!0,attrs:{opacity:1,filters:[]}}));if(s.isErr())throw ge({status:"error",title:"Failed to crop to bbox"}),s.error;return s.value});j(this,"destroy",()=>{var n;this.log.debug("Destroying module"),this.subscriptions.forEach(s=>s()),this.subscriptions.clear(),this.renderer.destroy(),this.transformer.$isTransforming.get()&&this.transformer.stopTransform(),this.transformer.destroy(),this.filterer&&(this.filterer.$isFiltering.get()&&this.filterer.cancel(),(n=this.filterer)==null||n.destroy()),this.segmentAnything&&(this.segmentAnything.$isSegmenting.get()&&this.segmentAnything.cancel(),this.segmentAnything.destroy()),this.konva.layer.destroy(),this.manager.deleteAdapter(this.entityIdentifier)});j(this,"repr",()=>{var n,s;return{id:this.id,type:this.type,path:this.path,entityIdentifier:this.entityIdentifier,state:gt(this.state),transformer:this.transformer.repr(),renderer:this.renderer.repr(),bufferRenderer:this.bufferRenderer.repr(),segmentAnything:((n=this.segmentAnything)==null?void 0:n.repr())??null,filterer:((s=this.filterer)==null?void 0:s.repr())??null,hasCache:this.$canvasCache.get()!==null,isLocked:this.$isLocked.get(),isDisabled:this.$isDisabled.get(),isEntityTypeHidden:this.$isEntityTypeHidden.get(),isEmpty:this.$isEmpty.get(),isOnScreen:this.$isOnScreen.get(),intersectsBbox:this.$intersectsBbox.get(),konva:xs(this.konva.layer)}});this.type=o,this.id=n.id,this.entityIdentifier=n,this.manager=s,this.parent=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Re.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1})},this.manager.stage.addLayer(this.konva.layer);const r=this.manager.stateApi.runSelector(this.selectState);ve(r!==void 0,"Missing entity state on creation"),this.state=r,this.selectIsTypeHidden=Dee(this.entityIdentifier.type),this.selectIsSelected=Ree(this.entityIdentifier),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsTypeHidden,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Q0,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(tC,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(li,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$filteringAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$transformingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$segmentingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsSelected,this.syncVisibility)),this.subscriptions.add(this.$isDisabled.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isLocked.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isEntityTypeHidden.subscribe(this.manager.tool.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Fx,this.syncIntersectsBbox)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIntersectsBbox))}};j(Br,"initCallbacks",new Set),j(Br,"registerInitCallback",n=>{const s=async o=>{const r=await n(o);return r&&Br.initCallbacks.delete(s),r};Br.initCallbacks.add(s)}),j(Br,"runInitCallbacks",n=>{for(const s of Br.initCallbacks)s(n)});let lu=Br;function eSe(e,t=!1){const n=(16777216+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1),s=Math.round(e.a*255).toString(16).padStart(2,"0");return t?`#${n}${s}`:`#${n}`}function tSe(e,t){e=e.replace(/^#/,"");const n=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16);return{r:n,g:s,b:o,a:t}}const ea=e=>{const{r:t,g:n,b:s,a:o}=e;return`rgba(${t}, ${n}, ${s}, ${o})`},lc=e=>{const{r:t,g:n,b:s}=e;return`rgba(${t}, ${n}, ${s})`};class Wp extends Ut{constructor(n,s){super();j(this,"type","object_brush_line");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"state");j(this,"konva");j(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:gt(this.state)}));const{id:o,clip:r}=n;this.id=o,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Re.Group({name:`${this.type}:group`,clip:r,listening:!1}),line:new Re.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line");const{points:o,color:r,strokeWidth:a}=n;return this.konva.line.setAttrs({points:o.length===2?[...o,...o]:o,stroke:ea(r),strokeWidth:a}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class O1 extends Ut{constructor(n,s){super();j(this,"type","object_brush_line_with_pressure");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"state");j(this,"konva");j(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:gt(this.state)}));const{id:o,clip:r}=n;this.id=o,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Re.Group({name:`${this.type}:group`,clip:r,listening:!1}),line:new Re.Path({name:`${this.type}:path`,listening:!1,shadowForStrokeEnabled:!1,globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line with pressure");const{points:o,color:r,strokeWidth:a}=n;return this.konva.line.setAttrs({data:qP(o,{size:a/2,simulatePressure:!1,last:!0,thinning:1}),fill:ea(r)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class Up extends Ut{constructor(n,s){super();j(this,"type","object_eraser_line");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"state");j(this,"konva");j(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:gt(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating eraser line renderer module"),this.konva={group:new Re.Group({name:`${this.type}:group`,clip:n.clip,listening:!1}),line:new Re.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,stroke:"red",tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line");const{points:o,strokeWidth:r}=n;return this.konva.line.setAttrs({points:o.length===2?[...o,...o]:o,strokeWidth:r}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class N1 extends Ut{constructor(n,s){super();j(this,"type","object_eraser_line_with_pressure");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"state");j(this,"konva");j(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:gt(this.state)}));const{id:o,clip:r}=n;this.id=o,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Re.Group({name:`${this.type}:group`,clip:r,listening:!1}),line:new Re.Path({name:`${this.type}:path`,listening:!1,fill:"red",shadowForStrokeEnabled:!1,globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line with pressure");const{points:o,strokeWidth:r}=n;return this.konva.line.setAttrs({data:qP(o,{size:r/2,simulatePressure:!1,last:!0,thinning:1})}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting eraser line visibility"),this.konva.group.visible(n)}}class Ua extends Ut{constructor(n,s){super();j(this,"type","object_image");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"state");j(this,"konva");j(this,"imageElement",null);j(this,"isLoading",!1);j(this,"isError",!1);j(this,"mutex",new Pj);j(this,"updateImageSource",async n=>{this.log.trace({imageName:n},"Updating image source"),this.isLoading=!0,this.konva.group.visible(!0),this.konva.image||(this.konva.placeholder.group.visible(!1),this.konva.placeholder.text.text(Me("common.loadingImage","Loading Image")));const s=await Xd(n);if(s===null){this.onFailedToLoadImage(Me("controlLayers.unableToFindImage","Unable to find image"));return}const o=await Zn(()=>KP(s.image_url,!0));if(o.isErr()){this.onFailedToLoadImage(Me("controlLayers.unableToLoadImage","Unable to load image"));return}this.imageElement=o.value,await this.updateImageElement()});j(this,"onFailedToLoadImage",n=>{var s;this.log({image:this.state.image},n),(s=this.konva.image)==null||s.visible(!1),this.isLoading=!1,this.isError=!0,this.konva.placeholder.text.text(n),this.konva.placeholder.group.visible(!0)});j(this,"updateImageElement",async()=>{const n=await this.mutex.acquire();try{if(this.imageElement){const{width:s,height:o}=this.state.image;this.konva.image?(this.log.trace("Updating Konva image attrs"),this.konva.image.setAttrs({image:this.imageElement,width:s,height:o,visible:!0})):(this.log.trace("Creating new Konva image"),this.konva.image=new Re.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,width:s,height:o,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.placeholder.rect.setAttrs({width:s,height:o}),this.konva.placeholder.text.setAttrs({width:s,height:o,fontSize:s/16}),this.isLoading=!1,this.isError=!1,this.konva.placeholder.group.visible(!1)}}finally{n()}});j(this,"update",async(n,s=!1)=>{var o;if(s||this.state!==n){this.log.trace({state:n},"Updating image");const{image:r}=n,{width:a,height:l,image_name:d}=r;return(s||this.state.image.image_name!==d&&!this.isLoading)&&await this.updateImageSource(d),(o=this.konva.image)==null||o.setAttrs({width:a,height:l}),this.state=n,!0}return!1});j(this,"destroy",()=>{this.log.debug("Destroying image renderer module"),this.konva.group.destroy()});j(this,"setVisibility",n=>{this.log.trace({isVisible:n},"Setting image visibility"),this.konva.group.visible(n)});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isLoading:this.isLoading,isError:this.isError,state:gt(this.state),konva:{group:xs(this.konva.group),image:this.konva.image?xs(this.konva.image):null}}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module");const{width:o,height:r}=n.image;this.konva={group:new Re.Group({name:`${this.type}:group`,listening:!1}),placeholder:{group:new Re.Group({name:`${this.type}:placeholder_group`,listening:!1}),rect:new Re.Rect({name:`${this.type}:placeholder_rect`,fill:"hsl(220 12% 45% / 1)",width:o,height:r,listening:!1,perfectDrawEnabled:!1}),text:new Re.Text({name:`${this.type}:placeholder_text`,fill:"hsl(220 12% 10% / 1)",width:o,height:r,align:"center",verticalAlign:"middle",fontFamily:'"Inter Variable", sans-serif',fontSize:o/16,fontStyle:"600",text:Me("common.loadingImage","Loading Image"),listening:!1,perfectDrawEnabled:!1})},image:null},this.konva.placeholder.group.add(this.konva.placeholder.rect),this.konva.placeholder.group.add(this.konva.placeholder.text),this.konva.group.add(this.konva.placeholder.group),this.state=n}}class F1 extends Ut{constructor(n,s){super();j(this,"type","object_rect");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"state");j(this,"konva");j(this,"isFirstRender",!1);j(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isFirstRender:this.isFirstRender,state:gt(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Re.Group({name:`${this.type}:group`,listening:!1}),rect:new Re.Rect({name:`${this.type}:rect`,listening:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.rect),this.state=n}update(n,s=!1){if(s||this.state!==n){this.isFirstRender=!1,this.log.trace({state:n},"Updating rect");const{rect:o,color:r}=n;return this.konva.rect.setAttrs({x:o.x,y:o.y,width:o.width,height:o.height,fill:ea(r)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting rect visibility"),this.konva.group.visible(n)}}class eb extends Ut{constructor(n){super();j(this,"type","buffer_renderer");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"subscriptions",new Set);j(this,"state",null);j(this,"renderer",null);j(this,"konva");j(this,"renderBufferObject",async()=>{let n=!1;if(!this.state)return!1;let s=null;return this.renderer&&this.renderer.id!==this.state.id&&(s=this.renderer,this.renderer=null),this.state.type==="brush_line"?(ve(this.renderer instanceof Wp||!this.renderer),this.renderer||(this.renderer=new Wp(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="brush_line_with_pressure"?(ve(this.renderer instanceof O1||!this.renderer),this.renderer||(this.renderer=new O1(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line"?(ve(this.renderer instanceof Up||!this.renderer),this.renderer||(this.renderer=new Up(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line_with_pressure"?(ve(this.renderer instanceof N1||!this.renderer),this.renderer||(this.renderer=new N1(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="rect"?(ve(this.renderer instanceof F1||!this.renderer),this.renderer||(this.renderer=new F1(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="image"&&(ve(this.renderer instanceof Ua||!this.renderer),this.renderer||(this.renderer=new Ua(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=await this.renderer.update(this.state,!0)),s&&s.destroy(),n});j(this,"hasBuffer",()=>this.state!==null||this.renderer!==null);j(this,"setBuffer",async(n,s=!1)=>(this.log.trace("Setting buffer"),this.state=n,s&&this.konva.group.offset({x:0,y:0}),await this.renderBufferObject()));j(this,"clearBuffer",()=>{var n;(this.state||this.renderer)&&(this.log.trace("Clearing buffer"),(n=this.renderer)==null||n.destroy(),this.renderer=null,this.state=null)});j(this,"commitBuffer",n=>{if({...n},!this.state||!this.renderer){this.log.trace("No buffer to commit");return}this.log.trace({buffer:this.renderer.repr()},"Committing buffer"),this.parent.renderer.adoptObjectRenderer(this.renderer);{const s=this.parent.entityIdentifier;switch(this.state.type){case"brush_line":case"brush_line_with_pressure":this.manager.stateApi.addBrushLine({entityIdentifier:s,brushLine:this.state});break;case"eraser_line":case"eraser_line_with_pressure":this.manager.stateApi.addEraserLine({entityIdentifier:s,eraserLine:this.state});break;case"rect":this.manager.stateApi.addRect({entityIdentifier:s,rect:this.state});break}}this.renderer=null,this.state=null});j(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.renderer&&this.renderer.destroy()});j(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,bufferState:gt(this.state),bufferRenderer:((n=this.renderer)==null?void 0:n.repr())??null}});this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Re.Group({name:`${this.type}:buffer_group`,listening:!1})},this.parent.konva.layer.add(this.konva.group),this.subscriptions.add(this.manager.tool.$tool.listen(()=>{this.hasBuffer()&&!this.manager.$isBusy.get()&&this.commitBuffer()}))}}const nSe={PROCESS_DEBOUNCE_MS:1e3};class V$ extends Ut{constructor(n){super();j(this,"type","canvas_filterer");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"config",nSe);j(this,"subscriptions",new Set);j(this,"abortController",null);j(this,"$isFiltering",Le(!1));j(this,"$lastProcessedHash",Le(""));j(this,"$isProcessing",Le(!1));j(this,"$filterConfig",Le(Gn.adjust_image.buildDefaults()));j(this,"$initialFilterConfig",Le(null));j(this,"$imageState",Le(null));j(this,"$hasImageState",jn(this.$imageState,n=>n!==null));j(this,"$simple",Le(!1));j(this,"imageModule",null);j(this,"konva");j(this,"KONVA_GROUP_NAME",`${this.type}:group`);j(this,"subscribe",()=>{this.subscriptions.add(this.$filterConfig.listen(()=>{this.manager.stateApi.getSettings().autoProcess&&this.$isFiltering.get()&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(sm,n=>{n&&this.$isFiltering.get()&&this.process()}))});j(this,"unsubscribe",()=>{this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});j(this,"start",n=>{const s=this.manager.stateApi.$filteringAdapter.get();if(s){this.log.error(`Already filtering an entity: ${s.id}`);return}this.log.trace("Initializing filter"),this.resetEphemeralState(),this.$isFiltering.set(!0);const o=this.parent.transformer.$pixelRect.get(),r=nC(this.parent.state.position,o);if(this.konva.group.setAttrs(r),this.parent.konva.layer.add(this.konva.group),n)this.$filterConfig.set(n),this.$initialFilterConfig.set(n),this.$simple.set(!0);else{const a=this.createInitialFilterConfig();this.$filterConfig.set(a),this.$initialFilterConfig.set(a),this.$simple.set(!1)}this.subscribe(),this.manager.stateApi.$filteringAdapter.set(this.parent),this.manager.stateApi.getSettings().autoProcess&&this.processImmediate()});j(this,"createInitialFilterConfig",()=>{if(this.parent.type==="control_layer_adapter"&&this.parent.state.controlAdapter.model){const n=fme(this.parent.state.controlAdapter.model.key,jS),s=this.manager.stateApi.runSelector(n);return(h$(s)??Gn.canny_edge_detection).buildDefaults()}else return Gn.adjust_image.buildDefaults()});j(this,"processImmediate",async()=>{var b;if(!this.$isFiltering.get()){this.log.warn("Cannot process filter when not initialized");return}const n=this.$filterConfig.get(),s=Gn[n.type];if(!(((b=s.validateConfig)==null?void 0:b.call(s,n))??!0)){this.log.error({config:n},"Invalid filter config");return}const r=lf({config:n});if(r===this.$lastProcessedHash.get()){this.log.trace("Already processed config");return}this.log.trace({config:n},"Processing filter");const a=this.parent.transformer.getRelativeRect(),l=await Zn(()=>this.parent.renderer.rasterize({rect:a,attrs:{filters:[],opacity:1}}));if(l.isErr()){ge({status:"error",title:"Failed to process filter"}),this.log.error({error:$n(l.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}this.$isProcessing.set(!0);const d=l.value,u=AS(()=>s.buildGraph(d,n));if(u.isErr()){this.log.error({error:$n(u.error)},"Error building filter graph"),this.$isProcessing.set(!1);return}const h=new AbortController;this.abortController=h;const{graph:p,outputNodeId:f}=u.value,m=await Zn(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:p,outputNodeId:f,prepend:!0,signal:h.signal}));if(m.isErr()){this.log.error({error:$n(m.error)},"Error filtering"),this.$isProcessing.set(!1),h.signal.aborted||h.abort(),this.abortController=null;return}this.log.trace({imageDTO:m.value},"Filtered");const g=ao(m.value);this.$imageState.set(g);const x=this.imageModule;this.imageModule=new Ua(g,this),await this.imageModule.update(g,!0),this.konva.group.add(this.imageModule.konva.group),this.parent.renderer.hideObjects(),x&&x.destroy(),this.$lastProcessedHash.set(r),this.$isProcessing.set(!1),h.signal.aborted||h.abort(),this.abortController=null});j(this,"process",Di(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS));j(this,"apply",()=>{const n=this.$imageState.get();if(!n){this.log.warn("No image state to apply filter to");return}this.log.trace("Applying"),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.teardown()});j(this,"saveAs",n=>{const s=this.$imageState.get();if(!s){this.log.warn("No image state to apply filter to");return}this.log.trace(`Saving as ${n}`);const o=this.parent.transformer.getRelativeRect(),r={overrides:{objects:[s],position:{x:Math.round(o.x),y:Math.round(o.y)}},isSelected:!0};switch(n){case"raster_layer":this.manager.stateApi.addRasterLayer(r);break;case"control_layer":this.manager.stateApi.addControlLayer(r);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(r);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(r);break;default:ve(!1)}});j(this,"resetEphemeralState",()=>{this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null);const n=gt(this.$initialFilterConfig.get()??this.createInitialFilterConfig());this.$filterConfig.set(n),this.$imageState.set(null),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1)});j(this,"teardown",()=>{this.unsubscribe(),this.parent.renderer.showObjects(),this.konva.group.remove(),this.resetEphemeralState(),this.$isFiltering.set(!1),this.manager.stateApi.$filteringAdapter.set(null)});j(this,"reset",()=>{this.log.trace("Resetting"),this.resetEphemeralState()});j(this,"cancel",()=>{this.log.trace("Canceling"),this.teardown()});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,config:this.config,imageState:gt(this.$imageState.get()),$isFiltering:this.$isFiltering.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$filterConfig:this.$filterConfig.get(),konva:{group:xs(this.konva.group)}}));j(this,"destroy",()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating filter module"),this.konva={group:new Re.Group({name:this.KONVA_GROUP_NAME})}}}const sSe=e=>{const t=e.data.length/4;for(let n=0;n<t;n++){const s=e.data[n*4+0],o=e.data[n*4+1],r=e.data[n*4+2],a=e.data[n*4+3],l=Math.min(s,o,r),d=Math.max(s,o,r);e.data[n*4+3]=Math.min(a,(l+d)/2)}},iSe=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="6px" height="6px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M1,-2L13,10" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M-1,2L10,13" style="fill:none;stroke:black;stroke-width:1.2px;"/>
</svg>
`,oSe=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="6px" height="6px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.3px;"/>
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.3px;"/>
</svg>
`,rSe=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="12px" height="12px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0.5,-1L0.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M4.5,-1L4.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M8.5,-1L8.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,0.5L12,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,4.5L12,4.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,8.5L12,8.5" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`,aSe=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="9px" height="9px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M10,0.5L-1,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M10,3.5L-1,3.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M10,6.5L-1,6.5" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`,lSe=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="9px" height="9px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0.5,-1L0.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M3.5,-1L3.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M6.5,-1L6.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`;function cSe(e,t){let n="data:image/svg+xml;utf8,";return e==="crosshatch"?n+=iSe:e==="diagonal"?n+=oSe:e==="horizontal"?n+=aSe:e==="vertical"?n+=lSe:e==="grid"&&(n+=rSe),n=n.replaceAll("stroke:black",`stroke:${lc(t)}`),n}function dSe(e,...t){const n=new Image;return n.onload=()=>{e.fillPatternImage(n)},n.crossOrigin=bu.get()?"use-credentials":"anonymous",n.src=cSe(...t),n}class tb extends Ut{constructor(n){super();j(this,"type","object_renderer");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"subscriptions",new Set);j(this,"renderers",new Mp);j(this,"konva");j(this,"initialize",async()=>{this.log.debug("Initializing module"),await this.render()});j(this,"render",async()=>{let n=!1;const s=this.parent.state.objects,o=s.map(r=>r.id);for(const r of this.renderers.values())o.includes(r.id)||(this.renderers.delete(r.id),r.destroy(),n=!0);for(const r of s)n=await this.renderObject(r)||n;return this.syncKonvaCache(n),n});j(this,"hideObjects",()=>{this.konva.objectGroup.hide()});j(this,"showObjects",()=>{this.konva.objectGroup.show()});j(this,"adoptObjectRenderer",n=>{this.renderers.set(n.id,n),n.konva.group.moveTo(this.konva.objectGroup)});j(this,"syncKonvaCache",(n=!1)=>{if(this.renderers.size===0){this.log.trace("Clearing object group cache"),this.konva.objectGroup.clearCache();return}const s=this.parent.konva.layer.visible(),o=this.konva.objectGroup.isCached();s&&(n||!o)&&(this.log.trace("Caching object group"),this.konva.objectGroup.clearCache(),this.konva.objectGroup.cache({pixelRatio:1,imageSmoothingEnabled:!1}))});j(this,"updateTransparencyEffect",()=>{if(this.parent.state.type==="control_layer"){const n=this.parent.state.withTransparencyEffect?[sSe]:[];this.konva.objectGroup.filters(n)}});j(this,"updateCompositingRectFill",xC(n=>{if(!n&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect fill");const s=this.parent.state.fill;s.style==="solid"?this.konva.compositing.rect.setAttrs({fill:lc(s.color),fillPriority:"color"}):(this.konva.compositing.rect.setAttrs({fillPriority:"pattern"}),dSe(this.konva.compositing.rect,s.style,s.color))},100));j(this,"updateCompositingRectSize",n=>{if(!n&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect size");const s=this.manager.stage.unscale(1);this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect(),fillPatternScaleX:s,fillPatternScaleY:s})});j(this,"updateCompositingRectPosition",n=>{!n&&!this.hasObjects()||this.parent.konva.layer.visible()&&(!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance"||(this.log.trace("Updating compositing rect position"),this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect()})))});j(this,"updateOpacity",xC(()=>{if(!this.parent.konva.layer.visible())return;this.log.trace("Updating opacity");const n=this.parent.state.opacity;this.konva.compositing?this.konva.compositing.group.opacity(n):this.konva.objectGroup.opacity(n),this.parent.bufferRenderer.konva.group.opacity(n)},100));j(this,"renderObject",async(n,s=!1)=>{let o=!1,r=this.renderers.get(n.id);const a=!r;return n.type==="brush_line"?(ve(r instanceof Wp||!r),r||(r=new Wp(n,this),this.renderers.set(r.id,r),this.konva.objectGroup.add(r.konva.group)),o=r.update(n,s||a)):n.type==="brush_line_with_pressure"?(ve(r instanceof O1||!r),r||(r=new O1(n,this),this.renderers.set(r.id,r),this.konva.objectGroup.add(r.konva.group)),o=r.update(n,s||a)):n.type==="eraser_line"?(ve(r instanceof Up||!r),r||(r=new Up(n,this),this.renderers.set(r.id,r),this.konva.objectGroup.add(r.konva.group)),o=r.update(n,s||a)):n.type==="eraser_line_with_pressure"?(ve(r instanceof N1||!r),r||(r=new N1(n,this),this.renderers.set(r.id,r),this.konva.objectGroup.add(r.konva.group)),o=r.update(n,s||a)):n.type==="rect"?(ve(r instanceof F1||!r),r||(r=new F1(n,this),this.renderers.set(r.id,r),this.konva.objectGroup.add(r.konva.group)),o=r.update(n,s||a)):n.type==="image"&&(ve(r instanceof Ua||!r),r||(r=new Ua(n,this),this.renderers.set(r.id,r),this.konva.objectGroup.add(r.konva.group)),o=await r.update(n,s||a)),o&&this.konva.objectGroup.isCached()&&this.konva.objectGroup.clearCache(),o});j(this,"needsPixelBbox",()=>{let n=!1;for(const s of this.renderers.values()){const o=s instanceof Up,r=s instanceof Ua,a=s instanceof Wp&&s.state.clip;if(o||a||r){n=!0;break}}return n});j(this,"hasObjects",()=>this.renderers.size>0||this.parent.bufferRenderer.hasBuffer());j(this,"rasterize",async n=>{const s=this.manager.stateApi.$rasterizingAdapter.get();s&&ve(!1,`Already rasterizing an entity: ${s.id}`);const{rect:o,replaceObjects:r,attrs:a,bg:l,ignoreCache:d}={replaceObjects:!1,ignoreCache:!1,attrs:{},...n};let u=null;const h={rect:o,attrs:a,bg:l},p=this.parent.hash(h),f=this.manager.cache.imageNameCache.get(p);if(f&&!d&&(u=await Xd(f),u))return this.log.trace({rect:o,cachedImageName:f,imageDTO:u},"Using cached rasterized image"),u;this.log.trace({rasterizeArgs:h},"Rasterizing entity"),this.manager.stateApi.$rasterizingAdapter.set(this.parent);try{const m=await this.getBlob(h);this.manager._isDebugging&&eC(m,"Rasterized entity"),u=await er({file:new File([m],`${this.id}_rasterized.png`,{type:"image/png"}),image_category:"other",is_intermediate:!0,silent:!0});const g=ao(u);return r&&(await this.parent.bufferRenderer.setBuffer(g),this.parent.bufferRenderer.commitBuffer({pushToState:!1})),this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:g,position:{x:Math.round(o.x),y:Math.round(o.y)},replaceObjects:r}),this.manager.cache.imageNameCache.set(p,u.image_name),u}catch(m){throw this.log.error({rasterizeArgs:h,error:$n(m)},"Failed to rasterize entity"),m}finally{this.manager.stateApi.$rasterizingAdapter.set(null)}});j(this,"cloneObjectGroup",(n={})=>{const{attrs:s}=n,o=this.konva.objectGroup.clone();return s&&o.setAttrs(s),o.hasChildren()&&o.cache({pixelRatio:1,imageSmoothingEnabled:!1}),o});j(this,"getCanvas",(n={})=>{const{rect:s,attrs:o,bg:r}=n,a=this.cloneObjectGroup({attrs:o}),l=Nee({node:a,rect:s,bg:r});return a.destroy(),l});j(this,"getBlob",async(n={})=>{const{rect:s,attrs:o,bg:r}=n,a=this.cloneObjectGroup({attrs:o});return await Fee({node:a,rect:s,bg:r})});j(this,"getImageData",(n={})=>{const{rect:s,attrs:o,bg:r}=n,a=this.cloneObjectGroup({attrs:o}),l=Bee({node:a,rect:s,bg:r});return a.destroy(),l});j(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear();for(const n of this.renderers.values())n.destroy();this.renderers.clear()});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,renderers:Array.from(this.renderers.values()).map(n=>n.repr()),konva:{objectGroup:xs(this.konva.objectGroup)}}));if(this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={objectGroup:new Re.Group({name:`${this.type}:object_group`,listening:!1}),compositing:null},this.parent.konva.layer.add(this.konva.objectGroup),this.parent.entityIdentifier.type==="inpaint_mask"||this.parent.entityIdentifier.type==="regional_guidance"){const s=new Re.Rect({name:`${this.type}:compositing_rect`,globalCompositeOperation:"source-in",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1});this.konva.compositing={group:new Re.Group({name:`${this.type}:compositing_group`,listening:!1}),rect:s,patternImage:new Image},this.konva.compositing.group.add(this.konva.compositing.rect),this.parent.konva.layer.add(this.konva.compositing.group)}this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,o)=>{this.konva.compositing&&((s.width!==o.width||s.height!==o.height||s.scale!==o.scale)&&this.updateCompositingRectSize(),(s.x!==o.x||s.y!==o.y)&&this.updateCompositingRectPosition())}))}}const uSe={SAM_POINT_RADIUS:8,SAM_POINT_BORDER_WIDTH:2,SAM_POINT_BORDER_COLOR:{r:0,g:0,b:0,a:1},SAM_POINT_FOREGROUND_COLOR:{r:50,g:255,b:0,a:1},SAM_POINT_BACKGROUND_COLOR:{r:255,g:0,b:50,a:1},SAM_POINT_NEUTRAL_COLOR:{r:0,g:225,b:255,a:1},MASK_COLOR:{r:0,g:225,b:255,a:1},PROCESS_DEBOUNCE_MS:1e3},Ix=class Ix extends Ut{constructor(n){super();j(this,"type","canvas_segment_anything");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"config",uSe);j(this,"subscriptions",new Set);j(this,"abortController",null);j(this,"$isSegmenting",Le(!1));j(this,"$lastProcessedHash",Le(""));j(this,"$isProcessing",Le(!1));j(this,"$pointType",Le(1));j(this,"$pointTypeString",jn(this.$pointType,n=>qb[n]));j(this,"$isDraggingPoint",Le(!1));j(this,"$imageState",Le(null));j(this,"$hasImageState",jn(this.$imageState,n=>n!==null));j(this,"$points",Le([]));j(this,"$hasPoints",jn(this.$points,n=>n.length>0));j(this,"$invert",Le(!1));j(this,"imageModule",null);j(this,"konva");j(this,"KONVA_CIRCLE_NAME",`${this.type}:circle`);j(this,"KONVA_GROUP_NAME",`${this.type}:group`);j(this,"KONVA_POINT_GROUP_NAME",`${this.type}:point_group`);j(this,"KONVA_MASK_GROUP_NAME",`${this.type}:mask_group`);j(this,"KONVA_COMPOSITING_RECT_NAME",`${this.type}:compositing_rect`);j(this,"syncCursorStyle",()=>{this.$isProcessing.get()?this.manager.stage.setCursor("wait"):this.$isSegmenting.get()&&this.manager.stage.setCursor("crosshair")});j(this,"syncPointScales",()=>{const n=this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),s=this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH);for(const o of this.$points.get())o.konva.circle.radius(n),o.konva.circle.strokeWidth(s)});j(this,"getSAMPoints",()=>{const n=[];for(const{id:s,coord:o,label:r}of this.$points.get())n.push({id:s,x:o.x,y:o.y,label:r});return n});j(this,"onStagePointerUp",n=>{if(n.evt.button!==0||this.manager.stage.getIsDragging()||this.$isDraggingPoint.get()||this.$isProcessing.get())return;const s=this.manager.tool.$cursorPos.get();if(!s)return;const o=this.parent.transformer.$pixelRect.get(),r=nC(this.parent.state.position,o),a=ir(s.relative,r),l=this.createPoint(a,this.$pointType.get()),d=[...this.$points.get(),l];this.$points.set(d)});j(this,"subscribe",()=>{this.manager.stage.konva.stage.on("pointerup",this.onStagePointerUp),this.subscriptions.add(()=>{this.manager.stage.konva.stage.off("pointerup",this.onStagePointerUp)}),this.subscriptions.add(this.$isProcessing.listen(n=>{this.syncCursorStyle(),this.parent.konva.layer.listening(!n)})),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((n,s)=>{n.scale!==s.scale&&this.syncPointScales()})),this.subscriptions.add(this.$points.listen(n=>{n.length!==0&&this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.$invert.listen(()=>{this.$points.get().length!==0&&this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(sm,n=>{this.$points.get().length!==0&&n&&this.process()}))});j(this,"unsubscribe",()=>{this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});j(this,"start",()=>{const n=this.manager.stateApi.$segmentingAdapter.get();if(n){this.log.error(`Already segmenting an entity: ${n.id}`);return}this.log.trace("Starting segment anything"),this.resetEphemeralState(),this.$isSegmenting.set(!0);const s=this.parent.transformer.$pixelRect.get(),o=nC(this.parent.state.position,s);this.konva.group.setAttrs(o),this.parent.konva.layer.add(this.konva.group),this.parent.konva.layer.listening(!0),this.subscribe(),this.manager.stateApi.$segmentingAdapter.set(this.parent),this.syncCursorStyle()});j(this,"processImmediate",async()=>{if(!this.$isSegmenting.get()){this.log.warn("Cannot process segmentation when not initialized");return}if(this.$isProcessing.get()){this.log.warn("Already processing");return}const n=this.getSAMPoints();if(n.length===0){this.log.trace("No points to segment");return}const s=this.$invert.get(),o=lf({points:n,invert:s});if(o===this.$lastProcessedHash.get()){this.log.trace("Already processed points");return}this.$isProcessing.set(!0),this.log.trace({points:n},"Segmenting");const r=this.parent.transformer.getRelativeRect(),a=await Zn(()=>this.parent.renderer.rasterize({rect:r,attrs:{filters:[],opacity:1}}));if(a.isErr()){ge({status:"error",title:"Failed to select object"}),this.log.error({error:$n(a.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}const l=new AbortController;this.abortController=l;const{graph:d,outputNodeId:u}=Ix.buildGraph(a.value,n,s),h=await Zn(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:d,outputNodeId:u,prepend:!0,signal:l.signal}));if(h.isErr()){this.log.error({error:$n(h.error)},"Error segmenting"),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null;return}this.log.trace({imageDTO:h.value},"Segmented");const p=ao(h.value);this.$imageState.set(p),this.imageModule&&this.imageModule.destroy(),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.imageModule=new Ua(p,this),await this.imageModule.update(p,!0),this.konva.compositingRect.setAttrs({width:p.image.width,height:p.image.height,visible:!0}),this.konva.maskGroup.add(this.imageModule.konva.group),this.konva.compositingRect.moveToTop(),this.konva.maskGroup.cache(),this.konva.maskTween=new Re.Tween({node:this.konva.maskGroup,duration:1,opacity:.4,yoyo:!0,repeat:1/0,easing:Re.Easings.EaseOut}),this.konva.maskTween.play(),this.$lastProcessedHash.set(o),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null});j(this,"process",Di(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS));j(this,"apply",()=>{const n=this.$imageState.get();if(!n){this.log.error("No image state to apply");return}this.log.trace("Applying");const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.teardown()});j(this,"saveAs",n=>{const s=this.$imageState.get();if(!s){this.log.error("No image state to save as");return}this.log.trace(`Saving as ${n}`),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const o=this.parent.transformer.getRelativeRect(),r={overrides:{objects:[s],position:{x:Math.round(o.x),y:Math.round(o.y)}},isSelected:!0};switch(n){case"raster_layer":this.manager.stateApi.addRasterLayer(r);break;case"control_layer":this.manager.stateApi.addControlLayer(r);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(r);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(r);break;default:ve(!1)}});j(this,"reset",()=>{this.log.trace("Resetting"),this.resetEphemeralState()});j(this,"cancel",()=>{this.log.trace("Canceling"),this.teardown()});j(this,"teardown",()=>{this.unsubscribe(),this.konva.group.remove(),this.resetEphemeralState(),this.$isSegmenting.set(!1),this.manager.stateApi.$segmentingAdapter.set(null)});j(this,"resetEphemeralState",()=>{var n;(n=this.abortController)==null||n.abort(),this.abortController=null;for(const s of this.$points.get())s.konva.circle.destroy();this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.$points.set([]),this.$imageState.set(null),this.$pointType.set(1),this.$invert.set(!1),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1),this.konva.compositingRect.visible(!1),this.konva.maskGroup.clearCache()});j(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,points:this.$points.get().map(({id:s,konva:o,label:r})=>({id:s,label:r,circle:xs(o.circle)})),imageState:gt(this.$imageState.get()),imageModule:((n=this.imageModule)==null?void 0:n.repr())??null,config:gt(this.config),$isSegmenting:this.$isSegmenting.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$pointType:this.$pointType.get(),$pointTypeString:this.$pointTypeString.get(),$isDraggingPoint:this.$isDraggingPoint.get(),konva:{group:xs(this.konva.group),compositingRect:xs(this.konva.compositingRect),maskGroup:xs(this.konva.maskGroup),pointGroup:xs(this.konva.pointGroup)}}});j(this,"destroy",()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Re.Group({name:this.KONVA_GROUP_NAME}),pointGroup:new Re.Group({name:this.KONVA_POINT_GROUP_NAME}),maskGroup:new Re.Group({name:this.KONVA_MASK_GROUP_NAME,opacity:.6}),compositingRect:new Re.Rect({name:this.KONVA_COMPOSITING_RECT_NAME,fill:ea(this.config.MASK_COLOR),globalCompositeOperation:"source-atop",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1,visible:!1}),maskTween:null},this.konva.group.add(this.konva.maskGroup),this.konva.group.add(this.konva.pointGroup),this.konva.maskGroup.add(this.konva.compositingRect)}createPoint(n,s){const o=Te("sam_point"),r=D4(n),a=new Re.Circle({name:this.KONVA_CIRCLE_NAME,x:r.x,y:r.y,radius:this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),fill:ea(this.getSAMPointColor(s)),stroke:ea(this.config.SAM_POINT_BORDER_COLOR),strokeWidth:this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH),draggable:!0,perfectDrawEnabled:!0,opacity:.6,dragDistance:3});return a.on("pointerup",l=>{if(this.$isDraggingPoint.get()||l.evt.button!==0)return;l.cancelBubble=!0,a.destroy();const d=this.$points.get().filter(u=>u.id!==o);d.length===0?this.resetEphemeralState():this.$points.set(d)}),a.on("dragstart",()=>{this.$isDraggingPoint.set(!0)}),a.on("dragend",()=>{const l=D4(a.position());this.log.trace({...l,label:qb[s]},"Moved SAM point"),this.$isDraggingPoint.set(!1);const d=this.$points.get().map(u=>u.id===o?{...u,coord:l}:u);this.$points.set(d)}),this.konva.pointGroup.add(a),this.log.trace({...r,label:qb[s]},"Created SAM point"),{id:o,coord:r,label:s,konva:{circle:a}}}getSAMPointColor(n){return n===0?this.config.SAM_POINT_NEUTRAL_COLOR:n===1?this.config.SAM_POINT_FOREGROUND_COLOR:this.config.SAM_POINT_BACKGROUND_COLOR}};j(Ix,"buildGraph",({image_name:n},s,o)=>{const r=new ss(Te("canvas_segment_anything")),a=r.addNode({id:Te("segment_anything"),type:"segment_anything",model:"segment-anything-huge",image:{image_name:n},point_lists:[{points:s.map(({x:d,y:u,label:h})=>({x:d,y:u,label:h}))}],mask_filter:"largest"}),l=r.addNode({id:Te("apply_tensor_mask_to_image"),type:"apply_tensor_mask_to_image",image:{image_name:n},invert:o});return r.addEdge(a,"mask",l,"mask"),{graph:r,outputNodeId:l.id}});let B1=Ix;class hSe extends lu{constructor(n,s){super(n,s,"control_layer_adapter");j(this,"renderer");j(this,"bufferRenderer");j(this,"transformer");j(this,"filterer");j(this,"segmentAnything");j(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.withTransparencyEffect!==s.withTransparencyEffect)&&this.renderer.updateTransparencyEffect())});j(this,"syncTransparencyEffect",()=>{this.renderer.updateTransparencyEffect()});j(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});j(this,"getHashableState",()=>{const n=["name","controlAdapter","withTransparencyEffect","isLocked"];return na(this.state,n)});this.renderer=new tb(this),this.bufferRenderer=new eb(this),this.transformer=new ac(this),this.filterer=new V$(this),this.segmentAnything=new B1(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class pSe extends lu{constructor(n,s){super(n,s,"inpaint_mask_adapter");j(this,"renderer");j(this,"bufferRenderer");j(this,"transformer");j(this,"filterer");j(this,"segmentAnything");j(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!0),(!s||this.state.objects!==s.objects)&&(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});j(this,"getHashableState",()=>{const n=["fill","name","opacity","isLocked"];return na(this.state,n)});j(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new tb(this),this.bufferRenderer=new eb(this),this.transformer=new ac(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class fSe extends lu{constructor(n,s){super(n,s,"raster_layer_adapter");j(this,"renderer");j(this,"bufferRenderer");j(this,"transformer");j(this,"filterer");j(this,"segmentAnything");j(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity())});j(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});j(this,"getHashableState",()=>{const n=["name","isLocked"];return na(this.state,n)});this.renderer=new tb(this),this.bufferRenderer=new eb(this),this.transformer=new ac(this),this.filterer=new V$(this),this.segmentAnything=new B1(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class mSe extends lu{constructor(n,s){super(n,s,"regional_guidance_adapter");j(this,"renderer");j(this,"bufferRenderer");j(this,"transformer");j(this,"filterer");j(this,"segmentAnything");j(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!0),(!s||this.state.objects!==s.objects)&&(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});j(this,"getHashableState",()=>{const n=["fill","name","opacity","isLocked","autoNegative","positivePrompt","negativePrompt","referenceImages"];return na(this.state,n)});j(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new tb(this),this.bufferRenderer=new eb(this),this.transformer=new ac(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class gSe extends Ut{constructor(n){super();j(this,"type","entity_renderer");j(this,"id");j(this,"path");j(this,"log");j(this,"parent");j(this,"manager");j(this,"subscriptions",new Set);j(this,"initialize",()=>{this.log.debug("Initializing module"),this.createNewRasterLayers(this.manager.stateApi.runSelector(R4)),this.createNewControlLayers(this.manager.stateApi.runSelector(O4)),this.createNewRegionalGuidance(this.manager.stateApi.runSelector(F4)),this.createNewInpaintMasks(this.manager.stateApi.runSelector(N4)),this.arrangeEntities(this.manager.stateApi.runSelector(Ye),null)});j(this,"createNewRasterLayers",n=>{for(const s of n)this.manager.adapters.rasterLayers.has(s.id)||this.manager.createAdapter(ni(s)).initialize()});j(this,"createNewControlLayers",n=>{for(const s of n)this.manager.adapters.controlLayers.has(s.id)||this.manager.createAdapter(ni(s)).initialize()});j(this,"createNewRegionalGuidance",n=>{for(const s of n)this.manager.adapters.regionMasks.has(s.id)||this.manager.createAdapter(ni(s)).initialize()});j(this,"createNewInpaintMasks",n=>{for(const s of n)this.manager.adapters.inpaintMasks.has(s.id)||this.manager.createAdapter(ni(s)).initialize()});j(this,"arrangeEntities",(n,s)=>{var o,r,a,l,d,u;if(!s||n.rasterLayers.entities!==s.rasterLayers.entities||n.controlLayers.entities!==s.controlLayers.entities||n.regionalGuidance.entities!==s.regionalGuidance.entities||n.inpaintMasks.entities!==s.inpaintMasks.entities||((o=n.selectedEntityIdentifier)==null?void 0:o.id)!==((r=s.selectedEntityIdentifier)==null?void 0:r.id)){this.log.trace("Arranging entities");let h=0;this.manager.background.konva.layer.zIndex(h++);for(const{id:p}of this.manager.stateApi.getRasterLayersState().entities)(a=this.manager.adapters.rasterLayers.get(p))==null||a.konva.layer.zIndex(h++);for(const{id:p}of this.manager.stateApi.getControlLayersState().entities)(l=this.manager.adapters.controlLayers.get(p))==null||l.konva.layer.zIndex(h++);for(const{id:p}of this.manager.stateApi.getRegionsState().entities)(d=this.manager.adapters.regionMasks.get(p))==null||d.konva.layer.zIndex(h++);for(const{id:p}of this.manager.stateApi.getInpaintMasksState().entities)(u=this.manager.adapters.inpaintMasks.get(p))==null||u.konva.layer.zIndex(h++);this.manager.konva.previewLayer.zIndex(h++)}});j(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});this.id=Te("canvas_renderer"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(R4,this.createNewRasterLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(O4,this.createNewControlLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(N4,this.createNewInpaintMasks)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(F4,this.createNewRegionalGuidance)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ye,this.arrangeEntities))}}const xSe=e=>!!e.image;class ySe extends Ut{constructor(n){super();j(this,"type","progress_image");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"konva");j(this,"$isLoading",Le(!1));j(this,"$isError",Le(!1));j(this,"imageElement",null);j(this,"subscriptions",new Set);j(this,"$lastProgressEvent",Le(null));j(this,"$hasActiveGeneration",Le(!1));j(this,"mutex",new Pj);j(this,"setSocketEventListeners",()=>{const n=r=>{r.destination==="canvas"&&xSe(r)&&this.$hasActiveGeneration.get()&&this.$lastProgressEvent.set(r)},s=r=>{r.destination==="canvas"&&(r.status==="failed"||r.status==="canceled")&&(this.$lastProgressEvent.set(null),this.$hasActiveGeneration.set(!1))},o=()=>{this.$lastProgressEvent.set(null)};return this.manager.socket.on("invocation_progress",n),this.manager.socket.on("queue_item_status_changed",s),this.manager.socket.on("connect",o),this.manager.socket.on("connect_error",o),this.manager.socket.on("disconnect",o),()=>{this.manager.socket.off("invocation_progress",n),this.manager.socket.off("queue_item_status_changed",s),this.manager.socket.off("connect",o),this.manager.socket.off("connect_error",o),this.manager.socket.off("disconnect",o)}});j(this,"getNodes",()=>[this.konva.group]);j(this,"render",async()=>{var u;const n=await this.mutex.acquire(),s=this.$lastProgressEvent.get(),o=this.manager.stateApi.runSelector(sC);if(!s||!o){this.konva.group.visible(!1),(u=this.konva.image)==null||u.destroy(),this.konva.image=null,this.imageElement=null,this.$isLoading.set(!1),this.$isError.set(!1),n();return}this.$isLoading.set(!0);const{x:r,y:a,width:l,height:d}=this.manager.stateApi.getBbox().rect;try{this.imageElement=await KP(s.image.dataURL),this.konva.image?this.konva.image.setAttrs({image:this.imageElement,x:r,y:a,width:l,height:d}):(this.konva.image=new Re.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,x:r,y:a,width:l,height:d,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.group.visible(this.manager.stagingArea.$shouldShowStagedImage.get())}catch{this.$isError.set(!0)}finally{this.$isLoading.set(!1),n()}});j(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$lastProgressEvent:_o(this.$lastProgressEvent.get()),$hasActiveGeneration:this.$hasActiveGeneration.get(),$isError:this.$isError.get(),$isLoading:this.$isLoading.get()}));this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating progress image module"),this.konva={group:new Re.Group({name:`${this.type}:group`,listening:!1}),image:null},this.subscriptions.add(this.manager.stagingArea.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(sC,this.render)),this.subscriptions.add(this.setSocketEventListeners()),this.subscriptions.add(this.manager.stateApi.createStoreSubscription($ee,({data:s})=>{s&&(s.in_progress>0||s.pending>0)?this.$hasActiveGeneration.set(!0):this.$hasActiveGeneration.set(!1)})),this.subscriptions.add(this.$lastProgressEvent.listen(this.render))}}const bSe={MIN_SCALE:.1,MAX_SCALE:20,SCALE_FACTOR:.999,FIT_LAYERS_TO_STAGE_PADDING_PX:48,SCALE_SNAP_POINTS:[.25,.5,.75,1,1.5,2,3,4,5],SCALE_SNAP_TOLERANCE:.05};class vSe extends Ut{constructor(n,s){super();j(this,"type","stage");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"_intendedScale",1);j(this,"_activeSnapPoint",null);j(this,"_snapTimeout",null);j(this,"container");j(this,"konva");j(this,"config",bSe);j(this,"$stageAttrs",Le({x:0,y:0,width:0,height:0,scale:0}));j(this,"$scale",jn(this.$stageAttrs,n=>n.scale));j(this,"subscriptions",new Set);j(this,"resizeObserver",null);j(this,"setContainer",n=>{this.container=n,this.konva.stage.container(n),this.setResizeObserver()});j(this,"setResizeObserver",()=>{this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.fitStageToContainer),this.resizeObserver.observe(this.container)});j(this,"initialize",()=>{this.log.debug("Initializing module"),this.container.style.touchAction="none",this.container.style.userSelect="none",this.container.style.webkitUserSelect="none",this.konva.stage.container(this.container),this.setResizeObserver(),this.fitStageToContainer(),this.konva.stage.on("wheel",this.onStageMouseWheel),this.konva.stage.on("dragmove",this.onStageDragMove),this.konva.stage.on("dragend",this.onStageDragEnd),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.subscriptions.add(()=>this.konva.stage.off("wheel",this.onStageMouseWheel)),this.subscriptions.add(()=>this.konva.stage.off("dragmove",this.onStageDragMove)),this.subscriptions.add(()=>this.konva.stage.off("dragend",this.onStageDragEnd)),this.subscriptions.add(this.manager.tool.$tool.listen(this.stopDragging))});j(this,"fitStageToContainer",()=>{this.log.trace("Fitting stage to container");const n=this.konva.stage.container().offsetWidth,s=this.konva.stage.container().offsetHeight;if(n===0||s===0)return;const o=this.konva.stage.width()===0||this.konva.stage.height()===0;this.konva.stage.width(n),this.konva.stage.height(s),this.syncStageAttrs(),o&&this.fitLayersToStage()});j(this,"fitBboxToStage",()=>{const{rect:n}=this.manager.stateApi.getBbox();this.log.trace({rect:n},"Fitting bbox to stage"),this.fitRect(n)});j(this,"fitLayersToStage",()=>{const n=this.manager.compositor.getVisibleRectOfType();n.width===0||n.height===0?this.fitBboxToStage():(this.log.trace({rect:n},"Fitting layers to stage"),this.fitRect(n))});j(this,"fitBboxAndLayersToStage",()=>{const n=this.manager.compositor.getVisibleRectOfType(),s=this.manager.stateApi.getBbox().rect,o=J2(n,s);this.log.trace({bboxRect:s,layersRect:n,unionRect:o},"Fitting bbox and layers to stage"),this.fitRect(o)});j(this,"fitRect",n=>{const{width:s,height:o}=this.getSize();if(s===0||o===0)return;const r=s-this.config.FIT_LAYERS_TO_STAGE_PADDING_PX*2,a=o-this.config.FIT_LAYERS_TO_STAGE_PADDING_PX*2,l=this.constrainScale(Math.min(Math.min(r/n.width,a/n.height),1)),d=Math.floor(-n.x*l+this.config.FIT_LAYERS_TO_STAGE_PADDING_PX+(r-n.width*l)/2),u=Math.floor(-n.y*l+this.config.FIT_LAYERS_TO_STAGE_PADDING_PX+(a-n.height*l)/2);this._intendedScale=l,this._activeSnapPoint=null;const h=new Re.Tween({node:this.konva.stage,duration:.15,x:d,y:u,scaleX:l,scaleY:l,easing:Re.Easings.EaseInOut,onUpdate:()=>{this.syncStageAttrs()},onFinish:()=>{this.syncStageAttrs(),h.destroy()}});h.play()});j(this,"getCenter",(n=!1)=>{const s=this.getScale(),{x:o,y:r}=this.getPosition(),{width:a,height:l}=this.getSize(),d={x:(a/2-o)/s,y:(l/2-r)/s};return n?this.konva.stage.getAbsoluteTransform().point(d):d});j(this,"constrainScale",n=>pr(n,this.config.MIN_SCALE,this.config.MAX_SCALE));j(this,"setScale",(n,s)=>{this.log.trace({scale:n},"Programmatically setting scale");const o=this.constrainScale(n);this._intendedScale=o,this._activeSnapPoint=null,this._applyScale(o,s)});j(this,"_applyScale",(n,s)=>{const o=this.getScale(),r=s??this.getCenter(!0),{x:a,y:l}=this.getPosition(),d=(r.x-a)/o,u=(r.y-l)/o,h=r.x-d*n,p=r.y-u*n;this.konva.stage.setAttrs({x:h,y:p,scaleX:n,scaleY:n}),this.syncStageAttrs()});j(this,"onStageMouseWheel",n=>{if(n.evt.preventDefault(),this._snapTimeout&&window.clearTimeout(this._snapTimeout),n.evt.ctrlKey||n.evt.metaKey)return;const s=this.konva.stage.getPointerPosition();if(!s)return;const o=n.evt.ctrlKey?-n.evt.deltaY:n.evt.deltaY,r=this._intendedScale*this.config.SCALE_FACTOR**o;this._intendedScale=this.constrainScale(r),this._updateScaleWithSnapping(s),this._snapTimeout=window.setTimeout(()=>{this._intendedScale=this.getScale()},100)});j(this,"_updateScaleWithSnapping",n=>{if(this._activeSnapPoint!==null){const s=this._activeSnapPoint*this.config.SCALE_SNAP_TOLERANCE;Math.abs(this._intendedScale-this._activeSnapPoint)>s&&(this._activeSnapPoint=null,this._applyScale(this._intendedScale,n));return}for(const s of this.config.SCALE_SNAP_POINTS){const o=s*this.config.SCALE_SNAP_TOLERANCE;if(Math.abs(this._intendedScale-s)<o){this._activeSnapPoint=s,this._applyScale(s,n);return}}this._applyScale(this._intendedScale,n)});j(this,"onStagePointerDown",n=>{n.evt.button===1&&this.startDragging()});j(this,"startDragging",()=>{this.setIsDraggable(!0),this.getIsDragging()||this.konva.stage.startDrag(),this.manager.tool.render()});j(this,"stopDragging",()=>{this.setIsDraggable(this.manager.tool.$tool.get()==="view"),this.getIsDragging()&&this.konva.stage.stopDrag(),this.manager.tool.render()});j(this,"onStageDragMove",n=>{n.target===this.konva.stage&&this.syncStageAttrs()});j(this,"onStageDragEnd",n=>{n.target===this.konva.stage&&this.stopDragging()});j(this,"getScale",()=>this.konva.stage.scaleX());j(this,"getPosition",()=>this.konva.stage.position());j(this,"unscale",n=>n/this.getScale());j(this,"setCursor",n=>{this.container.style.cursor!==n&&(this.container.style.cursor=n)});j(this,"syncStageAttrs",n=>{this.$stageAttrs.set({x:this.konva.stage.x(),y:this.konva.stage.y(),width:this.konva.stage.width(),height:this.konva.stage.height(),scale:this.konva.stage.scaleX(),...n})});j(this,"setIsDraggable",n=>{this.konva.stage.draggable(n)});j(this,"getIsDragging",()=>this.konva.stage.isDragging());j(this,"addLayer",n=>{this.konva.stage.add(n)});j(this,"getScaledStageRect",(n=!0)=>{const{x:s,y:o}=this.getPosition(),{width:r,height:a}=this.getSize(),l=this.getScale();return{x:n?Math.floor(-s/l):-s/l,y:n?Math.floor(-o/l):-o/l,width:n?Math.ceil(r/l):r/l,height:n?Math.ceil(a/l):a/l}});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$stageAttrs:this.$stageAttrs.get(),konva:{stage:xs(this.konva.stage)}}));j(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.resizeObserver&&this.resizeObserver.disconnect(),this.konva.stage.destroy()});this.id=Te("stage"),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.container=n,this.konva={stage:new Re.Stage({id:Te("konva_stage"),container:n})},this._intendedScale=this.konva.stage.scaleX()}getSize(){return this.konva.stage.size()}}class CSe extends Ut{constructor(n){super();j(this,"type","staging_area");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"subscriptions",new Set);j(this,"konva");j(this,"image");j(this,"selectedImage");j(this,"$shouldShowStagedImage",Le(!0));j(this,"$isStaging",Le(!1));j(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.$isStaging.set(this.manager.stateApi.runSelector(li))});j(this,"render",async()=>{var a,l;this.log.trace("Rendering staging area");const n=this.manager.stateApi.runSelector(iC),{x:s,y:o}=this.manager.stateApi.getBbox().rect,r=this.$shouldShowStagedImage.get();if(this.selectedImage=n.stagedImages[n.selectedStagedImageIndex]??null,this.konva.group.position({x:s,y:o}),this.selectedImage){const{imageDTO:d}=this.selectedImage,u=ic(d),h=(a=this.manager.progressImage.$lastProgressEvent.get())==null?void 0:a.session_id,p=()=>{var m;const f=(m=this.manager.progressImage.$lastProgressEvent.get())==null?void 0:m.session_id;h===f&&this.manager.progressImage.$lastProgressEvent.set(null)};this.image?this.image.isLoading||(this.image.state.image.image_name!==u.image_name?(await this.image.update({...this.image.state,image:u},!0),p()):this.image.isError&&p()):(this.image=new Ua({id:"staging-area-image",type:"image",image:u},this),await this.image.update(this.image.state,!0),this.konva.group.add(this.image.konva.group),p()),this.image.konva.group.visible(r)}else(l=this.image)==null||l.destroy(),this.image=null});j(this,"getNodes",()=>[this.konva.group]);j(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.image&&this.image.destroy();for(const n of this.getNodes())n.destroy()});j(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,selectedImage:this.selectedImage,$shouldShowStagedImage:this.$shouldShowStagedImage.get(),$isStaging:this.$isStaging.get(),image:((n=this.image)==null?void 0:n.repr())??null}});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Re.Group({name:`${this.type}:group`,listening:!1})},this.image=null,this.selectedImage=null,this.subscriptions.add(this.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(iC,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(li,(s,o)=>{this.$isStaging.set(s),s&&!o&&this.$shouldShowStagedImage.set(!0)}))}}const wSe=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],SSe=["top-left","top-right","bottom-left","bottom-right"],LM=[];class kSe extends Ut{constructor(n){super();j(this,"type","bbox");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"subscriptions",new Set);j(this,"konva");j(this,"$aspectRatioBuffer",Le(1));j(this,"syncCursorStyle",YP);j(this,"initialize",()=>{this.log.debug("Initializing module");const{width:n,height:s}=this.manager.stateApi.runSelector(vd).rect;this.$aspectRatioBuffer.set(n/s),this.render()});j(this,"render",()=>{const n=this.manager.tool.$tool.get(),{x:s,y:o,width:r,height:a}=this.manager.stateApi.runSelector(vd).rect;this.konva.group.listening(n==="bbox"&&!this.manager.$isBusy.get()),this.konva.proxyRect.setAttrs({x:s,y:o,width:r,height:a,scaleX:1,scaleY:1,listening:n==="bbox"}),this.syncOverlay();const l=this.manager.stateApi.runSelector(oc);this.konva.transformer.setAttrs({listening:n==="bbox",enabledAnchors:this.getEnabledAnchors(n,l)})});j(this,"getEnabledAnchors",(n,s)=>n!=="bbox"||s!=null&&s.base&&Cu.includes(s.base)?LM:wSe);j(this,"syncOverlay",()=>{const n=this.manager.stateApi.getSettings().bboxOverlay;if(this.konva.overlayGroup.visible(n),!n)return;const s=this.manager.stage.$stageAttrs.get();this.konva.overlayRect.setAttrs({x:-s.x/s.scale,y:-s.y/s.scale,width:s.width/s.scale,height:s.height/s.scale})});j(this,"onDragMove",()=>{const n=this.manager.stateApi.getPositionGridSize(),s=this.manager.stateApi.getBbox(),o={...s.rect,x:Yi(this.konva.proxyRect.x(),n),y:Yi(this.konva.proxyRect.y(),n)};this.konva.proxyRect.setAttrs(o),(s.rect.x!==o.x||s.rect.y!==o.y)&&this.manager.stateApi.setGenerationBbox(o)});j(this,"onTransform",()=>{const n=this.konva.transformer.getActiveAnchor();if(!n)return;const s=this.manager.stateApi.$altKey.get(),o=this.manager.stateApi.$ctrlKey.get(),r=this.manager.stateApi.$metaKey.get(),a=this.manager.stateApi.$shiftKey.get();let l=o||r?this.manager.stateApi.getBboxGridSize():64;this.manager.stateApi.$altKey.get()&&(l=l*2);let d=this.konva.proxyRect.x(),u=this.konva.proxyRect.y(),h=wg(this.konva.proxyRect.width()*this.konva.proxyRect.scaleX(),l),p=wg(this.konva.proxyRect.height()*this.konva.proxyRect.scaleY(),l);if(a&&SSe.includes(n)&&!s){let m=Math.sqrt(h*p*this.$aspectRatioBuffer.get()),g=m/this.$aspectRatioBuffer.get();m=wg(m,l),g=wg(g,l),n==="top-left"&&(d=d-(m-h),u=u-(g-p)),n==="top-right"&&(u=u-(g-p)),n==="bottom-left"&&(d=d-(m-h)),h=m,p=g}const f={x:Math.round(d),y:Math.round(u),width:h,height:p};this.konva.proxyRect.setAttrs({...f,scaleX:1,scaleY:1}),this.manager.stateApi.setGenerationBbox(f),a||this.$aspectRatioBuffer.set(f.width/f.height)});j(this,"onTransformEnd",()=>{this.$aspectRatioBuffer.set(this.konva.proxyRect.width()/this.konva.proxyRect.height())});j(this,"anchorStyleFunc",n=>{(n.hasName("top-center")||n.hasName("bottom-center"))&&(n.height(8),n.offsetY(4),n.width(30),n.offsetX(15)),(n.hasName("middle-left")||n.hasName("middle-right"))&&(n.height(30),n.offsetY(15),n.width(8),n.offsetX(4))});j(this,"fitToLayers",()=>{const n=this.manager.compositor.getVisibleRectOfType();if(n.height===0||n.width===0)return;const s=this.manager.stateApi.getBboxGridSize(),o=Vee(n,s);this.manager.stateApi.setGenerationBbox(o)});j(this,"anchorDragBoundFunc",(n,s)=>{const o=this.konva.transformer.getStage();ve(o,"Stage must exist");const a=(this.manager.stateApi.$ctrlKey.get()||this.manager.stateApi.$metaKey.get()?this.manager.stateApi.getBboxGridSize():64)*o.scaleX(),l=o.getAbsolutePosition(),d=l.x%a,u=l.y%a;return{x:Yi(s.x,a)+d,y:Yi(s.y,a)+u}});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,aspectRatioBuffer:this.$aspectRatioBuffer.get(),konva:{group:xs(this.konva.group),proxyRect:xs(this.konva.proxyRect),transformer:xs(this.konva.transformer)}}));j(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating bbox module"),this.konva={group:new Re.Group({name:`${this.type}:group`,listening:!1}),proxyRect:new Re.Rect({name:`${this.type}:rect`,listening:!1,strokeEnabled:!0,draggable:!0,stroke:"rgb(42,42,42)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1}),overlayGroup:new Re.Group({name:`${this.type}:overlayGroup`,listening:!1,clipFunc:s=>{const o=this.manager.stage.getScaledStageRect(),r=this.manager.stateApi.runSelector(vd).rect;s.beginPath(),s.moveTo(o.x,o.y),s.lineTo(o.x+o.width,o.y),s.lineTo(o.x+o.width,o.y+o.height),s.lineTo(o.x,o.y+o.height),s.closePath(),s.moveTo(r.x,r.y),s.lineTo(r.x,r.y+r.height),s.lineTo(r.x+r.width,r.y+r.height),s.lineTo(r.x+r.width,r.y),s.closePath()}}),overlayRect:new Re.Rect({name:`${this.type}:overlay`,listening:!1,strokeEnabled:!1,draggable:!1,fill:"hsl(220 12% 10% / 0.8)",perfectDrawEnabled:!1}),transformer:new Re.Transformer({listening:!1,name:`${this.type}:transformer`,borderDash:[5,5],borderStroke:"rgba(212,216,234,1)",borderEnabled:!0,borderStrokeWidth:1,rotateEnabled:!1,keepRatio:!1,ignoreStroke:!0,flipEnabled:!1,anchorFill:"rgba(212,216,234,1)",anchorStroke:"rgb(42,42,42)",anchorSize:12,anchorCornerRadius:3,shiftBehavior:"none",centeredScaling:!1,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc})},this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.transformer.on("transform",this.onTransform),this.konva.transformer.on("transformend",this.onTransformEnd),this.subscriptions.add(()=>{this.konva.proxyRect.off("dragmove pointerenter pointerleave"),this.konva.transformer.off("transform transformend")}),this.konva.transformer.nodes([this.konva.proxyRect]),this.konva.overlayGroup.add(this.konva.overlayRect),this.konva.group.add(this.konva.overlayGroup),this.konva.group.add(this.konva.proxyRect),this.konva.group.add(this.konva.transformer),this.subscriptions.add(this.parent.$tool.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(vd,this.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncOverlay)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(ZP,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(oc,this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render))}}const jSe={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",HIDE_FILL_TIMEOUT_MS:1500};class _Se extends Ut{constructor(n){super();j(this,"type","brush_tool");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"config",jSe);j(this,"hideFillTimeoutId",null);j(this,"konva");j(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});j(this,"render",()=>{if(this.parent.$tool.get()!=="brush"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}const s=this.parent.$isPrimaryPointerDown.get(),o=this.parent.$lastPointerType.get();if(o!=="mouse"&&s){this.setVisibility(!1);return}this.setVisibility(!0),this.hideFillTimeoutId!==null&&(window.clearTimeout(this.hideFillTimeoutId),this.hideFillTimeoutId=null);const r=this.manager.stateApi.getSettings(),a=this.manager.stateApi.getBrushPreviewColor(),l=Gr(n.relative,r.brushWidth),d=r.brushWidth/2;this.konva.fillCircle.setAttrs({x:l.x,y:l.y,radius:d,fill:ea(a),visible:!s&&o==="mouse"});const u=this.manager.stage.unscale(1),h=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:d,outerRadius:d+u}),this.konva.outerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:d+u,outerRadius:d+h}),this.hideFillTimeoutId=window.setTimeout(()=>{this.konva.fillCircle.visible(!1),this.hideFillTimeoutId=null},this.config.HIDE_FILL_TIMEOUT_MS)});j(this,"setVisibility",n=>{this.konva.group.visible(n)});j(this,"onStagePointerEnter",async n=>{const s=this.parent.$cursorPos.get(),o=this.parent.$isPrimaryPointerDown.get(),r=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!r)return;const a=this.manager.stateApi.getSettings(),l=ir(s.relative,r.state.position),d=Gr(l,a.brushWidth);n.evt.pointerType==="pen"&&a.pressureSensitivity?await r.bufferRenderer.setBuffer({id:Te("brush_line_with_pressure"),type:"brush_line_with_pressure",points:[d.x,d.y,n.evt.pressure],strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(r.state)}):await r.bufferRenderer.setBuffer({id:Te("brush_line"),type:"brush_line",points:[d.x,d.y],strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(r.state)})});j(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),o=this.parent.$isPrimaryPointerDown.get(),r=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!r||!o)return;r.bufferRenderer.hasBuffer()&&r.bufferRenderer.commitBuffer();const a=this.manager.stateApi.getSettings(),l=ir(s.relative,r.state.position),d=Gr(l,a.brushWidth);if(n.evt.pointerType==="pen"&&a.pressureSensitivity){const u=XP(r.state.objects,"brush_line_with_pressure");let h,p=!1;n.evt.shiftKey&&u?(p=!0,h=[u.x,u.y,u.pressure,d.x,d.y,n.evt.pressure]):h=[d.x,d.y,n.evt.pressure],await r.bufferRenderer.setBuffer({id:Te("brush_line_with_pressure"),type:"brush_line_with_pressure",points:h,strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:p&&!a.clipToBbox?null:this.parent.getClip(r.state)})}else{const u=QP(r.state.objects,"brush_line");let h,p=!1;n.evt.shiftKey&&u?(p=!0,h=[u.x,u.y,d.x,d.y]):h=[d.x,d.y],await r.bufferRenderer.setBuffer({id:Te("brush_line"),type:"brush_line",points:h,strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:p&&!a.clipToBbox?null:this.parent.getClip(r.state)})}});j(this,"onStagePointerUp",n=>{var o,r;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&((((o=s.bufferRenderer.state)==null?void 0:o.type)==="brush_line"||((r=s.bufferRenderer.state)==null?void 0:r.type)==="brush_line_with_pressure")&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});j(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const o=this.manager.stateApi.getSelectedEntityAdapter();if(!o)return;const r=o.bufferRenderer.state;if(!r||r.type!=="brush_line"&&r.type!=="brush_line_with_pressure")return;const a=this.manager.stateApi.getSettings(),l=JP(r.points),d=a.brushWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!l||!eL(s.relative,l,d))return;const u=ir(s.relative,o.state.position),h=Gr(u,a.brushWidth);l.x===h.x&&l.y===h.y||(r.points.push(h.x,h.y),r.type==="brush_line_with_pressure"&&a.pressureSensitivity&&r.points.push(n.evt.pressure),await o.bufferRenderer.setBuffer(r))});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));j(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Re.Group({name:`${this.type}:brush_group`,listening:!1}),fillCircle:new Re.Circle({name:`${this.type}:brush_fill_circle`,listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1}),innerBorder:new Re.Ring({name:`${this.type}:brush_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Re.Ring({name:`${this.type}:brush_outer_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.fillCircle,this.konva.innerBorder,this.konva.outerBorder)}}const ISe={RING_INNER_RADIUS:25,RING_OUTER_RADIUS:35,RING_BORDER_INNER_COLOR:"rgba(0,0,0,1)",RING_BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",CROSSHAIR_INNER_RADIUS:5,CROSSHAIR_LINE_THICKNESS:1.5,CROSSHAIR_LINE_BORDER_THICKNESS:.75,CROSSHAIR_LINE_LENGTH:10,CROSSHAIR_LINE_COLOR:"rgba(0,0,0,1)",CROSSHAIR_BORDER_COLOR:"rgba(255,255,255,0.8)",TEXT_COLOR:"rgba(255,255,255,1)",TEXT_BG_COLOR:"rgba(0,0,0,0.8)",TEXT_BG_HEIGHT:62,TEXT_BG_WIDTH:62,TEXT_BG_CORNER_RADIUS:7,TEXT_PADDING:8,TEXT_FONT_SIZE:12,TEXT_BG_X_OFFSET:7};class TSe extends Ut{constructor(n){super();j(this,"type","color_picker_tool");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"config",ISe);j(this,"$colorUnderCursor",Le(tL));j(this,"konva");j(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});j(this,"render",()=>{if(this.parent.$tool.get()!=="colorPicker"){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}this.setVisibility(!0);const{x:s,y:o}=n.relative,r=this.manager.stateApi.getSettings(),a=this.$colorUnderCursor.get(),l=this.manager.stage.unscale(this.config.RING_INNER_RADIUS),d=this.manager.stage.unscale(this.config.RING_OUTER_RADIUS),u=this.manager.stage.unscale(1),h=this.manager.stage.unscale(2);this.konva.ringCandidateColor.setAttrs({x:s,y:o,fill:lc(a),innerRadius:l,outerRadius:d}),this.konva.ringCurrentColor.setAttrs({x:s,y:o,fill:lc(r.color),innerRadius:l,outerRadius:d}),this.konva.ringInnerBorder.setAttrs({x:s,y:o,innerRadius:d,outerRadius:d+u}),this.konva.ringOuterBorder.setAttrs({x:s,y:o,innerRadius:d+u,outerRadius:d+h});const p=this.manager.stage.unscale(this.config.TEXT_BG_WIDTH),f=this.manager.stage.unscale(this.config.TEXT_BG_HEIGHT);this.konva.rgbaTextBackground.setAttrs({width:p,height:f,cornerRadius:this.manager.stage.unscale(this.config.TEXT_BG_CORNER_RADIUS)}),this.konva.rgbaText.setAttrs({padding:this.manager.stage.unscale(this.config.TEXT_PADDING),fontSize:this.manager.stage.unscale(this.config.TEXT_FONT_SIZE),text:`R: ${a.r}
G: ${a.g}
B: ${a.b}
A: ${a.a}`}),this.konva.rgbaTextGroup.setAttrs({x:s+this.manager.stage.unscale(this.config.RING_OUTER_RADIUS+this.config.TEXT_BG_X_OFFSET),y:o-f/2});const m=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_LENGTH),g=this.manager.stage.unscale(this.config.CROSSHAIR_INNER_RADIUS),x=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS),b=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS+this.config.CROSSHAIR_LINE_BORDER_THICKNESS*2);this.konva.crosshairNorthOuter.setAttrs({strokeWidth:b,points:[s,o-m,s,o-g]}),this.konva.crosshairNorthInner.setAttrs({strokeWidth:x,points:[s,o-m,s,o-g]}),this.konva.crosshairEastOuter.setAttrs({strokeWidth:b,points:[s+g,o,s+m,o]}),this.konva.crosshairEastInner.setAttrs({strokeWidth:x,points:[s+g,o,s+m,o]}),this.konva.crosshairSouthOuter.setAttrs({strokeWidth:b,points:[s,o+g,s,o+m]}),this.konva.crosshairSouthInner.setAttrs({strokeWidth:x,points:[s,o+g,s,o+m]}),this.konva.crosshairWestOuter.setAttrs({strokeWidth:b,points:[s-g,o,s-m,o]}),this.konva.crosshairWestInner.setAttrs({strokeWidth:x,points:[s-g,o,s-m,o]})});j(this,"setVisibility",n=>{this.konva.group.visible(n)});j(this,"onStagePointerUp",n=>{const s=this.$colorUnderCursor.get();this.manager.stateApi.setColor({...s,a:s.a/255})});j(this,"onStagePointerMove",n=>{this.syncColorUnderCursor()});j(this,"syncColorUnderCursor",$$(()=>{const n=this.parent.$cursorPos.get();if(!n)return;this.manager.background.konva.layer.visible(!1);const s=zee(this.manager.stage.konva.stage,n.absolute);this.manager.background.konva.layer.visible(!0),s&&this.$colorUnderCursor.set(s)}));j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$colorUnderCursor:this.$colorUnderCursor.get()}));j(this,"destroy",()=>{this.log.debug("Destroying color picker tool preview module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Re.Group({name:`${this.type}:color_picker_group`,listening:!1}),ringCandidateColor:new Re.Ring({listening:!1,name:`${this.type}:color_picker_candidate_color_ring`,innerRadius:0,outerRadius:0,strokeEnabled:!1,perfectDrawEnabled:!1}),ringCurrentColor:new Re.Arc({listening:!1,name:`${this.type}:color_picker_current_color_arc`,innerRadius:0,outerRadius:0,angle:180,strokeEnabled:!1,perfectDrawEnabled:!1}),ringInnerBorder:new Re.Ring({listening:!1,name:`${this.type}:color_picker_inner_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),ringOuterBorder:new Re.Ring({listening:!1,name:`${this.type}:color_picker_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),crosshairNorthInner:new Re.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairNorthOuter:new Re.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairEastInner:new Re.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairEastOuter:new Re.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairSouthInner:new Re.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairSouthOuter:new Re.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairWestInner:new Re.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairWestOuter:new Re.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),rgbaTextGroup:new Re.Group({listening:!1,name:`${this.type}:color_picker_text_group`}),rgbaText:new Re.Text({listening:!1,name:`${this.type}:color_picker_text`,fill:this.config.TEXT_COLOR,fontFamily:"monospace",align:"left",fontStyle:"bold",verticalAlign:"middle"}),rgbaTextBackground:new Re.Rect({listening:!1,name:`${this.type}:color_picker_text_background`,fill:this.config.TEXT_BG_COLOR})},this.konva.rgbaTextGroup.add(this.konva.rgbaTextBackground,this.konva.rgbaText),this.konva.group.add(this.konva.ringCandidateColor,this.konva.ringCurrentColor,this.konva.ringInnerBorder,this.konva.ringOuterBorder,this.konva.crosshairNorthOuter,this.konva.crosshairNorthInner,this.konva.crosshairEastOuter,this.konva.crosshairEastInner,this.konva.crosshairSouthOuter,this.konva.crosshairSouthInner,this.konva.crosshairWestOuter,this.konva.crosshairWestInner,this.konva.rgbaTextGroup)}}const ASe={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)"};class MSe extends Ut{constructor(n){super();j(this,"type","eraser_tool");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"config",ASe);j(this,"konva");j(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});j(this,"render",()=>{if(this.parent.$tool.get()!=="eraser"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}const s=this.parent.$isPrimaryPointerDown.get();if(this.parent.$lastPointerType.get()!=="mouse"&&s){this.setVisibility(!1);return}this.setVisibility(!0);const r=this.manager.stateApi.getSettings(),a=Gr(n.relative,r.eraserWidth),l=r.eraserWidth/2;this.konva.cutoutCircle.setAttrs({x:a.x,y:a.y,radius:l});const d=this.manager.stage.unscale(1),u=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:l,outerRadius:l+d}),this.konva.outerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:l+d,outerRadius:l+u})});j(this,"setVisibility",n=>{this.konva.group.visible(n)});j(this,"onStagePointerEnter",async n=>{const s=this.parent.$cursorPos.get(),o=this.parent.$isPrimaryPointerDown.get(),r=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!r)return;const a=this.manager.stateApi.getSettings(),l=ir(s.relative,r.state.position),d=Gr(l,a.brushWidth);n.evt.pointerType==="pen"&&a.pressureSensitivity?await r.bufferRenderer.setBuffer({id:Te("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:[d.x,d.y,n.evt.pressure],strokeWidth:a.eraserWidth,clip:this.parent.getClip(r.state)}):await r.bufferRenderer.setBuffer({id:Te("eraser_line"),type:"eraser_line",points:[d.x,d.y],strokeWidth:a.eraserWidth,clip:this.parent.getClip(r.state)})});j(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),o=this.parent.$isPrimaryPointerDown.get(),r=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!r||!o)return;const a=this.manager.stateApi.getSettings(),l=ir(s.relative,r.state.position);if(n.evt.pointerType==="pen"&&a.pressureSensitivity){const d=XP(r.state.objects,"eraser_line_with_pressure"),u=Gr(l,a.eraserWidth);r.bufferRenderer.hasBuffer()&&r.bufferRenderer.commitBuffer();let h;n.evt.shiftKey&&d?h=[d.x,d.y,d.pressure,u.x,u.y,n.evt.pressure]:h=[u.x,u.y,n.evt.pressure],await r.bufferRenderer.setBuffer({id:Te("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:h,strokeWidth:a.eraserWidth,clip:this.parent.getClip(r.state)})}else{const d=QP(r.state.objects,"eraser_line"),u=Gr(l,a.eraserWidth);r.bufferRenderer.hasBuffer()&&r.bufferRenderer.commitBuffer();let h;n.evt.shiftKey&&d?h=[d.x,d.y,u.x,u.y]:h=[u.x,u.y],await r.bufferRenderer.setBuffer({id:Te("eraser_line"),type:"eraser_line",points:h,strokeWidth:a.eraserWidth,clip:this.parent.getClip(r.state)})}});j(this,"onStagePointerUp",n=>{var o,r;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&((((o=s.bufferRenderer.state)==null?void 0:o.type)==="eraser_line"||((r=s.bufferRenderer.state)==null?void 0:r.type)==="eraser_line_with_pressure")&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});j(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const o=this.manager.stateApi.getSelectedEntityAdapter();if(!o)return;const r=o.bufferRenderer.state;if(!r||r.type!=="eraser_line"&&r.type!=="eraser_line_with_pressure")return;const a=this.manager.stateApi.getSettings(),l=JP(r.points),d=a.eraserWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!l||!eL(s.relative,l,d))return;const u=ir(s.relative,o.state.position),h=Gr(u,a.eraserWidth);l.x===h.x&&l.y===h.y||(r.points.push(h.x,h.y),r.type==="eraser_line_with_pressure"&&a.pressureSensitivity&&r.points.push(n.evt.pressure),await o.bufferRenderer.setBuffer(r))});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));j(this,"destroy",()=>{this.log.debug("Destroying eraser tool preview module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Re.Group({name:`${this.type}:eraser_group`,listening:!1}),cutoutCircle:new Re.Circle({name:`${this.type}:eraser_cutout_circle`,listening:!1,strokeEnabled:!1,fill:"white",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1}),innerBorder:new Re.Ring({name:`${this.type}:eraser_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Re.Ring({listening:!1,name:`${this.type}:eraser_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.cutoutCircle,this.konva.innerBorder,this.konva.outerBorder)}}const ESe={NUDGE_PX:1};class PSe extends Ut{constructor(n){super();j(this,"type","move_tool");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"config",ESe);j(this,"nudgeOffsets");j(this,"syncCursorStyle",()=>{const n=this.manager.stateApi.getSelectedEntityAdapter();n?n.transformer.syncCursorStyle():this.manager.stage.setCursor("not-allowed")});j(this,"nudge",n=>{if(ym.get()!=="canvas")return;const s=this.manager.stateApi.getSelectedEntityAdapter();if(!s||s.$isDisabled.get()||s.$isEmpty.get()||s.$isLocked.get()||s.$isEntityTypeHidden.get())return;const o=this.manager.$isBusy.get(),r=this.parent.$tool.get()==="move",a=this.manager.stateApi.$transformingAdapter.get()===s;if(o){if(!a)return}else if(!r)return;const l=this.nudgeOffsets[n];s.transformer.nudgeBy(l)});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.nudgeOffsets={ArrowLeft:{x:-this.config.NUDGE_PX,y:0},ArrowRight:{x:this.config.NUDGE_PX,y:0},ArrowUp:{x:0,y:-this.config.NUDGE_PX},ArrowDown:{x:0,y:this.config.NUDGE_PX}}}isNudgeKey(n){return this.nudgeOffsets[n]!==void 0}}class LSe extends Ut{constructor(n){super();j(this,"type","rect_tool");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("crosshair")});j(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),o=this.parent.$isPrimaryPointerDown.get(),r=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!r)return;const a=ir(s.relative,r.state.position);await r.bufferRenderer.setBuffer({id:Te("rect"),type:"rect",rect:{x:Math.round(a.x),y:Math.round(a.y),width:0,height:0},color:this.manager.stateApi.getCurrentColor()})});j(this,"onStagePointerUp",n=>{var o;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&(((o=s.bufferRenderer.state)==null?void 0:o.type)==="rect"&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});j(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const o=this.manager.stateApi.getSelectedEntityAdapter();if(!o)return;const r=o.bufferRenderer.state;if(!r||r.type!=="rect")return;const a=ir(s.relative,o.state.position),l=Gee(a);r.rect.width=Math.round(l.x-r.rect.x),r.rect.height=Math.round(l.y-r.rect.y),await o.bufferRenderer.setBuffer(r)});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}}class DSe extends Ut{constructor(n){super();j(this,"type","view_tool");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"syncCursorStyle",()=>{this.manager.stage.setCursor(this.manager.stage.getIsDragging()?"grabbing":"grab")});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}}Re.dragButtons=[0];const RSe="Escape",DM=" ",RM="Alt",OSe={BRUSH_SPACING_TARGET_SCALE:.1};class NSe extends Ut{constructor(n){super();j(this,"type","tool");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"subscriptions",new Set);j(this,"config",OSe);j(this,"tools");j(this,"$tool",Le("brush"));j(this,"$toolBuffer",Le(null));j(this,"$isPrimaryPointerDown",Le(!1));j(this,"$cursorPos",Le(null));j(this,"$lastPointerType",Le(null));j(this,"konva");j(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.syncCursorStyle()});j(this,"syncCursorStyle",()=>{const n=this.manager.stage,s=this.$tool.get(),o=this.manager.stateApi.$segmentingAdapter.get(),r=this.manager.stateApi.$transformingAdapter.get(),a=this.manager.stateApi.getSelectedEntityAdapter();this.manager.stage.getIsDragging()?this.tools.view.syncCursorStyle():s==="view"?this.tools.view.syncCursorStyle():o?o.segmentAnything.syncCursorStyle():r?r.transformer.syncCursorStyle():this.manager.stateApi.$isFiltering.get()||this.manager.stagingArea.$isStaging.get()?n.setCursor("not-allowed"):s==="bbox"?this.tools.bbox.syncCursorStyle():s==="colorPicker"?this.tools.colorPicker.syncCursorStyle():a&&oC(a.entityIdentifier.type)?a.$isDisabled.get()||a.$isEntityTypeHidden.get()||a.$isLocked.get()?n.setCursor("not-allowed"):s==="brush"?this.tools.brush.syncCursorStyle():s==="eraser"?this.tools.eraser.syncCursorStyle():s==="move"?this.tools.move.syncCursorStyle():s==="rect"&&this.tools.rect.syncCursorStyle():(this.manager.stateApi.getRenderedEntityCount(),n.setCursor("not-allowed"))});j(this,"render",()=>{this.syncCursorStyle(),this.tools.brush.render(),this.tools.eraser.render(),this.tools.colorPicker.render(),this.tools.bbox.render()});j(this,"syncCursorPositions",()=>{const n=this.konva.stage.getRelativePointerPosition(),s=this.konva.stage.getPointerPosition();!n||!s||this.$cursorPos.set({relative:n,absolute:s})});j(this,"getClip",n=>{if(this.manager.stateApi.getSettings().clipToBbox){const{x:o,y:r,width:a,height:l}=this.manager.stateApi.getBbox().rect;return{x:o-n.position.x,y:r-n.position.y,width:a,height:l}}else{const{x:o,y:r}=this.manager.stage.getPosition(),a=this.manager.stage.getScale(),{width:l,height:d}=this.manager.stage.getSize();return{x:-o/a-n.position.x,y:-r/a-n.position.y,width:l/a,height:d/a}}});j(this,"setEventListeners",()=>(this.konva.stage.on("pointerenter",this.onStagePointerEnter),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.konva.stage.on("pointerup",this.onStagePointerUp),this.konva.stage.on("pointermove",this.onStagePointerMove),this.manager.stage.container.addEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.on("wheel",this.onStageMouseWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("pointerup",this.onWindowPointerUp),window.addEventListener("blur",this.onWindowBlur),()=>{this.konva.stage.off("pointerenter",this.onStagePointerEnter),this.konva.stage.off("pointerdown",this.onStagePointerDown),this.konva.stage.off("pointerup",this.onStagePointerUp),this.konva.stage.off("pointermove",this.onStagePointerMove),this.manager.stage.container.removeEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.off("wheel",this.onStageMouseWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("pointerup",this.onWindowPointerUp),window.removeEventListener("blur",this.onWindowBlur)}));j(this,"getCanDraw",()=>{if(this.manager.stateApi.getRenderedEntityCount()===0||this.manager.$isBusy.get()||this.manager.stage.getIsDragging())return!1;const n=this.manager.stateApi.getSelectedEntityAdapter();return!(!n||n.$isDisabled.get()||n.$isEntityTypeHidden.get()||n.$isLocked.get())});j(this,"onStagePointerEnter",async n=>{var s;try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.syncCursorPositions();const o=this.$tool.get(),r=this.manager.stateApi.getSelectedEntityAdapter();if(((s=r==null?void 0:r.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&(r!=null&&r.bufferRenderer.hasBuffer())){r.bufferRenderer.commitBuffer();return}o==="brush"?await this.tools.brush.onStagePointerEnter(n):o==="eraser"&&await this.tools.eraser.onStagePointerEnter(n)}finally{this.render()}});j(this,"onStagePointerDown",async n=>{if(n.target===this.konva.stage)try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.$isPrimaryPointerDown.set(Hee(n)),this.syncCursorPositions();const s=this.$tool.get();s==="brush"?await this.tools.brush.onStagePointerDown(n):s==="eraser"?await this.tools.eraser.onStagePointerDown(n):s==="rect"&&await this.tools.rect.onStagePointerDown(n)}finally{this.render()}});j(this,"onStagePointerUp",n=>{if(n.target===this.konva.stage)try{this.$lastPointerType.set(n.evt.pointerType);const s=this.$tool.get();if(s==="colorPicker"&&this.tools.colorPicker.onStagePointerUp(n),!this.getCanDraw())return;s==="brush"?this.tools.brush.onStagePointerUp(n):s==="eraser"?this.tools.eraser.onStagePointerUp(n):s==="rect"&&this.tools.rect.onStagePointerUp(n)}finally{this.render()}});j(this,"onStagePointerMove",async n=>{var s;if(n.target===this.konva.stage)try{this.$lastPointerType.set(n.evt.pointerType),this.syncCursorPositions();const o=this.$tool.get();if(o==="colorPicker"&&this.tools.colorPicker.onStagePointerMove(n),!this.getCanDraw())return;o==="brush"?await this.tools.brush.onStagePointerMove(n):o==="eraser"?await this.tools.eraser.onStagePointerMove(n):o==="rect"?await this.tools.rect.onStagePointerMove(n):(s=this.manager.stateApi.getSelectedEntityAdapter())==null||s.bufferRenderer.clearBuffer()}finally{this.render()}});j(this,"onStagePointerLeave",n=>{var s;if(n.target===this.manager.stage.container)try{if(this.$lastPointerType.set(n.pointerType),this.$cursorPos.set(null),!this.getCanDraw())return;const o=this.manager.stateApi.getSelectedEntityAdapter();o&&((s=o.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer()}finally{this.render()}});j(this,"onStageMouseWheel",n=>{if(n.target!==this.konva.stage||!this.getCanDraw()||(n.evt.preventDefault(),!n.evt.ctrlKey&&!n.evt.metaKey))return;const s=this.manager.stateApi.getSettings(),o=this.$tool.get();let r=n.evt.deltaY;s.invertScrollForToolWidth&&(r=-r),o==="brush"?this.manager.stateApi.setBrushWidth(B4(s.brushWidth,r)):o==="eraser"&&this.manager.stateApi.setEraserWidth(B4(s.eraserWidth,r)),this.render()});j(this,"onWindowPointerUp",n=>{try{this.$isPrimaryPointerDown.set(!1);const s=this.manager.stateApi.getSelectedEntityAdapter();s&&s.bufferRenderer.hasBuffer()&&!this.manager.$isBusy.get()&&s.bufferRenderer.commitBuffer()}finally{this.render()}});j(this,"onWindowBlur",()=>{this.revertToolBuffer()});j(this,"onKeyDown",n=>{var s;if(!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)&&(this.tools.move.isNudgeKey(n.key)&&this.tools.move.nudge(n.key),!n.repeat)){if(n.key===RSe){n.preventDefault();const o=this.manager.stateApi.getSelectedEntityAdapter();o&&!((s=o.filterer)!=null&&s.$isFiltering.get())&&!o.transformer.$isTransforming.get()&&o.bufferRenderer.hasBuffer()&&o.bufferRenderer.clearBuffer();return}if(n.key===DM){n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("view"),this.manager.stateApi.$spaceKey.set(!0),this.$cursorPos.set(null);return}n.key===RM&&(n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("colorPicker"))}});j(this,"onKeyUp",n=>{if(!n.repeat&&!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)){if(n.key===DM){n.preventDefault(),this.revertToolBuffer(),this.manager.stateApi.$spaceKey.set(!1);return}if(n.key===RM){n.preventDefault(),this.revertToolBuffer();return}}});j(this,"revertToolBuffer",()=>{const n=this.$toolBuffer.get();n&&(this.$tool.set(n),this.$toolBuffer.set(null))});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$tool:this.$tool.get(),$toolBuffer:this.$toolBuffer.get(),$isPrimaryPointerDown:this.$isPrimaryPointerDown.get(),$cursorPos:this.$cursorPos.get(),$lastPointerType:this.$lastPointerType.get(),tools:{brush:this.tools.brush.repr(),eraser:this.tools.eraser.repr(),colorPicker:this.tools.colorPicker.repr(),rect:this.tools.rect.repr(),bbox:this.tools.bbox.repr(),view:this.tools.view.repr(),move:this.tools.move.repr()}}));j(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating tool module"),this.tools={brush:new _Se(this),eraser:new MSe(this),rect:new LSe(this),colorPicker:new TSe(this),bbox:new kSe(this),view:new DSe(this),move:new PSe(this)},this.konva={stage:this.manager.stage.konva.stage,group:new Re.Group({name:`${this.type}:group`,listening:!0})},this.konva.group.add(this.tools.brush.konva.group),this.konva.group.add(this.tools.eraser.konva.group),this.konva.group.add(this.tools.colorPicker.konva.group),this.konva.group.add(this.tools.bbox.konva.group),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(cl,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ye,this.render)),this.subscriptions.add(this.$tool.listen(()=>{this.manager.tool.$isPrimaryPointerDown.set(!1),this.render()}));const s=this.setEventListeners();this.subscriptions.add(s)}}class FSe extends Ut{constructor(n){super();j(this,"type","worker");j(this,"id");j(this,"path");j(this,"log");j(this,"parent");j(this,"manager");j(this,"worker",new Worker(new URL(""+new URL("worker-Dywf1EVc.js",import.meta.url).href,import.meta.url),{type:"module",name:"worker"}));j(this,"tasks",new Map);j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,tasks:Array.from(this.tasks.keys())}));j(this,"destroy",()=>{this.log.trace("Destroying worker module"),this.worker.terminate(),this.tasks.clear()});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.worker.onmessage=s=>{const{type:o,data:r}=s.data;if(o==="log")r.ctx?this.log[r.level](r.ctx,r.message):this.log[r.level](r.message);else if(o==="extents"){const a=this.tasks.get(r.id);if(!a)return;a.onComplete(r.extents),this.tasks.delete(r.id)}},this.worker.onerror=s=>{this.log.error({message:s.message},"Worker error")},this.worker.onmessageerror=()=>{this.log.error("Worker message error")}}requestBbox(n,s){const o=Te("bbox_calculation"),r={type:"get_bbox",data:{...n,id:o}};this.tasks.set(o,{task:r,onComplete:s}),this.worker.postMessage(r,[n.buffer])}}const Wu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAFwWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDktMTNUMjA6NTM6MTMrMTAwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyNC0wOS0xM1QyMDo1MzoxMysxMDAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0iR2VuZXJpYyBSR0IgUHJvZmlsZSIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjIwIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjAiCiAgIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI5Ni8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI5Ni8xIj4KICAgPGRjOnRpdGxlPgogICAgPHJkZjpBbHQ+CiAgICAgPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij50cmFuc3BhcmVudF9iZ19kYXJrPC9yZGY6bGk+CiAgICA8L3JkZjpBbHQ+CiAgIDwvZGM6dGl0bGU+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InByb2R1Y2VkIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZmZpbml0eSBQaG90byAyIDIuNS41IgogICAgICBzdEV2dDp3aGVuPSIyMDI0LTA5LTEzVDIxOjE4OjQwKzEwOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5YzHPhAAAETGlDQ1BHZW5lcmljIFJHQiBQcm9maWxlAABIic1VXWgcVRQ+m7m7CSSOUmNTU0kHtTaENExSqRtqo/uXZNu4WTbZtA0Fncze3Zlm9seZ2dSWYiEI/rwYFXxVq4IPBZ8K8T8FMSJKCyVKMIiCYOsfhUpfNKznzp3dnaRZ9dE73JnvnvPdc+8958y5AC3PGWreapIA8gXbTI2EpaPHpqXmVWiCu6EVOqFVUa1SKJkcA2xKqWTALe3m1+Bj3yt7ma1b9f/YWjPUUgF8Ldj7MpaaB2gKAvhfUEumDdD8KXKCJ+0Sw38hbjdxgwAtdzCc4/h+hmc4DjqcyVQEMduzqGpKBvFxxL0zHnnOg/kenNY+QgvU1FWJ+SJpFrO6Qat7bYcRoFDAboIOKkiQQkkYv0mUFCGLUgMo/O/aMsz/1Jd9vufo8J1HfB754u37fWysWjTDxku7+Vg+ew7gCYB3BM5bevjsFJO3uJPzRrnqr13Y26zZicP47cYYPpNRogxjTHznVSU24eLLc/pUwsV/lOxwCvEDGOsd5dl0CHEP4qGsOZzmdpo0rTxaxQuntckjiLchXpwtHmZztyP+ojCTGHftfK9aEYw/3AsgBDQaZ3HtQtxtFlPjfF1hOEOjMcS9iE/odnyS2xdeteYmYlU7p7VIgq8lfHxCOZRE3In4MjVGUq79n0t20l2XtBWMxBi3Qwao5ZzXkdva5Chfl0zbmJB8Lnk6qw/HXf7rmjmacvHnJcP5x3Bv5LpZTqU5338PLaRdm/4hxYyNuDgDUz4Fc60IM/hWMSvXPflY8uRjPWcpjqqcvRs4SUfPcd1Kzpl51c32SNfbUEapBr+iVPPwIjgqoyzXwA7fwTXXTpF0EJnsw36AjJGDJEgGQSKPkEfJEImidJAcqM31/ldsP9dqdp7EFanDm0LeRdTboOD7B2QUwdraFwud5W4unzcf19VLL15fPvPhjjp3hSwev9K2fGbDf27BbAOvjf+b7/0/+q/6V/C96l+rM/zf+tfwWd10uo1er9aYEOoMR5bHrjsay7Of5IYo1nGxocVitrDQyXXMA/TZxM0EzPfW+fI38m/yivyG/Jb8i/CKcEH4SHhPeF/4EiRhSbgofCJ8JrwrfOCJUePcqcXcOUf1FEyzlUcxP8WwuFO8T4yKu8Td4ljdntgh9ouj4h7U7KxFx7ue9+w6HHPqMPfW1mtxnifOvtswznqDfyiNLB1OOkzLybMCnNrEcWeSLtJP4puyOshyvWb7P90igVggGgiBFOgJDAb6A4cYrjIDe1A3iG+sWjZ9ymaFOFIsnTL1nGZLA7L8kBTCq5pK8YLa1ysphiE5KksyqUXNOZrpA3bP8xJ+I+Xc377tl+oy+zGAg7+zuleXTZcBzuP93vFgXdaNtfGu1/Am2a+WzTn3TvD5vgKwsvsG+KgtjPXqu0rlBtat5pcB1l+qVP48V6msv4n21/B2Mf4GjzuDirebG+gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAsSURBVDiNYxSTkGXADdg5OPDIMuGRIwhGNY8MzSz409DPHz9oZfOo5pGhGQABmwOMaHIlKQAAAABJRU5ErkJggg==",BSe={GRID_LINE_COLOR_COARSE:$4(27),GRID_LINE_COLOR_FINE:$4(18),CHECKERBOARD_PATTERN_DATAURL:Wu},Tx=class Tx extends Ut{constructor(n){super();j(this,"type","background");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"subscriptions",new Set);j(this,"config",BSe);j(this,"checkboardPattern",new Image);j(this,"konva");j(this,"initialize",()=>{this.log.debug("Initializing module"),this.checkboardPattern.onload=()=>{this.konva.patternRect.fillPatternImage(this.checkboardPattern),this.render()},this.checkboardPattern.src=bu.get()?"use-credentials":"anonymous",this.checkboardPattern.src=this.config.CHECKERBOARD_PATTERN_DATAURL,this.render()});j(this,"render",()=>{if(!this.manager.stateApi.runSelector(J0)){this.konva.linesGroup.visible(!1);const w=this.manager.stage.unscale(1);this.konva.patternRect.setAttrs({visible:!0,...this.manager.stage.getScaledStageRect(),fillPatternScaleX:w,fillPatternScaleY:w});return}this.konva.linesGroup.visible(!0),this.konva.patternRect.visible(!1);const s=this.manager.stage.getScale(),{x:o,y:r}=this.manager.stage.getPosition(),{width:a,height:l}=this.manager.stage.getSize(),d=Tx.getGridSpacing(s),u={x1:0,y1:0,x2:a,y2:l},h={x:Math.ceil(o/s/d)*d,y:Math.ceil(r/s/d)*d},p={x1:-h.x,y1:-h.y,x2:a/s-h.x+d,y2:l/s-h.y+d},f={x1:Math.min(u.x1,p.x1),y1:Math.min(u.y1,p.y1),x2:Math.max(u.x2,p.x2),y2:Math.max(u.y2,p.y2)},m=f.x2-f.x1,g=f.y2-f.y1,x=Math.round(m/d)+1,b=Math.round(g/d)+1,C=1/s;let y=0,v=0;this.konva.linesGroup.destroyChildren(),this.konva.lines=[];for(let w=0;w<x;w++){y=f.x1+w*d;const k=new Re.Line({x:y,y:f.y1,points:[0,0,0,g],stroke:y%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:C,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(k),this.konva.linesGroup.add(k)}for(let w=0;w<b;w++){v=f.y1+w*d;const k=new Re.Line({x:f.x1,y:v,points:[0,0,m,0],stroke:v%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:C,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(k),this.konva.linesGroup.add(k)}});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));j(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.layer.destroy()});this.id=Te(this.type),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Re.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1}),linesGroup:new Re.Group({name:`${this.type}:linesGroup`}),lines:[],patternRect:new Re.Rect({name:`${this.type}:patternRect`,perfectDrawEnabled:!1})},this.konva.layer.add(this.konva.patternRect),this.konva.layer.add(this.konva.linesGroup),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(J0,this.render))}};j(Tx,"getGridSpacing",n=>n>=2?8:n>=1&&n<2?16:n>=.5&&n<1?32:n>=.25&&n<.5?64:n>=.125&&n<.25?128:256);let Pw=Tx;class O_ extends Error{constructor(n,s,o){super(s);j(this,"type");j(this,"traceback");this.name="QueueError",this.type=n,this.traceback=o,Error.captureStackTrace&&Error.captureStackTrace(this,O_)}toString(){return`${this.name} [${this.type}]: ${this.message}
Traceback:
${this.traceback}`}}class $Se extends Ut{constructor(n,s){super();j(this,"type","state_api");j(this,"id");j(this,"path");j(this,"parent");j(this,"manager");j(this,"log");j(this,"store");j(this,"runSelector",n=>n(this.store.getState()));j(this,"createStoreSubscription",(n,s)=>Wee(this.store,n,s));j(this,"addStoreListener",n=>this.store.dispatch(Uee(n)));j(this,"getCanvasState",()=>this.runSelector(Ye));j(this,"resetEntity",n=>{this.store.dispatch(nL(n))});j(this,"setEntityPosition",n=>{this.store.dispatch(qee(n))});j(this,"moveEntityBy",n=>{this.store.dispatch(Kee(n))});j(this,"addBrushLine",n=>{this.store.dispatch(Zee(n))});j(this,"addEraserLine",n=>{this.store.dispatch(Yee(n))});j(this,"addRect",n=>{this.store.dispatch(Xee(n))});j(this,"addRasterLayer",n=>{this.store.dispatch(vu(n))});j(this,"addControlLayer",n=>{this.store.dispatch(Xf(n))});j(this,"addInpaintMask",n=>{this.store.dispatch(Ox(n))});j(this,"addRegionalGuidance",n=>{this.store.dispatch(Ka(n))});j(this,"rasterizeEntity",n=>{this.store.dispatch(PS(n))});j(this,"setGenerationBbox",n=>{this.store.dispatch(wp(n))});j(this,"setBrushWidth",n=>{this.store.dispatch(sL(n))});j(this,"setEraserWidth",n=>{this.store.dispatch(iL(n))});j(this,"setColor",n=>this.store.dispatch(rC(n)));j(this,"runGraphAndReturnImageOutput",n=>{const{graph:s,outputNodeId:o,destination:r,prepend:a,timeout:l,signal:d}=n;if(!s.hasNode(o))throw new Error(`Graph does not contain node with id: ${o}`);const u=Te(s.id),h={prepend:a,batch:{graph:s.getGraph(),origin:u,destination:r,runs:1}};let p=!1,f=null;const m=()=>{f!==null&&(window.clearTimeout(f),f=null)};let g=()=>{this.log.warn("cancelGraph called before cancelGraph is set")};return new Promise((b,C)=>{const y=async S=>{if(S.origin!==u||S.invocation_source_id!==o)return;m(),k();const{result:P}=S;if(P.type!=="image_output"){C(new Error(`Graph output node did not return an image output, got: ${P}`));return}const E=await Zn(()=>ste(P.image.image_name));if(E.isErr()){C(E.error);return}p=!0,b(E.value)},v=S=>{if(S.origin===u&&!(S.status==="pending"||S.status==="in_progress")){if(S.status==="completed"){this.log.warn("Queue item completed without output node completion event");return}if(m(),k(),S.status==="failed"){const{error_type:P,error_message:E,error_traceback:L}=S;C(P&&E&&L?new O_(P,E,L):new Error("Queue item failed, but no error details were provided"))}else C(new Error("Graph canceled"))}};this.store.dispatch($l.endpoints.enqueueBatch.initiate(h,{...zf,track:!1})).unwrap().then(S=>{const P=S.batch.batch_id;ve(P,"Enqueue result is missing batch_id"),g=()=>{this.store.dispatch($l.endpoints.cancelByBatchIds.initiate({batch_ids:[P]},{track:!1}))}}).catch(S=>{C(S)}),this.manager.socket.on("invocation_complete",y),this.manager.socket.on("queue_item_status_changed",v);const k=()=>{this.manager.socket.off("invocation_complete",y),this.manager.socket.off("queue_item_status_changed",v)};l&&(f=window.setTimeout(()=>{p||(this.log.trace("Graph canceled by timeout"),k(),g(),C(new Error("Graph timed out")))},l)),d&&d.addEventListener("abort",()=>{p||(this.log.trace("Graph canceled by signal"),m(),k(),g(),C(new Error("Graph canceled")))})})});j(this,"getBbox",()=>this.runSelector(vd));j(this,"getSettings",()=>this.runSelector(cl));j(this,"getPositionGridSize",()=>this.getSettings().snapToGrid?this.$ctrlKey.get()||this.$metaKey.get()?8:64:1);j(this,"getRegionsState",()=>this.getCanvasState().regionalGuidance);j(this,"getRasterLayersState",()=>this.getCanvasState().rasterLayers);j(this,"getControlLayersState",()=>this.getCanvasState().controlLayers);j(this,"getInpaintMasksState",()=>this.getCanvasState().inpaintMasks);j(this,"getStagingArea",()=>this.runSelector(iC));j(this,"getBboxGridSize",()=>this.runSelector(im));j(this,"getIsSelected",n=>{var s;return((s=this.getCanvasState().selectedEntityIdentifier)==null?void 0:s.id)===n});j(this,"getRenderedEntityCount",()=>{const n=Qee(this.getCanvasState());let s=0;for(const o of n)o.isEnabled&&s++;return s});j(this,"getSelectedEntityAdapter",()=>{const n=this.getCanvasState();return!n.selectedEntityIdentifier||!Jee(n.selectedEntityIdentifier)?null:this.manager.getAdapter(n.selectedEntityIdentifier)});j(this,"getCurrentColor",()=>{let n=this.getSettings().color;const s=this.getSelectedEntityAdapter();return s&&(s.state.type==="regional_guidance"||s.state.type==="inpaint_mask")&&(n=tL),n});j(this,"getBrushPreviewColor",()=>{const n=this.getSelectedEntityAdapter();return(n==null?void 0:n.state.type)==="regional_guidance"||(n==null?void 0:n.state.type)==="inpaint_mask"?{...n.state.fill.color,a:.5}:this.getSettings().color});j(this,"$filteringAdapter",Le(null));j(this,"$isFiltering",jn(this.$filteringAdapter,n=>!!n));j(this,"$transformingAdapter",Le(null));j(this,"$isTransforming",jn(this.$transformingAdapter,n=>!!n));j(this,"$rasterizingAdapter",Le(null));j(this,"$isRasterizing",jn(this.$rasterizingAdapter,n=>!!n));j(this,"$segmentingAdapter",Le(null));j(this,"$isSegmenting",jn(this.$segmentingAdapter,n=>!!n));j(this,"$spaceKey",Le(!1));j(this,"$altKey",ete);j(this,"$ctrlKey",tte);j(this,"$metaKey",nte);j(this,"$shiftKey",qS);j(this,"repr",()=>{var n,s,o,r;return{id:this.id,type:this.type,path:this.path,$filteringAdapter:((n=this.$filteringAdapter.get())==null?void 0:n.entityIdentifier)??null,$isFiltering:this.$isFiltering.get(),$transformingAdapter:((s=this.$transformingAdapter.get())==null?void 0:s.entityIdentifier)??null,$isTransforming:this.$isTransforming.get(),$rasterizingAdapter:((o=this.$rasterizingAdapter.get())==null?void 0:o.entityIdentifier)??null,$isRasterizing:this.$isRasterizing.get(),$segmentingAdapter:((r=this.$segmentingAdapter.get())==null?void 0:r.entityIdentifier)??null,$isSegmenting:this.$isSegmenting.get()}});this.id=Te(this.type),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating state api module"),this.store=n}}class VSe extends Ut{constructor(n,s,o){super();j(this,"type","manager");j(this,"id");j(this,"path");j(this,"manager");j(this,"parent");j(this,"log");j(this,"store");j(this,"socket");j(this,"adapters",{rasterLayers:new Mp,controlLayers:new Mp,regionMasks:new Mp,inpaintMasks:new Mp});j(this,"stateApi");j(this,"background");j(this,"stage");j(this,"worker");j(this,"cache");j(this,"entityRenderer");j(this,"compositor");j(this,"tool");j(this,"stagingArea");j(this,"progressImage");j(this,"konva");j(this,"_isDebugging",!1);j(this,"$isBusy");j(this,"getAdapter",n=>{let s;switch(n.type){case"raster_layer":s=this.adapters.rasterLayers.get(n.id);break;case"control_layer":s=this.adapters.controlLayers.get(n.id);break;case"regional_guidance":s=this.adapters.regionMasks.get(n.id);break;case"inpaint_mask":s=this.adapters.inpaintMasks.get(n.id);break;default:return null}return s||null});j(this,"deleteAdapter",n=>{switch(n.type){case"raster_layer":return this.adapters.rasterLayers.delete(n.id);case"control_layer":return this.adapters.controlLayers.delete(n.id);case"regional_guidance":return this.adapters.regionMasks.delete(n.id);case"inpaint_mask":return this.adapters.inpaintMasks.delete(n.id);default:return!1}});j(this,"getAdapters",n=>{const s=[];for(const o of n){const r=this.getAdapter(o);r&&s.push(r)}return s});j(this,"getAllAdapters",()=>[...this.adapters.rasterLayers.values(),...this.adapters.controlLayers.values(),...this.adapters.regionMasks.values(),...this.adapters.inpaintMasks.values()]);j(this,"createAdapter",n=>{if(UP(n)){const s=new fSe(n,this);return this.adapters.rasterLayers.set(s.id,s),s}else if(ite(n)){const s=new hSe(n,this);return this.adapters.controlLayers.set(s.id,s),s}else if(ote(n)){const s=new mSe(n,this);return this.adapters.regionMasks.set(s.id,s),s}else if(rte(n)){const s=new pSe(n,this);return this.adapters.inpaintMasks.set(s.id,s),s}else ve(!1,"Unhandled entity type")});j(this,"getAllModules",()=>[this.stagingArea,this.tool,this.progressImage,this.stateApi,this.background,this.worker,this.entityRenderer,this.compositor,this.stage]);j(this,"initialize",()=>{var n;this.log.debug("Initializing");for(const s of this.getAllModules())(n=s.initialize)==null||n.call(s);aC.set(this)});j(this,"destroy",()=>{this.log.debug("Destroying module");for(const n of this.getAllAdapters())n.destroy();for(const n of this.getAllModules())n.destroy();aC.set(null)});j(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isBusy:this.$isBusy.get(),rasterLayers:Array.from(this.adapters.rasterLayers.values()).map(n=>n.repr()),controlLayers:Array.from(this.adapters.controlLayers.values()).map(n=>n.repr()),inpaintMasks:Array.from(this.adapters.inpaintMasks.values()).map(n=>n.repr()),regionMasks:Array.from(this.adapters.regionMasks.values()).map(n=>n.repr()),stateApi:this.stateApi.repr(),stagingArea:this.stagingArea.repr(),tool:this.tool.repr(),progressImage:this.progressImage.repr(),background:this.background.repr(),worker:this.worker.repr(),entityRenderer:this.entityRenderer.repr(),compositor:this.compositor.repr(),stage:this.stage.repr()}));j(this,"getLoggingContext",()=>({path:this.path}));j(this,"buildPath",n=>n.parent.path.concat(n.id));j(this,"buildLogger",n=>this.log.child(s=>({...s,context:{...s.context,...n.getLoggingContext()}})));this.id=Te(this.type),this.path=[this.id],this.manager=this,this.parent=this,this.log=Wn("canvas").child(r=>({...r,context:{...this.getLoggingContext(),...r.context}})),this.log.debug("Creating canvas manager module"),this.store=s,this.socket=o,this.stateApi=new $Se(this.store,this),this.stage=new vSe(n,this),this.worker=new FSe(this),this.cache=new R1(this),this.entityRenderer=new gSe(this),this.compositor=new Xwe(this),this.stagingArea=new CSe(this),this.$isBusy=jn([this.stateApi.$isFiltering,this.stateApi.$isTransforming,this.stateApi.$isRasterizing,this.stateApi.$isSegmenting,this.stagingArea.$isStaging,this.compositor.$isBusy],(r,a,l,d,u,h)=>r||a||l||d||u||h),this.background=new Pw(this),this.stage.addLayer(this.background.konva.layer),this.konva={previewLayer:new Re.Layer({listening:!0,imageSmoothingEnabled:!1})},this.stage.addLayer(this.konva.previewLayer),this.tool=new NSe(this),this.progressImage=new ySe(this),this.konva.previewLayer.add(this.stagingArea.konva.group),this.konva.previewLayer.add(this.progressImage.konva.group),this.konva.previewLayer.add(this.tool.konva.group)}enableDebugging(){this._isDebugging=!0,this.logDebugInfo()}disableDebugging(){this._isDebugging=!1}logDebugInfo(){console.log("Canvas manager",{managerInstance:this,managerInfo:this.repr()})}}function zSe(e){const t=OM(e),[n,s]=c.useState(t),{defaultDpr:o,maxDpr:r,round:a}=e||{};return c.useEffect(()=>{if(!(typeof window<"u"&&"matchMedia"in window))return;const d=()=>s(OM({defaultDpr:o,maxDpr:r,round:a})),u=window.matchMedia(`screen and (resolution: ${n}dppx)`);return u.addEventListener?u.addEventListener("change",d):u.addListener(d),()=>{u.removeEventListener?u.removeEventListener("change",d):u.removeListener(d)}},[n,o,r,a]),n}function OM(e){const{defaultDpr:t=1,maxDpr:n=3,round:s=!0}=e||{},r=typeof window<"u"&&typeof window.devicePixelRatio=="number"?window.devicePixelRatio:t;return Math.min(Math.max(1,s?Math.floor(r):r),n)}const Jv=Wn("canvas");Re.showWarnings=!1;const GSe=()=>{Pt("useKonvaPixelRatioWatcher");const e=zSe({round:!1});c.useLayoutEffect(()=>{Re.pixelRatio=e},[e])},HSe=()=>{Pt("useInvokeCanvas"),GSe();const e=cn(),t=re(X8),[n,s]=c.useState(null);return c.useLayoutEffect(()=>{if(Jv.debug("Initializing renderer"),!n)return Jv.debug("No stage container, skipping initialization"),()=>{};if(!t)return Jv.debug("Socket not connected, skipping initialization"),()=>{};const o=aC.get();if(o){o.stage.setContainer(n);return}new VSe(n,e,t).initialize()},[n,t,e]),s},z$=c.memo(()=>{const e=HSe();return i.jsx(Ce,{position:"absolute",top:0,right:0,bottom:0,left:0,ref:e,borderRadius:"base",overflow:"hidden","data-testid":"control-layers-canvas"})});z$.displayName="InvokeCanvasComponent";const G$=c.memo(({adapter:e})=>{const{t}=M(),n=re(e.segmentAnything.$invert),s=c.useCallback(()=>{e.segmentAnything.$invert.set(!e.segmentAnything.$invert.get())},[e.segmentAnything.$invert]);return i.jsxs(Q,{w:"min-content",children:[i.jsx(J,{m:0,children:t("controlLayers.selectObject.invertSelection")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});G$.displayName="SelectObjectInvert";const H$=c.memo(({adapter:e})=>{const{t}=M(),n=re(e.segmentAnything.$pointTypeString),s=c.useCallback(o=>{const r=ate.parse(o),a=lte[r];e.segmentAnything.$pointType.set(a)},[e.segmentAnything.$pointType]);return i.jsxs(Q,{w:"min-content",children:[i.jsx(J,{m:0,children:t("controlLayers.selectObject.pointType")}),i.jsx(cte,{value:n,onChange:s,w:"full",size:"md",children:i.jsxs(T,{alignItems:"center",w:"full",gap:4,fontWeight:"semibold",color:"base.300",children:[i.jsx(V4,{value:"foreground",children:i.jsx(W,{children:t("controlLayers.selectObject.include")})}),i.jsx(V4,{value:"background",children:i.jsx(W,{children:t("controlLayers.selectObject.exclude")})})]})})]})});H$.displayName="SelectObject";const W$=c.memo(({adapter:e})=>{const{t}=M(),n=c.useRef(null);bm("canvas",n,{focusOnMount:!0});const s=Os("canvas"),o=re(e.segmentAnything.$isProcessing),r=re(e.segmentAnything.$hasPoints),a=re(e.segmentAnything.$hasImageState),l=A(sm),d=c.useCallback(()=>{e.segmentAnything.saveAs("inpaint_mask")},[e.segmentAnything]),u=c.useCallback(()=>{e.segmentAnything.saveAs("regional_guidance")},[e.segmentAnything]),h=c.useCallback(()=>{e.segmentAnything.saveAs("raster_layer")},[e.segmentAnything]),p=c.useCallback(()=>{e.segmentAnything.saveAs("control_layer")},[e.segmentAnything]);return De({id:"applySegmentAnything",category:"canvas",callback:e.segmentAnything.apply,options:{enabled:!o&&s},dependencies:[e.segmentAnything,o,s]}),De({id:"cancelSegmentAnything",category:"canvas",callback:e.segmentAnything.cancel,options:{enabled:!o&&s},dependencies:[e.segmentAnything,o,s]}),i.jsxs(T,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[i.jsxs(T,{w:"full",gap:4,alignItems:"center",children:[i.jsxs(T,{gap:2,children:[i.jsx(zt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.selectObject.selectObject")}),i.jsx(Oe,{label:i.jsx(q$,{}),children:i.jsx(T,{alignItems:"center",children:i.jsx(at,{as:Ru,color:"base.500"})})})]}),i.jsx(Je,{}),i.jsx(D_,{}),i.jsx(Jy,{})]}),i.jsxs(T,{w:"full",justifyContent:"space-between",py:2,children:[i.jsx(H$,{adapter:e}),i.jsx(G$,{adapter:e})]}),i.jsxs(Qn,{isAttached:!1,size:"sm",w:"full",children:[i.jsxs(de,{onClick:e.segmentAnything.processImmediate,loadingText:t("controlLayers.selectObject.process"),variant:"ghost",isDisabled:o||!r||l&&a,children:[t("controlLayers.selectObject.process"),o&&i.jsx(ci,{ms:3,boxSize:5,color:"base.600"})]}),i.jsx(Je,{}),i.jsx(de,{onClick:e.segmentAnything.reset,isDisabled:o||!r,loadingText:t("controlLayers.selectObject.reset"),variant:"ghost",children:t("controlLayers.selectObject.reset")}),i.jsx(de,{onClick:e.segmentAnything.apply,loadingText:t("controlLayers.selectObject.apply"),variant:"ghost",isDisabled:o||!a,children:t("controlLayers.selectObject.apply")}),i.jsxs(on,{children:[i.jsx(rn,{as:de,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:o||!a,rightIcon:i.jsx(Bi,{}),children:t("controlLayers.selectObject.saveAs")}),i.jsxs(Et,{children:[i.jsx(fe,{isDisabled:o||!a,onClick:d,children:t("controlLayers.newInpaintMask")}),i.jsx(fe,{isDisabled:o||!a,onClick:u,children:t("controlLayers.newRegionalGuidance")}),i.jsx(fe,{isDisabled:o||!a,onClick:p,children:t("controlLayers.newControlLayer")}),i.jsx(fe,{isDisabled:o||!a,onClick:h,children:t("controlLayers.newRasterLayer")})]})]}),i.jsx(de,{onClick:e.segmentAnything.cancel,isDisabled:o,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.selectObject.cancel")})]})]})});W$.displayName="SegmentAnythingContent";const U$=c.memo(()=>{const e=Lt(),t=re(e.stateApi.$segmentingAdapter);return t?i.jsx(W$,{adapter:t}):null});U$.displayName="SelectObject";const NM=e=>i.jsx(W,{as:"span",fontWeight:"semibold",children:e.children}),q$=c.memo(()=>{const{t:e}=M();return i.jsxs(T,{gap:3,flexDir:"column",children:[i.jsx(W,{children:i.jsx(Wt,{i18nKey:"controlLayers.selectObject.help1",components:{Bold:i.jsx(NM,{})}})}),i.jsx(W,{children:i.jsx(Wt,{i18nKey:"controlLayers.selectObject.help2",components:{Bold:i.jsx(NM,{})}})}),i.jsx(W,{children:i.jsx(Wt,{i18nKey:"controlLayers.selectObject.help3"})}),i.jsxs(ai,{children:[i.jsx(Ft,{children:e("controlLayers.selectObject.clickToAdd")}),i.jsx(Ft,{children:e("controlLayers.selectObject.dragToMove")}),i.jsx(Ft,{children:e("controlLayers.selectObject.clickToRemove")})]})]})});q$.displayName="SelectObjectHelpTooltipContent";const WSe={destination:"canvas"},USe=()=>{dte(WSe)},K$=c.memo(e=>(USe(),A(li)?e.children:null));K$.displayName="StagingAreaIsStagingGate";const Z$=c.memo(()=>{const e=G(),t=Lt(),n=A(Fx),s=A(qx),o=A(Mn),r=A(om),a=re(t.stagingArea.$shouldShowStagedImage),l=Os("canvas"),{t:d}=M(),u=c.useCallback(()=>{if(!s)return;const{x:h,y:p}=n,{imageDTO:f,offsetX:m,offsetY:g}=s,x=ao(f),b={position:{x:h+m,y:p+g},objects:[x]};e(vu({overrides:b,isSelected:(o==null?void 0:o.type)==="raster_layer"})),e(KS())},[n,e,o==null?void 0:o.type,s]);return Eo(["enter"],u,{preventDefault:!0,enabled:l&&a&&r>1},[l,a,r]),i.jsx(le,{tooltip:`${d("common.accept")} (Enter)`,"aria-label":`${d("common.accept")} (Enter)`,icon:i.jsx(wm,{}),onClick:u,colorScheme:"invokeBlue",isDisabled:!s})});Z$.displayName="StagingAreaToolbarAcceptButton";const Y$=c.memo(()=>{const e=G(),{t}=M(),n=c.useCallback(()=>{e(KS())},[e]);return i.jsx(le,{tooltip:`${t("controlLayers.stagingArea.discardAll")} (Esc)`,"aria-label":t("controlLayers.stagingArea.discardAll"),icon:i.jsx(Pi,{}),onClick:n,colorScheme:"error",fontSize:16})});Y$.displayName="StagingAreaToolbarDiscardAllButton";const X$=c.memo(()=>{const e=G(),t=A(oL),n=A(qx),s=A(om),{t:o}=M(),r=c.useCallback(()=>{n&&e(s===1?KS():ute({index:t}))},[n,s,e,t]);return i.jsx(le,{tooltip:o("controlLayers.stagingArea.discard"),"aria-label":o("controlLayers.stagingArea.discard"),icon:i.jsx(Rt,{}),onClick:r,colorScheme:"invokeBlue",fontSize:16,isDisabled:!n})});X$.displayName="StagingAreaToolbarDiscardSelectedButton";const Q$=c.memo(()=>{const e=A(oL),t=A(om),n=c.useMemo(()=>t>0?`${(e??0)+1} of ${t}`:"0 of 0",[t,e]);return i.jsx(de,{colorScheme:"base",pointerEvents:"none",minW:28,children:n})});Q$.displayName="StagingAreaToolbarImageCountButton";const J$=c.memo(()=>{const e=G(),t=Lt(),n=A(om),s=re(t.stagingArea.$shouldShowStagedImage),o=Os("canvas"),{t:r}=M(),a=c.useCallback(()=>{e(hte())},[e]);return Eo(["right"],a,{preventDefault:!0,enabled:o&&s&&n>1},[o,s,n]),i.jsx(le,{tooltip:`${r("controlLayers.stagingArea.next")} (Right)`,"aria-label":`${r("controlLayers.stagingArea.next")} (Right)`,icon:i.jsx(Ape,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});J$.displayName="StagingAreaToolbarNextButton";const eV=c.memo(()=>{const e=G(),t=Lt(),n=A(om),s=re(t.stagingArea.$shouldShowStagedImage),o=Os("canvas"),{t:r}=M(),a=c.useCallback(()=>{e(pte())},[e]);return Eo(["left"],a,{preventDefault:!0,enabled:o&&s&&n>1},[o,s,n]),i.jsx(le,{tooltip:`${r("controlLayers.stagingArea.previous")} (Left)`,"aria-label":`${r("controlLayers.stagingArea.previous")} (Left)`,icon:i.jsx(jpe,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});eV.displayName="StagingAreaToolbarPrevButton";const n0={image_category:"general",is_intermediate:!0,silent:!0},tV=c.memo(()=>{const{t:e}=M(),t=A(qx),n=cn(),s=c.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:d}=n,u=await bd(t.imageDTO),h=await er({file:u,...n0});Qi({imageDTO:h,type:"raster_layer",dispatch:l,getState:d,overrides:{isEnabled:!1}}),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),o=c.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:d}=n,u=await bd(t.imageDTO),h=await er({file:u,...n0});Qi({imageDTO:h,type:"control_layer",dispatch:l,getState:d,overrides:{isEnabled:!1}}),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),r=c.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:d}=n,u=await bd(t.imageDTO),h=await er({file:u,...n0});Qi({imageDTO:h,type:"inpaint_mask",dispatch:l,getState:d,overrides:{isEnabled:!1}}),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),a=c.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:d}=n,u=await bd(t.imageDTO),h=await er({file:u,...n0});Qi({imageDTO:h,type:"regional_guidance",dispatch:l,getState:d,overrides:{isEnabled:!1}}),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]);return i.jsxs(on,{children:[i.jsx(rn,{as:le,"aria-label":e("controlLayers.newLayerFromImage"),tooltip:e("controlLayers.newLayerFromImage"),icon:i.jsx(j7,{}),colorScheme:"invokeBlue",isDisabled:!t}),i.jsxs(Et,{children:[i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:r,isDisabled:!t,children:e("controlLayers.inpaintMask")}),i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:a,isDisabled:!t,children:e("controlLayers.regionalGuidance")}),i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:o,isDisabled:!t,children:e("controlLayers.controlLayer")}),i.jsx(fe,{icon:i.jsx(Ms,{}),onClickCapture:s,isDisabled:!t,children:e("controlLayers.rasterLayer")})]})]})});tV.displayName="StagingAreaToolbarSaveAsMenu";const FM="SAVE_STAGING_AREA_IMAGE_TO_GALLERY",nV=c.memo(()=>{const e=A(qs),t=A(qx),{t:n}=M(),s=c.useCallback(async()=>{if(!t)return;(await Zn(async()=>{const r=await bd(t.imageDTO);await er({file:r,image_category:"general",is_intermediate:!1,board_id:e==="none"?void 0:e,silent:!0})})).isOk()?ge({id:FM,title:n("controlLayers.savedToGalleryOk"),status:"success"}):ge({id:FM,title:n("controlLayers.savedToGalleryError"),status:"error"})},[e,t,n]);return i.jsx(le,{tooltip:n("controlLayers.stagingArea.saveToGallery"),"aria-label":n("controlLayers.stagingArea.saveToGallery"),icon:i.jsx(ar,{}),onClick:s,colorScheme:"invokeBlue",isDisabled:!t})});nV.displayName="StagingAreaToolbarSaveSelectedToGalleryButton";const sV=c.memo(()=>{const e=Lt(),t=re(e.stagingArea.$shouldShowStagedImage),{t:n}=M(),s=c.useCallback(()=>{e.stagingArea.$shouldShowStagedImage.set(!t)},[e.stagingArea.$shouldShowStagedImage,t]);return i.jsx(le,{tooltip:n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"aria-label":n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"data-alert":!t,icon:t?i.jsx(Du,{}):i.jsx(Upe,{}),onClick:s,colorScheme:"invokeBlue"})});sV.displayName="StagingAreaToolbarToggleShowResultsButton";const iV=c.memo(()=>i.jsxs(i.Fragment,{children:[i.jsxs(Qn,{borderRadius:"base",shadow:"dark-lg",children:[i.jsx(eV,{}),i.jsx(Q$,{}),i.jsx(J$,{})]}),i.jsxs(Qn,{borderRadius:"base",shadow:"dark-lg",children:[i.jsx(Z$,{}),i.jsx(sV,{}),i.jsx(nV,{}),i.jsx(tV,{}),i.jsx(X$,{}),i.jsx(Y$,{})]})]}));iV.displayName="StagingAreaToolbar";const oV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(ZP),s=c.useCallback(()=>{t(fte())},[t]);return i.jsxs(Q,{children:[i.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.bboxOverlay")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});oV.displayName="CanvasSettingsBboxOverlaySwitch";const rV=c.memo(()=>{const{t:e}=M(),t=Lt(),n=c.useCallback(()=>{t.cache.clearAll()},[t]);return i.jsx(de,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.clearCaches")})});rV.displayName="CanvasSettingsClearCachesButton";const aV=c.memo(()=>{const{t:e}=M(),t=G(),n=c.useCallback(()=>{t(mte())},[t]);return i.jsx(de,{onClick:n,size:"sm",children:e("controlLayers.clearHistory")})});aV.displayName="CanvasSettingsClearHistoryButton";const qSe=he(cl,e=>e.clipToBbox),lV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(qSe),s=c.useCallback(o=>t(gte(o.target.checked)),[t]);return i.jsxs(Q,{w:"full",children:[i.jsx(J,{flexGrow:1,children:e("controlLayers.clipToBbox")}),i.jsx(_n,{isChecked:n,onChange:s})]})});lV.displayName="CanvasSettingsClipToBboxCheckbox";const cV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(J0),s=c.useCallback(()=>{t(xte())},[t]);return i.jsxs(Q,{children:[i.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.dynamicGrid")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});cV.displayName="CanvasSettingsDynamicGridSwitch";const dV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(yte),s=c.useCallback(()=>{t(bte())},[t]);return i.jsxs(Q,{w:"full",children:[i.jsx(J,{flexGrow:1,children:e("controlLayers.settings.snapToGrid.label")}),i.jsx(_n,{isChecked:n,onChange:s})]})});dV.displayName="CanvasSettingsSnapToGrid";const KSe=he(cl,e=>e.invertScrollForToolWidth),uV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(KSe),s=c.useCallback(o=>{t(vte(o.target.checked))},[t]);return i.jsxs(Q,{w:"full",children:[i.jsx(J,{flexGrow:1,children:e("controlLayers.settings.invertBrushSizeScrollDirection")}),i.jsx(_n,{isChecked:n,onChange:s})]})});uV.displayName="CanvasSettingsInvertScrollCheckbox";const hV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(Q0),s=c.useCallback(()=>{t(VP())},[t]);return i.jsxs(Q,{children:[i.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedLayerPreview")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});hV.displayName="CanvasSettingsIsolatedLayerPreviewSwitch";const pV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(tC),s=c.useCallback(()=>{t(Cte())},[t]);return i.jsxs(Q,{children:[i.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedStagingPreview")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});pV.displayName="CanvasSettingsIsolatedStagingPreviewSwitch";const fV=c.memo(()=>{const{t:e}=M(),t=Lt(),n=c.useCallback(()=>{t.logDebugInfo()},[t]);return i.jsx(de,{onClick:n,size:"sm",children:e("controlLayers.logDebugInfo")})});fV.displayName="CanvasSettingsLogDebugInfoButton";const mV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(wte),s=c.useCallback(()=>{t(Ste())},[t]);return i.jsxs(Q,{w:"full",children:[i.jsx(J,{flexGrow:1,children:e("controlLayers.outputOnlyMaskedRegions")}),i.jsx(_n,{isChecked:n,onChange:s})]})});mV.displayName="CanvasSettingsOutputOnlyMaskedRegionsCheckbox";const gV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(TP),s=c.useCallback(()=>t(kte()),[t]);return i.jsxs(Q,{w:"full",children:[i.jsx(J,{flexGrow:1,children:e("controlLayers.settings.preserveMask.label")}),i.jsx(_n,{isChecked:n,onChange:s})]})});gV.displayName="CanvasSettingsPreserveMaskCheckbox";const xV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(jte),s=c.useCallback(()=>{t(_te())},[t]);return i.jsxs(Q,{w:"full",children:[i.jsx(J,{flexGrow:1,children:e("controlLayers.settings.pressureSensitivity")}),i.jsx(_n,{isChecked:n,onChange:s})]})});xV.displayName="CanvasSettingsPressureSensitivityCheckbox";const yV=c.memo(()=>{const{t:e}=M(),t=Lt(),n=c.useCallback(()=>{for(const s of t.getAllAdapters())s.transformer.requestRectCalculation()},[t]);return i.jsx(de,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.recalculateRects")})});yV.displayName="CanvasSettingsRecalculateRectsButton";const ZSe=he(cl,e=>e.showHUD),bV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(ZSe),s=c.useCallback(()=>{t(Ite())},[t]);return i.jsxs(Q,{children:[i.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.showHUD")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});bV.displayName="CanvasSettingsShowHUDSwitch";const vV=c.memo(()=>{const{t:e}=M(),t=G(),n=A(sC),s=c.useCallback(()=>{t(Tte())},[t]);return i.jsxs(Q,{children:[i.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.showProgressOnCanvas")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});vV.displayName="CanvasSettingsShowProgressOnCanvas";const CV=c.memo(()=>{const{t:e}=M();return i.jsxs(es,{isLazy:!0,children:[i.jsx(ds,{children:i.jsx(le,{"aria-label":e("common.settingsLabel"),icon:i.jsx(Im,{}),variant:"link",alignSelf:"stretch"})}),i.jsxs(ts,{children:[i.jsx(po,{}),i.jsx(us,{children:i.jsxs(T,{direction:"column",gap:2,children:[i.jsx(uV,{}),i.jsx(gV,{}),i.jsx(lV,{}),i.jsx(mV,{}),i.jsx(dV,{}),i.jsx(xV,{}),i.jsx(vV,{}),i.jsx(pV,{}),i.jsx(hV,{}),i.jsx(cV,{}),i.jsx(oV,{}),i.jsx(bV,{}),i.jsx(YSe,{})]})})]})]})});CV.displayName="CanvasSettingsPopover";const YSe=()=>dl()?i.jsxs(i.Fragment,{children:[i.jsx(Ct,{}),i.jsx(rV,{}),i.jsx(yV,{}),i.jsx(fV,{}),i.jsx(aV,{})]}):null,wV=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1},{r:255,g:90,b:94,a:1},{r:255,g:146,b:75,a:1},{r:255,g:202,b:59,a:1},{r:197,g:202,b:48,a:1},{r:138,g:201,b:38,a:1},{r:83,g:165,b:117,a:1},{r:23,g:130,b:196,a:1},{r:66,g:103,b:172,a:1},{r:107,g:76,b:147,a:1}],XSe=wV,QSe=wV.map(({r:e,g:t,b:n})=>({r:e,g:t,b:n}));function bl(){return(bl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function Wm(e,t){if(e==null)return{};var n,s,o={},r=Object.keys(e);for(s=0;s<r.length;s++)t.indexOf(n=r[s])>=0||(o[n]=e[n]);return o}function Af(e){var t=c.useRef(e),n=c.useRef(function(s){t.current&&t.current(s)});return t.current=e,n.current}var cu=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e<t?t:e},qp=function(e){return"touches"in e},Lw=function(e){return e&&e.ownerDocument.defaultView||self},BM=function(e,t,n){var s=e.getBoundingClientRect(),o=qp(t)?function(r,a){for(var l=0;l<r.length;l++)if(r[l].identifier===a)return r[l];return r[0]}(t.touches,n):t;return{left:cu((o.pageX-(s.left+Lw(e).pageXOffset))/s.width),top:cu((o.pageY-(s.top+Lw(e).pageYOffset))/s.height)}},$M=function(e){!qp(e)&&e.preventDefault()},N_=xe.memo(function(e){var t=e.onMove,n=e.onKey,s=Wm(e,["onMove","onKey"]),o=c.useRef(null),r=Af(t),a=Af(n),l=c.useRef(null),d=c.useRef(!1),u=c.useMemo(function(){var m=function(b){$M(b),(qp(b)?b.touches.length>0:b.buttons>0)&&o.current?r(BM(o.current,b,l.current)):x(!1)},g=function(){return x(!1)};function x(b){var C=d.current,y=Lw(o.current),v=b?y.addEventListener:y.removeEventListener;v(C?"touchmove":"mousemove",m),v(C?"touchend":"mouseup",g)}return[function(b){var C=b.nativeEvent,y=o.current;if(y&&($M(C),!function(w,k){return k&&!qp(w)}(C,d.current)&&y)){if(qp(C)){d.current=!0;var v=C.changedTouches||[];v.length&&(l.current=v[0].identifier)}y.focus(),r(BM(y,C,l.current)),x(!0)}},function(b){var C=b.which||b.keyCode;C<37||C>40||(b.preventDefault(),a({left:C===39?.05:C===37?-.05:0,top:C===40?.05:C===38?-.05:0}))},x]},[a,r]),h=u[0],p=u[1],f=u[2];return c.useEffect(function(){return f},[f]),xe.createElement("div",bl({},s,{onTouchStart:h,onMouseDown:h,className:"react-colorful__interactive",ref:o,onKeyDown:p,tabIndex:0,role:"slider"}))}),Um=function(e){return e.filter(Boolean).join(" ")},F_=function(e){var t=e.color,n=e.left,s=e.top,o=s===void 0?.5:s,r=Um(["react-colorful__pointer",e.className]);return xe.createElement("div",{className:r,style:{top:100*o+"%",left:100*n+"%"}},xe.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},Us=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n},SV=function(e){var t=e.s,n=e.v,s=e.a,o=(200-t)*n/100;return{h:Us(e.h),s:Us(o>0&&o<200?t*n/100/(o<=100?o:200-o)*100:0),l:Us(o/2),a:Us(s,2)}},Dw=function(e){var t=SV(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},e2=function(e){var t=SV(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},kV=function(e){var t=e.h,n=e.s,s=e.v,o=e.a;t=t/360*6,n/=100,s/=100;var r=Math.floor(t),a=s*(1-n),l=s*(1-(t-r)*n),d=s*(1-(1-t+r)*n),u=r%6;return{r:Us(255*[s,l,a,a,d,s][u]),g:Us(255*[d,s,s,l,a,a][u]),b:Us(255*[a,a,d,s,s,l][u]),a:Us(o,2)}},jV=function(e){var t=e.r,n=e.g,s=e.b,o=e.a,r=Math.max(t,n,s),a=r-Math.min(t,n,s),l=a?r===t?(n-s)/a:r===n?2+(s-t)/a:4+(t-n)/a:0;return{h:Us(60*(l<0?l+6:l)),s:Us(r?a/r*100:0),v:Us(r/255*100),a:o}},_V=xe.memo(function(e){var t=e.hue,n=e.onChange,s=Um(["react-colorful__hue",e.className]);return xe.createElement("div",{className:s},xe.createElement(N_,{onMove:function(o){n({h:360*o.left})},onKey:function(o){n({h:cu(t+360*o.left,0,360)})},"aria-label":"Hue","aria-valuenow":Us(t),"aria-valuemax":"360","aria-valuemin":"0"},xe.createElement(F_,{className:"react-colorful__hue-pointer",left:t/360,color:Dw({h:t,s:100,v:100,a:1})})))}),IV=xe.memo(function(e){var t=e.hsva,n=e.onChange,s={backgroundColor:Dw({h:t.h,s:100,v:100,a:1})};return xe.createElement("div",{className:"react-colorful__saturation",style:s},xe.createElement(N_,{onMove:function(o){n({s:100*o.left,v:100-100*o.top})},onKey:function(o){n({s:cu(t.s+100*o.left,0,100),v:cu(t.v-100*o.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Us(t.s)+"%, Brightness "+Us(t.v)+"%"},xe.createElement(F_,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:Dw(t)})))}),B_=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0};function TV(e,t,n){var s=Af(n),o=c.useState(function(){return e.toHsva(t)}),r=o[0],a=o[1],l=c.useRef({color:t,hsva:r});c.useEffect(function(){if(!e.equal(t,l.current.color)){var u=e.toHsva(t);l.current={hsva:u,color:t},a(u)}},[t,e]),c.useEffect(function(){var u;B_(r,l.current.hsva)||e.equal(u=e.fromHsva(r),l.current.color)||(l.current={hsva:r,color:u},s(u))},[r,e,s]);var d=c.useCallback(function(u){a(function(h){return Object.assign({},h,u)})},[]);return[r,d]}var JSe=typeof window<"u"?c.useLayoutEffect:c.useEffect,eke=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},VM=new Map,AV=function(e){JSe(function(){var t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!VM.has(t)){var n=t.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,VM.set(t,n);var s=eke();s&&n.setAttribute("nonce",s),t.head.appendChild(n)}},[])},tke=function(e){var t=e.className,n=e.colorModel,s=e.color,o=s===void 0?n.defaultColor:s,r=e.onChange,a=Wm(e,["className","colorModel","color","onChange"]),l=c.useRef(null);AV(l);var d=TV(n,o,r),u=d[0],h=d[1],p=Um(["react-colorful",t]);return xe.createElement("div",bl({},a,{ref:l,className:p}),xe.createElement(IV,{hsva:u,onChange:h}),xe.createElement(_V,{hue:u.h,onChange:h,className:"react-colorful__last-control"}))},nke=function(e){var t=e.className,n=e.hsva,s=e.onChange,o={backgroundImage:"linear-gradient(90deg, "+e2(Object.assign({},n,{a:0}))+", "+e2(Object.assign({},n,{a:1}))+")"},r=Um(["react-colorful__alpha",t]),a=Us(100*n.a);return xe.createElement("div",{className:r},xe.createElement("div",{className:"react-colorful__alpha-gradient",style:o}),xe.createElement(N_,{onMove:function(l){s({a:l.left})},onKey:function(l){s({a:cu(n.a+l.left)})},"aria-label":"Alpha","aria-valuetext":a+"%","aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100"},xe.createElement(F_,{className:"react-colorful__alpha-pointer",left:n.a,color:e2(n)})))},ske=function(e){var t=e.className,n=e.colorModel,s=e.color,o=s===void 0?n.defaultColor:s,r=e.onChange,a=Wm(e,["className","colorModel","color","onChange"]),l=c.useRef(null);AV(l);var d=TV(n,o,r),u=d[0],h=d[1],p=Um(["react-colorful",t]);return xe.createElement("div",bl({},a,{ref:l,className:p}),xe.createElement(IV,{hsva:u,onChange:h}),xe.createElement(_V,{hue:u.h,onChange:h}),xe.createElement(nke,{hsva:u,onChange:h,className:"react-colorful__last-control"}))},ike={defaultColor:{r:0,g:0,b:0,a:1},toHsva:jV,fromHsva:kV,equal:B_},MV=function(e){return xe.createElement(ske,bl({},e,{colorModel:ike}))},oke={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return jV({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(t=kV(e)).r,g:t.g,b:t.b};var t},equal:B_},rke=function(e){return xe.createElement(tke,bl({},e,{colorModel:oke}))},ake=/^#?([0-9A-F]{3,8})$/i,lke=function(e){var t=e.color,n=t===void 0?"":t,s=e.onChange,o=e.onBlur,r=e.escape,a=e.validate,l=e.format,d=e.process,u=Wm(e,["color","onChange","onBlur","escape","validate","format","process"]),h=c.useState(function(){return r(n)}),p=h[0],f=h[1],m=Af(s),g=Af(o),x=c.useCallback(function(C){var y=r(C.target.value);f(y),a(y)&&m(d?d(y):y)},[r,d,a,m]),b=c.useCallback(function(C){a(C.target.value)||f(r(n)),g(C)},[n,r,a,g]);return c.useEffect(function(){f(r(n))},[n,r]),xe.createElement("input",bl({},u,{value:l?l(p):p,spellCheck:"false",onChange:x,onBlur:b}))},zM=function(e){return"#"+e},cke=function(e){var t=e.prefixed,n=e.alpha,s=Wm(e,["prefixed","alpha"]),o=c.useCallback(function(a){return a.replace(/([^0-9A-F]+)/gi,"").substring(0,n?8:6)},[n]),r=c.useCallback(function(a){return function(l,d){var u=ake.exec(l),h=u?u[1].length:0;return h===3||h===6||!!d&&h===4||!!d&&h===8}(a,n)},[n]);return xe.createElement(lke,bl({},s,{escape:o,format:t?zM:void 0,process:zM,validate:r}))};const t2={width:6,height:6,borderColor:"base.100"},dke={".react-colorful__hue-pointer":t2,".react-colorful__saturation-pointer":t2,".react-colorful__alpha-pointer":t2,gap:4,flexDir:"column"},uke={width:"100%"},s0="3.5rem",hke=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:o=!1}=e,{t:r}=M(),a=c.useCallback(h=>n({...t,r:h}),[t,n]),l=c.useCallback(h=>n({...t,g:h}),[t,n]),d=c.useCallback(h=>n({...t,b:h}),[t,n]),u=c.useCallback(h=>n({...t,a:h}),[t,n]);return i.jsxs(T,{sx:dke,children:[i.jsx(MV,{color:t,onChange:n,style:uke}),s&&i.jsxs(T,{gap:2,children:[i.jsxs(Q,{gap:0,children:[i.jsx(J,{children:r("common.red")[0]}),i.jsx(_e,{value:t.r,onChange:a,min:0,max:255,step:1,w:s0,defaultValue:90})]}),i.jsxs(Q,{gap:0,children:[i.jsx(J,{children:r("common.green")[0]}),i.jsx(_e,{value:t.g,onChange:l,min:0,max:255,step:1,w:s0,defaultValue:90})]}),i.jsxs(Q,{gap:0,children:[i.jsx(J,{children:r("common.blue")[0]}),i.jsx(_e,{value:t.b,onChange:d,min:0,max:255,step:1,w:s0,defaultValue:255})]}),i.jsxs(Q,{gap:0,children:[i.jsx(J,{children:r("common.alpha")[0]}),i.jsx(_e,{value:t.a,onChange:u,step:.1,min:0,max:1,w:s0,defaultValue:1})]})]}),o&&i.jsx(T,{gap:2,justifyContent:"space-between",children:XSe.map((h,p)=>i.jsx(pke,{color:h,onChange:n},p))})]})},EV=c.memo(hke),pke=({color:e,onChange:t})=>{const n=c.useCallback(()=>{t(e)},[e,t]);return i.jsx(Ce,{role:"button",onClick:n,h:8,w:8,bg:ea(e),borderRadius:"base"})},fke=he(cl,e=>e.color),PV=c.memo(()=>{const{t:e}=M(),t=A(fke),n=G(),s=c.useCallback(r=>{n(rC(r))},[n]),o=$t();return De({id:"setFillToWhite",category:"canvas",callback:()=>n(rC({r:255,g:255,b:255,a:1})),options:{preventDefault:!0,enabled:!o.isOpen},dependencies:[n,o.isOpen]}),i.jsxs(es,{isLazy:!0,children:[i.jsx(ds,{children:i.jsx(T,{role:"button","aria-label":e("controlLayers.fill.fillColor"),tabIndex:-1,w:8,h:8,children:i.jsx(Oe,{label:e("controlLayers.fill.fillColor"),children:i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(Ce,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:ea(t)})})})})}),i.jsxs(ts,{children:[i.jsx(po,{}),i.jsx(us,{minH:64,children:i.jsx(EV,{color:t,onChange:s,withNumberInput:!0,withSwatches:!0})})]})]})});PV.displayName="ToolFillColorPicker";const pa=e=>{const t=Lt();return re(jn(t.tool.$tool,s=>s===e))},Dc=e=>{const t=Lt();return c.useCallback(()=>{t.tool.$tool.set(e)},[t.tool.$tool,e])},mke=he(cl,e=>e.brushWidth),gke=e=>`${e} px`;function LV(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function Md(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function xke(e){return`${String(LV(e))} px`}const yke=[Md(1),Md(50),Md(200),Md(600)],bke=Md(50),DV=c.memo(()=>{const e=G(),{t}=M(),n=$t(),s=pa("brush"),o=A(mke),[r,a]=c.useState(o),l=c.useCallback(g=>{e(sL(pr(Math.round(g),1,600)))},[e]),d=c.useCallback(()=>{let g=Math.round(o*1.15);g===o&&(g+=1),l(g)},[l,o]),u=c.useCallback(()=>{let g=Math.round(o*.85);g===o&&(g-=1),l(g)},[l,o]),h=c.useCallback(g=>{l(LV(g))},[l]),p=c.useCallback(()=>{isNaN(Number(r))?(l(50),a(50)):l(r)},[r,l]),f=c.useCallback((g,x)=>{a(x)},[]),m=c.useCallback(g=>{g.key==="Enter"&&p()},[p]);return c.useEffect(()=>{a(o)},[o]),De({id:"decrementToolWidth",category:"canvas",callback:u,options:{enabled:s&&!n.isOpen},dependencies:[u,s,n.isOpen]}),De({id:"incrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),i.jsxs(es,{children:[i.jsxs(Q,{w:"min-content",gap:2,children:[i.jsx(J,{m:0,children:t("controlLayers.width")}),i.jsx(rm,{children:i.jsxs(Kx,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:r,onChange:f,onBlur:p,w:"76px",format:gke,defaultValue:50,onKeyDown:m,clampValueOnBlur:!1,children:[i.jsx(Zx,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),i.jsx(ds,{children:i.jsx(le,{"aria-label":"open-slider",icon:i.jsx(Bi,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),i.jsxs(ts,{w:200,pt:0,pb:2,px:4,children:[i.jsx(po,{}),i.jsx(us,{children:i.jsx(Ze,{min:0,max:100,value:Md(r),onChange:h,defaultValue:bke,marks:yke,formatValue:xke,alwaysShowMarks:!0})})]})]})});DV.displayName="ToolBrushWidth";const vke=he(cl,e=>e.eraserWidth),Cke=e=>`${e} px`;function RV(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function Ed(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function wke(e){return`${String(RV(e))} px`}const Ske=[Ed(1),Ed(50),Ed(200),Ed(600)],kke=Ed(50),OV=c.memo(()=>{const e=G(),{t}=M(),n=$t(),s=pa("eraser"),o=A(vke),[r,a]=c.useState(o),l=c.useCallback(g=>{e(iL(pr(Math.round(g),1,600)))},[e]),d=c.useCallback(()=>{let g=Math.round(o*1.15);g===o&&(g+=1),l(g)},[l,o]),u=c.useCallback(()=>{let g=Math.round(o*.85);g===o&&(g-=1),l(g)},[l,o]),h=c.useCallback(g=>{l(RV(g))},[l]),p=c.useCallback(()=>{isNaN(Number(r))?(l(50),a(50)):l(r)},[r,l]),f=c.useCallback((g,x)=>{a(x)},[]),m=c.useCallback(g=>{g.key==="Enter"&&p()},[p]);return c.useEffect(()=>{a(o)},[o]),De({id:"decrementToolWidth",category:"canvas",callback:u,options:{enabled:s&&!n.isOpen},dependencies:[u,s,n.isOpen]}),De({id:"incrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),i.jsxs(es,{children:[i.jsxs(Q,{w:"min-content",gap:2,children:[i.jsx(J,{m:0,children:t("controlLayers.width")}),i.jsx(rm,{children:i.jsxs(Kx,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:r,onChange:f,onBlur:p,w:"76px",format:Cke,defaultValue:50,onKeyDown:m,clampValueOnBlur:!1,children:[i.jsx(Zx,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),i.jsx(ds,{children:i.jsx(le,{"aria-label":"open-slider",icon:i.jsx(Bi,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),i.jsxs(ts,{w:200,pt:0,pb:2,px:4,children:[i.jsx(po,{}),i.jsx(us,{children:i.jsx(Ze,{min:0,max:100,value:Ed(r),onChange:h,defaultValue:kke,marks:Ske,formatValue:wke,alwaysShowMarks:!0})})]})]})});OV.displayName="ToolEraserWidth";const NV=c.memo(()=>{const e=Lt(),t=re(e.tool.$tool);return t==="brush"?i.jsx(DV,{}):t==="eraser"?i.jsx(OV,{}):null});NV.displayName="ToolSettings";const FV=c.memo(()=>{const{t:e}=M(),t=Lt(),n=lt(),s=c.useCallback(()=>{t.tool.tools.bbox.fitToLayers()},[t.tool.tools.bbox]);return i.jsx(le,{onClick:s,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.fitBboxToLayers"),tooltip:e("controlLayers.fitBboxToLayers"),icon:i.jsx(cfe,{}),isDisabled:n})});FV.displayName="CanvasToolbarFitBboxToLayersButton";const $_=c.memo(()=>{const{t:e}=M(),t=G(),{newGallerySessionWithDialog:n}=bO(),{newCanvasSessionWithDialog:s}=vO(),o=c.useCallback(()=>{t(Ate())},[t]),r=c.useCallback(()=>{t(Mte())},[t]);return i.jsxs(i.Fragment,{children:[i.jsx(fe,{icon:i.jsx(xf,{}),onClick:n,children:e("controlLayers.newGallerySession")}),i.jsx(fe,{icon:i.jsx(xf,{}),onClick:s,children:e("controlLayers.newCanvasSession")}),i.jsx(fe,{icon:i.jsx(m1,{}),onClick:o,children:e("controlLayers.resetCanvasLayers")}),i.jsx(fe,{icon:i.jsx(m1,{}),onClick:r,children:e("controlLayers.resetGenerationSettings")})]})});$_.displayName="SessionMenuItems";const BV=c.memo(()=>{const{t:e}=M();return i.jsxs(on,{placement:"bottom-end",children:[i.jsx(rn,{as:le,"aria-label":e("controlLayers.newSession"),icon:i.jsx(xf,{}),variant:"link",alignSelf:"stretch"}),i.jsx(Et,{children:i.jsx($_,{})})]})});BV.displayName="CanvasToolbarNewSessionMenuButton";const $V=c.memo(()=>{const{t:e}=M(),t=G(),n=lt(),s=A(rL),o=c.useCallback(()=>{t(aL())},[t]);return i.jsx(le,{"aria-label":e("hotkeys.canvas.redo.title"),tooltip:e("hotkeys.canvas.redo.title"),onClick:o,icon:i.jsx(Spe,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});$V.displayName="CanvasToolbarRedoButton";const VV=c.memo(()=>{const{t:e}=M(),t=Lt(),n=Os("canvas"),s=$t();return De({id:"fitLayersToCanvas",category:"canvas",callback:t.stage.fitLayersToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),De({id:"fitBboxToCanvas",category:"canvas",callback:t.stage.fitBboxToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),De({id:"setZoomTo100Percent",category:"canvas",callback:()=>t.stage.setScale(1),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),De({id:"setZoomTo200Percent",category:"canvas",callback:()=>t.stage.setScale(2),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),De({id:"setZoomTo400Percent",category:"canvas",callback:()=>t.stage.setScale(4),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),De({id:"setZoomTo800Percent",category:"canvas",callback:()=>t.stage.setScale(8),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),i.jsx(le,{tooltip:e("hotkeys.canvas.fitLayersToCanvas.title"),"aria-label":e("hotkeys.canvas.fitLayersToCanvas.title"),onClick:t.stage.fitLayersToStage,icon:i.jsx(ky,{}),variant:"link",alignSelf:"stretch"})});VV.displayName="CanvasToolbarResetViewButton";const zV=c.memo(()=>{const{t:e}=M(),t=dl(),n=lt(),s=LB(),o=DB();return i.jsx(le,{variant:"link",alignSelf:"stretch",onClick:t?o:s,icon:i.jsx(ar,{}),"aria-label":e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),tooltip:e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),isDisabled:n})});zV.displayName="CanvasToolbarSaveToGalleryButton";function jke(e){return isNaN(Number(e))?"":`${Uf(Number(e),2).toLocaleString()}%`}function GV(e){return e<=40?10+90*e/40:e<=70?100+400*(e-40)/30:500+1500*(e-70)/30}function Fl(e){return e<=100?(e-10)*40/90:e<=500?40+(e-100)*30/400:70+(e-500)*30/1500}function _ke(e){return String(GV(e))}const Rw=[Fl(10),Fl(50),Fl(100),Fl(500),Fl(2e3)],Ike=Fl(100),Tke=Rw.slice(1,Rw.length-1),Ake={paddingInlineEnd:7,_focusVisible:{zIndex:0}},HV=c.memo(()=>{const e=Lt(),t=re(e.stage.$scale),[n,s]=c.useState(t*100),o=c.useCallback(d=>{let u=d;qS.get()||(u=lL(d,Tke,2));const h=GV(u);e.stage.setScale(h/100)},[e]),r=c.useCallback(()=>{if(isNaN(Number(n))){e.stage.setScale(1),s(100);return}e.stage.setScale(n/100)},[e,n]),a=c.useCallback((d,u)=>{s(u)},[]),l=c.useCallback(d=>{d.key==="Enter"&&r()},[r]);return c.useEffect(()=>{s(t*100)},[t]),i.jsxs(T,{alignItems:"center",children:[i.jsx(UV,{}),i.jsxs(es,{isLazy:!0,lazyBehavior:"unmount",children:[i.jsx(rm,{children:i.jsxs(Kx,{variant:"outline",display:"flex",alignItems:"center",min:e.stage.config.MIN_SCALE*100,max:e.stage.config.MAX_SCALE*100,value:n,onChange:a,onBlur:r,w:"76px",format:jke,defaultValue:100,onKeyDown:l,clampValueOnBlur:!1,children:[i.jsx(Zx,{title:"",sx:Ake}),i.jsx(ds,{children:i.jsx(le,{"aria-label":"open-slider",icon:i.jsx(Bi,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})}),i.jsxs(ts,{w:200,pt:0,pb:2,px:4,children:[i.jsx(po,{}),i.jsx(us,{children:i.jsx(Ze,{min:0,max:100,value:Fl(n),onChange:o,defaultValue:Ike,marks:Rw,formatValue:_ke,alwaysShowMarks:!0})})]})]}),i.jsx(qV,{})]})});HV.displayName="CanvasToolbarScale";const WV=[.1,.15,.2,.25,.5,.75,1,1.5,2,2.5,5,7.5,10,15,20],UV=c.memo(()=>{const e=Lt(),t=re(e.stage.$scale),n=c.useCallback(()=>{const s=e.stage.$scale.get(),o=WV.slice().reverse().find(r=>r<s)??e.stage.config.MIN_SCALE;e.stage.setScale(Math.max(o,e.stage.config.MIN_SCALE))},[e.stage]);return i.jsx(le,{onClick:n,icon:i.jsx(L7,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t<=e.stage.config.MIN_SCALE})});UV.displayName="ZoomOutButton";const qV=c.memo(()=>{const e=Lt(),t=re(e.stage.$scale),n=c.useCallback(()=>{const s=e.stage.$scale.get(),o=WV.find(r=>r>s)??e.stage.config.MAX_SCALE;e.stage.setScale(Math.min(o,e.stage.config.MAX_SCALE))},[e.stage]);return i.jsx(le,{onClick:n,icon:i.jsx(D7,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t>=e.stage.config.MAX_SCALE})});qV.displayName="ZoomInButton";const KV=c.memo(()=>{const{t:e}=M(),t=G(),n=lt(),s=A(cL),o=c.useCallback(()=>{t(dL())},[t]);return i.jsx(le,{"aria-label":e("hotkeys.canvas.undo.title"),tooltip:e("hotkeys.canvas.undo.title"),onClick:o,icon:i.jsx(Zs,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});KV.displayName="CanvasToolbarUndoButton";function ZV(){Pt(ZV.name);const e=G(),t=A(Mn),n=lt(),s=A(df),o=A(On),r=$t(),a=c.useCallback(()=>{t!==null&&e(WS({entityIdentifier:t}))},[e,t]),l=c.useMemo(()=>t!==null&&!n&&s==="layers"&&o==="canvas",[t,n,s,o]);De({id:"deleteSelected",category:"canvas",callback:a,options:{enabled:l&&!r.isOpen},dependencies:[l,a,r.isOpen]})}const Mke=()=>{const e=G(),[t,n]=c.useState(null),[s,o]=c.useState(null),r=A(Mn),a=A(Ete),l=$t();c.useEffect(()=>{(s==null?void 0:s.id)!==(r==null?void 0:r.id)&&(n(s),o(r))},[s,r]);const d=c.useCallback(()=>{a?(s==null?void 0:s.id)!==a.id?(n(s),o(a),e(Dd({entityIdentifier:a}))):t&&(o(t),e(Dd({entityIdentifier:t}))):t!==null&&s!==null&&(n(s),o(t),e(Dd({entityIdentifier:t})))},[a,s,e,t]);De({id:"quickSwitch",category:"canvas",callback:d,options:{enabled:!l.isOpen},dependencies:[d,l.isOpen]})},Eke=()=>{Pt("useCanvasFilterHotkey");const e=A(Mn),t=Qy(e);De({id:"filterSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})};function YV(){Pt(YV.name);const e=G(),t=A(Mn),n=lt(),s=Tr(t),o=Ro(t),r=$t(),a=c.useCallback(()=>{t===null||s===null||(s.bufferRenderer.clearBuffer(),e(nL({entityIdentifier:t})))},[s,e,t]),l=c.useMemo(()=>t!==null&&lC(t),[t]);De({id:"resetSelected",category:"canvas",callback:a,options:{enabled:l&&!n&&!o&&!r.isOpen},dependencies:[l,n,o,a,r.isOpen]})}const Pke=()=>{Pt("useCanvasTransformHotkey");const e=A(Mn),t=T_(e);De({id:"transformSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})},Lke=()=>{Pt("useCanvasUndoRedo");const e=Gx(),t=lt(),n=$t(),s=A(cL),o=c.useCallback(()=>{e(dL())},[e]);De({id:"undo",category:"canvas",callback:o,options:{enabled:s&&!t&&!n.isOpen,preventDefault:!0},dependencies:[s,t,o,n.isOpen]});const r=A(rL),a=c.useCallback(()=>{e(aL())},[e]);De({id:"redo",category:"canvas",callback:a,options:{enabled:r&&!t&&!n.isOpen,preventDefault:!0},dependencies:[r,a,t,n.isOpen]})},Dke=fn(Ye,e=>{const t=e.selectedEntityIdentifier,n=uL(e);let s=null;if(!t)s=n[0]??null;else{const o=n.findIndex(r=>r.id===t.id);s=n[(o+1)%n.length]??null}return s?ni(s):null}),Rke=fn(Ye,e=>{const t=e.selectedEntityIdentifier,n=uL(e);let s=null;if(!t)s=n[0]??null;else{const o=n.findIndex(r=>r.id===t.id);s=n[(o-1+n.length)%n.length]??null}return s?ni(s):null}),Oke=()=>{Pt("useNextPrevEntityHotkeys");const e=G(),t=A(Dke),n=A(Rke),s=c.useCallback(()=>{t&&e(Dd({entityIdentifier:t}))},[e,t]),o=c.useCallback(()=>{n&&e(Dd({entityIdentifier:n}))},[e,n]);Eo([""],o,{preventDefault:!0,ignoreModifiers:!0},[o]),De({category:"canvas",id:"prevEntity",callback:o,options:{preventDefault:!0},dependencies:[o]}),Eo([""],s,{preventDefault:!0,ignoreModifiers:!0},[s]),De({category:"canvas",id:"nextEntity",callback:s,options:{preventDefault:!0},dependencies:[s]})},XV=c.memo(()=>(YV(),ZV(),Lke(),Mke(),Oke(),Pke(),Eke(),i.jsxs(T,{w:"full",gap:2,alignItems:"center",children:[i.jsx(PV,{}),i.jsx(NV,{}),i.jsx(Je,{}),i.jsxs(T,{alignItems:"center",h:"full",children:[i.jsx(HV,{}),i.jsx(VV,{}),i.jsx(FV,{})]}),i.jsx(Ct,{orientation:"vertical"}),i.jsxs(T,{alignItems:"center",h:"full",children:[i.jsx(zV,{}),i.jsx(KV,{}),i.jsx($V,{}),i.jsx(BV,{}),i.jsx(CV,{})]})]})));XV.displayName="CanvasToolbar";const Nke=Ve.enum(["fill","contain","cover"]),QV=c.memo(({adapter:e})=>{const{t}=M(),[n,s]=c.useState("contain"),o=re(e.transformer.$isProcessing),r=c.useCallback(()=>{if(n==="contain"){e.transformer.fitToBboxContain();return}if(n==="cover"){e.transformer.fitToBboxCover();return}if(n==="fill"){e.transformer.fitToBboxFill();return}ve(!1)},[e.transformer,n]),a=c.useMemo(()=>[{value:"contain",label:t("controlLayers.transform.fitModeContain")},{value:"cover",label:t("controlLayers.transform.fitModeCover")},{value:"fill",label:t("controlLayers.transform.fitModeFill")}],[t]),l=c.useMemo(()=>a.find(u=>u.value===n)??null,[a,n]),d=c.useCallback(u=>{u&&s(Nke.parse(u.value))},[]);return i.jsxs(T,{gap:4,w:"full",children:[i.jsxs(Q,{maxW:64,children:[i.jsx(J,{m:0,children:t("controlLayers.transform.fitMode")}),i.jsx(Ke,{options:a,value:l,onChange:d,isSearchable:!1,isClearable:!1})]}),i.jsx(de,{size:"sm",onClick:r,isDisabled:o,loadingText:t("controlLayers.transform.fitToBbox"),variant:"ghost",children:t("controlLayers.transform.fitToBbox")})]})});QV.displayName="TransformFitToBboxButtons";const JV=c.memo(({adapter:e})=>{const{t}=M(),n=c.useRef(null);bm("canvas",n,{focusOnMount:!0});const s=Os("canvas"),o=re(e.transformer.$isProcessing),r=re(e.transformer.$silentTransform);return De({id:"applyTransform",category:"canvas",callback:e.transformer.applyTransform,options:{enabled:!o&&s},dependencies:[e.transformer,o,s]}),De({id:"cancelTransform",category:"canvas",callback:e.transformer.stopTransform,options:{enabled:!o&&s},dependencies:[e.transformer,o,s]}),r?null:i.jsxs(T,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[i.jsxs(T,{w:"full",gap:4,children:[i.jsx(zt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.transform.transform")}),i.jsx(Je,{}),i.jsx(Jy,{})]}),i.jsx(QV,{adapter:e}),i.jsxs(Qn,{isAttached:!1,size:"sm",w:"full",alignItems:"center",children:[o&&i.jsx(ci,{ms:3,boxSize:5,color:"base.600"}),i.jsx(Je,{}),i.jsx(de,{onClick:e.transformer.resetTransform,isDisabled:o,loadingText:t("controlLayers.transform.reset"),variant:"ghost",children:t("controlLayers.transform.reset")}),i.jsx(de,{onClick:e.transformer.applyTransform,isDisabled:o,loadingText:t("controlLayers.transform.apply"),variant:"ghost",children:t("controlLayers.transform.apply")}),i.jsx(de,{onClick:e.transformer.stopTransform,isDisabled:o,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.transform.cancel")})]})]})});JV.displayName="TransformContent";const Fke=()=>{const e=Lt(),t=re(e.stateApi.$transformingAdapter);return t?i.jsx(JV,{adapter:t}):null},ez=c.memo(()=>{const{t:e}=M(),t=G(),n=A(hL),s=A(ZS),o=c.useCallback(()=>{t(Kb("slider"))},[t]),r=c.useCallback(()=>{t(Kb("side-by-side"))},[t]),a=c.useCallback(()=>{t(Kb("hover"))},[t]),l=c.useCallback(()=>{t(Pte())},[t]);De({id:"swapImages",category:"viewer",callback:l,dependencies:[l]});const d=c.useCallback(()=>{t(Lte(s==="contain"?"fill":"contain"))},[t,s]),u=c.useCallback(()=>{t(Qf(null))},[t]);Eo("esc",u,[u]);const h=c.useCallback(()=>{t(Dte())},[t]);return De({id:"nextComparisonMode",category:"viewer",callback:h,dependencies:[h]}),i.jsxs(T,{w:"full",px:2,gap:2,bg:"base.750",borderTopRadius:"base",h:12,children:[i.jsx(T,{flex:1,justifyContent:"center",children:i.jsxs(T,{marginInlineEnd:"auto",alignItems:"center",children:[i.jsx(le,{icon:i.jsx(Lpe,{}),"aria-label":`${e("gallery.swapImages")} (C)`,tooltip:`${e("gallery.swapImages")} (C)`,onClick:l,variant:"link",alignSelf:"stretch"}),n!=="side-by-side"&&i.jsx(le,{"aria-label":e("gallery.stretchToFit"),tooltip:e("gallery.stretchToFit"),onClick:d,colorScheme:s==="fill"?"invokeBlue":"base",variant:"link",alignSelf:"stretch",icon:i.jsx(ky,{})})]})}),i.jsx(T,{flex:1,justifyContent:"center",children:i.jsxs(Qn,{variant:"outline",alignItems:"center",children:[i.jsx(de,{flexShrink:0,onClick:o,colorScheme:n==="slider"?"invokeBlue":"base",children:e("gallery.slider")}),i.jsx(de,{flexShrink:0,onClick:r,colorScheme:n==="side-by-side"?"invokeBlue":"base",children:e("gallery.sideBySide")}),i.jsx(de,{flexShrink:0,onClick:a,colorScheme:n==="hover"?"invokeBlue":"base",children:e("gallery.hover")})]})}),i.jsx(T,{flex:1,justifyContent:"center",children:i.jsxs(T,{gap:2,marginInlineStart:"auto",alignItems:"center",children:[i.jsx(Oe,{label:i.jsx(Bke,{}),children:i.jsx(T,{alignItems:"center",children:i.jsx(at,{boxSize:6,color:"base.300",as:Tfe,lineHeight:0})})}),i.jsx(de,{variant:"link",alignSelf:"stretch",px:2,"aria-label":`${e("gallery.exitCompare")} (Esc)`,tooltip:`${e("gallery.exitCompare")} (Esc)`,onClick:u,children:e("gallery.exitCompare")})]})})]})});ez.displayName="CompareToolbar";const Bke=()=>i.jsxs(ai,{children:[i.jsx(Ft,{children:i.jsx(Wt,{i18nKey:"gallery.compareHelp1",components:{Kbd:i.jsx(kp,{})}})}),i.jsx(Ft,{children:i.jsx(Wt,{i18nKey:"gallery.compareHelp2",components:{Kbd:i.jsx(kp,{})}})}),i.jsx(Ft,{children:i.jsx(Wt,{i18nKey:"gallery.compareHelp3",components:{Kbd:i.jsx(kp,{})}})}),i.jsx(Ft,{children:i.jsx(Wt,{i18nKey:"gallery.compareHelp4",components:{Kbd:i.jsx(kp,{})}})})]}),$ke=()=>{const{t:e}=M(),t=re(pL),[n,s]=c.useState(null);return c.useEffect(()=>{if(!t){s(null);return}if(t&&!t.startsWith("Loading model")){s(null);return}const o=setTimeout(()=>{s(`${e("common.loadingModel")}...`)},5e3);return()=>clearTimeout(o)},[t,e]),n},tz=c.memo(()=>{const{t:e}=M(),t=re(pL);return t?i.jsxs(wc,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[i.jsx(Sc,{}),i.jsx(nm,{children:e("common.generating")}),i.jsx(Ra,{children:t})]}):null});tz.displayName="CanvasAlertsInvocationProgressContentLocal";const nz=c.memo(()=>{const e=$ke();return e?i.jsxs(wc,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[i.jsx(Sc,{}),i.jsx(Ra,{children:e})]}):null});nz.displayName="CanvasAlertsInvocationProgressContentCommercial";const V_=c.memo(()=>{const e=A(fL);return A(q8)?e?i.jsx(tz,{}):null:i.jsx(nz,{})});V_.displayName="CanvasAlertsInvocationProgress";function Vke(){return{x:0,y:0}}function sz(e){var t=e.render,n=e.nativeSetDragImage,s=e.getOffset,o=s===void 0?Vke:s,r=document.createElement("div");Object.assign(r.style,{position:"fixed",top:0,left:0,zIndex:dR,pointerEvents:"none"}),document.body.append(r);var a=t({container:r});queueMicrotask(function(){var u=o({container:r});if(Mu()){var h=r.getBoundingClientRect();if(h.width===0)return;r.style.left="-".concat(h.width-1e-4,"px")}n==null||n(r,u.x,u.y)});function l(){d(),a==null||a(),document.body.removeChild(r)}var d=or({onDragStart:l,onDrop:l})}const $1=32;function iz({element:e,input:t}){return({container:n})=>{const s=e.getBoundingClientRect(),o=n.getBoundingClientRect();let r=t.clientX-s.x,a=t.clientY-s.y;return(a>o.height||r>o.width)&&(r=o.width/2,a=o.height/2),{x:r,y:a}}}function oz(e,t){e.animate([{backgroundColor:t},{}],{duration:700,easing:"cubic-bezier(0.25, 0.1, 0.25, 1.0)",iterations:1})}const Uu=e=>{if(!navigator.userAgent.includes("Firefox"))return YP;const t=new AbortController;return e.addEventListener("mouseover",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","false")},{signal:t.signal}),e.addEventListener("mouseout",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","true")},{signal:t.signal}),()=>{e.setAttribute("draggable","true"),t.abort()}},zke=Sr("img"),rz=c.memo(({imageDTO:e})=>i.jsx(T,{w:$1,h:$1,children:i.jsx(zke,{margin:"auto",maxW:"full",maxH:"full",objectFit:"contain",borderRadius:"base",src:e.thumbnail_url})}));rz.displayName="DndDragPreviewSingleImage";const az=e=>wu.createPortal(i.jsx(rz,{imageDTO:e.imageDTO}),e.container),lz=({singleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:o,location:r}=t;sz({render({container:a}){return n({type:"single-image",container:a,imageDTO:e.payload.imageDTO}),()=>n(null)},nativeSetDragImage:s,getOffset:iz({element:o.element,input:r.current.input})})},Gke={objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base",cursor:"grab","&[data-is-dragging=true]":{opacity:.3}},vl=c.memo(({imageDTO:e,asThumbnail:t,...n})=>{const s=cn(),[o,r]=c.useState(!1),[a,l]=c.useState(null),[d,u]=c.useState(null);return c.useEffect(()=>{if(a)return Xn(Uu(a),Eu({element:a,getInitialData:()=>An.getData({imageDTO:e},e.image_name),onDragStart:()=>{r(!0)},onDrop:()=>{r(!1)},onGenerateDragPreview:h=>{An.typeGuard(h.source.data)&&lz({singleImageDndData:h.source.data,onGenerateDragPreviewArgs:h,setDragPreviewState:u})}}))},[e,a,s]),WO(e,a),i.jsxs(i.Fragment,{children:[i.jsx(Zt,{role:"button",ref:l,src:t?e.thumbnail_url:e.image_url,fallbackSrc:t?void 0:e.thumbnail_url,w:e.width,sx:Gke,"data-is-dragging":o,...n}),(d==null?void 0:d.type)==="single-image"?az(d):null]})});vl.displayName="DndImage";const cz=e=>{const t=A(Rte),[n]=ml(e!=null&&e.has_workflow?e.image_name:null,t);return Ote(n??cs)};var n2={},rp={},s2={},GM;function z_(){return GM||(GM=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EolStyle=void 0,function(t){t[t.Crlf=0]="Crlf",t[t.Lf=1]="Lf"}(e.EolStyle||(e.EolStyle={}))}(s2)),s2}var i2={},HM;function G_(){return HM||(HM=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CommentPolicy=void 0,function(t){t[t.TreatAsError=0]="TreatAsError",t[t.Remove=1]="Remove",t[t.Preserve=2]="Preserve"}(e.CommentPolicy||(e.CommentPolicy={}))}(i2)),i2}var o2={},WM;function H_(){return WM||(WM=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NumberListAlignment=void 0,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Decimal=2]="Decimal",t[t.Normalize=3]="Normalize"}(e.NumberListAlignment||(e.NumberListAlignment={}))}(o2)),o2}var UM;function W_(){if(UM)return rp;UM=1,Object.defineProperty(rp,"__esModule",{value:!0}),rp.FracturedJsonOptions=void 0;const e=z_(),t=G_(),n=H_();let s=class{constructor(){this.JsonEolStyle=e.EolStyle.Lf,this.MaxInlineLength=2e9,this.MaxTotalLineLength=120,this.MaxInlineComplexity=2,this.MaxCompactArrayComplexity=1,this.MaxTableRowComplexity=2,this.MinCompactArrayRowItems=3,this.AlwaysExpandDepth=-1,this.NestedBracketPadding=!0,this.SimpleBracketPadding=!1,this.ColonPadding=!0,this.CommaPadding=!0,this.CommentPadding=!0,this.OmitTrailingWhitespace=!1,this.NumberListAlignment=n.NumberListAlignment.Normalize,this.IndentSpaces=4,this.UseTabToIndent=!1,this.PrefixString="",this.CommentPolicy=t.CommentPolicy.TreatAsError,this.PreserveBlankLines=!1,this.AllowTrailingCommas=!1}};return rp.FracturedJsonOptions=s,rp}var ap={},qM;function qu(){if(qM)return ap;qM=1,Object.defineProperty(ap,"__esModule",{value:!0}),ap.FracturedJsonError=void 0;let e=class extends Error{constructor(n,s){const o=s?`${n} at idx=${s.Index}, row=${s.Row}, col=${s.Column}`:n;super(o),this.InputPosition=s}};return ap.FracturedJsonError=e,ap}var lp={},cp={},KM;function Hke(){if(KM)return cp;KM=1,Object.defineProperty(cp,"__esModule",{value:!0}),cp.StringJoinBuffer=void 0;let e=class{constructor(n){this._lineBuff=[],this._docBuff=[],this._trimTrailingWhitespace=n}Add(...n){return this._lineBuff.push(...n),this}EndLine(n){return this.AddLineToWriter(n),this}Flush(){return this.AddLineToWriter(""),this}AsString(){return this._docBuff.join("")}AddLineToWriter(n){if(this._lineBuff.length===0&&n.length===0)return;let s=this._lineBuff.join("");this._trimTrailingWhitespace&&(s=s.trimEnd()),this._docBuff.push(s+n),this._lineBuff=[]}};return cp.StringJoinBuffer=e,cp}var dp={},r2={},ZM;function U_(){return ZM||(ZM=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.BracketPaddingType=void 0,function(t){t[t.Empty=0]="Empty",t[t.Simple=1]="Simple",t[t.Complex=2]="Complex"}(e.BracketPaddingType||(e.BracketPaddingType={}))}(r2)),r2}var a2={},YM;function Ku(){return YM||(YM=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonItemType=void 0,function(t){t[t.Null=0]="Null",t[t.False=1]="False",t[t.True=2]="True",t[t.String=3]="String",t[t.Number=4]="Number",t[t.Object=5]="Object",t[t.Array=6]="Array",t[t.BlankLine=7]="BlankLine",t[t.LineComment=8]="LineComment",t[t.BlockComment=9]="BlockComment"}(e.JsonItemType||(e.JsonItemType={}))}(a2)),a2}var XM;function Wke(){if(XM)return dp;XM=1,Object.defineProperty(dp,"__esModule",{value:!0}),dp.PaddedFormattingTokens=void 0;const e=U_(),t=z_(),n=Ku();let s=class{constructor(r,a){this._arrStart=[],this._arrStart[e.BracketPaddingType.Empty]="[",this._arrStart[e.BracketPaddingType.Simple]=r.SimpleBracketPadding?"[ ":"[",this._arrStart[e.BracketPaddingType.Complex]=r.NestedBracketPadding?"[ ":"[",this._arrEnd=[],this._arrEnd[e.BracketPaddingType.Empty]="]",this._arrEnd[e.BracketPaddingType.Simple]=r.SimpleBracketPadding?" ]":"]",this._arrEnd[e.BracketPaddingType.Complex]=r.NestedBracketPadding?" ]":"]",this._objStart=[],this._objStart[e.BracketPaddingType.Empty]="{",this._objStart[e.BracketPaddingType.Simple]=r.SimpleBracketPadding?"{ ":"{",this._objStart[e.BracketPaddingType.Complex]=r.NestedBracketPadding?"{ ":"{",this._objEnd=[],this._objEnd[e.BracketPaddingType.Empty]="}",this._objEnd[e.BracketPaddingType.Simple]=r.SimpleBracketPadding?" }":"}",this._objEnd[e.BracketPaddingType.Complex]=r.NestedBracketPadding?" }":"}",this._comma=r.CommaPadding?", ":",",this._colon=r.ColonPadding?": ":":",this._comment=r.CommentPadding?" ":"",this._eol=r.JsonEolStyle===t.EolStyle.Crlf?`\r
`:`
`,this._arrStartLen=this._arrStart.map(a),this._arrEndLen=this._arrEnd.map(a),this._objStartLen=this._objStart.map(a),this._objEndLen=this._objEnd.map(a),this._indentStrings=["",r.UseTabToIndent?"	":" ".repeat(r.IndentSpaces)],this._spaceStrings=[""," "],this._commaLen=a(this._comma),this._colonLen=a(this._colon),this._commentLen=a(this._comment),this._literalNullLen=a("null"),this._literalTrueLen=a("true"),this._literalFalseLen=a("false"),this._prefixStringLen=a(r.PrefixString),this._dummyComma=" ".repeat(this._commaLen)}get Comma(){return this._comma}get Colon(){return this._colon}get Comment(){return this._comment}get EOL(){return this._eol}get CommaLen(){return this._commaLen}get ColonLen(){return this._colonLen}get CommentLen(){return this._commentLen}get LiteralNullLen(){return this._literalNullLen}get LiteralTrueLen(){return this._literalTrueLen}get LiteralFalseLen(){return this._literalFalseLen}get PrefixStringLen(){return this._prefixStringLen}get DummyComma(){return this._dummyComma}ArrStart(r){return this._arrStart[r]}ArrEnd(r){return this._arrEnd[r]}ObjStart(r){return this._objStart[r]}ObjEnd(r){return this._objEnd[r]}Start(r,a){return r===n.JsonItemType.Array?this.ArrStart(a):this.ObjStart(a)}End(r,a){return r===n.JsonItemType.Array?this.ArrEnd(a):this.ObjEnd(a)}ArrStartLen(r){return this._arrStartLen[r]}ArrEndLen(r){return this._arrEndLen[r]}ObjStartLen(r){return this._objStartLen[r]}ObjEndLen(r){return this._objEndLen[r]}StartLen(r,a){return r===n.JsonItemType.Array?this.ArrStartLen(a):this.ObjStartLen(a)}EndLen(r,a){return r===n.JsonItemType.Array?this.ArrEndLen(a):this.ObjEndLen(a)}Indent(r){if(r>=this._indentStrings.length)for(let a=this._indentStrings.length;a<=r;++a)this._indentStrings.push(this._indentStrings[a-1]+this._indentStrings[1]);return this._indentStrings[r]}Spaces(r){if(r>=this._spaceStrings.length)for(let a=this._spaceStrings.length;a<=r;++a)this._spaceStrings.push(" ".repeat(a));return this._spaceStrings[r]}};return dp.PaddedFormattingTokens=s,dp}var up={},QM;function Uke(){if(QM)return up;QM=1,Object.defineProperty(up,"__esModule",{value:!0}),up.TableTemplate=void 0;const e=Ku(),t=U_(),n=H_();let s=class cd{constructor(r,a){this.LocationInParent=void 0,this.Type=e.JsonItemType.Null,this.IsRowDataCompatible=!0,this.RowCount=0,this.NameLength=0,this.SimpleValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.PadType=t.BracketPaddingType.Simple,this.AllowNumberNormalization=!1,this.IsNumberList=!1,this.CompositeValueLength=0,this.TotalLength=0,this.Children=[],this._maxDigBeforeDecRaw=0,this._maxDigAfterDecRaw=0,this._maxDigBeforeDecNorm=0,this._maxDigAfterDecNorm=0,this._pads=r,this._numberListAlignment=a,this.AllowNumberNormalization=a===n.NumberListAlignment.Normalize,this.IsNumberList=!0}MeasureTableRoot(r){for(const a of r.Children)this.MeasureRowSegment(a);this.PruneAndRecompute(Number.MAX_VALUE),this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.RowCount>=2)}TryToFit(r){for(let a=this.GetTemplateComplexity();a>=0;--a){if(this.TotalLength<=r)return!0;this.PruneAndRecompute(a-1)}return!1}FormatNumber(r,a){const l=this._numberListAlignment===n.NumberListAlignment.Normalize&&!this.AllowNumberNormalization?n.NumberListAlignment.Left:this._numberListAlignment;switch(l){case n.NumberListAlignment.Left:r.Add(a.Value,this._pads.Spaces(this.SimpleValueLength-a.ValueLength));return;case n.NumberListAlignment.Right:r.Add(this._pads.Spaces(this.SimpleValueLength-a.ValueLength),a.Value);return}let d,u,h,p;if(l===n.NumberListAlignment.Normalize){if(a.Type===e.JsonItemType.Null){r.Add(this._pads.Spaces(this._maxDigBeforeDecNorm-a.ValueLength),a.Value,this._pads.Spaces(this.CompositeValueLength-this._maxDigBeforeDecNorm));return}d=this._maxDigBeforeDecNorm,u=this._maxDigAfterDecNorm,h=Number(a.Value).toFixed(u),p=h.length}else d=this._maxDigBeforeDecRaw,u=this._maxDigAfterDecRaw,h=a.Value,p=a.ValueLength;let f,m;const g=h.search(cd._dotOrE);g>0?(f=d-g,m=this.CompositeValueLength-f-p):(f=d-p,m=this.CompositeValueLength-d),r.Add(this._pads.Spaces(f),h,this._pads.Spaces(m))}MeasureRowSegment(r){if(!(r.Type===e.JsonItemType.BlankLine||r.Type===e.JsonItemType.BlockComment||r.Type===e.JsonItemType.LineComment)&&(r.Type===e.JsonItemType.False||r.Type===e.JsonItemType.True?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.True||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.True,this.IsNumberList=!1):r.Type===e.JsonItemType.Number?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.Number||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.Number):r.Type===e.JsonItemType.Null?(this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,this._pads.LiteralNullLen),this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,this._pads.LiteralNullLen)):(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===r.Type||this.Type===e.JsonItemType.Null),this.Type===e.JsonItemType.Null&&(this.Type=r.Type),this.IsNumberList=!1),this.IsRowDataCompatible&&(this.IsRowDataCompatible=!r.RequiresMultipleLines),this.RowCount+=1,this.NameLength=Math.max(this.NameLength,r.NameLength),this.SimpleValueLength=Math.max(this.SimpleValueLength,r.ValueLength),this.MiddleCommentLength=Math.max(this.MiddleCommentLength,r.MiddleCommentLength),this.PrefixCommentLength=Math.max(this.PrefixCommentLength,r.PrefixCommentLength),this.PostfixCommentLength=Math.max(this.PostfixCommentLength,r.PostfixCommentLength),r.Complexity>=2&&(this.PadType=t.BracketPaddingType.Complex),!!this.IsRowDataCompatible)){if(r.Type===e.JsonItemType.Array)for(let a=0;a<r.Children.length;++a)this.Children.length<=a&&this.Children.push(new cd(this._pads,this._numberListAlignment)),this.Children[a].MeasureRowSegment(r.Children[a]);else if(r.Type===e.JsonItemType.Object){if(this.ContainsDuplicateKeys(r.Children)){this.IsRowDataCompatible=!1;return}for(const a of r.Children){let l=this.Children.find(d=>d.LocationInParent===a.Name);l||(l=new cd(this._pads,this._numberListAlignment),l.LocationInParent=a.Name,this.Children.push(l)),l.MeasureRowSegment(a)}}else if(r.Type===e.JsonItemType.Number&&this.IsNumberList){const l=Number(r.Value),d=l.toString();this.AllowNumberNormalization&&(this.AllowNumberNormalization=!isNaN(l)&&l!==1/0&&l!==-1/0&&d.length<=15&&d.indexOf("e")<0&&(l!==0||cd._trulyZeroValString.test(r.Value)));const u=d.indexOf(".");this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,u>=0?u:d.length),this._maxDigAfterDecNorm=Math.max(this._maxDigAfterDecNorm,u>=0?d.length-u-1:0);const h=r.Value.search(cd._dotOrE);this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,h>=0?h:r.ValueLength),this._maxDigAfterDecRaw=Math.max(this._maxDigAfterDecRaw,h>=0?r.ValueLength-h-1:0)}this.AllowNumberNormalization&&(this.AllowNumberNormalization=this.IsNumberList)}}PruneAndRecompute(r){(r<=0||!this.IsRowDataCompatible)&&(this.Children=[]);for(const a of this.Children)a.PruneAndRecompute(r-1);if(this.IsNumberList)this.CompositeValueLength=this.GetNumberFieldWidth();else if(this.Children.length>0){const a=this.Children.map(l=>l.TotalLength).reduce((l,d)=>l+d);this.CompositeValueLength=a+Math.max(0,this._pads.CommaLen*(this.Children.length-1))+this._pads.ArrStartLen(this.PadType)+this._pads.ArrEndLen(this.PadType)}else this.CompositeValueLength=this.SimpleValueLength;this.TotalLength=(this.PrefixCommentLength>0?this.PrefixCommentLength+this._pads.CommentLen:0)+(this.NameLength>0?this.NameLength+this._pads.ColonLen:0)+(this.MiddleCommentLength>0?this.MiddleCommentLength+this._pads.CommentLen:0)+this.CompositeValueLength+(this.PostfixCommentLength>0?this.PostfixCommentLength+this._pads.CommentLen:0)}GetTemplateComplexity(){if(this.Children.length===0)return 0;const r=this.Children.map(a=>a.GetTemplateComplexity());return 1+Math.max(...r)}ContainsDuplicateKeys(r){const a=r.map(l=>l.Name);return a.some((l,d)=>a.indexOf(l)!==d)}GetNumberFieldWidth(){if(this._numberListAlignment===n.NumberListAlignment.Normalize&&this.AllowNumberNormalization){const r=this._maxDigAfterDecNorm>0?1:0;return this._maxDigBeforeDecNorm+r+this._maxDigAfterDecNorm}else if(this._numberListAlignment===n.NumberListAlignment.Decimal){const r=this._maxDigAfterDecRaw>0?1:0;return this._maxDigBeforeDecRaw+r+this._maxDigAfterDecRaw}return this.SimpleValueLength}};return up.TableTemplate=s,s._trulyZeroValString=new RegExp("^-?[0.]+([eE].*)?$"),s._dotOrE=new RegExp("[.eE]"),up}var hp={},pp={},JM;function qke(){if(JM)return pp;JM=1,Object.defineProperty(pp,"__esModule",{value:!0}),pp.TokenEnumerator=void 0;const e=qu();let t=class{constructor(s){this._generator=s}get Current(){if(!this._current)throw new e.FracturedJsonError("Illegal enumerator usage");return this._current}MoveNext(){const s=this._generator.next();return this._current=s.value,!s.done}};return pp.TokenEnumerator=t,pp}var fp={},eE;function dz(){if(eE)return fp;eE=1,Object.defineProperty(fp,"__esModule",{value:!0}),fp.JsonItem=void 0;const e=Ku();let t=class{constructor(){this.Type=e.JsonItemType.Null,this.InputPosition={Index:0,Row:0,Column:0},this.Complexity=0,this.Name="",this.Value="",this.PrefixComment="",this.MiddleComment="",this.PostfixComment="",this.IsPostCommentLineStyle=!1,this.NameLength=0,this.ValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.MinimumTotalLength=0,this.RequiresMultipleLines=!1,this.Children=[]}};return fp.JsonItem=t,fp}var l2={},tE;function uz(){return tE||(tE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TokenType=void 0,function(t){t[t.Invalid=0]="Invalid",t[t.BeginArray=1]="BeginArray",t[t.EndArray=2]="EndArray",t[t.BeginObject=3]="BeginObject",t[t.EndObject=4]="EndObject",t[t.String=5]="String",t[t.Number=6]="Number",t[t.Null=7]="Null",t[t.True=8]="True",t[t.False=9]="False",t[t.BlockComment=10]="BlockComment",t[t.LineComment=11]="LineComment",t[t.BlankLine=12]="BlankLine",t[t.Comma=13]="Comma",t[t.Colon=14]="Colon"}(e.TokenType||(e.TokenType={}))}(l2)),l2}var mp={},gp={},nE;function Kke(){if(nE)return gp;nE=1,Object.defineProperty(gp,"__esModule",{value:!0}),gp.ScannerState=void 0;const e=qu();let t=class{constructor(o){this.CurrentPosition={Index:0,Row:0,Column:0},this.TokenPosition={Index:0,Row:0,Column:0},this.NonWhitespaceSinceLastNewline=!1,this._originalText=o}Advance(o){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Column+=1,this.NonWhitespaceSinceLastNewline||(this.NonWhitespaceSinceLastNewline=!o)}NewLine(){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Row+=1,this.CurrentPosition.Column=0,this.NonWhitespaceSinceLastNewline=!1}SetTokenStart(){this.TokenPosition=Object.assign({},this.CurrentPosition)}MakeTokenFromBuffer(o,r=!1){const a=this._originalText.substring(this.TokenPosition.Index,this.CurrentPosition.Index);return{Type:o,Text:r?a.trimEnd():a,InputPosition:Object.assign({},this.TokenPosition)}}MakeToken(o,r){return{Type:o,Text:r,InputPosition:Object.assign({},this.TokenPosition)}}Current(){return this.AtEnd()?NaN:this._originalText.charCodeAt(this.CurrentPosition.Index)}AtEnd(){return this.CurrentPosition.Index>=this._originalText.length}Throw(o){throw new e.FracturedJsonError(o,this.CurrentPosition)}};gp.ScannerState=t;const n=2e9;return gp}var sE;function Zke(){if(sE)return mp;sE=1,Object.defineProperty(mp,"__esModule",{value:!0}),mp.TokenGenerator=void 0;const e=Kke(),t=uz();function*n(F){const q=new e.ScannerState(F);for(;;){if(q.AtEnd())return;const ie=q.Current();switch(ie){case d:case p:case h:q.Advance(!0);break;case u:q.NonWhitespaceSinceLastNewline||(yield q.MakeToken(t.TokenType.BlankLine,`
`)),q.NewLine(),q.SetTokenStart();break;case b:yield s(q,"{",t.TokenType.BeginObject);break;case C:yield s(q,"}",t.TokenType.EndObject);break;case y:yield s(q,"[",t.TokenType.BeginArray);break;case v:yield s(q,"]",t.TokenType.EndArray);break;case w:yield s(q,":",t.TokenType.Colon);break;case k:yield s(q,",",t.TokenType.Comma);break;case oe:yield o(q,"true",t.TokenType.True);break;case B:yield o(q,"false",t.TokenType.False);break;case ee:yield o(q,"null",t.TokenType.Null);break;case f:yield r(q);break;case x:yield a(q);break;case P:yield l(q);break;default:H(ie)||q.Throw("Unexpected character"),yield l(q);break}}}mp.TokenGenerator=n;function s(F,q,ie){F.SetTokenStart();const ce=F.MakeToken(ie,q);return F.Advance(!1),ce}function o(F,q,ie){F.SetTokenStart();for(let me=1;me<q.length;++me)F.AtEnd()&&F.Throw("Unexpected end of input while processing keyword"),F.Advance(!1),F.Current()!==q.charCodeAt(me)&&F.Throw("Unexpected keyword");const ce=F.MakeToken(ie,q);return F.Advance(!1),ce}function r(F){F.SetTokenStart(),F.AtEnd()&&F.Throw("Unexpected end of input while processing comment"),F.Advance(!1);let q=!1;F.Current()===m?q=!0:F.Current()!==f&&F.Throw("Bad character for start of comment"),F.Advance(!1);let ie=!1;for(;;){if(F.AtEnd())if(q)F.Throw("Unexpected end of input while processing comment");else return F.MakeTokenFromBuffer(t.TokenType.LineComment,!0);const ce=F.Current();if(ce===u){if(F.NewLine(),!q)return F.MakeTokenFromBuffer(t.TokenType.LineComment,!0);continue}if(F.Advance(!1),ce===f&&ie)return F.MakeTokenFromBuffer(t.TokenType.BlockComment);ie=ce===m}}function a(F){F.SetTokenStart(),F.Advance(!1);let q=!1,ie=0;for(;;){F.AtEnd()&&F.Throw("Unexpected end of input while processing string");const ce=F.Current();if(ie>0){z(ce)||F.Throw("Bad unicode escape in string"),ie-=1,F.Advance(!1);continue}if(q){Z(ce)||F.Throw("Bad escaped character in string"),ce===te&&(ie=4),q=!1,F.Advance(!1);continue}if(U(ce)&&F.Throw("Control characters are not allowed in strings"),F.Advance(!1),ce===x)return F.MakeTokenFromBuffer(t.TokenType.String);ce===g&&(q=!0)}}function l(F){F.SetTokenStart();let q=Y.Beginning;for(;;){const ie=F.Current();let ce=$.ValidAndConsumed;switch(q){case Y.Beginning:ie===P?q=Y.PastLeadingSign:ie===L?q=Y.PastWhole:H(ie)?q=Y.PastFirstDigitOfWhole:ce=$.InvalidatesToken;break;case Y.PastLeadingSign:H(ie)?ie===L?q=Y.PastWhole:q=Y.PastFirstDigitOfWhole:ce=$.InvalidatesToken;break;case Y.PastFirstDigitOfWhole:ie===E?q=Y.PastDecimalPoint:ie===R||ie===D?q=Y.PastE:H(ie)||(ce=$.StartOfNewToken);break;case Y.PastWhole:ie===E?q=Y.PastDecimalPoint:ie===R||ie===D?q=Y.PastE:ce=$.StartOfNewToken;break;case Y.PastDecimalPoint:H(ie)?q=Y.PastFirstDigitOfFractional:ce=$.InvalidatesToken;break;case Y.PastFirstDigitOfFractional:ie===R||ie===D?q=Y.PastE:H(ie)||(ce=$.StartOfNewToken);break;case Y.PastE:ie===S||ie===P?q=Y.PastExpSign:H(ie)?q=Y.PastFirstDigitOfExponent:ce=$.InvalidatesToken;break;case Y.PastExpSign:H(ie)?q=Y.PastFirstDigitOfExponent:ce=$.InvalidatesToken;break;case Y.PastFirstDigitOfExponent:H(ie)||(ce=$.StartOfNewToken);break}if(ce===$.InvalidatesToken&&F.Throw("Bad character while processing number"),ce===$.StartOfNewToken)return F.MakeTokenFromBuffer(t.TokenType.Number);if(!F.AtEnd()){F.Advance(!1);continue}switch(q){case Y.PastFirstDigitOfWhole:case Y.PastWhole:case Y.PastFirstDigitOfFractional:case Y.PastFirstDigitOfExponent:return F.MakeTokenFromBuffer(t.TokenType.Number);default:F.Throw("Unexpected end of input while processing number");break}}}const d=32,u=10,h=13,p=9,f=47,m=42,g=92,x=34,b=123,C=125,y=91,v=93,w=58,k=44,S=43,P=45,E=46,L=48,I=57,O=97,N=65,_=98,R=101,D=69,B=102,V=70,ee=110,se=114,oe=116,te=117;function H(F){return F>=L&&F<=I}function z(F){return F>=L&&F<=I||F>=O&&F<=B||F>=N&&F<=V}function Z(F){switch(F){case x:case g:case f:case _:case B:case ee:case se:case oe:case te:return!0;default:return!1}}function U(F){return F>=0&&F<=31||F===127||F>=128&&F<=159}var Y;(function(F){F[F.Beginning=0]="Beginning",F[F.PastLeadingSign=1]="PastLeadingSign",F[F.PastFirstDigitOfWhole=2]="PastFirstDigitOfWhole",F[F.PastWhole=3]="PastWhole",F[F.PastDecimalPoint=4]="PastDecimalPoint",F[F.PastFirstDigitOfFractional=5]="PastFirstDigitOfFractional",F[F.PastE=6]="PastE",F[F.PastExpSign=7]="PastExpSign",F[F.PastFirstDigitOfExponent=8]="PastFirstDigitOfExponent"})(Y||(Y={}));var $;return function(F){F[F.InvalidatesToken=0]="InvalidatesToken",F[F.ValidAndConsumed=1]="ValidAndConsumed",F[F.StartOfNewToken=2]="StartOfNewToken"}($||($={})),mp}var iE;function Yke(){if(iE)return hp;iE=1,Object.defineProperty(hp,"__esModule",{value:!0}),hp.Parser=void 0;const e=W_(),t=qke(),n=dz(),s=Ku(),o=uz(),r=qu(),a=G_(),l=Zke();let d=class dd{constructor(){this.Options=new e.FracturedJsonOptions}ParseTopLevel(f,m){const g=new t.TokenEnumerator((0,l.TokenGenerator)(f));return this.ParseTopLevelFromEnum(g,m)}ParseTopLevelFromEnum(f,m){const g=[];let x=!1;for(;;){if(!f.MoveNext())return g;const b=this.ParseItem(f),C=b.Type===s.JsonItemType.BlockComment||b.Type===s.JsonItemType.LineComment;if(b.Type===s.JsonItemType.BlankLine)this.Options.PreserveBlankLines&&g.push(b);else if(C){if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new r.FracturedJsonError("Comments not allowed with current options",b.InputPosition);this.Options.CommentPolicy===a.CommentPolicy.Preserve&&g.push(b)}else{if(m&&x)throw new r.FracturedJsonError("Unexpected start of second top level element",b.InputPosition);g.push(b),x=!0}}}ParseItem(f){switch(f.Current.Type){case o.TokenType.BeginArray:return this.ParseArray(f);case o.TokenType.BeginObject:return this.ParseObject(f);default:return this.ParseSimple(f.Current)}}ParseSimple(f){const m=new n.JsonItem;return m.Type=dd.ItemTypeFromTokenType(f),m.Value=f.Text,m.InputPosition=f.InputPosition,m.Complexity=0,m}ParseArray(f){if(f.Current.Type!==o.TokenType.BeginArray)throw new r.FracturedJsonError("Parser logic error",f.Current.InputPosition);const m=f.Current.InputPosition;let g,x=-1,b;const C=[];let y=u.EmptyCollection,v=!1,w=0;for(;!v;){const S=dd.GetNextTokenOrThrow(f,m);switch(b&&((b==null?void 0:b.InputPosition.Row)!==S.InputPosition.Row||S.Type===o.TokenType.EndArray)&&(g?(g.PostfixComment=b.Value,g.IsPostCommentLineStyle=b.Type===s.JsonItemType.LineComment):C.push(b),b=void 0),g&&x!==S.InputPosition.Row&&(g=void 0),S.Type){case o.TokenType.EndArray:if(y===u.CommaSeen&&!this.Options.AllowTrailingCommas)throw new r.FracturedJsonError("Array may not end with a comma with current options",S.InputPosition);v=!0;break;case o.TokenType.Comma:if(y!==u.ElementSeen)throw new r.FracturedJsonError("Unexpected comma in array",S.InputPosition);y=u.CommaSeen;break;case o.TokenType.BlankLine:if(!this.Options.PreserveBlankLines)break;C.push(this.ParseSimple(S));break;case o.TokenType.BlockComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new r.FracturedJsonError("Comments not allowed with current options",S.InputPosition);b&&(C.push(b),b=void 0);const E=this.ParseSimple(S);if(dd.IsMultilineComment(E)){C.push(E);break}if(g&&y===u.ElementSeen){g.PostfixComment=E.Value,g.IsPostCommentLineStyle=!1,g=void 0;break}b=E;break;case o.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new r.FracturedJsonError("Comments not allowed with current options",S.InputPosition);if(b){C.push(b),C.push(this.ParseSimple(S)),b=void 0;break}if(g){g.PostfixComment=S.Text,g.IsPostCommentLineStyle=!0,g=void 0;break}C.push(this.ParseSimple(S));break;case o.TokenType.False:case o.TokenType.True:case o.TokenType.Null:case o.TokenType.String:case o.TokenType.Number:case o.TokenType.BeginArray:case o.TokenType.BeginObject:if(y===u.ElementSeen)throw new r.FracturedJsonError("Comma missing while processing array",S.InputPosition);const L=this.ParseItem(f);y=u.ElementSeen,w=Math.max(w,L.Complexity+1),b&&(L.PrefixComment=b.Value,b=void 0),C.push(L),g=L,x=f.Current.InputPosition.Row;break;default:throw new r.FracturedJsonError("Unexpected token in array",S.InputPosition)}}const k=new n.JsonItem;return k.Type=s.JsonItemType.Array,k.InputPosition=m,k.Complexity=w,k.Children=C,k}ParseObject(f){if(f.Current.Type!==o.TokenType.BeginObject)throw new r.FracturedJsonError("Parser logic error",f.Current.InputPosition);const m=f.Current.InputPosition,g=[];let x,b,C=-1,y=[],v=[],w,k=!1,S=h.BeforePropName,P=0,E=!1;for(;!E;){const I=dd.GetNextTokenOrThrow(f,m),O=C!==I.InputPosition.Row,N=I.Type===o.TokenType.EndObject,_=I.Type===o.TokenType.String&&S===h.AfterComma,R=w&&(I.Type===o.TokenType.BlockComment||I.Type===o.TokenType.LineComment);if(x&&b&&(O||N||_||R)){let B;_&&k&&!O&&(B=w,w=void 0),dd.AttachObjectValuePieces(g,x,b,C,y,v,w),P=Math.max(P,b.Complexity+1),x=void 0,b=void 0,y=[],v=[],w=void 0,B&&y.push(B)}switch(I.Type){case o.TokenType.BlankLine:if(!this.Options.PreserveBlankLines||S===h.AfterPropName||S===h.AfterColon)break;g.push(...y),y=[],g.push(this.ParseSimple(I));break;case o.TokenType.BlockComment:case o.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new r.FracturedJsonError("Comments not allowed with current options",I.InputPosition);S===h.BeforePropName||!x?y.push(this.ParseSimple(I)):S===h.AfterPropName||S===h.AfterColon?v.push(I):(w=this.ParseSimple(I),k=S===h.AfterComma);break;case o.TokenType.EndObject:if(S===h.AfterPropName||S===h.AfterColon)throw new r.FracturedJsonError("Unexpected end of object",I.InputPosition);E=!0;break;case o.TokenType.String:if(S===h.BeforePropName||S===h.AfterComma)x=I,S=h.AfterPropName;else if(S===h.AfterColon)b=this.ParseItem(f),C=f.Current.InputPosition.Row,S=h.AfterPropValue;else throw new r.FracturedJsonError("Unexpected string found while processing object",I.InputPosition);break;case o.TokenType.False:case o.TokenType.True:case o.TokenType.Null:case o.TokenType.Number:case o.TokenType.BeginArray:case o.TokenType.BeginObject:if(S!==h.AfterColon)throw new r.FracturedJsonError("Unexpected element while processing object",I.InputPosition);b=this.ParseItem(f),C=f.Current.InputPosition.Row,S=h.AfterPropValue;break;case o.TokenType.Colon:if(S!==h.AfterPropName)throw new r.FracturedJsonError("Unexpected colon while processing object",I.InputPosition);S=h.AfterColon;break;case o.TokenType.Comma:if(S!==h.AfterPropValue)throw new r.FracturedJsonError("Unexpected comma while processing object",I.InputPosition);S=h.AfterComma;break;default:throw new r.FracturedJsonError("Unexpected token while processing object",I.InputPosition)}}if(!this.Options.AllowTrailingCommas&&S===h.AfterComma)throw new r.FracturedJsonError("Object may not end with comma with current options",f.Current.InputPosition);const L=new n.JsonItem;return L.Type=s.JsonItemType.Object,L.InputPosition=m,L.Complexity=P,L.Children=g,L}static ItemTypeFromTokenType(f){switch(f.Type){case o.TokenType.False:return s.JsonItemType.False;case o.TokenType.True:return s.JsonItemType.True;case o.TokenType.Null:return s.JsonItemType.Null;case o.TokenType.Number:return s.JsonItemType.Number;case o.TokenType.String:return s.JsonItemType.String;case o.TokenType.BlankLine:return s.JsonItemType.BlankLine;case o.TokenType.BlockComment:return s.JsonItemType.BlockComment;case o.TokenType.LineComment:return s.JsonItemType.LineComment;default:throw new r.FracturedJsonError("Unexpected Token",f.InputPosition)}}static GetNextTokenOrThrow(f,m){if(!f.MoveNext())throw new r.FracturedJsonError("Unexpected end of input while processing array or object starting",m);return f.Current}static IsMultilineComment(f){return f.Type===s.JsonItemType.BlockComment&&f.Value.includes(`
`)}static AttachObjectValuePieces(f,m,g,x,b,C,y){if(g.Name=m.Text,C.length>0){let v="";for(let w=0;w<C.length;++w)v+=C[w].Text,(w<C.length-1||C[w].Type===o.TokenType.LineComment)&&(v+=`
`);g.MiddleComment=v}if(b.length>0){const v=b.pop();v.Type===s.JsonItemType.BlockComment&&v.InputPosition.Row===g.InputPosition.Row?(g.PrefixComment=v.Value,f.push(...b)):(f.push(...b),f.push(v))}f.push(g),y&&(!this.IsMultilineComment(y)&&y.InputPosition.Row===x?(g.PostfixComment=y.Value,g.IsPostCommentLineStyle=y.Type===s.JsonItemType.LineComment):f.push(y))}};hp.Parser=d;var u;(function(p){p[p.EmptyCollection=0]="EmptyCollection",p[p.ElementSeen=1]="ElementSeen",p[p.CommaSeen=2]="CommaSeen"})(u||(u={}));var h;return function(p){p[p.BeforePropName=0]="BeforePropName",p[p.AfterPropName=1]="AfterPropName",p[p.AfterColon=2]="AfterColon",p[p.AfterPropValue=3]="AfterPropValue",p[p.AfterComma=4]="AfterComma"}(h||(h={})),hp}var xp={},oE;function Xke(){if(oE)return xp;oE=1,Object.defineProperty(xp,"__esModule",{value:!0}),xp.ConvertDataToDom=void 0;const e=dz(),t=Ku(),n=qu();function s(o,r,a=100){var l;if(a<=0)throw new n.FracturedJsonError("Depth limit exceeded - possible circular reference");const d=typeof o;switch(d){case"function":case"symbol":case"undefined":return}if(o&&o.toJSON){const h=JSON.parse(JSON.stringify(o));return s(h,r,a-1)}const u=new e.JsonItem;if(u.Name=r?JSON.stringify(r):"",o===null)u.Type=t.JsonItemType.Null,u.Value="null";else if(Array.isArray(o)){u.Type=t.JsonItemType.Array,u.Children=o.map(h=>{var p;return(p=s(h,void 0,a-1))!==null&&p!==void 0?p:s(null,void 0,a-1)}),u.Children=[];for(let h=0;h<o.length;++h)u.Children[h]=(l=s(o[h],void 0,a-1))!==null&&l!==void 0?l:s(null,void 0,a-1)}else if(d==="object"){u.Type=t.JsonItemType.Object;for(const h of Object.entries(o)){const p=s(h[1],h[0],a-1);p&&u.Children.push(p)}}else{switch(d){case"string":u.Type=t.JsonItemType.String;break;case"number":case"bigint":u.Type=t.JsonItemType.Number;break;case"boolean":u.Type=o?t.JsonItemType.True:t.JsonItemType.False;break}u.Value=JSON.stringify(o)}if(u.Children.length>0){const h=u.Children.map(p=>p.Complexity).reduce((p,f)=>Math.max(p,f));u.Complexity=h+1}return u}return xp.ConvertDataToDom=s,xp}var rE;function Qke(){if(rE)return lp;rE=1,Object.defineProperty(lp,"__esModule",{value:!0}),lp.Formatter=void 0;const e=W_(),t=Hke(),n=Wke(),s=Ku(),o=U_(),r=Uke(),a=qu(),l=Yke(),d=Xke();let u=class Vs{constructor(){this.Options=new e.FracturedJsonOptions,this.StringLengthFunc=Vs.StringLengthByCharCount,this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),this._pads=new n.PaddedFormattingTokens(new e.FracturedJsonOptions,Vs.StringLengthByCharCount)}static StringLengthByCharCount(p){return p.length}Reformat(p,f=0){const m=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),g=new l.Parser;g.Options=this.Options;const x=g.ParseTopLevel(p,!0);return this.FormatTopLevel(x,f,m),m.Flush(),m.AsString()}Serialize(p,f=0,m=100){const g=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),x=(0,d.ConvertDataToDom)(p,void 0,m);if(x)return this.FormatTopLevel([x],f,g),g.Flush(),g.AsString()}Minify(p){const f=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),m=new l.Parser;m.Options=this.Options;const g=m.ParseTopLevel(p,!0);return this.MinifyTopLevel(g,f),f.Flush(),f.AsString()}FormatTopLevel(p,f,m){this._buffer=m,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);for(const g of p)this.ComputeItemLengths(g),this.FormatItem(g,f,!1);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}MinifyTopLevel(p,f){this._buffer=f,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);let m=!0;for(const g of p)m=this.MinifyItem(g,m);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}ComputeItemLengths(p){const f=`
`;for(const m of p.Children)this.ComputeItemLengths(m);switch(p.Type){case s.JsonItemType.Null:p.ValueLength=this._pads.LiteralNullLen;break;case s.JsonItemType.True:p.ValueLength=this._pads.LiteralTrueLen;break;case s.JsonItemType.False:p.ValueLength=this._pads.LiteralFalseLen;break;default:p.ValueLength=this.StringLengthFunc(p.Value);break}if(p.NameLength=this.StringLengthFunc(p.Name),p.PrefixCommentLength=this.StringLengthFunc(p.PrefixComment),p.MiddleCommentLength=this.StringLengthFunc(p.MiddleComment),p.PostfixCommentLength=this.StringLengthFunc(p.PostfixComment),p.RequiresMultipleLines=Vs.IsCommentOrBlankLine(p.Type)||p.Children.some(m=>m.RequiresMultipleLines||m.IsPostCommentLineStyle)||p.PrefixComment.indexOf(f)>=0||p.MiddleComment.indexOf(f)>=0||p.PostfixComment.indexOf(f)>=0||p.Value.indexOf(f)>=0,p.Type===s.JsonItemType.Array||p.Type===s.JsonItemType.Object){const m=Vs.GetPaddingType(p);p.ValueLength=this._pads.StartLen(p.Type,m)+this._pads.EndLen(p.Type,m)+p.Children.map(g=>g.MinimumTotalLength).reduce((g,x)=>g+x,0)+Math.max(0,this._pads.CommaLen*(p.Children.length-1))}p.MinimumTotalLength=(p.PrefixCommentLength>0?p.PrefixCommentLength+this._pads.CommentLen:0)+(p.NameLength>0?p.NameLength+this._pads.ColonLen:0)+(p.MiddleCommentLength>0?p.MiddleCommentLength+this._pads.CommentLen:0)+p.ValueLength+(p.PostfixCommentLength>0?p.PostfixCommentLength+this._pads.CommentLen:0)}FormatItem(p,f,m){switch(p.Type){case s.JsonItemType.Array:case s.JsonItemType.Object:this.FormatContainer(p,f,m);break;case s.JsonItemType.BlankLine:this.FormatBlankLine();break;case s.JsonItemType.BlockComment:case s.JsonItemType.LineComment:this.FormatStandaloneComment(p,f);break;default:p.RequiresMultipleLines?this.FormatSplitKeyValue(p,f,m):this.FormatInlineElement(p,f,m);break}}FormatContainer(p,f,m){f>this.Options.AlwaysExpandDepth&&(this.FormatContainerInline(p,f,m)||this.FormatContainerCompactMultiline(p,f,m))||f>=this.Options.AlwaysExpandDepth&&this.FormatContainerTable(p,f,m)||this.FormatContainerExpanded(p,f,m)}FormatContainerInline(p,f,m){if(p.RequiresMultipleLines)return!1;const g=p.MinimumTotalLength+(m?this._pads.CommaLen:0);return p.Complexity>this.Options.MaxInlineComplexity||g>this.AvailableLineSpace(f)?!1:(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(f)),this.InlineElement(p,m),this._buffer.EndLine(this._pads.EOL),!0)}FormatContainerCompactMultiline(p,f,m){if(p.Type!==s.JsonItemType.Array||p.Complexity>this.Options.MaxCompactArrayComplexity||p.RequiresMultipleLines)return!1;const g=new r.TableTemplate(this._pads,this.Options.NumberListAlignment);g.MeasureTableRoot(p);const x=this.AvailableLineSpace(f+1);let b=this._pads.CommaLen;if(g.IsRowDataCompatible?b+=g.TotalLength:b+=p.Children.map(w=>w.MinimumTotalLength).reduce((w,k)=>w+k,0)/p.Children.length,b*this.Options.MinCompactArrayRowItems>x)return!1;const C=this.StandardFormatStart(p,f);this._buffer.Add(this._pads.Start(p.Type,o.BracketPaddingType.Empty));const y=this.AvailableLineSpace(C+1);let v=-1;for(let w=0;w<p.Children.length;++w){const k=p.Children[w],S=w<p.Children.length-1,P=(S?this._pads.CommaLen:0)+(g.IsRowDataCompatible?g.TotalLength:k.MinimumTotalLength);v<P&&(this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C+1)),v=y),g.IsRowDataCompatible?this.InlineTableRowSegment(g,k,S,!1):this.InlineElement(k,S),v-=P}return this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(p.Type,o.BracketPaddingType.Empty)),this.StandardFormatEnd(p,m),!0}FormatContainerTable(p,f,m){if(p.Complexity>this.Options.MaxTableRowComplexity+1)return!1;const g=this.AvailableLineSpace(f+1)-this._pads.CommaLen;if(p.Children.filter(v=>!Vs.IsCommentOrBlankLine(v.Type)).some(v=>v.MinimumTotalLength>g))return!1;const b=new r.TableTemplate(this._pads,this.Options.NumberListAlignment);if(b.MeasureTableRoot(p),!b.IsRowDataCompatible||!b.TryToFit(g))return!1;const C=this.StandardFormatStart(p,f);this._buffer.Add(this._pads.Start(p.Type,o.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const y=Vs.IndexOfLastElement(p.Children);for(let v=0;v<p.Children.length;++v){const w=p.Children[v];if(w.Type===s.JsonItemType.BlankLine){this.FormatBlankLine();continue}if(w.Type===s.JsonItemType.LineComment||w.Type===s.JsonItemType.BlockComment){this.FormatStandaloneComment(w,C+1);continue}this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C+1)),this.InlineTableRowSegment(b,w,v<y,!0),this._buffer.EndLine(this._pads.EOL)}return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(p.Type,o.BracketPaddingType.Empty)),this.StandardFormatEnd(p,m),!0}FormatContainerExpanded(p,f,m){const g=this.StandardFormatStart(p,f);this._buffer.Add(this._pads.Start(p.Type,o.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const x=Vs.IndexOfLastElement(p.Children);for(let b=0;b<p.Children.length;++b)this.FormatItem(p.Children[b],g+1,b<x);this._buffer.Add(this.Options.PrefixString,this._pads.Indent(g),this._pads.End(p.Type,o.BracketPaddingType.Empty)),this.StandardFormatEnd(p,m)}FormatStandaloneComment(p,f){const m=Vs.NormalizeMultilineComment(p.Value,p.InputPosition.Column);for(const g of m)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(f),g).EndLine(this._pads.EOL)}FormatBlankLine(){this._buffer.Add(this.Options.PrefixString).EndLine(this._pads.EOL)}FormatInlineElement(p,f,m){this._buffer.Add(this.Options.PrefixString,this._pads.Indent(f)),this.InlineElement(p,m),this._buffer.EndLine(this._pads.EOL)}FormatSplitKeyValue(p,f,m){this.StandardFormatStart(p,f),this._buffer.Add(p.Value),this.StandardFormatEnd(p,m)}StandardFormatStart(p,f){if(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(f)),p.PrefixCommentLength>0&&this._buffer.Add(p.PrefixComment,this._pads.Comment),p.NameLength>0&&this._buffer.Add(p.Name,this._pads.Colon),p.MiddleCommentLength===0)return f;if(p.MiddleComment.indexOf(`
`)<0)return this._buffer.Add(p.MiddleComment,this._pads.Comment),f;const m=Vs.NormalizeMultilineComment(p.MiddleComment,Number.MAX_VALUE);this._buffer.EndLine(this._pads.EOL);for(const g of m)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(f+1),g).EndLine(this._pads.EOL);return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(f+1)),f+1}StandardFormatEnd(p,f){f&&p.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),p.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,p.PostfixComment),f&&!p.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),this._buffer.EndLine(this._pads.EOL)}InlineElement(p,f){if(p.RequiresMultipleLines)throw new a.FracturedJsonError("Logic error - trying to inline invalid element");p.PrefixCommentLength>0&&this._buffer.Add(p.PrefixComment,this._pads.Comment),p.NameLength>0&&this._buffer.Add(p.Name,this._pads.Colon),p.MiddleCommentLength>0&&this._buffer.Add(p.MiddleComment,this._pads.Comment),this.InlineElementRaw(p),f&&p.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),p.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,p.PostfixComment),f&&!p.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma)}InlineElementRaw(p){if(p.Type===s.JsonItemType.Array){const f=Vs.GetPaddingType(p);this._buffer.Add(this._pads.ArrStart(f));for(let m=0;m<p.Children.length;++m)this.InlineElement(p.Children[m],m<p.Children.length-1);this._buffer.Add(this._pads.ArrEnd(f))}else if(p.Type===s.JsonItemType.Object){const f=Vs.GetPaddingType(p);this._buffer.Add(this._pads.ObjStart(f));for(let m=0;m<p.Children.length;++m)this.InlineElement(p.Children[m],m<p.Children.length-1);this._buffer.Add(this._pads.ObjEnd(f))}else this._buffer.Add(p.Value)}InlineTableRowSegment(p,f,m,g){p.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Spaces(p.PrefixCommentLength-f.PrefixCommentLength),this._pads.Comment),p.NameLength>0&&this._buffer.Add(f.Name,this._pads.Spaces(p.NameLength-f.NameLength),this._pads.Colon),p.MiddleCommentLength>0&&this._buffer.Add(f.MiddleComment,this._pads.Spaces(p.MiddleCommentLength-f.MiddleCommentLength),this._pads.Comment),p.Children.length>0&&f.Type!==s.JsonItemType.Null?p.Type===s.JsonItemType.Array?this.InlineTableRawArray(p,f):this.InlineTableRawObject(p,f):p.IsNumberList?p.FormatNumber(this._buffer,f):(this.InlineElementRaw(f),this._buffer.Add(this._pads.Spaces(p.CompositeValueLength-f.ValueLength)));const x=f.IsPostCommentLineStyle||f.PostfixCommentLength===0;x&&(m?this._buffer.Add(this._pads.Comma):g&&this._buffer.Add(this._pads.DummyComma)),p.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment,this._pads.Spaces(p.PostfixCommentLength-f.PostfixCommentLength)),x||(m?this._buffer.Add(this._pads.Comma):g&&this._buffer.Add(this._pads.DummyComma))}InlineTableRawArray(p,f){this._buffer.Add(this._pads.ArrStart(p.PadType));for(let m=0;m<p.Children.length;++m){const g=m===p.Children.length-1,x=m===f.Children.length-1,b=m>=f.Children.length,C=p.Children[m];b?(this._buffer.Add(this._pads.Spaces(C.TotalLength)),g||this._buffer.Add(this._pads.DummyComma)):(this.InlineTableRowSegment(C,f.Children[m],!x,!1),x&&!g&&this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ArrEnd(p.PadType))}InlineTableRawObject(p,f){function m(b){return f.Children.find(C=>C.Name===b.LocationInParent)}const g=p.Children.map(b=>({tt:b,ji:m(b)}));let x=g.length-1;for(;x>=0&&!g[x].ji;)x-=1;this._buffer.Add(this._pads.ObjStart(p.PadType));for(let b=0;b<g.length;++b){const C=g[b].tt,y=g[b].ji,v=b===x,w=b===g.length-1;y?(this.InlineTableRowSegment(C,y,!v,!1),v&&!w&&this._buffer.Add(this._pads.DummyComma)):(this._buffer.Add(this._pads.Spaces(C.TotalLength)),w||this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ObjEnd(p.PadType))}AvailableLineSpace(p){return Math.min(this.Options.MaxInlineLength,this.Options.MaxTotalLineLength-this._pads.PrefixStringLen-this.Options.IndentSpaces*p)}MinifyItem(p,f){const m=`
`;if(this._buffer.Add(p.PrefixComment),p.Name.length>0&&this._buffer.Add(p.Name,":"),p.MiddleComment.indexOf(m)>=0){const g=Vs.NormalizeMultilineComment(p.MiddleComment,Number.MAX_VALUE);for(const x of g)this._buffer.Add(x,m)}else this._buffer.Add(p.MiddleComment);if(p.Type===s.JsonItemType.Array||p.Type===s.JsonItemType.Object){let g;p.Type===s.JsonItemType.Array?(this._buffer.Add("["),g="]"):(this._buffer.Add("{"),g="}");let x=!1,b=!1;for(const C of p.Children)Vs.IsCommentOrBlankLine(C.Type)||(x&&this._buffer.Add(","),x=!0),b=this.MinifyItem(C,b);this._buffer.Add(g)}else{if(p.Type===s.JsonItemType.BlankLine)return f||this._buffer.Add(m),this._buffer.Add(m),!0;if(p.Type===s.JsonItemType.LineComment)return f||this._buffer.Add(m),this._buffer.Add(p.Value,m),!0;if(p.Type===s.JsonItemType.BlockComment){if(f||this._buffer.Add(m),p.Value.indexOf(m)>=0){const g=Vs.NormalizeMultilineComment(p.Value,p.InputPosition.Column);for(const x of g)this._buffer.Add(x,m);return!0}return this._buffer.Add(p.Value,m),!0}else this._buffer.Add(p.Value)}return this._buffer.Add(p.PostfixComment),p.PostfixComment.length>0&&p.IsPostCommentLineStyle?(this._buffer.Add(m),!0):!1}static GetPaddingType(p){return p.Children.length===0?o.BracketPaddingType.Empty:p.Complexity>=2?o.BracketPaddingType.Complex:o.BracketPaddingType.Simple}static NormalizeMultilineComment(p,f){const g=p.replace(/\r/g,"").split(`
`).filter(x=>x.length>0);for(let x=1;x<g.length;++x){const b=g[x];let C=0;for(;C<b.length&&C<f&&/\s/.test(b[C]);)C+=1;g[x]=b.substring(C)}return g}static IndexOfLastElement(p){for(let f=p.length-1;f>=0;--f)if(!this.IsCommentOrBlankLine(p[f].Type))return f;return-1}static IsCommentOrBlankLine(p){return p===s.JsonItemType.BlankLine||p===s.JsonItemType.BlockComment||p===s.JsonItemType.LineComment}};return lp.Formatter=u,lp}var aE;function Jke(){return aE||(aE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Formatter=e.FracturedJsonError=e.NumberListAlignment=e.EolStyle=e.CommentPolicy=e.FracturedJsonOptions=void 0;var t=W_();Object.defineProperty(e,"FracturedJsonOptions",{enumerable:!0,get:function(){return t.FracturedJsonOptions}});var n=G_();Object.defineProperty(e,"CommentPolicy",{enumerable:!0,get:function(){return n.CommentPolicy}});var s=z_();Object.defineProperty(e,"EolStyle",{enumerable:!0,get:function(){return s.EolStyle}});var o=H_();Object.defineProperty(e,"NumberListAlignment",{enumerable:!0,get:function(){return o.NumberListAlignment}});var r=qu();Object.defineProperty(e,"FracturedJsonError",{enumerable:!0,get:function(){return r.FracturedJsonError}});var a=Qke();Object.defineProperty(e,"Formatter",{enumerable:!0,get:function(){return a.Formatter}})}(n2)),n2}var eje=Jke();const tje=new eje.Formatter,nje=fo({overflowX:"scroll",overflowY:"scroll"}).options,sje=Sr("pre"),ije=e=>{const{label:t,data:n,fileName:s,withDownload:o=!0,withCopy:r=!0,extraCopyActions:a,...l}=e,d=c.useMemo(()=>(sf(n)?n:tje.Serialize(n))??"",[n]),u=dl(),h=fl(),p=c.useCallback(()=>{h.writeText(d)},[h,d]),f=c.useCallback(()=>{const g=new Blob([d]),x=document.createElement("a");x.href=URL.createObjectURL(g),x.download=`${s||t}.json`,document.body.appendChild(x),x.click(),x.remove()},[d,t,s]),{t:m}=M();return i.jsxs(T,{bg:"base.800",borderRadius:"base",flexGrow:1,w:"full",h:"full",position:"relative",...l,children:[i.jsx(Ce,{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"auto",p:2,fontSize:"sm",children:i.jsx(vs,{defer:!0,style:oje,options:nje,children:i.jsx(sje,{whiteSpace:"pre-wrap",children:d})})}),i.jsxs(T,{position:"absolute",top:0,insetInlineEnd:0,p:2,children:[o&&i.jsx(Oe,{label:`${m("gallery.download")} ${t} JSON`,children:i.jsx(le,{"aria-label":`${m("gallery.download")} ${t} JSON`,icon:i.jsx(Lu,{size:16}),variant:"ghost",opacity:.7,onClick:f})}),r&&i.jsx(Oe,{label:`${m("gallery.copy")} ${t} JSON`,children:i.jsx(le,{"aria-label":`${m("gallery.copy")} ${t} JSON`,icon:i.jsx(pn,{size:16}),variant:"ghost",opacity:.7,onClick:p})}),u&&(a==null?void 0:a.map(({label:g,getData:x})=>i.jsx(rje,{label:g,getData:x,data:n},g)))]})]})},br=c.memo(ije),oje={height:"100%",width:"100%"},rje=({label:e,data:t,getData:n})=>{const{t:s}=M(),o=fl(),r=c.useCallback(()=>{o.writeText(JSON.stringify(n(t),null,2))},[o,t,n]);return i.jsx(Oe,{label:`${s("gallery.copy")} ${e} JSON`,children:i.jsx(le,{"aria-label":`${s("gallery.copy")} ${e} JSON`,icon:i.jsx(pn,{size:16}),variant:"ghost",opacity:.7,onClick:r})})},aje=({image:e})=>{const{t}=M(),{currentData:n}=cz(e),s=c.useMemo(()=>{if(n!=null&&n.graph)try{return JSON.parse(n.graph)}catch{return null}return null},[n]);return s?i.jsx(br,{fileName:`${e.image_name.replace(".png","")}_graph`,data:s,label:t("nodes.graph")}):i.jsx(Ot,{label:t("nodes.noGraph")})},lje=c.memo(aje),cje=()=>{const{t:e}=M();return i.jsx(W,{children:e("common.loading")})},dje=()=>{const{t:e}=M();return i.jsx(W,{children:e("metadata.parsingFailed")})},hz=(e,t)=>{const[n,s]=c.useState(Uc),[o,r]=c.useState(null);c.useEffect(()=>{(()=>{t.parse(e).then(f=>{s(f)}).catch(()=>{s(Al)})})()},[t,e]);const a=c.useMemo(()=>n===Uc||n===Al,[n]),l=c.useMemo(()=>t.getLabel(),[t]);c.useEffect(()=>{(()=>{if(n===Uc){r(null);return}if(n===Al){r(null);return}t.renderValue(n).then(f=>{r(f)}).catch(()=>{})})()},[t,n]);const d=c.useMemo(()=>n===Uc?i.jsx(cje,{}):n===Al?i.jsx(dje,{}):i.jsx(W,{children:o}),[o,n]),u=c.useCallback(()=>{if(!t.recall||n===Uc||n===Al)return null;t.recall(n,!0).catch(()=>{})},[t,n]),h=c.useMemo(()=>n===Uc||n===Al?null:n,[n]);return{label:l,isDisabled:a,value:n,renderedValue:d,onRecall:u,valueOrNull:h}},pz=c.memo(({label:e,...t})=>{const{t:n}=M();return i.jsx(Oe,{label:n("metadata.recallParameter",{label:e}),children:i.jsx(le,{"aria-label":n("metadata.recallParameter",{label:e}),icon:i.jsx(y7,{}),size:"xs",variant:"ghost",...t})})});pz.displayName="RecallButton";const q_=c.memo(({label:e,onRecall:t,isDisabled:n,renderedValue:s,direction:o="row"})=>i.jsxs(T,{gap:2,children:[t&&i.jsx(pz,{label:e,onClick:t,isDisabled:n}),i.jsxs(T,{direction:o,fontSize:"sm",children:[i.jsxs(W,{fontWeight:"semibold",whiteSpace:"pre-wrap",pr:2,children:[e,":"]}),s]})]}));q_.displayName="MetadataItemView";const uje=am(({metadata:e,handlers:t,direction:n="row"})=>{const{label:s,isDisabled:o,value:r,renderedValue:a,onRecall:l}=hz(e,t);return r===Al||t.getIsVisible&&!Nte(r)&&!t.getIsVisible(r)?null:i.jsx(q_,{label:s,onRecall:l,isDisabled:o,renderedValue:a,direction:n})}),qt=am(uje);qt.displayName="MetadataItem";const hje=({metadata:e})=>{const[t,n]=c.useState([]);c.useEffect(()=>{(async()=>{try{const r=await xt.loras.parse(e);n(r)}catch{n([])}})()},[e]);const s=c.useMemo(()=>xt.loras.getLabel(),[]);return i.jsx(i.Fragment,{children:t.map(o=>i.jsx(pje,{label:s,lora:o,handlers:xt.loras},o.model.key))})},pje=({label:e,lora:t,handlers:n})=>{const s=c.useCallback(()=>{n.recallItem&&n.recallItem(t,!0).catch(()=>{})},[n,t]),[o,r]=c.useState(null);return c.useEffect(()=>{(async()=>{if(!n.renderItemValue){r(null);return}const l=await n.renderItemValue(t);r(l)})()},[n,t]),i.jsx(q_,{label:e,isDisabled:!1,onRecall:s,renderedValue:o})},fje=e=>{const t=A(On),{metadata:n}=e;return!n||Object.keys(n).length===0?null:i.jsxs(T,{flexDir:"column",pl:8,children:[i.jsx(qt,{metadata:n,handlers:xt.generationMode}),i.jsx(qt,{metadata:n,handlers:xt.positivePrompt,direction:"column"}),i.jsx(qt,{metadata:n,handlers:xt.negativePrompt,direction:"column"}),i.jsx(qt,{metadata:n,handlers:xt.sdxlPositiveStylePrompt,direction:"column"}),i.jsx(qt,{metadata:n,handlers:xt.sdxlNegativeStylePrompt,direction:"column"}),i.jsx(qt,{metadata:n,handlers:xt.model}),i.jsx(qt,{metadata:n,handlers:xt.vae}),i.jsx(qt,{metadata:n,handlers:xt.width}),i.jsx(qt,{metadata:n,handlers:xt.height}),i.jsx(qt,{metadata:n,handlers:xt.seed}),i.jsx(qt,{metadata:n,handlers:xt.steps}),i.jsx(qt,{metadata:n,handlers:xt.scheduler}),i.jsx(qt,{metadata:n,handlers:xt.cfgScale}),i.jsx(qt,{metadata:n,handlers:xt.cfgRescaleMultiplier}),i.jsx(qt,{metadata:n,handlers:xt.guidance}),t!=="canvas"&&i.jsx(qt,{metadata:n,handlers:xt.strength}),i.jsx(qt,{metadata:n,handlers:xt.seamlessX}),i.jsx(qt,{metadata:n,handlers:xt.seamlessY}),i.jsx(qt,{metadata:n,handlers:xt.hrfEnabled}),i.jsx(qt,{metadata:n,handlers:xt.hrfMethod}),i.jsx(qt,{metadata:n,handlers:xt.hrfStrength}),i.jsx(qt,{metadata:n,handlers:xt.refinerCFGScale}),i.jsx(qt,{metadata:n,handlers:xt.refinerModel}),i.jsx(qt,{metadata:n,handlers:xt.refinerNegativeAestheticScore}),i.jsx(qt,{metadata:n,handlers:xt.refinerPositiveAestheticScore}),i.jsx(qt,{metadata:n,handlers:xt.refinerScheduler}),i.jsx(qt,{metadata:n,handlers:xt.refinerStart}),i.jsx(qt,{metadata:n,handlers:xt.refinerSteps}),i.jsx(hje,{metadata:n})]})},mje=c.memo(fje),gje=({image:e})=>{const{t}=M(),{currentData:n}=cz(e),s=c.useMemo(()=>{if(n!=null&&n.workflow)try{return JSON.parse(n.workflow)}catch{return null}return null},[n]);return s?i.jsx(br,{fileName:`${e.image_name.replace(".png","")}_workflow`,data:s,label:t("metadata.workflow")}):i.jsx(Ot,{label:t("nodes.noWorkflow")})},xje=c.memo(gje),yje=({image:e})=>{const{t}=M(),{metadata:n}=J9(e.image_name),s=hz(n,xt.createdBy);return i.jsxs(T,{layerStyle:"first",padding:4,gap:1,flexDirection:"column",width:"full",height:"full",borderRadius:"base",position:"absolute",overflow:"hidden",children:[i.jsx(ii,{href:e.image_url,label:e.image_name}),s.valueOrNull&&i.jsxs(W,{children:[t("metadata.createdBy"),": ",s.valueOrNull]}),i.jsxs(yc,{variant:"line",isLazy:!0,display:"flex",flexDir:"column",w:"full",h:"full",children:[i.jsxs(bc,{children:[i.jsx(Tn,{children:t("metadata.recallParameters")}),i.jsx(Tn,{children:t("metadata.metadata")}),i.jsx(Tn,{children:t("metadata.imageDetails")}),i.jsx(Tn,{children:t("metadata.workflow")}),i.jsx(Tn,{children:t("nodes.graph")})]}),i.jsxs(yu,{children:[i.jsx(Vn,{children:n?i.jsx(ns,{children:i.jsx(mje,{metadata:n})}):i.jsx(Ot,{label:t("metadata.noRecallParameters")})}),i.jsx(Vn,{children:n?i.jsx(br,{fileName:`${e.image_name.replace(".png","")}_metadata`,data:n,label:t("metadata.metadata")}):i.jsx(Ot,{label:t("metadata.noMetaData")})}),i.jsx(Vn,{children:e?i.jsx(br,{fileName:`${e.image_name.replace(".png","")}_details`,data:e,label:t("metadata.imageDetails")}):i.jsx(Ot,{label:t("metadata.noImageDetails")})}),i.jsx(Vn,{children:i.jsx(xje,{image:e})}),i.jsx(Vn,{children:i.jsx(lje,{image:e})})]})]})]})},bje=c.memo(yje),K_=()=>{const e=A(Su),t=Cc(e);return{imageDTOs:c.useMemo(()=>{var s;return((s=t.data)==null?void 0:s.items)??Fs},[t.data]),queryResult:t}},Ow="gallery-grid",fz=c.memo(({imageDTOs:e})=>{const{t}=M();return i.jsxs(T,{w:$1,h:$1,alignItems:"center",justifyContent:"center",flexDir:"column",bg:"base.900",borderRadius:"base",children:[i.jsx(zt,{children:e.length}),i.jsx(zt,{size:"sm",children:t("parameters.images")})]})});fz.displayName="DndDragPreviewMultipleImage";const vje=e=>wu.createPortal(i.jsx(fz,{imageDTOs:e.imageDTOs}),e.container),Cje=({multipleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:o,location:r}=t;sz({render({container:a}){return n({type:"multiple-image",container:a,imageDTOs:e.payload.imageDTOs}),()=>n(null)},nativeSetDragImage:s,getOffset:iz({element:o.element,input:r.current.input})})},wje={minW:0,svg:{transitionProperty:"common",transitionDuration:"normal",fill:"base.100",_hover:{fill:"base.50"},filter:`drop-shadow(0px 0px 0.1rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))`}},oa=c.memo(e=>{const{onClick:t,tooltip:n,icon:s,...o}=e;return i.jsx(le,{onClick:t,"aria-label":n,icon:s,variant:"link",sx:wje,"data-testid":n,...o})});oa.displayName="DndImageIcon";const mz=c.memo(({imageDTO:e})=>{const t=dl(),{t:n}=M(),s=G(),o=c.useCallback(r=>{r.stopPropagation(),e&&s(Zf([e]))},[s,e]);return t?i.jsx(oa,{onClick:o,icon:i.jsx(My,{}),tooltip:n("gallery.deleteImage_one"),position:"absolute",bottom:2,insetInlineEnd:2}):null});mz.displayName="GalleryImageDeleteIconButton";const gz=c.memo(({imageDTO:e})=>{const t=$t(),{t:n}=M(),s=c.useCallback(()=>{t.openImageInViewer(e)},[e,t]);return i.jsx(oa,{onClick:s,icon:i.jsx(ky,{}),tooltip:n("gallery.openInViewer"),position:"absolute",insetBlockStart:2,insetInlineStart:2})});gz.displayName="GalleryImageOpenInViewerIconButton";const xz=c.memo(({imageDTO:e})=>i.jsx(W,{className:"gallery-image-size-badge",position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:1,left:1,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",pointerEvents:"none",children:`${e.width}x${e.height}`}));xz.displayName="GalleryImageSizeBadge";const yz=c.memo(({imageDTO:e})=>{const t=re(OS),[n]=NS(),[s]=FS(),o=c.useCallback(()=>{e.starred?s({imageDTOs:[e]}):n({imageDTOs:[e]})},[n,s,e]);return t?i.jsx(oa,{onClick:o,icon:e.starred?t.on.icon:t.off.icon,tooltip:e.starred?t.on.text:t.off.text,position:"absolute",top:2,insetInlineEnd:2}):i.jsx(oa,{onClick:o,icon:e.starred?i.jsx(Ay,{}):i.jsx(aj,{}),tooltip:e.starred?"Unstar":"Star",position:"absolute",top:2,insetInlineEnd:2})});yz.displayName="GalleryImageStarIconButton";const bz=c.memo(({imageDTO:e,isHovered:t})=>{const n=A(Fte);return i.jsxs(i.Fragment,{children:[(t||n)&&i.jsx(xz,{imageDTO:e}),(t||e.starred)&&i.jsx(yz,{imageDTO:e}),t&&i.jsx(mz,{imageDTO:e}),t&&i.jsx(gz,{imageDTO:e})]})});bz.displayName="GalleryImageHoverIcons";const vz=e=>`gallery-image-${e}`,Cz=c.memo(({width:e,height:t})=>i.jsx(_S,{w:`${e}px`,h:"auto",objectFit:"contain",aspectRatio:`${e}/${t}`}));Cz.displayName="SizedSkeletonLoader";const Z_="gallery-image-container",Sje={containerType:"inline-size",w:"full",h:"full",".gallery-image-size-badge":{"@container (max-width: 80px)":{"&":{display:"none"}}},"&[data-is-dragging=true]":{opacity:.3},".gallery-image":{touchAction:"none",userSelect:"none",webkitUserSelect:"none",position:"relative",justifyContent:"center",alignItems:"center",aspectRatio:"1/1","::before":{content:'""',display:"inline-block",position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",borderRadius:"base"},"&[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-500), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-300), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"},"&:hover::before":{boxShadow:"inset 0px 0px 0px 1px var(--invoke-colors-invokeBlue-300), inset 0px 0px 0px 2px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-400), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-200), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"}}},wz=c.memo(({imageDTO:e})=>{const t=cn(),[n,s]=c.useState(!1),[o,r]=c.useState(null),[a,l]=c.useState(null),d=c.useId(),u=c.useMemo(()=>he(Ai,w=>{var k;return((k=w.imageToCompare)==null?void 0:k.image_name)===e.image_name}),[e.image_name]),h=A(u),p=c.useMemo(()=>he(Ai,w=>{for(const k of w.selection)if(k.image_name===e.image_name)return!0;return!1}),[e.image_name]),f=A(p);c.useEffect(()=>{if(a)return Xn(Uu(a),Eu({element:a,getInitialData:()=>{const{gallery:w}=t.getState();return w.selection.length>1&&w.selection.find(({image_name:k})=>k===e.image_name)!==void 0?oo.getData({imageDTOs:w.selection,boardId:w.selectedBoardId}):An.getData({imageDTO:e},e.image_name)},onDragStart:({source:w})=>{if(An.typeGuard(w.data)){s(!0);return}},onGenerateDragPreview:w=>{oo.typeGuard(w.source.data)?Cje({multipleImageDndData:w.source.data,onGenerateDragPreviewArgs:w,setDragPreviewState:r}):An.typeGuard(w.source.data)&&lz({singleImageDndData:w.source.data,onGenerateDragPreviewArgs:w,setDragPreviewState:r})}}),or({onDragStart:({source:w})=>{oo.typeGuard(w.data)&&w.data.payload.imageDTOs.includes(e)&&s(!0)},onDrop:()=>{s(!1)}}))},[e,a,t,d]);const[m,g]=c.useState(!1),x=c.useCallback(()=>{g(!0)},[]),b=c.useCallback(()=>{g(!1)},[]),C=c.useCallback(w=>{t.dispatch(Bte({imageDTO:e,shiftKey:w.shiftKey,ctrlKey:w.ctrlKey,metaKey:w.metaKey,altKey:w.altKey}))},[e,t]),y=c.useCallback(()=>{DS.set(!0),t.dispatch(Qf(null))},[t]),v=c.useMemo(()=>vz(e.image_name),[e.image_name]);return WO(e,a),i.jsxs(i.Fragment,{children:[i.jsx(Ce,{className:Z_,sx:Sje,"data-testid":v,"data-is-dragging":n,children:i.jsxs(T,{role:"button",className:"gallery-image",onMouseOver:x,onMouseOut:b,onClick:C,onDoubleClick:y,"data-selected":f,"data-selected-for-compare":h,children:[i.jsx(Zt,{ref:l,src:e.thumbnail_url,fallback:i.jsx(Cz,{width:e.width,height:e.height}),w:e.width,objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base"}),i.jsx(bz,{imageDTO:e,isHovered:m})]})}),(o==null?void 0:o.type)==="multiple-image"?vje(o):null,(o==null?void 0:o.type)==="single-image"?az(o):null]})});wz.displayName="GalleryImage";const kje=Le({}),jje=(e,t)=>e.top>=t.top&&e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right,_je=(e,t)=>e>(t.endIndex-t.startIndex)/2+t.startIndex?"end":"start",V1=()=>{const e=document.querySelector(`.${Z_}`),t=document.querySelector(`.${Ow}`);if(!e||!t)return 0;const n=t.parentElement;if(!n)return 0;const s=e.getBoundingClientRect(),o=n.getBoundingClientRect(),r=window.getComputedStyle(t),a=parseFloat(r.gap);if(!s.width||!s.height||!o.width||!o.height)return 0;let l=0,d=0;for(;d+s.width<=o.width+1;)l++,d+=s.width,d+a<=o.width&&(d+=a);return l},Ije=(e,t)=>{var u,h,p;const n=kje.get(),s=(u=n.virtuosoRangeRef)==null?void 0:u.current,o=(h=n.rootRef)==null?void 0:h.current,r=(p=n.virtuosoRef)==null?void 0:p.current;if(!s||!r||!o)return;const a=document.querySelector(`[data-testid="${vz(e)}"]`),l=a==null?void 0:a.getBoundingClientRect(),d=o.getBoundingClientRect();(!l||!jje(l,d))&&r.scrollToIndex({index:t,align:_je(t,s)})},Tje=(e,t)=>{const n=pr(t-1,0,e.length-1),s=e[n];return{index:n,image:s}},Aje=(e,t)=>{const n=pr(t+1,0,e.length-1),s=e[n];return{index:n,image:s}},Mje=(e,t)=>{const n=V1(),o=t<n?t:pr(t-n,0,e.length-1),r=e[o];return{index:o,image:r}},Eje=(e,t)=>{const n=V1(),o=t<e.length-n?pr(t+n,0,e.length-1):t,r=e[o];return{index:o,image:r}},Pje={left:Tje,right:Aje,up:Mje,down:Eje},Sz=()=>{const e=G(),t=$te(),n=c.useMemo(()=>he(Yf,Vte,(w,k)=>t?k??w:w),[t]),s=A(n),{imageDTOs:o}=K_(),r=c.useMemo(()=>o.length,[o.length]),a=c.useMemo(()=>o.length===0||!s?0:o.findIndex(w=>w.image_name===s.image_name),[o,s]),l=c.useCallback((w,k)=>{const{index:S,image:P}=Pje[w](o,a);!P||S===a||(e(k?Qf(P):K8(P)),Ije(P.image_name,S))},[o,a,e]),d=c.useMemo(()=>a===0,[a]),u=c.useMemo(()=>a===r-1,[a,r]),h=c.useMemo(()=>a<V1(),[a]),p=c.useMemo(()=>a>=r-V1(),[a,r]),f=c.useMemo(()=>a===0,[a]),m=c.useMemo(()=>a===r-1,[a,r]),g=c.useCallback(w=>{l("left",w)},[l]),x=c.useCallback(w=>{l("right",w)},[l]),b=c.useCallback(w=>{l("up",w)},[l]),C=c.useCallback(w=>{l("down",w)},[l]),y=c.useCallback(()=>{x()},[x]),v=c.useCallback(()=>{g()},[g]);return{handleLeftImage:g,handleRightImage:x,handleUpImage:b,handleDownImage:C,isOnFirstImage:d,isOnLastImage:u,isOnFirstRow:h,isOnLastRow:p,nextImage:y,prevImage:v,isOnFirstImageOfView:f,isOnLastImageOfView:m}},Pp=(e,t)=>{const n=t-e+1;return Array.from({length:n},(s,o)=>o+e)},Pd="ellipsis",Lje=(e,t,n)=>{const s=Math.min(2*n+5,t),o=1,r=t,a=Math.max(e-n,o),l=Math.min(e+n,r),d=a>o+1,u=l<r-1,h=s-2;if(!d&&u)return[...Pp(1,h),Pd,r];if(d&&!u){const f=Pp(r-h+1,r);return[o,Pd,...f]}if(d&&u){const f=Pp(a,l);return[o,Pd,...f,Pd,r]}return Pp(o,r)},Dje=he(Ai,e=>e.offset),Rje=he(Ai,e=>e.limit),nb=()=>{const e=G(),t=A(Dje),n=A(Rje),s=A(Su),{count:o,total:r}=Cc(s,{selectFromResult:({data:b})=>({count:(b==null?void 0:b.items.length)??0,total:(b==null?void 0:b.total)??0})}),a=c.useMemo(()=>Math.ceil(t/(n||0)),[t,n]),l=c.useMemo(()=>Math.ceil(r/(n||0)),[r,n]),d=c.useMemo(()=>o?a+1<l:!1,[o,a,l]),u=c.useMemo(()=>o?t>0:!1,[o,t]),h=c.useCallback(b=>{e(Z8(b))},[e]),p=c.useMemo(()=>xC(h,500),[h]),f=c.useCallback(b=>{p({offset:t+(n||0),withHotkey:b})},[p,t,n]),m=c.useCallback(b=>{p({offset:Math.max(t-(n||0),0),withHotkey:b})},[p,t,n]),g=c.useCallback(b=>{p({offset:b*(n||0)})},[p,n]);c.useEffect(()=>{l&&a+1>l&&p({offset:(l-1)*(n||0)})},[a,l,p,n]);const x=c.useMemo(()=>l>7?Lje(a+1,l,1):Pp(1,l),[a,l]);return{goPrev:m,goNext:f,isPrevEnabled:u,isNextEnabled:d,pageButtons:x,goToPage:g,currentPage:a,total:r,pages:l}},Oje=({inset:e=8})=>{const{t}=M(),{prevImage:n,nextImage:s,isOnFirstImageOfView:o,isOnLastImageOfView:r}=Sz(),{isFetching:a}=K_().queryResult,{isNextEnabled:l,goNext:d,isPrevEnabled:u,goPrev:h}=nb(),p=c.useMemo(()=>!!(!o||u),[o,u]),f=c.useCallback(()=>{o?u&&!a&&h("arrow"):n()},[h,a,o,u,n]),m=c.useMemo(()=>!!(!r||l),[l,r]),g=c.useCallback(()=>{r?l&&!a&&d("arrow"):s()},[d,a,l,r,s]);return i.jsxs(Ce,{pos:"relative",h:"full",w:"full",children:[p&&i.jsx(le,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.previousImage"),icon:i.jsx(ij,{size:64}),variant:"unstyled",onClick:f,isDisabled:a,color:"base.100",pointerEvents:"auto",insetInlineStart:e}),m&&i.jsx(le,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.nextImage"),icon:i.jsx(jy,{size:64}),variant:"unstyled",onClick:g,isDisabled:a,color:"base.100",pointerEvents:"auto",insetInlineEnd:e})]})},kz=c.memo(Oje),Nje=he(Dx,e=>e.shouldAntialiasProgressImage),Fje=()=>{const e=re(zte),t=re(mL),n=A(Nje),s=c.useMemo(()=>({imageRendering:n?"auto":"pixelated"}),[n]);return!e||t?null:i.jsx(Zt,{src:e.dataURL,width:e.width,height:e.height,draggable:!1,"data-testid":"progress-image",objectFit:"contain",maxWidth:"full",maxHeight:"full",position:"absolute",borderRadius:"base",sx:s})},Bje=c.memo(Fje),$je=()=>{const e=A(JD),t=A(Gte),{currentData:n}=ul(t??cs),[s,o]=c.useState(!1),r=c.useRef(0),a=c.useCallback(()=>{o(!0),window.clearTimeout(r.current)},[]),l=c.useCallback(()=>{r.current=window.setTimeout(()=>{o(!1)},500)},[]);return i.jsxs(T,{onMouseOver:a,onMouseOut:l,width:"full",height:"full",alignItems:"center",justifyContent:"center",position:"relative",children:[i.jsx(jz,{imageDTO:n}),i.jsxs(T,{flexDir:"column",gap:2,position:"absolute",top:0,insetInlineStart:0,pointerEvents:"none",alignItems:"flex-start",children:[i.jsx(awe,{}),i.jsx(V_,{})]}),e&&n&&i.jsx(Ce,{position:"absolute",opacity:.8,top:0,width:"full",height:"full",borderRadius:"base",children:i.jsx(bje,{image:n})}),i.jsx(AB,{children:s&&n&&i.jsx(Ce,{as:k_.div,initial:zje,animate:Gje,exit:Hje,position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:i.jsx(kz,{})},"nextPrevButtons")})]})},Vje=c.memo($je),jz=c.memo(({imageDTO:e})=>{const t=re(Hte),n=re(mL),s=A(Pk);return t&&!n&&s?i.jsx(Bje,{}):e?i.jsx(T,{w:"full",h:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:i.jsx(vl,{imageDTO:e})}):i.jsx(N9,{})});jz.displayName="ImageContent";const zje={opacity:0},Gje={opacity:1,transition:{duration:.07}},Hje={opacity:0,transition:{duration:.07}},_z=e=>{e.preventDefault()},cc=c.memo(({type:e,...t})=>{const{t:n}=M();return i.jsx(W,{position:"absolute",bottom:4,insetInlineEnd:e==="first"?void 0:4,insetInlineStart:e==="first"?4:void 0,textOverflow:"clip",whiteSpace:"nowrap",filter:Cw,color:"base.50",transitionDuration:"0.2s",transitionProperty:"common",...t,children:n(e==="first"?"gallery.viewerImage":"gallery.compareImage")})});cc.displayName="ImageComparisonLabel";const Iz=c.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=A(ZS),o=c.useRef(null),r=Hx(!1),a=c.useMemo(()=>s$(n,e),[n,e]),l=c.useMemo(()=>i$(s,a,e,t),[s,a,e,t]);return i.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:i.jsx(T,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:i.jsxs(Ce,{ref:o,position:"relative",id:"image-comparison-hover-image-container",w:a.width,h:a.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[i.jsx(Zt,{id:"image-comparison-hover-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:a.width,h:a.height,maxW:"full",maxH:"full",objectFit:"cover",objectPosition:"top left"}),i.jsx(cc,{type:"first",opacity:r.isTrue?0:1}),i.jsxs(Ce,{id:"image-comparison-hover-second-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",opacity:r.isTrue?1:0,transitionDuration:"0.2s",transitionProperty:"common",children:[i.jsx(Ce,{id:"image-comparison-hover-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:Wu,backgroundRepeat:"repeat"}),i.jsx(Zt,{position:"relative",id:"image-comparison-hover-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:l.width,h:l.height,maxW:a.width,maxH:a.height,objectFit:s,objectPosition:"top left"}),i.jsx(cc,{type:"second",opacity:r.isTrue?1:0})]}),i.jsx(Ce,{id:"image-comparison-hover-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseOver:r.setTrue,onMouseOut:r.setFalse,onContextMenu:_z,userSelect:"none"})]})})})});Iz.displayName="ImageComparisonHover";const sb=c.createContext(null);sb.displayName="PanelGroupContext";const sc=c.useLayoutEffect,lE=gL.useId,Wje=typeof lE=="function"?lE:()=>null;let Uje=0;function Y_(e=null){const t=Wje(),n=c.useRef(e||t||null);return n.current===null&&(n.current=""+Uje++),e??n.current}function Tz({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:o,forwardedRef:r,id:a,maxSize:l,minSize:d,onCollapse:u,onExpand:h,onResize:p,order:f,style:m,tagName:g="div",...x}){const b=c.useContext(sb);if(b===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:C,expandPanel:y,getPanelSize:v,getPanelStyle:w,groupId:k,isPanelCollapsed:S,reevaluatePanelConstraints:P,registerPanel:E,resizePanel:L,unregisterPanel:I}=b,O=Y_(a),N=c.useRef({callbacks:{onCollapse:u,onExpand:h,onResize:p},constraints:{collapsedSize:n,collapsible:s,defaultSize:o,maxSize:l,minSize:d},id:O,idIsFromProps:a!==void 0,order:f});c.useRef({didLogMissingDefaultSizeWarning:!1}),sc(()=>{const{callbacks:R,constraints:D}=N.current,B={...D};N.current.id=O,N.current.idIsFromProps=a!==void 0,N.current.order=f,R.onCollapse=u,R.onExpand=h,R.onResize=p,D.collapsedSize=n,D.collapsible=s,D.defaultSize=o,D.maxSize=l,D.minSize=d,(B.collapsedSize!==D.collapsedSize||B.collapsible!==D.collapsible||B.maxSize!==D.maxSize||B.minSize!==D.minSize)&&P(N.current,B)}),sc(()=>{const R=N.current;return E(R),()=>{I(R)}},[f,O,E,I]),c.useImperativeHandle(r,()=>({collapse:()=>{C(N.current)},expand:R=>{y(N.current,R)},getId(){return O},getSize(){return v(N.current)},isCollapsed(){return S(N.current)},isExpanded(){return!S(N.current)},resize:R=>{L(N.current,R)}}),[C,y,v,S,O,L]);const _=w(N.current,o);return c.createElement(g,{...x,children:e,className:t,id:O,style:{..._,...m},"data-panel":"","data-panel-collapsible":s||void 0,"data-panel-group-id":k,"data-panel-id":O,"data-panel-size":parseFloat(""+_.flexGrow).toFixed(1)})}const ur=c.forwardRef((e,t)=>c.createElement(Tz,{...e,forwardedRef:t}));Tz.displayName="Panel";ur.displayName="forwardRef(Panel)";let Nw=null,Ul=null;function qje(e,t){if(t){const n=(t&Lz)!==0,s=(t&Dz)!==0,o=(t&Rz)!==0,r=(t&Oz)!==0;if(n)return o?"se-resize":r?"ne-resize":"e-resize";if(s)return o?"sw-resize":r?"nw-resize":"w-resize";if(o)return"s-resize";if(r)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function Kje(){Ul!==null&&(document.head.removeChild(Ul),Nw=null,Ul=null)}function c2(e,t){const n=qje(e,t);Nw!==n&&(Nw=n,Ul===null&&(Ul=document.createElement("style"),document.head.appendChild(Ul)),Ul.innerHTML=`*{cursor: ${n}!important;}`)}function Az(e){return e.type==="keydown"}function Mz(e){return e.type.startsWith("pointer")}function Ez(e){return e.type.startsWith("mouse")}function ib(e){if(Mz(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(Ez(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function Zje(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function Yje(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function Xje(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:uE(e),b:uE(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;bt(s,"Stacking order can only be calculated for elements with a common ancestor");const o={a:dE(cE(n.a)),b:dE(cE(n.b))};if(o.a===o.b){const r=s.childNodes,a={a:n.a.at(-1),b:n.b.at(-1)};let l=r.length;for(;l--;){const d=r[l];if(d===a.a)return 1;if(d===a.b)return-1}}return Math.sign(o.a-o.b)}const Qje=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function Jje(e){var t;const n=getComputedStyle((t=Pz(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function e_e(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||Jje(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||Qje.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function cE(e){let t=e.length;for(;t--;){const n=e[t];if(bt(n,"Missing node"),e_e(n))return n}return null}function dE(e){return e&&Number(getComputedStyle(e).zIndex)||0}function uE(e){const t=[];for(;e;)t.push(e),e=Pz(e);return t}function Pz(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const Lz=1,Dz=2,Rz=4,Oz=8,t_e=Zje()==="coarse";let Ao=[],zd=!1,Pa=new Map,ob=new Map;const Mf=new Set;function n_e(e,t,n,s,o){var r;const{ownerDocument:a}=t,l={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:o},d=(r=Pa.get(a))!==null&&r!==void 0?r:0;return Pa.set(a,d+1),Mf.add(l),z1(),function(){var h;ob.delete(e),Mf.delete(l);const p=(h=Pa.get(a))!==null&&h!==void 0?h:1;if(Pa.set(a,p-1),z1(),p===1&&Pa.delete(a),Ao.includes(l)){const f=Ao.indexOf(l);f>=0&&Ao.splice(f,1),Q_(),o("up",!0,null)}}}function hE(e){const{target:t}=e,{x:n,y:s}=ib(e);zd=!0,X_({target:t,x:n,y:s}),z1(),Ao.length>0&&(G1("down",e),e.preventDefault(),e.stopPropagation())}function yp(e){const{x:t,y:n}=ib(e);if(zd&&e.buttons===0&&(zd=!1,G1("up",e)),!zd){const{target:s}=e;X_({target:s,x:t,y:n})}G1("move",e),Q_(),Ao.length>0&&e.preventDefault()}function Xc(e){const{target:t}=e,{x:n,y:s}=ib(e);ob.clear(),zd=!1,Ao.length>0&&e.preventDefault(),G1("up",e),X_({target:t,x:n,y:s}),Q_(),z1()}function X_({target:e,x:t,y:n}){Ao.splice(0);let s=null;(e instanceof HTMLElement||e instanceof SVGElement)&&(s=e),Mf.forEach(o=>{const{element:r,hitAreaMargins:a}=o,l=r.getBoundingClientRect(),{bottom:d,left:u,right:h,top:p}=l,f=t_e?a.coarse:a.fine;if(t>=u-f&&t<=h+f&&n>=p-f&&n<=d+f){if(s!==null&&document.contains(s)&&r!==s&&!r.contains(s)&&!s.contains(r)&&Xje(s,r)>0){let g=s,x=!1;for(;g&&!g.contains(r);){if(Yje(g.getBoundingClientRect(),l)){x=!0;break}g=g.parentElement}if(x)return}Ao.push(o)}})}function d2(e,t){ob.set(e,t)}function Q_(){let e=!1,t=!1;Ao.forEach(s=>{const{direction:o}=s;o==="horizontal"?e=!0:t=!0});let n=0;ob.forEach(s=>{n|=s}),e&&t?c2("intersection",n):e?c2("horizontal",n):t?c2("vertical",n):Kje()}function z1(){Pa.forEach((e,t)=>{const{body:n}=t;n.removeEventListener("contextmenu",Xc),n.removeEventListener("pointerdown",hE,{capture:!0}),n.removeEventListener("pointerleave",yp),n.removeEventListener("pointermove",yp)}),window.removeEventListener("pointerup",Xc),window.removeEventListener("pointercancel",Xc),Mf.size>0&&(zd?(Ao.length>0&&Pa.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("contextmenu",Xc),n.addEventListener("pointerleave",yp),n.addEventListener("pointermove",yp))}),window.addEventListener("pointerup",Xc),window.addEventListener("pointercancel",Xc)):Pa.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("pointerdown",hE,{capture:!0}),n.addEventListener("pointermove",yp))}))}function G1(e,t){Mf.forEach(n=>{const{setResizeHandlerState:s}=n,o=Ao.includes(n);s(e,o,t)})}function s_e(){const[e,t]=c.useState(0);return c.useCallback(()=>t(n=>n+1),[])}function bt(e,t){if(!e)throw console.error(t),Error(t)}const J_=10;function dc(e,t,n=J_){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function Wr(e,t,n=J_){return dc(e,t,n)===0}function yi(e,t,n){return dc(e,t,n)===0}function i_e(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const o=e[s],r=t[s];if(!yi(o,r,n))return!1}return!0}function Ld({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];bt(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:o=0,collapsible:r,maxSize:a=100,minSize:l=0}=s;if(dc(n,l)<0)if(r){const d=(o+l)/2;dc(n,d)<0?n=o:n=l}else n=l;return n=Math.min(a,n),n=parseFloat(n.toFixed(J_)),n}function Lp({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:o,trigger:r}){if(yi(e,0))return t;const a=[...t],[l,d]=s;bt(l!=null,"Invalid first pivot index"),bt(d!=null,"Invalid second pivot index");let u=0;if(r==="keyboard"){{const p=e<0?d:l,f=n[p];bt(f,`Panel constraints not found for index ${p}`);const{collapsedSize:m=0,collapsible:g,minSize:x=0}=f;if(g){const b=t[p];if(bt(b!=null,`Previous layout not found for panel index ${p}`),yi(b,m)){const C=x-b;dc(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}{const p=e<0?l:d,f=n[p];bt(f,`No panel constraints found for index ${p}`);const{collapsedSize:m=0,collapsible:g,minSize:x=0}=f;if(g){const b=t[p];if(bt(b!=null,`Previous layout not found for panel index ${p}`),yi(b,x)){const C=b-m;dc(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}}{const p=e<0?1:-1;let f=e<0?d:l,m=0;for(;;){const x=t[f];bt(x!=null,`Previous layout not found for panel index ${f}`);const C=Ld({panelConstraints:n,panelIndex:f,size:100})-x;if(m+=C,f+=p,f<0||f>=n.length)break}const g=Math.min(Math.abs(e),Math.abs(m));e=e<0?0-g:g}{let f=e<0?l:d;for(;f>=0&&f<n.length;){const m=Math.abs(e)-Math.abs(u),g=t[f];bt(g!=null,`Previous layout not found for panel index ${f}`);const x=g-m,b=Ld({panelConstraints:n,panelIndex:f,size:x});if(!yi(g,b)&&(u+=g-b,a[f]=b,u.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?f--:f++}}if(i_e(o,a))return o;{const p=e<0?d:l,f=t[p];bt(f!=null,`Previous layout not found for panel index ${p}`);const m=f+u,g=Ld({panelConstraints:n,panelIndex:p,size:m});if(a[p]=g,!yi(g,m)){let x=m-g,C=e<0?d:l;for(;C>=0&&C<n.length;){const y=a[C];bt(y!=null,`Previous layout not found for panel index ${C}`);const v=y+x,w=Ld({panelConstraints:n,panelIndex:C,size:v});if(yi(y,w)||(x-=w-y,a[C]=w),yi(x,0))break;e>0?C--:C++}}}const h=a.reduce((p,f)=>f+p,0);return yi(h,100)?a:o}function o_e({layout:e,panelsArray:t,pivotIndices:n}){let s=0,o=100,r=0,a=0;const l=n[0];bt(l!=null,"No pivot index found"),t.forEach((p,f)=>{const{constraints:m}=p,{maxSize:g=100,minSize:x=0}=m;f===l?(s=x,o=g):(r+=x,a+=g)});const d=Math.min(o,100-r),u=Math.max(s,100-a),h=e[l];return{valueMax:d,valueMin:u,valueNow:h}}function uc(e,t=document){return Array.from(t.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${e}"]`))}function Nz(e,t,n=document){const o=uc(e,n).findIndex(r=>r.getAttribute("data-panel-resize-handle-id")===t);return o??null}function Fz(e,t,n){const s=Nz(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function rb(e,t=document){var n;if(t instanceof HTMLElement&&(t==null||(n=t.dataset)===null||n===void 0?void 0:n.panelGroupId)==e)return t;const s=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return s||null}function ab(e,t=document){const n=t.querySelector(`[data-panel-resize-handle-id="${e}"]`);return n||null}function r_e(e,t,n,s=document){var o,r,a,l;const d=ab(t,s),u=uc(e,s),h=d?u.indexOf(d):-1,p=(o=(r=n[h])===null||r===void 0?void 0:r.id)!==null&&o!==void 0?o:null,f=(a=(l=n[h+1])===null||l===void 0?void 0:l.id)!==null&&a!==void 0?a:null;return[p,f]}function a_e({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:o,panelGroupElement:r,setLayout:a}){c.useRef({didWarnAboutMissingResizeHandle:!1}),sc(()=>{if(!r)return;const l=uc(n,r);for(let d=0;d<o.length-1;d++){const{valueMax:u,valueMin:h,valueNow:p}=o_e({layout:s,panelsArray:o,pivotIndices:[d,d+1]}),f=l[d];if(f!=null){const m=o[d];bt(m,`No panel data found for index "${d}"`),f.setAttribute("aria-controls",m.id),f.setAttribute("aria-valuemax",""+Math.round(u)),f.setAttribute("aria-valuemin",""+Math.round(h)),f.setAttribute("aria-valuenow",p!=null?""+Math.round(p):"")}}return()=>{l.forEach((d,u)=>{d.removeAttribute("aria-controls"),d.removeAttribute("aria-valuemax"),d.removeAttribute("aria-valuemin"),d.removeAttribute("aria-valuenow")})}},[n,s,o,r]),c.useEffect(()=>{if(!r)return;const l=t.current;bt(l,"Eager values not found");const{panelDataArray:d}=l,u=rb(n,r);bt(u!=null,`No group found for id "${n}"`);const h=uc(n,r);bt(h,`No resize handles found for group id "${n}"`);const p=h.map(f=>{const m=f.getAttribute("data-panel-resize-handle-id");bt(m,"Resize handle element has no handle id attribute");const[g,x]=r_e(n,m,d,r);if(g==null||x==null)return()=>{};const b=C=>{if(!C.defaultPrevented)switch(C.key){case"Enter":{C.preventDefault();const y=d.findIndex(v=>v.id===g);if(y>=0){const v=d[y];bt(v,`No panel data found for index ${y}`);const w=s[y],{collapsedSize:k=0,collapsible:S,minSize:P=0}=v.constraints;if(w!=null&&S){const E=Lp({delta:yi(w,k)?P-k:k-w,initialLayout:s,panelConstraints:d.map(L=>L.constraints),pivotIndices:Fz(n,m,r),prevLayout:s,trigger:"keyboard"});s!==E&&a(E)}}break}}};return f.addEventListener("keydown",b),()=>{f.removeEventListener("keydown",b)}});return()=>{p.forEach(f=>f())}},[r,e,t,n,s,o,a])}function pE(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Bz(e,t){const n=e==="horizontal",{x:s,y:o}=ib(t);return n?s:o}function l_e(e,t,n,s,o){const r=n==="horizontal",a=ab(t,o);bt(a,`No resize handle element found for id "${t}"`);const l=a.getAttribute("data-panel-group-id");bt(l,"Resize handle element has no group id attribute");let{initialCursorPosition:d}=s;const u=Bz(n,e),h=rb(l,o);bt(h,`No group element found for id "${l}"`);const p=h.getBoundingClientRect(),f=r?p.width:p.height;return(u-d)/f*100}function c_e(e,t,n,s,o,r){if(Az(e)){const a=n==="horizontal";let l=0;e.shiftKey?l=100:o!=null?l=o:l=10;let d=0;switch(e.key){case"ArrowDown":d=a?0:l;break;case"ArrowLeft":d=a?-l:0;break;case"ArrowRight":d=a?l:0;break;case"ArrowUp":d=a?0:-l;break;case"End":d=100;break;case"Home":d=-100;break}return d}else return s==null?0:l_e(e,t,n,s,r)}function d_e({panelDataArray:e}){const t=Array(e.length),n=e.map(r=>r.constraints);let s=0,o=100;for(let r=0;r<e.length;r++){const a=n[r];bt(a,`Panel constraints not found for index ${r}`);const{defaultSize:l}=a;l!=null&&(s++,t[r]=l,o-=l)}for(let r=0;r<e.length;r++){const a=n[r];bt(a,`Panel constraints not found for index ${r}`);const{defaultSize:l}=a;if(l!=null)continue;const d=e.length-s,u=o/d;s++,t[r]=u,o-=u}return t}function Qc(e,t,n){t.forEach((s,o)=>{const r=e[o];bt(r,`Panel data not found for index ${o}`);const{callbacks:a,constraints:l,id:d}=r,{collapsedSize:u=0,collapsible:h}=l,p=n[d];if(p==null||s!==p){n[d]=s;const{onCollapse:f,onExpand:m,onResize:g}=a;g&&g(s,p),h&&(f||m)&&(m&&(p==null||Wr(p,u))&&!Wr(s,u)&&m(),f&&(p==null||!Wr(p,u))&&Wr(s,u)&&f())}})}function i0(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function u_e({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:o,precision:r=3}){const a=n[o];let l;return a==null?l=e!=null?e.toPrecision(r):"1":s.length===1?l="1":l=a.toPrecision(r),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function h_e(e,t=10){let n=null;return(...o)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...o)},t)}}function fE(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function $z(e){return`react-resizable-panels:${e}`}function Vz(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:o,order:r}=t;return o?s:r?`${r}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function zz(e,t){try{const n=$z(e),s=t.getItem(n);if(s){const o=JSON.parse(s);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function p_e(e,t,n){var s,o;const r=(s=zz(e,n))!==null&&s!==void 0?s:{},a=Vz(t);return(o=r[a])!==null&&o!==void 0?o:null}function f_e(e,t,n,s,o){var r;const a=$z(e),l=Vz(t),d=(r=zz(e,o))!==null&&r!==void 0?r:{};d[l]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{o.setItem(a,JSON.stringify(d))}catch(u){console.error(u)}}function mE({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((r,a)=>r+a,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(r=>`${r}%`).join(", ")}`);if(!yi(s,100)&&n.length>0)for(let r=0;r<t.length;r++){const a=n[r];bt(a!=null,`No layout data found for index ${r}`);const l=100/s*a;n[r]=l}let o=0;for(let r=0;r<t.length;r++){const a=n[r];bt(a!=null,`No layout data found for index ${r}`);const l=Ld({panelConstraints:t,panelIndex:r,size:a});a!=l&&(o+=a-l,n[r]=l)}if(!yi(o,0))for(let r=0;r<t.length;r++){const a=n[r];bt(a!=null,`No layout data found for index ${r}`);const l=a+o,d=Ld({panelConstraints:t,panelIndex:r,size:l});if(a!==d&&(o-=d-a,n[r]=d,yi(o,0)))break}return n}const m_e=100,Dp={getItem:e=>(fE(Dp),Dp.getItem(e)),setItem:(e,t)=>{fE(Dp),Dp.setItem(e,t)}},gE={};function Gz({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:o,id:r=null,onLayout:a=null,keyboardResizeBy:l=null,storage:d=Dp,style:u,tagName:h="div",...p}){const f=Y_(r),m=c.useRef(null),[g,x]=c.useState(null),[b,C]=c.useState([]),y=s_e(),v=c.useRef({}),w=c.useRef(new Map),k=c.useRef(0),S=c.useRef({autoSaveId:e,direction:s,dragState:g,id:f,keyboardResizeBy:l,onLayout:a,storage:d}),P=c.useRef({layout:b,panelDataArray:[],panelDataArrayChanged:!1});c.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),c.useImperativeHandle(o,()=>({getId:()=>S.current.id,getLayout:()=>{const{layout:z}=P.current;return z},setLayout:z=>{const{onLayout:Z}=S.current,{layout:U,panelDataArray:Y}=P.current,$=mE({layout:z,panelConstraints:Y.map(F=>F.constraints)});pE(U,$)||(C($),P.current.layout=$,Z&&Z($),Qc(Y,$,v.current))}}),[]),sc(()=>{S.current.autoSaveId=e,S.current.direction=s,S.current.dragState=g,S.current.id=f,S.current.onLayout=a,S.current.storage=d}),a_e({committedValuesRef:S,eagerValuesRef:P,groupId:f,layout:b,panelDataArray:P.current.panelDataArray,setLayout:C,panelGroupElement:m.current}),c.useEffect(()=>{const{panelDataArray:z}=P.current;if(e){if(b.length===0||b.length!==z.length)return;let Z=gE[e];Z==null&&(Z=h_e(f_e,m_e),gE[e]=Z);const U=[...z],Y=new Map(w.current);Z(e,U,Y,b,d)}},[e,b,d]),c.useEffect(()=>{});const E=c.useCallback(z=>{const{onLayout:Z}=S.current,{layout:U,panelDataArray:Y}=P.current;if(z.constraints.collapsible){const $=Y.map(ce=>ce.constraints),{collapsedSize:F=0,panelSize:q,pivotIndices:ie}=Tl(Y,z,U);if(bt(q!=null,`Panel size not found for panel "${z.id}"`),!Wr(q,F)){w.current.set(z.id,q);const me=ud(Y,z)===Y.length-1?q-F:F-q,Ie=Lp({delta:me,initialLayout:U,panelConstraints:$,pivotIndices:ie,prevLayout:U,trigger:"imperative-api"});i0(U,Ie)||(C(Ie),P.current.layout=Ie,Z&&Z(Ie),Qc(Y,Ie,v.current))}}},[]),L=c.useCallback((z,Z)=>{const{onLayout:U}=S.current,{layout:Y,panelDataArray:$}=P.current;if(z.constraints.collapsible){const F=$.map(we=>we.constraints),{collapsedSize:q=0,panelSize:ie=0,minSize:ce=0,pivotIndices:me}=Tl($,z,Y),Ie=Z??ce;if(Wr(ie,q)){const we=w.current.get(z.id),Ee=we!=null&&we>=Ie?we:Ie,Fe=ud($,z)===$.length-1?ie-Ee:Ee-ie,Be=Lp({delta:Fe,initialLayout:Y,panelConstraints:F,pivotIndices:me,prevLayout:Y,trigger:"imperative-api"});i0(Y,Be)||(C(Be),P.current.layout=Be,U&&U(Be),Qc($,Be,v.current))}}},[]),I=c.useCallback(z=>{const{layout:Z,panelDataArray:U}=P.current,{panelSize:Y}=Tl(U,z,Z);return bt(Y!=null,`Panel size not found for panel "${z.id}"`),Y},[]),O=c.useCallback((z,Z)=>{const{panelDataArray:U}=P.current,Y=ud(U,z);return u_e({defaultSize:Z,dragState:g,layout:b,panelData:U,panelIndex:Y})},[g,b]),N=c.useCallback(z=>{const{layout:Z,panelDataArray:U}=P.current,{collapsedSize:Y=0,collapsible:$,panelSize:F}=Tl(U,z,Z);return bt(F!=null,`Panel size not found for panel "${z.id}"`),$===!0&&Wr(F,Y)},[]),_=c.useCallback(z=>{const{layout:Z,panelDataArray:U}=P.current,{collapsedSize:Y=0,collapsible:$,panelSize:F}=Tl(U,z,Z);return bt(F!=null,`Panel size not found for panel "${z.id}"`),!$||dc(F,Y)>0},[]),R=c.useCallback(z=>{const{panelDataArray:Z}=P.current;Z.push(z),Z.sort((U,Y)=>{const $=U.order,F=Y.order;return $==null&&F==null?0:$==null?-1:F==null?1:$-F}),P.current.panelDataArrayChanged=!0,y()},[y]);sc(()=>{if(P.current.panelDataArrayChanged){P.current.panelDataArrayChanged=!1;const{autoSaveId:z,onLayout:Z,storage:U}=S.current,{layout:Y,panelDataArray:$}=P.current;let F=null;if(z){const ie=p_e(z,$,U);ie&&(w.current=new Map(Object.entries(ie.expandToSizes)),F=ie.layout)}F==null&&(F=d_e({panelDataArray:$}));const q=mE({layout:F,panelConstraints:$.map(ie=>ie.constraints)});pE(Y,q)||(C(q),P.current.layout=q,Z&&Z(q),Qc($,q,v.current))}}),sc(()=>{const z=P.current;return()=>{z.layout=[]}},[]);const D=c.useCallback(z=>{let Z=!1;const U=m.current;return U&&window.getComputedStyle(U,null).getPropertyValue("direction")==="rtl"&&(Z=!0),function($){$.preventDefault();const F=m.current;if(!F)return()=>null;const{direction:q,dragState:ie,id:ce,keyboardResizeBy:me,onLayout:Ie}=S.current,{layout:we,panelDataArray:Ee}=P.current,{initialLayout:ot}=ie??{},Fe=Fz(ce,z,F);let Be=c_e($,z,q,ie,me,F);const ut=q==="horizontal";ut&&Z&&(Be=-Be);const rt=Ee.map(ae=>ae.constraints),ht=Lp({delta:Be,initialLayout:ot??we,panelConstraints:rt,pivotIndices:Fe,prevLayout:we,trigger:Az($)?"keyboard":"mouse-or-touch"}),K=!i0(we,ht);(Mz($)||Ez($))&&k.current!=Be&&(k.current=Be,!K&&Be!==0?ut?d2(z,Be<0?Lz:Dz):d2(z,Be<0?Rz:Oz):d2(z,0)),K&&(C(ht),P.current.layout=ht,Ie&&Ie(ht),Qc(Ee,ht,v.current))}},[]),B=c.useCallback((z,Z)=>{const{onLayout:U}=S.current,{layout:Y,panelDataArray:$}=P.current,F=$.map(we=>we.constraints),{panelSize:q,pivotIndices:ie}=Tl($,z,Y);bt(q!=null,`Panel size not found for panel "${z.id}"`);const me=ud($,z)===$.length-1?q-Z:Z-q,Ie=Lp({delta:me,initialLayout:Y,panelConstraints:F,pivotIndices:ie,prevLayout:Y,trigger:"imperative-api"});i0(Y,Ie)||(C(Ie),P.current.layout=Ie,U&&U(Ie),Qc($,Ie,v.current))},[]),V=c.useCallback((z,Z)=>{const{layout:U,panelDataArray:Y}=P.current,{collapsedSize:$=0,collapsible:F}=Z,{collapsedSize:q=0,collapsible:ie,maxSize:ce=100,minSize:me=0}=z.constraints,{panelSize:Ie}=Tl(Y,z,U);Ie!=null&&(F&&ie&&Wr(Ie,$)?Wr($,q)||B(z,q):Ie<me?B(z,me):Ie>ce&&B(z,ce))},[B]),ee=c.useCallback((z,Z)=>{const{direction:U}=S.current,{layout:Y}=P.current;if(!m.current)return;const $=ab(z,m.current);bt($,`Drag handle element not found for id "${z}"`);const F=Bz(U,Z);x({dragHandleId:z,dragHandleRect:$.getBoundingClientRect(),initialCursorPosition:F,initialLayout:Y})},[]),se=c.useCallback(()=>{x(null)},[]),oe=c.useCallback(z=>{const{panelDataArray:Z}=P.current,U=ud(Z,z);U>=0&&(Z.splice(U,1),delete v.current[z.id],P.current.panelDataArrayChanged=!0,y())},[y]),te=c.useMemo(()=>({collapsePanel:E,direction:s,dragState:g,expandPanel:L,getPanelSize:I,getPanelStyle:O,groupId:f,isPanelCollapsed:N,isPanelExpanded:_,reevaluatePanelConstraints:V,registerPanel:R,registerResizeHandle:D,resizePanel:B,startDragging:ee,stopDragging:se,unregisterPanel:oe,panelGroupElement:m.current}),[E,g,s,L,I,O,f,N,_,V,R,D,B,ee,se,oe]),H={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return c.createElement(sb.Provider,{value:te},c.createElement(h,{...p,children:t,className:n,id:r,ref:m,style:{...H,...u},"data-panel-group":"","data-panel-group-direction":s,"data-panel-group-id":f}))}const qm=c.forwardRef((e,t)=>c.createElement(Gz,{...e,forwardedRef:t}));Gz.displayName="PanelGroup";qm.displayName="forwardRef(PanelGroup)";function ud(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function Tl(e,t,n){const s=ud(e,t),r=s===e.length-1?[s-1,s]:[s,s+1],a=n[s];return{...t.constraints,panelSize:a,pivotIndices:r}}function g_e({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){c.useEffect(()=>{if(e||n==null||s==null)return;const o=ab(t,s);if(o==null)return;const r=a=>{if(!a.defaultPrevented)switch(a.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{a.preventDefault(),n(a);break}case"F6":{a.preventDefault();const l=o.getAttribute("data-panel-group-id");bt(l,`No group element found for id "${l}"`);const d=uc(l,s),u=Nz(l,t,s);bt(u!==null,`No resize element found for id "${t}"`);const h=a.shiftKey?u>0?u-1:d.length-1:u+1<d.length?u+1:0;d[h].focus();break}}};return o.addEventListener("keydown",r),()=>{o.removeEventListener("keydown",r)}},[s,e,t,n])}function Hz({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:o,onBlur:r,onClick:a,onDragging:l,onFocus:d,onPointerDown:u,onPointerUp:h,style:p={},tabIndex:f=0,tagName:m="div",...g}){var x,b;const C=c.useRef(null),y=c.useRef({onClick:a,onDragging:l,onPointerDown:u,onPointerUp:h});c.useEffect(()=>{y.current.onClick=a,y.current.onDragging=l,y.current.onPointerDown=u,y.current.onPointerUp=h});const v=c.useContext(sb);if(v===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:w,groupId:k,registerResizeHandle:S,startDragging:P,stopDragging:E,panelGroupElement:L}=v,I=Y_(o),[O,N]=c.useState("inactive"),[_,R]=c.useState(!1),[D,B]=c.useState(null),V=c.useRef({state:O});sc(()=>{V.current.state=O}),c.useEffect(()=>{if(n)B(null);else{const te=S(I);B(()=>te)}},[n,I,S]);const ee=(x=s==null?void 0:s.coarse)!==null&&x!==void 0?x:15,se=(b=s==null?void 0:s.fine)!==null&&b!==void 0?b:5;c.useEffect(()=>{if(n||D==null)return;const te=C.current;bt(te,"Element ref not attached");let H=!1;return n_e(I,te,w,{coarse:ee,fine:se},(Z,U,Y)=>{if(U)switch(Z){case"down":{N("drag"),H=!1,bt(Y,'Expected event to be defined for "down" action'),P(I,Y);const{onDragging:$,onPointerDown:F}=y.current;$==null||$(!0),F==null||F();break}case"move":{const{state:$}=V.current;H=!0,$!=="drag"&&N("hover"),bt(Y,'Expected event to be defined for "move" action'),D(Y);break}case"up":{N("hover"),E();const{onClick:$,onDragging:F,onPointerUp:q}=y.current;F==null||F(!1),q==null||q(),H||$==null||$();break}}else N("inactive")})},[ee,w,n,se,S,I,D,P,E]),g_e({disabled:n,handleId:I,resizeHandler:D,panelGroupElement:L});const oe={touchAction:"none",userSelect:"none"};return c.createElement(m,{...g,children:e,className:t,id:o,onBlur:()=>{R(!1),r==null||r()},onFocus:()=>{R(!0),d==null||d()},ref:C,role:"separator",style:{...oe,...p},tabIndex:f,"data-panel-group-direction":w,"data-panel-group-id":k,"data-resize-handle":"","data-resize-handle-active":O==="drag"?"pointer":_?"keyboard":void 0,"data-resize-handle-state":O,"data-panel-resize-handle-enabled":!n,"data-panel-resize-handle-id":I})}Hz.displayName="PanelResizeHandle";const Wz=Sr(Hz),Uz={'&[data-resize-handle-state="hover"]':{_before:{background:"base.600 !important"},".resize-handle-dots":{color:"base.400"}},'&[data-resize-handle-state="drag"]':{_before:{background:"base.500 !important"},".resize-handle-dots":{color:"base.300"}},".resize-handle-dots":{pointerEvents:"none",position:"absolute",left:"50%",top:"50%",transform:"translateX(-50%) translateY(-50%) scale(0.75)",background:"base.900",color:"base.500"}},x_e={...Uz,'&[data-panel-group-direction="vertical"]':{h:4,w:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"fast",content:'""',w:"full",h:"2px",background:"base.800",position:"absolute",top:"50%",left:0,transform:"translateY(-50%)"}}},eI=c.memo(e=>i.jsx(Wz,{...e,sx:x_e,children:i.jsxs(T,{className:"resize-handle-dots",clipPath:"inset(0px 2px 2px 0px)",px:1,children:[i.jsx(at,{as:pT,me:-.5}),i.jsx(at,{as:pT,ms:-.5})]})}));eI.displayName="HorizontalResizeHandle";const y_e={...Uz,'&[data-panel-group-direction="horizontal"]':{w:4,h:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"normal",content:'""',w:"2px",h:"full",background:"base.800",position:"absolute",left:"50%",top:0,transform:"translateX(-50%)"}}},H1=c.memo(e=>i.jsx(Wz,{...e,sx:y_e,children:i.jsxs(T,{flexDir:"column",className:"resize-handle-dots",clipPath:"inset(2px 0px 0px 2px)",py:1,children:[i.jsx(at,{as:hT,mb:-.5}),i.jsx(at,{as:hT,mt:-.5})]})}));H1.displayName="VerticalResizeHandle";const qz=c.memo(({firstImage:e,secondImage:t})=>{const n=c.useRef(null),s=c.useCallback(()=>{n.current&&n.current.setLayout([50,50])},[]);return i.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:i.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:i.jsxs(qm,{ref:n,direction:"horizontal",id:"image-comparison-side-by-side",autoSaveId:"image-comparison-side-by-side",children:[i.jsx(ur,{minSize:20,children:i.jsx(T,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsxs(T,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:e.width/e.height,children:[i.jsx(Zt,{id:"image-comparison-side-by-side-first-image",w:e.width,h:e.height,maxW:"full",maxH:"full",src:e.image_url,fallbackSrc:e.thumbnail_url,objectFit:"contain",borderRadius:"base"}),i.jsx(cc,{type:"first"})]})})}),i.jsx(H1,{id:"image-comparison-side-by-side-handle",onDoubleClick:s}),i.jsx(ur,{minSize:20,children:i.jsx(T,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsxs(T,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:t.width/t.height,children:[i.jsx(Zt,{id:"image-comparison-side-by-side-first-image",w:t.width,h:t.height,maxW:"full",maxH:"full",src:t.image_url,fallbackSrc:t.thumbnail_url,objectFit:"contain",borderRadius:"base"}),i.jsx(cc,{type:"second"})]})})})]})})})});qz.displayName="ImageComparisonSideBySide";const Kz="50%",tI=2,b_e=`${tI}px`,lb=20,v_e=`${lb}px`,C_e=`${lb/2-tI/2}px`,w_e=`calc(${Kz} - ${lb/2}px)`,Zz=c.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=A(ZS),[o,r]=c.useState(w_e),[a,l]=c.useState(Kz),d=c.useRef(null),u=c.useRef(null),h=c.useRef(null),p=c.useRef(0),f=c.useMemo(()=>s$(n,e),[n,e]),m=c.useMemo(()=>i$(s,f,e,t),[s,f,e,t]),g=c.useCallback(y=>{if(!d.current||!u.current)return;p.current=performance.now();const{x:v,width:w}=u.current.getBoundingClientRect(),k=(y-v)*100/w,S=tI*100/w,P=Math.min(100-S,Math.max(0,k));l(`${P}%`),r(`calc(${P}% - ${lb/2}px)`)},[]),x=c.useCallback(y=>{h.current===null&&performance.now()>p.current+1e3/60&&(h.current=window.requestAnimationFrame(()=>{g(y.clientX),h.current=null}))},[g]),b=c.useCallback(()=>{window.removeEventListener("mousemove",x)},[x]),C=c.useCallback(y=>{g(y.clientX),window.addEventListener("mouseup",b,{once:!0}),window.addEventListener("mousemove",x)},[x,b,g]);return c.useEffect(()=>()=>{h.current!==null&&cancelAnimationFrame(h.current)},[]),i.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:i.jsx(T,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:i.jsxs(Ce,{ref:u,position:"relative",id:"image-comparison-image-container",w:f.width,h:f.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[i.jsx(Ce,{id:"image-comparison-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:Wu,backgroundRepeat:"repeat"}),i.jsx(Zt,{position:"relative",id:"image-comparison-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:m.width,h:m.height,maxW:f.width,maxH:f.height,objectFit:s,objectPosition:"top left"}),i.jsx(cc,{type:"second"}),i.jsxs(Ce,{id:"image-comparison-first-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,w:a,overflow:"hidden",children:[i.jsx(Zt,{id:"image-comparison-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:f.width,h:f.height,objectFit:"cover",objectPosition:"top left"}),i.jsx(cc,{type:"first"})]}),i.jsxs(T,{id:"image-comparison-handle",ref:d,position:"absolute",top:0,bottom:0,left:o,w:v_e,cursor:"ew-resize",filter:Cw,opacity:.8,color:"base.50",children:[i.jsx(Ce,{id:"image-comparison-handle-divider",w:b_e,h:"full",bg:"currentColor",shadow:"dark-lg",position:"absolute",top:0,left:C_e}),i.jsxs(T,{id:"image-comparison-handle-icons",gap:4,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, 0)",filter:Cw,children:[i.jsx(at,{as:ij}),i.jsx(at,{as:jy})]})]}),i.jsx(Ce,{id:"image-comparison-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseDown:C,onContextMenu:_z,userSelect:"none",cursor:"ew-resize"})]})})})});Zz.displayName="ImageComparisonSlider";const Yz=c.memo(({containerDims:e})=>{const{t}=M(),n=A(hL),{firstImage:s,secondImage:o}=A(o$);if(!s||!o)return i.jsx(Ot,{label:t("gallery.selectAnImageToCompare"),icon:M7});if(n==="slider")return i.jsx(Zz,{containerDims:e,firstImage:s,secondImage:o});if(n==="side-by-side")return i.jsx(qz,{containerDims:e,firstImage:s,secondImage:o});if(n==="hover")return i.jsx(Iz,{containerDims:e,firstImage:s,secondImage:o})});Yz.displayName="ImageComparison";const Xz=c.memo(()=>{const{t:e}=M(),t=c.useMemo(()=>jw.getData(),[]);return i.jsx(Ls,{dndTarget:jw,dndTargetData:t,label:e("gallery.selectForCompare")})});Xz.displayName="ImageComparisonDroppable";const Qz=c.memo(()=>{const e=G(),t=A(JD),n=A(Yf),{t:s}=M(),o=c.useCallback(()=>e(Wte(!t)),[e,t]);return De({id:"toggleMetadata",category:"viewer",callback:o,options:{enabled:!!n},dependencies:[n,t]}),i.jsx(le,{icon:i.jsx(Ru,{}),tooltip:`${s("parameters.info")} (I)`,"aria-label":`${s("parameters.info")} (I)`,onClick:o,isDisabled:!n,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-metadata-button"})});Qz.displayName="ToggleMetadataViewerButton";const Jz=c.memo(()=>{const e=G(),t=A(Pk),{t:n}=M(),s=c.useCallback(()=>{e(xL(!t))},[e,t]);return i.jsx(le,{"aria-label":n("settings.displayInProgress"),tooltip:n("settings.displayInProgress"),icon:i.jsx(Xpe,{}),onClick:s,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-progress-button"})});Jz.displayName="ToggleProgressButton";const eG=c.memo(e=>{const{onClick:t,isDisabled:n}=e,{t:s}=M(),o=re(Jn),r=A($S),a=`${s("gallery.deleteImage",{count:r})} (Del)`;return i.jsx(le,{onClick:t,icon:i.jsx(Pi,{}),tooltip:a,"aria-label":a,isDisabled:n||!o,colorScheme:"error",variant:"link",alignSelf:"stretch"})});eG.displayName="DeleteImageButton";const S_e=()=>{const{t:e}=M(),[t,{isLoading:n}]=Mm(),s=A(yL),o=G(),r=c.useMemo(()=>{var f;if(!(!t.length||!s))return(f=t.find(m=>m.key===(s==null?void 0:s.key)))==null?void 0:f.description},[t,s]),a=c.useCallback(f=>{o(Ute(f))},[o]),{options:l,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=yl({modelConfigs:t,onChange:a,selectedModel:s,isLoading:n});return i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:e("upscaling.postProcessingModel")}),i.jsx(T,{w:"full",alignItems:"center",gap:2,children:i.jsx(Oe,{label:r,children:i.jsx(Ce,{w:"full",children:i.jsx(Ke,{value:d,placeholder:h,options:l,onChange:u,noOptionsMessage:p,isDisabled:l.length===0})})})})]})},k_e=c.memo(S_e),j_e=()=>{const[e,{isLoading:t}]=CS(zf),[n,{isLoading:s}]=bL({fixedCacheKey:"resumeProcessor"}),[o,{isLoading:r}]=vL({fixedCacheKey:"pauseProcessor"}),[a,{isLoading:l}]=pS({fixedCacheKey:"cancelQueueItem"}),[d,{isLoading:u}]=d8({fixedCacheKey:"clearQueue"}),[h,{isLoading:p}]=CL({fixedCacheKey:"pruneQueue"});return t||s||r||l||u||p},tG=c.memo(e=>{const{imageDTO:t}=e,n=G(),s=A(yL),o=j_e(),{t:r}=M(),{isOpen:a,onOpen:l,onClose:d}=hi(),u=c.useCallback(()=>{d(),t&&n(Q8({imageDTO:t}))},[n,t,d]);return i.jsxs(es,{isOpen:a,onClose:d,isLazy:!0,children:[i.jsx(ds,{children:i.jsx(le,{tooltip:r("parameters.postProcessing"),onClick:l,icon:i.jsx(Sm,{}),"aria-label":r("parameters.postProcessing"),variant:"link",alignSelf:"stretch"})}),i.jsx(ts,{children:i.jsx(us,{w:96,children:i.jsxs(T,{flexDirection:"column",gap:4,children:[i.jsx(k_e,{}),!s&&i.jsx(__e,{}),i.jsx(de,{size:"sm",isDisabled:!t||o||!s,onClick:u,children:r("parameters.processImage")})]})})})]})});tG.displayName="PostProcessingPopover";const __e=()=>{const e=G(),t=c.useCallback(()=>{e(Yt("models")),Qa.set(3)},[e]);return i.jsx(T,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:i.jsx(W,{children:i.jsx(Wt,{i18nKey:"upscaling.postProcessingMissingModelWarning",components:{LinkComponent:i.jsx(de,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:t})}})})})},I_e=()=>{const e=A(Yf),{currentData:t}=ul((e==null?void 0:e.image_name)??cs);return t?i.jsx(nG,{imageDTO:t}):null},T_e=c.memo(I_e),nG=c.memo(({imageDTO:e})=>{const{t}=M(),n=re(Kf),s=_j(e),o=A(li),r=Bt("upscaling");return i.jsxs(i.Fragment,{children:[i.jsxs(on,{isLazy:!0,children:[i.jsx(rn,{as:le,"aria-label":t("parameters.imageActions"),tooltip:t("parameters.imageActions"),isDisabled:!e,variant:"link",alignSelf:"stretch",icon:i.jsx(dj,{})}),i.jsx(Et,{children:e&&i.jsx(HO,{imageDTO:e})})]}),i.jsx(Ct,{orientation:"vertical",h:8,mx:2}),i.jsx(le,{icon:i.jsx(_y,{}),tooltip:`${t("nodes.loadWorkflow")} (W)`,"aria-label":`${t("nodes.loadWorkflow")} (W)`,isDisabled:!s.hasWorkflow||!n,variant:"link",alignSelf:"stretch",onClick:s.loadWorkflow}),i.jsx(le,{icon:i.jsx(m1,{}),tooltip:`${t("parameters.remixImage")} (R)`,"aria-label":`${t("parameters.remixImage")} (R)`,isDisabled:!s.hasMetadata,variant:"link",alignSelf:"stretch",onClick:s.remix}),i.jsx(le,{icon:i.jsx(N7,{}),tooltip:`${t("parameters.usePrompt")} (P)`,"aria-label":`${t("parameters.usePrompt")} (P)`,isDisabled:!s.hasPrompts,variant:"link",alignSelf:"stretch",onClick:s.recallPrompts}),i.jsx(le,{icon:i.jsx(R7,{}),tooltip:`${t("parameters.useSeed")} (S)`,"aria-label":`${t("parameters.useSeed")} (S)`,isDisabled:!s.hasSeed,variant:"link",alignSelf:"stretch",onClick:s.recallSeed}),i.jsx(le,{icon:i.jsx(dfe,{}),tooltip:`${t("parameters.useSize")} (D)`,"aria-label":`${t("parameters.useSize")} (D)`,variant:"link",alignSelf:"stretch",onClick:s.recallSize,isDisabled:o}),i.jsx(le,{icon:i.jsx(v7,{}),tooltip:`${t("parameters.useAll")} (A)`,"aria-label":`${t("parameters.useAll")} (A)`,isDisabled:!s.hasMetadata,variant:"link",alignSelf:"stretch",onClick:s.recallAll}),r&&i.jsx(tG,{imageDTO:e}),i.jsx(Ct,{orientation:"vertical",h:8,mx:2}),i.jsx(eG,{onClick:s.delete})]})});nG.displayName="CurrentImageButtonsContent";const sG=c.memo(({closeButton:e})=>i.jsxs(T,{w:"full",px:2,gap:2,bg:"base.750",borderTopRadius:"base",h:12,children:[i.jsx(T,{flex:1,justifyContent:"center",children:i.jsxs(T,{marginInlineEnd:"auto",alignItems:"center",children:[i.jsx(Jz,{}),i.jsx(Qz,{})]})}),i.jsx(T,{flex:1,justifyContent:"center",alignItems:"center",children:i.jsx(T_e,{})}),i.jsx(T,{flex:1,justifyContent:"center",children:i.jsx(T,{marginInlineStart:"auto",alignItems:"center",children:e})})]}));sG.displayName="ViewerToolbar";var A_e=function(){},iG=typeof window<"u",M_e=iG?c.useLayoutEffect:c.useEffect,oG={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function E_e(){var e=c.useState(null),t=e[0],n=e[1],s=c.useState(oG),o=s[0],r=s[1],a=c.useMemo(function(){return new window.ResizeObserver(function(l){if(l[0]){var d=l[0].contentRect,u=d.x,h=d.y,p=d.width,f=d.height,m=d.top,g=d.left,x=d.bottom,b=d.right;r({x:u,y:h,width:p,height:f,top:m,left:g,bottom:x,right:b})}})},[]);return M_e(function(){if(t)return a.observe(t),function(){a.disconnect()}},[t]),[n,o]}const rG=iG&&typeof window.ResizeObserver<"u"?E_e:function(){return[A_e,oG]},P_e={focusOnMount:!0},L_e={display:"flex",width:"full",height:"full",position:"absolute",flexDirection:"column",inset:0,alignItems:"center",justifyContent:"center",overflow:"hidden"},cb=c.memo(({closeButton:e})=>{Pt("ImageViewer");const t=A(qte),[n,s]=rG();return i.jsxs($u,{region:"viewer",sx:L_e,layerStyle:"first",...P_e,children:[t&&i.jsx(ez,{}),!t&&i.jsx(sG,{closeButton:e}),i.jsxs(Ce,{ref:n,w:"full",h:"full",p:2,overflow:"hidden",children:[!t&&i.jsx(Vje,{}),t&&i.jsx(Yz,{containerDims:s})]}),i.jsx(Xz,{})]})});cb.displayName="ImageViewer";const aG=c.memo(()=>$t().isOpen?i.jsx(cb,{closeButton:i.jsx(nI,{})}):null);aG.displayName="GatedImageViewer";const nI=c.memo(()=>{const{t:e}=M(),t=$t();return Pt("ImageViewerCloseButton"),Eo("esc",t.close),i.jsx(le,{tooltip:e("gallery.closeViewer"),"aria-label":e("gallery.closeViewer"),icon:i.jsx(Rt,{}),variant:"link",alignSelf:"stretch",onClick:t.close})});nI.displayName="ImageViewerCloseButton";const D_e=c.memo(()=>$t().isOpen?i.jsx(nI,{}):null);D_e.displayName="GatedImageViewerCloseButton";const R_e={width:"full",height:"full"},xE=()=>i.jsx(Xo,{children:i.jsxs(Et,{children:[i.jsx(n$,{}),i.jsx(NB,{})]})}),lG=c.memo(()=>{const e=A(J0),t=A(Kte),n=c.useCallback(()=>i.jsx(xE,{}),[]);return i.jsx($u,{region:"canvas",sx:R_e,children:i.jsxs(T,{tabIndex:-1,borderRadius:"base",position:"relative",flexDirection:"column",height:"full",width:"full",gap:2,alignItems:"center",justifyContent:"center",overflow:"hidden",children:[i.jsx(Xo,{children:i.jsx(XV,{})}),i.jsx(Yx,{renderMenu:n,withLongPress:!1,children:s=>i.jsxs(T,{ref:s,position:"relative",w:"full",h:"full",bg:e?"base.850":"base.900",borderRadius:"base",overflow:"hidden",children:[i.jsx(z$,{}),i.jsxs(Xo,{children:[i.jsxs(T,{position:"absolute",flexDir:"column",top:1,insetInlineStart:1,pointerEvents:"none",gap:2,alignItems:"flex-start",children:[t&&i.jsx(R$,{}),i.jsx(QN,{}),i.jsx(GN,{}),i.jsx(owe,{}),i.jsx(V_,{})]}),i.jsx(T,{position:"absolute",top:1,insetInlineEnd:1,children:i.jsxs(on,{children:[i.jsx(rn,{as:le,icon:i.jsx(bfe,{}),colorScheme:"base"}),i.jsx(xE,{})]})}),i.jsx(T,{position:"absolute",bottom:4,insetInlineEnd:4,children:i.jsx(EB,{})})]})]})}),i.jsx(T,{position:"absolute",bottom:4,gap:2,align:"center",justify:"center",children:i.jsx(Xo,{children:i.jsx(K$,{children:i.jsx(iV,{})})})}),i.jsx(T,{position:"absolute",bottom:4,children:i.jsxs(Xo,{children:[i.jsx(E$,{}),i.jsx(Fke,{}),i.jsx(U$,{})]})}),i.jsx(Xo,{children:i.jsx(r$,{})}),i.jsx(aG,{})]})})});lG.displayName="CanvasMainPanelContent";const za=e=>{const t=A(Xx),n=A(YS),s=A(XS),o=A(QS),r=A(Qx);return c.useMemo(()=>{switch(e){case"reference_image":return!t&&!n&&!s&&!o;case"regional_guidance":return!t&&!n&&!s&&!o&&!r;case"control_layer":return!t&&!n&&!s&&!o&&!r;case"inpaint_mask":return!s&&!o&&!r;case"raster_layer":return!s&&!o&&!r;default:ve(!1)}},[e,t,n,s,o,r])},cG=c.memo(()=>{const{t:e}=M(),t=Aj(),n=Mj(),s=Tj(),o=Ij(),r=Ej(),a=nO(),l=za("reference_image"),d=za("regional_guidance"),u=za("control_layer"),h=za("inpaint_mask");return i.jsx(T,{w:"full",h:"full",justifyContent:"center",gap:4,children:i.jsxs(T,{position:"relative",flexDir:"column",gap:4,top:"20%",children:[i.jsxs(T,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[i.jsx(zt,{size:"xs",children:e("controlLayers.global")}),i.jsx($e,{feature:"globalReferenceImage",children:i.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:i.jsx(Vt,{}),onClick:r,isDisabled:!l,children:e("controlLayers.globalReferenceImage")})})]}),i.jsxs(T,{flexDir:"column",gap:2,children:[i.jsx(zt,{size:"xs",children:e("controlLayers.regional")}),i.jsx($e,{feature:"inpainting",children:i.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:i.jsx(Vt,{}),onClick:t,isDisabled:!h,children:e("controlLayers.inpaintMask")})}),i.jsx($e,{feature:"regionalGuidance",children:i.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:i.jsx(Vt,{}),onClick:n,isDisabled:!d,children:e("controlLayers.regionalGuidance")})}),i.jsx($e,{feature:"regionalReferenceImage",children:i.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:i.jsx(Vt,{}),onClick:a,isDisabled:!d,children:e("controlLayers.regionalReferenceImage")})})]}),i.jsxs(T,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[i.jsx(zt,{size:"xs",children:e("controlLayers.layer_other")}),i.jsx($e,{feature:"controlNet",children:i.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:i.jsx(Vt,{}),onClick:o,isDisabled:!u,children:e("controlLayers.controlLayer")})}),i.jsx($e,{feature:"rasterLayer",children:i.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:i.jsx(Vt,{}),onClick:s,children:e("controlLayers.rasterLayer")})})]})]})})});cG.displayName="CanvasAddEntityButtons";function Ef(e){"@babel/helpers - typeof";return Ef=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ef(e)}function O_e(e,t){if(Ef(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(Ef(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function N_e(e){var t=O_e(e,"string");return Ef(t)=="symbol"?t:t+""}function dG(e,t,n){return(t=N_e(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function bE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yE(Object(n),!0).forEach(function(s){dG(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yE(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var F_e={top:function(t,n){return Math.abs(n.y-t.top)},right:function(t,n){return Math.abs(t.right-n.x)},bottom:function(t,n){return Math.abs(t.bottom-n.y)},left:function(t,n){return Math.abs(n.x-t.left)}},uG=Symbol("closestEdge");function B_e(e,t){var n,s,o=t.element,r=t.input,a=t.allowedEdges,l={x:r.clientX,y:r.clientY},d=o.getBoundingClientRect(),u=a.map(function(p){return{edge:p,value:F_e[p](d,l)}}),h=(n=(s=u.sort(function(p,f){return p.value-f.value})[0])===null||s===void 0?void 0:s.edge)!==null&&n!==void 0?n:null;return bE(bE({},e),{},dG({},uG,h))}function Fw(e){var t;return(t=e[uG])!==null&&t!==void 0?t:null}function $_e(e){var t=e.list,n=e.startIndex,s=e.finishIndex;if(n===-1||s===-1)return Array.from(t);var o=Array.from(t),r=o.splice(n,1),a=Ok(r,1),l=a[0];return o.splice(s,0,l),o}function Bw(e){var t=e.startIndex,n=e.closestEdgeOfTarget,s=e.indexOfTarget,o=e.axis;if(t===-1||s===-1||t===s)return t;if(n==null)return s;var r=o==="vertical"&&n==="bottom"||o==="horizontal"&&n==="right",a=t<s;return a?r?s:s-1:r?s+1:s}function hG(e){var t=e.list,n=e.startIndex,s=e.closestEdgeOfTarget,o=e.indexOfTarget,r=e.axis;return $_e({list:t,startIndex:n,finishIndex:Bw({closestEdgeOfTarget:s,startIndex:n,indexOfTarget:o,axis:r})})}const hr=e=>`var(--invoke-colors-${e.split(".").join("-")})`,sI={overflow:"visible"},pG=c.memo(({type:e})=>{const{t}=M(),n=lt(),s=Aj(),o=Mj(),r=Tj(),a=Ij(),l=Ej(),d=c.useCallback(()=>{switch(e){case"inpaint_mask":s();break;case"regional_guidance":o();break;case"raster_layer":r();break;case"control_layer":a();break;case"reference_image":l();break}},[a,l,s,r,o,e]),u=c.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.addInpaintMask");case"regional_guidance":return t("controlLayers.addRegionalGuidance");case"raster_layer":return t("controlLayers.addRasterLayer");case"control_layer":return t("controlLayers.addControlLayer");case"reference_image":return t("controlLayers.addGlobalReferenceImage")}},[e,t]);return i.jsx(le,{size:"sm","aria-label":u,tooltip:u,variant:"link",icon:i.jsx(Ms,{}),onClick:d,alignSelf:"stretch",isDisabled:n})});pG.displayName="CanvasEntityAddOfTypeButton";const V_e=e=>{const t=c.useMemo(()=>{switch(e){case"control_layer":return he(GP,s=>s.length);case"raster_layer":return he(US,s=>s.length);case"inpaint_mask":return he(WP,s=>s.length);case"regional_guidance":return he(HP,s=>s.length);case"reference_image":return he(Zte,s=>s.length);default:ve(!1,"Invalid entity type")}},[e]);return A(t)},fG=c.memo(({type:e})=>{const{t}=M(),n=Lt(),s=lt(),o=V_e(e),r=c.useCallback(()=>{n.compositor.mergeVisibleOfType(e)},[n.compositor,e]);return i.jsx(le,{size:"sm","aria-label":t("controlLayers.mergeVisible"),tooltip:t("controlLayers.mergeVisible"),variant:"link",icon:i.jsx(ffe,{}),onClick:r,alignSelf:"stretch",isDisabled:o<=1||s})});fG.displayName="CanvasEntityMergeVisibleButton";const mG=c.memo(({type:e})=>{const{t}=M(),n=G(),s=Wj(e),o=JB(e,!0),r=c.useCallback(a=>{a.stopPropagation(),n(Yte({type:e}))},[n,e]);return i.jsx(le,{size:"sm","aria-label":t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:o}),tooltip:t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:o}),variant:"link",icon:s?i.jsx(Wpe,{}):i.jsx(Du,{}),onClick:r,alignSelf:"stretch"})});mG.displayName="CanvasEntityTypeIsHiddenToggle";const z_e=e=>c.useMemo(()=>{switch(e){case"control_layer":return"controlNet";case"inpaint_mask":return"inpainting";case"raster_layer":return"rasterLayer";case"regional_guidance":return"regionalGuidanceAndReferenceImage";case"reference_image":return"globalReferenceImage";default:return}},[e]),G_e=e=>{const t=c.useMemo(()=>he(Ye,s=>{switch(e){case"control_layer":return s.controlLayers.entities.length;case"raster_layer":return s.rasterLayers.entities.length;case"inpaint_mask":return s.inpaintMasks.entities.length;case"regional_guidance":return s.regionalGuidance.entities.length;case"reference_image":return s.referenceImages.entities.length;default:return 0}}),[e]);return A(t)},H_e=e=>{const{t}=M(),n=Wj(e),s=G_e(e);return c.useMemo(()=>{const r=n?"hidden":"visible";switch(e){case"control_layer":return t("controlLayers.controlLayers_withCount",{count:s,context:r});case"raster_layer":return t("controlLayers.rasterLayers_withCount",{count:s,context:r});case"inpaint_mask":return t("controlLayers.inpaintMasks_withCount",{count:s,context:r});case"regional_guidance":return t("controlLayers.regionalGuidance_withCount",{count:s,context:r});case"reference_image":return t("controlLayers.globalReferenceImages_withCount",{count:s,context:r});default:return""}},[e,t,s,n])},Zu=c.memo(({isSelected:e,type:t,children:n,entityIdentifiers:s})=>{const o=H_e(t),r=z_e(t),a=Hx(!0),l=G();return c.useEffect(()=>or({canMonitor({source:d}){return!(!Vd.typeGuard(d.data)||d.data.payload.entityIdentifier.type!==t)},onDrop({location:d,source:u}){const h=d.current.dropTargets[0];if(!h)return;const p=u.data,f=h.data;if(!Vd.typeGuard(p)||!Vd.typeGuard(f))return;const m=s.findIndex(y=>y.id===p.payload.entityIdentifier.id),g=s.findIndex(y=>y.id===f.payload.entityIdentifier.id);if(g<0||m<0||m===g)return;const x=Fw(f);let b=0;if(x==="bottom"?b=1:x==="top"&&(b=-1),m===g+b)return;wu.flushSync(()=>{l(Xte({type:t,entityIdentifiers:hG({list:s,startIndex:m,indexOfTarget:g,closestEdgeOfTarget:x,axis:"vertical"})}))});const C=document.querySelector(`[data-entity-id="${p.payload.entityIdentifier.id}"]`);C instanceof HTMLElement&&oz(C,hr("base.700"))}}),[l,s,t]),i.jsxs(T,{flexDir:"column",w:"full",children:[i.jsxs(T,{w:"full",children:[i.jsxs(T,{flexGrow:1,as:de,onClick:a.toggle,justifyContent:"space-between",alignItems:"center",gap:3,variant:"unstyled",p:0,h:8,children:[i.jsx(at,{boxSize:4,as:Bi,transform:a.isTrue?void 0:"rotate(-90deg)",fill:e?"base.200":"base.500",transitionProperty:"common",transitionDuration:"fast"}),r?i.jsx($e,{feature:r,children:i.jsx(W,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:o})}):i.jsx(W,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:o}),i.jsx(Je,{})]}),oC(t)&&i.jsx(fG,{type:t}),oC(t)&&i.jsx(mG,{type:t}),i.jsx(pG,{type:t})]}),i.jsx(ll,{in:a.isTrue,style:sI,children:i.jsx(T,{flexDir:"column",gap:2,pt:2,children:n})})]})});Zu.displayName="CanvasEntityGroupList";const o0={type:"idle"},W_e=(e,t)=>{const[n,s]=c.useState(o0),[o,r]=c.useState(!1);return c.useEffect(()=>{const a=e.current;if(a)return Xn(Uu(a),Eu({element:a,getInitialData(){return Vd.getData({entityIdentifier:t})},onDragStart(){s({type:"is-dragging"}),r(!0)},onDrop(){s(o0),r(!1)}}),Jd({element:a,canDrop({source:l}){return!(!Vd.typeGuard(l.data)||l.data.payload.entityIdentifier.type!==t.type)},getData({input:l}){const d=Vd.getData({entityIdentifier:t});return B_e(d,{element:a,input:l,allowedEdges:["top","bottom"]})},getIsSticky(){return!0},onDragEnter({self:l}){const d=Fw(l.data);s({type:"is-dragging-over",closestEdge:d})},onDrag({self:l}){const d=Fw(l.data);s(u=>u.type==="is-dragging-over"&&u.closestEdge===d?u:{type:"is-dragging-over",closestEdge:d})},onDragLeave(){s(o0)},onDrop(){s(o0)}}))},[t,e]),[n,o]},gG=e=>{const t=c.useMemo(()=>he(Mn,s=>(s==null?void 0:s.id)===e.id),[e.id]);return A(t)},W1={thickness:2,backgroundColor:"base.500"},U_e={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:W1.backgroundColor},q_e={horizontal:{height:`${W1.thickness}px`,left:2,right:2},vertical:{width:`${W1.thickness}px`,top:2,bottom:2}},K_e={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},Z_e={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function Y_e({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${W1.thickness}px))`,s=K_e[e];return i.jsx(Ce,{sx:{...U_e,...q_e[s],...Z_e[e],"--local-line-offset":n}})}const X_e=({dndState:e,gap:t})=>e.type!=="is-dragging-over"||!e.closestEdge?null:i.jsx(Y_e,{edge:e.closestEdge,gap:t||"var(--invoke-space-2)"}),Q_e={position:"relative",flexDir:"column",w:"full",bg:"base.850",borderRadius:"base","&[data-selected=true]":{bg:"base.800"},"&[data-is-dragging=true]":{opacity:.3},transitionProperty:"common"},Yu=c.memo(e=>{const t=G(),n=We(),s=gG(n),o=c.useCallback(()=>{s||t(Dd({entityIdentifier:n}))},[t,n,s]),r=c.useRef(null),[a,l]=W_e(r,n);return i.jsxs(Ce,{position:"relative",children:[i.jsx(T,{"data-entity-id":n.id,"data-selected":s,"data-is-dragging":l,ref:r,onClick:o,sx:Q_e,children:e.children}),i.jsx(X_e,{dndState:a})]})});Yu.displayName="CanvasEntityContainer";const Xu=c.memo(({children:e,...t})=>{const n=We(),s=c.useCallback(()=>{if(n.type==="regional_guidance")return i.jsx(Et,{children:i.jsx(L_,{})});if(n.type==="inpaint_mask")return i.jsx(Et,{children:i.jsx(M_,{})});if(n.type==="raster_layer")return i.jsx(Et,{children:i.jsx(P_,{})});if(n.type==="control_layer")return i.jsx(Et,{children:i.jsx(A_,{})});if(n.type==="reference_image")return i.jsx(Et,{children:i.jsx(E_,{})});ve(!1,"Unhandled entity type")},[n]);return i.jsx(Yx,{renderMenu:s,children:o=>i.jsx(T,{ref:o,gap:2,alignItems:"center",p:2,...t,children:e})})});Xu.displayName="CanvasEntityHeader";const xG=c.memo(()=>{const{t:e}=M(),t=We(),n=G(),s=lt(),o=c.useCallback(()=>{n(WS({entityIdentifier:t}))},[n,t]);return i.jsx(le,{size:"sm","aria-label":e("common.delete"),tooltip:e("common.delete"),variant:"link",alignSelf:"stretch",icon:i.jsx(My,{}),onClick:o,colorScheme:"error",isDisabled:s})});xG.displayName="CanvasEntityDeleteButton";const yG=e=>{const t=c.useMemo(()=>he(Ye,s=>{const o=rl(s,e);return o?o.isEnabled:!1}),[e]);return A(t)},bG=c.memo(()=>{const{t:e}=M(),t=We(),n=yG(t),s=lt(),o=G(),r=c.useCallback(()=>{o(Qte({entityIdentifier:t}))},[o,t]);return i.jsx(le,{size:"sm","aria-label":e(n?"common.enabled":"common.disabled"),tooltip:e(n?"common.enabled":"common.disabled"),variant:"link",alignSelf:"stretch",icon:n?i.jsx(xfe,{}):i.jsx(Bpe,{}),onClick:r,isDisabled:s})});bG.displayName="CanvasEntityEnabledToggle";const J_e=(e,t)=>he(Ye,Ex,(n,s)=>{const o=Cs(n,e,"CanvasEntityHeaderWarnings");let r=[];const a=o.type;return a==="control_layer"?r=D8(o,s):a==="regional_guidance"?r=O8(o,s):a==="inpaint_mask"?r=F8():a==="raster_layer"?r=N8():a==="reference_image"?r=R8(o,s):ve(!1,"Unexpected entity type"),r.length===0?Fs:r.map(l=>t(l)).map(Dl)}),vG=c.memo(()=>{const e=We(),{t}=M(),n=yG(e),s=c.useMemo(()=>J_e(e,t),[e,t]),o=A(s);return o.length===0?null:i.jsx(le,{as:"span",size:"sm",variant:"link",alignSelf:"stretch","aria-label":"warnings",tooltip:i.jsx(CG,{warnings:o}),icon:i.jsx(_m,{}),colorScheme:"warning",isDisabled:!n})});vG.displayName="CanvasEntityHeaderWarnings";const CG=c.memo(e=>{const{t}=M();return i.jsxs(T,{flexDir:"column",children:[i.jsxs(W,{children:[t("controlLayers.warnings.problemsFound"),":"]}),i.jsx(ai,{children:e.warnings.map((n,s)=>i.jsx(Ft,{children:n},s))})]})});CG.displayName="TooltipContent";const eIe=e=>{const t=c.useMemo(()=>he(Ye,s=>{var o;return((o=s.bookmarkedEntityIdentifier)==null?void 0:o.id)===e.id}),[e]);return A(t)},wG=c.memo(()=>{const{t:e}=M(),t=We(),n=eIe(t),s=G(),o=c.useCallback(()=>{s(n?z4({entityIdentifier:null}):z4({entityIdentifier:t}))},[s,t,n]);return i.jsx(le,{size:"sm","aria-label":e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),tooltip:e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),variant:"link",alignSelf:"stretch",icon:n?i.jsx(gfe,{}):i.jsx(Rpe,{}),onClick:o})});wG.displayName="CanvasEntityIsBookmarkedForQuickSwitchToggle";const SG=c.memo(()=>{const{t:e}=M(),t=We(),n=Ro(t),s=lt(),o=G(),r=c.useCallback(()=>{o(Jte({entityIdentifier:t}))},[o,t]);return i.jsx(le,{size:"sm","aria-label":e(n?"controlLayers.locked":"controlLayers.unlocked"),tooltip:e(n?"controlLayers.locked":"controlLayers.unlocked"),variant:"link",alignSelf:"stretch",icon:n?i.jsx(z7,{}):i.jsx(E7,{}),onClick:r,isDisabled:s})});SG.displayName="CanvasEntityIsLockedToggle";const Qu=c.memo(()=>{const e=We();return i.jsxs(T,{alignSelf:"stretch",children:[i.jsx(vG,{}),i.jsx(wG,{}),e.type!=="reference_image"&&i.jsx(SG,{}),i.jsx(bG,{}),i.jsx(xG,{})]})});Qu.displayName="CanvasEntityHeaderCommonActions";const kG=Sr.canvas,tIe=36,vE=`${tIe}px`,Km=c.memo(()=>{const e=We(),t=_ye(e),n=c.useMemo(()=>he(Ye,u=>{const h=rl(u,e);return h&&(h.type==="inpaint_mask"||h.type==="regional_guidance")?lc(h.fill.color):null}),[e]),s=JS(n),o=c.useRef(null),r=re(t.transformer.$pixelRect),a=re(t.transformer.$nodeRect),l=re(t.$canvasCache),d=c.useMemo(()=>Di(()=>{if(!o.current)return;const u=o.current.getContext("2d");if(!u)return;const h=t.transformer.$pixelRect.get(),p=t.transformer.$nodeRect.get(),f=t.$canvasCache.get();if(!f||f.width===0||f.height===0||h.width===0||h.height===0){u.clearRect(0,0,o.current.width,o.current.height);return}u.clearRect(0,0,o.current.width,o.current.height),o.current.width=h.width,o.current.height=h.height;const m=h.x-p.x,g=h.y-p.y,x=h.width,b=h.height,C=0,y=0,v=h.width,w=h.height;u.drawImage(f,m,g,x,b,C,y,v,w),s&&(u.fillStyle=s,u.globalCompositeOperation="source-in",u.fillRect(0,0,h.width,h.height))},300),[t.$canvasCache,t.transformer.$nodeRect,t.transformer.$pixelRect,s]);return c.useEffect(d,[d,l,a,r]),i.jsx(Oe,{label:i.jsx(nIe,{canvasRef:o}),p:2,closeOnScroll:!0,children:i.jsxs(T,{position:"relative",alignItems:"center",justifyContent:"center",w:vE,h:vE,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[i.jsx(Ce,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:Wu,bgSize:"5px"}),i.jsx(kG,{position:"relative",ref:o,objectFit:"contain",maxW:"full",maxH:"full"})]})})});Km.displayName="CanvasEntityPreviewImage";const nIe=({canvasRef:e})=>{const t=c.useRef(null);return c.useEffect(()=>{if(!t.current||!e.current)return;const n=t.current.getContext("2d");if(n){if(e.current.width===0||e.current.height===0){n.clearRect(0,0,t.current.width,t.current.height);return}t.current.width=e.current.width,t.current.height=e.current.height,n.clearRect(0,0,t.current.width,t.current.height),n.drawImage(e.current,0,0)}},[e]),i.jsxs(T,{position:"relative",alignItems:"center",justifyContent:"center",w:150,h:150,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[i.jsx(Ce,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:Wu,bgSize:"8px"}),i.jsx(kG,{position:"relative",ref:t,objectFit:"contain",maxW:"full",maxH:"full"})]})},Zm=c.memo(({children:e})=>i.jsx(T,{flexDir:"column",gap:2,px:2,pb:2,children:e}));Zm.displayName="CanvasEntitySettingsWrapper";const fa=({value:e,defaultValue:t,onChange:n,onStartEditing:s,inputRef:o})=>{const[r,a]=c.useState(!1),[l,d]=c.useState(e),u=c.useCallback(()=>{var x;const g=l.trim()||t;d(g),g!==e&&n(g),a(!1),(x=o==null?void 0:o.current)==null||x.setSelectionRange(0,0)},[l,t,e,o,n]),h=c.useCallback(m=>{d(m.target.value)},[]),p=c.useCallback(m=>{m.key==="Enter"&&!m.shiftKey?u():m.key==="Escape"&&(d(e),n(e),a(!1))},[n,u,e]),f=c.useCallback(()=>{a(!0),s==null||s()},[s]);return c.useEffect(()=>{d(e)},[e]),c.useEffect(()=>{var m,g;r&&((m=o==null?void 0:o.current)==null||m.focus(),(g=o==null?void 0:o.current)==null||g.select())},[o,r]),{isEditing:r,startEditing:f,value:l,inputProps:{value:l,onChange:h,onKeyDown:p,onBlur:u}}},jG=c.memo(e=>{const t=We(),n=gG(t),s=YN(t);return i.jsx(W,{size:"sm",fontWeight:"semibold",userSelect:"none",color:n?"base.100":"base.300",...e,children:s})});jG.displayName="CanvasEntityTitle";const Ju=c.memo(()=>{const e=G(),t=We(),n=c.useRef(null),s=KN(t),o=ZN(t.type),r=c.useCallback(l=>{e(ene({entityIdentifier:t,name:l}))},[e,t]),a=fa({value:s||o,defaultValue:o,onChange:r,inputRef:n});return a.isEditing?i.jsx(St,{ref:n,...a.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}}):i.jsx(jG,{cursor:"text",onDoubleClick:a.startEditing})});Ju.displayName="CanvasEntityTitleEdit";const sIe=e=>he(Ye,t=>Cs(t,e,"ControlLayerBadgesContent").withTransparencyEffect),_G=c.memo(()=>{const e=We("control_layer"),{t}=M(),n=c.useMemo(()=>sIe(e),[e]);return A(n)?i.jsx(Hn,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.transparency")}):null});_G.displayName="ControlLayerBadgesContent";const IG=c.memo(()=>{const e=We("control_layer");return i.jsx(ua,{entityIdentifier:e,children:i.jsx(_G,{})})});IG.displayName="ControlLayerBadges";const u2=Wn("gallery"),Rc=({onUpload:e,isDisabled:t,allowMultiple:n})=>{const s=A(qs),o=A(lP),[r,a]=iP(),l=kO(),{t:d}=M(),u=c.useCallback(async g=>{try{if(n){let x=[];o&&g.length>1?x=await Promise.all(g.map((b,C)=>l(b,C))):x=await cP(g.map((b,C)=>({file:b,image_category:"user",is_intermediate:!1,board_id:s==="none"?void 0:s,silent:!1,isFirstUploadOfBatch:C===0}))),e&&e(x)}else{if(g.length>1){u2.warn("Multiple files dropped but only one allowed");return}if(g.length===0){u2.warn("No files dropped");return}const x=g[0];ve(x!==void 0);const b=await r({file:x,image_category:"user",is_intermediate:!1,board_id:s==="none"?void 0:s,silent:!0}).unwrap();e&&e(b)}}catch{ge({id:"UPLOAD_FAILED",title:d("toast.imageUploadFailed"),status:"error"})}},[n,s,e,r,o,l,d]),h=c.useCallback(g=>{if(g.length>0){const x=g.map(C=>({errors:C.errors.map(({message:y})=>y),file:C.file.path}));u2.error({errors:x},"Invalid upload");const b=d("toast.uploadFailedInvalidUploadDesc");ge({id:"UPLOAD_FAILED",title:d("toast.uploadFailed"),description:b,status:"error"});return}},[d]),{getRootProps:p,getInputProps:f,open:m}=da({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"],"image/webp":[".webp"]},onDropAccepted:u,onDropRejected:h,disabled:t,noDrag:!0,multiple:n});return{getUploadButtonProps:p,getUploadInputProps:f,openUploader:m,request:a}},TG={"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid",borderWidth:1}},iI=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const o=Rc({isDisabled:e,allowMultiple:!1,onUpload:t});return i.jsxs(i.Fragment,{children:[i.jsx(le,{"aria-label":"Upload image",variant:"outline",sx:TG,"data-error":n,icon:i.jsx(km,{}),isLoading:o.request.isLoading,...s,...o.getUploadButtonProps()}),i.jsx("input",{...o.getUploadInputProps()})]})},iIe=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const o=Rc({isDisabled:e,allowMultiple:!0,onUpload:t});return i.jsxs(i.Fragment,{children:[i.jsx(le,{"aria-label":"Upload image",variant:"outline",sx:TG,"data-error":n,icon:i.jsx(km,{}),isLoading:o.request.isLoading,...s,...o.getUploadButtonProps()}),i.jsx("input",{...o.getUploadInputProps()})]})},oIe=e=>`${Math.round(e*100)}%`,rIe=["Begin Step %","End Step %"],db=c.memo(({beginEndStepPct:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(()=>{t([0,1])},[t]);return i.jsxs(Q,{orientation:"horizontal",pe:2,children:[i.jsx($e,{feature:"controlNetBeginEnd",children:i.jsx(J,{m:0,children:n("controlLayers.beginEndStepPercentShort")})}),i.jsx(tne,{"aria-label":rIe,value:e,onChange:t,onReset:s,min:0,max:1,step:.05,fineStep:.01,minStepsBetweenThumbs:1,formatValue:oIe,marks:!0,withThumbTooltip:!0})]})});db.displayName="BeginEndStepPct";const aIe=e=>e.toFixed(2),lIe=[0,1,2],cIe=he(Ri,e=>e.sd.ca.weight),ub=c.memo(({weight:e,onChange:t})=>{const{t:n}=M(),s=A(cIe);return i.jsxs(Q,{orientation:"horizontal",children:[i.jsx($e,{feature:"controlNetWeight",children:i.jsx(J,{m:0,children:n("controlLayers.weight")})}),i.jsx(Ze,{value:e,onChange:t,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,marks:lIe,formatValue:aIe}),i.jsx(_e,{value:e,onChange:t,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,maxW:20,defaultValue:s.initial})]})});ub.displayName="Weight";const AG=c.memo(({controlMode:e,onChange:t})=>{const{t:n}=M(),s=c.useMemo(()=>[{label:n("controlLayers.controlMode.balanced"),value:"balanced"},{label:n("controlLayers.controlMode.prompt"),value:"more_prompt"},{label:n("controlLayers.controlMode.control"),value:"more_control"},{label:n("controlLayers.controlMode.megaControl"),value:"unbalanced"}],[n]),o=c.useCallback(a=>{ve(nne(a==null?void 0:a.value)),t(a.value)},[t]),r=c.useMemo(()=>s.filter(a=>a.value===e)[0],[s,e]);return e?i.jsxs(Q,{children:[i.jsx($e,{feature:"controlNetControlMode",children:i.jsx(J,{m:0,children:n("controlLayers.controlMode.controlMode")})}),i.jsx(Ke,{value:r,options:s,onChange:o,isClearable:!1,isSearchable:!1})]}):null});AG.displayName="ControlLayerControlAdapterControlMode";const dIe=e=>e.base.toUpperCase(),uIe=e=>`${e.base.toUpperCase()} / ${e.type.replaceAll("_"," ").toUpperCase()}`,hIe=he(mu,e=>{var t;return((t=e.model)==null?void 0:t.base)??"sdxl"}),ma=e=>{const{t}=M(),n=A(hIe),s=A(Ux),{modelConfigs:o,selectedModel:r,getIsDisabled:a,onChange:l,isLoading:d,groupByType:u=!1}=e,h=c.useMemo(()=>{if(!o)return[];const x=vS(o,u?uIe:dIe),b=f8(x,(C,y,v)=>(C.push({label:v,options:y.map(w=>({label:w.name,value:w.key,description:s&&w.description||void 0,isDisabled:a?a(w):!1}))}),C),[]);return b.sort(C=>{var y,v;return(v=(y=C.label)==null?void 0:y.split("/")[0])!=null&&v.toLowerCase().includes(n)?-1:1}),b},[o,u,a,n,s]),p=c.useMemo(()=>h.flatMap(x=>x.options).find(x=>r?x.value===r.key:!1)??null,[h,r]),f=c.useCallback(x=>{if(!x){l(null);return}const b=o.find(C=>C.key===x.value);if(!b){l(null);return}l(b)},[o,l]),m=c.useMemo(()=>d?t("common.loading"):h.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[d,h,t]),g=c.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:h,value:p,onChange:f,placeholder:m,noOptionsMessage:g}},MG=c.memo(({modelKey:e,onChange:t})=>{const{t:n}=M(),s=A(la),[o,{isLoading:r}]=ame(),a=c.useMemo(()=>o.find(m=>m.key===e),[o,e]),l=c.useCallback(m=>{m&&t(m)},[t]),d=c.useCallback(m=>{const g=s===m.base;return!!!s||!g},[s]),{options:u,value:h,onChange:p,noOptionsMessage:f}=ma({modelConfigs:o,onChange:l,selectedModel:a,getIsDisabled:d,isLoading:r,groupByType:!0});return i.jsx(Oe,{label:a==null?void 0:a.description,children:i.jsx(Q,{isInvalid:!h||s!==(a==null?void 0:a.base),w:"full",children:i.jsx(Ke,{options:u,placeholder:n("common.placeholderSelectAModel"),value:h,onChange:p,noOptionsMessage:f})})})});MG.displayName="ControlLayerControlAdapterModel";const pIe=e=>he(Ye,t=>Cs(t,e,"ControlLayerControlAdapter").controlAdapter),EG=c.memo(()=>{var C;const{t:e}=M(),{dispatch:t,getState:n}=cn(),s=We("control_layer"),o=c.useMemo(()=>pIe(s),[s]),r=A(o),a=Qy(s),l=A(Ya),d=jye("control_layer"),u=c.useCallback(y=>{t(sne({entityIdentifier:s,beginEndStepPct:y}))},[t,s]),h=c.useCallback(y=>{t(ine({entityIdentifier:s,controlMode:y}))},[t,s]),p=c.useCallback(y=>{t(one({entityIdentifier:s,weight:y}))},[t,s]),f=c.useCallback(y=>{t(rne({entityIdentifier:s,modelConfig:y}));const v=d.filterer.$isFiltering.get(),w=d.filterer.$simple.get();if(v&&!w)return;const k=h$(y);if(!k){v&&d.filterer.cancel();return}const S=k.buildDefaults();v?(d.filterer.$filterConfig.set(S),d.filterer.process()):d.filterer.start(S)},[d.filterer,t,s]),m=RB(s),g=lt(),x=c.useMemo(()=>({onUpload:y=>{Nj({entityIdentifier:s,imageDTO:y,dispatch:t,getState:n})},allowMultiple:!1}),[t,s,n]),b=Rc(x);return i.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",children:[i.jsxs(T,{w:"full",gap:2,children:[i.jsx(MG,{modelKey:((C=r.model)==null?void 0:C.key)??null,onChange:f}),i.jsx(le,{onClick:a.start,isDisabled:a.isDisabled,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:i.jsx(uj,{})}),i.jsx(le,{onClick:m,isDisabled:g,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.pullBboxIntoLayer"),tooltip:e("controlLayers.pullBboxIntoLayer"),icon:i.jsx(pl,{})}),i.jsx(le,{isDisabled:g,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("accessibility.uploadImage"),tooltip:e("accessibility.uploadImage"),icon:i.jsx(km,{}),...b.getUploadButtonProps()}),i.jsx("input",{...b.getUploadInputProps()})]}),i.jsx(ub,{weight:r.weight,onChange:p}),r.type!=="control_lora"&&i.jsx(db,{beginEndStepPct:r.beginEndStepPct,onChange:u}),r.type==="controlnet"&&!l&&i.jsx(AG,{controlMode:r.controlMode,onChange:h})]})});EG.displayName="ControlLayerControlAdapter";const PG=c.memo(()=>{const e=We("control_layer"),{dispatch:t,getState:n}=cn(),s=lt(),o=c.useCallback(u=>{Nj({imageDTO:u,entityIdentifier:e,dispatch:t,getState:n})},[t,e,n]),r=Rc({onUpload:o,allowMultiple:!1}),a=c.useCallback(()=>{t(ji("gallery"))},[t]),l=RB(e),d=c.useMemo(()=>({UploadButton:i.jsx(de,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...r.getUploadButtonProps()}),GalleryButton:i.jsx(de,{onClick:a,isDisabled:s,size:"sm",variant:"link",color:"base.300"}),PullBboxButton:i.jsx(de,{onClick:l,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}),[s,a,l,r]);return i.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[i.jsx(W,{textAlign:"center",color:"base.300",children:i.jsx(Wt,{i18nKey:"controlLayers.controlLayerEmptyState",components:d})}),i.jsx("input",{...r.getUploadInputProps()})]})});PG.displayName="ControlLayerSettingsEmptyState";const LG=c.memo(()=>{const e=We();return $m(e)?i.jsx(PG,{}):i.jsx(EG,{})});LG.displayName="ControlLayerSettings";const DG=c.memo(({id:e})=>{const{t}=M(),n=lt(),s=c.useMemo(()=>({id:e,type:"control_layer"}),[e]),o=c.useMemo(()=>Tf.getData({entityIdentifier:s},s.id),[s]);return i.jsx(Lc.Provider,{value:s,children:i.jsx(WN,{children:i.jsx(ua,{entityIdentifier:s,children:i.jsxs(Yu,{children:[i.jsxs(Xu,{children:[i.jsx(Km,{}),i.jsx(Ju,{}),i.jsx(Je,{}),i.jsx(IG,{}),i.jsx(Qu,{})]}),i.jsx(Zm,{children:i.jsx(LG,{})}),i.jsx(Ls,{dndTarget:Tf,dndTargetData:o,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});DG.displayName="ControlLayer";const fIe=fn(Ye,e=>e.controlLayers.entities.map(ni).toReversed()),mIe=he(Mn,e=>(e==null?void 0:e.type)==="control_layer"),RG=c.memo(()=>{const e=A(mIe),t=A(fIe);if(t.length===0)return null;if(t.length>0)return i.jsx(Zu,{type:"control_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>i.jsx(DG,{id:n.id},n.id))})});RG.displayName="ControlLayerEntityList";const oI=c.memo(({onDelete:e,...t})=>{const{t:n}=M();return i.jsx(le,{tooltip:n("common.delete"),variant:"link","aria-label":n("common.delete"),icon:i.jsx(Rt,{}),onClick:e,flexGrow:0,size:"sm",p:0,colorScheme:"error",...t})});oI.displayName="InpaintMaskDeleteNoiseButton";const OG=c.memo(()=>{const e=We("inpaint_mask"),{t}=M(),n=G(),s=c.useMemo(()=>he(Ye,l=>Cs(l,e,"InpaintMaskDenoiseLimitSlider").denoiseLimit),[e]),o=A(s),r=c.useCallback(l=>{n(ane({entityIdentifier:e,denoiseLimit:l}))},[n,e]),a=c.useCallback(()=>{n(lne({entityIdentifier:e}))},[n,e]);return o===void 0?null:i.jsxs(T,{direction:"column",gap:1,w:"full",px:2,pb:2,children:[i.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[i.jsx(W,{fontSize:"sm",children:t("controlLayers.denoiseLimit")}),i.jsxs(T,{alignItems:"center",gap:1,children:[i.jsx(W,{fontSize:"sm",children:o.toFixed(2)}),i.jsx(oI,{onDelete:a})]})]}),i.jsxs(wL,{"aria-label":t("controlLayers.denoiseLimit"),value:o,min:0,max:1,step:.01,onChange:r,children:[i.jsx(SL,{children:i.jsx(kL,{})}),i.jsx(jL,{})]})]})});OG.displayName="InpaintMaskDenoiseLimitSlider";const NG=c.memo(()=>{const e=We("inpaint_mask"),{t}=M(),n=G(),s=c.useMemo(()=>he(Ye,l=>Cs(l,e,"InpaintMaskNoiseSlider").noiseLevel),[e]),o=A(s),r=c.useCallback(l=>{n(cne({entityIdentifier:e,noiseLevel:l}))},[n,e]),a=c.useCallback(()=>{n(dne({entityIdentifier:e}))},[n,e]);return o===void 0?null:i.jsxs(T,{direction:"column",gap:1,w:"full",px:2,pb:2,children:[i.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[i.jsx(W,{fontSize:"sm",children:t("controlLayers.imageNoise")}),i.jsxs(T,{alignItems:"center",gap:1,children:[i.jsxs(W,{fontSize:"sm",children:[Math.round(o*100),"%"]}),i.jsx(oI,{onDelete:a})]})]}),i.jsxs(wL,{"aria-label":t("controlLayers.imageNoise"),value:o,min:0,max:1,step:.01,onChange:r,children:[i.jsx(SL,{children:i.jsx(kL,{})}),i.jsx(jL,{})]})]})});NG.displayName="InpaintMaskNoiseSlider";const gIe=e=>he(Ye,t=>Cs(t,e,"InpaintMaskSettings").denoiseLimit!==void 0),xIe=e=>he(Ye,t=>Cs(t,e,"InpaintMaskSettings").noiseLevel!==void 0),FG=c.memo(()=>{const e=We("inpaint_mask"),t=c.useMemo(()=>gIe(e),[e]),n=c.useMemo(()=>xIe(e),[e]),s=A(t),o=A(n);return!o&&!s?null:i.jsxs(Zm,{children:[o&&i.jsx(NG,{}),s&&i.jsx(OG,{})]})});FG.displayName="InpaintMaskSettings";const BG=c.memo(({id:e})=>{const t=c.useMemo(()=>({id:e,type:"inpaint_mask"}),[e]);return i.jsx(Lc.Provider,{value:t,children:i.jsx(UN,{children:i.jsx(ua,{entityIdentifier:t,children:i.jsxs(Yu,{children:[i.jsxs(Xu,{children:[i.jsx(Km,{}),i.jsx(Ju,{}),i.jsx(Je,{}),i.jsx(Qu,{})]}),i.jsx(FG,{})]})})})})});BG.displayName="InpaintMask";const yIe=fn(Ye,e=>e.inpaintMasks.entities.map(ni).toReversed()),bIe=he(Mn,e=>(e==null?void 0:e.type)==="inpaint_mask"),$G=c.memo(()=>{const e=A(bIe),t=A(yIe);if(t.length===0)return null;if(t.length>0)return i.jsx(Zu,{type:"inpaint_mask",isSelected:e,entityIdentifiers:t,children:t.map(n=>i.jsx(BG,{id:n.id},n.id))})});$G.displayName="InpaintMaskList";const $w="ViT-L",CE=[{label:"ViT-H",value:"ViT-H"},{label:"ViT-G",value:"ViT-G"},{label:$w,value:$w}],rI=c.memo(({model:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(l=>{ve(une(l==null?void 0:l.value)),t(l.value)},[t]),o=A(Ya),r=c.useMemo(()=>CE.map(l=>({...l,isDisabled:o&&l.value!==$w})),[o]),a=c.useMemo(()=>CE.find(l=>l.value===e),[e]);return i.jsx(Q,{width:"max-content",minWidth:28,children:i.jsx(Ke,{options:r,placeholder:n("common.placeholderSelectAModel"),value:a,onChange:s})})});rI.displayName="CLIPVisionModel";const aI=c.memo(({imageInfluence:e,onChange:t})=>{const{t:n}=M(),s=c.useMemo(()=>[{label:n("controlLayers.fluxReduxImageInfluence.lowest"),value:"lowest"},{label:n("controlLayers.fluxReduxImageInfluence.low"),value:"low"},{label:n("controlLayers.fluxReduxImageInfluence.medium"),value:"medium"},{label:n("controlLayers.fluxReduxImageInfluence.high"),value:"high"},{label:n("controlLayers.fluxReduxImageInfluence.highest"),value:"highest"}],[n]),o=c.useCallback(a=>{ve(hne(a==null?void 0:a.value)),t(a.value)},[t]),r=c.useMemo(()=>s.find(a=>a.value===e),[s,e]);return i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.fluxReduxImageInfluence.imageInfluence")}),i.jsx(Ke,{value:r,options:s,onChange:o})]})});aI.displayName="FLUXReduxImageInfluence";const VG=c.memo(({modelKey:e,onChangeModel:t})=>{const{t:n}=M(),s=A(la),[o,{isLoading:r}]=cme(),a=c.useMemo(()=>o.find(m=>m.key===e),[o,e]),l=c.useCallback(m=>{m&&t(m)},[t]),d=c.useCallback(m=>{const g=!!s,x=s===m.base;return!g||!x},[s]),{options:u,value:h,onChange:p,noOptionsMessage:f}=ma({modelConfigs:o,onChange:l,selectedModel:a,getIsDisabled:d,isLoading:r});return i.jsx(Oe,{label:a==null?void 0:a.description,children:i.jsx(Q,{isInvalid:!h||s!==(a==null?void 0:a.base),w:"full",children:i.jsx(Ke,{options:u,placeholder:n("common.placeholderSelectAModel"),value:h,onChange:p,noOptionsMessage:f})})})});VG.displayName="GlobalReferenceImageModel";const lI=c.memo(({method:e,onChange:t})=>{const{t:n}=M(),s=A(Ux),o=c.useMemo(()=>[{label:n("controlLayers.ipAdapterMethod.full"),value:"full",description:s?n("controlLayers.ipAdapterMethod.fullDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.style"),value:"style",description:s?n("controlLayers.ipAdapterMethod.styleDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.styleStrong"),value:"style_strong",description:s?n("controlLayers.ipAdapterMethod.styleStrongDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.stylePrecise"),value:"style_precise",description:s?n("controlLayers.ipAdapterMethod.stylePreciseDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.composition"),value:"composition",description:s?n("controlLayers.ipAdapterMethod.compositionDesc"):void 0}],[n,s]),r=c.useCallback(l=>{ve(pne(l==null?void 0:l.value)),t(l.value)},[t]),a=c.useMemo(()=>o.find(l=>l.value===e),[o,e]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"ipAdapterMethod",children:i.jsx(J,{m:0,children:n("controlLayers.ipAdapterMethod.ipAdapterMethod")})}),i.jsx(Ke,{value:a,options:o,onChange:r})]})});lI.displayName="IPAdapterMethod";const zG=c.memo(()=>{const{t:e}=M(),t=We("reference_image"),n=G(),s=lt(),o=c.useCallback(h=>{fO({imageDTO:h,entityIdentifier:t,dispatch:n})},[n,t]),r=Rc({onUpload:o,allowMultiple:!1}),a=c.useCallback(()=>{n(ji("gallery"))},[n]),l=j_(t),d=c.useMemo(()=>_f.getData({entityIdentifier:t}),[t]),u=c.useMemo(()=>({UploadButton:i.jsx(de,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...r.getUploadButtonProps()}),GalleryButton:i.jsx(de,{onClick:a,isDisabled:s,size:"sm",variant:"link",color:"base.300"}),PullBboxButton:i.jsx(de,{onClick:l,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}),[s,a,l,r]);return i.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[i.jsx(W,{textAlign:"center",color:"base.300",children:i.jsx(Wt,{i18nKey:"controlLayers.referenceImageEmptyState",components:u})}),i.jsx("input",{...r.getUploadInputProps()}),i.jsx(Ls,{dndTarget:_f,dndTargetData:d,label:e("controlLayers.useImage"),isDisabled:s})]})});zG.displayName="IPAdapterSettingsEmptyState";const cI=c.memo(({image:e,onChangeImage:t,dndTarget:n,dndTargetData:s})=>{const{t:o}=M(),r=re(Jn),{currentData:a,isError:l}=ul((e==null?void 0:e.image_name)??cs),d=c.useCallback(()=>{t(null)},[t]);c.useEffect(()=>{r&&l&&d()},[d,l,r]);const u=c.useCallback(h=>{t(h)},[t]);return i.jsxs(T,{position:"relative",w:"full",h:"full",alignItems:"center","data-error":!a&&!(e!=null&&e.image_name),children:[!a&&i.jsx(iI,{w:"full",h:"full",isError:!a&&!(e!=null&&e.image_name),onUpload:u,fontSize:36}),a&&i.jsxs(i.Fragment,{children:[i.jsx(vl,{imageDTO:a,borderWidth:1,borderStyle:"solid",w:"full"}),i.jsx(T,{position:"absolute",flexDir:"column",top:2,insetInlineEnd:2,gap:1,children:i.jsx(oa,{onClick:d,icon:i.jsx(Zs,{size:16}),tooltip:o("common.reset")})})]}),i.jsx(Ls,{dndTarget:n,dndTargetData:s,label:o("gallery.drop")})]})});cI.displayName="IPAdapterImagePreview";const vIe=e=>he(Ye,t=>Cs(t,e,"IPAdapterSettings").ipAdapter),GG=c.memo(()=>{var b,C;const{t:e}=M(),t=G(),n=We("reference_image"),s=c.useMemo(()=>vIe(n),[n]),o=A(s),r=c.useCallback(y=>{t(fne({entityIdentifier:n,beginEndStepPct:y}))},[t,n]),a=c.useCallback(y=>{t(mne({entityIdentifier:n,weight:y}))},[t,n]),l=c.useCallback(y=>{t(gne({entityIdentifier:n,method:y}))},[t,n]),d=c.useCallback(y=>{t(xne({entityIdentifier:n,imageInfluence:y}))},[t,n]),u=c.useCallback(y=>{t(yne({entityIdentifier:n,modelConfig:y}))},[t,n]),h=c.useCallback(y=>{t(bne({entityIdentifier:n,clipVisionModel:y}))},[t,n]),p=c.useCallback(y=>{t(MS({entityIdentifier:n,imageDTO:y}))},[t,n]),f=c.useMemo(()=>{var y;return _f.getData({entityIdentifier:n},(y=o.image)==null?void 0:y.image_name)},[n,(b=o.image)==null?void 0:b.image_name]),m=j_(n),g=lt(),x=A(Ya);return i.jsx(Zm,{children:i.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[i.jsxs(T,{gap:2,alignItems:"center",w:"full",children:[i.jsx(VG,{modelKey:((C=o.model)==null?void 0:C.key)??null,onChangeModel:u}),o.type==="ip_adapter"&&i.jsx(rI,{model:o.clipVisionModel,onChange:h}),i.jsx(le,{onClick:m,isDisabled:g,variant:"ghost","aria-label":e("controlLayers.pullBboxIntoReferenceImage"),tooltip:e("controlLayers.pullBboxIntoReferenceImage"),icon:i.jsx(pl,{})})]}),i.jsxs(T,{gap:2,w:"full",children:[o.type==="ip_adapter"&&i.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[!x&&i.jsx(lI,{method:o.method,onChange:l}),i.jsx(ub,{weight:o.weight,onChange:a}),i.jsx(db,{beginEndStepPct:o.beginEndStepPct,onChange:r})]}),o.type==="flux_redux"&&i.jsx(T,{flexDir:"column",gap:2,w:"full",alignItems:"flex-start",children:i.jsx(aI,{imageInfluence:o.imageInfluence??"lowest",onChange:d})}),i.jsx(T,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",flexGrow:1,children:i.jsx(cI,{image:o.image,onChangeImage:p,dndTarget:_f,dndTargetData:f})})]})]})})});GG.displayName="IPAdapterSettingsContent";const CIe=e=>he(Ye,t=>{const n=rl(t,e);return!!n&&n.ipAdapter.image!==null}),HG=c.memo(()=>{const e=We("reference_image"),t=c.useMemo(()=>CIe(e),[e]);return A(t)?i.jsx(GG,{}):i.jsx(zG,{})});HG.displayName="IPAdapterSettings";const WG=c.memo(({id:e})=>{const t=c.useMemo(()=>({id:e,type:"reference_image"}),[e]);return i.jsx(Lc.Provider,{value:t,children:i.jsx(ua,{entityIdentifier:t,children:i.jsxs(Yu,{children:[i.jsxs(Xu,{ps:4,py:5,children:[i.jsx(Ju,{}),i.jsx(Je,{}),i.jsx(Qu,{})]}),i.jsx(HG,{})]})})})});WG.displayName="IPAdapter";const wIe=fn(Ye,e=>e.referenceImages.entities.map(ni).toReversed()),SIe=he(Mn,e=>(e==null?void 0:e.type)==="reference_image"),UG=c.memo(()=>{const e=A(SIe),t=A(wIe);if(t.length===0)return null;if(t.length>0)return i.jsx(Zu,{type:"reference_image",isSelected:e,entityIdentifiers:t,children:t.map(n=>i.jsx(WG,{id:n.id},n.id))})});UG.displayName="IPAdapterList";const qG=c.memo(({id:e})=>{const{t}=M(),n=lt(),s=c.useMemo(()=>({id:e,type:"raster_layer"}),[e]),o=c.useMemo(()=>Tf.getData({entityIdentifier:s},s.id),[s]);return i.jsx(Lc.Provider,{value:s,children:i.jsx(HN,{children:i.jsx(ua,{entityIdentifier:s,children:i.jsxs(Yu,{children:[i.jsxs(Xu,{children:[i.jsx(Km,{}),i.jsx(Ju,{}),i.jsx(Je,{}),i.jsx(Qu,{})]}),i.jsx(Ls,{dndTarget:Tf,dndTargetData:o,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});qG.displayName="RasterLayer";const kIe=fn(Ye,e=>e.rasterLayers.entities.map(ni).toReversed()),jIe=he(Mn,e=>(e==null?void 0:e.type)==="raster_layer"),KG=c.memo(()=>{const e=A(jIe),t=A(kIe);if(t.length===0)return null;if(t.length>0)return i.jsx(Zu,{type:"raster_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>i.jsx(qG,{id:n.id},n.id))})});KG.displayName="RasterLayerEntityList";const ZG=c.memo(()=>{const e=We("regional_guidance"),{t}=M(),n=c.useMemo(()=>he(Ye,o=>Cs(o,e,"RegionalGuidanceBadges").autoNegative),[e]),s=A(n);return i.jsx(i.Fragment,{children:s&&i.jsx(Hn,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.autoNegative")})})});ZG.displayName="RegionalGuidanceBadges";const _Ie=()=>{const e=We("regional_guidance"),{t}=M(),n=sO(e),s=iO(e),o=oO(e),r=c.useMemo(()=>rO(e),[e]),a=A(r);return i.jsxs(T,{w:"full",p:2,justifyContent:"space-between",children:[i.jsx(de,{size:"sm",variant:"ghost",leftIcon:i.jsx(Vt,{}),onClick:s,isDisabled:!a.canAddPositivePrompt,children:t("controlLayers.prompt")}),i.jsx(de,{size:"sm",variant:"ghost",leftIcon:i.jsx(Vt,{}),onClick:o,isDisabled:!a.canAddNegativePrompt,children:t("controlLayers.negativePrompt")}),i.jsx(de,{size:"sm",variant:"ghost",leftIcon:i.jsx(Vt,{}),onClick:n,children:t("controlLayers.referenceImage")})]})},IIe=e=>!(e.base==="flux"&&e.type==="ip_adapter"),YG=c.memo(({modelKey:e,onChangeModel:t})=>{const{t:n}=M(),s=A(la),[o,{isLoading:r}]=dme(IIe),a=c.useMemo(()=>o.find(m=>m.key===e),[o,e]),l=c.useCallback(m=>{m&&t(m)},[t]),d=c.useCallback(m=>{const g=!!s,x=s===m.base;return!g||!x},[s]),{options:u,value:h,onChange:p,noOptionsMessage:f}=ma({modelConfigs:o,onChange:l,selectedModel:a,getIsDisabled:d,isLoading:r});return i.jsx(Oe,{label:a==null?void 0:a.description,children:i.jsx(Q,{isInvalid:!h||s!==(a==null?void 0:a.base),w:"full",children:i.jsx(Ke,{options:u,placeholder:n("common.placeholderSelectAModel"),value:h,onChange:p,noOptionsMessage:f})})})});YG.displayName="RegionalReferenceImageModel";const XG=c.memo(({referenceImageId:e})=>{const{t}=M(),n=We("regional_guidance"),s=G(),o=lt(),r=c.useCallback(f=>{mO({imageDTO:f,entityIdentifier:n,referenceImageId:e,dispatch:s})},[s,n,e]),a=Rc({onUpload:r,allowMultiple:!1}),l=c.useCallback(()=>{s(ji("gallery"))},[s]),d=c.useCallback(()=>{s(_L({entityIdentifier:n,referenceImageId:e}))},[s,n,e]),u=OB(n,e),h=c.useMemo(()=>If.getData({entityIdentifier:n,referenceImageId:e}),[n,e]),p=c.useMemo(()=>({UploadButton:i.jsx(de,{isDisabled:o,size:"sm",variant:"link",color:"base.300",...a.getUploadButtonProps()}),GalleryButton:i.jsx(de,{onClick:l,isDisabled:o,size:"sm",variant:"link",color:"base.300"}),PullBboxButton:i.jsx(de,{onClick:u,isDisabled:o,size:"sm",variant:"link",color:"base.300"})}),[o,l,u,a]);return i.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[i.jsxs(T,{alignItems:"center",gap:2,children:[i.jsx(W,{fontWeight:"semibold",color:"base.400",children:t("controlLayers.referenceImage")}),i.jsx(Je,{}),i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch",icon:i.jsx(Rt,{}),tooltip:t("controlLayers.deleteReferenceImage"),"aria-label":t("controlLayers.deleteReferenceImage"),onClick:d,colorScheme:"error"})]}),i.jsx(T,{alignItems:"center",gap:2,p:4,children:i.jsx(W,{textAlign:"center",color:"base.300",children:i.jsx(Wt,{i18nKey:"controlLayers.referenceImageEmptyState",components:p})})}),i.jsx("input",{...a.getUploadInputProps()}),i.jsx(Ls,{dndTarget:If,dndTargetData:h,label:t("controlLayers.useImage"),isDisabled:o})]})});XG.displayName="RegionalGuidanceIPAdapterSettingsEmptyState";const QG=c.memo(({referenceImageId:e})=>{var C,y;const t=We("regional_guidance"),{t:n}=M(),s=G(),o=c.useCallback(()=>{s(_L({entityIdentifier:t,referenceImageId:e}))},[s,t,e]),r=c.useMemo(()=>he(Ye,v=>{const w=IL(v,t,e);return ve(w,`Regional Guidance IP Adapter with id ${e} not found`),w.ipAdapter}),[t,e]),a=A(r),l=c.useCallback(v=>{s(vne({entityIdentifier:t,referenceImageId:e,beginEndStepPct:v}))},[s,t,e]),d=c.useCallback(v=>{s(Cne({entityIdentifier:t,referenceImageId:e,weight:v}))},[s,t,e]),u=c.useCallback(v=>{s(wne({entityIdentifier:t,referenceImageId:e,method:v}))},[s,t,e]),h=c.useCallback(v=>{s(Sne({entityIdentifier:t,referenceImageId:e,imageInfluence:v}))},[s,t,e]),p=c.useCallback(v=>{s(kne({entityIdentifier:t,referenceImageId:e,modelConfig:v}))},[s,t,e]),f=c.useCallback(v=>{s(jne({entityIdentifier:t,referenceImageId:e,clipVisionModel:v}))},[s,t,e]),m=c.useCallback(v=>{s(ES({entityIdentifier:t,referenceImageId:e,imageDTO:v}))},[s,t,e]),g=c.useMemo(()=>{var v;return If.getData({entityIdentifier:t,referenceImageId:e},(v=a.image)==null?void 0:v.image_name)},[t,(C=a.image)==null?void 0:C.image_name,e]),x=OB(t,e),b=lt();return i.jsxs(T,{flexDir:"column",gap:2,children:[i.jsxs(T,{alignItems:"center",gap:2,children:[i.jsx(W,{fontWeight:"semibold",color:"base.400",children:n("controlLayers.referenceImage")}),i.jsx(Je,{}),i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch",icon:i.jsx(Rt,{}),tooltip:n("controlLayers.deleteReferenceImage"),"aria-label":n("controlLayers.deleteReferenceImage"),onClick:o,colorScheme:"error"})]}),i.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[i.jsxs(T,{gap:2,alignItems:"center",w:"full",children:[i.jsx(YG,{modelKey:((y=a.model)==null?void 0:y.key)??null,onChangeModel:p}),a.type==="ip_adapter"&&i.jsx(rI,{model:a.clipVisionModel,onChange:f}),i.jsx(le,{onClick:x,isDisabled:b,variant:"ghost","aria-label":n("controlLayers.pullBboxIntoReferenceImage"),tooltip:n("controlLayers.pullBboxIntoReferenceImage"),icon:i.jsx(pl,{})})]}),i.jsxs(T,{gap:2,w:"full",children:[a.type==="ip_adapter"&&i.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[i.jsx(lI,{method:a.method,onChange:u}),i.jsx(ub,{weight:a.weight,onChange:d}),i.jsx(db,{beginEndStepPct:a.beginEndStepPct,onChange:l})]}),a.type==="flux_redux"&&i.jsx(T,{flexDir:"column",gap:2,w:"full",children:i.jsx(aI,{imageInfluence:a.imageInfluence??"lowest",onChange:h})}),i.jsx(T,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",flexGrow:1,children:i.jsx(cI,{image:a.image,onChangeImage:m,dndTarget:If,dndTargetData:g})})]})]})]})});QG.displayName="RegionalGuidanceIPAdapterSettingsContent";const TIe=(e,t)=>he(Ye,n=>{const s=IL(n,e,t);return!!s&&s.ipAdapter.image!==null}),JG=c.memo(({referenceImageId:e})=>{const t=We("regional_guidance"),n=c.useMemo(()=>TIe(t,e),[t,e]);return A(n)?i.jsx(QG,{referenceImageId:e}):i.jsx(XG,{referenceImageId:e})});JG.displayName="RegionalGuidanceIPAdapterSettings";const eH=c.memo(()=>{const e=We("regional_guidance"),t=c.useMemo(()=>fn(Ye,s=>{const o=Cs(s,e,"RegionalGuidanceIPAdapters").referenceImages.map(({id:r})=>r);return o.length===0?Fs:o}),[e]),n=A(t);return n.length===0?null:i.jsx(i.Fragment,{children:n.map((s,o)=>i.jsxs(c.Fragment,{children:[o>0&&i.jsx(Ct,{}),i.jsx(JG,{referenceImageId:s})]},s))})});eH.displayName="RegionalGuidanceLayerIPAdapterList";const dI=c.memo(({onDelete:e,...t})=>{const{t:n}=M();return i.jsx(le,{tooltip:n("common.delete"),variant:"link","aria-label":n("common.delete"),icon:i.jsx(Rt,{}),onClick:e,flexGrow:0,size:"sm",p:0,colorScheme:"error",...t})});dI.displayName="RegionalGuidanceDeletePromptButton";const Oc=c.memo(e=>{const{onOpen:t,isOpen:n}=e,{t:s}=M();return i.jsx(Oe,{label:s("prompt.addPromptTrigger"),children:i.jsx(le,{variant:"promptOverlay",isDisabled:n,"aria-label":s("prompt.addPromptTrigger"),icon:i.jsx(Vpe,{}),onClick:t})})});Oc.displayName="AddPromptTriggerButton";const AIe=()=>Me("prompt.noMatchingTriggers"),tH=c.memo(({onSelect:e,onClose:t})=>{const{t:n}=M(),s=A(oc),o=A(_ne),{data:r,isLoading:a}=lm((s==null?void 0:s.key)??cs),[l,{isLoading:d}]=Ry(),[u,{isLoading:h}]=A9(),p=c.useCallback(m=>{if(!m){e("");return}e(m.value)},[e]),f=c.useMemo(()=>{var g;const m=[];if(u){const x=u.filter(b=>b.base===(r==null?void 0:r.base)).map(b=>({label:b.name,value:`<${b.name}>`}));x.length>0&&m.push({label:n("prompt.compatibleEmbeddings"),options:x})}if(l){const x=l.filter(b=>mr(o,C=>C.model.key).includes(b.key)).map(b=>b.trigger_phrases?b.trigger_phrases.map(C=>({label:C,value:C})):[]).flatMap(b=>b);x.length>0&&m.push({label:n("modelManager.loraTriggerPhrases"),options:Ine(x)})}return r&&Z0(r)&&((g=r.trigger_phrases)!=null&&g.length)&&m.push({label:n("modelManager.mainModelTriggerPhrases"),options:r.trigger_phrases.map(x=>({label:x,value:x}))}),m},[u,l,r,n,o]);return i.jsx(Q,{children:i.jsx(Ke,{placeholder:n(d||h||a?"common.loading":"prompt.addPromptTrigger"),defaultMenuIsOpen:!0,autoFocus:!0,value:null,options:f,noOptionsMessage:AIe,onChange:p,onMenuClose:t,"data-testid":"add-prompt-trigger",sx:MIe})})});tH.displayName="PromptTriggerSelect";const MIe={w:"full"},Nc=c.memo(e=>{const{onSelect:t,isOpen:n,onClose:s,width:o,children:r}=e;return i.jsxs(es,{isOpen:n,onClose:s,placement:"bottom",openDelay:0,closeDelay:0,closeOnBlur:!0,returnFocusOnClose:!1,isLazy:!0,children:[i.jsx(rm,{children:r}),i.jsx(ts,{p:0,insetBlockStart:-1,shadow:"dark-lg",borderColor:"invokeBlue.300",borderWidth:"2px",borderStyle:"solid",children:i.jsx(us,{p:0,width:`calc(${o}px - 0.25rem)`,children:i.jsx(tH,{onClose:s,onSelect:t})})})]})});Nc.displayName="PromptPopover";const eh=({prompt:e,textareaRef:t,onChange:n})=>{const{isOpen:s,onClose:o,onOpen:r}=hi(),a=c.useCallback(f=>{n(f.target.value)},[n]),l=c.useCallback(f=>{if(!t.current)return;const m=t.current.selectionStart;if(He(m))return;let g=e.slice(0,m);g+=`${f}`;const x=g.length;g+=e.slice(m),wu.flushSync(()=>{n(g)}),t.current.selectionStart=x,t.current.selectionEnd=x},[t,n,e]),d=c.useCallback(()=>{var f;(f=t.current)==null||f.focus()},[t]),u=c.useCallback(()=>{o(),d()},[d,o]),h=c.useCallback(f=>{l(f),u()},[u,l]),p=c.useCallback(f=>{f.key==="<"&&(r(),f.preventDefault())},[r]);return{onChange:a,isOpen:s,onClose:o,onOpen:r,onSelect:h,onKeyDown:p,onFocus:d}},EIe={outline:"none"},nH=c.memo(()=>{var g;const e=We("regional_guidance"),t=c.useMemo(()=>he(Ye,x=>Cs(x,e,"RegionalGuidanceNegativePrompt").negativePrompt??""),[e]),n=A(t),s=G(),o=c.useRef(null),{t:r}=M(),a=c.useCallback(x=>{s(K2({entityIdentifier:e,prompt:x}))},[s,e]),l=c.useCallback(()=>{s(K2({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:d,isOpen:u,onClose:h,onOpen:p,onSelect:f,onKeyDown:m}=eh({prompt:n,textareaRef:o,onChange:a});return i.jsx(Nc,{isOpen:u,onClose:h,onSelect:f,width:(g=o.current)==null?void 0:g.clientWidth,children:i.jsxs(Ce,{pos:"relative",w:"full",children:[i.jsx(ls,{id:"prompt",name:"prompt",ref:o,value:n,placeholder:r("parameters.negativePromptPlaceholder"),onChange:d,onKeyDown:m,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,fontSize:"sm",zIndex:"0 !important",_focusVisible:EIe}),i.jsxs(T,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[i.jsx(dI,{onDelete:l}),i.jsx(Oc,{isOpen:u,onOpen:p})]})]})})});nH.displayName="RegionalGuidanceNegativePrompt";const PIe={outline:"none"},sH=c.memo(()=>{var g;const e=We("regional_guidance"),t=c.useMemo(()=>he(Ye,x=>Cs(x,e,"RegionalGuidancePositivePrompt").positivePrompt??""),[e]),n=A(t),s=G(),o=c.useRef(null),{t:r}=M(),a=c.useCallback(x=>{s(q2({entityIdentifier:e,prompt:x}))},[s,e]),l=c.useCallback(()=>{s(q2({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:d,isOpen:u,onClose:h,onOpen:p,onSelect:f,onKeyDown:m}=eh({prompt:n,textareaRef:o,onChange:a});return i.jsx(Nc,{isOpen:u,onClose:h,onSelect:f,width:(g=o.current)==null?void 0:g.clientWidth,children:i.jsxs(Ce,{pos:"relative",w:"full",children:[i.jsx(ls,{id:"prompt",name:"prompt",ref:o,value:n,placeholder:r("parameters.positivePromptPlaceholder"),onChange:d,onKeyDown:m,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,minH:28,zIndex:"0 !important",_focusVisible:PIe}),i.jsxs(T,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[i.jsx(dI,{onDelete:l}),i.jsx(Oc,{isOpen:u,onOpen:p})]})]})})});sH.displayName="RegionalGuidancePositivePrompt";const LIe=e=>fn(Ye,t=>{const n=Cs(t,e,"RegionalGuidanceSettings");return{hasPositivePrompt:n.positivePrompt!==null,hasNegativePrompt:n.negativePrompt!==null,hasIPAdapters:n.referenceImages.length>0}}),iH=c.memo(()=>{const e=We("regional_guidance"),t=c.useMemo(()=>LIe(e),[e]),n=A(t);return i.jsxs(Zm,{children:[!n.hasPositivePrompt&&!n.hasNegativePrompt&&!n.hasIPAdapters&&i.jsx(_Ie,{}),n.hasPositivePrompt&&i.jsxs(i.Fragment,{children:[i.jsx(sH,{}),!n.hasNegativePrompt&&n.hasIPAdapters&&i.jsx(Ct,{})]}),n.hasNegativePrompt&&i.jsxs(i.Fragment,{children:[i.jsx(nH,{}),n.hasIPAdapters&&i.jsx(Ct,{})]}),n.hasIPAdapters&&i.jsx(eH,{})]})});iH.displayName="RegionalGuidanceSettings";const oH=c.memo(({id:e})=>{const t=c.useMemo(()=>({id:e,type:"regional_guidance"}),[e]);return i.jsx(Lc.Provider,{value:t,children:i.jsx(qN,{children:i.jsx(ua,{entityIdentifier:t,children:i.jsxs(Yu,{children:[i.jsxs(Xu,{children:[i.jsx(Km,{}),i.jsx(Ju,{}),i.jsx(Je,{}),i.jsx(ZG,{}),i.jsx(Qu,{})]}),i.jsx(iH,{})]})})})})});oH.displayName="RegionalGuidance";const DIe=fn(Ye,e=>e.regionalGuidance.entities.map(ni).toReversed()),RIe=he(Mn,e=>(e==null?void 0:e.type)==="regional_guidance"),rH=c.memo(()=>{const e=A(RIe),t=A(DIe);if(t.length===0)return null;if(t.length>0)return i.jsx(Zu,{type:"regional_guidance",isSelected:e,entityIdentifiers:t,children:t.map(n=>i.jsx(oH,{id:n.id},n.id))})});rH.displayName="RegionalGuidanceEntityList";const aH=c.memo(()=>i.jsx(ns,{children:i.jsxs(T,{flexDir:"column",gap:2,"data-testid":"control-layers-layer-list",w:"full",h:"full",children:[i.jsx(UG,{}),i.jsx($G,{}),i.jsx(rH,{}),i.jsx(RG,{}),i.jsx(KG,{})]})}));aH.displayName="CanvasEntityList";const lH=c.memo(()=>{const{t:e}=M(),t=lt(),n=Ej(),s=Aj(),o=Mj(),r=nO(),a=Tj(),l=Ij(),d=za("reference_image"),u=za("regional_guidance"),h=za("control_layer"),p=za("inpaint_mask");return i.jsxs(on,{children:[i.jsx(rn,{as:le,minW:8,variant:"link",alignSelf:"stretch",tooltip:e("controlLayers.addLayer"),"aria-label":e("controlLayers.addLayer"),icon:i.jsx(Vt,{}),"data-testid":"control-layers-add-layer-menu-button",isDisabled:t}),i.jsxs(Et,{children:[i.jsx(ki,{title:e("controlLayers.global"),children:i.jsx(fe,{icon:i.jsx(Vt,{}),onClick:n,isDisabled:!d,children:e("controlLayers.globalReferenceImage")})}),i.jsxs(ki,{title:e("controlLayers.regional"),children:[i.jsx(fe,{icon:i.jsx(Vt,{}),onClick:s,isDisabled:!p,children:e("controlLayers.inpaintMask")}),i.jsx(fe,{icon:i.jsx(Vt,{}),onClick:o,isDisabled:!u,children:e("controlLayers.regionalGuidance")}),i.jsx(fe,{icon:i.jsx(Vt,{}),onClick:r,isDisabled:!u,children:e("controlLayers.regionalReferenceImage")})]}),i.jsxs(ki,{title:e("controlLayers.layer_other"),children:[i.jsx(fe,{icon:i.jsx(Vt,{}),onClick:l,isDisabled:!h,children:e("controlLayers.controlLayer")}),i.jsx(fe,{icon:i.jsx(Vt,{}),onClick:a,children:e("controlLayers.rasterLayer")})]})]})]})});lH.displayName="EntityListGlobalActionBarAddLayerMenu";const cH=c.memo(()=>{const{t:e}=M(),t=G(),n=lt(),s=A(Mn),o=c.useCallback(()=>{s&&t(PP({entityIdentifier:s}))},[t,s]);return i.jsx(le,{onClick:o,isDisabled:!s||n,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),icon:i.jsx(V7,{})})});cH.displayName="EntityListSelectedEntityActionBarDuplicateButton";const h2={width:6,height:6,borderColor:"base.100"},OIe={".react-colorful__hue-pointer":h2,".react-colorful__saturation-pointer":h2,".react-colorful__alpha-pointer":h2,gap:4,flexDir:"column"},NIe={width:"100%"},p2="3.5rem",FIe=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:o=!1}=e,{t:r}=M(),a=c.useCallback(u=>n({...t,r:u}),[t,n]),l=c.useCallback(u=>n({...t,g:u}),[t,n]),d=c.useCallback(u=>n({...t,b:u}),[t,n]);return i.jsxs(T,{sx:OIe,children:[i.jsx(rke,{color:t,onChange:n,style:NIe}),s&&i.jsxs(T,{gap:4,children:[i.jsxs(Q,{gap:0,children:[i.jsx(J,{children:r("common.red")[0]}),i.jsx(_e,{flexGrow:1,value:t.r,onChange:a,min:0,max:255,step:1,w:p2,defaultValue:90})]}),i.jsxs(Q,{gap:0,children:[i.jsx(J,{children:r("common.green")[0]}),i.jsx(_e,{flexGrow:1,value:t.g,onChange:l,min:0,max:255,step:1,w:p2,defaultValue:90})]}),i.jsxs(Q,{gap:0,children:[i.jsx(J,{children:r("common.blue")[0]}),i.jsx(_e,{flexGrow:1,value:t.b,onChange:d,min:0,max:255,step:1,w:p2,defaultValue:255})]})]}),o&&i.jsx(T,{gap:2,justifyContent:"space-between",children:QSe.map((u,h)=>i.jsx($Ie,{color:u,onChange:n},h))})]})},BIe=c.memo(FIe),$Ie=({color:e,onChange:t})=>{const n=c.useCallback(()=>{t(e)},[e,t]);return i.jsx(Ce,{role:"button",onClick:n,h:8,w:8,bg:lc(e),borderRadius:"base"})},dH=c.memo(({style:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(a=>{Tne(a==null?void 0:a.value)&&t(a.value)},[t]),o=c.useMemo(()=>[{value:"solid",label:n("controlLayers.fill.solid")},{value:"diagonal",label:n("controlLayers.fill.diagonal")},{value:"crosshatch",label:n("controlLayers.fill.crosshatch")},{value:"grid",label:n("controlLayers.fill.grid")},{value:"horizontal",label:n("controlLayers.fill.horizontal")},{value:"vertical",label:n("controlLayers.fill.vertical")}],[n]),r=c.useMemo(()=>o.find(a=>a.value===e),[o,e]);return i.jsxs(Q,{children:[i.jsx(J,{m:0,children:n("controlLayers.fill.fillStyle")}),i.jsx(Ke,{value:r,options:o,onChange:s,isSearchable:!1})]})});dH.displayName="MaskFillStyle";const uH=c.memo(()=>{const{t:e}=M(),t=G(),n=A(Mn),s=A(Ane),o=c.useCallback(a=>{n&&lC(n)&&t(Mne({entityIdentifier:n,color:a}))},[t,n]),r=c.useCallback(a=>{n&&lC(n)&&t(Ene({entityIdentifier:n,style:a}))},[t,n]);return!n||!s?null:i.jsxs(es,{isLazy:!0,children:[i.jsx(ds,{children:i.jsx(T,{role:"button","aria-label":e("controlLayers.maskFill"),tabIndex:-1,w:8,h:8,children:i.jsx(Oe,{label:e("controlLayers.maskFill"),children:i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(Ce,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:lc(s.color)})})})})}),i.jsx(ts,{children:i.jsx(us,{minH:64,children:i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsx(BIe,{color:s.color,onChange:o,withNumberInput:!0,withSwatches:!0}),i.jsx(dH,{style:s.style,onChange:r})]})})})]})});uH.displayName="EntityListSelectedEntityActionBarFill";const hH=c.memo(()=>{const{t:e}=M(),t=A(Mn),n=Qy(t);return!t||!Y2(t)?null:i.jsx(le,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:i.jsx(uj,{})})});hH.displayName="EntityListSelectedEntityActionBarFilterButton";function VIe(e){return isNaN(Number(e))?"":`${Uf(Number(e),2).toLocaleString()}%`}function zIe(e){return e/100}function hd(e){return e*100}function GIe(e){return String(e)}const Vw=[hd(0),hd(.25),hd(.5),hd(.75),hd(1)],HIe=hd(1),WIe=Vw.slice(1,Vw.length-1),UIe=he(Ye,e=>{const t=e.selectedEntityIdentifier;if(!t)return 1;const n=rl(e,t);return!n||!Pne(n)?1:n.opacity}),pH=c.memo(()=>{const{t:e}=M(),t=G(),n=A(Mn),s=A(UIe),[o,r]=c.useState(s*100),a=c.useCallback(h=>{if(!n)return;let p=h;qS.get()||(p=lL(h,WIe,2));const f=zIe(p);t(G4({entityIdentifier:n,opacity:f}))},[t,n]),l=c.useCallback(()=>{if(n){if(isNaN(Number(o))){r(100);return}t(G4({entityIdentifier:n,opacity:pr(o/100,0,1)}))}},[t,o,n]),d=c.useCallback((h,p)=>{r(p)},[]),u=c.useCallback(h=>{h.key==="Enter"&&l()},[l]);return c.useEffect(()=>{r((s??1)*100)},[s]),i.jsxs(es,{children:[i.jsxs(Q,{w:"min-content",gap:2,isDisabled:n===null||n.type==="reference_image",children:[i.jsx(J,{m:0,children:e("controlLayers.opacity")}),i.jsx(rm,{children:i.jsxs(Kx,{display:"flex",alignItems:"center",min:0,max:100,step:1,value:o,onChange:d,onBlur:l,w:"76px",format:VIe,defaultValue:1,onKeyDown:u,clampValueOnBlur:!1,variant:"outline",children:[i.jsx(Zx,{paddingInlineEnd:7,_focusVisible:{zIndex:0},title:""}),i.jsx(ds,{children:i.jsx(le,{"aria-label":"open-slider",icon:i.jsx(Bi,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full",isDisabled:n===null||n.type==="reference_image"})})]})})]}),i.jsxs(ts,{w:200,pt:0,pb:2,px:4,children:[i.jsx(po,{}),i.jsx(us,{children:i.jsx(Ze,{min:0,max:100,value:o,onChange:a,defaultValue:HIe,marks:Vw,formatValue:GIe,alwaysShowMarks:!0,isDisabled:n===null||n.type==="reference_image"})})]})]})});pH.displayName="EntityListSelectedEntityActionBarOpacity";const fH=c.memo(()=>{const{t:e}=M(),t=A(Mn),n=BB(t);return!t||!X2(t)?null:i.jsx(le,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.selectObject.selectObject"),tooltip:e("controlLayers.selectObject.selectObject"),icon:i.jsx(W7,{})})});fH.displayName="EntityListSelectedEntityActionBarSelectObjectButton";const mH=c.memo(()=>{const{t:e}=M(),t=A(Mn),n=T_(t);return!t||!C0(t)?null:i.jsx(le,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.transform.transform"),tooltip:e("controlLayers.transform.transform"),icon:i.jsx(Sm,{})})});mH.displayName="EntityListSelectedEntityActionBarTransformButton";const gH=c.memo(()=>{const{t:e}=M(),t=lt(),n=A(Mn),s=Tr(n),o=FB(),r=c.useCallback(()=>{o(s)},[o,s]);return!n||!Lne(n)?null:i.jsx(le,{onClick:r,isDisabled:!n||t,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.saveLayerToAssets"),tooltip:e("controlLayers.saveLayerToAssets"),icon:i.jsx(ar,{})})});gH.displayName="EntityListSelectedEntityActionBarSaveToAssetsButton";const xH=c.memo(()=>i.jsxs(T,{w:"full",gap:2,alignItems:"center",ps:1,children:[i.jsx(pH,{}),i.jsx(Je,{}),i.jsx(uH,{}),i.jsxs(T,{h:"full",children:[i.jsx(fH,{}),i.jsx(hH,{}),i.jsx(mH,{}),i.jsx(gH,{}),i.jsx(cH,{}),i.jsx(lH,{})]})]}));xH.displayName="EntityListSelectedEntityActionBar";const qIe=({amplitude:e,stroke:t,strokeWidth:n,width:s,height:o,segments:r=5})=>{const a=()=>{if(e===0)return`M0,${o/2} L${s},${o/2}`;const l=Math.min(o/2,e),d=s/r;let u=`M0,${o/2}`;for(let h=1;h<=r;h++){const p=h*d,f=o/2+(h%2===0?l:-l);u+=` Q${p-d/2},${f} ${p},${o/2}`}return u};return i.jsx("svg",{width:s,height:o,viewBox:`0 0 ${s} ${o}`,xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:a(),fill:"none",stroke:t,strokeWidth:n})})},uI=()=>{const e=A(Dne),{data:t}=lm(e??cs);return t},KIe=he(US,e=>e.length>0),yH=c.memo(()=>{const e=A(Rne),t=G(),n=A(KIe),s=uI(),o=c.useCallback(u=>{t(One(u))},[t]),r=A(Nne),{t:a}=M(),[l]=ek("colors",["invokeBlue.300"]),d=c.useMemo(()=>!n||(s==null?void 0:s.type)==="main"&&(s==null?void 0:s.base)==="flux"&&s.variant==="inpaint",[n,s]);return i.jsxs(Q,{isDisabled:d,p:1,justifyContent:"space-between",h:8,children:[i.jsxs(T,{gap:3,alignItems:"center",children:[i.jsx($e,{feature:"paramDenoisingStrength",children:i.jsx(J,{mr:0,children:`${a("parameters.denoisingStrength")}`})}),n&&i.jsx(qIe,{amplitude:e*10,stroke:l,strokeWidth:1,width:40,height:14})]}),d?i.jsx(T,{alignItems:"center",children:i.jsx(Hn,{opacity:"0.6",children:a("parameters.disabledNoRasterContent")})}):i.jsxs(i.Fragment,{children:[i.jsx(Ze,{step:r.coarseStep,fineStep:r.fineStep,min:r.sliderMin,max:r.sliderMax,defaultValue:r.initial,onChange:o,value:e}),i.jsx(_e,{step:r.coarseStep,fineStep:r.fineStep,min:r.numberInputMin,max:r.numberInputMax,defaultValue:r.initial,onChange:o,value:e,variant:"outline"})]})]})});yH.displayName="ParamDenoisingStrength";const ZIe={width:"full",height:"full"},bH=c.memo(()=>{const e=A(Fne);return i.jsx($u,{region:"layers",sx:ZIe,children:i.jsxs(T,{flexDir:"column",gap:2,w:"full",h:"full",children:[i.jsx(xH,{}),i.jsx(Ct,{py:0}),i.jsx(yH,{}),i.jsx(Ct,{py:0}),!e&&i.jsx(cG,{}),e&&i.jsx(aH,{})]})})});bH.displayName="CanvasLayersPanelContent";const vH=c.memo(()=>{const e=re(Bne),t=re(VS);return e&&t?i.jsx(Wf,{fontSize:"md",fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",href:t,children:e}):null});vH.displayName="GalleryHeader";const Gd=Symbol("NO_SIZE"),zw=e=>{const t=c.useRef(null),[n,s]=c.useState(1),[o,r]=c.useState(1),a=c.useCallback(()=>{if(!(t!=null&&t.current))return;const C=f2(e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection),y=f2(e.defaultSizePx??e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection);if(C===Gd||y===Gd)return;s(C),y>C?r(y):r(C);const v=t.current.getSize();!t.current.isCollapsed()&&v<C&&C>0&&t.current.resize(C)},[e.defaultSizePx,e.imperativePanelGroupRef,e.minSizePx,e.panelGroupDirection]);c.useLayoutEffect(()=>{if(!e.imperativePanelGroupRef.current)return;const C=e.imperativePanelGroupRef.current.getId(),y=rb(C),v=uc(C);if(!y)return;const w=new ResizeObserver(a);return w.observe(y),v.forEach(k=>w.observe(k)),a(),()=>{w.disconnect()}},[e.imperativePanelGroupRef,a]);const[l,d]=c.useState(()=>{var C;return!!((C=t.current)!=null&&C.isCollapsed())}),u=c.useCallback(()=>{var C;d(!0),(C=e.onCollapse)==null||C.call(e,!0)},[e]),h=c.useCallback(()=>{var C;d(!1),(C=e.onCollapse)==null||C.call(e,!1)},[e]),p=c.useCallback(()=>{var C,y,v;(C=t.current)!=null&&C.isCollapsed()?(y=t.current)==null||y.expand():(v=t.current)==null||v.collapse()},[]),f=c.useCallback(()=>{var C;(C=t.current)==null||C.expand()},[]),m=c.useCallback(()=>{var C;(C=t.current)==null||C.collapse()},[]),g=c.useCallback(C=>{var v;const y=f2(C,e.imperativePanelGroupRef,e.panelGroupDirection);y!==Gd&&((v=t.current)==null||v.resize(y))},[e]),x=c.useCallback(()=>{var C;(C=t.current)==null||C.resize(n)},[n]),b=c.useCallback(()=>{var C,y;if(Math.abs((((C=t.current)==null?void 0:C.getSize())??0)-o)<.01){m();return}(y=t.current)==null||y.resize(o)},[o,m]);return{isCollapsed:l,reset:x,toggle:p,expand:f,collapse:m,resize:g,panelProps:{id:e.id,defaultSize:o,onCollapse:u,onExpand:h,ref:t,minSize:n},resizeHandleProps:{onDoubleClick:b}}},f2=(e,t,n)=>{if(!t.current)return Gd;const s=t.current.getId(),o=rb(s);if(!o)return Gd;let r=n==="horizontal"?o.offsetWidth:o.offsetHeight;return r?(uc(s).forEach(a=>{r-=n==="horizontal"?a.offsetWidth:a.offsetHeight}),Math.max(Math.min(e/r*100,100),1)):Gd},hI=he(Ri,e=>e.allowPrivateBoards),YIe=({isPrivateBoard:e})=>{const{t}=M(),n=G(),s=A(hI),[o,{isLoading:r}]=$ne(),a=c.useMemo(()=>t(s?e?"boards.addPrivateBoard":"boards.addSharedBoard":"boards.addBoard"),[s,e,t]),l=c.useCallback(async()=>{try{const d=await o({board_name:t("boards.myBoard"),is_private:e}).unwrap();n(rf({boardId:d.board_id})),n(e1(""))}catch{}},[t,o,e,n]);return i.jsx(le,{icon:i.jsx(Vt,{}),isLoading:r,tooltip:a,"aria-label":a,onClick:l,size:"md","data-testid":"add-board-button",variant:"link",w:8,h:8})},XIe=c.memo(YIe),pI=c.memo(()=>{const{t:e}=M();return i.jsx(Hn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:e("common.auto")})});pI.displayName="AutoAddBadge";const QIe=({board:e,children:t})=>{const{t:n}=M(),s=G(),o=A(ku),r=c.useMemo(()=>he(qs,C=>e.board_id===C),[e.board_id]),[a]=TL(),l=A(r),d=Pm(e.board_id),u=Bt("bulkDownload"),[h]=BS(),p=c.useCallback(()=>{s(cm(e.board_id))},[e.board_id,s]),f=c.useCallback(()=>{h({image_names:[],board_id:e.board_id})},[e.board_id,h]),m=c.useCallback(async()=>{try{await a({board_id:e.board_id,changes:{archived:!0}}).unwrap()}catch{ge({status:"error",title:"Unable to archive board"})}},[e.board_id,a]),g=c.useCallback(()=>{a({board_id:e.board_id,changes:{archived:!1}})},[e.board_id,a]),x=c.useCallback(()=>{Rl.set(e)},[e]),b=c.useCallback(()=>i.jsx(Et,{visibility:"visible",children:i.jsxs(ki,{title:d,children:[!o&&i.jsx(fe,{icon:i.jsx(Vt,{}),isDisabled:l,onClick:p,children:n(l?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),u&&i.jsx(fe,{icon:i.jsx(_7,{}),onClickCapture:f,children:n("boards.downloadBoard")}),e.archived&&i.jsx(fe,{icon:i.jsx(x7,{}),onClick:g,children:n("boards.unarchiveBoard")}),!e.archived&&i.jsx(fe,{icon:i.jsx(mfe,{}),onClick:m,children:n("boards.archiveBoard")}),i.jsx(fe,{color:"error.300",icon:i.jsx(Pi,{}),onClick:x,isDestructive:!0,children:n("boards.deleteBoard")})]})}),[d,o,l,p,n,u,f,e.archived,g,m,x]);return i.jsx(Yx,{renderMenu:b,children:t})},JIe=c.memo(QIe),CH=c.memo(({board:e,isSelected:t})=>{const{t:n}=M(),s=Hx(!1),o=c.useRef(null),[r,a]=TL(),l=c.useCallback(async u=>{(await Zn(()=>r({board_id:e.board_id,changes:{board_name:u}}).unwrap())).isErr()&&ge({status:"error",title:n("boards.updateBoardError")})},[e.board_id,n,r]),d=fa({value:e.board_name,defaultValue:e.board_name,onChange:l,inputRef:o,onStartEditing:s.setTrue});return d.isEditing?i.jsx(St,{ref:o,...d.inputProps,variant:"outline",isDisabled:a.isLoading,_focusVisible:{borderWidth:1,borderColor:"invokeBlueAlpha.400",borderRadius:"base"}}):i.jsxs(T,{alignItems:"center",gap:3,onMouseOver:s.setTrue,onMouseOut:s.setFalse,children:[i.jsx(W,{size:"sm",fontWeight:"semibold",userSelect:"none",color:t?"base.100":"base.300",onDoubleClick:d.startEditing,cursor:"text",children:d.value}),s.isTrue&&i.jsx(le,{"aria-label":"edit name",icon:i.jsx(Iy,{}),size:"sm",variant:"ghost",onClick:d.startEditing})]})});CH.displayName="CanvasEntityTitleEdit";const wH=({board:e})=>{const{t}=M(),{imagesTotal:n}=AL((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:r})=>({imagesTotal:(r==null?void 0:r.total)??0})}),{assetsTotal:s}=Vne((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:r})=>({assetsTotal:(r==null?void 0:r.total)??0})}),{currentData:o}=ul((e==null?void 0:e.cover_image_name)??cs);return i.jsxs(T,{flexDir:"column",alignItems:"center",gap:1,children:[o&&i.jsx(Zt,{src:o.thumbnail_url,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),i.jsxs(T,{flexDir:"column",alignItems:"center",children:[i.jsxs(W,{noOfLines:1,children:[t("boards.imagesWithCount",{count:n}),", ",t("boards.assetsWithCount",{count:s})]}),(e==null?void 0:e.archived)&&i.jsxs(W,{children:["(",t("boards.archived"),")"]})]})]})},e4e={bg:"base.850"},t4e=({board:e,isSelected:t})=>{const n=G(),{t:s}=M(),o=A(qs),r=A(ku),a=A(tk),l=c.useCallback(()=>{a!==e.board_id&&n(rf({boardId:e.board_id})),r&&o!==e.board_id&&n(cm(e.board_id))},[a,e.board_id,r,o,n]),d=c.useMemo(()=>P1.getData({boardId:e.board_id}),[e.board_id]);return i.jsxs(Ce,{position:"relative",w:"full",h:12,children:[i.jsx(JIe,{board:e,children:u=>i.jsx(Oe,{label:i.jsx(wH,{board:e}),openDelay:1e3,placement:"left",closeOnScroll:!0,p:2,children:i.jsxs(T,{ref:u,onClick:l,alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:t?"base.850":void 0,_hover:e4e,w:"full",h:"full",children:[i.jsx(s4e,{board:e}),i.jsx(T,{w:"full",children:i.jsx(CH,{board:e,isSelected:t})}),o===e.board_id&&i.jsx(pI,{}),e.archived&&i.jsx(at,{as:x7,fill:"base.300"}),i.jsx(W,{variant:"subtext",children:e.image_count})]})})}),i.jsx(Ls,{dndTarget:P1,dndTargetData:d,label:s("gallery.move")})]})},n4e=c.memo(t4e),s4e=({board:e})=>{const{currentData:t}=ul(e.cover_image_name??cs);return t?i.jsx(Zt,{src:t.thumbnail_url,draggable:!1,objectFit:"cover",w:10,h:10,borderRadius:"base",borderBottomRadius:"lg"}):i.jsx(T,{w:10,h:10,justifyContent:"center",alignItems:"center",children:i.jsx(at,{boxSize:10,as:Ife,opacity:.7,color:"base.500"})})},i4e=he(qs,e=>e==="none"),o4e=({children:e})=>{const{t}=M(),n=G(),s=A(ku),o=A(i4e),r=Bt("bulkDownload"),[a]=BS(),l=c.useCallback(()=>{n(cm("none"))},[n]),d=c.useCallback(()=>{a({image_names:[],board_id:"none"})},[a]),u=c.useCallback(()=>{Rl.set("none")},[]),h=c.useCallback(()=>i.jsx(Et,{visibility:"visible",children:i.jsxs(ki,{title:t("boards.uncategorized"),children:[!s&&i.jsx(fe,{icon:i.jsx(Vt,{}),isDisabled:o,onClick:l,children:t(o?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),r&&i.jsx(fe,{icon:i.jsx(_7,{}),onClickCapture:d,children:t("boards.downloadBoard")}),i.jsx(fe,{color:"error.300",icon:i.jsx(Pi,{}),onClick:u,isDestructive:!0,children:t("boards.deleteAllUncategorizedImages")})]})}),[s,d,l,r,o,t,u]);return i.jsx(Yx,{renderMenu:h,children:e})},r4e=c.memo(o4e),a4e={bg:"base.850"},SH=c.memo(({isSelected:e})=>{const t=G(),{imagesTotal:n}=AL("none",{selectFromResult:({data:h})=>({imagesTotal:(h==null?void 0:h.total)??0})}),s=A(qs),o=A(ku),r=A(Jx),a=Pm("none"),l=c.useCallback(()=>{t(rf({boardId:"none"})),o&&t(cm("none"))},[t,o]),d=c.useMemo(()=>L1.getData(),[]),{t:u}=M();return r.length?null:i.jsxs(Ce,{position:"relative",w:"full",h:12,children:[i.jsx(r4e,{children:h=>i.jsx(Oe,{label:i.jsx(wH,{board:null}),openDelay:1e3,placement:"left",closeOnScroll:!0,children:i.jsxs(T,{ref:h,onClick:l,w:"full",h:"full",alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:e?"base.850":void 0,_hover:a4e,children:[i.jsx(T,{w:"10",justifyContent:"space-around",children:i.jsx(at,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",children:i.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})})}),i.jsx(W,{fontSize:"sm",color:e?"base.100":"base.300",fontWeight:"semibold",noOfLines:1,flexGrow:1,children:a}),s==="none"&&i.jsx(pI,{}),i.jsx(W,{variant:"subtext",children:n})]})})}),i.jsx(Ls,{dndTarget:L1,dndTargetData:d,label:u("gallery.move")})]})});SH.displayName="HoverableBoard";const wE=c.memo(SH),SE=({isPrivate:e})=>{const{t}=M(),n=A(tk),s=A(Jx),o=A(zne),{data:r}=vc(o),a=A(hI),{isOpen:l,onToggle:d}=hi({defaultIsOpen:!0}),u=c.useMemo(()=>r?r.filter(f=>s.length?f.is_private===e&&f.board_name.toLowerCase().includes(s.toLowerCase()):f.is_private===e):Fs,[s,r,e]),h=c.useMemo(()=>{const f=[];return a&&e&&!s.length&&f.push(i.jsx(wE,{isSelected:n==="none"},"none")),!a&&!s.length&&f.push(i.jsx(wE,{isSelected:n==="none"},"none")),u.forEach(m=>{f.push(i.jsx(n4e,{board:m,isSelected:n===m.board_id},m.board_id))}),f},[a,e,s.length,u,n]),p=c.useMemo(()=>t(a?e?"boards.private":"boards.shared":"boards.boards"),[e,a,t]);return i.jsxs(T,{direction:"column",children:[i.jsxs(T,{position:"sticky",w:"full",justifyContent:"space-between",alignItems:"center",ps:2,py:1,zIndex:1,top:0,bg:"base.900",children:[a?i.jsx(de,{variant:"unstyled",onClick:d,children:i.jsxs(T,{gap:"2",alignItems:"center",children:[i.jsx(at,{boxSize:4,as:Bi,transform:l?void 0:"rotate(-90deg)",fill:"base.500"}),i.jsx(W,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:p})]})}):i.jsx(W,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:p}),i.jsx(XIe,{isPrivateBoard:e})]}),i.jsx(ll,{in:l,style:sI,children:i.jsx(T,{direction:"column",gap:1,children:h.length?h:i.jsx(W,{variant:"subtext",textAlign:"center",children:t("boards.noBoards",{boardType:s.length?"Matching":""})})})})]})},l4e={height:"100%",width:"100%"},c4e=()=>{const e=A(hI),[t,n]=c.useState(null);return c.useEffect(()=>{const s=t==null?void 0:t.osInstance();if(!s)return;const o=s.elements().viewport,r=o.style.overflowY;o.style.setProperty("overflow-y","scroll","important");const a=Xn(zk({element:o}),jR({element:o}));return o.style.setProperty("overflow-y",r),a},[t]),i.jsx(Ce,{position:"relative",w:"full",h:"full",children:i.jsx(Ce,{position:"absolute",top:0,right:0,bottom:0,left:0,children:i.jsxs(vs,{ref:n,style:l4e,options:rc.options,children:[e&&i.jsx(SE,{isPrivate:!0}),i.jsx(SE,{isPrivate:!1})]})})})},d4e=c.memo(c4e),u4e=()=>{const e=G(),t=A(Jx),{t:n}=M(),s=c.useCallback(l=>{e(e1(l))},[e]),o=c.useCallback(()=>{e(e1(""))},[e]),r=c.useCallback(l=>{l.key==="Escape"&&o()},[o]),a=c.useCallback(l=>{s(l.target.value)},[s]);return i.jsxs(Cr,{children:[i.jsx(St,{placeholder:n("boards.searchBoard"),value:t,onKeyDown:r,onChange:a,"data-testid":"board-search-input"}),t&&t.length&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{onClick:o,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:i.jsx(Rt,{})})})]})},h4e=c.memo(u4e),p4e=()=>{const e=G(),{t}=M(),n=A(qs),s=A(ku),{options:o,hasBoards:r}=vc({},{selectFromResult:({data:u})=>{const h=[{label:t("common.none"),value:"none"}].concat((u??[]).map(({board_id:p,board_name:f})=>({label:f,value:p})));return{options:h,hasBoards:h.length>1}}}),a=c.useCallback(u=>{u&&e(cm(u.value))},[e]),l=c.useMemo(()=>o.find(u=>u.value===n),[o,n]),d=c.useCallback(()=>t("boards.noMatching"),[t]);return i.jsxs(Q,{isDisabled:!r||s,children:[i.jsx(J,{children:t("boards.autoAddBoard")}),i.jsx(Ke,{value:l,options:o,onChange:a,placeholder:t("boards.selectBoard"),noOptionsMessage:d})]})},f4e=c.memo(p4e),m4e=()=>{const e=G(),{t}=M(),n=A(ku),s=c.useCallback(o=>e(Gne(o.target.checked)),[e]);return i.jsxs(Q,{children:[i.jsx(J,{flexGrow:1,children:t("gallery.autoAssignBoardOnClick")}),i.jsx(_n,{isChecked:n,onChange:s})]})},g4e=c.memo(m4e),x4e=he(Ai,e=>e.shouldShowArchivedBoards),y4e=()=>{const e=G(),{t}=M(),n=A(x4e),s=c.useCallback(o=>{e(Hne(o.target.checked))},[e]);return i.jsxs(Q,{children:[i.jsx(J,{flexGrow:1,children:t("gallery.showArchivedBoards")}),i.jsx(_n,{isChecked:n,onChange:s})]})},b4e=c.memo(y4e),v4e=Ve.enum(["created_at","board_name"]),C4e=e=>v4e.safeParse(e).success,w4e=Ve.enum(["ASC","DESC"]),S4e=e=>w4e.safeParse(e).success,k4e=()=>{const{t:e}=M(),t=A(Wne),n=A(Une),s=c.useMemo(()=>[{value:"created_at",label:e("workflows.created")},{value:"board_name",label:e("workflows.name")}],[e]),o=c.useMemo(()=>[{value:"ASC",label:e("workflows.ascending")},{value:"DESC",label:e("workflows.descending")}],[e]),r=G(),a=c.useCallback(h=>{!C4e(h==null?void 0:h.value)||h.value===t||r(qne(h.value))},[t,r]),l=c.useMemo(()=>s.find(h=>h.value===t)||s[0],[t,s]),d=c.useCallback(h=>{!S4e(h==null?void 0:h.value)||h.value===n||r(Kne(h.value))},[n,r]),u=c.useMemo(()=>o.find(h=>h.value===n),[n,o]);return i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsxs(Q,{orientation:"horizontal",gap:1,children:[i.jsx(J,{children:e("common.orderBy")}),i.jsx(Ke,{isSearchable:!1,value:l,options:s,onChange:a})]}),i.jsxs(Q,{orientation:"horizontal",gap:1,children:[i.jsx(J,{children:e("common.direction")}),i.jsx(Ke,{isSearchable:!1,value:u,options:o,onChange:d})]})]})},j4e=()=>{const{t:e}=M();return i.jsxs(es,{isLazy:!0,children:[i.jsx(ds,{children:i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.boardsSettings"),icon:i.jsx(Im,{}),tooltip:e("gallery.boardsSettings")})}),i.jsx(ts,{children:i.jsx(us,{children:i.jsxs(T,{direction:"column",gap:2,children:[i.jsx(g4e,{}),i.jsx(b4e,{}),i.jsx(f4e,{}),i.jsx(Ce,{py:2,children:i.jsx(Ct,{})}),i.jsx(k4e,{})]})})})]})},_4e=c.memo(j4e),I4e=()=>{Pt("gallery-search-state");const e=G(),t=A(Zne),[n,s]=c.useState(t),o=c.useMemo(()=>Di(l=>{e(H4(l))},1e3),[e]),r=c.useCallback(l=>{s(l),o(l)},[o]),a=c.useCallback(()=>{o.cancel(),s(""),e(H4(""))},[o,e]);return[n,r,a]},T4e=he(Ai,e=>e.alwaysShowImageSizeBadge),A4e=()=>{const e=G(),{t}=M(),n=A(T4e),s=c.useCallback(o=>e(Yne(o.target.checked)),[e]);return i.jsxs(Q,{children:[i.jsx(J,{flexGrow:1,children:t("gallery.alwaysShowImageSizeBadge")}),i.jsx(_n,{isChecked:n,onChange:s})]})},M4e=c.memo(A4e),E4e=he(Ai,e=>e.shouldAutoSwitch),P4e=()=>{const e=G(),{t}=M(),n=A(E4e),s=c.useCallback(o=>{e(Xne(o.target.checked))},[e]);return i.jsxs(Q,{children:[i.jsx(J,{flexGrow:1,children:t("gallery.autoSwitchNewImages")}),i.jsx(_n,{isChecked:n,onChange:s})]})},L4e=c.memo(P4e),D4e=()=>{const e=G(),{t}=M(),n=A(ML),s=c.useCallback(o=>{e(Qne(o))},[e]);return i.jsxs(Q,{children:[i.jsx(J,{children:t("gallery.galleryImageSize")}),i.jsx(Ze,{value:n,onChange:s,min:45,max:256,defaultValue:90})]})},R4e=c.memo(D4e),O4e=he(Ai,e=>e.starredFirst),N4e=()=>{const e=G(),{t}=M(),n=A(O4e),s=c.useCallback(o=>{e(Jne(o.target.checked))},[e]);return i.jsxs(Q,{w:"full",children:[i.jsx(J,{flexGrow:1,m:0,children:t("gallery.showStarredImagesFirst")}),i.jsx(et,{size:"sm",isChecked:n,onChange:s})]})},F4e=c.memo(N4e),B4e=he(Ai,e=>e.orderDir),$4e=()=>{const e=G(),{t}=M(),n=A(B4e),s=c.useMemo(()=>[{value:"DESC",label:t("gallery.newestFirst")},{value:"ASC",label:t("gallery.oldestFirst")}],[t]),o=c.useCallback(a=>{ve((a==null?void 0:a.value)==="ASC"||(a==null?void 0:a.value)==="DESC"),e(ese(a.value))},[e]),r=c.useMemo(()=>s.find(a=>a.value===n),[n,s]);return i.jsxs(Q,{children:[i.jsx(J,{flexGrow:1,m:0,children:t("gallery.sortDirection")}),i.jsx(Ke,{isSearchable:!1,value:r,options:s,onChange:o})]})},V4e=c.memo($4e),z4e=()=>{const{t:e}=M();return i.jsxs(es,{isLazy:!0,children:[i.jsx(ds,{children:i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.imagesSettings"),icon:i.jsx(Im,{}),tooltip:e("gallery.imagesSettings")})}),i.jsx(ts,{children:i.jsx(us,{children:i.jsxs(T,{direction:"column",gap:2,children:[i.jsx(R4e,{}),i.jsx(L4e,{}),i.jsx(M4e,{}),i.jsx(Ct,{pt:2}),i.jsx(F4e,{}),i.jsx(V4e,{})]})})})]})},G4e=c.memo(z4e),H4e=()=>{const e=Rc({allowMultiple:!0});return i.jsxs(i.Fragment,{children:[i.jsx(le,{size:"sm",alignSelf:"stretch",variant:"link","aria-label":Me("accessibility.uploadImages"),tooltip:Me("accessibility.uploadImages"),icon:i.jsx(km,{}),...e.getUploadButtonProps()}),i.jsx("input",{...e.getUploadInputProps()})]})},kH=c.memo(()=>{const e=G(),t=A(tse),{imageDTOs:n}=K_(),s=Os("gallery"),o=c.useCallback(()=>{e(Bx([...t,...n]))},[e,t,n]);return De({id:"selectAllOnPage",category:"gallery",callback:o,options:{preventDefault:!0,enabled:s},dependencies:[o,s]}),t.length<=1?null:i.jsx(jH,{})});kH.displayName="GallerySelectionCountTag";const jH=c.memo(()=>{const{t:e}=M(),t=G(),n=Os("gallery"),s=A(nse),o=A($S),r=c.useCallback(()=>{s&&t(Bx([s]))},[t,s]);return De({id:"clearSelection",category:"gallery",callback:r,options:{enabled:o>0&&n},dependencies:[r,o,n]}),i.jsxs(ey,{position:"absolute",bg:"invokeBlue.800",color:"base.50",py:2,px:4,userSelect:"none",shadow:"dark-lg",fontWeight:"semibold",border:1,borderStyle:"solid",borderColor:"whiteAlpha.300",children:[i.jsxs(nk,{children:[o," ",e("common.selected")]}),i.jsx(ty,{onClick:r})]})});jH.displayName="GallerySelectionCountTagContent";const W4e=()=>{Pt("useGalleryHotkeys");const{goNext:e,goPrev:t,isNextEnabled:n,isPrevEnabled:s}=nb(),o=G(),r=A(S=>S.gallery.selection),a=A(Su),l=Cc(a),d=A(df),u=A(On),h=Os("workflows"),p=Os("gallery"),f=Os("viewer"),m=c.useMemo(()=>u!=="canvas"?!0:d==="gallery",[u,d]),{handleLeftImage:g,handleRightImage:x,handleUpImage:b,handleDownImage:C,isOnFirstRow:y,isOnLastRow:v,isOnFirstImageOfView:w,isOnLastImageOfView:k}=Sz();De({id:"galleryNavLeft",category:"gallery",callback:S=>{if(!(S.target instanceof HTMLElement&&S.target.getAttribute("role")==="tab")){if(w&&s&&!l.isFetching){t("arrow");return}g(!1)}},options:{preventDefault:!0,enabled:p||f},dependencies:[g,w,t,s,l.isFetching,p,f]}),De({id:"galleryNavRight",category:"gallery",callback:S=>{if(!(S.target instanceof HTMLElement&&S.target.getAttribute("role")==="tab")){if(k&&n&&!l.isFetching){e("arrow");return}k||x(!1)}},options:{preventDefault:!0,enabled:p||f},dependencies:[k,e,n,l.isFetching,x,p,f]}),De({id:"galleryNavUp",category:"gallery",callback:()=>{if(y&&s&&!l.isFetching){t("arrow");return}b(!1)},options:{preventDefault:!0,enabled:p},dependencies:[b,y,t,s,l.isFetching,p]}),De({id:"galleryNavDown",category:"gallery",callback:()=>{if(v&&n&&!l.isFetching){e("arrow");return}C(!1)},options:{preventDefault:!0,enabled:p},dependencies:[v,e,n,l.isFetching,C,p]}),De({id:"galleryNavLeftAlt",category:"gallery",callback:()=>{if(w&&s&&!l.isFetching){t("alt+arrow");return}g(!0)},options:{preventDefault:!0,enabled:p||f},dependencies:[g,w,t,s,l.isFetching,p,f]}),De({id:"galleryNavRightAlt",category:"gallery",callback:()=>{if(k&&n&&!l.isFetching){e("alt+arrow");return}k||x(!0)},options:{preventDefault:!0,enabled:p||f},dependencies:[k,e,n,l.isFetching,x,p,f]}),De({id:"galleryNavUpAlt",category:"gallery",callback:()=>{if(y&&s&&!l.isFetching){t("alt+arrow");return}b(!0)},options:{preventDefault:!0,enabled:p},dependencies:[b,y,t,s,l.isFetching,p]}),De({id:"galleryNavDownAlt",category:"gallery",callback:()=>{if(v&&n&&!l.isFetching){e("alt+arrow");return}C(!0)},options:{preventDefault:!0,enabled:p},dependencies:[v,e,n,l.isFetching,C,p]}),De({id:"deleteSelection",category:"gallery",callback:()=>{r.length&&o(Zf(r))},options:{enabled:(p||f)&&m&&!h},dependencies:[h,m,r,h]})},U4e=()=>{W4e();const{t:e}=M(),t=A(Su),{hasImages:n,isLoading:s,isError:o}=Cc(t,{selectFromResult:({data:r,isLoading:a,isSuccess:l,isError:d})=>({hasImages:r&&r.items.length>0,isLoading:a,isSuccess:l,isError:d})});return o?i.jsx(Ce,{w:"full",h:"full",children:i.jsx(Ot,{label:e("gallery.unableToLoad"),icon:$7})}):s?i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(Ot,{label:e("gallery.loading"),icon:su})}):n?i.jsx(_H,{}):i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(Ot,{label:e("gallery.noImagesInGallery"),icon:su})})},q4e=c.memo(U4e),_H=c.memo(()=>{const e=G(),t=A(ML),n=A(sse),[s,o]=c.useState(null),r=c.useMemo(()=>Di(()=>{if(!s)return;const a=document.querySelector(`.${Z_}`);if(!a)return;const l=document.querySelector(`.${Ow}`);if(!l)return;const d=a.getBoundingClientRect(),u=s.getBoundingClientRect(),h=window.getComputedStyle(l),p=parseFloat(h.gap);if(!d.width||!d.height||!u.width||!u.height)return;let f=0,m=0;for(;m+d.height<=u.height+1;)f++,m+=d.height,m+p<=u.height&&(m+=p);let g=0;for(m=0;m+d.width<=u.width+1;)g++,m+=d.width,m+p<=u.width&&(m+=p);const x=Math.max(g,g*f);n===0||n===x||e(ise(x))},300),[s,e,n]);return c.useEffect(()=>{r()},[r,t]),c.useEffect(()=>{if(!s)return;const a=new ResizeObserver(r);return a.observe(s),r(),()=>{a.disconnect()}},[r,s,e]),i.jsxs(Ce,{position:"relative",w:"full",h:"full",mt:2,children:[i.jsx(Ce,{ref:o,position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",overflow:"hidden",children:i.jsx(Mi,{className:Ow,gridTemplateColumns:`repeat(auto-fill, minmax(${t}px, 1fr))`,gap:1,children:i.jsx(IH,{})})}),i.jsx(kH,{})]})});_H.displayName="GalleryImageGridContent";const IH=c.memo(()=>{const e=A(Su),{imageDTOs:t}=Cc(e,{selectFromResult:({data:n})=>({imageDTOs:(n==null?void 0:n.items)??Fs})});return i.jsx(i.Fragment,{children:t.map(n=>i.jsx(wz,{imageDTO:n},n.image_name))})});IH.displayName="GalleryImageGridImages";const TH=c.memo(()=>{const{t:e}=M(),t=hi();return i.jsxs(es,{isOpen:t.isOpen,onClose:t.onClose,isLazy:!0,lazyBehavior:"unmount",children:[i.jsx(ds,{children:i.jsx(de,{"aria-label":e("gallery.jump"),size:"sm",onClick:t.onToggle,variant:"outline",children:e("gallery.jump")})}),i.jsxs(ts,{children:[i.jsx(po,{}),i.jsx(us,{children:i.jsx(AH,{disclosure:t})})]})]})});TH.displayName="JumpTo";const AH=c.memo(({disclosure:e})=>{const{t}=M(),{goToPage:n,currentPage:s,pages:o}=nb(),[r,a]=c.useState(s),l=c.useRef(null),d=c.useCallback(h=>{a(h-1)},[]),u=c.useCallback(()=>{n(r),e.onClose()},[n,r,e]);return Eo("enter",()=>{u()},{enabled:e.isOpen,enableOnFormTags:["input"]},[e.isOpen,u]),Eo("esc",()=>{a(s),e.onClose()},{enabled:e.isOpen,enableOnFormTags:["input"]},[e.isOpen,e.onClose]),c.useEffect(()=>{setTimeout(()=>{var p;const h=(p=l.current)==null?void 0:p.querySelector("input");h==null||h.focus(),h==null||h.select()},0),a(s)},[s]),i.jsxs(T,{gap:2,alignItems:"center",children:[i.jsx(Q,{children:i.jsx(_e,{ref:l,size:"sm",maxW:"60px",value:r+1,min:1,max:o,step:1,onChange:d})}),i.jsx(de,{h:"full",size:"sm",onClick:u,children:t("gallery.go")})]})});AH.displayName="JumpToContent";const MH=c.memo(()=>{const{goPrev:e,goNext:t,isPrevEnabled:n,isNextEnabled:s,pageButtons:o,goToPage:r,currentPage:a,total:l}=nb(),d=c.useCallback(()=>{e()},[e]),u=c.useCallback(()=>{t()},[t]);return l?i.jsxs(T,{justifyContent:"center",alignItems:"center",w:"full",gap:1,pt:2,children:[i.jsx(le,{size:"sm","aria-label":"prev",icon:i.jsx(ij,{}),onClick:d,isDisabled:!n,variant:"ghost"}),i.jsx(Je,{}),o.map((h,p)=>i.jsx(EH,{page:h,currentPage:a,goToPage:r},`${h}_${p}`)),i.jsx(Je,{}),i.jsx(le,{size:"sm","aria-label":"next",icon:i.jsx(jy,{}),onClick:u,isDisabled:!s,variant:"ghost"}),i.jsx(TH,{})]}):null});MH.displayName="GalleryPagination";const EH=c.memo(({page:e,currentPage:t,goToPage:n})=>{const s=c.useCallback(()=>{e!==Pd&&n(e-1)},[n,e]);return e===Pd?i.jsx(de,{size:"sm",variant:"link",isDisabled:!0,children:"..."}):i.jsx(de,{size:"sm",onClick:s,variant:t===e-1?"solid":"outline",children:e})});EH.displayName="PageButton";const PH=c.memo(({searchTerm:e,onChangeSearchTerm:t,onResetSearchTerm:n})=>{const{t:s}=M(),o=A(Su),{isPending:r}=Cc(o,{selectFromResult:({isLoading:d,isFetching:u})=>({isPending:d||u})}),a=c.useCallback(d=>{t(d.target.value)},[t]),l=c.useCallback(d=>{d.key==="Escape"&&n()},[n]);return i.jsxs(Cr,{children:[i.jsx(St,{placeholder:s("gallery.searchImages"),value:e,onChange:a,"data-testid":"image-search-input",onKeyDown:l}),r&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(ci,{size:"sm",opacity:.5})}),!r&&e.length&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{onClick:n,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:i.jsx(Rt,{})})})]})});PH.displayName="GallerySearch";const kE={fontWeight:"semibold",fontSize:"sm",color:"base.300"},jE={borderColor:"base.800",borderBottomColor:"base.900",color:"invokeBlue.300"},K4e={flexShrink:0,minHeight:0,width:"100%"},Z4e=he(Ai,e=>e.galleryView),Y4e=he(Ai,e=>e.searchTerm),X4e=()=>{const{t:e}=M(),t=G(),n=A(Z4e),s=A(Y4e),o=hi({defaultIsOpen:s.length>0}),[r,a,l]=I4e(),d=c.useCallback(()=>{t(U2("images"))},[t]),u=c.useCallback(()=>{t(U2("assets"))},[t]),h=c.useCallback(()=>{o.onToggle(),l()},[l,o]),p=A(tk),f=Pm(p);return i.jsxs(T,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",h:"full",w:"full",pt:1,minH:0,children:[i.jsx(yc,{index:n==="images"?0:1,variant:"enclosed",display:"flex",flexDir:"column",w:"full",children:i.jsxs(bc,{gap:2,fontSize:"sm",borderColor:"base.800",alignItems:"center",w:"full",children:[i.jsx(W,{fontSize:"sm",fontWeight:"semibold",noOfLines:1,px:"2",wordBreak:"break-all",children:f}),i.jsx(Je,{}),i.jsx(Oe,{label:e("gallery.imagesTab"),children:i.jsx(Tn,{sx:kE,_selected:jE,onClick:d,"data-testid":"images-tab",children:e("parameters.images")})}),i.jsx(Oe,{label:e("gallery.assetsTab"),children:i.jsx(Tn,{sx:kE,_selected:jE,onClick:u,"data-testid":"assets-tab",children:e("gallery.assets")})}),i.jsxs(T,{h:"full",justifyContent:"flex-end",children:[i.jsx(H4e,{}),i.jsx(G4e,{}),i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch",onClick:h,tooltip:o.isOpen?`${e("gallery.exitSearch")}`:`${e("gallery.displaySearch")}`,"aria-label":e("gallery.displaySearch"),icon:i.jsx(P7,{})})]})]})}),i.jsx(ll,{in:o.isOpen,style:K4e,children:i.jsx(Ce,{w:"full",pt:2,children:i.jsx(PH,{searchTerm:r,onChangeSearchTerm:a,onResetSearchTerm:l})})}),i.jsx(q4e,{}),i.jsx(MH,{})]})},Q4e={flexShrink:0,minHeight:0},J4e={width:"full",height:"full",position:"relative",flexDirection:"column",display:"flex"},e5e=()=>{const{t:e}=M(),t=A(Jx),n=G(),s=hi({defaultIsOpen:!!t.length}),o=c.useRef(null),r=c.useMemo(()=>({id:"boards-list-panel",minSizePx:128,defaultSizePx:256,imperativePanelGroupRef:o,panelGroupDirection:"vertical"}),[]),a=zw(r),l=c.useCallback(()=>{t.length&&n(e1("")),s.onToggle(),a.expand()},[t.length,s,a,n]);return i.jsxs($u,{region:"gallery",sx:J4e,children:[i.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"full",children:[i.jsx(T,{flexGrow:1,flexBasis:0,children:i.jsx(de,{size:"sm",variant:"ghost",onClick:a.toggle,rightIcon:a.isCollapsed?i.jsx(Bi,{}):i.jsx(C7,{}),children:a.isCollapsed?e("boards.viewBoards"):e("boards.hideBoards")})}),i.jsx(T,{children:i.jsx(vH,{})}),i.jsxs(T,{flexGrow:1,flexBasis:0,justifyContent:"flex-end",children:[i.jsx(_4e,{}),i.jsx(le,{size:"sm",variant:"link",alignSelf:"stretch",onClick:l,tooltip:s.isOpen?`${e("gallery.exitBoardSearch")}`:`${e("gallery.displayBoardSearch")}`,"aria-label":e("gallery.displayBoardSearch"),icon:i.jsx(P7,{}),colorScheme:s.isOpen?"invokeBlue":"base"})]})]}),i.jsxs(qm,{ref:o,direction:"vertical",autoSaveId:"boards-list-panel",children:[i.jsx(ur,{collapsible:!0,...a.panelProps,children:i.jsxs(T,{flexDir:"column",w:"full",h:"full",children:[i.jsx(ll,{in:s.isOpen,style:Q4e,children:i.jsx(Ce,{w:"full",pt:2,children:i.jsx(h4e,{})})}),i.jsx(Ct,{pt:2}),i.jsx(d4e,{})]})}),i.jsx(eI,{id:"gallery-panel-handle",...a.resizeHandleProps}),i.jsx(ur,{id:"gallery-wrapper-panel",minSize:20,children:i.jsx(X4e,{})})]})]})},LH=c.memo(e5e),DH=c.memo(()=>{const{t:e}=M(),t=A(df),n=$t(),s=G(),o=c.useMemo(()=>t==="gallery"?1:0,[t]),r=c.useCallback(()=>{t!=="gallery"&&s(ji("gallery")),n.toggle()},[n,t,s]),a=c.useCallback(l=>{s(l===0?ji("layers"):ji("gallery"))},[s]);return De({id:"toggleViewer",category:"viewer",callback:n.toggle,dependencies:[n]}),i.jsxs(yc,{index:o,onChange:a,w:"full",h:"full",display:"flex",flexDir:"column",children:[i.jsxs(bc,{alignItems:"center",children:[i.jsx(RH,{}),i.jsx(Je,{}),i.jsx(de,{size:"sm",variant:"ghost",onClick:r,children:n.isOpen?e("gallery.closeViewer"):e("gallery.openViewer")})]}),i.jsxs(yu,{w:"full",h:"full",children:[i.jsx(Vn,{w:"full",h:"full",p:0,pt:3,children:i.jsx(Xo,{children:i.jsx(bH,{})})}),i.jsx(Vn,{w:"full",h:"full",p:0,pt:3,children:i.jsx(LH,{})})]})]})});DH.displayName="CanvasRightPanel";const RH=c.memo(()=>{const{t:e}=M(),t=Tc(),n=A(ose),[s,o]=c.useState("idle"),[r,a]=c.useState("idle"),l=c.useRef(null),d=c.useRef(null),u=c.useRef(null),h=c.useMemo(()=>n===0?e("controlLayers.layer_other"):`${e("controlLayers.layer_other")} (${n})`,[n,e]);return c.useEffect(()=>{if(!l.current)return;const p=()=>df(t.getState())==="layers",f=()=>{p()||(o("over"),u.current=window.setTimeout(()=>{u.current=null,t.dispatch(ji("layers")),o("idle"),a("potential")},300))},m=()=>{p()?o("idle"):o("potential"),u.current!==null&&clearTimeout(u.current)},g=()=>{o("potential")};return Xn(Jd({element:l.current,onDragEnter:f,onDragLeave:m}),or({canMonitor:({source:x})=>!An.typeGuard(x.data)&&!oo.typeGuard(x.data)?!1:!p(),onDragStart:g}),IC({element:l.current,onDragEnter:f,onDragLeave:m}),Fp({canMonitor:()=>!p(),onDragStart:g}))},[t]),c.useEffect(()=>{if(!d.current)return;const p=()=>df(t.getState())==="gallery",f=()=>{p()||(a("over"),u.current=window.setTimeout(()=>{u.current=null,t.dispatch(ji("gallery")),a("idle"),o("potential")},300))},m=()=>{p()?a("idle"):a("potential"),u.current!==null&&clearTimeout(u.current)},g=()=>{a("potential")};return Xn(Jd({element:d.current,onDragEnter:f,onDragLeave:m}),or({canMonitor:({source:x})=>!An.typeGuard(x.data)&&!oo.typeGuard(x.data)?!1:!p(),onDragStart:g}),IC({element:d.current,onDragEnter:f,onDragLeave:m}),Fp({canMonitor:()=>!p(),onDragStart:g}))},[t]),c.useEffect(()=>{const p=()=>{a("idle"),o("idle")},f=Xn(or({onDrop:p}),Fp({onDrop:p}));return()=>{f(),u.current!==null&&clearTimeout(u.current)}},[]),i.jsxs(i.Fragment,{children:[i.jsxs(Tn,{ref:l,position:"relative",w:32,children:[i.jsx(Ce,{as:"span",w:"full",children:h}),i.jsx(yf,{dndState:s,withBackdrop:!1})]}),i.jsxs(Tn,{ref:d,position:"relative",w:32,children:[i.jsx(Ce,{as:"span",w:"full",children:e("gallery.gallery")}),i.jsx(yf,{dndState:r,withBackdrop:!1})]})]})});RH.displayName="PanelTabs";const m2=Wn("dnd"),t5e=()=>{Pt("useDropMonitor"),c.useEffect(()=>Xn(or({canMonitor:({source:e})=>{const t=e.data;return!(!An.typeGuard(t)&&!oo.typeGuard(t))},onDrop:({source:e,location:t})=>{const n=t.current.dropTargets[0];if(!n){m2.warn("No dnd target");return}const s=e.data,o=n.data,{dispatch:r,getState:a}=em();for(const l of bwe){if(!l.typeGuard(o))continue;const d={sourceData:s,targetData:o,dispatch:r,getState:a};if(l.isValid(d)){m2.debug(_o({sourceData:s,targetData:o}),"Handling dnd drop"),l.handler(d);return}}m2.warn(_o({sourceData:s,targetData:o}),"Invalid drop")}})),[])},n5e=he(Xe,e=>{var t;return(t=rse(e))==null?void 0:t.data}),s5e=()=>{const{t:e}=M(),t=A(n5e),[n]=ml(t,300);return n?i.jsx(br,{data:n,label:"Node Data",bg:"base.850",color:"base.200"}):i.jsx(Ot,{label:e("nodes.noNodeSelected"),icon:null})},i5e=c.memo(s5e),OH=e=>{const t=c.useMemo(()=>he(Xe,s=>sk(s,e).data.notes),[e]);return A(t)},NH=c.memo(({nodeId:e})=>{const t=G(),{t:n}=M(),s=OH(e),o=c.useCallback(r=>{t(ase({nodeId:e,notes:r.target.value}))},[t,e]);return i.jsxs(Q,{orientation:"vertical",h:"full",children:[i.jsx(J,{children:n("nodes.notes")}),i.jsx(ls,{value:s,onChange:o,rows:10,resize:"none",variant:"darkFilled"})]})});NH.displayName="InvocationNodeNotesTextarea";const fI=e=>{const t=c.useMemo(()=>he(Xe,s=>fu(s,e).type),[e]);return A(t)},FH=e=>{const t=re(ln),n=fI(e);return c.useMemo(()=>t[n]??null,[t,n])},hb=c.memo(({nodeId:e,fallback:t,children:n})=>FH(e)?i.jsx(i.Fragment,{children:n}):t);hb.displayName="TemplateGate";const mI=e=>{const t=c.useMemo(()=>he(Xe,s=>sk(s,e).data.version),[e]);return A(t)},Bs=e=>{const t=re(ln),n=fI(e);return c.useMemo(()=>{const o=t[n];return ve(o,`Template for node type ${n} not found`),o},[t,n])},BH=e=>{const t=fI(e),n=mI(e),s=Bs(e);return c.useMemo(()=>t!==s.type?!0:n!==s.version,[s.type,s.version,t,n])},$H=e=>{const t=re(ln),n=c.useMemo(()=>he(Xe,o=>{const r=o.nodes.find(l=>l.id===e);if(!Rn(r))return null;const a=t[r.data.type];return(a==null?void 0:a.title)??null}),[e,t]);return A(n)},gI=e=>{const t=c.useMemo(()=>he(Xe,s=>{const o=s.nodes.find(r=>r.id===e);return(o==null?void 0:o.data.label)??null}),[e]);return A(t)},o5e=({nodeId:e,title:t})=>{const n=G(),s=gI(e),o=$H(e),{t:r}=M(),a=c.useRef(null),l=c.useCallback(u=>{n(EL({nodeId:e,label:u}))},[n,e]),d=fa({value:s||t||o||r("nodes.problemSettingTitle"),defaultValue:t||o||r("nodes.problemSettingTitle"),onChange:l,inputRef:a});return i.jsxs(T,{w:"full",alignItems:"center",children:[!d.isEditing&&i.jsx(W,{size:"sm",fontWeight:"semibold",userSelect:"none",onDoubleClick:d.startEditing,children:d.value}),d.isEditing&&i.jsx(St,{ref:a,...d.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},r5e=c.memo(o5e),a5e=()=>{const{t:e}=M(),t=A(ik);return t?i.jsx(hb,{nodeId:t,fallback:i.jsx(Ot,{label:e("nodes.noNodeSelected"),icon:null}),children:i.jsx(VH,{nodeId:t})}):i.jsx(Ot,{label:e("nodes.noNodeSelected"),icon:null})},l5e=c.memo(a5e),VH=c.memo(({nodeId:e})=>{const{t}=M(),n=mI(e),s=Bs(e),o=BH(e);return i.jsx(Ce,{position:"relative",w:"full",h:"full",children:i.jsx(ns,{children:i.jsxs(T,{flexDir:"column",position:"relative",w:"full",h:"full",gap:1,children:[i.jsxs(Q,{children:[i.jsx(J,{m:0,children:t("nodes.nodeName")}),i.jsx(r5e,{nodeId:e})]}),i.jsxs(lse,{children:[i.jsxs(Q,{children:[i.jsx(J,{m:0,children:t("nodes.nodeType")}),i.jsx(W,{fontSize:"sm",fontWeight:"semibold",children:s.title})]}),i.jsxs(Q,{isInvalid:o,children:[i.jsx(J,{m:0,children:t("nodes.nodeVersion")}),i.jsx(W,{fontSize:"sm",fontWeight:"semibold",children:n})]})]}),i.jsx(NH,{nodeId:e})]})})})});VH.displayName="Content";const c5e=({output:e})=>{const{image:t}=e,{currentData:n}=ul(t.image_name);return n?i.jsx(vl,{imageDTO:n}):null},d5e=c.memo(c5e),u5e=()=>{const e=A(ik),{t}=M();return e?i.jsx(hb,{nodeId:e,fallback:i.jsx(Ot,{label:t("nodes.noNodeSelected"),icon:null}),children:i.jsx(zH,{nodeId:e})}):i.jsx(Ot,{label:t("nodes.noNodeSelected"),icon:null})},h5e=c.memo(u5e),p5e=(e,t)=>`${e.type}-${t}`,zH=c.memo(({nodeId:e})=>{const{t}=M(),n=Bs(e),s=ok(e);return!s||s.outputs.length===0?i.jsx(Ot,{label:t("nodes.noOutputRecorded"),icon:null}):i.jsx(Ce,{position:"relative",w:"full",h:"full",children:i.jsx(ns,{children:i.jsx(T,{position:"relative",flexDir:"column",alignItems:"flex-start",p:1,gap:2,h:"full",w:"full",children:n.outputType==="image_output"?s.outputs.map((o,r)=>i.jsx(d5e,{output:o},p5e(o,r))):i.jsx(br,{data:s.outputs,label:t("nodes.nodeOutputs"),bg:"base.850",color:"base.200"})})})})});zH.displayName="Content";const f5e=()=>{const e=A(ik),{t}=M();return e?i.jsx(hb,{nodeId:e,fallback:i.jsx(Ot,{label:t("nodes.noNodeSelected"),icon:null}),children:i.jsx(GH,{nodeId:e})}):i.jsx(Ot,{label:t("nodes.noNodeSelected"),icon:null})},m5e=c.memo(f5e),GH=c.memo(({nodeId:e})=>{const{t}=M(),n=Bs(e);return i.jsx(br,{data:n,label:t("nodes.nodeTemplate"),bg:"base.850",color:"base.200"})});GH.displayName="Content";const g5e=()=>{const{t:e}=M();return i.jsxs(yc,{variant:"enclosed",display:"flex",flexDir:"column",w:"full",h:"full",children:[i.jsxs(bc,{children:[i.jsx(Tn,{children:e("common.details")}),i.jsx(Tn,{children:e("common.outputs")}),i.jsx(Tn,{children:e("common.data")}),i.jsx(Tn,{children:e("common.template")})]}),i.jsxs(yu,{h:"full",pt:2,children:[i.jsx(Vn,{h:"full",p:0,children:i.jsx(l5e,{})}),i.jsx(Vn,{h:"full",p:0,children:i.jsx(h5e,{})}),i.jsx(Vn,{h:"full",p:0,children:i.jsx(i5e,{})}),i.jsx(Vn,{h:"full",p:0,children:i.jsx(m5e,{})})]})]})},x5e=c.memo(g5e),HH=c.createContext(null),Ym=c.memo(({id:e,layout:t,children:n})=>{const s=c.useMemo(()=>({id:e,layout:t}),[e,t]);return i.jsx(HH.Provider,{value:s,children:n})});Ym.displayName="ContainerContextProvider";const Oo=()=>{const e=c.useContext(HH);return ve(e!==null,"useContainerContext must be used inside a ContainerContextProvider and cannot be used by the root container"),e},WH=c.createContext(0),Xm=c.memo(({depth:e,children:t})=>i.jsx(WH.Provider,{value:e,children:t}));Xm.displayName="DepthContextProvider";const pb=()=>c.useContext(WH),y5e={bg:"base.700",flexShrink:0,'&[data-parent-layout="column"]':{width:"100%",height:"1px"},'&[data-parent-layout="row"]':{height:"100%",width:"1px"}},UH=c.memo(()=>{const e=Oo();return i.jsx(T,{sx:y5e,"data-parent-layout":e.layout})});UH.displayName="DividerElementComponent";const b5e={top:(e,t,n)=>{const s=Math.abs(t.y-e.top);if(!n)return s;const o=Math.min(e.height/4,10);return s<=o?0:1/0},right:(e,t,n)=>{const s=Math.abs(e.right-t.x);if(!n)return s;const o=Math.min(e.width/4,10);return s<=o?0:1/0},bottom:(e,t,n)=>{const s=Math.abs(e.bottom-t.y);if(!n)return s;const o=Math.min(e.height/4,10);return s<=o?0:1/0},left:(e,t,n)=>{const s=Math.abs(t.x-e.left);if(!n)return s;const o=Math.min(e.width/4,10);return s<=o?0:1/0},center:(e,t,n)=>{const s=e.left+e.width/2,o=e.top+e.height/2;return Math.sqrt((t.x-s)**2+(t.y-o)**2)}},qH=Symbol("centerWithClosestEdge");function KH(e,{element:t,input:n,allowedCenterOrEdge:s}){var u;const o={x:n.clientX,y:n.clientY},r=t.getBoundingClientRect(),a=s.includes("center"),d=((u=s.map(h=>({edge:h,value:b5e[h](r,o,a)})).sort((h,p)=>h.value-p.value)[0])==null?void 0:u.edge)??null;return{...e,[qH]:d}}function ZH(e){return e[qH]??null}const go=Wn("dnd"),YH=Symbol("form-element"),ql=e=>({[YH]:!0,element:e}),Qm=e=>YH in e,XH=Symbol("node-field"),v5e=(e,t,n)=>({[XH]:!0,nodeId:e,fieldName:t,fieldTemplate:n}),fb=e=>XH in e,C5e=e=>{const t=document.querySelector(`#${e}`);t instanceof HTMLElement&&oz(t,hr("base.800"))},xI=()=>{const e=cn();return c.useCallback((n,s)=>{const o=rk(e.getState());return cse(o,n,s)},[e])},w5e=()=>{const e=cn();return c.useCallback(n=>{const s=rk(e.getState());return use(s,n)},[e])},QH=()=>{const e=cn();return c.useCallback(n=>{const s=rk(e.getState());return hse(s,n)},[e])},S5e=()=>{const e=cn();return c.useCallback(n=>{const{nodes:s}=Xe(e.getState());return dse(s,n)},[e])},k5e=e=>{if(fb(e.data)){const{nodeId:t,fieldName:n,fieldTemplate:s}=e.data;return PL(t,n,s.type)}return Qm(e.data)?e.data.element:null},j5e=e=>Qm(e.data)?e.data.element:null,_5e=()=>{Pt("useBuilderDndMonitor");const e=G(),t=c.useCallback((r,a)=>{wu.flushSync(()=>{e(r)}),C5e(a)},[e]),n=xI(),s=S5e(),o=w5e();c.useEffect(()=>or({canMonitor:({source:r})=>Qm(r.data)||fb(r.data),onDrop:({location:r,source:a})=>{const l=r.current.dropTargets[0];if(!l)return;const d=k5e(a),u=j5e(l);if(!d||!u||d.id===u.id)return;const h=!o(d.id),p=ZH(l.data);if(h)if(p==="center"){if(go.trace("Adding new element to empty container"),!Ji(u)){go.error(_o({target:l,source:a}),"Expected target to be a container");return}t(cC({element:d,parentId:u.id,index:0,initialValue:s(d)}),d.id);return}else{if(go.trace("Adding new element to container with children (dropped on edge of container child)"),u.parentId===void 0){go.error(_o({target:l,source:a}),"Expected target to have a parent");return}const f=n(u.parentId,Ji),m=f.data.children.indexOf(u.id),g=Bw({startIndex:m+1,indexOfTarget:m,closestEdgeOfTarget:p,axis:f.data.layout==="row"?"horizontal":"vertical"});t(cC({element:d,parentId:f.id,index:g,initialValue:s(d)}),d.id);return}else if(p==="center"){if(go.trace("Reparenting element to an empty container"),!Ji(u)){go.error(_o({target:l,source:a}),"Expected target to be a container");return}t(W4({id:d.id,newParentId:u.id,index:0}),d.id);return}else if(u.parentId===d.parentId){if(go.trace("Moving element within container"),u.parentId===void 0){go.error(_o({target:l,source:a}),"Expected target to have a parent");return}const f=n(u.parentId,Ji),m=f.data.children.indexOf(d.id),g=f.data.children.indexOf(u.id),x=hG({list:f.data.children,startIndex:m,indexOfTarget:g,closestEdgeOfTarget:p,axis:f.data.layout==="row"?"horizontal":"vertical"});t(dC({id:f.id,changes:{children:x}}),d.id);return}else if(u.parentId!==d.parentId){if(go.trace("Reparenting element to container with children (dropped on edge of container child)"),u.parentId===void 0){go.error(_o({target:l,source:a}),"Expected target to have a parent");return}const f=n(u.parentId,Ji),m=f.data.children.indexOf(u.id),g=Bw({startIndex:f.data.children.length+1,indexOfTarget:m,closestEdgeOfTarget:p,axis:f.data.layout==="row"?"horizontal":"vertical"});t(W4({id:d.id,newParentId:f.id,index:g}),d.id);return}else go.error(_o({target:l,source:a}),"Unhandled drop event!")}}),[t,o,n,s])},Jm=(e,t,n)=>{const s=A5e(e),[o,r]=c.useState(!1),[a,l]=c.useState(null),d=xI(),u=QH();return c.useEffect(()=>{s&&ve(!1,"Root element should not be draggable");const h=t.current,p=n.current;if(!(!h||!p))return Xn(Uu(h),Eu({element:h,dragHandle:p,getInitialData:()=>{const f=d(e);return ql(f)},onDragStart:()=>{r(!0)},onDrop:()=>{r(!1)}}),Jd({element:h,getIsSticky:()=>!1,canDrop:({source:f})=>fb(f.data)?!0:Qm(f.data)?f.data.element.id!==d(e).parentId:!1,getData:({input:f})=>{const m=d(e),g=ql(m),x=u(m);return KH(g,{element:h,input:f,allowedCenterOrEdge:x})},onDrag:({self:f,location:m,source:g})=>{var C;const x=(C=m.current.dropTargets.at(0))==null?void 0:C.element;if(!x||x!==h){l(null);return}const b=ZH(f.data);if(b==="center"&&g.element===h){l(null);return}l(b)},onDragLeave:()=>{l(null)},onDrop:()=>{l(null)}}))},[n,t,e,u,d,s]),[a,o]},I5e=e=>{const[t,n]=c.useState(!1),s=xI(),o=QH(),r=A(ak);return c.useEffect(()=>{const a=e.current;if(a)return Xn(Jd({element:a,getIsSticky:()=>!1,canDrop:({source:l})=>s(r,Ji).data.children.length!==0?!1:!!(fb(l.data)||Qm(l.data)),getData:({input:l})=>{const d=s(r,Ji),u=ql(d);return KH(u,{element:a,input:l,allowedCenterOrEdge:["center"]})},onDrag:()=>{n(!0)},onDragLeave:()=>{n(!1)},onDrop:()=>{n(!1)}}))},[e,o,s,r]),t},T5e=(e,t,n,s,o)=>{const[r,a]=c.useState(!1);return c.useEffect(()=>{const l=s.current,d=o.current;if(!(!l||!d))return Xn(Uu(l),Eu({element:l,dragHandle:d,getInitialData:()=>v5e(e,t,n),onDragStart:()=>{a(!0)},onDrop:()=>{a(!1)}}))},[o,s,t,n,e]),r},A5e=e=>{const t=A(ak);return c.useMemo(()=>t===e,[t,e])},U1={thickness:2,backgroundColor:"base.600"},M5e={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:U1.backgroundColor},E5e={horizontal:{height:`${U1.thickness}px`,left:2,right:2},vertical:{width:`${U1.thickness}px`,top:2,bottom:2}},P5e={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},L5e={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function D5e({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${U1.thickness}px))`,s=P5e[e];return i.jsx(Ce,{sx:{...M5e,...E5e[s],...L5e[e],"--local-line-offset":n}})}const eg=({activeDropRegion:e,gap:t})=>!e||e==="center"?null:i.jsx(D5e,{edge:e,gap:t||"var(--invoke-space-2)"}),R5e={w:"full",h:"full",borderWidth:1,borderRadius:"base",borderTopRadius:"unset",borderTop:"unset",borderColor:"baseAlpha.250",'&[data-depth="0"]':{borderColor:"baseAlpha.100"},'&[data-depth="1"]':{borderColor:"baseAlpha.150"},'&[data-depth="2"]':{borderColor:"baseAlpha.200"},'&[data-is-dragging="true"]':{opacity:.3}},th=c.memo(({children:e,...t})=>{const n=pb();return i.jsx(T,{sx:R5e,"data-depth":n,...t,children:e})});th.displayName="FormElementEditModeContent";const O5e={position:"relative",minH:8,py:.5,alignItems:"center",w:"full",h:"full"},mb=c.memo(({children:e})=>i.jsx(T,{sx:O5e,children:e}));mb.displayName="InputFieldWrapper";const N5e=(e,t)=>{const n=c.useMemo(()=>he(Xe,o=>{const r=ju(o,e);return r?!!r.data.inputs[t]:!1}),[t,e]);return A(n)},F5e=(e,t)=>{const n=re(ln),s=c.useMemo(()=>he(Xe,r=>{const a=ju(r,e);if(!a)return t;const l=a.data.inputs[t],d=n[a.data.type],u=d==null?void 0:d.inputs[t];return(l==null?void 0:l.label)||(u==null?void 0:u.title)||t}),[t,e,n]);return A(s)},B5e=(e,t)=>{const n=re(ln),s=c.useMemo(()=>he(Xe,r=>{const a=ju(r,e);if(!a)return!1;const l=n[a.data.type];return!!(l==null?void 0:l.inputs[t])}),[t,e,n]);return A(s)},Fc=c.memo(({nodeId:e,fieldName:t,children:n,fallback:s,formatLabel:o})=>{const r=N5e(e,t),a=B5e(e,t);return!a||!r?s!==void 0?s:i.jsx(JH,{nodeId:e,fieldName:t,formatLabel:o,hasInstance:r,hasTemplate:a}):n});Fc.displayName="InputFieldGate";const JH=c.memo(({nodeId:e,fieldName:t,formatLabel:n,hasTemplate:s,hasInstance:o})=>{const{t:r}=M(),a=F5e(e,t),l=c.useMemo(()=>n?n(a):s&&!o?r("nodes.missingField_withName",{name:a}):!s&&o?r("nodes.unexpectedField_withName",{name:a}):r("nodes.unknownField_withName",{name:a}),[n,o,s,a,r]);return i.jsx(mb,{children:i.jsx(T,{w:"full",px:1,py:1,justifyContent:"center",children:i.jsx(W,{fontWeight:"semibold",color:"error.300",whiteSpace:"pre",textAlign:"center",children:l})})})});JH.displayName="Fallback";const eW=c.memo(({element:e})=>{const{id:t,data:n}=e,{layout:s}=n,{t:o}=M(),r=G(),a=c.useCallback(()=>{r(dC({id:t,changes:{layout:"row"}}))},[r,t]),l=c.useCallback(()=>{r(dC({id:t,changes:{layout:"column"}}))},[r,t]);return i.jsxs(es,{placement:"top",isLazy:!0,lazyBehavior:"unmount",children:[i.jsx(ds,{children:i.jsx(le,{"aria-label":"settings",icon:i.jsx(U7,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),i.jsx(al,{children:i.jsxs(ts,{children:[i.jsx(po,{}),i.jsx(us,{children:i.jsxs(Q,{children:[i.jsx(J,{m:0,children:o("workflows.builder.layout")}),i.jsxs(Qn,{variant:"outline",size:"sm",children:[i.jsx(de,{onClick:a,colorScheme:s==="row"?"invokeBlue":"base",children:o("workflows.builder.row")}),i.jsx(de,{onClick:l,colorScheme:s==="column"?"invokeBlue":"base",children:o("workflows.builder.column")})]})]})})]})})]})});eW.displayName="ContainerElementSettings";const nh=(e,t,n)=>{const s=(n==null?void 0:n.min)??t.min,o=(n==null?void 0:n.max)??t.max,r=(n==null?void 0:n.step)??t.step;if(r===void 0)return Math.min(Math.max(e,s),o);let a=Math.round(e/r)*r;return a<s?a=Math.ceil(s/r)*r:a>o&&(a=Math.floor(o/r)*r),Math.min(Math.max(a,s),o)},tg=(e,t,n,s={})=>{const{min:o,max:r,step:a}=s,l=G(),d=c.useMemo(()=>a!==void 0?a:He(n.multipleOf)?.1:n.multipleOf,[n.multipleOf,a]),u=c.useMemo(()=>a!==void 0?a:He(n.multipleOf)?.01:n.multipleOf,[n.multipleOf,a]),h=c.useMemo(()=>{let g=-4294967295;return o!==void 0?g=o:He(n.minimum)?He(n.exclusiveMinimum)||(g=n.exclusiveMinimum+.01):g=n.minimum,ny(g,d)},[n.exclusiveMinimum,n.minimum,o,d]),p=c.useMemo(()=>{let g=_u;return r!==void 0?g=r:He(n.maximum)?He(n.exclusiveMaximum)||(g=n.exclusiveMaximum-.01):g=n.maximum,Qd(g,d)},[n.exclusiveMaximum,n.maximum,r,d]),f=c.useCallback(g=>nh(g,{min:h,max:p,step:d},{min:o,max:r,step:a}),[p,h,r,o,a,d]),m=c.useCallback(g=>{l(lk({nodeId:e,fieldName:t,value:g}))},[l,t,e]);return{defaultValue:n.default,onChange:m,min:h,max:p,step:d,fineStep:u,constrainValue:f}},Bc=(e,t)=>{const n=c.useMemo(()=>he(Xe,o=>{const r=Wx(o,e,t);return ve(r,`Instance for input field ${t} not found`),r}),[t,e]);return A(n)},tW=c.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o})=>i.jsxs(i.Fragment,{children:[i.jsx(nW,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o}),i.jsx(sW,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o}),i.jsx(iW,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o})]}));tW.displayName="NodeFieldElementFloatSettings";const nW=c.memo(({id:e,settings:t})=>{const{t:n}=M(),s=G(),o=c.useCallback(r=>{const a={...t,component:LL.parse(r.target.value)};s(as({id:e,changes:{settings:a}}))},[t,s,e]);return i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{flex:1,children:n("workflows.builder.component")}),i.jsxs(lo,{value:t.component,onChange:o,size:"sm",children:[i.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),i.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),i.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});nW.displayName="SettingComponent";const sW=c.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o})=>{const{t:r}=M(),a=G(),l=Bc(n,s),d=tg(n,s,o),u=c.useCallback(()=>{const m={...t,min:t.min!==void 0?void 0:d.min};a(as({id:e,changes:{settings:m}}))},[t,a,d,e]),h=c.useCallback(m=>{const g={...t,min:m};a(as({id:e,changes:{settings:g}}));const x=nh(l.value,d,g);l.value!==x&&a(lk({nodeId:n,fieldName:s,value:x}))},[t,a,l.value,s,d,e,n]),p=c.useMemo(()=>ny(d.min,d.step),[d.min,d.step]),f=c.useMemo(()=>(t.max??d.max)-d.step,[t.max,d.max,d.step]);return i.jsxs(Q,{orientation:"vertical",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[i.jsx(J,{m:0,children:r("workflows.builder.minimum")}),i.jsx(et,{isChecked:t.min!==void 0,onChange:u,size:"sm"})]}),i.jsx(_e,{w:"full",isDisabled:t.min===void 0,value:t.min===void 0?`${d.min} (inherited)`:t.min,onChange:h,min:p,max:f,step:d.step})]})});sW.displayName="SettingMin";const iW=c.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o})=>{const{t:r}=M(),a=G(),l=Bc(n,s),d=tg(n,s,o),u=c.useCallback(()=>{const m={...t,max:t.max!==void 0?void 0:d.max};a(as({id:e,changes:{settings:m}}))},[t,a,d,e]),h=c.useCallback(m=>{const g={...t,max:m};a(as({id:e,changes:{settings:g}}));const x=nh(l.value,d,g);l.value!==x&&a(lk({nodeId:n,fieldName:s,value:x}))},[t,a,l.value,s,d,e,n]),p=c.useMemo(()=>(t.min??d.min)+d.step,[t.min,d.min,d.step]),f=c.useMemo(()=>Qd(d.max,d.step),[d.max,d.step]);return i.jsxs(Q,{orientation:"vertical",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[i.jsx(J,{m:0,children:r("workflows.builder.maximum")}),i.jsx(et,{isChecked:t.max!==void 0,onChange:u,size:"sm"})]}),i.jsx(_e,{w:"full",isDisabled:t.max===void 0,value:t.max===void 0?`${d.max} (inherited)`:t.max,onChange:h,min:p,max:f,step:d.step})]})});iW.displayName="SettingMax";const ng=(e,t,n,s={})=>{const{min:o,max:r,step:a}=s,l=G(),d=c.useMemo(()=>a!==void 0?a:He(n.multipleOf)?1:n.multipleOf,[n.multipleOf,a]),u=c.useMemo(()=>a!==void 0?a:He(n.multipleOf)?1:n.multipleOf,[n.multipleOf,a]),h=c.useMemo(()=>{let g=-4294967295;return o!==void 0?g=o:He(n.minimum)?He(n.exclusiveMinimum)||(g=n.exclusiveMinimum+1):g=n.minimum,ny(g,d)},[n.exclusiveMinimum,n.minimum,o,d]),p=c.useMemo(()=>{let g=_u;return r!==void 0?g=r:He(n.maximum)?He(n.exclusiveMaximum)||(g=n.exclusiveMaximum-1):g=n.maximum,Qd(g,d)},[n.exclusiveMaximum,n.maximum,r,d]),f=c.useCallback(g=>nh(g,{min:h,max:p,step:d},{min:o,max:r,step:a}),[p,h,r,o,a,d]),m=c.useCallback(g=>{l(ck({nodeId:e,fieldName:t,value:g}))},[l,t,e]);return{defaultValue:n.default,onChange:m,min:h,max:p,step:d,fineStep:u,constrainValue:f}},oW=c.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o})=>i.jsxs(i.Fragment,{children:[i.jsx(rW,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o}),i.jsx(aW,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o}),i.jsx(lW,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o})]}));oW.displayName="NodeFieldElementIntegerSettings";const rW=c.memo(({id:e,settings:t})=>{const{t:n}=M(),s=G(),o=c.useCallback(r=>{const a={...t,component:LL.parse(r.target.value)};s(as({id:e,changes:{settings:a}}))},[t,s,e]);return i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{flex:1,children:n("workflows.builder.component")}),i.jsxs(lo,{value:t.component,onChange:o,size:"sm",children:[i.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),i.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),i.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});rW.displayName="SettingComponent";const aW=c.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o})=>{const{t:r}=M(),a=G(),l=Bc(n,s),d=ng(n,s,o),u=c.useCallback(()=>{const m={...t,min:t.min!==void 0?void 0:d.min};a(as({id:e,changes:{settings:m}}))},[t,a,d.min,e]),h=c.useCallback(m=>{const g={...t,min:m};a(as({id:e,changes:{settings:g}}));const x=nh(l.value,d,g);l.value!==x&&a(ck({nodeId:n,fieldName:s,value:x}))},[t,a,e,l,d,n,s]),p=c.useMemo(()=>ny(d.min,d.step),[d.min,d.step]),f=c.useMemo(()=>(t.max??d.max)-d.step,[t.max,d.max,d.step]);return i.jsxs(Q,{orientation:"vertical",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[i.jsx(J,{m:0,children:r("workflows.builder.minimum")}),i.jsx(et,{isChecked:t.min!==void 0,onChange:u,size:"sm"})]}),i.jsx(_e,{w:"full",isDisabled:t.min===void 0,value:t.min??`${d.min} (inherited)`,onChange:h,min:p,max:f,step:d.step})]})});aW.displayName="SettingMin";const lW=c.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:o})=>{const{t:r}=M(),a=G(),l=Bc(n,s),d=ng(n,s,o),u=c.useCallback(()=>{const m={...t,max:t.max!==void 0?void 0:d.max};a(as({id:e,changes:{settings:m}}))},[t,a,d.max,e]),h=c.useCallback(m=>{const g={...t,max:m};a(as({id:e,changes:{settings:g}}));const x=nh(l.value,d,g);l.value!==x&&a(ck({nodeId:n,fieldName:s,value:x}))},[t,a,l.value,s,d,e,n]),p=c.useMemo(()=>(t.min??d.min)+d.step,[t.min,d.min,d.step]),f=c.useMemo(()=>Qd(d.max,d.step),[d.max,d.step]);return i.jsxs(Q,{orientation:"vertical",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[i.jsx(J,{m:0,children:r("workflows.builder.maximum")}),i.jsx(et,{isChecked:t.max!==void 0,onChange:u,size:"sm"})]}),i.jsx(_e,{w:"full",isDisabled:t.max===void 0,value:t.max??`${d.max} (inherited)`,onChange:h,min:p,max:f,step:d.step})]})});lW.displayName="SettingMax";const cW=c.memo(({id:e,settings:t})=>{const{t:n}=M(),s=G(),o=c.useCallback(r=>{const a=pse.parse(r.target.value);if(a!==t.component)if(a==="dropdown"){const l={...t,component:a,options:[uC()]};s(as({id:e,changes:{settings:l}}));return}else{const l=na({...t,component:a},"options");s(as({id:e,changes:{settings:l}}))}},[t,s,e]);return i.jsxs(Q,{children:[i.jsx(J,{flex:1,children:n("workflows.builder.component")}),i.jsxs(lo,{value:t.component,onChange:o,size:"sm",children:[i.jsx("option",{value:"input",children:n("workflows.builder.singleLine")}),i.jsx("option",{value:"textarea",children:n("workflows.builder.multiLine")}),i.jsx("option",{value:"dropdown",children:n("workflows.builder.dropdown")})]})]})});cW.displayName="NodeFieldElementStringSettings";const No=(e,t)=>{const n=Bs(e);return c.useMemo(()=>{const o=n.inputs[t];return ve(o,`Template for input field ${t} not found.`),o},[t,n.inputs])},dW=c.memo(({element:e})=>{const{id:t,data:n}=e,{showDescription:s,fieldIdentifier:o}=n,{nodeId:r,fieldName:a}=o,l=No(r,a),{t:d}=M(),u=G(),h=c.useCallback(()=>{u(as({id:t,changes:{showDescription:!s}}))},[u,t,s]),p=c.useMemo(()=>n.settings?n.settings:q0(l)?fse():U0(l)?mse():DL(l)?gse():null,[n.settings,l]);return i.jsxs(es,{placement:"top",isLazy:!0,lazyBehavior:"unmount",children:[i.jsx(ds,{children:i.jsx(le,{"aria-label":"settings",icon:i.jsx(U7,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),i.jsx(al,{children:i.jsxs(ts,{children:[i.jsx(po,{}),i.jsx(us,{minW:48,children:i.jsxs(T,{w:"full",h:"full",gap:2,flexDir:"column",children:[i.jsxs(Q,{children:[i.jsx(J,{flex:1,children:d("workflows.builder.showDescription")}),i.jsx(et,{size:"sm",isChecked:s,onChange:h})]}),(p==null?void 0:p.type)==="integer-field-config"&&q0(l)&&i.jsx(oW,{id:t,settings:p,nodeId:r,fieldName:a,fieldTemplate:l}),(p==null?void 0:p.type)==="float-field-config"&&U0(l)&&i.jsx(tW,{id:t,settings:p,nodeId:r,fieldName:a,fieldTemplate:l}),(p==null?void 0:p.type)==="string-field-config"&&i.jsx(cW,{id:t,settings:p})]})})]})})]})});dW.displayName="NodeFieldElementSettings";const $0=Le(null),uW=e=>{const[t,n]=c.useState(!1);c.useEffect(()=>$0.subscribe(a=>{n(a===e)}),[t,e]);const s=c.useCallback(()=>{$0.set(e)},[e]),o=c.useCallback(()=>{$0.set(null)},[]);return{isMouseOverNode:t,handleMouseOver:s,handleMouseOut:o}},g2=Le(null),sg=e=>{const[t,n]=c.useState(!1);c.useEffect(()=>g2.subscribe(a=>{n(a===e)}),[t,e]);const s=c.useCallback(()=>{g2.set(e)},[e]),o=c.useCallback(()=>{g2.set(null)},[]);return{isMouseOverFormField:t,handleMouseOver:s,handleMouseOut:o}},$5e=Wn("workflows"),gb=e=>c.useCallback(()=>{const n=Op.get();if(!n){$5e.warn("No flow instance found, cannot zoom to node");return}n.fitView({duration:300,maxZoom:1.5,nodes:[{id:e}]})},[e]),V5e={w:"full",ps:2,h:8,minH:8,maxH:8,borderTopRadius:"base",alignItems:"center",color:"base.500",bg:"baseAlpha.250",cursor:"grab",'&[data-depth="0"]':{bg:"baseAlpha.100"},'&[data-depth="1"]':{bg:"baseAlpha.150"},'&[data-depth="2"]':{bg:"baseAlpha.200"},'&[data-is-dragging="true"]':{opacity:.3},_hover:{bg:"baseAlpha.300"}},sh=c.memo(({element:e,dragHandleRef:t,...n})=>{const s=pb();return i.jsxs(T,{ref:t,sx:V5e,"data-depth":s,...n,children:[i.jsx(fW,{element:e}),i.jsx(Je,{}),Ji(e)&&i.jsx(eW,{element:e}),dk(e)&&i.jsxs(Fc,{nodeId:e.data.fieldIdentifier.nodeId,fieldName:e.data.fieldIdentifier.fieldName,fallback:null,children:[i.jsx(hW,{element:e}),i.jsx(dW,{element:e})]}),i.jsx(pW,{element:e})]})});sh.displayName="FormElementEditModeHeader";const hW=c.memo(({element:e})=>{const{t}=M(),{nodeId:n}=e.data.fieldIdentifier,s=gb(n),o=sg(n);return i.jsx(le,{onMouseOver:o.handleMouseOver,onMouseOut:o.handleMouseOut,tooltip:t("workflows.builder.zoomToNode"),"aria-label":t("workflows.builder.zoomToNode"),onClick:s,icon:i.jsx(Zpe,{}),variant:"link",size:"sm",alignSelf:"stretch"})});hW.displayName="ZoomToNodeButton";const pW=c.memo(({element:e})=>{const{t}=M(),n=G(),s=c.useCallback(()=>{n(xse({id:e.id}))},[n,e.id]);return i.jsx(le,{tooltip:t("common.delete"),"aria-label":t("common.delete"),onClick:s,icon:i.jsx(Rt,{}),variant:"link",size:"sm",alignSelf:"stretch",colorScheme:"error"})});pW.displayName="RemoveElementButton";const fW=c.memo(({element:e})=>{const{t}=M(),n=c.useMemo(()=>Ji(e)&&e.data.layout==="column"?t("workflows.builder.containerColumnLayout"):Ji(e)&&e.data.layout==="row"?t("workflows.builder.containerRowLayout"):t(`workflows.builder.${Xce(e.type)}`),[e,t]);return i.jsx(W,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",userSelect:"none",children:n})});fW.displayName="Label";const z5e={position:"relative",borderRadius:"base",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{w:"min-content",h:"full"},flexDir:"column"},mW=c.memo(({el:e})=>{const t=c.useRef(null),n=c.useRef(null),[s,o]=Jm(e.id,t,n),r=Oo(),{id:a}=e;return i.jsxs(T,{ref:t,id:a,className:RL,sx:z5e,"data-parent-layout":r.layout,children:[i.jsx(sh,{dragHandleRef:n,element:e,"data-is-dragging":o}),i.jsx(th,{"data-is-dragging":o,p:4,children:i.jsx(UH,{})}),i.jsx(eg,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});mW.displayName="DividerElementEditMode";const G5e={bg:"base.700",flexShrink:0,'&[data-layout="column"]':{width:"100%",height:"1px"},'&[data-layout="row"]':{height:"100%",width:"1px"}},gW=c.memo(({el:e})=>{const t=Oo(),{id:n}=e;return i.jsx(T,{id:n,className:RL,sx:G5e,"data-layout":(t==null?void 0:t.layout)||"column"})});gW.displayName="DividerElementViewMode";const ih=e=>{const t=c.useMemo(()=>yse(e),[e]);return A(t)},xW=c.memo(({id:e})=>{const t=ih(e),n=A(kr);if(!(!t||!OL(t)))return n==="view"?i.jsx(gW,{el:t}):i.jsx(mW,{el:t})});xW.displayName="DividerElement";function Gw(){return Gw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Gw.apply(null,arguments)}function H5e(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var W5e=c.useLayoutEffect,U5e=function(t){var n=xe.useRef(t);return W5e(function(){n.current=t}),n},_E=function(t,n){if(typeof t=="function"){t(n);return}t.current=n},q5e=function(t,n){var s=xe.useRef();return xe.useCallback(function(o){t.current=o,s.current&&_E(s.current,null),s.current=n,n&&_E(n,o)},[n])},IE={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},K5e=function(t){Object.keys(IE).forEach(function(n){t.style.setProperty(n,IE[n],"important")})},TE=K5e,$s=null,AE=function(t,n){var s=t.scrollHeight;return n.sizingStyle.boxSizing==="border-box"?s+n.borderSize:s-n.paddingSize};function Z5e(e,t,n,s){n===void 0&&(n=1),s===void 0&&(s=1/0),$s||($s=document.createElement("textarea"),$s.setAttribute("tabindex","-1"),$s.setAttribute("aria-hidden","true"),TE($s)),$s.parentNode===null&&document.body.appendChild($s);var o=e.paddingSize,r=e.borderSize,a=e.sizingStyle,l=a.boxSizing;Object.keys(a).forEach(function(f){var m=f;$s.style[m]=a[m]}),TE($s),$s.value=t;var d=AE($s,e);$s.value=t,d=AE($s,e),$s.value="x";var u=$s.scrollHeight-o,h=u*n;l==="border-box"&&(h=h+o+r),d=Math.max(h,d);var p=u*s;return l==="border-box"&&(p=p+o+r),d=Math.min(p,d),[d,u]}var ME=function(){},Y5e=function(t,n){return t.reduce(function(s,o){return s[o]=n[o],s},{})},X5e=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],Q5e=!!document.documentElement.currentStyle,J5e=function(t){var n=window.getComputedStyle(t);if(n===null)return null;var s=Y5e(X5e,n),o=s.boxSizing;if(o==="")return null;Q5e&&o==="border-box"&&(s.width=parseFloat(s.width)+parseFloat(s.borderRightWidth)+parseFloat(s.borderLeftWidth)+parseFloat(s.paddingRight)+parseFloat(s.paddingLeft)+"px");var r=parseFloat(s.paddingBottom)+parseFloat(s.paddingTop),a=parseFloat(s.borderBottomWidth)+parseFloat(s.borderTopWidth);return{sizingStyle:s,paddingSize:r,borderSize:a}},eTe=J5e;function yI(e,t,n){var s=U5e(n);c.useLayoutEffect(function(){var o=function(a){return s.current(a)};if(e)return e.addEventListener(t,o),function(){return e.removeEventListener(t,o)}},[])}var tTe=function(t,n){yI(document.body,"reset",function(s){t.current.form===s.target&&n(s)})},nTe=function(t){yI(window,"resize",t)},sTe=function(t){yI(document.fonts,"loadingdone",t)},iTe=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],oTe=function(t,n){var s=t.cacheMeasurements,o=t.maxRows,r=t.minRows,a=t.onChange,l=a===void 0?ME:a,d=t.onHeightChange,u=d===void 0?ME:d,h=H5e(t,iTe),p=h.value!==void 0,f=c.useRef(null),m=q5e(f,n),g=c.useRef(0),x=c.useRef(),b=function(){var v=f.current,w=s&&x.current?x.current:eTe(v);if(w){x.current=w;var k=Z5e(w,v.value||v.placeholder||"x",r,o),S=k[0],P=k[1];g.current!==S&&(g.current=S,v.style.setProperty("height",S+"px","important"),u(S,{rowHeight:P}))}},C=function(v){p||b(),l(v)};return c.useLayoutEffect(b),tTe(f,function(){if(!p){var y=f.current.value;requestAnimationFrame(function(){var v=f.current;v&&y!==v.value&&b()})}}),nTe(b),sTe(b),c.createElement("textarea",Gw({},h,{onChange:C,ref:m}))},rTe=c.forwardRef(oTe);const aTe=Sr(rTe),bI=am(NL(({variant:e,...t},n)=>{const s=bse("Textarea",{variant:e});return i.jsx(aTe,{__css:s,ref:n,...t})}));bI.displayName="AutosizeTextarea";const ig={a:{fontWeight:"semibold"},"a:hover":{textDecoration:"underline"}},og={target:"_blank",rel:"noopener noreferrer",validate:e=>/^https?:\/\//.test(e)},lTe="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2ntley5rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6logistics9properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3ncaster6d0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2psy3ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",cTe="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",hc=(e,t)=>{for(const n in t)e[n]=t[n];return e},Hw="numeric",Ww="ascii",Uw="alpha",Kp="asciinumeric",Rp="alphanumeric",qw="domain",yW="emoji",dTe="scheme",uTe="slashscheme",x2="whitespace";function hTe(e,t){return e in t||(t[e]=[]),t[e]}function Kl(e,t,n){t[Hw]&&(t[Kp]=!0,t[Rp]=!0),t[Ww]&&(t[Kp]=!0,t[Uw]=!0),t[Kp]&&(t[Rp]=!0),t[Uw]&&(t[Rp]=!0),t[Rp]&&(t[qw]=!0),t[yW]&&(t[qw]=!0);for(const s in t){const o=hTe(s,n);o.indexOf(e)<0&&o.push(e)}}function pTe(e,t){const n={};for(const s in t)t[s].indexOf(e)>=0&&(n[s]=!0);return n}function vi(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}vi.groups={};vi.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let s=0;s<t.jr.length;s++){const o=t.jr[s][0],r=t.jr[s][1];if(r&&o.test(e))return r}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,s){for(let o=0;o<e.length;o++)this.tt(e[o],t,n,s)},tr(e,t,n,s){s=s||vi.groups;let o;return t&&t.j?o=t:(o=new vi(t),n&&s&&Kl(t,n,s)),this.jr.push([e,o]),o},ts(e,t,n,s){let o=this;const r=e.length;if(!r)return o;for(let a=0;a<r-1;a++)o=o.tt(e[a]);return o.tt(e[r-1],t,n,s)},tt(e,t,n,s){s=s||vi.groups;const o=this;if(t&&t.j)return o.j[e]=t,t;const r=t;let a,l=o.go(e);if(l?(a=new vi,hc(a.j,l.j),a.jr.push.apply(a.jr,l.jr),a.jd=l.jd,a.t=l.t):a=new vi,r){if(s)if(a.t&&typeof a.t=="string"){const d=hc(pTe(a.t,s),n);Kl(r,d,s)}else n&&Kl(r,n,s);a.t=r}return o.j[e]=a,a}};const yt=(e,t,n,s,o)=>e.ta(t,n,s,o),In=(e,t,n,s,o)=>e.tr(t,n,s,o),EE=(e,t,n,s,o)=>e.ts(t,n,s,o),je=(e,t,n,s,o)=>e.tt(t,n,s,o),Rr="WORD",Kw="UWORD",bW="ASCIINUMERICAL",vW="ALPHANUMERICAL",Pf="LOCALHOST",Zw="TLD",Yw="UTLD",V0="SCHEME",pd="SLASH_SCHEME",vI="NUM",Xw="WS",CI="NL",Zp="OPENBRACE",Yp="CLOSEBRACE",q1="OPENBRACKET",K1="CLOSEBRACKET",Z1="OPENPAREN",Y1="CLOSEPAREN",X1="OPENANGLEBRACKET",Q1="CLOSEANGLEBRACKET",J1="FULLWIDTHLEFTPAREN",ex="FULLWIDTHRIGHTPAREN",tx="LEFTCORNERBRACKET",nx="RIGHTCORNERBRACKET",sx="LEFTWHITECORNERBRACKET",ix="RIGHTWHITECORNERBRACKET",ox="FULLWIDTHLESSTHAN",rx="FULLWIDTHGREATERTHAN",ax="AMPERSAND",wI="APOSTROPHE",lx="ASTERISK",Ia="AT",cx="BACKSLASH",dx="BACKTICK",ux="CARET",La="COLON",SI="COMMA",hx="DOLLAR",Wo="DOT",px="EQUALS",kI="EXCLAMATION",Zi="HYPHEN",Xp="PERCENT",fx="PIPE",mx="PLUS",gx="POUND",Qp="QUERY",jI="QUOTE",CW="FULLWIDTHMIDDLEDOT",_I="SEMI",Uo="SLASH",Jp="TILDE",xx="UNDERSCORE",wW="EMOJI",yx="SYM";var SW=Object.freeze({__proto__:null,WORD:Rr,UWORD:Kw,ASCIINUMERICAL:bW,ALPHANUMERICAL:vW,LOCALHOST:Pf,TLD:Zw,UTLD:Yw,SCHEME:V0,SLASH_SCHEME:pd,NUM:vI,WS:Xw,NL:CI,OPENBRACE:Zp,CLOSEBRACE:Yp,OPENBRACKET:q1,CLOSEBRACKET:K1,OPENPAREN:Z1,CLOSEPAREN:Y1,OPENANGLEBRACKET:X1,CLOSEANGLEBRACKET:Q1,FULLWIDTHLEFTPAREN:J1,FULLWIDTHRIGHTPAREN:ex,LEFTCORNERBRACKET:tx,RIGHTCORNERBRACKET:nx,LEFTWHITECORNERBRACKET:sx,RIGHTWHITECORNERBRACKET:ix,FULLWIDTHLESSTHAN:ox,FULLWIDTHGREATERTHAN:rx,AMPERSAND:ax,APOSTROPHE:wI,ASTERISK:lx,AT:Ia,BACKSLASH:cx,BACKTICK:dx,CARET:ux,COLON:La,COMMA:SI,DOLLAR:hx,DOT:Wo,EQUALS:px,EXCLAMATION:kI,HYPHEN:Zi,PERCENT:Xp,PIPE:fx,PLUS:mx,POUND:gx,QUERY:Qp,QUOTE:jI,FULLWIDTHMIDDLEDOT:CW,SEMI:_I,SLASH:Uo,TILDE:Jp,UNDERSCORE:xx,EMOJI:wW,SYM:yx});const Lr=/[a-z]/,bp=new RegExp("\\p{L}","u"),y2=new RegExp("\\p{Emoji}","u"),Dr=/\d/,b2=/\s/,PE="\r",v2=`
`,fTe="",mTe="",C2="";let r0=null,a0=null;function gTe(e=[]){const t={};vi.groups=t;const n=new vi;r0==null&&(r0=LE(lTe)),a0==null&&(a0=LE(cTe)),je(n,"'",wI),je(n,"{",Zp),je(n,"}",Yp),je(n,"[",q1),je(n,"]",K1),je(n,"(",Z1),je(n,")",Y1),je(n,"<",X1),je(n,">",Q1),je(n,"",J1),je(n,"",ex),je(n,"",tx),je(n,"",nx),je(n,"",sx),je(n,"",ix),je(n,"",ox),je(n,"",rx),je(n,"&",ax),je(n,"*",lx),je(n,"@",Ia),je(n,"`",dx),je(n,"^",ux),je(n,":",La),je(n,",",SI),je(n,"$",hx),je(n,".",Wo),je(n,"=",px),je(n,"!",kI),je(n,"-",Zi),je(n,"%",Xp),je(n,"|",fx),je(n,"+",mx),je(n,"#",gx),je(n,"?",Qp),je(n,'"',jI),je(n,"/",Uo),je(n,";",_I),je(n,"~",Jp),je(n,"_",xx),je(n,"\\",cx),je(n,"",CW);const s=In(n,Dr,vI,{[Hw]:!0});In(s,Dr,s);const o=In(s,Lr,bW,{[Kp]:!0}),r=In(s,bp,vW,{[Rp]:!0}),a=In(n,Lr,Rr,{[Ww]:!0});In(a,Dr,o),In(a,Lr,a),In(o,Dr,o),In(o,Lr,o);const l=In(n,bp,Kw,{[Uw]:!0});In(l,Lr),In(l,Dr,r),In(l,bp,l),In(r,Dr,r),In(r,Lr),In(r,bp,r);const d=je(n,v2,CI,{[x2]:!0}),u=je(n,PE,Xw,{[x2]:!0}),h=In(n,b2,Xw,{[x2]:!0});je(n,C2,h),je(u,v2,d),je(u,C2,h),In(u,b2,h),je(h,PE),je(h,v2),In(h,b2,h),je(h,C2,h);const p=In(n,y2,wW,{[yW]:!0});je(p,"#"),In(p,y2,p),je(p,fTe,p);const f=je(p,mTe);je(f,"#"),In(f,y2,p);const m=[[Lr,a],[Dr,o]],g=[[Lr,null],[bp,l],[Dr,r]];for(let x=0;x<r0.length;x++)ba(n,r0[x],Zw,Rr,m);for(let x=0;x<a0.length;x++)ba(n,a0[x],Yw,Kw,g);Kl(Zw,{tld:!0,ascii:!0},t),Kl(Yw,{utld:!0,alpha:!0},t),ba(n,"file",V0,Rr,m),ba(n,"mailto",V0,Rr,m),ba(n,"http",pd,Rr,m),ba(n,"https",pd,Rr,m),ba(n,"ftp",pd,Rr,m),ba(n,"ftps",pd,Rr,m),Kl(V0,{scheme:!0,ascii:!0},t),Kl(pd,{slashscheme:!0,ascii:!0},t),e=e.sort((x,b)=>x[0]>b[0]?1:-1);for(let x=0;x<e.length;x++){const b=e[x][0],y=e[x][1]?{[dTe]:!0}:{[uTe]:!0};b.indexOf("-")>=0?y[qw]=!0:Lr.test(b)?Dr.test(b)?y[Kp]=!0:y[Ww]=!0:y[Hw]=!0,EE(n,b,b,y)}return EE(n,"localhost",Pf,{ascii:!0}),n.jd=new vi(yx),{start:n,tokens:hc({groups:t},SW)}}function kW(e,t){const n=xTe(t.replace(/[A-Z]/g,l=>l.toLowerCase())),s=n.length,o=[];let r=0,a=0;for(;a<s;){let l=e,d=null,u=0,h=null,p=-1,f=-1;for(;a<s&&(d=l.go(n[a]));)l=d,l.accepts()?(p=0,f=0,h=l):p>=0&&(p+=n[a].length,f++),u+=n[a].length,r+=n[a].length,a++;r-=p,a-=f,u-=p,o.push({t:h.t,v:t.slice(r-u,r),s:r-u,e:r})}return o}function xTe(e){const t=[],n=e.length;let s=0;for(;s<n;){let o=e.charCodeAt(s),r,a=o<55296||o>56319||s+1===n||(r=e.charCodeAt(s+1))<56320||r>57343?e[s]:e.slice(s,s+2);t.push(a),s+=a.length}return t}function ba(e,t,n,s,o){let r;const a=t.length;for(let l=0;l<a-1;l++){const d=t[l];e.j[d]?r=e.j[d]:(r=new vi(s),r.jr=o.slice(),e.j[d]=r),e=r}return r=new vi(n),r.jr=o.slice(),e.j[t[a-1]]=r,r}function LE(e){const t=[],n=[];let s=0,o="0123456789";for(;s<e.length;){let r=0;for(;o.indexOf(e[s+r])>=0;)r++;if(r>0){t.push(n.join(""));for(let a=parseInt(e.substring(s,s+r),10);a>0;a--)n.pop();s+=r}else n.push(e[s]),s++}return t}const du={defaultProtocol:"http",events:null,format:DE,formatHref:DE,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function xb(e,t=null){let n=hc({},du);e&&(n=hc(n,e instanceof xb?e.o:e));const s=n.ignoreTags,o=[];for(let r=0;r<s.length;r++)o.push(s[r].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=o}xb.prototype={o:du,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const s=t!=null;let o=this.o[e];return o&&(typeof o=="object"?(o=n.t in o?o[n.t]:du[e],typeof o=="function"&&s&&(o=o(t,n))):typeof o=="function"&&s&&(o=o(t,n.t,n)),o)},getObj(e,t,n){let s=this.o[e];return typeof s=="function"&&t!=null&&(s=s(t,n.t,n)),s},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}};function DE(e){return e}var jW=Object.freeze({__proto__:null,defaults:du,Options:xb,assign:hc});function _W(e,t){this.t="token",this.v=e,this.tk=t}_W.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),s=e.get("format",t,this);return n&&s.length>n?s.substring(0,n)+"":s},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=du.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),s=e.get("formatHref",n,this),o=e.get("tagName",n,t),r=this.toFormattedString(e),a={},l=e.get("className",n,t),d=e.get("target",n,t),u=e.get("rel",n,t),h=e.getObj("attributes",n,t),p=e.getObj("events",n,t);return a.href=s,l&&(a.class=l),d&&(a.target=d),u&&(a.rel=u),h&&hc(a,h),{tagName:o,attributes:a,content:r,eventListeners:p}}};function yb(e,t){class n extends _W{constructor(o,r){super(o,r),this.t=e}}for(const s in t)n.prototype[s]=t[s];return n.t=e,n}const RE=yb("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),OE=yb("text"),yTe=yb("nl"),l0=yb("url",{isLink:!0,toHref(e=du.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==Pf&&e[1].t===La}}),Ui=e=>new vi(e);function bTe({groups:e}){const t=e.domain.concat([ax,lx,Ia,cx,dx,ux,hx,px,Zi,vI,Xp,fx,mx,gx,Uo,yx,Jp,xx]),n=[La,SI,Wo,kI,Xp,Qp,jI,_I,X1,Q1,Zp,Yp,K1,q1,Z1,Y1,J1,ex,tx,nx,sx,ix,ox,rx],s=[ax,wI,lx,cx,dx,ux,hx,px,Zi,Zp,Yp,Xp,fx,mx,gx,Qp,Uo,yx,Jp,xx],o=Ui(),r=je(o,Jp);yt(r,s,r),yt(r,e.domain,r);const a=Ui(),l=Ui(),d=Ui();yt(o,e.domain,a),yt(o,e.scheme,l),yt(o,e.slashscheme,d),yt(a,s,r),yt(a,e.domain,a);const u=je(a,Ia);je(r,Ia,u),je(l,Ia,u),je(d,Ia,u);const h=je(r,Wo);yt(h,s,r),yt(h,e.domain,r);const p=Ui();yt(u,e.domain,p),yt(p,e.domain,p);const f=je(p,Wo);yt(f,e.domain,p);const m=Ui(RE);yt(f,e.tld,m),yt(f,e.utld,m),je(u,Pf,m);const g=je(p,Zi);je(g,Zi,g),yt(g,e.domain,p),yt(m,e.domain,p),je(m,Wo,f),je(m,Zi,g);const x=je(m,La);yt(x,e.numeric,RE);const b=je(a,Zi),C=je(a,Wo);je(b,Zi,b),yt(b,e.domain,a),yt(C,s,r),yt(C,e.domain,a);const y=Ui(l0);yt(C,e.tld,y),yt(C,e.utld,y),yt(y,e.domain,a),yt(y,s,r),je(y,Wo,C),je(y,Zi,b),je(y,Ia,u);const v=je(y,La),w=Ui(l0);yt(v,e.numeric,w);const k=Ui(l0),S=Ui();yt(k,t,k),yt(k,n,S),yt(S,t,k),yt(S,n,S),je(y,Uo,k),je(w,Uo,k);const P=je(l,La),E=je(d,La),L=je(E,Uo),I=je(L,Uo);yt(l,e.domain,a),je(l,Wo,C),je(l,Zi,b),yt(d,e.domain,a),je(d,Wo,C),je(d,Zi,b),yt(P,e.domain,k),je(P,Uo,k),je(P,Qp,k),yt(I,e.domain,k),yt(I,t,k),je(I,Uo,k);const O=[[Zp,Yp],[q1,K1],[Z1,Y1],[X1,Q1],[J1,ex],[tx,nx],[sx,ix],[ox,rx]];for(let N=0;N<O.length;N++){const[_,R]=O[N],D=je(k,_);je(S,_,D),je(D,R,k);const B=Ui(l0);yt(D,t,B);const V=Ui();yt(D,n),yt(B,t,B),yt(B,n,V),yt(V,t,B),yt(V,n,V),je(B,R,k),je(V,R,k)}return je(o,Pf,y),je(o,CI,yTe),{start:o,tokens:SW}}function vTe(e,t,n){let s=n.length,o=0,r=[],a=[];for(;o<s;){let l=e,d=null,u=null,h=0,p=null,f=-1;for(;o<s&&!(d=l.go(n[o].t));)a.push(n[o++]);for(;o<s&&(u=d||l.go(n[o].t));)d=null,l=u,l.accepts()?(f=0,p=l):f>=0&&f++,o++,h++;if(f<0)o-=h,o<s&&(a.push(n[o]),o++);else{a.length>0&&(r.push(w2(OE,t,a)),a=[]),o-=f,h-=f;const m=p.t,g=n.slice(o-h,o);r.push(w2(m,t,g))}}return a.length>0&&r.push(w2(OE,t,a)),r}function w2(e,t,n){const s=n[0].s,o=n[n.length-1].e,r=t.slice(s,o);return new e(r,n)}const _s={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function CTe(){_s.scanner=gTe(_s.customSchemes);for(let e=0;e<_s.tokenQueue.length;e++)_s.tokenQueue[e][1]({scanner:_s.scanner});_s.parser=bTe(_s.scanner.tokens);for(let e=0;e<_s.pluginQueue.length;e++)_s.pluginQueue[e][1]({scanner:_s.scanner,parser:_s.parser});return _s.initialized=!0,_s}function IW(e){return _s.initialized||CTe(),vTe(_s.parser.start,e,kW(_s.scanner.start,e))}IW.scan=kW;function wTe(e,t,n){const s=IW(e),o=[];for(let r=0;r<s.length;r++){const a=s[r];if(a.t==="nl"&&t.get("nl2br")){const l=`__linkify-el-${n.elementId++}`;o.push(c.createElement("br",{key:l}))}else if(!a.isLink||!t.check(a))o.push(a.toString());else{let l=t.render(a);if(!("key"in l.props)){const d=`__linkify-el-${n.elementId++}`,u=jW.assign({key:d},l.props);l=c.cloneElement(l,u)}o.push(l)}}return o}function TW(e,t,n){if(c.Children.count(e.props.children)===0)return e;const s=[];c.Children.forEach(e.props.children,a=>{typeof a=="string"?s.push.apply(s,wTe(a,t,n)):c.isValidElement(a)?typeof a.type=="string"&&t.ignoreTags.indexOf(a.type.toUpperCase())>=0?s.push(a):s.push(TW(a,t,n)):s.push(a)});const o=`__linkify-el-${n.elementId++}`,r=jW.assign({key:o},e.props);return c.cloneElement(e,r,s)}const rg=e=>{let t=0;const n=({tagName:d,attributes:u,content:h})=>(u.key=`__linkify-lnk-${t++}`,u.class&&(u.className=u.class,delete u.class),c.createElement(d,u,h)),s={key:"__linkify-wrapper"};for(const d in e)d!=="options"&&d!=="as"&&d!=="tagName"&&d!=="children"&&(s[d]=e[d]);const o=new xb(e.options,n),r=e.as||e.tagName||c.Fragment||"span",a=e.children,l=c.createElement(r,s,a);return TW(l,o,{elementId:0})},STe={fontWeight:"bold",fontSize:"2xl",whiteSpace:"pre-wrap",'&[data-is-empty="true"]':{opacity:.3},...ig},II=c.memo(({content:e,...t})=>{const{t:n}=M();return i.jsx(W,{sx:STe,"data-is-empty":e==="",...t,children:i.jsx(rg,{options:og,children:e||n("workflows.builder.headingPlaceholder")})})});II.displayName="HeadingElementContent";const AW=c.memo(({el:e})=>{const{t}=M(),n=G(),{id:s,data:o}=e,{content:r}=o,a=c.useRef(null),l=c.useCallback(u=>{n(vse({id:s,changes:{content:u}}))},[n,s]),d=fa({value:r,defaultValue:"",onChange:l,inputRef:a});return d.isEditing?i.jsx(bI,{ref:a,placeholder:t("workflows.builder.headingPlaceholder"),...d.inputProps,variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:1,px:2,fontWeight:"bold",fontSize:"2xl",_focusVisible:{borderRadius:"base",h:"unset"}}):i.jsx(II,{content:d.value,onDoubleClick:d.startEditing})});AW.displayName="HeadingElementContentEditable";const kTe={position:"relative",borderRadius:"base",minW:32,'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 0 0"},flexDir:"column"},MW=c.memo(({el:e})=>{const t=c.useRef(null),n=c.useRef(null),[s,o]=Jm(e.id,t,n),r=Oo(),{id:a}=e;return i.jsxs(T,{ref:t,id:a,className:FL,sx:kTe,"data-parent-layout":r.layout,children:[i.jsx(sh,{dragHandleRef:n,element:e,"data-is-dragging":o}),i.jsx(th,{"data-is-dragging":o,p:4,children:i.jsx(AW,{el:e})}),i.jsx(eg,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});MW.displayName="HeadingElementEditMode";const jTe={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},EW=c.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n,o=Oo();return i.jsx(T,{id:t,className:FL,sx:jTe,"data-parent-layout":o.layout,children:i.jsx(II,{content:s})})});EW.displayName="HeadingElementViewMode";const PW=c.memo(({id:e})=>{const t=ih(e),n=A(kr);return!t||!BL(t)?null:n==="view"?i.jsx(EW,{el:t}):i.jsx(MW,{el:t})});PW.displayName="HeadingElement";const Qw=c.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:o}=e,{defaultValue:r,onChange:a,min:l,max:d,step:u,fineStep:h}=tg(t,n.name,s,o);return i.jsx(_e,{defaultValue:r,onChange:a,value:n.value,min:l,max:d,step:u,fineStep:h,className:tt,flex:"1 1 0"})});Qw.displayName="FloatFieldInput ";const LW=c.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:o}=e,{defaultValue:r,onChange:a,min:l,max:d,step:u,fineStep:h}=tg(t,n.name,s,o);return i.jsxs(i.Fragment,{children:[i.jsx(Ze,{defaultValue:r,onChange:a,value:n.value,min:l,max:d,step:u,fineStep:h,className:tt,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),i.jsx(_e,{defaultValue:r,onChange:a,value:n.value,min:l,max:d,step:u,fineStep:h,className:tt,flex:"1 1 0"})]})});LW.displayName="FloatFieldInputAndSlider ";const DW=c.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:o}=e,{defaultValue:r,onChange:a,min:l,max:d,step:u,fineStep:h}=tg(t,n.name,s,o);return i.jsx(Ze,{defaultValue:r,onChange:a,value:n.value,min:l,max:d,step:u,fineStep:h,className:tt,marks:!0,withThumbTooltip:!0,flex:"1 1 0"})});DW.displayName="FloatFieldSlider ";const en=c.memo,_Te=({value:e,modelConfigs:t,isLoadingConfigs:n,onChange:s,required:o,groupByType:r})=>{const{options:a,value:l,onChange:d,placeholder:u,noOptionsMessage:h}=ma({modelConfigs:t,onChange:s,isLoading:n,selectedModel:e,groupByType:r});return i.jsx(Q,{className:`${Gt} ${tt}`,isDisabled:!a.length,isInvalid:!l&&o,gap:2,children:i.jsx(Ke,{value:l,placeholder:o?u:`(Optional) ${u}`,options:a,onChange:d,noOptionsMessage:h})})},bn=en(_Te),ITe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=pme(),a=c.useCallback(l=>{l&&s(Cse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},TTe=c.memo(ITe),RW=(e,t=300)=>{const n=cn(),[s,o]=c.useState(()=>e(n.getState()));return c.useEffect(()=>{let r=e(n.getState()),a=null;const l=n.subscribe(()=>{const d=e(n.getState());d!==r&&(a!==null&&window.clearTimeout(a),a=window.setTimeout(()=>{o(d),r=d},t))});return()=>{l(),a!==null&&window.clearTimeout(a)}},[t,e,n]),s},ag=(e,t)=>{const n=re(ln),s=c.useMemo(()=>he(Xe,r=>{const a=ju(r,e);if(!a)return!1;const l=uk(r,e,t),d=n[a.data.type];ve(d,`Template for input node type ${a.data.type} not found.`);const u=d.inputs[t];return ve(u,`Template for input field ${t} not found.`),Ek(a,d,l,u,r).length>0}),[e,t,n]);return RW(s)},ATe=fo({}).options,MTe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},OW=c.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,o=cn(),{t:r}=M(),a=ag(t,n.name),l=c.useCallback(x=>{o.dispatch(wse({nodeId:t,fieldName:n.name,value:x}))},[n.name,t,o]),d=c.useCallback(x=>{const b=n.value?[...n.value]:[];b.splice(x,1),l(b)},[n.value,l]),u=c.useCallback((x,b)=>{const C=n.value?[...n.value]:[];C[x]=b,l(C)},[n.value,l]),h=c.useCallback(()=>{const x=n.value?[...n.value,0]:[0];l(x)},[n.value,l]),p=c.useMemo(()=>{let x=-4294967295;return He(s.minimum)||(x=s.minimum),He(s.exclusiveMinimum)||(x=s.exclusiveMinimum+.01),x},[s.exclusiveMinimum,s.minimum]),f=c.useMemo(()=>{let x=_u;return He(s.maximum)||(x=s.maximum),He(s.exclusiveMaximum)||(x=s.exclusiveMaximum-.01),x},[s.exclusiveMaximum,s.maximum]),m=c.useMemo(()=>He(s.multipleOf)?.1:s.multipleOf,[s.multipleOf]),g=c.useMemo(()=>He(s.multipleOf)?.01:s.multipleOf,[s.multipleOf]);return i.jsxs(T,{className:tt,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:MTe,"data-error":a,borderRadius:"base",flexDir:"column",gap:1,children:[i.jsx(de,{onClick:h,variant:"ghost",children:r("nodes.addItem")}),n.value&&n.value.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Ct,{}),i.jsx(vs,{className:Gt,defer:!0,style:Ir,options:ATe,children:i.jsx(Mi,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((x,b)=>i.jsx(NW,{value:x,index:b,min:p,max:f,step:m,fineStep:g,onRemoveNumber:d,onChangeNumber:u},b))})})]})]})});OW.displayName="FloatFieldCollectionInputComponent";const NW=c.memo(({value:e,index:t,min:n,max:s,step:o,fineStep:r,onRemoveNumber:a,onChangeNumber:l})=>{const{t:d}=M(),u=c.useCallback(()=>{a(t)},[t,a]),h=c.useCallback(p=>{l(t,p)},[t,l]);return i.jsxs(i.Fragment,{children:[i.jsx(vt,{children:i.jsxs(J,{ps:1,m:0,children:[t+1,"."]})}),i.jsx(vt,{children:i.jsx(_e,{onChange:h,value:e,min:n,max:s,step:o,fineStep:r,className:tt,flexGrow:1})}),i.jsx(vt,{children:i.jsx(le,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:u,icon:i.jsx(Rt,{}),"aria-label":d("common.delete")})})]})});NW.displayName="FloatListItemContent";const FW=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(a=>{t({...e,start:a})},[t,e]),o=c.useCallback(a=>{t({...e,step:a})},[t,e]),r=c.useCallback(a=>{t({...e,count:a})},[t,e]);return i.jsxs(T,{gap:2,alignItems:"flex-end",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.start")}),i.jsx(_e,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.step")}),i.jsx(_e,{value:e.step,onChange:o,min:-1/0,max:1/0,step:.01})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.count")}),i.jsx(_e,{value:e.count,onChange:r,min:1,max:1/0})]})]})});FW.displayName="FloatGeneratorArithmeticSequenceSettings";const BW=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(a=>{t({...e,start:a})},[t,e]),o=c.useCallback(a=>{t({...e,end:a})},[t,e]),r=c.useCallback(a=>{t({...e,count:a})},[t,e]);return i.jsxs(T,{gap:2,alignItems:"flex-end",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.start")}),i.jsx(_e,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.end")}),i.jsx(_e,{value:e.end,onChange:o,min:-1/0,max:1/0,step:.01})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.count")}),i.jsx(_e,{value:e.count,onChange:r,min:1,max:1/0})]})]})});BW.displayName="FloatGeneratorLinearDistributionSettings";const ETe=1024*128,oh=c.memo(({value:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(l=>{const d=l[0];if(!d)return;const u=new FileReader;u.onload=()=>{const h=u.result;sf(h)&&t(h)},u.onerror=()=>{ge({title:"Failed to load file",status:"error"})},u.readAsText(d)},[t]),{getInputProps:o,getRootProps:r}=da({accept:{"text/csv":[".csv"],"text/plain":[".txt"]},maxSize:ETe,onDropAccepted:s,noDrag:!0,multiple:!1}),a=c.useCallback(l=>{t(l.target.value)},[t]);return i.jsxs(Q,{orientation:"vertical",position:"relative",alignItems:"stretch",children:[i.jsxs(J,{m:0,display:"flex",alignItems:"center",children:[n("common.input"),i.jsx(Je,{}),i.jsx(le,{tooltip:n("nodes.generatorLoadFromFile"),"aria-label":n("nodes.generatorLoadFromFile"),icon:i.jsx(jfe,{}),variant:"link",...r()}),i.jsx("input",{...o()})]}),i.jsx(ls,{className:`${tt} ${co} ${Gt}`,value:e,onChange:a,p:2,resize:"none",rows:5,fontSize:"sm"})]})});oh.displayName="GeneratorTextareaWithFileUpload";const $W=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(r=>{t({...e,splitOn:r.target.value})},[t,e]),o=c.useCallback(r=>{t({...e,input:r})},[t,e]);return i.jsxs(T,{gap:2,flexDir:"column",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("nodes.splitOn")}),i.jsx(St,{value:e.splitOn,onChange:s})]}),i.jsx(oh,{value:e.input,onChange:o})]})});$W.displayName="FloatGeneratorParseStringSettings";const VW=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(d=>{t({...e,min:d})},[t,e]),o=c.useCallback(d=>{t({...e,max:d})},[t,e]),r=c.useCallback(d=>{t({...e,count:d})},[t,e]),a=c.useCallback(()=>{t({...e,seed:He(e.seed)?0:null})},[t,e]),l=c.useCallback(d=>{t({...e,seed:d})},[t,e]);return i.jsx(T,{gap:2,flexDir:"column",children:i.jsxs(T,{gap:2,alignItems:"flex-end",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.min")}),i.jsx(_e,{value:e.min,onChange:s,min:-1/0,max:1/0,step:.01})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.max")}),i.jsx(_e,{value:e.max,onChange:o,min:-1/0,max:1/0,step:.01})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.count")}),i.jsx(_e,{value:e.count,onChange:r,min:1,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsxs(J,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),i.jsx(_n,{onChange:a,isChecked:!He(e.seed)})]}),i.jsx(_e,{isDisabled:He(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0})]})]})})});VW.displayName="FloatGeneratorUniformRandomDistributionSettings";const PTe=fo({}).options,zW=c.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),o=G(),r=c.useCallback(u=>{o(U4({nodeId:t,fieldName:n.name,value:u}))},[o,n.name,t]),a=c.useCallback(u=>{const h=Sse(u.target.value);h&&o(U4({nodeId:t,fieldName:n.name,value:h}))},[o,n.name,t]),[l]=ml(n,300),d=c.useMemo(()=>{if(l.value.type===Zb&&He(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const u=w8(l);return u.length===0?`<${s("nodes.generatorNoValues")}>`:u.map(h=>Uf(h,2)).join(", ")},[l,s]);return i.jsxs(T,{flexDir:"column",gap:2,flexGrow:1,children:[i.jsxs(lo,{className:`${Gt} ${tt}`,onChange:a,value:n.value.type,size:"sm",children:[i.jsx("option",{value:q4,children:s("nodes.arithmeticSequence")}),i.jsx("option",{value:K4,children:s("nodes.linearDistribution")}),i.jsx("option",{value:Zb,children:s("nodes.uniformRandomDistribution")}),i.jsx("option",{value:Z4,children:s("nodes.parseString")})]}),n.value.type===q4&&i.jsx(FW,{state:n.value,onChange:r}),n.value.type===K4&&i.jsx(BW,{state:n.value,onChange:r}),n.value.type===Zb&&i.jsx(VW,{state:n.value,onChange:r}),n.value.type===Z4&&i.jsx($W,{state:n.value,onChange:r}),i.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:i.jsx(T,{w:"full",h:"auto",children:i.jsx(vs,{className:`${Gt} ${tt}`,defer:!0,style:Ir,options:PTe,children:i.jsx(W,{className:`${Gt} ${tt}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:d})})})})]})});zW.displayName="FloatGeneratorFieldInputComponent";const LTe=fo({}).options,DTe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},GW=c.memo(e=>{const{t}=M(),{nodeId:n,field:s}=e,o=cn(),r=ag(n,s.name),a=c.useMemo(()=>kw.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}}),[s,n]),l=c.useCallback(u=>{o.dispatch(Q2({nodeId:n,fieldName:s.name,value:u}))},[o,n,s.name]),d=c.useCallback(u=>{const h=s.value?[...s.value]:[];h.splice(u,1),o.dispatch(Q2({nodeId:n,fieldName:s.name,value:h}))},[s.name,s.value,n,o]);return i.jsxs(T,{className:tt,position:"relative",w:"full",h:"full",minH:16,maxH:64,alignItems:"stretch",justifyContent:"center",children:[(!s.value||s.value.length===0)&&i.jsx(iIe,{w:"full",h:"auto",isError:r,onUpload:l,fontSize:24}),s.value&&s.value.length>0&&i.jsx(Ce,{w:"full",h:"auto",p:1,sx:DTe,"data-error":r,borderRadius:"base",children:i.jsx(vs,{className:Gt,defer:!0,style:Ir,options:LTe,children:i.jsx(Mi,{w:"full",h:"full",templateColumns:"repeat(4, 1fr)",gap:1,children:s.value.map((u,h)=>i.jsx(vt,{position:"relative",className:tt,children:i.jsx(HW,{value:u,index:h,onRemoveImage:d})},h))})})}),i.jsx(Ls,{dndTarget:kw,dndTargetData:a,label:t("gallery.drop")})]})});GW.displayName="ImageFieldCollectionInputComponent";const HW=c.memo(({value:e,index:t,onRemoveImage:n})=>{const s=ul(e.image_name),o=c.useCallback(()=>{n(t)},[t,n]);return s.isLoading?i.jsx(Ny,{}):s.data?i.jsxs(i.Fragment,{children:[i.jsx(vl,{imageDTO:s.data,asThumbnail:!0,objectFit:"contain",w:"full",h:"full",aspectRatio:"1/1",backgroundSize:8,backgroundImage:Wu}),i.jsx(oa,{onClick:o,icon:i.jsx(Rt,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]}):i.jsxs(i.Fragment,{children:[i.jsx(Ot,{icon:I7}),i.jsx(oa,{onClick:o,icon:i.jsx(Rt,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]})});HW.displayName="ImageGridItemContent";const WW=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(r=>{t({...e,category:r})},[t,e]),o=c.useCallback(r=>{t({...e,board_id:r})},[t,e]);return i.jsxs(T,{gap:2,flexDir:"column",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.board")}),i.jsx(OTe,{board_id:e.board_id,onChange:o})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("nodes.generatorImagesCategory")}),i.jsx(NTe,{category:e.category,onChange:s})]})]})});WW.displayName="ImageGeneratorImagesFromBoardSettings";const RTe={include_archived:!1},OTe=({board_id:e,onChange:t})=>{const{t:n}=M(),s=vc(RTe),o=c.useMemo(()=>s.data?s.data.map(d=>({label:d.board_name,value:d.board_id})):Fs,[s.data]),r=c.useCallback(d=>{d&&t(d.value)},[t]),a=c.useMemo(()=>o.find(d=>d.value===e)??null,[e,o]),l=c.useCallback(()=>n("boards.noMatching"),[n]);return i.jsx(Ke,{className:`${Gt} ${tt}`,value:a,options:o,onChange:r,placeholder:n("boards.selectBoard"),noOptionsMessage:l})},NTe=({category:e,onChange:t})=>{const{t:n}=M(),s=c.useMemo(()=>[{label:n("gallery.images"),value:"images"},{label:n("gallery.assets"),value:"assets"}],[n]),o=c.useCallback(l=>{!l||l.value!=="images"&&l.value!=="assets"||t(l.value)},[t]),r=c.useMemo(()=>s.find(l=>l.value===e),[s,e]),a=c.useCallback(()=>n("boards.noMatching"),[n]);return i.jsx(Ke,{className:`${Gt} ${tt}`,value:r,options:s,onChange:o,placeholder:n("boards.selectBoard"),noOptionsMessage:a})},FTe=fo({}).options,UW=c.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),o=G(),r=c.useCallback(h=>{o(Y4({nodeId:t,fieldName:n.name,value:h}))},[o,n.name,t]),a=c.useCallback(h=>{const p=kse(h.target.value);o(Y4({nodeId:t,fieldName:n.name,value:p}))},[o,n.name,t]),[l,d]=c.useState(null),u=c.useMemo(()=>Di(async h=>{const p=await y8(h,o);p.length===0?d(`<${s("nodes.generatorNoValues")}>`):d(`<${s("nodes.generatorImages",{count:p.length})}>`)},300),[o,s]);return c.useEffect(()=>{u(n)},[n,u]),i.jsxs(T,{flexDir:"column",gap:2,flexGrow:1,children:[i.jsx(lo,{className:`${Gt} ${tt}`,onChange:a,value:n.value.type,size:"sm",children:i.jsx("option",{value:X4,children:s("nodes.generatorImagesFromBoard")})}),n.value.type===X4&&i.jsx(WW,{state:n.value,onChange:r}),i.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:i.jsx(T,{w:"full",h:"auto",children:i.jsx(vs,{className:`${Gt} ${tt}`,defer:!0,style:Ir,options:FTe,children:i.jsx(W,{className:`${Gt} ${tt}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:l})})})})]})});UW.displayName="ImageGeneratorFieldInputComponent";const BTe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=ume(),a=c.useCallback(l=>{l&&s(jse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},$Te=c.memo(BTe),VTe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=hme(),a=c.useCallback(l=>{l&&s(_se({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},zTe=c.memo(VTe),GTe=fo({}).options,HTe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},qW=c.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,o=cn(),{t:r}=M(),a=ag(t,n.name),l=c.useCallback(x=>{o.dispatch(Ise({nodeId:t,fieldName:n.name,value:x}))},[n.name,t,o]),d=c.useCallback(x=>{const b=n.value?[...n.value]:[];b.splice(x,1),l(b)},[n.value,l]),u=c.useCallback((x,b)=>{const C=n.value?[...n.value]:[];C[x]=b,l(C)},[n.value,l]),h=c.useCallback(()=>{const x=n.value?[...n.value,0]:[0];l(x)},[n.value,l]),p=c.useMemo(()=>{let x=-4294967295;return He(s.minimum)||(x=s.minimum),He(s.exclusiveMinimum)||(x=s.exclusiveMinimum+.01),x},[s.exclusiveMinimum,s.minimum]),f=c.useMemo(()=>{let x=_u;return He(s.maximum)||(x=s.maximum),He(s.exclusiveMaximum)||(x=s.exclusiveMaximum-.01),x},[s.exclusiveMaximum,s.maximum]),m=c.useMemo(()=>He(s.multipleOf)?1:s.multipleOf,[s.multipleOf]),g=c.useMemo(()=>He(s.multipleOf)?1:s.multipleOf,[s.multipleOf]);return i.jsxs(T,{className:tt,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:HTe,"data-error":a,borderRadius:"base",flexDir:"column",gap:1,children:[i.jsx(de,{onClick:h,variant:"ghost",children:r("nodes.addItem")}),n.value&&n.value.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Ct,{}),i.jsx(vs,{className:Gt,defer:!0,style:Ir,options:GTe,children:i.jsx(Mi,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((x,b)=>i.jsx(KW,{value:x,index:b,min:p,max:f,step:m,fineStep:g,onRemoveNumber:d,onChangeNumber:u},b))})})]})]})});qW.displayName="IntegerFieldCollectionInputComponent";const KW=c.memo(({value:e,index:t,min:n,max:s,step:o,fineStep:r,onRemoveNumber:a,onChangeNumber:l})=>{const{t:d}=M(),u=c.useCallback(()=>{a(t)},[t,a]),h=c.useCallback(p=>{l(t,Math.floor(p))},[t,l]);return i.jsxs(i.Fragment,{children:[i.jsx(vt,{children:i.jsxs(J,{ps:1,m:0,children:[t+1,"."]})}),i.jsx(vt,{children:i.jsx(_e,{onChange:h,value:e,min:n,max:s,step:o,fineStep:r,className:tt,flexGrow:1})}),i.jsx(vt,{children:i.jsx(le,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:u,icon:i.jsx(Rt,{}),"aria-label":d("common.delete")})})]})});KW.displayName="IntegerListItemContent";const ZW=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(a=>{t({...e,start:a})},[t,e]),o=c.useCallback(a=>{t({...e,step:a})},[t,e]),r=c.useCallback(a=>{t({...e,count:a})},[t,e]);return i.jsxs(T,{gap:2,alignItems:"flex-end",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.start")}),i.jsx(_e,{value:e.start,onChange:s,min:-1/0,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.step")}),i.jsx(_e,{value:e.step,onChange:o,min:-1/0,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.count")}),i.jsx(_e,{value:e.count,onChange:r,min:1,max:1/0})]})]})});ZW.displayName="IntegerGeneratorArithmeticSequenceSettings";const YW=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(a=>{t({...e,start:a})},[t,e]),o=c.useCallback(a=>{t({...e,end:a})},[t,e]),r=c.useCallback(a=>{t({...e,count:a})},[t,e]);return i.jsxs(T,{gap:2,alignItems:"flex-end",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.start")}),i.jsx(_e,{value:e.start,onChange:s,min:-1/0,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.end")}),i.jsx(_e,{value:e.end,onChange:o,min:-1/0,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.count")}),i.jsx(_e,{value:e.count,onChange:r,min:1,max:1/0})]})]})});YW.displayName="IntegerGeneratorLinearDistributionSettings";const XW=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(r=>{t({...e,splitOn:r.target.value})},[t,e]),o=c.useCallback(r=>{t({...e,input:r})},[t,e]);return i.jsxs(T,{gap:2,flexDir:"column",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("nodes.splitOn")}),i.jsx(St,{value:e.splitOn,onChange:s})]}),i.jsx(oh,{value:e.input,onChange:o})]})});XW.displayName="IntegerGeneratorParseStringSettings";const QW=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(d=>{t({...e,min:d})},[t,e]),o=c.useCallback(d=>{t({...e,max:d})},[t,e]),r=c.useCallback(d=>{t({...e,count:d})},[t,e]),a=c.useCallback(()=>{t({...e,seed:He(e.seed)?0:null})},[t,e]),l=c.useCallback(d=>{t({...e,seed:d})},[t,e]);return i.jsx(T,{gap:2,flexDir:"column",children:i.jsxs(T,{gap:2,alignItems:"flex-end",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.min")}),i.jsx(_e,{value:e.min,onChange:s,min:-1/0,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.max")}),i.jsx(_e,{value:e.max,onChange:o,min:-1/0,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.count")}),i.jsx(_e,{value:e.count,onChange:r,min:1,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsxs(J,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),i.jsx(_n,{onChange:a,isChecked:!He(e.seed)})]}),i.jsx(_e,{isDisabled:He(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0})]})]})})});QW.displayName="IntegerGeneratorUniformRandomDistributionSettings";const WTe=fo({}).options,JW=c.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),o=G(),r=c.useCallback(u=>{o(Q4({nodeId:t,fieldName:n.name,value:u}))},[o,n.name,t]),a=c.useCallback(u=>{const h=Tse(u.target.value);o(Q4({nodeId:t,fieldName:n.name,value:h}))},[o,n.name,t]),[l]=ml(n,300),d=c.useMemo(()=>{if(l.value.type===Yb&&He(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const u=k8(l);return u.length===0?`<${s("nodes.generatorNoValues")}>`:u.map(h=>Uf(h,2)).join(", ")},[l,s]);return i.jsxs(T,{flexDir:"column",gap:2,flexGrow:1,children:[i.jsxs(lo,{className:`${Gt} ${tt}`,onChange:a,value:n.value.type,size:"sm",children:[i.jsx("option",{value:J4,children:s("nodes.arithmeticSequence")}),i.jsx("option",{value:e5,children:s("nodes.linearDistribution")}),i.jsx("option",{value:Yb,children:s("nodes.uniformRandomDistribution")}),i.jsx("option",{value:t5,children:s("nodes.parseString")})]}),n.value.type===J4&&i.jsx(ZW,{state:n.value,onChange:r}),n.value.type===e5&&i.jsx(YW,{state:n.value,onChange:r}),n.value.type===Yb&&i.jsx(QW,{state:n.value,onChange:r}),n.value.type===t5&&i.jsx(XW,{state:n.value,onChange:r}),i.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:i.jsx(T,{w:"full",h:"auto",children:i.jsx(vs,{className:`${Gt} ${tt}`,defer:!0,style:Ir,options:WTe,children:i.jsx(W,{className:`${Gt} ${tt}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:d})})})})]})});JW.displayName="IntegerGeneratorFieldInputComponent";const UTe=e=>{const{nodeId:t,field:n}=e,s=G(),{data:o,isLoading:r}=gu(),a=c.useCallback(d=>{d&&s(Ase({nodeId:t,fieldName:n.name,value:d}))},[s,n.name,t]),l=c.useMemo(()=>o?aa.selectAll(o):Fs,[o]);return i.jsx(bn,{value:n.value,modelConfigs:l,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required,groupByType:!0})},qTe=c.memo(UTe),KTe=fo({}).options,ZTe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},eU=c.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),o=cn(),r=ag(t,n.name),a=c.useCallback(u=>{const h=n.value?[...n.value]:[];h.splice(u,1),o.dispatch(Xb({nodeId:t,fieldName:n.name,value:h}))},[n.name,n.value,t,o]),l=c.useCallback((u,h)=>{const p=n.value?[...n.value]:[];p[u]=h,o.dispatch(Xb({nodeId:t,fieldName:n.name,value:p}))},[n.name,n.value,t,o]),d=c.useCallback(()=>{const u=n.value?[...n.value,""]:[""];o.dispatch(Xb({nodeId:t,fieldName:n.name,value:u}))},[n.name,n.value,t,o]);return i.jsxs(T,{className:tt,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:ZTe,"data-error":r,borderRadius:"base",flexDir:"column",gap:1,children:[i.jsx(de,{onClick:d,variant:"ghost",children:s("nodes.addItem")}),n.value&&n.value.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Ct,{}),i.jsx(vs,{className:Gt,defer:!0,style:Ir,options:KTe,children:i.jsx(Mi,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((u,h)=>i.jsx(tU,{value:u,index:h,onRemoveString:a,onChangeString:l},h))})})]})]})});eU.displayName="StringFieldCollectionInputComponent";const tU=c.memo(({value:e,index:t,onRemoveString:n,onChangeString:s})=>{const{t:o}=M(),r=c.useCallback(()=>{n(t)},[t,n]),a=c.useCallback(l=>{s(t,l.target.value)},[t,s]);return i.jsxs(i.Fragment,{children:[i.jsx(vt,{children:i.jsxs(W,{variant:"subtext",textAlign:"center",minW:8,children:[t+1,"."]})}),i.jsx(vt,{children:i.jsx(St,{placeholder:o("workflows.emptyStringPlaceholder"),size:"sm",resize:"none",value:e,onChange:a})}),i.jsx(vt,{children:i.jsx(le,{tabIndex:-1,size:"sm",variant:"link",minW:8,minH:8,onClick:r,icon:i.jsx(Rt,{}),"aria-label":o("common.delete")})})]})});tU.displayName="ListItemContent";const nU=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(r=>{t({...e,input:r})},[t,e]),o=c.useCallback(r=>{t({...e,maxPrompts:r})},[t,e]);return i.jsxs(T,{gap:2,flexDir:"column",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("dynamicPrompts.maxPrompts")}),i.jsx(_e,{value:e.maxPrompts,onChange:o,min:1,max:1e3,w:"full"})]}),i.jsx(oh,{value:e.input,onChange:s})]})});nU.displayName="StringGeneratorDynamicPromptsCombinatorialSettings";const sU=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(l=>{t({...e,input:l})},[t,e]),o=c.useCallback(l=>{t({...e,count:l})},[t,e]),r=c.useCallback(()=>{t({...e,seed:He(e.seed)?0:null})},[t,e]),a=c.useCallback(l=>{t({...e,seed:l})},[t,e]);return i.jsxs(T,{gap:2,flexDir:"column",children:[i.jsxs(T,{gap:2,children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsxs(J,{alignItems:"center",justifyContent:"space-between",display:"flex",w:"full",pe:.5,children:[n("common.seed"),i.jsx(_n,{onChange:r,isChecked:!He(e.seed)})]}),i.jsx(_e,{isDisabled:He(e.seed),value:e.seed??"...",onChange:a,min:-1/0,max:1/0})]}),i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("common.count")}),i.jsx(_e,{value:e.count,onChange:o,min:1,max:1e3})]})]}),i.jsx(oh,{value:e.input,onChange:s})]})});sU.displayName="StringGeneratorDynamicPromptsRandomSettings";const iU=c.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=c.useCallback(r=>{t({...e,splitOn:r.target.value})},[t,e]),o=c.useCallback(r=>{t({...e,input:r})},[t,e]);return i.jsxs(T,{gap:2,flexDir:"column",children:[i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:n("nodes.splitOn")}),i.jsx(St,{value:e.splitOn,onChange:s})]}),i.jsx(oh,{value:e.input,onChange:o})]})});iU.displayName="StringGeneratorParseStringSettings";const YTe=fo({}).options,oU=c.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),o=G(),r=c.useCallback(h=>{o(n5({nodeId:t,fieldName:n.name,value:h}))},[o,n.name,t]),a=c.useCallback(h=>{const p=Mse(h.target.value);o(n5({nodeId:t,fieldName:n.name,value:p}))},[o,n.name,t]),[l,d]=c.useState(null),u=c.useMemo(()=>Di(async h=>{const p=await v8(h,o);p.length===0?d(`<${s("nodes.generatorNoValues")}>`):d(p.join(", "))},300),[o,s]);return c.useEffect(()=>{u(n)},[n,u]),i.jsxs(T,{flexDir:"column",gap:2,flexGrow:1,children:[i.jsxs(lo,{className:`${Gt} ${tt}`,onChange:a,value:n.value.type,size:"sm",children:[i.jsx("option",{value:s5,children:s("nodes.parseString")}),i.jsx("option",{value:i5,children:s("nodes.dynamicPromptsRandom")}),i.jsx("option",{value:o5,children:s("nodes.dynamicPromptsCombinatorial")})]}),n.value.type===s5&&i.jsx(iU,{state:n.value,onChange:r}),n.value.type===i5&&i.jsx(sU,{state:n.value,onChange:r}),n.value.type===o5&&i.jsx(nU,{state:n.value,onChange:r}),i.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:i.jsx(T,{w:"full",h:"auto",children:i.jsx(vs,{className:`${Gt} ${tt}`,defer:!0,style:Ir,options:YTe,children:i.jsx(W,{className:`${Gt} ${tt}`,fontFamily:"monospace",userSelect:"text",cursor:"text",whiteSpace:"pre",children:l})})})})]})});oU.displayName="StringGeneratorFieldInputComponent";const Jw=c.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:o}=e,{defaultValue:r,onChange:a,min:l,max:d,step:u,fineStep:h,constrainValue:p}=ng(t,n.name,s,o);return i.jsx(_e,{defaultValue:r,onChange:a,value:n.value,min:l,max:d,step:u,fineStep:h,className:tt,flex:"1 1 0",constrainValue:p})});Jw.displayName="IntegerFieldInput";const rU=c.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:o}=e,{defaultValue:r,onChange:a,min:l,max:d,step:u,fineStep:h}=ng(t,n.name,s,o);return i.jsxs(i.Fragment,{children:[i.jsx(Ze,{defaultValue:r,onChange:a,value:n.value,min:l,max:d,step:u,fineStep:h,className:tt,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),i.jsx(_e,{defaultValue:r,onChange:a,value:n.value,min:l,max:d,step:u,fineStep:h,className:tt,flex:"1 1 0"})]})});rU.displayName="IntegerFieldInputAndSlider";const aU=c.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:o}=e,{defaultValue:r,onChange:a,min:l,max:d,step:u,fineStep:h}=ng(t,n.name,s,o);return i.jsx(Ze,{defaultValue:r,onChange:a,value:n.value,min:l,max:d,step:u,fineStep:h,className:tt,marks:!0,withThumbTooltip:!0,flex:"1 1 0"})});aU.displayName="IntegerFieldSlider";const TI=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,o=G(),r=c.useCallback(a=>{o(Ese({nodeId:t,fieldName:n.name,value:a.target.value}))},[o,n.name,t]);return{value:n.value,onChange:r,defaultValue:s.default}},lU=c.memo(e=>{const{value:t,onChange:n}=TI(e);return i.jsx(lo,{onChange:n,className:`${tt} ${co} ${Gt}`,isDisabled:e.settings.options.length===0,value:t,children:e.settings.options.map((s,o)=>i.jsx("option",{value:s.value,children:s.label||s.value||`Option ${o+1}`},`${o}_${s.value}`))})});lU.displayName="StringFieldDropdown";const eS=c.memo(e=>{const{value:t,onChange:n}=TI(e),{t:s}=M();return i.jsx(St,{className:`${tt} ${co} ${Gt}`,placeholder:s("workflows.emptyStringPlaceholder"),value:t,onChange:n})});eS.displayName="StringFieldInput";const tS=c.memo(e=>{const{t}=M(),{value:n,onChange:s}=TI(e);return i.jsx(ls,{className:`${tt} ${co} ${Gt}`,placeholder:t("workflows.emptyStringPlaceholder"),value:n,onChange:s,h:"full",fontSize:"sm",p:2})});tS.displayName="StringFieldTextarea";const XTe={include_archived:!0},QTe=e=>e==="auto"||e==="none"?e:{board_id:e},JTe=e=>{const{nodeId:t,field:n}=e,s=G(),{t:o}=M(),r=vc(XTe),a=c.useMemo(()=>({label:o("common.auto"),value:"auto"}),[o]),l=c.useMemo(()=>({label:`${o("common.none")} (${o("boards.uncategorized")})`,value:"none"}),[o]),d=c.useMemo(()=>{const f=[a,l];if(r.data)for(const m of r.data)f.push({label:m.board_name,value:m.board_id});return f},[a,r.data,l]),u=c.useCallback(f=>{if(!f)return;const m=QTe(f.value);s(Pse({nodeId:t,fieldName:n.name,value:m}))},[s,n.name,t]),h=c.useMemo(()=>{const f=n.value;return!f||f==="auto"?a:f==="none"?l:d.find(g=>g.value===f.board_id)??a},[n.value,d,a,l]),p=c.useCallback(()=>o("boards.noMatching"),[o]);return i.jsx(Ke,{className:`${Gt} ${tt}`,value:h,options:d,onChange:u,placeholder:o("boards.selectBoard"),noOptionsMessage:p})},eAe=c.memo(JTe),tAe=e=>{const{nodeId:t,field:n}=e,s=G(),o=c.useCallback(r=>{s(Lse({nodeId:t,fieldName:n.name,value:r.target.checked}))},[s,n.name,t]);return i.jsx(et,{className:`${tt} ${Ac}`,onChange:o,isChecked:n.value})},nAe=c.memo(tAe),sAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=Ec(),a=c.useCallback(l=>{l&&s(Dse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},iAe=c.memo(sAe),oAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=Ec(),a=c.useCallback(l=>{l&&s(Rse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o.filter(l=>$L(l)),isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},rAe=c.memo(oAe),aAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=Ec(),a=c.useCallback(l=>{l&&s(Ose({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o.filter(l=>VL(l)),isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},lAe=c.memo(aAe),cAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=ome(),a=c.useCallback(f=>{f&&s(dm({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),{options:l,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=ma({modelConfigs:o,onChange:a,isLoading:r,selectedModel:n.value});return i.jsx(T,{w:"full",alignItems:"center",gap:2,children:i.jsx(Q,{className:`${Gt} ${tt}`,isDisabled:!l.length,isInvalid:!d&&e.fieldTemplate.required,children:i.jsx(Ke,{value:d,placeholder:h,options:l,onChange:u,noOptionsMessage:p})})})},dAe=c.memo(cAe),uAe={r:0,g:0,b:0,a:255},hAe=e=>{const{nodeId:t,field:n}=e,s=G(),o=c.useMemo(()=>{if(!n.value)return uAe;const{r:a,g:l,b:d,a:u}=n.value;return{r:a,g:l,b:d,a:u/255}},[n.value]),r=c.useCallback(a=>{typeof a=="string"&&(a=tSe(a,1));const{r:l,g:d,b:u,a:h}=a,p=Math.round(h*255);s(Nse({nodeId:t,fieldName:n.name,value:{r:l,g:d,b:u,a:p}}))},[s,n.name,t]);return i.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[i.jsx(cke,{style:{background:hr("base.700"),color:hr("base.100"),fontSize:12,paddingInlineStart:10,borderRadius:4,paddingBlock:4,outline:"none"},className:tt,color:eSe(o,!0),onChange:r,prefixed:!0,alpha:!0}),i.jsx(MV,{className:tt,color:o,onChange:r,style:{width:"100%"}})]})},pAe=c.memo(hAe),fAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=_9(),a=c.useCallback(l=>{l&&s(Fse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},mAe=c.memo(fAe),gAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=yj(),a=c.useCallback(l=>{l&&s(Bse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},xAe=c.memo(gAe),yAe=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,o=G(),r=c.useCallback(a=>{o($se({nodeId:t,fieldName:n.name,value:a.target.value}))},[o,n.name,t]);return i.jsx(lo,{className:`${Gt} ${tt}`,onChange:r,value:n.value,size:"sm",children:s.options.map(a=>i.jsx("option",{value:a,children:s.ui_choice_labels?s.ui_choice_labels[a]:a},a))})},bAe=c.memo(yAe),vAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=sme(),a=c.useCallback(l=>{l&&s(dm({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},CAe=c.memo(vAe),wAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=P9(),a=c.useCallback(l=>{l&&s(Vse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},SAe=c.memo(wAe),kAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=M9(),a=c.useCallback(l=>{l&&s(zse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},jAe=c.memo(kAe),_Ae=e=>{var f;const{t}=M(),{nodeId:n,field:s,fieldTemplate:o}=e,r=G(),a=re(Jn),{currentData:l,isError:d}=ul(((f=s.value)==null?void 0:f.image_name)??cs),u=c.useCallback(()=>{r(Z2({nodeId:n,fieldName:s.name,value:void 0}))},[r,s.name,n]),h=c.useMemo(()=>{var m;return Sw.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}},(m=s.value)==null?void 0:m.image_name)},[s,n]);c.useEffect(()=>{a&&d&&u()},[u,a,d]);const p=c.useCallback(m=>{r(Z2({nodeId:n,fieldName:s.name,value:m}))},[r,s.name,n]);return i.jsxs(T,{position:"relative",className:tt,w:"full",h:32,alignItems:"stretch",children:[!l&&i.jsx(iI,{w:"full",h:"auto",isError:o.required&&!s.value,onUpload:p,fontSize:24}),l&&i.jsxs(i.Fragment,{children:[i.jsx(T,{borderRadius:"base",borderWidth:1,borderStyle:"solid",children:i.jsx(vl,{imageDTO:l,asThumbnail:!0})}),i.jsx(W,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",insetInlineEnd:1,insetBlockEnd:1,opacity:.7,px:2,borderRadius:"base",pointerEvents:"none",children:`${l.width}x${l.height}`})]}),i.jsx(Ls,{dndTarget:Sw,dndTargetData:h,label:t("gallery.drop")})]})},IAe=c.memo(_Ae),TAe=c.memo(()=>{const{t:e}=M();return i.jsx(T,{h:16,w:"full",alignItems:"center",justifyContent:"center",children:i.jsx(W,{fontSize:16,fontWeight:"semibold",children:e("gallery.dropOrUpload")})})});TAe.displayName="UploadElement";const AAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=T9(),a=c.useCallback(l=>{l&&s(Gse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},MAe=c.memo(AAe),EAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=L9(),a=c.useCallback(l=>{l&&s(Hse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},PAe=c.memo(EAe),LAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=Ry(),a=c.useCallback(l=>{l&&s(Wse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},DAe=c.memo(LAe),RAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=nme(),a=c.useCallback(l=>{l&&s(dm({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},OAe=c.memo(RAe),NAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=Dy(),a=c.useCallback(l=>{l&&s(Use({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},FAe=c.memo(NAe),BAe=e=>{const{nodeId:t,field:n}=e,s=G(),o=c.useCallback(a=>{um(a==null?void 0:a.value)&&s(qse({nodeId:t,fieldName:n.name,value:a.value}))},[s,n.name,t]),r=c.useMemo(()=>fr.find(a=>a.value===(n==null?void 0:n.value)),[n==null?void 0:n.value]);return i.jsx(Q,{className:`${Gt} ${tt} ${Ac}`,children:i.jsx(Ke,{value:r,options:fr,onChange:o})})},$Ae=c.memo(BAe),VAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=ime(),a=c.useCallback(l=>{l&&s(dm({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},zAe=c.memo(VAe),GAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=rme(),a=c.useCallback(l=>{l&&s(dm({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},HAe=c.memo(GAe),WAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=E9(),a=c.useCallback(l=>{l&&s(Kse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},UAe=c.memo(WAe),qAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=Mm(),a=c.useCallback(l=>{l&&s(Zse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},KAe=c.memo(qAe),ZAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=I9(),a=c.useCallback(l=>{l&&s(Yse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},YAe=c.memo(ZAe),XAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=bj(),a=c.useCallback(l=>{l&&s(Xse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},QAe=c.memo(XAe),JAe=e=>{const{nodeId:t,field:n}=e,s=G(),[o,{isLoading:r}]=Oy(),a=c.useCallback(l=>{l&&s(Qse({nodeId:t,fieldName:n.name,value:l}))},[s,n.name,t]);return i.jsx(bn,{value:n.value,modelConfigs:o,isLoadingConfigs:r,onChange:a,required:e.fieldTemplate.required})},e6e=c.memo(JAe),bb=c.memo(({nodeId:e,fieldName:t,settings:n})=>{const s=Bc(e,t),o=No(e,t);if(_8(o))return gS(s)?i.jsx(eU,{nodeId:e,field:s,fieldTemplate:o}):null;if(DL(o)){if(!Jse(s))return null;if(!n||n.type!=="string-field-config")return o.ui_component==="textarea"?i.jsx(tS,{nodeId:e,field:s,fieldTemplate:o}):i.jsx(eS,{nodeId:e,field:s,fieldTemplate:o});if(n.component==="input")return i.jsx(eS,{nodeId:e,field:s,fieldTemplate:o});if(n.component==="textarea")return i.jsx(tS,{nodeId:e,field:s,fieldTemplate:o});if(n.component==="dropdown")return i.jsx(lU,{nodeId:e,field:s,fieldTemplate:o,settings:n});ve(!1,"Unexpected settings")}if(eie(o))return tie(s)?i.jsx(nAe,{nodeId:e,field:s,fieldTemplate:o}):null;if(q0(o)){if(!M8(s))return null;if(!n||n.type!=="integer-field-config")return i.jsx(Jw,{nodeId:e,field:s,fieldTemplate:o});if(n.component==="number-input")return i.jsx(Jw,{nodeId:e,field:s,fieldTemplate:o,settings:n});if(n.component==="slider")return i.jsx(aU,{nodeId:e,field:s,fieldTemplate:o,settings:n});if(n.component==="number-input-and-slider")return i.jsx(rU,{nodeId:e,field:s,fieldTemplate:o,settings:n});ve(!1,"Unexpected settings.component")}if(U0(o)){if(!A8(s))return null;if(!n||n.type!=="float-field-config")return i.jsx(Qw,{nodeId:e,field:s,fieldTemplate:o});if(n.component==="number-input")return i.jsx(Qw,{nodeId:e,field:s,fieldTemplate:o,settings:n});if(n.component==="slider")return i.jsx(DW,{nodeId:e,field:s,fieldTemplate:o,settings:n});if(n.component==="number-input-and-slider")return i.jsx(LW,{nodeId:e,field:s,fieldTemplate:o,settings:n});ve(!1,"Unexpected settings.component")}return I8(o)?yS(s)?i.jsx(qW,{nodeId:e,field:s,fieldTemplate:o}):null:T8(o)?xS(s)?i.jsx(OW,{nodeId:e,field:s,fieldTemplate:o}):null:nie(o)?sie(s)?i.jsx(bAe,{nodeId:e,field:s,fieldTemplate:o}):null:j8(o)?Mx(s)?i.jsx(GW,{nodeId:e,field:s,fieldTemplate:o}):null:iie(o)?oie(s)?i.jsx(IAe,{nodeId:e,field:s,fieldTemplate:o}):null:m8(o)?g8(s)?i.jsx(eAe,{nodeId:e,field:s,fieldTemplate:o}):null:rie(o)?aie(s)?i.jsx(OAe,{nodeId:e,field:s,fieldTemplate:o}):null:lie(o)?cie(s)?i.jsx(qTe,{nodeId:e,field:s,fieldTemplate:o}):null:die(o)?uie(s)?i.jsx(FAe,{nodeId:e,field:s,fieldTemplate:o}):null:hie(o)?pie(s)?i.jsx(e6e,{nodeId:e,field:s,fieldTemplate:o}):null:fie(o)?mie(s)?i.jsx(QAe,{nodeId:e,field:s,fieldTemplate:o}):null:gie(o)?xie(s)?i.jsx(iAe,{nodeId:e,field:s,fieldTemplate:o}):null:yie(o)?bie(s)?i.jsx(lAe,{nodeId:e,field:s,fieldTemplate:o}):null:vie(o)?Cie(s)?i.jsx(rAe,{nodeId:e,field:s,fieldTemplate:o}):null:wie(o)?Sie(s)?i.jsx(mAe,{nodeId:e,field:s,fieldTemplate:o}):null:kie(o)?jie(s)?i.jsx(PAe,{nodeId:e,field:s,fieldTemplate:o}):null:_ie(o)?Iie(s)?i.jsx(jAe,{nodeId:e,field:s,fieldTemplate:o}):null:Tie(o)?Aie(s)?i.jsx(DAe,{nodeId:e,field:s,fieldTemplate:o}):null:Mie(o)?Eie(s)?i.jsx(xAe,{nodeId:e,field:s,fieldTemplate:o}):null:Pie(o)?Lie(s)?i.jsx(MAe,{nodeId:e,field:s,fieldTemplate:o}):null:Die(o)?Rie(s)?i.jsx(YAe,{nodeId:e,field:s,fieldTemplate:o}):null:Oie(o)?Nie(s)?i.jsx(KAe,{nodeId:e,field:s,fieldTemplate:o}):null:Fie(o)?Bie(s)?i.jsx(UAe,{nodeId:e,field:s,fieldTemplate:o}):null:$ie(o)?Vie(s)?i.jsx(SAe,{nodeId:e,field:s,fieldTemplate:o}):null:zie(o)?Gie(s)?i.jsx($Te,{nodeId:e,field:s,fieldTemplate:o}):null:Hie(o)?Wie(s)?i.jsx(zTe,{nodeId:e,field:s,fieldTemplate:o}):null:Uie(o)?qie(s)?i.jsx(TTe,{nodeId:e,field:s,fieldTemplate:o}):null:Kie(o)?Zie(s)?i.jsx(pAe,{nodeId:e,field:s,fieldTemplate:o}):null:Yie(o)?Xie(s)?i.jsx(CAe,{nodeId:e,field:s,fieldTemplate:o}):null:Qie(o)?Jie(s)?i.jsx(zAe,{nodeId:e,field:s,fieldTemplate:o}):null:eoe(o)?toe(s)?i.jsx(dAe,{nodeId:e,field:s,fieldTemplate:o}):null:noe(o)?soe(s)?i.jsx(HAe,{nodeId:e,field:s,fieldTemplate:o}):null:ioe(o)?ooe(s)?i.jsx($Ae,{nodeId:e,field:s,fieldTemplate:o}):null:roe(o)?C8(s)?i.jsx(zW,{nodeId:e,field:s,fieldTemplate:o}):null:aoe(o)?S8(s)?i.jsx(JW,{nodeId:e,field:s,fieldTemplate:o}):null:loe(o)?b8(s)?i.jsx(oU,{nodeId:e,field:s,fieldTemplate:o}):null:coe(o)&&x8(s)?i.jsx(UW,{nodeId:e,field:s,fieldTemplate:o}):null});bb.displayName="InputFieldRenderer";const vb=(e,t)=>{const n=c.useMemo(()=>he(Xe,o=>{var r;return((r=Wx(o,e,t))==null?void 0:r.description)??""}),[t,e]);return A(n)},cU=c.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=G(),o=vb(n.nodeId,n.fieldName),r=No(n.nodeId,n.fieldName),a=c.useRef(null),l=c.useCallback(u=>{s(zL({nodeId:n.nodeId,fieldName:n.fieldName,val:u}))},[s,n.fieldName,n.nodeId]),d=fa({value:o||r.description,defaultValue:r.description,inputRef:a,onChange:l});return d.isEditing?i.jsx(ls,{ref:a,variant:"outline",fontSize:"sm",p:1,px:2,_focusVisible:{borderRadius:"base",h:"unset"},...d.inputProps}):i.jsx(Js,{onDoubleClick:d.startEditing,sx:ig,children:i.jsx(rg,{options:og,children:d.value})})});cU.displayName="NodeFieldElementDescriptionEditable";const S2=Symbol("uniqueNonexistentValue"),t6e=(e,t,n)=>{const s=G(),o=c.useMemo(()=>he(Xe,u=>e in u.formFieldInitialValues?u.formFieldInitialValues[e]:S2),[e]),r=A(o),a=c.useMemo(()=>he(Xe,u=>{var f;if(r===S2)return!1;const h=u.nodes.find(m=>m.id===t);if(!Rn(h))return;const p=(f=h.data.inputs[n])==null?void 0:f.value;return!Vl(p,r)}),[n,r,t]),l=A(a),d=c.useCallback(()=>{r!==S2&&s(hk({nodeId:t,fieldName:n,value:r}))},[s,n,t,r]);return{initialValue:r,isValueChanged:l,resetToInitialValue:d}},AI=c.memo(({element:e})=>{const{t}=M(),{id:n,data:s}=e,{nodeId:o,fieldName:r}=s.fieldIdentifier,{isValueChanged:a,resetToInitialValue:l}=t6e(n,o,r);return a?i.jsx(le,{variant:"link",size:"sm",alignSelf:"stretch",tooltip:t("nodes.resetToDefaultValue"),"aria-label":t("nodes.resetToDefaultValue"),icon:i.jsx(Zs,{}),onClick:l,isDisabled:!a}):null});AI.displayName="NodeFieldElementResetToInitialValueIconButton";const MI=(e,t)=>{const n=c.useMemo(()=>he(Xe,o=>{var r;return((r=Wx(o,e,t))==null?void 0:r.label)??""}),[t,e]);return A(n)},dU=c.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=G(),o=MI(n.nodeId,n.fieldName),r=No(n.nodeId,n.fieldName),a=c.useRef(null),l=c.useCallback(u=>{s(GL({nodeId:n.nodeId,fieldName:n.fieldName,label:u}))},[s,n.fieldName,n.nodeId]),d=fa({value:o||r.title,defaultValue:r.title,inputRef:a,onChange:l});return d.isEditing?i.jsx(St,{ref:a,variant:"outline",p:1,px:2,_focusVisible:{borderRadius:"base",h:"unset"},...d.inputProps}):i.jsxs(T,{w:"full",gap:4,children:[i.jsx(J,{onDoubleClick:d.startEditing,cursor:"text",children:d.value}),i.jsx(Je,{}),i.jsx(AI,{element:e})]})});dU.displayName="NodeFieldElementLabelEditable";const n6e=fo({}).options,uU=c.memo(({id:e,settings:t})=>{const{t:n}=M(),s=G(),o=c.useCallback(u=>{const h=[...t.options];h.splice(u,1),s(as({id:e,changes:{settings:{...t,options:h}}}))},[t,s,e]),r=c.useCallback((u,h)=>{if(!t.options[u])return;const p={...t.options[u],value:h},f=[...t.options];f[u]=p,s(as({id:e,changes:{settings:{...t,options:f}}}))},[s,e,t]),a=c.useCallback((u,h)=>{if(!t.options[u])return;const p={...t.options[u],label:h},f=[...t.options];f[u]=p,s(as({id:e,changes:{settings:{...t,options:f}}}))},[s,e,t]),l=c.useCallback(()=>{const u=[...t.options,uC()];s(as({id:e,changes:{settings:{...t,options:u}}}))},[s,e,t]),d=c.useCallback(()=>{const u=[uC()];s(as({id:e,changes:{settings:{...t,options:u}}}))},[s,e,t]);return i.jsxs(T,{className:tt,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,children:[i.jsxs(Qn,{isAttached:!1,w:"full",children:[i.jsx(de,{onClick:l,variant:"ghost",flex:1,leftIcon:i.jsx(Vt,{}),children:n("workflows.builder.addOption")}),i.jsx(de,{onClick:d,variant:"ghost",flex:1,leftIcon:i.jsx(Zs,{}),children:n("workflows.builder.resetOptions")})]}),t.options.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Ct,{}),i.jsx(vs,{className:Gt,defer:!0,style:Ir,options:n6e,children:i.jsxs(Mi,{gap:1,gridTemplateColumns:"auto 1fr 1fr auto",gridTemplateRows:"auto 1fr",alignItems:"center",children:[i.jsx(vt,{minW:8,children:i.jsx(W,{textAlign:"center",variant:"subtext",children:"#"})}),i.jsx(vt,{children:i.jsx(W,{textAlign:"center",variant:"subtext",children:n("common.label")})}),i.jsx(vt,{children:i.jsx(W,{textAlign:"center",variant:"subtext",children:n("common.value")})}),i.jsx(vt,{}),t.options.map(({value:u,label:h},p)=>i.jsx(hU,{value:u,label:h,index:p,onRemoveOption:o,onChangeOptionValue:r,onChangeOptionLabel:a,isRemoveDisabled:t.options.length<=1},p))]})})]})]})});uU.displayName="NodeFieldElementStringDropdownSettings";const hU=c.memo(({value:e,label:t,index:n,onRemoveOption:s,onChangeOptionValue:o,onChangeOptionLabel:r,isRemoveDisabled:a})=>{const{t:l}=M(),d=c.useCallback(()=>{s(n)},[n,s]),u=c.useCallback(p=>{o(n,p.target.value)},[n,o]),h=c.useCallback(p=>{r(n,p.target.value)},[n,r]);return i.jsxs(i.Fragment,{children:[i.jsx(vt,{children:i.jsxs(W,{variant:"subtext",textAlign:"center",children:[n+1,"."]})}),i.jsx(vt,{children:i.jsx(St,{size:"sm",resize:"none",placeholder:"label",value:t,onChange:h})}),i.jsx(vt,{children:i.jsx(St,{size:"sm",resize:"none",placeholder:"value",value:e,onChange:u})}),i.jsx(vt,{children:i.jsx(le,{tabIndex:-1,size:"sm",variant:"link",minW:8,minH:8,onClick:d,isDisabled:a,icon:i.jsx(Rt,{}),"aria-label":l("common.delete")})})]})});hU.displayName="ListItemContent";const s6e={position:"relative",borderRadius:"base",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0"},flexDir:"column"},pU=c.memo(({el:e})=>{const t=c.useRef(null),n=c.useRef(null),[s,o]=Jm(e.id,t,n),r=Oo(),{id:a}=e;return i.jsxs(T,{ref:t,id:a,className:HL,sx:s6e,"data-parent-layout":r.layout,children:[i.jsx(fU,{dragHandleRef:n,el:e,isDragging:o}),i.jsx(Cb,{nodeId:e.data.fieldIdentifier.nodeId}),i.jsx(eg,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});pU.displayName="NodeFieldElementEditMode";const fU=c.memo(({el:e,dragHandleRef:t,isDragging:n})=>{var l;const{id:s,data:o}=e,{fieldIdentifier:r,showDescription:a}=o;return i.jsxs(i.Fragment,{children:[i.jsx(sh,{dragHandleRef:t,element:e,"data-is-dragging":n}),i.jsx(th,{"data-is-dragging":n,p:4,children:i.jsx(Fc,{nodeId:r.nodeId,fieldName:r.fieldName,children:i.jsxs(Q,{flex:"1 1 0",orientation:"vertical",children:[i.jsx(dU,{el:e}),i.jsx(T,{w:"full",gap:4,children:i.jsx(bb,{nodeId:r.nodeId,fieldName:r.fieldName,settings:o.settings})}),a&&i.jsx(cU,{el:e}),((l=o.settings)==null?void 0:l.type)==="string-field-config"&&o.settings.component==="dropdown"&&i.jsxs(i.Fragment,{children:[i.jsx(Ct,{}),i.jsx(uU,{id:s,settings:o.settings})]})]})})})]})});fU.displayName="NodeFieldElementEditModeContent";const i6e={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"none",pointerEvents:"none",display:"none",'&[data-is-mouse-over-node-or-form-field="true"]':{display:"block",bg:"invokeBlueAlpha.100"}},Cb=c.memo(({nodeId:e})=>{const t=uW(e),n=sg(e);return i.jsx(Ce,{sx:i6e,"data-is-mouse-over-node-or-form-field":t.isMouseOverNode||n.isMouseOverFormField})});Cb.displayName="NodeFieldElementOverlay";const mU=c.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=MI(n.nodeId,n.fieldName),o=No(n.nodeId,n.fieldName),r=c.useMemo(()=>s||o.title,[s,o.title]);return i.jsxs(T,{w:"full",gap:4,children:[i.jsx(J,{children:r}),i.jsx(Je,{}),i.jsx(AI,{element:e})]})});mU.displayName="NodeFieldElementLabel";const o6e=(e,t)=>{const n=FH(e);return c.useMemo(()=>(n==null?void 0:n.inputs[t])??null,[t,n==null?void 0:n.inputs])},r6e={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32},'&[data-with-description="false"]':{pb:2}},a6e=()=>{const{t:e}=M();return c.useCallback(n=>e("nodes.unknownFieldEditWorkflowToFix_withName",{name:n}),[e])},gU=c.memo(({el:e})=>{const{id:t,data:n}=e,{fieldIdentifier:s,showDescription:o}=n,r=vb(s.nodeId,s.fieldName),a=o6e(s.nodeId,s.fieldName),l=Oo(),d=a6e(),u=c.useMemo(()=>r||(a==null?void 0:a.description)||"",[r,a==null?void 0:a.description]);return i.jsx(T,{id:t,className:HL,sx:r6e,"data-parent-layout":l.layout,"data-with-description":o&&!!u,children:i.jsx(Fc,{nodeId:e.data.fieldIdentifier.nodeId,fieldName:e.data.fieldIdentifier.fieldName,formatLabel:d,children:i.jsx(xU,{el:e})})})});gU.displayName="NodeFieldElementViewMode";const xU=c.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n,showDescription:s}=t,o=vb(n.nodeId,n.fieldName),r=No(n.nodeId,n.fieldName),a=c.useMemo(()=>o||r.description,[o,r.description]);return i.jsxs(Q,{flex:"1 1 0",orientation:"vertical",children:[i.jsx(mU,{el:e}),i.jsx(T,{w:"full",gap:4,children:i.jsx(bb,{nodeId:n.nodeId,fieldName:n.fieldName,settings:t.settings})}),s&&a&&i.jsx(Js,{sx:ig,children:i.jsx(rg,{options:og,children:a})})]})});xU.displayName="NodeFieldElementViewModeContent";const yU=c.memo(({id:e})=>{const t=ih(e),n=A(kr);return!t||!dk(t)?null:n==="view"?i.jsx(gU,{el:t}):i.jsx(pU,{el:t})});yU.displayName="NodeFieldElement";const l6e={fontSize:"md",whiteSpace:"pre-wrap",overflowWrap:"anywhere",'&[data-is-empty="true"]':{opacity:.3},...ig},EI=c.memo(({content:e,...t})=>{const{t:n}=M();return i.jsx(W,{sx:l6e,"data-is-empty":e==="",...t,children:i.jsx(rg,{options:og,children:e||n("workflows.builder.textPlaceholder")})})});EI.displayName="TextElementContent";const bU=c.memo(({el:e})=>{const{t}=M(),n=G(),{id:s,data:o}=e,{content:r}=o,a=c.useRef(null),l=c.useCallback(u=>{n(doe({id:s,changes:{content:u}}))},[n,s]),d=fa({value:r,defaultValue:"",onChange:l,inputRef:a});return d.isEditing?i.jsx(bI,{ref:a,placeholder:t("workflows.builder.textPlaceholder"),...d.inputProps,fontSize:"md",variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:2}):i.jsx(EI,{content:d.value,onDoubleClick:d.startEditing})});bU.displayName="TextElementContentEditable";const c6e={position:"relative",borderRadius:"base",minW:32,'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 0 0"},flexDir:"column"},vU=c.memo(({el:e})=>{const t=c.useRef(null),n=c.useRef(null),[s,o]=Jm(e.id,t,n),r=Oo(),{id:a}=e;return i.jsxs(T,{ref:t,id:a,className:WL,sx:c6e,"data-parent-layout":r.layout,children:[i.jsx(sh,{dragHandleRef:n,element:e,"data-is-dragging":o}),i.jsx(th,{"data-is-dragging":o,p:4,children:i.jsx(bU,{el:e})}),i.jsx(eg,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});vU.displayName="TextElementEditMode";const d6e={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},CU=c.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n,o=Oo();return i.jsx(T,{id:t,className:WL,sx:d6e,"data-parent-layout":o.layout,children:i.jsx(EI,{content:s})})});CU.displayName="TextElementViewMode";const wU=c.memo(({id:e})=>{const t=ih(e),n=A(kr);return!t||!UL(t)?null:n==="view"?i.jsx(CU,{el:t}):i.jsx(vU,{el:t})});wU.displayName="TextElement";const SU=c.memo(({id:e})=>{const t=ih(e),n=A(kr);return!t||!Ji(t)?null:n==="view"?i.jsx(kU,{el:t}):i.jsx(jU,{el:t})});SU.displayName="ContainerElementComponent";const u6e={gap:2,'&[data-self-layout="column"]':{flexDir:"column",alignItems:"stretch"},'&[data-self-layout="row"]':{flexDir:"row",alignItems:"flex-start",overflowX:"auto",overflowY:"visible",h:"min-content",flexShrink:0},'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},kU=c.memo(({el:e})=>{const{t}=M(),n=pb(),s=Oo(),{id:o,data:r}=e,{children:a,layout:l}=r;return i.jsx(Xm,{depth:n+1,children:i.jsx(Ym,{id:o,layout:l,children:i.jsxs(T,{id:o,className:ZL,sx:u6e,"data-self-layout":l,"data-depth":n,"data-parent-layout":s.layout,children:[a.map(d=>i.jsx(lg,{id:d},d)),a.length===0&&i.jsx(T,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(W,{variant:"subtext",children:t("workflows.builder.containerPlaceholder")})})]})})})});kU.displayName="ContainerElementComponentViewMode";const h6e={borderRadius:"base",position:"relative",'&[data-active-drop-region="center"]':{opacity:1,bg:"base.850"},flexDir:"column",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",h:"min-content"}},p6e={gap:4,p:4,flex:"1 1 0",'&[data-self-layout="column"]':{flexDir:"column"},'&[data-self-layout="row"]':{flexDir:"row",overflowX:"auto"}},jU=c.memo(({el:e})=>{const t=pb(),n=c.useRef(null),s=c.useRef(null),o=c.useRef(null),[r,a]=Jm(e.id,n,s),{id:l,data:d}=e,{children:u,layout:h}=d,p=Oo();return c.useEffect(()=>{const f=o.current;if(f&&h!=="column")return zk({element:f})},[h]),i.jsx(Xm,{depth:t+1,children:i.jsx(Ym,{id:l,layout:h,children:i.jsxs(T,{id:l,ref:n,className:ZL,sx:h6e,"data-depth":t,"data-parent-layout":p.layout,"data-active-drop-region":r,children:[i.jsx(sh,{dragHandleRef:s,element:e,"data-is-dragging":a}),i.jsx(th,{"data-is-dragging":a,children:i.jsxs(T,{ref:o,sx:p6e,"data-self-layout":h,children:[u.map(f=>i.jsx(lg,{id:f},f)),u.length===0&&i.jsx(MU,{})]})}),i.jsx(eg,{activeDropRegion:r,gap:"var(--invoke-space-4)"})]})})})});jU.displayName="ContainerElementComponentEditMode";const _U={position:"relative",alignItems:"center",borderRadius:"base",w:"full",h:"full",gap:2,display:"flex",flex:1,maxW:"768px",'&[data-self-layout="column"]':{flexDir:"column",alignItems:"stretch"},'&[data-self-layout="row"]':{flexDir:"row",alignItems:"flex-start"}},IU=c.memo(()=>{const e=A(qL),{id:t,data:n}=e,{children:s,layout:o}=n;return i.jsx(Xm,{depth:0,children:i.jsx(Ym,{id:t,layout:o,children:i.jsx(Ce,{id:t,className:KL,sx:_U,"data-self-layout":o,"data-depth":0,children:s.map(r=>i.jsx(lg,{id:r},r))})})})});IU.displayName="RootContainerElementViewMode";const f6e={..._U,gap:4,'&[data-is-dragging-over="true"]':{opacity:1,bg:"base.850"}},TU=c.memo(()=>{const e=A(qL),{id:t,data:n}=e,{children:s,layout:o}=n,r=c.useRef(null),a=I5e(r);return i.jsx(Xm,{depth:0,children:i.jsx(Ym,{id:t,layout:o,children:i.jsxs(T,{ref:r,id:t,className:KL,sx:f6e,"data-self-layout":o,"data-depth":0,"data-is-dragging-over":a,children:[s.map(l=>i.jsx(lg,{id:l},l)),s.length===0&&i.jsx(AU,{})]})})})});TU.displayName="RootContainerElementEditMode";const AU=c.memo(()=>{const{t:e}=M();return i.jsx(T,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(W,{variant:"subtext",children:e("workflows.builder.emptyRootPlaceholderEditMode")})})});AU.displayName="RootPlaceholder";const MU=c.memo(()=>{const{t:e}=M();return i.jsx(T,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(W,{variant:"subtext",children:e("workflows.builder.containerPlaceholder")})})});MU.displayName="NonRootPlaceholder";const lg=c.memo(({id:e})=>{const t=ih(e);if(!t)return null;if(Ji(t))return i.jsx(SU,{id:e},e);if(dk(t))return i.jsx(yU,{id:e},e);if(OL(t))return i.jsx(xW,{id:e},e);if(BL(t))return i.jsx(PW,{id:e},e);if(UL(t))return i.jsx(wU,{id:e},e);ve(!1,`Unhandled type for element with id ${e}`)});lg.displayName="FormElementComponent";const m6e=()=>{const e=cn();return c.useCallback(()=>{const n=uoe(e.getState()),s=hoe(e.getState());for(const o of s){if(!(o.id in n))continue;const{nodeId:r,fieldName:a}=o.data.fieldIdentifier;e.dispatch(hk({nodeId:r,fieldName:a,value:n[o.id]}))}},[e])},EU=c.memo(()=>{const{t:e}=M(),t=cn(),n=m6e(),s=c.useCallback(()=>{t.dispatch(poe())},[t]);return i.jsxs(on,{placement:"bottom-end",children:[i.jsx(rn,{as:le,icon:i.jsx(j7,{}),variant:"ghost",size:"sm"}),i.jsxs(Et,{children:[i.jsx(fe,{icon:i.jsx(Zs,{}),onClick:n,children:e("workflows.builder.resetAllNodeFields")}),i.jsx(fe,{isDestructive:!0,icon:i.jsx(lj,{}),onClick:s,children:e("workflows.builder.deleteAllElements")})]})]})});EU.displayName="WorkflowBuilderEditMenu";const g6e={pt:3,w:"full",'&[data-is-empty="true"]':{pt:0}},PU=c.memo(()=>{const{t:e}=M();return _5e(),i.jsx(T,{justifyContent:"center",w:"full",h:"full",children:i.jsxs(T,{flexDir:"column",w:"full",maxW:"768px",gap:2,children:[i.jsxs(T,{w:"full",alignItems:"center",gap:2,pt:3,children:[i.jsx(c0,{type:"container",children:e("workflows.builder.container")}),i.jsx(c0,{type:"divider",children:e("workflows.builder.divider")}),i.jsx(c0,{type:"heading",children:e("workflows.builder.heading")}),i.jsx(c0,{type:"text",children:e("workflows.builder.text")}),i.jsx(de,{size:"sm",variant:"ghost",tooltip:e("workflows.builder.nodeFieldTooltip"),children:e("workflows.builder.nodeField")}),i.jsx(Je,{}),i.jsx(EU,{})]}),i.jsx(ns,{children:i.jsx(LU,{})})]})})});PU.displayName="WorkflowBuilder";const LU=c.memo(()=>{const{t:e}=M(),t=A(YL),n=Rx(),s=re(Kf);return n.isLoading||!s?i.jsx(Ot,{label:e("nodes.loadingNodes"),icon:null}):i.jsx(T,{sx:g6e,"data-is-empty":t,children:i.jsx(TU,{})})});LU.displayName="WorkflowBuilderContent";const x6e=(e,t)=>{const[n,s]=c.useState(!1);return c.useEffect(()=>{const o=t.current;if(o)return Xn(Uu(o),Eu({element:o,getInitialData:()=>{if(e==="container"){const r=foe("row",[]);return ql(r)}if(e==="divider"){const r=moe();return ql(r)}if(e==="heading"){const r=goe("");return ql(r)}if(e==="text"){const r=xoe("");return ql(r)}ve(!1)},onDragStart:()=>{s(!0)},onDrop:()=>{s(!1)}}))},[t,e]),n},y6e={cursor:"grab",borderStyle:"dashed",_active:{borderStyle:"dashed"},_disabled:{borderStyle:"dashed",opacity:.5}},c0=({type:e,children:t})=>{const n=c.useRef(null),s=x6e(e,n);return i.jsx(de,{as:"div",ref:n,size:"sm",isDisabled:s,variant:"outline",sx:y6e,children:t})},DU=(e,t)=>{const n=Bs(e);return c.useMemo(()=>{const o=n.inputs[t];return ve(o,`Template for input field ${t} not found.`),o.title},[t,n.inputs])},b6e=(e,t)=>{const n=c.useMemo(()=>he(Xe,o=>uk(o,e,t).label),[t,e]);return A(n)},RU=e=>{const t=re(ln),n=c.useMemo(()=>he(Xe,o=>{const r=o.nodes.find(l=>l.id===e);ve(Rn(r),"Node not found");const a=t[r.data.type];return ve(a,"Template not found"),a.title}),[e,t]);return A(n)},OU=e=>{const t=c.useMemo(()=>he(Xe,s=>{const o=s.nodes.find(r=>r.id===e);return ve(Rn(o),"Node not found"),o.data.label}),[e]);return A(t)},v6e=e=>{const t=e.filter(o=>!o.ui_hidden),n=t.filter(o=>!He(o.ui_order)).sort((o,r)=>(o.ui_order??0)-(r.ui_order??0)),s=t.filter(o=>He(o.ui_order));return n.concat(s).map(o=>o.name).filter(o=>o!=="is_intermediate")},NU=e=>{const t=Bs(e);return c.useMemo(()=>v6e(mr(t.outputs)),[t.outputs])},wb=(e,t)=>{const n=Bs(e);return c.useMemo(()=>{const o=n.outputs[t];return ve(o,`Template for output field ${t} not found`),o},[t,n.outputs])},NE=Wn("generation"),FU=c.memo(()=>i.jsxs(T,{flexDir:"column",gap:2,h:"full",children:[i.jsxs(Qn,{isAttached:!1,size:"sm",variant:"ghost",children:[i.jsx(Je,{}),i.jsx(HU,{}),i.jsx(WU,{})]}),i.jsx(ns,{children:i.jsxs(T,{flexDir:"column",gap:2,w:"full",h:"full",children:[i.jsx(BU,{}),i.jsx(VU,{}),i.jsx(zU,{})]})})]}));FU.displayName="PublishWorkflowPanelContent";const BU=c.memo(()=>{const{t:e}=M(),t=re(sa);return i.jsxs(T,{flexDir:"column",borderWidth:1,borderRadius:"base",gap:2,p:2,children:[i.jsxs(T,{alignItems:"center",children:[i.jsx(W,{fontWeight:"semibold",children:e("workflows.builder.publishedWorkflowOutputs")}),i.jsx(Je,{}),i.jsx(GU,{variant:"link",size:"sm"})]}),i.jsx(Ct,{}),!t&&i.jsx(W,{fontWeight:"semibold",color:"error.300",children:e("workflows.builder.noOutputNodeSelected")}),t&&i.jsx($U,{outputNodeId:t})]})});BU.displayName="OutputFields";const $U=c.memo(({outputNodeId:e})=>{const t=NU(e);return i.jsx(i.Fragment,{children:t.map(n=>i.jsx(UU,{nodeId:e,fieldName:n},`${e}-${n}`))})});$U.displayName="OutputFieldsContent";const VU=c.memo(()=>{const{t:e}=M(),t=uy();return t.publishable.length===0?i.jsx(T,{flexDir:"column",borderWidth:1,borderRadius:"base",gap:2,p:2,children:i.jsx(W,{fontWeight:"semibold",color:"warning.300",children:e("workflows.builder.noPublishableInputs")})}):i.jsxs(T,{flexDir:"column",borderWidth:1,borderRadius:"base",gap:2,p:2,children:[i.jsx(W,{fontWeight:"semibold",children:e("workflows.builder.publishedWorkflowInputs")}),i.jsx(Ct,{}),t.publishable.map(({nodeId:n,fieldName:s})=>i.jsx(PI,{nodeId:n,fieldName:s},`${n}-${s}`))]})});VU.displayName="PublishableInputFields";const zU=c.memo(()=>{const{t:e}=M(),t=uy();return t.unpublishable.length===0?null:i.jsxs(T,{flexDir:"column",borderWidth:1,borderRadius:"base",gap:2,p:2,children:[i.jsx(W,{fontWeight:"semibold",color:"warning.300",children:e("workflows.builder.unpublishableInputs")}),i.jsx(Ct,{}),t.unpublishable.map(({nodeId:n,fieldName:s})=>i.jsx(PI,{nodeId:n,fieldName:s},`${n}-${s}`))]})});zU.displayName="UnpublishableInputFields";const GU=c.memo(e=>{const{t}=M(),n=re(sa),s=re(Xa),o=c.useCallback(()=>{sa.set(null),Xa.set(!0)},[]);return i.jsx(de,{leftIcon:i.jsx(Ipe,{}),isDisabled:s,tooltip:s?t("workflows.builder.selectingOutputNodeDesc"):void 0,onClick:o,...e,children:t(s?"workflows.builder.selectingOutputNode":n?"workflows.builder.changeOutputNode":"workflows.builder.selectOutputNode")})});GU.displayName="SelectOutputNodeButton";const HU=c.memo(()=>{const{t:e}=M(),t=c.useCallback(()=>{ca.set(!1),Xa.set(!1),sa.set(null)},[]);return i.jsx(de,{leftIcon:i.jsx(Rt,{}),onClick:t,children:e("common.cancel")})});HU.displayName="CancelDeployButton";const WU=c.memo(()=>{const{t:e}=M(),t=re(fde),n=re(Au),s=_c(),o=A(ZD),r=re(sa),a=re(Xa),l=uy(),d=A(zx),u=re(VS),h=YD(),p=c.useCallback(async()=>{const f=await Zn(()=>h(!0,!0));f.isErr()?(ge({id:"TOAST_PUBLISH_FAILED",status:"error",title:e("workflows.builder.publishFailed"),description:e("workflows.builder.publishFailedDesc"),duration:null}),NE.error({error:$n(f.error)},"Failed to enqueue batch")):(ge({id:"TOAST_PUBLISH_SUCCESSFUL",status:"success",title:e("workflows.builder.publishSuccess"),description:i.jsx(Wt,{i18nKey:"workflows.builder.publishSuccessDesc",components:{LinkComponent:i.jsx(Fy,{href:u??""})}}),duration:null}),ve(f.value.enqueueResult.batch.batch_id),ve(f.value.batchConfig.validation_run_data),t1.set({batchId:f.value.enqueueResult.batch.batch_id,workflowId:f.value.batchConfig.validation_run_data.workflow_id}),NE.debug(_o(f.value),"Enqueued batch"))},[h,u,e]);return i.jsx(LI,{isWorkflowSaved:!s,hasUnpublishableNodes:o,isReadyToEnqueue:n,hasOutputNode:r!==null&&!a,hasPublishableInputs:l.publishable.length>0,hasUnpublishableInputs:l.unpublishable.length>0,children:i.jsx(de,{leftIcon:i.jsx(Ou,{}),isDisabled:!d||!n||s||o||!t||!(r!==null&&!a),onClick:p,children:e("workflows.builder.publish")})})});WU.displayName="DoValidationRunButton";const PI=c.memo(({nodeId:e,fieldName:t})=>{const n=sg(e),s=OU(e),o=RU(e),r=b6e(e,t),a=DU(e,t),l=gb(e);return i.jsxs(T,{flexDir:"column",position:"relative",p:2,borderRadius:"base",onMouseOver:n.handleMouseOver,onMouseOut:n.handleMouseOut,onClick:l,children:[i.jsx(W,{fontWeight:"semibold",children:`${s||o} -> ${r||a}`}),i.jsx(W,{variant:"subtext",children:`${e} -> ${t}`}),i.jsx(Cb,{nodeId:e})]})});PI.displayName="NodeInputFieldPreview";const UU=c.memo(({nodeId:e,fieldName:t})=>{const n=sg(e),s=OU(e),o=RU(e),r=wb(e,t),a=gb(e);return i.jsxs(T,{flexDir:"column",position:"relative",p:2,borderRadius:"base",onMouseOver:n.handleMouseOver,onMouseOut:n.handleMouseOut,onClick:a,children:[i.jsx(W,{fontWeight:"semibold",children:`${s||o} -> ${r.title}`}),i.jsx(W,{variant:"subtext",children:`${e} -> ${t}`}),i.jsx(Cb,{nodeId:e})]})});UU.displayName="NodeOutputFieldPreview";const qU=c.memo(()=>{const{t:e}=M(),t=A(zx),n=re(Au),s=_c(),o=A(ZD),r=uy(),a=c.useCallback(()=>{ca.set(!0)},[]);return i.jsx(LI,{isWorkflowSaved:!s,hasUnpublishableNodes:o,isReadyToEnqueue:n,hasOutputNode:!0,hasPublishableInputs:r.publishable.length>0,hasUnpublishableInputs:r.unpublishable.length>0,children:i.jsx(de,{onClick:a,leftIcon:i.jsx(Ou,{}),variant:"ghost",size:"sm",isDisabled:!t||!n||s||o,children:e("workflows.builder.publish")})})});qU.displayName="StartPublishFlowButton";const LI=c.memo(({isWorkflowSaved:e,hasUnpublishableNodes:t,isReadyToEnqueue:n,hasOutputNode:s,hasPublishableInputs:o,hasUnpublishableInputs:r,children:a})=>{const{t:l}=M(),d=c.useMemo(()=>{const h=[];return o||h.push(l("workflows.builder.warningWorkflowHasNoPublishableInputFields")),r&&h.push(l("workflows.builder.warningWorkflowHasUnpublishableInputFields")),h},[o,r,l]),u=c.useMemo(()=>{const h=[];return e||h.push(l("workflows.builder.errorWorkflowHasUnsavedChanges")),t&&h.push(l("workflows.builder.errorWorkflowHasUnpublishableNodes")),n||h.push(l("workflows.builder.errorWorkflowHasInvalidGraph")),s||h.push(l("workflows.builder.errorWorkflowHasNoOutputNode")),h},[t,s,n,e,l]);return u.length===0&&d.length===0?a:i.jsx(Oe,{label:i.jsxs(T,{flexDir:"column",children:[u.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs(W,{color:"error.700",fontWeight:"semibold",children:[l("workflows.builder.cannotPublish"),":"]}),i.jsx(ai,{children:u.map((h,p)=>i.jsx(Ft,{children:h},p))})]}),d.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs(W,{color:"warning.700",fontWeight:"semibold",children:[l("workflows.builder.publishWarnings"),":"]}),i.jsx(ai,{children:d.map((h,p)=>i.jsx(Ft,{children:h},p))})]})]}),children:a})});LI.displayName="PublishTooltip";const C6e=({imageUrl:e,onChange:t})=>{const[n,s]=c.useState(null),o=c.useCallback(async h=>{if(!h){s(null);return}try{const p=await Hy(h);if(p){const f=new File([p],"workflow.png",{type:"image/png"});s(f)}}catch{s(null)}},[]);c.useEffect(()=>{o(e)},[e,o]);const{t:r}=M(),a=c.useCallback(h=>{const p=h[0];p&&(s(p),t(URL.createObjectURL(p)))},[t]),l=c.useCallback(()=>{s(null),t(null)},[t]),{getInputProps:d,getRootProps:u}=da({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:a,noDrag:!0,multiple:!1});return n?i.jsxs(Ce,{position:"relative",flexShrink:0,children:[i.jsx(Zt,{src:URL.createObjectURL(n),objectFit:"cover",objectPosition:"50% 50%",w:100,h:100,borderRadius:"base"}),i.jsx(le,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:l,"aria-label":r("stylePresets.deleteImage"),tooltip:r("stylePresets.deleteImage"),icon:i.jsx(Zs,{}),size:"md",variant:"ghost"})]}):i.jsxs(i.Fragment,{children:[i.jsx(Oe,{label:r("stylePresets.uploadImage"),children:i.jsx(T,{as:de,w:100,h:100,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...u(),children:i.jsx(at,{as:jm,w:8,h:8})})}),i.jsx("input",{...d()})]})},w6e=({workflowId:e,thumbnailUrl:t})=>{const{t:n}=M(),[s,o]=c.useState(null),[r,a]=c.useState(!1),[l,{isLoading:d}]=yoe(),[u,{isLoading:h}]=boe(),p=c.useCallback(m=>{o(m),a(!0)},[]),f=c.useCallback(async()=>{try{if(s){const m=await Hy(s);if(!m)return;const g=new File([m],"workflow_thumbnail.png",{type:"image/png"});await l({workflow_id:e,image:g}).unwrap()}else await u(e).unwrap();a(!1),ge({status:"success",title:"Workflow thumbnail updated"})}catch{ge({status:"error",title:"Failed to update thumbnail"})}},[u,l,e,s]);return i.jsxs(T,{alignItems:"center",gap:4,children:[i.jsx(C6e,{imageUrl:t,onChange:p}),i.jsx(de,{size:"sm",isLoading:d||h,onClick:f,isDisabled:!r||!e,children:n("common.saveChanges")})]})},S6e=()=>{const e=A(Ax),t=A(sy),n=A(XL),s=A(voe),o=A(Coe),r=A(woe),a=A(Soe),l=A(koe),d=G(),u=c.useCallback(C=>{d(jP(C.target.value))},[d]),h=c.useCallback(C=>{d(joe(C.target.value))},[d]),p=c.useCallback(C=>{d(_oe(C.target.value))},[d]),f=c.useCallback(C=>{d(Ioe(C.target.value))},[d]),m=c.useCallback(C=>{d(Toe(C.target.value))},[d]),g=c.useCallback(C=>{d(Aoe(C.target.value))},[d]),x=c.useCallback(C=>{d(Moe(C.target.value))},[d]),{t:b}=M();return i.jsx(ns,{children:i.jsx(T,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:i.jsxs(Es,{orientation:"vertical",formControlProps:j6e,children:[i.jsxs(Q,{children:[i.jsx(J,{children:b("nodes.workflowName")}),i.jsx(St,{variant:"darkFilled",value:t,onChange:u})]}),i.jsx(_6e,{id:e}),i.jsxs(Q,{children:[i.jsx(J,{children:b("nodes.workflowVersion")}),i.jsx(St,{variant:"darkFilled",value:l,onChange:f})]}),i.jsxs(Q,{children:[i.jsx(J,{children:b("nodes.workflowAuthor")}),i.jsx(St,{variant:"darkFilled",value:o,onChange:h})]}),i.jsxs(Q,{children:[i.jsx(J,{children:b("nodes.workflowContact")}),i.jsx(St,{variant:"darkFilled",value:r,onChange:p})]}),i.jsxs(Q,{children:[i.jsx(J,{children:b("nodes.workflowTags")}),i.jsx(St,{variant:"darkFilled",value:a,onChange:g})]}),i.jsxs(Q,{children:[i.jsx(J,{children:b("nodes.workflowDescription")}),i.jsx(ls,{variant:"darkFilled",onChange:m,value:n,fontSize:"sm",resize:"none",rows:3})]}),i.jsxs(Q,{children:[i.jsx(J,{children:b("nodes.workflowNotes")}),i.jsx(ls,{variant:"darkFilled",onChange:x,value:s,fontSize:"sm",resize:"none",rows:10})]})]})})})},k6e=c.memo(S6e),j6e={flexShrink:0},_6e=({id:e})=>{const{t}=M(),{data:n}=u8(e??cs);return n?n.workflow.meta.category==="default"&&n.thumbnail_url?i.jsxs(Q,{children:[i.jsx(J,{children:t("workflows.workflowThumbnail")}),i.jsx(Ce,{position:"relative",flexShrink:0,children:i.jsx(Zt,{src:n.thumbnail_url,objectFit:"cover",objectPosition:"50% 50%",w:100,h:100,borderRadius:"base"})})]}):n.workflow.meta.category!=="default"?i.jsxs(Q,{children:[i.jsx(J,{children:t("workflows.workflowThumbnail")}),i.jsx(w6e,{thumbnailUrl:n.thumbnail_url,workflowId:n.workflow_id})]}):null:null},I6e=()=>{const e=re(Eoe),{t}=M();return i.jsx(T,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:i.jsx(br,{data:e,label:t("nodes.workflow"),bg:"base.850",color:"base.200"})})},T6e=c.memo(I6e),A6e=()=>{const{t:e}=M(),t=A(zx);return i.jsxs(yc,{variant:"enclosed",display:"flex",w:"full",h:"full",flexDir:"column",children:[i.jsxs(bc,{children:[i.jsx(Tn,{children:e("workflows.builder.builder")}),i.jsx(Tn,{children:e("common.details")}),i.jsx(Tn,{children:"JSON"}),i.jsx(Je,{}),t&&i.jsx(qU,{})]}),i.jsxs(yu,{h:"full",pt:2,children:[i.jsx(Vn,{h:"full",p:0,children:i.jsx(PU,{})}),i.jsx(Vn,{h:"full",p:0,children:i.jsx(k6e,{})}),i.jsx(Vn,{h:"full",p:0,children:i.jsx(T6e,{})})]})]})},M6e=c.memo(A6e),E6e={height:"100%",width:"100%"},KU=c.memo(()=>{const e=c.useRef(null),t=c.useCallback(()=>{e.current&&e.current.setLayout([50,50])},[]);return i.jsx(Ce,{position:"relative",w:"full",h:"full",children:i.jsxs(qm,{ref:e,id:"workflow-panel-group",autoSaveId:"workflow-panel-group",direction:"vertical",style:E6e,children:[i.jsx(ur,{id:"workflow",collapsible:!0,minSize:25,children:i.jsx(M6e,{})}),i.jsx(eI,{onDoubleClick:t}),i.jsx(ur,{id:"inspector",collapsible:!0,minSize:25,children:i.jsx(x5e,{})})]})})});KU.displayName="EditModeLeftPanelContent";const P6e=e=>!!e.id&&e.meta.category!=="default",L6e=()=>{const{t:e}=M(),t=G(),n=NN(),[s,{isLoading:o,isError:r}]=Poe(),a=Lx(),l=c.useRef();return{saveWorkflow:c.useCallback(async u=>{l.current=a({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{await s(u).unwrap(),t(Loe()),t(_P({formFieldInitialValues:n()})),a.update(l.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{a.isActive(`auth-error-toast-${Ta.endpoints.updateWorkflow.name}`)?a.close(l.current):a.update(l.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}},[a,e,t,n,s]),isLoading:o,isError:r}},Sb=()=>{const e=pk(),t=Mc(),{saveWorkflow:n}=L6e();return c.useCallback(()=>{const o=e();P6e(o)&&!t?n(o):FN(o)},[e,t,n])},ZU=c.memo(()=>{const{t:e}=M(),t=Sb(),[n]=Doe(),s=A(Ax),o=c.useCallback(async()=>{if(s)try{await n(s).unwrap(),ge({title:e("toast.workflowUnpublished"),status:"success"})}catch{ge({title:e("toast.problemUnpublishingWorkflow"),description:e("toast.problemUnpublishingWorkflowDescription"),status:"error"})}},[n,s,e]);return i.jsxs(T,{flexDir:"column",w:"full",h:"full",gap:2,alignItems:"center",children:[i.jsx(zt,{size:"md",pt:32,children:e("workflows.builder.workflowLocked")}),i.jsx(W,{fontSize:"md",children:e("workflows.builder.publishedWorkflowsLocked")}),i.jsx(de,{size:"md",onClick:t,variant:"ghost",leftIcon:i.jsx(pn,{}),children:e("common.saveAs")}),i.jsx(de,{size:"md",onClick:o,variant:"ghost",leftIcon:i.jsx(ofe,{}),children:e("workflows.builder.unpublish")})]})});ZU.displayName="PublishedWorkflowPanelContent";const YU=c.memo(()=>{const e=A(XL);return e?i.jsx(Oe,{label:e,children:i.jsx(W,{color:"base.300",fontStyle:"italic",sx:ig,noOfLines:1,children:i.jsx(rg,{options:og,children:e})})}):null});YU.displayName="ActiveWorkflowDescription";const D6e=()=>{const e=Vx(),{t}=M(),n=A(sy);return i.jsx(de,{variant:"ghost",rightIcon:i.jsx(vfe,{}),size:"sm",onClick:e.open,children:i.jsx(W,{display:"auto",noOfLines:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",wordBreak:"break-all",children:n||t("workflows.chooseWorkflowFromLibrary")})})},XU=c.memo(()=>{const e=G(),t=A(kr),{t:n}=M(),s=c.useCallback(r=>{r.stopPropagation(),e(Za("edit"))},[e]),o=c.useCallback(r=>{r.stopPropagation(),e(Za("view"))},[e]);return t==="view"?i.jsx(le,{"aria-label":n("nodes.editMode"),tooltip:n("nodes.editMode"),onClick:s,icon:i.jsx(Cfe,{}),variant:"ghost",size:"sm"}):i.jsx(le,{"aria-label":n("nodes.viewMode"),tooltip:n("nodes.viewMode"),onClick:o,icon:i.jsx(Du,{}),variant:"ghost",size:"sm"})});XU.displayName="WorkflowViewEditToggleButton";const R6e=()=>{const e=G(),t=pk();return c.useCallback(()=>{const s=t(),o=new Blob([JSON.stringify(s,null,2)]),r=document.createElement("a");r.href=URL.createObjectURL(o),r.download=`${s.name||"My Workflow"}.json`,document.body.appendChild(r),r.click(),r.remove(),e(SP())},[t,e])},O6e=()=>{const{t:e}=M(),t=R6e();return i.jsx(fe,{as:"button",icon:i.jsx(Lu,{}),onClick:t,children:e("workflows.downloadWorkflow")})},N6e=c.memo(O6e),F6e=()=>{const{t:e}=M(),t=re(ln),{onOpen:n}=ON();return i.jsx(fe,{as:"button",icon:i.jsx(oj,{}),onClick:n,isDisabled:!SS(t),children:e("workflows.loadFromGraph")})},B6e=c.memo(F6e),QU=c.memo(()=>{const{t:e}=M(),t=Bj();return i.jsx(fe,{as:"button",icon:i.jsx(xf,{}),onClick:t.createWithDialog,children:e("nodes.newWorkflow")})});QU.displayName="NewWorkflowMenuItem";const $6e=()=>{const{t:e}=M(),t=pk(),n=c.useCallback(s=>{s.stopPropagation();const o=t();FN(o)},[t]);return i.jsx(fe,{as:"button",icon:i.jsx(pn,{}),onClick:n,children:e("workflows.saveWorkflowAs")})},V6e=c.memo($6e),z6e=()=>{const{t:e}=M(),t=Sb(),n=_c(),s=Mc();return i.jsx(fe,{as:"button",isDisabled:!n||!!s,icon:i.jsx(ar,{}),onClick:t,children:e("workflows.saveWorkflow")})},G6e=c.memo(z6e),H6e=()=>{const{t:e}=M(),t=ol(),n=c.useCallback(([r])=>{r&&t({type:"file",data:r})},[t]),{getRootProps:s,getInputProps:o}=da({accept:{"application/json":[".json"]},onDropAccepted:n,noDrag:!0,multiple:!1});return i.jsxs(fe,{as:"button",icon:i.jsx(jm,{}),...s(),children:[e("workflows.uploadWorkflow"),i.jsx("input",{...o()})]})},W6e=c.memo(H6e),JU=c.memo(()=>{const{t:e}=M(),{isOpen:t,onOpen:n,onClose:s}=hi(),o=dl();return tm(s),i.jsxs(on,{isOpen:t,onOpen:n,onClose:s,children:[i.jsx(rn,{as:le,"aria-label":e("workflows.workflowEditorMenu"),icon:i.jsx(dj,{}),pointerEvents:"auto",size:"sm",variant:"ghost"}),i.jsxs(Et,{pointerEvents:"auto",children:[i.jsx(QU,{}),i.jsx(W6e,{}),i.jsx(bs,{}),i.jsx(G6e,{}),i.jsx(V6e,{}),i.jsx(N6e,{}),o&&i.jsx(bs,{}),o&&i.jsx(B6e,{})]})]})});JU.displayName="WorkflowLibraryMenu";const U6e=()=>{const{t:e}=M(),t=Sb();return i.jsx(le,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:i.jsx(ar,{}),onClick:t,pointerEvents:"auto",variant:"ghost",size:"sm"})},q6e=c.memo(U6e),eq=c.memo(()=>{const e=A(kr),t=Mc();return i.jsxs(T,{w:"full",alignItems:"center",gap:1,minW:0,children:[i.jsx(D6e,{}),i.jsx(Je,{}),e==="edit"&&!t&&i.jsx(q6e,{}),i.jsx(XU,{}),i.jsx(JU,{})]})});eq.displayName="ActiveWorkflowNameAndActions";const K6e=()=>{const e=Roe();return i.jsx(T,{w:"full",h:"full",userSelect:"none",justifyContent:"center",children:i.jsxs(T,{alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:5,maxW:"230px",pt:24,children:[i.jsx(Zt,{src:HS,alt:"invoke-ai-logo",opacity:.2,mixBlendMode:"overlay",w:16,h:16,minW:16,minH:16,userSelect:"none"}),e?i.jsx(Z6e,{}):i.jsx(Y6e,{})]})})},Z6e=()=>{const{t:e}=M(),t=G(),n=Vx(),s=c.useCallback(()=>{t(Za("edit"))},[t]);return i.jsxs(i.Fragment,{children:[i.jsxs(T,{gap:2,children:[i.jsx(de,{size:"sm",onClick:s,children:e("nodes.newWorkflow")}),i.jsx(de,{size:"sm",colorScheme:"invokeBlue",onClick:n.open,children:e("nodes.loadWorkflow")})]}),i.jsx(W,{textAlign:"center",fontSize:"md",children:i.jsx(Wt,{i18nKey:"nodes.workflowHelpText",size:"sm",components:X6e})})]})},Y6e=()=>{const{t:e}=M(),t=G(),n=c.useCallback(()=>{t(Za("edit"))},[t]);return i.jsxs(i.Fragment,{children:[i.jsx(W,{textAlign:"center",fontSize:"md",children:e("nodes.noFieldsViewMode")}),i.jsx(de,{size:"sm",colorScheme:"invokeBlue",onClick:n,children:e("nodes.edit")})]})},X6e={LinkComponent:i.jsx(Wf,{fontSize:"md",fontWeight:"semibold",href:"https://support.invoke.ai/support/solutions/articles/151000159663-example-workflows",target:"_blank"})},tq=c.memo(()=>i.jsx(Ce,{position:"relative",w:"full",h:"full",children:i.jsx(ns,{children:i.jsx(nq,{})})}));tq.displayName="ViewModeLeftPanelContent";const nq=c.memo(()=>{const{isLoading:e}=Rx(),t=re(Kf),n=A(YL);return e||!t?i.jsx(Ot,{label:Me("nodes.loadingNodes"),icon:null}):n?i.jsx(K6e,{}):i.jsx(T,{w:"full",justifyContent:"center",children:i.jsx(IU,{})})});nq.displayName=" ViewModeLeftPanelContentInner";const Q6e=()=>{const e=A(kr),t=Mc(),n=re(ca);return i.jsxs(T,{w:"full",h:"full",gap:2,flexDir:"column",children:[n&&i.jsx(FU,{}),!n&&i.jsx(eq,{}),!n&&!t&&e==="view"&&i.jsx(YU,{}),!n&&!t&&e==="view"&&i.jsx(tq,{}),!n&&!t&&e==="edit"&&i.jsx(KU,{}),t&&i.jsx(ZU,{})]})},J6e=c.memo(Q6e),sq=c.memo(()=>{const e=Bt("cancelAndClearAll");return dl()?e?i.jsx(oq,{}):i.jsx(rq,{}):i.jsx(iq,{})});sq.displayName="ClearQueueIconButton";const iq=c.memo(()=>{const{t:e}=M(),t=dy();return i.jsx(le,{size:"lg",isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.cancel"),tooltip:e("queue.cancelTooltip"),icon:i.jsx(Rt,{}),colorScheme:"error",onClick:t.cancelQueueItem})});iq.displayName="CancelCurrentIconButton";const oq=c.memo(()=>{const{t:e}=M(),t=Dm();return i.jsx(le,{size:"lg",isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),tooltip:e("queue.clearTooltip"),icon:i.jsx(Pi,{}),colorScheme:"error",onClick:t.openDialog})});oq.displayName="CancelAndClearAllIconButton";const rq=c.memo(()=>{const{t:e}=M(),t=Lm();return i.jsx(le,{size:"lg",isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),tooltip:e("queue.cancelAllExceptCurrentTooltip"),icon:i.jsx(Ey,{}),colorScheme:"error",onClick:t.openDialog})});rq.displayName="CancelAllExceptCurrentIconButton";const aq=c.memo(({targetRef:e})=>{const[t,n]=c.useState(null),s=re(hC),{queueSize:o}=uo(void 0,{selectFromResult:r=>({queueSize:r.data?r.data.queue.pending+r.data.queue.in_progress:0})});return c.useEffect(()=>{if(!e.current)return;const r=e.current,a=r.parentElement;if(!a)return;const l=()=>{if(!hC.get())return;const{x:u,y:h}=r.getBoundingClientRect();n({x:`${u-7}px`,y:`${h-5}px`})},d=new ResizeObserver(l);return d.observe(a),l(),()=>{d.disconnect()}},[e]),o===0||!t||!s?null:i.jsx(al,{children:i.jsx(Hn,{pos:"absolute",insetInlineStart:t.x,insetBlockStart:t.y,colorScheme:"invokeYellow",zIndex:"docked",shadow:"dark-lg",userSelect:"none",children:o})})});aq.displayName="QueueCountBadge";const lq=()=>{const{t:e}=M(),t=re(Jn),{data:n}=uo(),[s,{isLoading:o}]=vL({fixedCacheKey:"pauseProcessor"}),r=c.useMemo(()=>!!(n!=null&&n.processor.is_started),[n==null?void 0:n.processor.is_started]),a=c.useCallback(async()=>{if(r)try{await s().unwrap(),ge({id:"PAUSE_SUCCEEDED",title:e("queue.pauseSucceeded"),status:"success"})}catch{ge({id:"PAUSE_FAILED",title:e("queue.pauseFailed"),status:"error"})}},[r,s,e]),l=c.useMemo(()=>!t||!r,[t,r]);return{pauseProcessor:a,isLoading:o,isStarted:r,isDisabled:l}},cq=()=>{const e=re(Jn),{data:t}=uo(),{t:n}=M(),[s,{isLoading:o}]=bL({fixedCacheKey:"resumeProcessor"}),r=c.useMemo(()=>!!(t!=null&&t.processor.is_started),[t==null?void 0:t.processor.is_started]),a=c.useCallback(async()=>{if(!r)try{await s().unwrap(),ge({id:"PROCESSOR_RESUMED",title:n("queue.resumeSucceeded"),status:"success"})}catch{ge({id:"PROCESSOR_RESUME_FAILED",title:n("queue.resumeFailed"),status:"error"})}},[r,s,n]),l=c.useMemo(()=>!e||r,[e,r]);return{resumeProcessor:a,isLoading:o,isStarted:r,isDisabled:l}},dq=c.memo(()=>{const e=c.useRef(null),t=G(),{t:n}=M(),s=Bt("pauseQueue"),o=Bt("resumeQueue"),r=Bt("cancelAndClearAll"),a=Lm(),l=dy(),d=Dm(),{resumeProcessor:u,isLoading:h,isDisabled:p}=cq(),{pauseProcessor:f,isLoading:m,isDisabled:g}=lq(),x=c.useCallback(()=>{t(Yt("queue"))},[t]);return i.jsxs(i.Fragment,{children:[i.jsxs(on,{placement:"bottom-end",children:[i.jsx(rn,{ref:e,as:le,size:"lg","aria-label":"Queue Actions Menu",icon:i.jsx(sfe,{})}),i.jsxs(Et,{children:[i.jsx(ki,{title:n("common.new"),children:i.jsx($_,{})}),i.jsxs(ki,{title:n("queue.queue"),children:[i.jsx(fe,{isDestructive:!0,icon:i.jsx(Rt,{}),onClick:l.cancelQueueItem,isLoading:l.isLoading,isDisabled:l.isDisabled,children:n("queue.cancelTooltip")}),i.jsx(fe,{isDestructive:!0,icon:i.jsx(Ey,{}),onClick:a.openDialog,isLoading:a.isLoading,isDisabled:a.isDisabled,children:n("queue.cancelAllExceptCurrentTooltip")}),r&&i.jsx(fe,{isDestructive:!0,icon:i.jsx(Pi,{}),onClick:d.openDialog,isLoading:d.isLoading,isDisabled:d.isDisabled,children:n("queue.clearTooltip")}),o&&i.jsx(fe,{icon:i.jsx(H7,{}),onClick:u,isLoading:h,isDisabled:p,children:n("queue.resumeTooltip")}),s&&i.jsx(fe,{icon:i.jsx(G7,{}),onClick:f,isLoading:m,isDisabled:g,children:n("queue.pauseTooltip")}),i.jsx(fe,{icon:i.jsx(O7,{}),onClick:x,children:n("queue.openQueue")})]})]})]}),i.jsx(aq,{targetRef:e})]})});dq.displayName="QueueActionsMenuButton";const eMe=e=>({bg:"base.700",w:"72px",cursor:"pointer","&[data-checked]":{".thumb":{left:`calc(100% - ${e})`,transform:"translateX(-100%)",bg:"invokeGreen.300"},".unchecked-icon":{color:"base.50",opacity:.4},".checked-icon":{color:"base.900",opacity:1}},"&[data-disabled]":{bg:"base.700",".thumb":{bg:"base.500"},".unchecked-icon":{color:"base.800"},".checked-icon":{color:"base.800"}},".thumb":{transition:"left 0.1s ease-in-out, transform 0.1s ease-in-out",left:e,transform:"translateX(0)",bg:"invokeBlue.400",shadow:"md"},".unchecked-icon":{color:"base.900",opacity:1},".checked-icon":{color:"base.50",opacity:.4}}),uq=c.memo(()=>{const{t:e}=M(),t=G(),n=A(fk),s=A(li),o=ek("space",1),r=c.useMemo(()=>eMe(o),[o]),a=c.useCallback(h=>{t(Ooe(h.target.checked))},[t]),{getCheckboxProps:l,getInputProps:d,htmlProps:u}=Noe({onChange:a,isChecked:n,isDisabled:s});return i.jsxs(es,{trigger:"hover",children:[i.jsx(ds,{children:i.jsx(Sr.label,{...u,children:i.jsxs(T,{position:"relative",borderRadius:"base",alignItems:"center",justifyContent:"space-between",h:"full",p:o,gap:o,sx:r,...l(),children:[i.jsx("input",{...d(),hidden:!0}),i.jsx(Ce,{className:"thumb",position:"absolute",borderRadius:"base",w:10,top:o,bottom:o}),i.jsx(T,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:i.jsx(at,{className:"unchecked-icon",w:6,h:6,as:su,"aria-label":e("controlLayers.sendToGallery")})}),i.jsx(T,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:i.jsx(at,{className:"checked-icon",w:6,h:6,as:rj,"aria-label":e("controlLayers.sendToCanvas")})})]})})}),i.jsx(al,{children:i.jsxs(ts,{maxW:296,p:2,bg:"base.200",color:"base.800",children:[i.jsx(po,{bg:"base.200",left:n?"18px !important":"-18px !important",transitionProperty:"all",transitionDuration:"0.2s"}),i.jsx(us,{children:i.jsx(hq,{})})]})})]})});uq.displayName="SendToToggle";const hq=c.memo(()=>{const{t:e}=M(),t=A(fk);return A(li)?i.jsxs(T,{flexDir:"column",children:[i.jsx(W,{fontWeight:"semibold",children:e("controlLayers.sendingToCanvas")}),i.jsx(W,{fontWeight:"normal",children:i.jsx(Wt,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:i.jsx(pq,{})}})})]}):i.jsxs(T,{flexDir:"column",children:[i.jsx(W,{fontWeight:"semibold",children:e(t?"controlLayers.sendToCanvas":"controlLayers.sendToGallery")}),i.jsx(W,{fontWeight:"normal",children:e(t?"controlLayers.sendToCanvasDesc":"controlLayers.sendToGalleryDesc")})]})});hq.displayName="TooltipContent";const pq=c.memo(e=>{const t=G(),n=c.useCallback(()=>{t(Yt("canvas")),t(ji("layers")),DS.set(!1)},[t]);return i.jsx(de,{onClick:n,size:"sm",variant:"link",color:"base.800",_hover:{color:"base.900",textDecoration:"underline"},children:e.children})});pq.displayName="ActivateCanvasButton";const tMe=()=>{const{t:e}=M(),t=Uj(),{data:n}=uo(),s=re(Jn),o=re(zr),r=c.useMemo(()=>o?(o.percentage??0)*100:0,[o]),a=c.useMemo(()=>!s||!(n!=null&&n.queue.in_progress)?!1:!o||o.percentage===null,[s,o,n==null?void 0:n.queue.in_progress]),l=c.useMemo(()=>t==="canvas"?"invokeGreen":t==="gallery"?"invokeBlue":"base",[t]);return i.jsx(W8,{value:r,"aria-label":e("accessibility.invokeProgressBar"),isIndeterminate:a,h:2,w:"full",colorScheme:l})},nMe=c.memo(tMe),fq=c.memo(()=>{const e=A(mk),t=A(Foe),n=G(),s=c.useCallback(o=>{n(Boe(o))},[n]);return i.jsx($e,{feature:"paramIterations",children:i.jsx(_e,{step:t.coarseStep,fineStep:t.fineStep,min:1,max:t.numberInputMax,onChange:s,value:e,defaultValue:1,pos:"absolute",insetInlineEnd:0,h:"full",ps:0,w:"72px",flexShrink:0,variant:"iterations"})})});fq.displayName="QueueIterationsNumberInput";const mq=({prepend:e,children:t,...n})=>i.jsx(Oe,{label:i.jsx(gq,{prepend:e}),maxW:512,...n,children:t}),gq=c.memo(({prepend:e=!1})=>{const t=A(On);return t==="canvas"?i.jsx(xq,{prepend:e}):t==="workflows"?i.jsx(bq,{prepend:e}):t==="upscaling"?i.jsx(yq,{prepend:e}):null});gq.displayName="TooltipContent";const xq=c.memo(({prepend:e=!1})=>{const t=re(Au),n=re(Fa);return i.jsxs(T,{flexDir:"column",gap:1,children:[i.jsx(kb,{isReady:t,prepend:e}),i.jsx(DI,{}),n.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Lf,{}),i.jsx(jb,{reasons:n})]}),i.jsx(Lf,{}),i.jsx(wq,{})]})});xq.displayName="CanvasTabTooltipContent";const yq=c.memo(({prepend:e=!1})=>{const t=re(Au),n=re(Fa);return i.jsxs(T,{flexDir:"column",gap:1,children:[i.jsx(kb,{isReady:t,prepend:e}),i.jsx(DI,{}),n.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Lf,{}),i.jsx(jb,{reasons:n})]})]})});yq.displayName="UpscaleTabTooltipContent";const bq=c.memo(({prepend:e=!1})=>{const t=re(Au),n=re(Fa);return i.jsxs(T,{flexDir:"column",gap:1,children:[i.jsx(kb,{isReady:t,prepend:e}),i.jsx(vq,{}),n.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Lf,{}),i.jsx(jb,{reasons:n})]})]})});bq.displayName="WorkflowsTabTooltipContent";const DI=c.memo(()=>{const{t:e}=M(),t=A(Pde),n=A(mk),s=c.useMemo(()=>{const o=Math.min(t*n,1e4),r=e("queue.prompts",{count:t}),a=e("queue.iterations",{count:n}),l=e("queue.generations",{count:o});return`${t} ${r}  ${n} ${a} -> ${o} ${l}`.toLowerCase()},[n,t,e]);return i.jsx(W,{children:s})});DI.displayName="QueueCountPredictionCanvasOrUpscaleTab";const vq=c.memo(()=>{const{t:e}=M(),t=G(),n=A(Xe),[s,o]=c.useState("LOADING"),r=c.useMemo(()=>Di(async d=>{o("LOADING");const u=await bde(d,t);o(u)},300),[t]);c.useEffect(()=>{r(n)},[r,n]);const a=A(mk),l=c.useMemo(()=>{if(s==="LOADING")return`${e("common.loading")}...`;const d=e("queue.iterations",{count:a});if(s==="NO_BATCHES"){const p=Math.min(1e4,a),f=e("queue.generations",{count:p});return`${a} ${d} -> ${p} ${f}`.toLowerCase()}if(s==="EMPTY_BATCHES")return e("parameters.invoke.batchNodeEmptyCollection");if(s==="MISMATCHED_BATCH_GROUP")return e("parameters.invoke.batchNodeCollectionSizeMismatchNoGroupId");const u=Math.min(s*a,1e4),h=e("queue.generations",{count:u});return`${s} ${e("queue.batchSize")}  ${a} ${d} -> ${u} ${h}`.toLowerCase()},[s,a,e]);return i.jsx(W,{children:l})});vq.displayName="QueueCountPredictionWorkflowsTab";const kb=c.memo(({isReady:e,prepend:t})=>{const{t:n}=M(),s=A($x),[o,r]=CS(zf),a=re(ca),l=Mc(),d=c.useMemo(()=>r.isLoading?n("queue.enqueueing"):n(s?"dynamicPrompts.loading":a?"workflows.builder.publishInProgress":l?"workflows.builder.publishedWorkflowIsLocked":e?t?"queue.queueFront":"queue.queueBack":"queue.notReady"),[r.isLoading,s,a,l,e,n,t]);return i.jsx(W,{fontWeight:"semibold",children:d})});kb.displayName="IsReadyText";const jb=c.memo(({reasons:e})=>i.jsx(ai,{children:e.map((t,n)=>i.jsx(Cq,{reason:t},`${t.content}.${n}`))}));jb.displayName="ReasonsList";const Cq=c.memo(({reason:e})=>i.jsx(Ft,{children:i.jsxs("span",{children:[e.prefix&&i.jsxs(W,{as:"span",fontWeight:"semibold",children:[e.prefix,":"," "]}),i.jsx(W,{as:"span",children:e.content})]})}));Cq.displayName="ReasonListItem";const Lf=c.memo(()=>i.jsx(Ct,{opacity:.2,borderColor:"base.900"}));Lf.displayName="StyledDivider";const wq=c.memo(()=>{const{t:e}=M(),t=A(fk),n=A(qs),s=Pm(n),o=c.useMemo(()=>e(t?"controlLayers.stagingOnCanvas":"parameters.invoke.addingImagesTo"),[t,e]),r=c.useMemo(()=>t?e("queue.canvas"):s||e("boards.uncategorized"),[s,t,e]);return i.jsxs(W,{fontStyle:"oblique 10deg",children:[o," ",i.jsx(W,{as:"span",fontWeight:"semibold",children:r})]})});wq.displayName="AddingToText";const FE="Invoke",Sq=c.memo(()=>{const e=Dk(),t=dl(),n=A($x);return i.jsxs(T,{pos:"relative",w:"200px",children:[i.jsx(fq,{}),i.jsx(mq,{prepend:t,children:i.jsxs(de,{onClick:t?e.enqueueFront:e.enqueueBack,isLoading:e.isLoading||n,loadingText:FE,isDisabled:e.isDisabled,rightIcon:t?i.jsx(Ou,{}):i.jsx(Ty,{}),variant:"solid",colorScheme:"invokeYellow",size:"lg",w:"calc(100% - 60px)",flexShrink:0,justifyContent:"space-between",spinnerPlacement:"end",children:[i.jsx("span",{children:FE}),i.jsx(Je,{})]})})]})});Sq.displayName="InvokeQueueBackButton";const sMe=()=>{const e=A(On);return i.jsxs(T,{w:"full",position:"relative",borderRadius:"base",gap:2,flexDir:"column",children:[i.jsxs(T,{gap:2,children:[i.jsx(Sq,{}),i.jsx(Je,{}),e==="canvas"&&i.jsx(Xo,{children:i.jsx(uq,{})}),i.jsx(dq,{}),i.jsx(sq,{})]}),i.jsx(nMe,{})]})},iMe=c.memo(sMe),oMe=e=>{const{t}=M();return i.jsx(T,{pos:"absolute",transform:"translate(0, -50%)",minW:8,top:"50%",insetInlineEnd:2,children:i.jsx(Oe,{label:t("accessibility.toggleRightPanel"),placement:"start",children:i.jsx(le,{"aria-label":t("accessibility.toggleRightPanel"),onClick:e.panelApi.toggle,icon:i.jsx(Qpe,{}),h:48})})})},rMe=c.memo(oMe),kq=c.memo(()=>{const{t:e}=M(),t=Dc("bbox"),n=pa("bbox"),s=$t();return De({id:"selectBboxTool",category:"canvas",callback:t,options:{enabled:!n&&!s.isOpen},dependencies:[t,n,s.isOpen]}),i.jsx(Oe,{label:`${e("controlLayers.tool.bbox")} (C)`,placement:"end",children:i.jsx(le,{"aria-label":`${e("controlLayers.tool.bbox")} (C)`,icon:i.jsx(pl,{}),colorScheme:n?"invokeBlue":"base",variant:"solid",onClick:t})})});kq.displayName="ToolBboxButton";const jq=c.memo(()=>{const{t:e}=M(),t=pa("brush"),n=Dc("brush"),s=$t();return De({id:"selectBrushTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),i.jsx(Oe,{label:`${e("controlLayers.tool.brush")} (B)`,placement:"end",children:i.jsx(le,{"aria-label":`${e("controlLayers.tool.brush")} (B)`,icon:i.jsx(rj,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});jq.displayName="ToolBrushButton";const _q=c.memo(()=>{const{t:e}=M(),t=pa("colorPicker"),n=Dc("colorPicker"),s=$t();return De({id:"selectColorPickerTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),i.jsx(Oe,{label:`${e("controlLayers.tool.colorPicker")} (I)`,placement:"end",children:i.jsx(le,{"aria-label":`${e("controlLayers.tool.colorPicker")} (I)`,icon:i.jsx(qpe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});_q.displayName="ToolColorPickerButton";const Iq=c.memo(()=>{const{t:e}=M(),t=pa("move"),n=Dc("move"),s=$t();return De({id:"selectMoveTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),i.jsx(Oe,{label:`${e("controlLayers.tool.move")} (V)`,placement:"end",children:i.jsx(le,{"aria-label":`${e("controlLayers.tool.move")} (V)`,icon:i.jsx(zpe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Iq.displayName="ToolMoveButton";const Tq=c.memo(()=>{const{t:e}=M(),t=pa("rect"),n=Dc("rect"),s=$t();return De({id:"selectRectTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),i.jsx(Oe,{label:`${e("controlLayers.tool.rectangle")} (U)`,placement:"end",children:i.jsx(le,{"aria-label":`${e("controlLayers.tool.rectangle")} (U)`,icon:i.jsx(lfe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Tq.displayName="ToolRectButton";const Aq=c.memo(()=>{const{t:e}=M(),t=pa("eraser"),n=Dc("eraser"),s=$t();return De({id:"selectEraserTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),i.jsx(Oe,{label:`${e("controlLayers.tool.eraser")} (E)`,placement:"end",children:i.jsx(le,{"aria-label":`${e("controlLayers.tool.eraser")} (E)`,icon:i.jsx(Hpe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Aq.displayName="ToolEraserButton";const Mq=c.memo(()=>{const{t:e}=M(),t=pa("view"),n=Dc("view"),s=$t();return De({id:"selectViewTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),i.jsx(Oe,{label:`${e("controlLayers.tool.view")} (H)`,placement:"end",children:i.jsx(le,{"aria-label":`${e("controlLayers.tool.view")} (H)`,icon:i.jsx(Ype,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Mq.displayName="ToolViewButton";const aMe=()=>i.jsx(i.Fragment,{children:i.jsxs(Qn,{isAttached:!0,orientation:"vertical",children:[i.jsx(jq,{}),i.jsx(Aq,{}),i.jsx(Tq,{}),i.jsx(Iq,{}),i.jsx(Mq,{}),i.jsx(kq,{}),i.jsx(_q,{})]})}),lMe=({togglePanel:e})=>{const{t}=M(),n=A(On),s=$t(),o=Bt("cancelAndClearAll");return i.jsxs(T,{pos:"absolute",transform:"translate(0, -50%)",top:"50%",insetInlineStart:2,direction:"column",gap:2,children:[n==="canvas"&&!s.isOpen&&i.jsx(Xo,{children:i.jsx(aMe,{})}),i.jsxs(Qn,{orientation:"vertical",h:48,children:[i.jsx(Oe,{label:t("accessibility.toggleLeftPanel"),placement:"end",children:i.jsx(le,{"aria-label":t("accessibility.toggleLeftPanel"),onClick:e,icon:i.jsx(pfe,{}),flexGrow:1})}),i.jsx(Eq,{}),i.jsx(Pq,{}),o&&i.jsx(Lq,{}),!o&&i.jsx(Dq,{})]})]})},cMe=c.memo(lMe),Eq=c.memo(()=>{const{t:e}=M(),t=Dk(),n=dl(),{data:s}=uo(),o=c.useMemo(()=>{const r=((s==null?void 0:s.queue.in_progress)??0)>0;return!t.isDisabled&&r?i.jsx(at,{boxSize:6,as:$pe,animation:iy}):n?i.jsx(Ou,{}):i.jsx(Ty,{})},[t.isDisabled,s==null?void 0:s.queue.in_progress,n]);return i.jsx(mq,{prepend:n,placement:"end",children:i.jsx(le,{"aria-label":e("queue.queueBack"),onClick:n?t.enqueueFront:t.enqueueBack,isLoading:t.isLoading,isDisabled:t.isDisabled,icon:o,colorScheme:"invokeYellow",flexGrow:1})})});Eq.displayName="InvokeIconButton";const Pq=c.memo(()=>{const{t:e}=M(),t=dy();return i.jsx(Oe,{label:e("queue.cancelTooltip"),placement:"end",children:i.jsx(le,{isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.cancelTooltip"),icon:i.jsx(Rt,{}),onClick:t.cancelQueueItem,colorScheme:"error",flexGrow:1})})});Pq.displayName="CancelCurrentIconButton";const Lq=c.memo(()=>{const{t:e}=M(),t=Dm();return i.jsx(Oe,{label:e("queue.clearTooltip"),placement:"end",children:i.jsx(le,{isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clearTooltip"),icon:i.jsx(Pi,{}),colorScheme:"error",onClick:t.openDialog,flexGrow:1})})});Lq.displayName="CancelAndClearAllIconButton";const Dq=c.memo(()=>{const{t:e}=M(),t=Lm();return i.jsx(Oe,{label:e("queue.cancelAllExceptCurrentTooltip"),placement:"end",children:i.jsx(le,{isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),icon:i.jsx(Ey,{}),colorScheme:"error",onClick:t.openDialog,flexGrow:1})})});Dq.displayName="CancelAllExceptCurrentIconButton";const _b=(e,t,n)=>{const{dispatch:s,getState:o}=cn(),r=c.useCallback(l=>{s($oe({id:e,size:l}))},[s,e]),a=c.useMemo(()=>Di(r,300),[r]);c.useEffect(()=>{const l=t.current;if(!l||!n.trackHeight&&!n.trackWidth)return;const d=xc(o()).textAreaSizes[e];(d==null?void 0:d.width)!==void 0?l.style.width=`${d.width}px`:n.initialWidth!==void 0&&(l.style.width=`${n.initialWidth}px`),(d==null?void 0:d.height)!==void 0?l.style.height=`${d.height}px`:n.initialHeight!==void 0&&(l.style.height=`${n.initialHeight}px`);let u=l.offsetHeight,h=l.offsetWidth;const p=new ResizeObserver(()=>{let f=!1;const m={};n.trackHeight&&(l.offsetHeight!==u&&(f=!0,u=l.offsetHeight),m.height=u),n.trackWidth&&(l.offsetWidth!==h&&(f=!0,h=l.offsetWidth),m.width=h),f&&a(m)});return p.observe(l),()=>{a.cancel(),p.disconnect()}},[a,s,o,e,n.initialHeight,n.initialWidth,n.trackHeight,n.trackWidth,t])},cg=({label:e})=>i.jsx(W,{variant:"subtext",fontWeight:"semibold",pos:"absolute",top:1,left:2,children:e}),dg=c.memo(e=>i.jsx(T,{pos:"absolute",insetBlockStart:0,insetInlineEnd:0,flexDir:"column",p:2,gap:2,alignItems:"center",justifyContent:"center",children:e.children}));dg.displayName="PromptOverlayButtonWrapper";const dMe=(e,t)=>{if(!t||!t.length)return["",e,""];if(!t.includes(Jl))return["",`${e} `,t];const[n,...s]=t.split(Jl);return[n||"",e,s.join(Jl)||""]},Rq=({presetPrompt:e,prompt:t,label:n})=>{const s=G(),{t:o}=M(),r=c.useMemo(()=>dMe(t,e),[e,t]),a=c.useCallback(()=>{s(w0(!1))},[s]);return i.jsx(Ce,{position:"absolute",top:0,bottom:0,left:0,right:0,layerStyle:"second",borderRadius:"base",children:i.jsxs(T,{flexDir:"column",onClick:a,justifyContent:"space-between",h:"full",borderWidth:1,borderTopWidth:24,borderColor:"transparent",paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,children:[i.jsx(cg,{label:n}),i.jsx(T,{overflow:"scroll",children:i.jsx(W,{w:"full",lineHeight:"short",children:r.map((l,d)=>i.jsx(W,{as:"span",color:d===1?"white":"base.200",fontWeight:d===1?"semibold":"normal",children:l},d))})}),i.jsx(Oe,{label:o("stylePresets.viewModeTooltip"),children:i.jsx(T,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,alignItems:"center",justifyContent:"center",p:2,bg:"base.900",opacity:.8,backgroundClip:"border-box",borderBottomStartRadius:"base",children:i.jsx(at,{as:Du,color:"base.500",boxSize:4})})})]})})},uMe={trackWidth:!1,trackHeight:!0},Oq=c.memo(()=>{var g;const e=G(),t=A(MP),n=A(gk),s=A(qf),o=c.useRef(null);_b("negative_prompt",o,uMe);const{activeStylePreset:r}=hm(void 0,{selectFromResult:({data:x})=>{let b=null;return x&&(b=x.find(C=>C.id===s)),{activeStylePreset:b}}}),{t:a}=M(),l=c.useCallback(x=>{e(QL(x))},[e]),{onChange:d,isOpen:u,onClose:h,onOpen:p,onSelect:f,onKeyDown:m}=eh({prompt:t,textareaRef:o,onChange:l});return i.jsx(Nc,{isOpen:u,onClose:h,onSelect:f,width:(g=o.current)==null?void 0:g.clientWidth,children:i.jsxs(Ce,{pos:"relative",w:"full",children:[i.jsx(ls,{id:"negativePrompt",name:"negativePrompt",ref:o,value:t,onChange:d,onKeyDown:m,fontSize:"sm",variant:"darkFilled",minH:28,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),i.jsx(dg,{children:i.jsx(Oc,{isOpen:u,onOpen:p})}),i.jsx(cg,{label:a("parameters.negativePromptPlaceholder")}),n&&i.jsx(Rq,{prompt:t,presetPrompt:(r==null?void 0:r.preset_data.negative_prompt)||"",label:`${a("parameters.negativePromptPlaceholder")} (${a("stylePresets.preview")})`})]})})});Oq.displayName="ParamNegativePrompt";const hMe={svg:{animation:iy}},Nq=c.memo(()=>{const{t:e}=M(),t=A($x),n=A(hP),{isOpen:s,onOpen:o}=IO();return i.jsx(Oe,{label:e(t?"dynamicPrompts.loading":"dynamicPrompts.showDynamicPrompts"),children:i.jsx(le,{size:"sm",variant:"promptOverlay",isDisabled:s,"aria-label":e("dynamicPrompts.showDynamicPrompts"),icon:i.jsx(Ope,{}),onClick:o,sx:t?hMe:void 0,colorScheme:n&&!t?"error":"base"})})});Nq.displayName="ShowDynamicPromptsPreviewButton";const Fq=c.memo(()=>{const e=A(Voe),t=G(),{t:n}=M(),s=c.useCallback(()=>{t(zoe(!e))},[t,e]),o=c.useMemo(()=>n(e?"sdxl.concatPromptStyle":"sdxl.freePromptStyle"),[e,n]);return i.jsx(Oe,{label:o,children:i.jsx(le,{"aria-label":o,onClick:s,icon:e?i.jsx(tfe,{size:14}):i.jsx(nfe,{size:14}),variant:"promptOverlay",fontSize:12,px:.5})})});Fq.displayName="SDXLConcatButton";const pMe={trackWidth:!1,trackHeight:!0,initialHeight:120},Bq=c.memo(()=>{var C;const e=G(),t=A(AP),n=A(la),s=A(gk),o=A(qf),r=c.useRef(null);_b("positive_prompt",r,pMe);const{activeStylePreset:a}=hm(void 0,{selectFromResult:({data:y})=>{let v=null;return y&&(v=y.find(w=>w.id===o)),{activeStylePreset:v}}}),{t:l}=M(),d=c.useCallback(y=>{e(JL(y))},[e]),{onChange:u,isOpen:h,onClose:p,onOpen:f,onSelect:m,onKeyDown:g,onFocus:x}=eh({prompt:t,textareaRef:r,onChange:d}),b=c.useCallback(y=>{x(),y.preventDefault()},[x]);return De({id:"focusPrompt",category:"app",callback:b,options:{preventDefault:!0,enableOnFormTags:["INPUT","SELECT","TEXTAREA"]},dependencies:[b]}),i.jsx(Nc,{isOpen:h,onClose:p,onSelect:m,width:(C=r.current)==null?void 0:C.clientWidth,children:i.jsxs(Ce,{pos:"relative",children:[i.jsx(ls,{id:"prompt",name:"prompt",ref:r,value:t,onChange:u,onKeyDown:g,variant:"darkFilled",borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,resize:"vertical",minH:28}),i.jsxs(dg,{children:[i.jsx(Oc,{isOpen:h,onOpen:f}),n==="sdxl"&&i.jsx(Fq,{}),i.jsx(Nq,{})]}),i.jsx(cg,{label:l("parameters.positivePromptPlaceholder")}),s&&i.jsx(Rq,{prompt:t,presetPrompt:(a==null?void 0:a.preset_data.positive_prompt)||"",label:`${l("parameters.positivePromptPlaceholder")} (${l("stylePresets.preview")})`})]})})});Bq.displayName="ParamPositivePrompt";const fMe={trackWidth:!1,trackHeight:!0},$q=c.memo(()=>{var p;const e=G(),t=A(Goe),n=c.useRef(null);_b("negative_style_prompt",n,fMe);const{t:s}=M(),o=c.useCallback(f=>{e(Hoe(f))},[e]),{onChange:r,isOpen:a,onClose:l,onOpen:d,onSelect:u,onKeyDown:h}=eh({prompt:t,textareaRef:n,onChange:o});return i.jsx(Nc,{isOpen:a,onClose:l,onSelect:u,width:(p=n.current)==null?void 0:p.clientWidth,children:i.jsxs(Ce,{pos:"relative",children:[i.jsx(ls,{id:"prompt",name:"prompt",ref:n,value:t,onChange:r,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),i.jsx(dg,{children:i.jsx(Oc,{isOpen:a,onOpen:d})}),i.jsx(cg,{label:s("sdxl.negStylePrompt")})]})})});$q.displayName="ParamSDXLNegativeStylePrompt";const mMe={trackWidth:!1,trackHeight:!0},Vq=c.memo(()=>{var p;const e=G(),t=A(Woe),n=c.useRef(null);_b("positive_style_prompt",n,mMe);const{t:s}=M(),o=c.useCallback(f=>{e(Uoe(f))},[e]),{onChange:r,isOpen:a,onClose:l,onOpen:d,onSelect:u,onKeyDown:h}=eh({prompt:t,textareaRef:n,onChange:o});return i.jsx(Nc,{isOpen:a,onClose:l,onSelect:u,width:(p=n.current)==null?void 0:p.clientWidth,children:i.jsxs(Ce,{pos:"relative",children:[i.jsx(ls,{id:"prompt",name:"prompt",ref:n,value:t,onChange:r,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),i.jsx(dg,{children:i.jsx(Oc,{isOpen:a,onOpen:d})}),i.jsx(cg,{label:s("sdxl.posStylePrompt")})]})})});Vq.displayName="ParamSDXLPositiveStylePrompt";const gMe=qoe(e=>{var s;const t=((s=e.model)==null?void 0:s.base)==="sdxl",n=e.shouldConcatPrompts;return t&&!n}),RI=c.memo(()=>{const e=A(gMe),t=A(Ya),n=A(Qx);return i.jsxs(T,{flexDir:"column",gap:2,children:[i.jsx(Bq,{}),e&&i.jsx(Vq,{}),!t&&!n&&i.jsx(Oq,{}),e&&i.jsx($q,{})]})});RI.displayName="Prompts";const Ib=()=>{const e=A(XS),t=A(QS),n=A(Qx);return e||t||n},xMe=()=>{const e=A(eD),t=A(tD),n=G(),{t:s}=M(),o=c.useCallback(r=>n(Koe(r)),[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"paramCFGRescaleMultiplier",children:i.jsx(J,{children:s("parameters.cfgRescaleMultiplier")})}),i.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:!0}),i.jsx(_e,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},yMe=c.memo(xMe),bMe=()=>{const e=G(),{t}=M(),n=A(Zoe),[s,{isLoading:o}]=Ec(),r=c.useCallback(h=>{h&&e(Yoe(ro.parse(h)))},[e]),{options:a,value:l,onChange:d,noOptionsMessage:u}=yl({modelConfigs:s,onChange:r,selectedModel:n,isLoading:o});return i.jsxs(Q,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,gap:2,children:[i.jsx(J,{m:0,children:t("modelManager.clipEmbed")}),i.jsx(Ke,{value:l,options:a,onChange:d,noOptionsMessage:u})]})},vMe=c.memo(bMe),CMe=()=>{const e=G(),{t}=M(),n=A(Xoe),[s,{isLoading:o}]=Ec(),r=c.useCallback(h=>{h&&e(Qoe(ro.parse(h)))},[e]),{options:a,value:l,onChange:d,noOptionsMessage:u}=yl({modelConfigs:s.filter(h=>$L(h)),onChange:r,selectedModel:n,isLoading:o});return i.jsxs(Q,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,gap:2,children:[i.jsx(J,{m:0,children:t("modelManager.clipGEmbed")}),i.jsx(Ke,{value:l,options:a,onChange:d,noOptionsMessage:u})]})},wMe=c.memo(CMe),SMe=()=>{const e=G(),{t}=M(),n=A(Joe),[s,{isLoading:o}]=Ec(),r=c.useCallback(h=>{h&&e(ere(ro.parse(h)))},[e]),{options:a,value:l,onChange:d,noOptionsMessage:u}=yl({modelConfigs:s.filter(h=>VL(h)),onChange:r,selectedModel:n,isLoading:o});return i.jsxs(Q,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,gap:2,children:[i.jsx(J,{m:0,children:t("modelManager.clipLEmbed")}),i.jsx(Ke,{value:l,options:a,onChange:d,noOptionsMessage:u})]})},kMe=c.memo(SMe),jMe=()=>{const e=A(tre),t=A(nre),n=A(oc),s=G(),{t:o}=M(),r=c.useCallback(d=>{s(sre(d))},[s]),a=c.useMemo(()=>n?Sg[n.base].maxClip:Sg["sd-1"].maxClip,[n]),l=c.useMemo(()=>n?Sg[n.base].markers:Sg["sd-1"].markers,[n]);return(n==null?void 0:n.base)==="sdxl"?null:i.jsxs(Q,{children:[i.jsx($e,{feature:"clipSkip",children:i.jsx(J,{children:o("parameters.clipSkip")})}),i.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:a,step:t.coarseStep,fineStep:t.fineStep,onChange:r,marks:l}),i.jsx(_e,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:a,step:t.coarseStep,fineStep:t.fineStep,onChange:r})]})},_Me=c.memo(jMe),IMe=()=>{const e=G(),{t}=M(),n=A(ire),[s,{isLoading:o}]=bj(),r=c.useCallback(h=>{h&&e(ore(ro.parse(h)))},[e]),{options:a,value:l,onChange:d,noOptionsMessage:u}=yl({modelConfigs:s,onChange:r,selectedModel:n,isLoading:o});return i.jsxs(Q,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,gap:2,children:[i.jsx(J,{m:0,children:t("modelManager.t5Encoder")}),i.jsx(Ke,{value:l,options:a,onChange:d,noOptionsMessage:u})]})},BE=c.memo(IMe),TMe=()=>{const{t:e}=M(),t=A(rre),n=G(),s=c.useCallback(o=>{n(are(o.target.checked))},[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"seamlessTilingXAxis",children:i.jsx(J,{children:e("parameters.seamlessXAxis")})}),i.jsx(et,{isChecked:t,onChange:s})]})},AMe=c.memo(TMe),MMe=()=>{const{t:e}=M(),t=A(lre),n=G(),s=c.useCallback(o=>{n(cre(o.target.checked))},[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"seamlessTilingYAxis",children:i.jsx(J,{children:e("parameters.seamlessYAxis")})}),i.jsx(et,{isChecked:t,onChange:s})]})},EMe=c.memo(MMe),zq=c.memo(()=>{const e=A(EP),t=A(xk),{t:n}=M(),s=G(),o=c.useCallback(r=>s(nD(r)),[s]);return i.jsxs(Q,{flexGrow:1,isDisabled:t,children:[i.jsx($e,{feature:"paramSeed",children:i.jsx(J,{children:n("parameters.seed")})}),i.jsx(_e,{step:1,min:sD,max:_u,onChange:o,value:e,flexGrow:1,defaultValue:0})]})});zq.displayName="ParamSeedNumberInput";const Gq=c.memo(()=>{const e=G(),{t}=M(),n=A(xk),s=c.useCallback(o=>e(dre(o.target.checked)),[e]);return i.jsxs(Q,{w:"min-content",children:[i.jsx(J,{m:0,children:t("common.random")}),i.jsx(et,{isChecked:n,onChange:s})]})});Gq.displayName="ParamSeedRandomize";const Hq=c.memo(()=>{const e=G(),t=A(xk),{t:n}=M(),s=c.useCallback(()=>e(nD(ure(sD,_u))),[e]);return i.jsx(de,{size:"sm",isDisabled:t,onClick:s,leftIcon:i.jsx(hfe,{}),flexShrink:0,children:n("parameters.shuffle")})});Hq.displayName="ParamSeedShuffle";const OI=c.memo(e=>i.jsxs(T,{gap:4,alignItems:"center",...e,children:[i.jsx(zq,{}),i.jsx(Gq,{}),i.jsx(Hq,{})]}));OI.displayName="ParamSeed";const PMe=()=>{const e=G(),{t}=M(),n=A(hre),[s,{isLoading:o}]=M9(),r=c.useCallback(h=>{h&&e(pre(ro.parse(h)))},[e]),{options:a,value:l,onChange:d,noOptionsMessage:u}=ma({modelConfigs:s,onChange:r,selectedModel:n,isLoading:o});return i.jsxs(Q,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,gap:2,children:[i.jsx($e,{feature:"paramVAE",children:i.jsx(J,{m:0,children:t("modelManager.vae")})}),i.jsx(Ke,{value:l,options:a,onChange:d,noOptionsMessage:u})]})},LMe=c.memo(PMe),DMe=()=>{const e=G(),{t}=M(),n=A(la),s=A(iD),[o,{isLoading:r}]=Oy(),a=c.useCallback(f=>{const m=n===f.base;return!!!n||!m},[n]),l=c.useCallback(f=>{e(fre(f?ro.parse(f):null))},[e]),{options:d,value:u,onChange:h,noOptionsMessage:p}=ma({modelConfigs:o,onChange:l,selectedModel:s,isLoading:r,getIsDisabled:a});return i.jsxs(Q,{isDisabled:!d.length,isInvalid:!d.length,minW:0,flexGrow:1,gap:2,children:[i.jsx($e,{feature:"paramVAE",children:i.jsx(J,{m:0,children:t("modelManager.vae")})}),i.jsx(Ke,{isClearable:!0,value:u,placeholder:u?u.value:t("models.defaultVAE"),options:d,onChange:h,noOptionsMessage:p})]})},RMe=c.memo(DMe),$E=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],OMe=()=>{const{t:e}=M(),t=G(),n=A(oD),s=c.useCallback(r=>{rD(r==null?void 0:r.value)&&t(mre(r.value))},[t]),o=c.useMemo(()=>$E.find(r=>r.value===n),[n]);return i.jsxs(Q,{flexGrow:0,children:[i.jsx($e,{feature:"paramVAEPrecision",children:i.jsx(J,{m:0,children:e("modelManager.vaePrecision")})}),i.jsx(Ke,{value:o,options:$E,onChange:s})]})},NMe=c.memo(OMe),rh=e=>{const t=G(),n=c.useMemo(()=>he(xc,r=>r.accordions[e.id]??e.defaultIsOpen),[e]),s=A(n),o=c.useCallback(()=>{t(gre({id:e.id,isOpen:!s}))},[e.id,t,s]);return{isOpen:s,onToggle:o}},FMe={minW:"9.2rem"},BMe={flexGrow:1},NI=c.memo(()=>{const e=A(xre),{currentData:t}=lm(e??cs),n=A(On),s=A(Ya),o=A(Xx),r=c.useMemo(()=>fn([mu,Ya],(h,p)=>{const f=[];if(p){if(t){let m=t.name;h.vaePrecision==="fp16"&&(m+=` ${h.vaePrecision}`),f.push(m)}}else{if(t){let m=t.name;h.vaePrecision==="fp16"&&(m+=` ${h.vaePrecision}`),f.push(m)}else h.vaePrecision==="fp16"&&f.push(`VAE ${h.vaePrecision}`);h.clipSkip&&f.push(`Skip ${h.clipSkip}`),h.cfgRescaleMultiplier&&f.push(`Rescale ${h.cfgRescaleMultiplier}`),(h.seamlessXAxis||h.seamlessYAxis)&&f.push("seamless"),n==="upscaling"&&!h.shouldRandomizeSeed&&f.push("Manual Seed")}return f}),[t,n]),a=A(r),{t:l}=M(),{isOpen:d,onToggle:u}=rh({id:`'advanced-settings-${n}`,defaultIsOpen:!1});return i.jsx(Iu,{label:l("accordions.advanced.title"),badges:a,isOpen:d,onToggle:u,children:i.jsxs(T,{gap:4,alignItems:"center",p:4,flexDir:"column","data-testid":"advanced-settings-accordion",children:[i.jsxs(T,{gap:4,w:"full",children:[s?i.jsx(LMe,{}):i.jsx(RMe,{}),!s&&!o&&i.jsx(NMe,{})]}),n==="upscaling"?i.jsx(OI,{}):i.jsxs(i.Fragment,{children:[!s&&!o&&i.jsxs(i.Fragment,{children:[i.jsxs(Es,{formLabelProps:FMe,children:[i.jsx(_Me,{}),i.jsx(yMe,{})]}),i.jsx(T,{gap:4,w:"full",children:i.jsxs(Es,{formLabelProps:BMe,children:[i.jsx(AMe,{}),i.jsx(EMe,{})]})})]}),s&&i.jsxs(Es,{children:[i.jsx(BE,{}),i.jsx(vMe,{})]}),o&&i.jsxs(Es,{children:[i.jsx(BE,{}),i.jsx(kMe,{}),i.jsx(wMe,{})]})]})]})})});NI.displayName="AdvancedSettingsAccordion";const $Me=()=>{const e=G(),t=A(yre),n=A(bre),{t:s}=M(),o=c.useCallback(r=>{e(vre(r))},[e]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"compositingCoherenceEdgeSize",children:i.jsx(J,{children:s("parameters.coherenceEdgeSize")})}),i.jsx(Ze,{min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:o,marks:!0}),i.jsx(_e,{min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:o})]})},VMe=c.memo($Me),zMe=()=>{const e=G(),t=A(Cre),{t:n}=M(),s=c.useCallback(o=>{e(wre(o))},[e]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"compositingCoherenceMinDenoise",children:i.jsx(J,{children:n("parameters.coherenceMinDenoise")})}),i.jsx(Ze,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s}),i.jsx(_e,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s})]})},GMe=c.memo(zMe),HMe=()=>{const e=G(),t=A(Sre),{t:n}=M(),s=c.useMemo(()=>[{label:n("parameters.gaussianBlur"),value:"Gaussian Blur"},{label:n("parameters.boxBlur"),value:"Box Blur"},{label:n("parameters.staged"),value:"Staged"}],[n]),o=c.useCallback(a=>{kre(a==null?void 0:a.value)&&e(jre(a.value))},[e]),r=c.useMemo(()=>s.find(a=>a.value===t),[t,s]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"compositingCoherenceMode",children:i.jsx(J,{children:n("parameters.coherenceMode")})}),i.jsx(Ke,{options:s,value:r,onChange:o})]})},WMe=c.memo(HMe),UMe=()=>{const{t:e}=M(),t=G(),n=A(_re),s=A(Ire),o=c.useCallback(r=>{t(Tre(r))},[t]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"compositingMaskBlur",children:i.jsx(J,{children:e("parameters.maskBlur")})}),i.jsx(Ze,{value:n,onChange:o,min:s.sliderMin,max:s.sliderMax,defaultValue:s.initial,step:s.coarseStep,fineStep:s.fineStep,marks:!0}),i.jsx(_e,{value:n,onChange:o,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},qMe=c.memo(UMe),KMe=()=>{const{t:e}=M(),t=G(),n=A(pm),{data:s}=aD(),o=c.useMemo(()=>s?s.infill_methods.map(l=>({label:l,value:l})):[],[s]),r=c.useCallback(l=>{!l||!o.find(d=>d.value===l.value)||t(Are(l.value))},[t,o]),a=c.useMemo(()=>o.find(l=>l.value===n),[o,n]);return i.jsxs(Q,{isDisabled:o.length===0,children:[i.jsx($e,{feature:"infillMethod",children:i.jsx(J,{children:e("parameters.infillMethod")})}),i.jsx(Ke,{value:a,options:o,onChange:r})]})},ZMe=c.memo(KMe),YMe=()=>{const e=G(),t=A(Mre),n=A(pm),{t:s}=M(),o=c.useCallback(r=>{e(Ere(r))},[e]);return i.jsx(T,{flexDir:"column",gap:4,children:i.jsxs(Q,{isDisabled:n!=="color",children:[i.jsx(J,{children:s("parameters.infillColorValue")}),i.jsx(Ce,{w:"full",pt:2,pb:2,children:i.jsx(EV,{color:t,onChange:o})})]})})},XMe=c.memo(YMe),QMe=()=>{const e=G(),t=A(pm),n=A(Pre),s=A(Lre),{t:o}=M(),r=c.useCallback(a=>{e(Dre(a))},[e]);return i.jsxs(Q,{isDisabled:t!=="patchmatch",children:[i.jsx($e,{feature:"patchmatchDownScaleSize",children:i.jsx(J,{children:o("parameters.patchmatchDownScaleSize")})}),i.jsx(Ze,{value:n,onChange:r,marks:!0,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep}),i.jsx(_e,{value:n,onChange:r,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},JMe=c.memo(QMe),eEe=()=>{const e=G(),t=A(Rre),n=A(Ore),s=A(pm),{t:o}=M(),r=c.useCallback(a=>{e(Nre(a))},[e]);return i.jsxs(Q,{isDisabled:s!=="tile",children:[i.jsx(J,{children:o("parameters.tileSize")}),i.jsx(Ze,{value:t,onChange:r,defaultValue:n.initial,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,marks:!0}),i.jsx(_e,{value:t,onChange:r,defaultValue:n.initial,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep})]})},tEe=c.memo(eEe),nEe=()=>{const e=A(pm);return e==="tile"?i.jsx(tEe,{}):e==="patchmatch"?i.jsx(JMe,{}):e==="color"?i.jsx(XMe,{}):null},sEe=c.memo(nEe),VE={minW:"4.5rem"},Wq=c.memo(()=>{const{t:e}=M(),{isOpen:t,onToggle:n}=rh({id:"compositing-settings",defaultIsOpen:!1});return i.jsx(Iu,{isOpen:t,onToggle:n,label:e("accordions.compositing.title"),children:i.jsxs(yc,{variant:"collapse",children:[i.jsxs(bc,{children:[i.jsx(Tn,{children:e("accordions.compositing.coherenceTab")}),i.jsx(Tn,{children:e("accordions.compositing.infillTab")})]}),i.jsxs(yu,{children:[i.jsx(Vn,{children:i.jsx(T,{gap:4,p:4,flexDir:"column",children:i.jsxs(Es,{formLabelProps:VE,children:[i.jsx(WMe,{}),i.jsx(VMe,{}),i.jsx(GMe,{}),i.jsx(qMe,{})]})})}),i.jsx(Vn,{children:i.jsx(T,{gap:4,p:4,flexDir:"column",children:i.jsxs(Es,{formLabelProps:VE,children:[i.jsx(ZMe,{}),i.jsx(sEe,{})]})})})]})]})})});Wq.displayName="CompositingSettingsAccordion";const iEe=[-1,0,1,2],Uq=c.memo(e=>{const{lora:t}=e,n=G(),{data:s}=lm(t.model.key),o=c.useCallback(l=>{n(Fre({id:t.id,weight:l}))},[n,t.id]),r=c.useCallback(()=>{n(Bre({id:t.id,isEnabled:!t.isEnabled}))},[n,t.id,t.isEnabled]),a=c.useCallback(()=>{n($re({id:t.id}))},[n,t.id]);return i.jsxs(Vre,{variant:"lora",children:[i.jsx(zre,{children:i.jsxs(T,{alignItems:"center",justifyContent:"space-between",width:"100%",gap:2,children:[i.jsx(W,{noOfLines:1,wordBreak:"break-all",color:t.isEnabled?"base.200":"base.500",children:(s==null?void 0:s.name)??t.model.key.substring(0,8)}),i.jsxs(T,{alignItems:"center",gap:2,children:[i.jsx(et,{size:"sm",onChange:r,isChecked:t.isEnabled}),i.jsx(le,{"aria-label":"Remove LoRA",variant:"ghost",size:"sm",onClick:a,icon:i.jsx(Pi,{})})]})]})}),i.jsx($e,{feature:"loraWeight",children:i.jsxs(Gre,{children:[i.jsx(Ze,{value:t.weight,onChange:o,min:-1,max:2,step:.01,marks:iEe,defaultValue:.75,isDisabled:!t.isEnabled}),i.jsx(_e,{value:t.weight,onChange:o,min:-10,max:10,step:.01,w:20,flexShrink:0,defaultValue:.75,isDisabled:!t.isEnabled})]})})]})});Uq.displayName="LoRACard";const oEe=fn(yk,e=>e.loras),qq=c.memo(()=>{const e=A(oEe);return e.length?i.jsx(T,{flexWrap:"wrap",gap:2,children:e.map(t=>i.jsx(Uq,{lora:t},t.id))}):null});qq.displayName="LoRAList";const vp="ModelRelationships",rEe=Ho.injectEndpoints({endpoints:e=>({getRelatedModelIds:e.query({query:t=>`/api/v1/model_relationships/i/${t}`,providesTags:(t,n,s)=>[{type:vp,id:s}]}),addModelRelationship:e.mutation({query:t=>({url:"/api/v1/model_relationships/",method:"POST",body:t}),invalidatesTags:(t,n,{model_key_1:s,model_key_2:o})=>[{type:vp,id:s},{type:vp,id:o}]}),removeModelRelationship:e.mutation({query:t=>({url:"/api/v1/model_relationships/",method:"DELETE",body:t}),invalidatesTags:(t,n,{model_key_1:s,model_key_2:o})=>[{type:vp,id:s},{type:vp,id:o}]}),getRelatedModelIdsBatch:e.query({query:t=>({url:"/api/v1/model_relationships/batch",method:"POST",body:{model_keys:t}}),providesTags:(t,n,s)=>s.map(o=>({type:"ModelRelationships",id:o}))})}),overrideExisting:!1}),{useGetRelatedModelIdsQuery:aEe,useAddModelRelationshipMutation:lEe,useRemoveModelRelationshipMutation:cEe,useGetRelatedModelIdsBatchQuery:dEe}=rEe,uEe=e=>{const{data:t=[]}=dEe([...e],{skip:e.size===0});return c.useMemo(()=>new Set(t),[t])},hEe=()=>A(e=>{const t=new Set,n=e.params.model,s=e.params.vae,o=e.params.refinerModel,r=e.params.controlLora,a=e.loras.loras.map(l=>l.model);n&&t.add(n.key),s&&t.add(s.key),o&&t.add(o.key),r&&t.add(r.key);for(const l of a)t.add(l.key);return t});function pEe({modelConfigs:e,selectedModel:t,onChange:n,isLoading:s=!1,getIsDisabled:o,groupByType:r}){const{t:a}=M(),l=hEe(),d=uEe(l),u=ma({modelConfigs:e,selectedModel:t,onChange:n,getIsDisabled:o,isLoading:s,groupByType:r});if(d.size===0)return u;const h=[],p=[];for(const m of u.options){const g=[];for(const x of m.options)d.has(x.value)?h.push({...x,label:`* ${x.label}`}):g.push(x);g.length>0&&p.push({label:m.label,options:g})}const f=h.length>0?[{label:a("modelManager.relatedModels"),options:h},...p]:p;return{...u,options:f}}const fEe=he(yk,e=>e.loras),mEe=()=>{const e=G(),[t,{isLoading:n}]=Ry(),{t:s}=M(),o=A(fEe),r=A(la),a=f=>{const m=r===f.base,g=!!o.find(b=>b.model.key===f.key);return!!!r||!m||g},l=c.useCallback(f=>{f&&e(Hre({model:f}))},[e]),{options:d,onChange:u}=pEe({modelConfigs:t,getIsDisabled:a,onChange:l}),h=c.useMemo(()=>n?s("common.loading"):d.length===0?s("models.noLoRAsInstalled"):s("models.addLora"),[n,d.length,s]),p=c.useCallback(()=>s("models.noMatchingLoRAs"),[s]);return i.jsxs(Q,{isDisabled:!d.length,gap:2,children:[i.jsx($e,{feature:"lora",children:i.jsxs(J,{children:[s("models.concepts")," "]})}),i.jsx(Ke,{placeholder:h,value:null,options:d,noOptionsMessage:p,onChange:u,"data-testid":"add-lora",sx:xEe})]})},gEe=c.memo(mEe),xEe={w:"full"},yEe=()=>{const e=A(lD),t=A(oy),n=G(),{t:s}=M(),o=c.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),r=c.useCallback(a=>n(Wre(a)),[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"paramCFGScale",children:i.jsx(J,{children:s("parameters.cfgScale")})}),i.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r,marks:o}),i.jsx(_e,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r})]})},bEe=c.memo(yEe),vEe=()=>{const e=A(cD),t=A(dD),n=G(),{t:s}=M(),o=c.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax-(t.sliderMax-t.sliderMin)/2),t.sliderMax],[t.sliderMax,t.sliderMin]),r=c.useCallback(a=>n(Ure(a)),[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"paramGuidance",children:i.jsx(J,{children:s("parameters.guidance")})}),i.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r,marks:o}),i.jsx(_e,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r})]})},CEe=c.memo(vEe),wEe=()=>{const e=G(),{t}=M(),n=A(uD),s=c.useCallback(r=>{um(r==null?void 0:r.value)&&e(qre(r.value))},[e]),o=c.useMemo(()=>fr.find(r=>r.value===n),[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"paramScheduler",children:i.jsx(J,{children:t("parameters.scheduler")})}),i.jsx(Ke,{value:o,options:fr,onChange:s})]})},SEe=c.memo(wEe),kEe=()=>{const e=A(hD),t=A(bk),n=G(),{t:s}=M(),o=c.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),r=c.useCallback(a=>{n(Kre(a))},[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"paramSteps",children:i.jsx(J,{children:s("parameters.steps")})}),i.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r,marks:o}),i.jsx(_e,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r})]})},jEe=c.memo(kEe),_Ee=()=>{const{t:e}=M(),t=A(oc),n=re(Zre),{isChatGPT4oHighModelDisabled:s}=QD();return!t||!s(t)?null:i.jsx(T,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:i.jsx(W,{children:i.jsx(Wt,{i18nKey:"parameters.modelDisabledForTrial",values:{modelName:t==null?void 0:t.name},components:{LinkComponent:i.jsx(Wf,{textDecor:"underline",href:n,children:e("parameters.invoke.accountSettings")})}})})})},IEe=()=>{const e=A(Yre),t=A(oy),n=G(),{t:s}=M(),o=c.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),r=c.useCallback(a=>n(Xre(a)),[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"paramCFGScale",children:i.jsx(J,{children:s("parameters.cfgScale")})}),i.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r,marks:o}),i.jsx(_e,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r})]})},TEe=c.memo(IEe),AEe=()=>{const e=G(),{t}=M(),n=A(Qre),s=c.useCallback(r=>{um(r==null?void 0:r.value)&&e(Jre(r.value))},[e]),o=c.useMemo(()=>fr.find(r=>r.value===n),[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"paramScheduler",children:i.jsx(J,{children:t("parameters.scheduler")})}),i.jsx(Ke,{value:o,options:fr,onChange:s})]})},MEe=c.memo(AEe),EEe=()=>{const e=A(oc),{t}=M(),n=G(),{data:s}=gu(),o=A(uD),r=A(hD),a=A(iD),l=A(oD),d=A(vk),u=A(Ck),h=A(cD),p=A(lD),f=A(eD),m=c.useMemo(()=>!s||e===null?null:aa.selectById(s,e.key),[s,e]),g=c.useMemo(()=>{const v=m&&Z0(m)&&m.default_settings;return v&&Object.values(v).some(w=>!!w)},[m]),x=c.useMemo(()=>m&&Z0(m)&&m.default_settings?m.default_settings:eae,[m]),b=c.useMemo(()=>{const v=[];if(g){const{vae:w,vae_precision:k,cfg_scale:S,cfg_rescale_multiplier:P,steps:E,scheduler:L,width:I,height:O,guidance:N}=x;!He(w)&&a&&w!==a.key&&v.push(t("modelManager.vae")),!He(w)&&!a&&w!=="default"&&v.push(t("modelManager.vae")),!He(k)&&k!==l&&v.push(t("modelManager.vaePrecision")),!He(S)&&S!==p&&v.push(t("parameters.cfgScale")),!He(P)&&P!==f&&v.push(t("parameters.cfgRescaleMultiplier")),!He(E)&&E!==r&&v.push(t("parameters.steps")),!He(L)&&L!==o&&v.push(t("parameters.scheduler")),!He(I)&&I!==d&&v.push(t("parameters.width")),!He(O)&&O!==u&&v.push(t("parameters.height")),!He(N)&&N!==h&&v.push(t("parameters.guidance"))}return v},[g,a,l,p,f,r,o,d,u,h,t,x]),C=c.useMemo(()=>e?g?b.length===0?t("modelManager.usingDefaultSettings"):i.jsxs(T,{direction:"column",gap:2,children:[i.jsx(W,{children:t("modelManager.defaultSettingsOutOfSync")}),i.jsx(ai,{children:b.map(v=>i.jsx(Ft,{children:v},v))}),i.jsx(W,{children:t("modelManager.restoreDefaultSettings")})]}):t("modelManager.noDefaultSettings"):t("modelManager.noModelSelected"),[e,g,b,t]),y=c.useCallback(()=>{n(tae())},[n]);return i.jsx(le,{icon:i.jsx(Ty,{}),tooltip:C,"aria-label":t("modelManager.useDefaultSettings"),isDisabled:!e||!g||b.length===0,onClick:y,size:"sm",variant:"ghost",colorScheme:"warning"})},PEe=`${Gt} ${tt}`,nS=Symbol("uniqueGroupKey"),LEe=e=>({...e,[nS]:!0}),ra=e=>nS in e&&e[nS]===!0,Kq=en(({option:e})=>{const{getOptionId:t}=Ss();return i.jsx(W,{fontWeight:"bold",children:t(e)})});Kq.displayName="DefaultOptionComponent";const DEe=en(({group:e,children:t})=>i.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[i.jsx(W,{fontWeight:"bold",children:e.id}),i.jsx(T,{flexDir:"column",gap:1,w:"full",children:t})]}));DEe.displayName="DefaultGroupComponent";const Zq=en(({children:e})=>{const{t}=M();return i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:typeof e=="string"?i.jsx(W,{variant:"subtext",children:e}):e??i.jsx(W,{variant:"subtext",children:t("common.noOptions")})})});Zq.displayName="NoOptionsFallbackWrapper";const Yq=en(({children:e})=>{const{t}=M();return i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:typeof e=="string"?i.jsx(W,{variant:"subtext",children:e}):e??i.jsx(W,{variant:"subtext",children:t("common.noMatches")})})});Yq.displayName="NoMatchesFallbackWrapper";const Xq=c.createContext(null),Ss=()=>{const e=c.useContext(Xq);return ve(e!==null,"usePickerContext must be used within a PickerProvider"),e},REe=e=>{const t=e.trim().replace(/[-[\]{}()*+!<=:?./\\^$|#,]/g,"").split(" ").filter(s=>s.length>0);if(t.length===0)return new RegExp("","gi");const n=t.map(s=>`(?=.*${s})`).join("");return new RegExp(`${n}.+`,"i")},OEe=e=>{const t=e[0];if(t)return ra(t)?t.options[0]:t},sS=(e,t)=>{const n=OEe(e);if(n)return t(n)},NEe=(e,t,n)=>{for(const s of e)if(ra(s)){const o=s.options.find(r=>n(r)===t);if(o)return o}else if(n(s)===t)return s},FEe=e=>{const t=[];for(const n of e)ra(n)?t.push(...n.options):t.push(n);return t},BEe=e=>{const t=c.useMemo(()=>{const r=[];for(const a of e)ra(a)&&!r.includes(a.id)&&r.push(a.id);return r},[e]),[n]=c.useState(Le({})),[s]=c.useState(()=>jn(n,r=>Object.values(r).every(a=>a===!1)));c.useEffect(()=>{const r=n.get(),a={};for(const l of t)a[l]===void 0?a[l]=!1:r[l]!==void 0&&(a[l]=r[l]);n.set(a)},[t,n]);const o=c.useCallback(r=>{const a=n.get(),l={};for(const d of t){const u=!!a[d];l[d]=d===r?!u:u}n.set(l)},[n,t]);return{$groupStatusMap:n,$areAllGroupsDisabled:s,toggleGroup:o}},$Ee=()=>{const{getOptionId:e,$activeOptionId:t,$flattenedFilteredOptions:n,onSelectById:s,rootRef:o,onClose:r,inputRef:a}=Ss(),l=c.useCallback(f=>{t.set(f);const m=o.current;if(!m)return;const g=m.querySelector(`#${CSS.escape(f)}`);g&&g.scrollIntoView({block:"nearest"})},[t,o]),d=c.useCallback(f=>{f.preventDefault();const m=n.get(),g=t.get();if(m.length===0)return;if(f.metaKey){const y=m.at(0);y&&l(e(y));return}const x=m.findIndex(y=>e(y)===g);if(x<0)return;let b=x-1;b<0&&(b=m.length-1);const C=m.at(b);C&&l(e(C))},[t,n,l,e]),u=c.useCallback(f=>{f.preventDefault();const m=t.get(),g=n.get();if(g.length===0)return;if(f.metaKey){const y=g.at(-1);y&&l(e(y));return}const x=g.findIndex(y=>e(y)===m);if(x<0)return;let b=x+1;b>=g.length&&(b=0);const C=g.at(b);C&&l(e(C))},[t,n,l,e]),h=c.useCallback(f=>{var m,g;if(f.key==="ArrowUp")d(f);else if(f.key==="ArrowDown")u(f);else if(f.key==="Enter"){const x=t.get();if(!x)return;s(x)}else f.key==="Escape"?r==null||r():f.key==="/"&&(f.preventDefault(),(m=a.current)==null||m.focus(),(g=a.current)==null||g.select())},[d,u,t,s,r,a]);return c.useMemo(()=>({onKeyDown:h}),[h])},Jc=e=>c.useState(()=>Le(e))[0],Ll=(e,t)=>c.useState(()=>jn(e,t))[0],VEe=e=>{let t=0;for(const n of e)ra(n)?t+=n.options.length:t++;return t},Qq=en(e=>{const{getOptionId:t,optionsOrGroups:n,handleRef:s,isMatch:o,getIsOptionDisabled:r,onClose:a,onSelect:l,selectedOption:d,searchPlaceholder:u,noMatchesFallback:h,noOptionsFallback:p,OptionComponent:f=Kq,NextToSearchBar:m,searchable:g}=e,x=c.useRef(null),b=c.useRef(null),{$groupStatusMap:C,$areAllGroupsDisabled:y,toggleGroup:v}=BEe(n),w=Jc(sS(n,t)),k=Jc(!0),S=Jc(n),P=Ll([S],VEe),E=Jc([]),L=Ll([E],FEe),I=Ll([P],ee=>ee>0),O=Ll([L],ee=>ee.length),N=Ll([O],ee=>ee>0),_=Jc(void 0),R=Jc(""),D=Ll([_],ee=>ee?t(ee):void 0),B=c.useCallback(ee=>{const se=E.get(),oe=NEe(se,ee,t);oe&&(l==null||l(oe))},[E,t,l]);c.useEffect(()=>{_.set(d)},[_,d]),c.useEffect(()=>{S.set(n)},[n,S]);const V=c.useMemo(()=>({$optionsOrGroups:S,$groupStatusMap:C,$compactView:k,$activeOptionId:w,$filteredOptions:E,$flattenedFilteredOptions:L,$totalOptionCount:P,$selectedItem:_,$searchTerm:R,getOptionId:t,isMatch:o,getIsOptionDisabled:r,onSelectById:B,noOptionsFallback:p,noMatchesFallback:h,toggleGroup:v,rootRef:x,inputRef:b,searchPlaceholder:u,OptionComponent:f,NextToSearchBar:m,onClose:a,searchable:g,$areAllGroupsDisabled:y,$selectedItemId:D,$hasOptions:I,$hasFilteredOptions:N,$filteredOptionsCount:O}),[S,C,k,w,E,L,P,_,R,t,o,r,B,p,h,v,u,f,m,a,g,y,D,I,N,O]);return c.useImperativeHandle(s,()=>V,[V]),i.jsxs(Xq.Provider,{value:V,children:[i.jsxs(eK,{children:[i.jsx(sK,{}),i.jsxs(T,{tabIndex:-1,w:"full",flexGrow:1,children:[i.jsx(tK,{}),i.jsx(nK,{}),i.jsx(lK,{})]})]}),i.jsx(Jq,{})]})});Qq.displayName="Picker";const Jq=en(()=>{const{$optionsOrGroups:e,$searchTerm:t,$activeOptionId:n,$groupStatusMap:s,$areAllGroupsDisabled:o,$filteredOptions:r,searchable:a,isMatch:l,getOptionId:d}=Ss(),u=re(t),h=re(s),p=re(o),f=re(e),[m]=ml(u,300);return c.useEffect(()=>{if(!m||!a){const g=f.filter(x=>ra(x)?h[x.id]||p:!0);r.set(g),n.set(sS(g,d))}else{const g=m.toLowerCase(),x=[];for(const b of f)if(ra(b)){if(!h[b.id]&&!p)continue;const C=b.options.filter(y=>l(y,g));C.length>0&&x.push({...b,options:C})}else l(b,m)&&x.push(b);r.set(x),n.set(sS(x,d))}},[m,n,d,l,r,a,f,h,p]),null});Jq.displayName="PickerSyncer";const eK=en(({children:e})=>{const{rootRef:t}=Ss(),n=$Ee();return i.jsx(T,{className:PEe,tabIndex:-1,ref:t,flexGrow:1,flexDir:"column",p:2,w:"full",h:"full",gap:2,...n,children:e})});eK.displayName="PickerContainer";const tK=en(()=>{const{noOptionsFallback:e,$hasOptions:t}=Ss();return re(t)?null:i.jsx(Zq,{children:e})});tK.displayName="NoOptionsFallback";const nK=en(()=>{const{noMatchesFallback:e,$hasOptions:t,$hasFilteredOptions:n}=Ss(),s=re(t),o=re(n);return!s||o?null:i.jsx(Yq,{children:e})});nK.displayName="NoMatchesFallback";const sK=en(()=>{const{NextToSearchBar:e,searchable:t}=Ss();return t?i.jsxs(T,{flexDir:"column",w:"full",gap:2,children:[i.jsxs(T,{gap:2,alignItems:"center",children:[i.jsx(iK,{}),e,i.jsx(rK,{})]}),i.jsx(oK,{})]}):null});sK.displayName="PickerSearchBar";const iK=en(()=>{const{inputRef:e,$totalOptionCount:t,$searchTerm:n,searchPlaceholder:s}=Ss(),{t:o}=M(),r=re(n),a=re(t),l=s??o("common.search"),d=c.useCallback(()=>{var h;n.set(""),(h=e.current)==null||h.focus()},[n,e]),u=c.useCallback(h=>{n.set(h.target.value)},[n]);return i.jsxs(Cr,{children:[i.jsx(St,{ref:e,value:r,onChange:u,placeholder:l}),r&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{onClick:d,size:"sm",variant:"link","aria-label":o("common.clear"),tooltip:o("common.clear"),icon:i.jsx(Rt,{}),isDisabled:a===0,disabled:!1})})]})});iK.displayName="SearchInput";const oK=en(()=>{const{$optionsOrGroups:e,$groupStatusMap:t,$areAllGroupsDisabled:n}=Ss(),{t:s}=M(),o=Ll([e],d=>{const u=[];for(const h of d)ra(h)&&u.push(h);return u}),r=re(o),a=re(n),l=c.useCallback(()=>{const d={};for(const{id:u}of r)d[u]=!1;t.set(d)},[t,r]);return r.length?i.jsxs(T,{gap:2,alignItems:"center",children:[r.map(d=>i.jsx(aK,{group:d},d.id)),i.jsx(Je,{}),i.jsx(le,{icon:i.jsx(Zs,{}),"aria-label":s("common.reset"),tooltip:s("common.reset"),size:"sm",variant:"link",alignSelf:"stretch",onClick:l,opacity:a?.5:void 0,pointerEvents:a?"none":void 0})]}):null});oK.displayName="GroupToggleButtons";const rK=en(()=>{const{t:e}=M(),{$compactView:t}=Ss(),n=re(t),s=c.useCallback(()=>{t.set(!t.get())},[t]),o=e(n?"common.fullView":"common.compactView"),r=n?i.jsx(Dpe,{}):i.jsx(Ppe,{});return i.jsx(le,{"aria-label":o,tooltip:o,size:"sm",variant:"ghost",icon:r,onClick:s})});rK.displayName="CompactViewToggleButton";const aK=en(({group:e})=>{const{toggleGroup:t,$groupStatusMap:n}=Ss(),s=re(n),o=c.useCallback(()=>{t(e.id)},[e.id,t]),r=BI(e),a=GEe(e),l=s[e.id]?r:"transparent",d=s[e.id]?void 0:"base.200";return i.jsx(Hn,{role:"button",size:"xs",variant:"solid",userSelect:"none",bg:l,color:d,borderColor:r,borderWidth:1,onClick:o,children:a})});aK.displayName="GroupToggleButton";const zEe={flexDir:"column",w:"full",gap:2,'&[data-is-compact="true"]':{gap:1}},lK=en(()=>{const{getOptionId:e,$compactView:t,$filteredOptions:n}=Ss(),s=re(t),o=re(n);return o.length===0?null:i.jsx(ns,{children:i.jsx(T,{sx:zEe,"data-is-compact":s,children:o.map((r,a)=>{if(ra(r)){const l=!s&&a<o.length-1;return i.jsxs(xe.Fragment,{children:[i.jsx(cK,{group:r}),l&&i.jsx(Ct,{})]},r.id)}else{const l=e(r);return i.jsx(FI,{id:l,option:r},l)}})})})});lK.displayName="PickerList";const cK=en(({group:e})=>{const{getOptionId:t,$groupStatusMap:n,$areAllGroupsDisabled:s}=Ss(),[o]=c.useState(()=>jn([n,s],(a,l)=>!a[e.id]&&!l));return re(o)?null:i.jsx(dK,{group:e,children:e.options.map(a=>{const l=t(a);return i.jsx(FI,{id:l,option:a},l)})})});cK.displayName="PickerGroup";const FI=en(e=>{const{OptionComponent:t,$activeOptionId:n,$selectedItemId:s,onSelectById:o,getIsOptionDisabled:r}=Ss(),{id:a,option:l}=e,[d]=c.useState(()=>jn(n,C=>C===a)),[u]=c.useState(()=>jn(s,C=>C===a)),h=re(d),p=re(u),f=c.useCallback(()=>{n.set(a)},[n,a]),m=c.useCallback(()=>{o(a)},[a,o]),g=(r==null?void 0:r(l))??!1,x=g?void 0:f,b=g?void 0:m;return i.jsx(t,{tabIndex:-1,option:l,id:a,"data-disabled":g,"data-selected":p,"data-active":h,onPointerMove:x,onClick:b})});FI.displayName="PickerOption";const BI=e=>e.color??"base.300",GEe=e=>e.shortName??e.name??e.id,HEe=e=>e.name??e.id,WEe=(e,t)=>{var n;return((n=e.getOptionCountString)==null?void 0:n.call(e,e.options.length))??t("common.options_withCount",{count:e.options.length})},UEe={flexDir:"column",w:"full",borderLeftWidth:4,ps:2,'&[data-all-disabled="true"]':{opacity:.5,cursor:"not-allowed"}},dK=en(({group:e,children:t})=>{const{getIsOptionDisabled:n}=Ss(),s=BI(e),o=e.options.every(r=>(n==null?void 0:n(r))??!1);return i.jsxs(T,{sx:UEe,borderLeftColor:s,"data-all-disabled":o,children:[i.jsx(uK,{group:e}),i.jsx(T,{flexDir:"column",gap:1,w:"full",children:t})]})});dK.displayName="PickerGroupContainer";const qEe={flexDir:"column",flex:1,ps:2,pe:4,py:1,userSelect:"none",position:"sticky",top:0,bg:"base.800",minH:8,'&[data-is-compact="true"]':{ps:1}},uK=en(({group:e})=>{const{t}=M(),{$compactView:n}=Ss(),s=re(n),o=BI(e),r=HEe(e),a=WEe(e,t);return i.jsx(T,{sx:qEe,"data-is-compact":s,children:i.jsxs(T,{gap:2,alignItems:"center",children:[i.jsx(W,{fontSize:"sm",fontWeight:"semibold",color:o,noOfLines:1,children:r}),i.jsx(Je,{}),i.jsx(W,{fontSize:"sm",color:"base.300",noOfLines:1,children:a})]})})});uK.displayName="PickerGroupHeader";const $r="40px",KEe="24px",ZEe=({image_url:e})=>e?i.jsx(Zt,{src:e,objectFit:"cover",objectPosition:"50% 50%",height:$r,width:$r,minHeight:$r,minWidth:$r,borderRadius:"base"}):i.jsx(T,{height:$r,minWidth:$r,borderRadius:"base",alignItems:"center",justifyContent:"center",children:i.jsx(at,{color:"base.500",as:hj,boxSize:KEe})}),hK=en(ZEe),pK=c.memo(e=>{const t=A(wk),n=re(Sk),{t:s}=M(),o=G(),r=c.useCallback(()=>{o(Yt("models"))},[o]);return t&&!n?null:i.jsx(le,{icon:i.jsx(k7,{}),tooltip:`${s("modelManager.manageModels")}`,"aria-label":`${s("modelManager.manageModels")}`,onClick:n??r,size:"sm",variant:"ghost",...e})});pK.displayName="NavigateToModelManagerButton";/**
 * filesize
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 10.1.6
 */const YEe="array",XEe="bit",zE="bits",QEe="byte",GE="bytes",ed="",JEe="exponent",e3e="function",HE="iec",t3e="Invalid number",n3e="Invalid rounding method",k2="jedec",s3e="object",WE=".",i3e="round",o3e="s",r3e="si",a3e="kbit",l3e="kB",c3e=" ",d3e="string",u3e="0",j2={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function $I(e,{bits:t=!1,pad:n=!1,base:s=-1,round:o=2,locale:r=ed,localeOptions:a={},separator:l=ed,spacer:d=c3e,symbols:u={},standard:h=ed,output:p=d3e,fullform:f=!1,fullforms:m=[],exponent:g=-1,roundingMethod:x=i3e,precision:b=0}={}){let C=g,y=Number(e),v=[],w=0,k=ed;h===r3e?(s=10,h=k2):h===HE||h===k2?s=2:s===2?h=HE:(s=10,h=k2);const S=s===10?1e3:1024,P=f===!0,E=y<0,L=Math[x];if(typeof e!="bigint"&&isNaN(e))throw new TypeError(t3e);if(typeof L!==e3e)throw new TypeError(n3e);if(E&&(y=-y),(C===-1||isNaN(C))&&(C=Math.floor(Math.log(y)/Math.log(S)),C<0&&(C=0)),C>8&&(b>0&&(b+=8-C),C=8),p===JEe)return C;if(y===0)v[0]=0,k=v[1]=j2.symbol[h][t?zE:GE][C];else{w=y/(s===2?Math.pow(2,C*10):Math.pow(1e3,C)),t&&(w=w*8,w>=S&&C<8&&(w=w/S,C++));const I=Math.pow(10,C>0?o:0);v[0]=L(w*I)/I,v[0]===S&&C<8&&g===-1&&(v[0]=1,C++),k=v[1]=s===10&&C===1?t?a3e:l3e:j2.symbol[h][t?zE:GE][C]}if(E&&(v[0]=-v[0]),b>0&&(v[0]=v[0].toPrecision(b)),v[1]=u[v[1]]||v[1],r===!0?v[0]=v[0].toLocaleString():r.length>0?v[0]=v[0].toLocaleString(r,a):l.length>0&&(v[0]=v[0].toString().replace(WE,l)),n&&o>0){const I=v[0].toString(),O=l||(I.match(/(\D)/g)||[]).pop()||WE,N=I.toString().split(O),_=N[1]||ed,R=_.length,D=o-R;v[0]=`${N[0]}${O}${_.padEnd(R+D,u3e)}`}return P&&(v[1]=m[C]?m[C]:j2.fullform[h][C]+(t?XEe:QEe)+(v[0]===1?ed:o3e)),p===YEe?v:p===s3e?{value:v[0],symbol:v[1],exponent:C,unit:k}:v.join(d)}const h3e=e=>e.key,fK=c.memo(e=>{const t=re(Sk),n=G(),s=c.useCallback(()=>{n(Yt("models")),Qa.set(3)},[n]);return i.jsx(de,{size:"sm",flexGrow:0,variant:"link",color:"base.200",onClick:t??s,...e})});fK.displayName="ModelManagerLink";const p3e={LinkComponent:i.jsx(fK,{})},mK=c.memo(()=>{const{t:e}=M(),t=A(wk),n=re(Sk);return i.jsxs(T,{flexDir:"column",gap:4,alignItems:"center",children:[i.jsx(W,{color:"base.200",children:e("modelManager.modelPickerFallbackNoModelsInstalled")}),(!t||n)&&i.jsx(W,{color:"base.200",children:i.jsx(Wt,{i18nKey:"modelManager.modelPickerFallbackNoModelsInstalled2",components:p3e})})]})});mK.displayName="NoOptionsFallback";const f3e=e=>Cu.includes(e.base)?"api":e.base,m3e=e=>Cu.includes(e.base)?"External API":Ml[e.base],g3e=e=>Cu.includes(e.base)?"api":wS[e.base],x3e=e=>Cu.includes(e.base)?"pink":Z7[e.base],y3e=[{name:"preventOverflow",options:{padding:16}}],gK=en(({modelConfigs:e,selectedModelConfig:t,onChange:n,grouped:s,getIsOptionDisabled:o,placeholder:r,allowEmpty:a,isDisabled:l,isInvalid:d,className:u})=>{var C;const{t:h}=M(),p=c.useMemo(()=>{if(!s)return e;const y={};for(const w of e){const k=f3e(w);let S=y[k];S||(S=LEe({id:w.base,color:`${x3e(w)}.300`,shortName:g3e(w),name:m3e(w),getOptionCountString:P=>h("common.model_withCount",{count:P}),options:[]}),y[k]=S),S&&S.options.push(w)}const v=[];for(const w of["api","flux","cogview4","sdxl","sd-3","sd-2","sd-1"]){const k=y[w];k&&(v.push(k),delete y[w])}return v.push(...Object.values(y)),v},[s,e,h]),f=mP(!1),m=c.useRef(null),g=c.useCallback(()=>{var y;f.close(),(y=m.current)==null||y.$searchTerm.set("")},[f]),x=c.useCallback(y=>{g(),n(y)},[n,g]),b=c.useMemo(()=>{if(!t&&!a||d)return"error"},[a,d,t]);return i.jsxs(es,{isOpen:f.isOpen,onOpen:f.open,onClose:g,initialFocusRef:(C=m.current)==null?void 0:C.inputRef,modifiers:y3e,children:[i.jsx(ds,{children:i.jsxs(de,{className:u,size:"sm",flexGrow:1,variant:"outline",colorScheme:b,isDisabled:l,children:[(t==null?void 0:t.name)??r??"Select Model",i.jsx(Je,{}),i.jsx(Bi,{})]})}),i.jsx(al,{appendToParentPortal:!1,children:i.jsxs(ts,{p:0,w:400,h:400,children:[i.jsx(po,{}),i.jsx(us,{p:0,w:"full",h:"full",children:i.jsx(Qq,{handleRef:m,optionsOrGroups:p,getOptionId:h3e,onSelect:x,selectedOption:t,isMatch:w3e,OptionComponent:xK,noOptionsFallback:i.jsx(mK,{}),noMatchesFallback:h("modelManager.noMatchingModels"),NextToSearchBar:i.jsx(pK,{}),getIsOptionDisabled:o,searchable:!0})})]})})]})});gK.displayName="ModelPicker";const b3e={p:2,gap:2,cursor:"pointer",borderRadius:"base",'&[data-selected="true"]':{bg:"base.700",'&[data-active="true"]':{bg:"base.650"}},'&[data-active="true"]':{bg:"base.750"},'&[data-disabled="true"]':{cursor:"not-allowed",opacity:.5},'&[data-is-compact="true"]':{px:1,py:.5},scrollMarginTop:"24px"},v3e={fontSize:"sm",noOfLines:1,fontWeight:"semibold",'&[data-is-compact="true"]':{fontWeight:"normal"}},xK=en(({option:e,...t})=>{const{$compactView:n}=Ss(),s=re(n);return i.jsxs(T,{...t,sx:b3e,"data-is-compact":s,children:[!s&&e.cover_image&&i.jsx(hK,{image_url:e.cover_image}),i.jsxs(T,{flexDir:"column",gap:1,flex:1,children:[i.jsxs(T,{gap:2,alignItems:"center",children:[i.jsx(W,{sx:v3e,"data-is-compact":s,children:e.name}),i.jsx(Je,{}),e.file_size>0&&i.jsx(W,{variant:"subtext",fontStyle:"italic",noOfLines:1,flexShrink:0,overflow:"visible",children:$I(e.file_size)}),e.usage_info&&i.jsx(W,{variant:"subtext",fontStyle:"italic",noOfLines:1,flexShrink:0,overflow:"visible",children:e.usage_info})]}),e.description&&!s&&i.jsx(W,{color:"base.200",children:e.description})]})]})});xK.displayName="PickerItemComponent";const C3e={"sd-1":["sd1","sd1.4","sd1.5","sd-1"],"sd-2":["sd2","sd2.0","sd2.1","sd-2"],"sd-3":["sd3","sd3.0","sd3.5","sd-3"]},w3e=(e,t)=>{const n=REe(t),s=C3e[e.base]??[e.base],o=`${e.name} ${s.join(" ")} ${e.type} ${e.description??""} ${e.format}`.toLowerCase();return!!(o.includes(t)||n.test(o))};function S3e(e){return pe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.53.12-1.03.3-1.48.54l1.47 1.47c.41-.17.91-.27 1.51-.27zM5.33 4.06 4.06 5.33 7.5 8.77c0 2.08 1.56 3.21 3.91 3.91l3.51 3.51c-.34.48-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.82-.55 2.45-1.12l2.22 2.22 1.27-1.27L5.33 4.06z"},child:[]}]})(e)}const yK=c.memo(()=>{const{t:e}=M(),t=G(),[n]=Ly(),s=uI(),o=c.useCallback(a=>{t(nae(a))},[t]),r=c.useMemo(()=>s&&sae(s)&&s.config_path==="flux-dev",[s]);return i.jsxs(T,{alignItems:"center",gap:2,children:[i.jsx($e,{feature:"paramModel",children:i.jsx(J,{children:e("modelManager.model")})}),r&&i.jsx($e,{feature:"fluxDevLicense",hideDisable:!0,children:i.jsx(T,{justifyContent:"flex-start",children:i.jsx(at,{as:S3e})})}),i.jsx(gK,{modelConfigs:n,selectedModelConfig:s,onChange:o,grouped:!0}),i.jsx(EEe,{})]})});yK.displayName="MainModelPicker";const VI=e=>{const t=G(),n=c.useMemo(()=>he(xc,r=>r.expanders[e.id]??e.defaultIsOpen),[e]),s=A(n),o=c.useCallback(()=>{t(iae({id:e.id,isOpen:!s}))},[t,e.id,s]);return{isOpen:s,onToggle:o}},k3e={minW:"4rem"},zI=c.memo(()=>{const{t:e}=M(),t=uI(),n=A(On),s=A(Ya),o=A(Xx),r=A(YS),a=Ib(),l=c.useMemo(()=>n==="upscaling",[n]),d=c.useMemo(()=>fn(yk,x=>{const b=x.loras.filter(v=>v.isEnabled).length,C=b?[`${b} ${e("models.concepts")}`]:Fs,y=t&&Cu.includes(t.base)?[t.name]:t?[t.name,t.base]:Fs;return{loraTabBadges:C,accordionBadges:y}}),[t,e]),{loraTabBadges:u,accordionBadges:h}=A(d),{isOpen:p,onToggle:f}=VI({id:"generation-settings-advanced",defaultIsOpen:!1}),{isOpen:m,onToggle:g}=rh({id:`generation-settings-${n}`,defaultIsOpen:n!=="upscaling"});return i.jsx(Iu,{label:e("accordions.generation.title"),badges:[...h,...u],isOpen:m,onToggle:g,children:i.jsxs(Ce,{px:4,pt:4,"data-testid":"generation-accordion",children:[i.jsxs(T,{gap:4,flexDir:"column",pb:a?4:0,children:[i.jsx(_Ee,{}),i.jsx(yK,{}),!a&&i.jsx(gEe,{}),!a&&i.jsx(qq,{})]}),!a&&i.jsx(kk,{label:e("accordions.advanced.options"),isOpen:p,onToggle:f,children:i.jsx(T,{gap:4,flexDir:"column",pb:4,children:i.jsxs(Es,{formLabelProps:k3e,children:[!s&&!o&&!r&&!l&&i.jsx(SEe,{}),l&&i.jsx(MEe,{}),i.jsx(jEe,{}),s&&t&&!oae(t)&&i.jsx(CEe,{}),l&&i.jsx(TEe,{}),!s&&!l&&i.jsx(bEe,{})]})})})]})})});zI.displayName="GenerationSettingsAccordion";const bK=c.memo(()=>{const e=A(rae),t=G(),n=c.useCallback(o=>{t(aae(o.target.checked))},[t]),{t:s}=M();return i.jsxs(Q,{w:"min-content",children:[i.jsx($e,{feature:"optimizedDenoising",children:i.jsxs(J,{m:0,children:[s("parameters.optimizedImageToImage")," (",s("settings.beta"),")"]})}),i.jsx(et,{isChecked:e,onChange:n})]})});bK.displayName="ParamOptimizedDenoisingToggle";const $c=()=>{const e=A(li);return Ib()||e},j3e=he(Ye,e=>e.bbox.scaleMethod==="manual"),_3e=he(Ye,e=>e.bbox.scaledSize.height),I3e=he(Ri,e=>e.sd.scaledBoundingBoxHeight),T3e=()=>{const{t:e}=M(),t=G(),n=$c(),s=A(fm),o=A(j3e),r=A(_3e),a=A(I3e),l=A(im),d=c.useCallback(u=>{t(lae(u))},[t]);return i.jsxs(Q,{isDisabled:!o||n,children:[i.jsx(J,{children:e("parameters.scaledHeight")}),i.jsx(Ze,{min:a.sliderMin,max:a.sliderMax,step:a.coarseStep,fineStep:l,value:r,onChange:d,marks:!0,defaultValue:s}),i.jsx(_e,{min:a.numberInputMin,max:a.numberInputMax,step:a.coarseStep,fineStep:l,value:r,onChange:d,defaultValue:s})]})},A3e=c.memo(T3e),M3e=he(Ye,e=>e.bbox.scaleMethod==="manual"),E3e=he(Ye,e=>e.bbox.scaledSize.width),P3e=he(Ri,e=>e.sd.scaledBoundingBoxWidth),L3e=()=>{const{t:e}=M(),t=G(),n=$c(),s=A(fm),o=A(M3e),r=A(E3e),a=A(P3e),l=A(im),d=c.useCallback(u=>{t(cae(u))},[t]);return i.jsxs(Q,{isDisabled:!o||n,children:[i.jsx(J,{children:e("parameters.scaledWidth")}),i.jsx(Ze,{min:a.sliderMin,max:a.sliderMax,step:a.coarseStep,fineStep:l,value:r,onChange:d,defaultValue:s,marks:!0}),i.jsx(_e,{min:a.numberInputMin,max:a.numberInputMax,step:a.coarseStep,fineStep:l,value:r,onChange:d,defaultValue:s})]})},D3e=c.memo(L3e),R3e=he(Ye,e=>e.bbox.scaleMethod),O3e=()=>{const e=G(),{t}=M(),n=A(R3e),s=$c(),o=c.useMemo(()=>[{label:t("modelManager.none"),value:"none"},{label:t("common.auto"),value:"auto"},{label:t("modelManager.manual"),value:"manual"}],[t]),r=c.useCallback(l=>{dae(l==null?void 0:l.value)&&e(uae(l.value))},[e]),a=c.useMemo(()=>o.find(l=>l.value===n),[n,o]);return i.jsxs(Q,{isDisabled:s,children:[i.jsx($e,{feature:"scaleBeforeProcessing",children:i.jsx(J,{children:t("parameters.scaleBeforeProcessing")})}),i.jsx(Ke,{value:a,options:o,onChange:r})]})},N3e=c.memo(O3e),vK=c.memo(()=>{const{t:e}=M(),t=G(),n=A(hae),s=A(li),o=A(XS),r=A(Qx),a=A(QS),l=c.useMemo(()=>o||a?pae.options:r?fae.options:mae.options,[o,r,a]),d=c.useCallback(u=>{gae(u.target.value)&&t(xae({id:u.target.value}))},[t]);return i.jsxs(Q,{isDisabled:s,children:[i.jsx($e,{feature:"paramAspect",children:i.jsx(J,{children:e("parameters.aspect")})}),i.jsx(lo,{size:"sm",value:n,onChange:d,cursor:"pointer",iconSize:"0.75rem",icon:i.jsx(Bi,{}),children:l.map(u=>i.jsx("option",{value:u,children:u},u))})]})});vK.displayName="BboxAspectRatioSelect";const CK=c.memo(()=>{const{t:e}=M(),t=G(),n=A(fm),s=A(Ck),o=A(pD),r=$c(),a=A(im),l=c.useCallback(u=>{t(yae({height:u}))},[t]),d=c.useMemo(()=>[o.sliderMin,n,o.sliderMax],[o.sliderMin,o.sliderMax,n]);return i.jsxs(Q,{isDisabled:r,children:[i.jsx($e,{feature:"paramHeight",children:i.jsx(J,{children:e("parameters.height")})}),i.jsx(Ze,{value:s,defaultValue:n,onChange:l,min:o.sliderMin,max:o.sliderMax,step:o.coarseStep,fineStep:a,marks:d}),i.jsx(_e,{value:s,defaultValue:n,onChange:l,min:o.numberInputMin,max:o.numberInputMax,step:o.coarseStep,fineStep:a})]})});CK.displayName="BboxHeight";const F3e=he(Ye,e=>e.bbox.aspectRatio.isLocked),wK=c.memo(()=>{const{t:e}=M(),t=G(),n=A(F3e),s=$c(),o=c.useCallback(()=>{t(bae())},[t]);return i.jsx(le,{tooltip:e("parameters.lockAspectRatio"),"aria-label":e("parameters.lockAspectRatio"),onClick:o,variant:n?"outline":"ghost",size:"sm",icon:n?i.jsx(z7,{}):i.jsx(E7,{}),isDisabled:s})});wK.displayName="BboxLockAspectRatioButton";const SK=c.memo(()=>{const e=A(vk),t=A(Ck),n=A(vae),[s,o]=rG(),r=c.useMemo(()=>{if(!o)return{width:0,height:0};let a=e,l=t;return e>t?(a=o.width,l=a/n):(l=o.height,a=l*n),{width:a,height:l}},[o,e,t,n]);return i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",ref:s,children:i.jsx(T,{position:"relative",borderRadius:"base",borderColor:"base.600",borderWidth:"3px",width:`${r.width}px`,height:`${r.height}px`,alignItems:"center",justifyContent:"center",children:i.jsxs(Mi,{borderRadius:"base",position:"absolute",top:0,right:0,bottom:0,left:0,gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"1px",bg:"base.700",children:[i.jsx(vt,{bg:"base.800"}),i.jsx(vt,{bg:"base.800"}),i.jsx(vt,{bg:"base.800"}),i.jsx(vt,{bg:"base.800"}),i.jsx(vt,{bg:"base.800"}),i.jsx(vt,{bg:"base.800"}),i.jsx(vt,{bg:"base.800"}),i.jsx(vt,{bg:"base.800"}),i.jsx(vt,{bg:"base.800"})]})})})});SK.displayName="BboxPreview";const B3e=he(Ye,e=>e.bbox.rect.width),$3e=he(Ye,e=>e.bbox.rect.height),kK=c.memo(()=>{const{t:e}=M(),t=G(),n=$c(),s=A(B3e),o=A($3e),r=A(fm),a=c.useMemo(()=>Cae(s,o,r),[o,s,r]),l=c.useMemo(()=>wae(s,o,r),[o,s,r]),d=c.useCallback(()=>{t(Sae())},[t]),u=c.useMemo(()=>e(a?"parameters.setToOptimalSizeTooSmall":l?"parameters.setToOptimalSizeTooLarge":"parameters.setToOptimalSize"),[l,a,e]);return i.jsx(le,{tooltip:u,"aria-label":e("parameters.setToOptimalSize"),onClick:d,variant:"ghost",size:"sm",icon:i.jsx(Ty,{}),colorScheme:a||l?"warning":"base",isDisabled:n})});kK.displayName="BboxSetOptimalSizeButton";const jK=c.memo(()=>{const{t:e}=M(),t=G(),n=A(li),s=c.useCallback(()=>{t(kae())},[t]);return i.jsx(le,{tooltip:e("parameters.swapDimensions"),"aria-label":e("parameters.swapDimensions"),onClick:s,variant:"ghost",size:"sm",icon:i.jsx(Epe,{}),isDisabled:n})});jK.displayName="BboxSwapDimensionsButton";const _K=c.memo(()=>{const{t:e}=M(),t=G(),n=A(vk),s=A(fm),o=A(fD),r=$c(),a=A(im),l=c.useCallback(u=>{t(jae({width:u}))},[t]),d=c.useMemo(()=>[o.sliderMin,s,o.sliderMax],[o.sliderMax,o.sliderMin,s]);return i.jsxs(Q,{isDisabled:r,children:[i.jsx($e,{feature:"paramWidth",children:i.jsx(J,{children:e("parameters.width")})}),i.jsx(Ze,{value:n,onChange:l,defaultValue:s,min:o.sliderMin,max:o.sliderMax,step:o.coarseStep,fineStep:a,marks:d}),i.jsx(_e,{value:n,onChange:l,defaultValue:s,min:o.numberInputMin,max:o.numberInputMax,step:o.coarseStep,fineStep:a})]})});_K.displayName="BboxWidth";const IK=c.memo(()=>i.jsxs(T,{gap:4,alignItems:"center",children:[i.jsx(T,{gap:4,flexDirection:"column",width:"full",children:i.jsxs(Es,{formLabelProps:V3e,children:[i.jsxs(T,{gap:4,children:[i.jsx(vK,{}),i.jsx(jK,{}),i.jsx(wK,{}),i.jsx(kK,{})]}),i.jsx(_K,{}),i.jsx(CK,{})]})}),i.jsx(T,{w:"108px",h:"108px",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"center",children:i.jsx(SK,{})})]}));IK.displayName="BboxSettings";const V3e={minW:10},z3e=fn([Ye,mu],(e,t)=>{const{shouldRandomizeSeed:n}=t,s=[],{aspectRatio:o}=e.bbox,{width:r,height:a}=e.bbox.rect;if(s.push(`${r}${a}`),s.push(o.id),o.isLocked&&s.push("locked"),n||s.push("Manual Seed"),s.length===0)return Fs}),G3e={minW:"4.5rem"},TK=c.memo(()=>{const{t:e}=M(),t=A(z3e),n=A(zP),{isOpen:s,onToggle:o}=rh({id:"image-settings",defaultIsOpen:!0}),{isOpen:r,onToggle:a}=VI({id:"image-settings-advanced",defaultIsOpen:!1}),l=A(Ya),d=A(Xx),u=Ib();return i.jsx(Iu,{label:e("accordions.image.title"),badges:t,isOpen:s,onToggle:o,children:i.jsxs(T,{px:4,pt:4,pb:u?4:0,w:"full",h:"full",flexDir:"column","data-testid":"image-settings-accordion",children:[i.jsx(IK,{}),!u&&i.jsx(OI,{py:3}),!u&&i.jsx(kk,{label:e("accordions.advanced.options"),isOpen:r,onToggle:a,children:i.jsxs(T,{gap:4,pb:4,flexDir:"column",children:[(l||d)&&i.jsx(bK,{}),i.jsx(N3e,{}),n!=="none"&&i.jsxs(Es,{formLabelProps:G3e,children:[i.jsx(D3e,{}),i.jsx(A3e,{})]})]})})]})})});TK.displayName="ImageSettingsAccordion";const H3e=()=>{const{t:e}=M(),t=G(),n=A(_ae),s=A(oy),o=c.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),r=c.useCallback(a=>t(Iae(a)),[t]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"refinerCfgScale",children:i.jsx(J,{children:e("sdxl.cfgScale")})}),i.jsx(Ze,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:r,marks:o}),i.jsx(_e,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:r})]})},W3e=c.memo(H3e),U3e=e=>e.base==="sdxl-refiner",q3e=()=>{const e=G(),t=A(Tae),{t:n}=M(),[s,{isLoading:o}]=Dy(),r=c.useCallback(f=>{if(!f){e(r5(null));return}e(r5(ro.parse(f)))},[e]),{options:a,value:l,onChange:d,placeholder:u,noOptionsMessage:h}=yl({modelConfigs:s,onChange:r,selectedModel:t,isLoading:o,optionsFilter:U3e}),p=c.useCallback(()=>{r(null)},[r]);return i.jsxs(Q,{isDisabled:!a.length,isInvalid:!a.length,w:"full",gap:2,children:[i.jsx($e,{feature:"refinerModel",children:i.jsx(J,{children:n("sdxl.refinermodel")})}),i.jsx(Ke,{value:l,placeholder:u,options:a,onChange:d,noOptionsMessage:h}),i.jsx(le,{size:"sm",variant:"ghost",icon:i.jsx(Rt,{}),"aria-label":n("common.reset"),onClick:p,isDisabled:!l})]})},K3e=c.memo(q3e),Z3e=()=>{const e=A(Aae),t=G(),{t:n}=M(),s=c.useCallback(o=>t(Mae(o)),[t]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"refinerNegativeAestheticScore",children:i.jsx(J,{children:n("sdxl.negAestheticScore")})}),i.jsx(Ze,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5,marks:!0}),i.jsx(_e,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5})]})},Y3e=c.memo(Z3e),X3e=()=>{const e=A(Eae),t=G(),{t:n}=M(),s=c.useCallback(o=>t(Pae(o)),[t]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"refinerPositiveAestheticScore",children:i.jsx(J,{children:n("sdxl.posAestheticScore")})}),i.jsx(Ze,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6,marks:!0}),i.jsx(_e,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6})]})},Q3e=c.memo(X3e),J3e=()=>{const e=G(),{t}=M(),n=A(Lae),s=c.useCallback(r=>{um(r==null?void 0:r.value)&&e(Dae(r.value))},[e]),o=c.useMemo(()=>fr.find(r=>r.value===n),[n]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"refinerScheduler",children:i.jsx(J,{children:t("sdxl.scheduler")})}),i.jsx(Ke,{value:o,options:fr,onChange:s})]})},e8e=c.memo(J3e),t8e=()=>{const e=A(Rae),t=G(),n=c.useCallback(o=>t(Oae(o)),[t]),{t:s}=M();return i.jsxs(Q,{children:[i.jsx($e,{feature:"refinerStart",children:i.jsx(J,{children:s("sdxl.refinerStart")})}),i.jsx(Ze,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e,marks:!0}),i.jsx(_e,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e})]})},n8e=c.memo(t8e),s8e=()=>{const{t:e}=M(),t=G(),n=A(Nae),s=A(bk),o=c.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),r=c.useCallback(a=>{t(Fae(a))},[t]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"refinerSteps",children:i.jsx(J,{children:e("sdxl.steps")})}),i.jsx(Ze,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:r,marks:o}),i.jsx(_e,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:r})]})},i8e=c.memo(s8e),o8e=()=>{const[e]=Dy();return!!e.length},r8e={minW:"9.2rem"},a8e={minW:"5rem"},l8e=fn(mu,e=>e.refinerModel?["Enabled"]:void 0),AK=c.memo(()=>{const{t:e}=M(),t=o8e(),n=A(l8e),{isOpen:s,onToggle:o}=rh({id:"refiner-settings",defaultIsOpen:!1});return i.jsx(Iu,{label:e("sdxl.refiner"),badges:n,isOpen:s,onToggle:o,children:t?i.jsx(EK,{}):i.jsx(MK,{})})});AK.displayName="RefinerSettingsAccordion";const MK=c.memo(()=>{const{t:e}=M();return i.jsx(T,{justifyContent:"center",p:4,children:i.jsx(W,{fontSize:"sm",color:"base.500",children:e("models.noRefinerModelsInstalled")})})});MK.displayName="RefinerSettingsAccordionNoRefiner";const EK=c.memo(()=>{const e=A(Bae);return i.jsx(Es,{isDisabled:!e,children:i.jsxs(T,{p:4,gap:4,flexDir:"column",minW:0,children:[i.jsx(K3e,{}),i.jsxs(Es,{formLabelProps:a8e,isDisabled:!e,children:[i.jsx(e8e,{}),i.jsx(i8e,{}),i.jsx(W3e,{}),i.jsx(n8e,{})]}),i.jsxs(Es,{formLabelProps:r8e,isDisabled:!e,children:[i.jsx(Q3e,{}),i.jsx(Y3e,{})]})]})})});EK.displayName="RefinerSettingsAccordionContent";const c8e={svg:{animation:iy}},d8e=()=>{const[e,{isLoading:t}]=$ae(),{t:n}=M(),{presetCount:s}=hm(void 0,{selectFromResult:({data:r})=>({presetCount:((r==null?void 0:r.filter(l=>l.type!=="default"))??Fs).length})}),o=c.useCallback(async()=>{let r;try{const a=await e().unwrap();r=new Blob([a],{type:"text/csv"})}catch{ge({status:"error",title:n("stylePresets.exportFailed")});return}if(r){const a=window.URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download="data.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a),ge({status:"success",title:n("stylePresets.exportDownloaded")})}},[e,n]);return i.jsx(le,{onClick:o,icon:t?i.jsx(q7,{}):i.jsx(Lu,{}),tooltip:n("stylePresets.exportPromptTemplates"),"aria-label":n("stylePresets.exportPromptTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?c8e:void 0,isDisabled:t||s===0})},u8e={svg:{animation:iy}},h8e=()=>{const[e,{isLoading:t}]=Vae(),{t:n}=M(),s=c.useCallback(a=>{const l=a[0];l&&e(l).unwrap().then(()=>{ge({status:"success",title:n("toast.importSuccessful")})}).catch(d=>{ge({status:"error",title:n("toast.importFailed"),description:d?`${d.data.detail}`:void 0})})},[e,n]),{getInputProps:o,getRootProps:r}=da({accept:{"text/csv":[".csv"],"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return i.jsxs(i.Fragment,{children:[i.jsx(le,{icon:t?i.jsx(q7,{}):i.jsx(jm,{}),tooltip:i.jsx(p8e,{}),"aria-label":n("stylePresets.importTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?u8e:void 0,isDisabled:t,...r()}),i.jsx("input",{...o()})]})},p8e=()=>{const{t:e}=M();return i.jsxs(T,{flexDir:"column",children:[i.jsx(W,{pb:1,fontWeight:"semibold",children:e("stylePresets.importTemplates")}),i.jsx(W,{children:e("stylePresets.acceptedColumnsKeys")}),i.jsxs(ai,{children:[i.jsx(Ft,{children:e("stylePresets.nameColumn")}),i.jsx(Ft,{children:e("stylePresets.positivePromptColumn")}),i.jsx(Ft,{children:e("stylePresets.negativePromptColumn")})]})]})},f8e=()=>{const e=c.useCallback(()=>{Ja.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!0})},[]),{t}=M();return i.jsx(le,{icon:i.jsx(Vt,{}),tooltip:t("stylePresets.createPromptTemplate"),"aria-label":t("stylePresets.createPromptTemplate"),onClick:e,size:"md",variant:"ghost",w:8,h:8})},td="40px",m8e="24px",g8e=({presetImageUrl:e,imageWidth:t})=>i.jsx(Oe,{closeOnScroll:!0,openDelay:0,label:e&&i.jsx(Zt,{src:e,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),p:2,children:i.jsx(Zt,{src:e||"",fallbackStrategy:"beforeLoadOrError",fallback:i.jsx(T,{height:t||td,minWidth:t||td,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:i.jsx(at,{color:"base.500",as:hj,boxSize:t?t/2:m8e})}),objectFit:"cover",objectPosition:"50% 50%",height:t||td,width:t||td,minHeight:t||td,minWidth:t||td,borderRadius:"base"})}),PK=en(g8e),x8e=({preset:e})=>{const t=G(),n=A(qf),{t:s}=M(),o=iye(),r=c.useCallback(u=>{u.stopPropagation();const{name:h,preset_data:p}=e,{positive_prompt:f,negative_prompt:m}=p;Ja.set({prefilledFormData:{name:h,positivePrompt:f||"",negativePrompt:m||"",imageUrl:e.image,type:e.type},updatingStylePresetId:e.id,isModalOpen:!0})},[e]),a=c.useCallback(()=>{t(Y0(e.id)),cf.set(!1)},[t,e.id]),l=c.useCallback(u=>{u.stopPropagation(),o(e)},[o,e]),d=c.useCallback(u=>{u.stopPropagation();const{name:h,preset_data:p}=e,{positive_prompt:f,negative_prompt:m}=p;Ja.set({prefilledFormData:{name:`${h} (${s("common.copy")})`,positivePrompt:f||"",negativePrompt:m||"",imageUrl:e.image,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[e,s]);return i.jsxs(T,{gap:4,onClick:a,cursor:"pointer",_hover:{backgroundColor:"base.750"},py:3,px:2,borderRadius:"base",alignItems:"flex-start",w:"full",children:[i.jsx(PK,{presetImageUrl:e.image}),i.jsxs(T,{flexDir:"column",w:"full",children:[i.jsxs(T,{w:"full",justifyContent:"space-between",alignItems:"flex-start",children:[i.jsxs(T,{alignItems:"center",gap:2,children:[i.jsx(W,{fontSize:"md",noOfLines:2,children:e.name}),n===e.id&&i.jsx(Hn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:s("stylePresets.active")})]}),i.jsxs(T,{alignItems:"center",gap:1,children:[i.jsx(le,{size:"sm",variant:"ghost","aria-label":s("stylePresets.copyTemplate"),onClick:d,icon:i.jsx(pn,{})}),e.type!=="default"&&i.jsxs(i.Fragment,{children:[i.jsx(le,{size:"sm",variant:"ghost","aria-label":s("stylePresets.editTemplate"),onClick:r,icon:i.jsx(Iy,{})}),i.jsx(le,{size:"sm",variant:"ghost","aria-label":s("stylePresets.deleteTemplate"),onClick:l,colorScheme:"error",icon:i.jsx(lj,{})})]})]})]}),i.jsxs(T,{flexDir:"column",gap:1,children:[i.jsxs(W,{fontSize:"xs",children:[i.jsxs(W,{as:"span",fontWeight:"semibold",children:[s("stylePresets.positivePrompt"),":"]})," ",e.preset_data.positive_prompt]}),i.jsxs(W,{fontSize:"xs",children:[i.jsxs(W,{as:"span",fontWeight:"semibold",children:[s("stylePresets.negativePrompt"),":"]})," ",e.preset_data.negative_prompt]})]})]})]})},_2=({title:e,data:t})=>{const{t:n}=M(),{onToggle:s,isOpen:o}=hi({defaultIsOpen:!0}),r=A(jk);return i.jsxs(T,{flexDir:"column",children:[i.jsx(de,{variant:"unstyled",onClick:s,children:i.jsxs(T,{gap:2,alignItems:"center",children:[i.jsx(at,{boxSize:4,as:Bi,transform:o?void 0:"rotate(-90deg)",fill:"base.500"}),i.jsx(W,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:e})]})}),i.jsx(ll,{in:o,style:sI,children:t.length?t.map(a=>i.jsx(x8e,{preset:a},a.id)):i.jsx(Ot,{fontSize:"sm",py:4,label:n(r?"stylePresets.noMatchingTemplates":"stylePresets.noTemplates"),icon:null})})]})},y8e=()=>{const e=G(),t=A(jk),{t:n}=M(),s=c.useCallback(l=>{e(a5(l))},[e]),o=c.useCallback(()=>{e(a5(""))},[e]),r=c.useCallback(l=>{l.key==="Escape"&&o()},[o]),a=c.useCallback(l=>{s(l.target.value)},[s]);return i.jsxs(Cr,{children:[i.jsx(St,{placeholder:n("stylePresets.searchByName"),value:t,onKeyDown:r,onChange:a}),t&&t.length&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{onClick:o,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:i.jsx(Rt,{})})})]})},b8e=c.memo(y8e),LK=()=>{const e=A(jk),t=A(kP),{data:n}=hm(void 0,{selectFromResult:({data:o})=>({data:((o==null?void 0:o.filter(l=>l.name.toLowerCase().includes(e.toLowerCase())))||Fs).reduce((l,d)=>(d.type==="default"?l.defaultPresets.push(d):d.type==="project"?l.sharedPresets.push(d):l.presets.push(d),l),{defaultPresets:[],sharedPresets:[],presets:[]})})}),{t:s}=M();return i.jsxs(T,{flexDir:"column",gap:2,padding:3,layerStyle:"second",borderRadius:"base",children:[i.jsxs(T,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[i.jsx(b8e,{}),i.jsx(f8e,{}),i.jsx(h8e,{}),i.jsx(d8e,{})]}),i.jsx(_2,{title:s("stylePresets.myTemplates"),data:n.presets}),t&&i.jsx(_2,{title:s("stylePresets.sharedTemplates"),data:n.sharedPresets}),i.jsx(_2,{title:s("stylePresets.defaultTemplates"),data:n.defaultPresets})]})},v8e=()=>{const e=A(gk),t=A(qf),{activeStylePreset:n}=hm(void 0,{selectFromResult:({data:h})=>{let p=null;return h&&(p=h.find(f=>f.id===t)),{activeStylePreset:p}}}),s=G(),{t:o}=M(),{presetModifiedPositivePrompt:r,presetModifiedNegativePrompt:a}=zae(),l=c.useCallback(h=>{h.stopPropagation(),s(w0(!1)),s(Y0(null))},[s]),d=c.useCallback(h=>{h.stopPropagation(),s(JL(r)),s(QL(a)),s(w0(!1)),s(Y0(null))},[s,r,a]),u=c.useCallback(h=>{h.stopPropagation(),s(w0(!e))},[s,e]);return n?i.jsxs(T,{w:"full",alignItems:"center",gap:2,minW:0,children:[i.jsx(PK,{imageWidth:25,presetImageUrl:n.image}),i.jsx(Hn,{colorScheme:"invokeBlue",variant:"subtle",justifySelf:"flex-start",children:n.name}),i.jsx(Je,{}),i.jsx(Oe,{label:o("stylePresets.toggleViewMode"),children:i.jsx(le,{onClick:u,variant:"outline",size:"sm","aria-label":o("stylePresets.toggleViewMode"),colorScheme:e?"invokeBlue":"base",icon:i.jsx(Du,{})})}),i.jsx(Oe,{label:o("stylePresets.flatten"),children:i.jsx(le,{onClick:d,variant:"outline",size:"sm","aria-label":o("stylePresets.flatten"),icon:i.jsx(B7,{})})}),i.jsx(Oe,{label:o("stylePresets.clearTemplateSelection"),children:i.jsx(le,{onClick:l,variant:"outline",size:"sm","aria-label":o("stylePresets.clearTemplateSelection"),icon:i.jsx(Rt,{})})})]}):i.jsx(T,{h:25,alignItems:"center",children:i.jsx(W,{fontSize:"sm",fontWeight:"semibold",color:"base.300",children:o("stylePresets.choosePromptTemplate")})})},C8e={bg:"base.750"},DK=()=>{const e=re(cf),{t}=M(),n=c.useCallback(()=>{cf.set(!e)},[e]);return i.jsxs(T,{onClick:n,backgroundColor:"base.800",justifyContent:"space-between",alignItems:"center",py:2,px:3,borderRadius:"base",gap:2,role:"button",_hover:C8e,transitionProperty:"background-color",transitionDuration:"normal",w:"full",children:[i.jsx(v8e,{}),i.jsx(le,{"aria-label":t("stylePresets.viewList"),variant:"ghost",icon:i.jsx(Bi,{}),size:"sm"})]})},UE={height:"100%",width:"100%"},w8e=()=>{const e=A(Gae),t=A(YS),n=re(cf),s=Ib();return i.jsxs(T,{w:"full",h:"full",flexDir:"column",gap:2,children:[i.jsx(DK,{}),i.jsx(T,{w:"full",h:"full",position:"relative",children:i.jsxs(Ce,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[n&&i.jsx(vs,{defer:!0,style:UE,options:rc.options,children:i.jsx(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:i.jsx(LK,{})})}),i.jsx(vs,{defer:!0,style:UE,options:rc.options,children:i.jsxs(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:[i.jsx(RI,{}),i.jsx(TK,{}),i.jsx(zI,{}),!s&&i.jsx(Wq,{}),e&&i.jsx(AK,{}),!t&&!s&&i.jsx(NI,{})]})})]})})]})},S8e=c.memo(w8e),k8e={diffusers:"diffusers",lycoris:"lycoris",checkpoint:"checkpoint",invokeai:"internal",embedding_file:"embedding",embedding_folder:"embedding",t5_encoder:"t5_encoder",bnb_quantized_int8b:"bnb_quantized_int8b",bnb_quantized_nf4b:"quantized",gguf_quantized:"gguf",api:"api"},j8e={diffusers:"base",lycoris:"base",checkpoint:"orange",invokeai:"base",embedding_file:"base",embedding_folder:"base",t5_encoder:"base",bnb_quantized_int8b:"base",bnb_quantized_nf4b:"base",gguf_quantized:"base",api:"base"},_8e=({format:e})=>i.jsx(Hn,{flexGrow:0,colorScheme:j8e[e],variant:"subtle",children:k8e[e]}),I8e=c.memo(_8e),T8e={_hover:{bg:"base.700"},"&[aria-selected='true']":{bg:"base.700"}},A8e=({model:e})=>{const{t}=M(),n=G(),s=c.useMemo(()=>he(Hae,f=>f.selectedModelKey===e.key),[e.key]),o=A(s),[r]=Wae(),{isOpen:a,onOpen:l,onClose:d}=hi(),u=c.useCallback(()=>{n(pC(e.key))},[e.key,n]),h=c.useCallback(f=>{f.stopPropagation(),l()},[l]),p=c.useCallback(()=>{r({key:e.key}).unwrap().then(f=>{ge({id:"MODEL_DELETED",title:`${t("modelManager.modelDeleted")}: ${e.name}`,status:"success"})}).catch(f=>{f&&ge({id:"MODEL_DELETE_FAILED",title:`${t("modelManager.modelDeleteFailed")}: ${e.name}`,status:"error"})}),n(pC(null))},[r,e,n,t]);return i.jsxs(T,{sx:T8e,"aria-selected":o,justifyContent:"flex-start",p:2,borderRadius:"base",w:"full",alignItems:"center",gap:2,cursor:"pointer",onClick:u,children:[i.jsxs(T,{gap:2,w:"full",h:"full",minW:0,children:[i.jsx(hK,{image_url:e.cover_image}),i.jsxs(T,{gap:1,alignItems:"flex-start",flexDir:"column",w:"full",minW:0,children:[i.jsxs(T,{gap:2,w:"full",alignItems:"flex-start",children:[i.jsx(W,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",children:e.name}),i.jsx(W,{variant:"subtext",fontStyle:"italic",children:$I(e.file_size)}),i.jsx(Je,{})]}),i.jsx(W,{variant:"subtext",noOfLines:1,children:e.description||"No Description"})]}),i.jsxs(T,{h:$r,flexDir:"column",alignItems:"flex-end",justifyContent:"space-between",gap:2,children:[i.jsx(Y7,{base:e.base}),i.jsx(I8e,{format:e.format})]})]}),i.jsx(le,{onClick:h,icon:i.jsx(Pi,{size:16}),"aria-label":t("modelManager.deleteConfig"),colorScheme:"error",h:$r,w:$r}),i.jsx(ho,{isOpen:a,onClose:d,title:t("modelManager.deleteModel"),acceptCallback:p,acceptButtonText:t("modelManager.delete"),useInert:!1,children:i.jsxs(T,{rowGap:4,flexDirection:"column",children:[i.jsx(W,{fontWeight:"bold",children:t("modelManager.deleteMsg1")}),i.jsx(W,{children:t("modelManager.deleteMsg2")})]})})]})},M8e=c.memo(A8e),ps=c.memo(e=>{const{title:t,modelList:n}=e;return i.jsx(Ko,{title:t,contentSx:{gap:1,p:2},children:n.map(s=>i.jsx(M8e,{model:s},s.key))})});ps.displayName="ModelListWrapper";const E8e=()=>{const e=A(mD),t=A(gD),{t:n}=M(),[s,{isLoading:o}]=Ly(),r=c.useMemo(()=>js(s,t,e),[s,t,e]),[a,{isLoading:l}]=Dy(),d=c.useMemo(()=>js(a,t,e),[a,t,e]),[u,{isLoading:h}]=Ry(),p=c.useMemo(()=>js(u,t,e),[u,t,e]),[f,{isLoading:m}]=A9(),g=c.useMemo(()=>js(f,t,e),[f,t,e]),[x,{isLoading:b}]=yj(),C=c.useMemo(()=>js(x,t,e),[x,t,e]),[y,{isLoading:v}]=I9(),w=c.useMemo(()=>js(y,t,e),[y,t,e]),[k,{isLoading:S}]=T9(),P=c.useMemo(()=>js(k,t,e),[k,t,e]),[E,{isLoading:L}]=lme(),I=c.useMemo(()=>js(E,t,e),[E,t,e]),[O,{isLoading:N}]=Oy({excludeSubmodels:!0}),_=c.useMemo(()=>js(O,t,e),[O,t,e]),[R,{isLoading:D}]=bj({excludeSubmodels:!0}),B=c.useMemo(()=>js(R,t,e),[R,t,e]),[V,{isLoading:ee}]=_9(),se=c.useMemo(()=>js(V,t,e),[V,t,e]),[oe,{isLoading:te}]=Ec({excludeSubmodels:!0}),H=c.useMemo(()=>js(oe,t,e),[oe,t,e]),[z,{isLoading:Z}]=Mm(),U=c.useMemo(()=>js(z,t,e),[z,t,e]),[Y,{isLoading:$}]=E9(),F=c.useMemo(()=>js(Y,t,e),[Y,t,e]),[q,{isLoading:ie}]=P9(),ce=c.useMemo(()=>js(q,t,e),[q,t,e]),[me,{isLoading:Ie}]=L9(),we=c.useMemo(()=>js(me,t,e),[me,t,e]),Ee=c.useMemo(()=>r.length+d.length+p.length+g.length+C.length+w.length+P.length+I.length+_.length+U.length+F.length+ce.length+R.length+oe.length+V.length,[C.length,g.length,P.length,I.length,p.length,r.length,d.length,w.length,_.length,U.length,F.length,ce.length,R.length,oe.length,V.length]);return i.jsx(ns,{children:i.jsxs(T,{flexDirection:"column",w:"full",h:"full",gap:4,children:[o&&i.jsx(is,{loadingMessage:"Loading Main Models..."}),!o&&r.length>0&&i.jsx(ps,{title:n("modelManager.main"),modelList:r},"main"),l&&i.jsx(is,{loadingMessage:"Loading Refiner Models..."}),!l&&d.length>0&&i.jsx(ps,{title:n("sdxl.refiner"),modelList:d},"refiner"),h&&i.jsx(is,{loadingMessage:"Loading LoRAs..."}),!h&&p.length>0&&i.jsx(ps,{title:n("modelManager.loraModels"),modelList:p},"loras"),m&&i.jsx(is,{loadingMessage:"Loading Textual Inversions..."}),!m&&g.length>0&&i.jsx(ps,{title:n("modelManager.textualInversions"),modelList:g},"textual-inversions"),N&&i.jsx(is,{loadingMessage:"Loading VAEs..."}),!N&&_.length>0&&i.jsx(ps,{title:"VAE",modelList:_},"vae"),b&&i.jsx(is,{loadingMessage:"Loading ControlNets..."}),!b&&C.length>0&&i.jsx(ps,{title:"ControlNet",modelList:C},"controlnets"),S&&i.jsx(is,{loadingMessage:"Loading IP Adapters..."}),!S&&P.length>0&&i.jsx(ps,{title:n("common.ipAdapter"),modelList:P},"ip-adapters"),L&&i.jsx(is,{loadingMessage:"Loading CLIP Vision Models..."}),!L&&I.length>0&&i.jsx(ps,{title:"CLIP Vision",modelList:I},"clip-vision"),v&&i.jsx(is,{loadingMessage:"Loading T2I Adapters..."}),!v&&w.length>0&&i.jsx(ps,{title:n("common.t2iAdapter"),modelList:w},"t2i-adapters"),D&&i.jsx(is,{loadingMessage:"Loading T5 Encoder Models..."}),!D&&B.length>0&&i.jsx(ps,{title:n("modelManager.t5Encoder"),modelList:B},"t5-encoder"),ee&&i.jsx(is,{loadingMessage:"Loading Control Loras..."}),!ee&&se.length>0&&i.jsx(ps,{title:n("modelManager.controlLora"),modelList:se},"control-lora"),te&&i.jsx(is,{loadingMessage:"Loading Clip Embed Models..."}),!te&&H.length>0&&i.jsx(ps,{title:n("modelManager.clipEmbed"),modelList:H},"clip-embed"),Ie&&i.jsx(is,{loadingMessage:"Loading LLaVA OneVision Models..."}),!Ie&&we.length>0&&i.jsx(ps,{title:n("modelManager.llavaOnevision"),modelList:we},"llava-onevision"),Z&&i.jsx(is,{loadingMessage:"Loading Image-to-Image Models..."}),!Z&&U.length>0&&i.jsx(ps,{title:n("modelManager.spandrelImageToImage"),modelList:U},"spandrel-image-to-image"),$&&i.jsx(is,{loadingMessage:"Loading SigLIP Models..."}),!$&&F.length>0&&i.jsx(ps,{title:n("modelManager.sigLip"),modelList:F},"sig-lip"),ie&&i.jsx(is,{loadingMessage:"Loading Flux Redux Models..."}),!ie&&ce.length>0&&i.jsx(ps,{title:n("modelManager.fluxRedux"),modelList:ce},"flux-redux"),Ee===0&&i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(W,{children:n("modelManager.noMatchingModels")})})]})})},P8e=c.memo(E8e),js=(e,t,n)=>e.filter(s=>{const o=s.name.toLowerCase().includes(t.toLowerCase()),r=L8e(s,n);return o&&r}),L8e=(e,t)=>t==="refiner"?e.base==="sdxl-refiner":t==="main"&&e.base==="sdxl-refiner"?!1:t?e.type===t:!0,RK=c.memo(()=>{const{t:e}=M(),t=G(),n=c.useMemo(()=>({main:e("modelManager.main"),refiner:e("sdxl.refiner"),lora:"LoRA",embedding:e("modelManager.textualInversions"),controlnet:"ControlNet",vae:"VAE",t2i_adapter:e("common.t2iAdapter"),t5_encoder:e("modelManager.t5Encoder"),clip_embed:e("modelManager.clipEmbed"),ip_adapter:e("common.ipAdapter"),clip_vision:"CLIP Vision",spandrel_image_to_image:e("modelManager.spandrelImageToImage"),control_lora:e("modelManager.controlLora"),siglip:e("modelManager.sigLip"),flux_redux:e("modelManager.fluxRedux"),llava_onevision:e("modelManager.llavaOnevision")}),[e]),s=A(mD),o=c.useCallback(a=>{t(l5(a))},[t]),r=c.useCallback(()=>{t(l5(null))},[t]);return i.jsxs(on,{children:[i.jsx(rn,{as:de,size:"sm",leftIcon:i.jsx(Kpe,{}),children:s?n[s]:e("modelManager.allModels")}),i.jsxs(Et,{children:[i.jsx(fe,{onClick:r,children:e("modelManager.allModels")}),Ak(n).map(a=>i.jsx(fe,{bg:s===a?"base.700":"transparent",onClick:o.bind(null,a),children:n[a]},a))]})]})});RK.displayName="ModelTypeFilter";const OK=c.memo(()=>{const e=G(),t=A(gD),n=c.useCallback(o=>{e(c5(o.target.value))},[e]),s=c.useCallback(()=>{e(c5(""))},[e]);return i.jsxs(T,{gap:2,alignItems:"center",justifyContent:"space-between",children:[i.jsx(RK,{}),i.jsx(Je,{}),i.jsxs(Cr,{maxW:"400px",children:[i.jsx(St,{placeholder:Me("modelManager.search"),value:t||"","data-testid":"board-search-input",onChange:n}),!!(t!=null&&t.length)&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{size:"sm",variant:"link","aria-label":Me("boards.clearSearch"),icon:i.jsx(Rt,{}),onClick:s})})]})]})});OK.displayName="ModelListNavigation";const NK=c.memo(()=>{const{t:e}=M(),t=G(),n=c.useCallback(()=>{t(pC(null))},[t]),s=A(mm);return i.jsxs(T,{flexDir:"column",layerStyle:"first",p:4,gap:4,borderRadius:"base",w:"50%",h:"full",children:[i.jsxs(T,{w:"full",gap:4,justifyContent:"space-between",alignItems:"center",children:[i.jsx(zt,{fontSize:"xl",py:1,children:e("common.modelManager")}),!!s&&i.jsx(de,{size:"sm",colorScheme:"invokeYellow",leftIcon:i.jsx(Vt,{}),onClick:n,children:e("modelManager.addModels")})]}),i.jsxs(T,{flexDir:"column",layerStyle:"second",p:4,gap:4,borderRadius:"base",w:"full",h:"full",children:[i.jsx(OK,{}),i.jsx(P8e,{})]})]})});NK.displayName="ModelManager";const D8e=({model_key:e,model_image:t})=>{const[n,s]=c.useState(t||null),{t:o}=M(),[r,a]=Uae(),[l]=qae(),d=c.useCallback(f=>{const m=f[0];!m||!e||r({key:e,image:m}).unwrap().then(()=>{s(URL.createObjectURL(m)),ge({id:"MODEL_IMAGE_UPDATED",title:o("modelManager.modelImageUpdated"),status:"success"})}).catch(()=>{ge({id:"MODEL_IMAGE_UPDATE_FAILED",title:o("modelManager.modelImageUpdateFailed"),status:"error"})})},[e,o,r]),u=c.useCallback(()=>{e&&(s(null),l(e).unwrap().then(()=>{ge({id:"MODEL_IMAGE_DELETED",title:o("modelManager.modelImageDeleted"),status:"success"})}).catch(()=>{ge({id:"MODEL_IMAGE_DELETE_FAILED",title:o("modelManager.modelImageDeleteFailed"),status:"error"})}))},[e,o,l]),{getInputProps:h,getRootProps:p}=da({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"],"image/webp":[".webp"]},onDropAccepted:d,noDrag:!0,multiple:!1});return n?i.jsxs(Ce,{position:"relative",flexShrink:0,children:[i.jsx(Zt,{src:n,objectFit:"cover",objectPosition:"50% 50%",height:108,width:108,minWidth:108,borderRadius:"base"}),i.jsx(le,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:u,"aria-label":o("modelManager.deleteModelImage"),tooltip:o("modelManager.deleteModelImage"),icon:i.jsx(Zs,{}),size:"md",variant:"ghost"})]}):i.jsxs(i.Fragment,{children:[i.jsx(le,{variant:"ghost","aria-label":o("modelManager.uploadImage"),tooltip:o("modelManager.uploadImage"),w:108,h:108,fontSize:36,icon:i.jsx(km,{}),isLoading:a.isLoading,...p()}),i.jsx("input",{...h()})]})},R8e=en(D8e),GI=c.memo(({modelConfig:e,children:t})=>{const{t:n}=M();return i.jsxs(T,{alignItems:"flex-start",gap:4,children:[i.jsx(R8e,{model_key:e.key,model_image:e.cover_image}),i.jsxs(T,{flexDir:"column",gap:1,flexGrow:1,minW:0,children:[i.jsxs(T,{gap:2,children:[i.jsx(zt,{as:"h2",fontSize:"lg",noOfLines:1,wordBreak:"break-all",children:e.name}),i.jsx(Je,{}),t]}),e.source&&i.jsxs(W,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:[n("modelManager.source"),": ",e.source]}),i.jsx(W,{noOfLines:3,children:e.description})]})]})});GI.displayName="ModelHeader";const qE=[{value:"sd-1",label:Ml["sd-1"]},{value:"sd-2",label:Ml["sd-2"]},{value:"sd-3",label:Ml["sd-3"]},{value:"flux",label:Ml.flux},{value:"sdxl",label:Ml.sdxl},{value:"sdxl-refiner",label:Ml["sdxl-refiner"]}],O8e=({control:e})=>{const{field:t}=ws({control:e,name:"base"}),n=c.useMemo(()=>qE.find(o=>o.value===t.value),[t.value]),s=c.useCallback(o=>{t.onChange(o==null?void 0:o.value)},[t]);return i.jsx(Ke,{value:n,options:qE,onChange:s})},N8e=en(O8e),KE=[{value:"normal",label:"Normal"},{value:"inpaint",label:"Inpaint"},{value:"depth",label:"Depth"}],F8e=({control:e})=>{const{field:t}=ws({control:e,name:"variant"}),n=c.useMemo(()=>KE.find(o=>o.value===t.value),[t.value]),s=c.useCallback(o=>{t.onChange(o==null?void 0:o.value)},[t]);return i.jsx(Ke,{value:n,options:KE,onChange:s})},B8e=en(F8e),ZE=[{value:"none",label:"-"},{value:"epsilon",label:"epsilon"},{value:"v_prediction",label:"v_prediction"},{value:"sample",label:"sample"}],$8e=({control:e})=>{const{field:t}=ws({control:e,name:"prediction_type"}),n=c.useMemo(()=>ZE.find(o=>o.value===t.value),[t.value]),s=c.useCallback(o=>{(o==null?void 0:o.value)==="none"?t.onChange(void 0):t.onChange(o==null?void 0:o.value)},[t]);return i.jsx(Ke,{value:n,options:ZE,onChange:s})},V8e=en($8e),YE={validate:e=>e&&e.trim().length>3||"Must be at least 3 characters"},FK=c.memo(({modelConfig:e})=>{var d,u;const{t}=M(),[n,{isLoading:s}]=ry(),o=G(),r=Am({defaultValues:e,mode:"onChange"}),a=c.useCallback(h=>{const p={key:e.key,body:h};n(p).unwrap().then(f=>{r.reset(f,{keepDefaultValues:!0}),o(fC("view")),ge({id:"MODEL_UPDATED",title:t("modelManager.modelUpdated"),status:"success"})}).catch(f=>{r.reset(),ge({id:"MODEL_UPDATE_FAILED",title:t("modelManager.modelUpdateFailed"),status:"error"})})},[o,e.key,r,t,n]),l=c.useCallback(()=>{o(fC("view"))},[o]);return i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsxs(GI,{modelConfig:e,children:[i.jsx(de,{flexShrink:0,size:"sm",onClick:l,leftIcon:i.jsx(Rt,{}),children:t("common.cancel")}),i.jsx(de,{flexShrink:0,size:"sm",colorScheme:"invokeYellow",leftIcon:i.jsx(wm,{}),onClick:r.handleSubmit(a),isLoading:s,isDisabled:!!Object.keys(r.formState.errors).length,children:t("common.save")})]}),i.jsx(T,{flexDir:"column",h:"full",children:i.jsxs("form",{children:[i.jsx(T,{w:"full",justifyContent:"space-between",gap:4,alignItems:"center",children:i.jsxs(Q,{flexDir:"column",alignItems:"flex-start",gap:1,isInvalid:!!r.formState.errors.name,children:[i.jsx(J,{children:t("modelManager.modelName")}),i.jsx(St,{...r.register("name",YE),size:"md"}),((d=r.formState.errors.name)==null?void 0:d.message)&&i.jsx(xu,{children:(u=r.formState.errors.name)==null?void 0:u.message})]})}),i.jsxs(T,{flexDir:"column",gap:3,mt:"4",children:[i.jsx(T,{gap:"4",alignItems:"center",children:i.jsxs(Q,{flexDir:"column",alignItems:"flex-start",gap:1,children:[i.jsx(J,{children:t("modelManager.description")}),i.jsx(ls,{...r.register("description"),minH:32})]})}),e.type!=="clip_vision"&&i.jsx(zt,{as:"h3",fontSize:"md",mt:"4",children:t("modelManager.modelSettings")}),i.jsxs(ay,{columns:2,gap:4,children:[e.type!=="clip_vision"&&i.jsxs(Q,{flexDir:"column",alignItems:"flex-start",gap:1,children:[i.jsx(J,{children:t("modelManager.baseModel")}),i.jsx(N8e,{control:r.control})]}),e.type==="main"&&i.jsxs(Q,{flexDir:"column",alignItems:"flex-start",gap:1,children:[i.jsx(J,{children:t("modelManager.variant")}),i.jsx(B8e,{control:r.control})]}),e.type==="main"&&e.format==="checkpoint"&&i.jsxs(i.Fragment,{children:[i.jsxs(Q,{flexDir:"column",alignItems:"flex-start",gap:1,children:[i.jsx(J,{children:t("modelManager.pathToConfig")}),i.jsx(St,{...r.register("config_path",YE)})]}),i.jsxs(Q,{flexDir:"column",alignItems:"flex-start",gap:1,children:[i.jsx(J,{children:t("modelManager.predictionType")}),i.jsx(V8e,{control:r.control})]}),i.jsxs(Q,{flexDir:"column",alignItems:"flex-start",gap:1,children:[i.jsx(J,{children:t("modelManager.upcastAttention")}),i.jsx(_n,{...r.register("upcast_attention")})]})]})]})]})]})})]})});FK.displayName="ModelEdit";const z8e=e=>c.useMemo(()=>{var n,s;return{preprocessor:{isEnabled:!He((n=e==null?void 0:e.default_settings)==null?void 0:n.preprocessor),value:((s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor)||"none"}}},[e==null?void 0:e.default_settings]),Fo=am(e=>{const{field:t}=ws(e),n=c.useMemo(()=>!!t.value.isEnabled,[t.value]),s=c.useCallback(o=>{const r={...t.value,isEnabled:o.target.checked};t.onChange(r)},[t]);return i.jsx(et,{size:"sm",isChecked:n,onChange:s})});Fo.displayName="SettingToggle";const XE=[{label:"Canny",value:"canny_image_processor"},{label:"MLSD",value:"mlsd_image_processor"},{label:"Depth Anything",value:"depth_anything_image_processor"},{label:"Normal BAE",value:"normalbae_image_processor"},{label:"Pidi",value:"pidi_image_processor"},{label:"Lineart",value:"lineart_image_processor"},{label:"Lineart Anime",value:"lineart_anime_image_processor"},{label:"HED",value:"hed_image_processor"},{label:"Content Shuffle",value:"content_shuffle_image_processor"},{label:"DW OpenPose",value:"dw_openpose_image_processor"},{label:"MediaPipe Face",value:"mediapipe_face_processor"},{label:"ZoeDepth",value:"zoe_depth_image_processor"},{label:"Color Map",value:"color_map_image_processor"},{label:"None",value:"none"}],BK=c.memo(e=>{const{t}=M(),{field:n}=ws(e),s=c.useCallback(a=>{if(!a)return;const l={...n.value,value:a.value};n.onChange(l)},[n]),o=c.useMemo(()=>XE.find(a=>a.value===n.value.value),[n]),r=c.useMemo(()=>!n.value.isEnabled,[n.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"controlNetProcessor",children:i.jsx(J,{children:t("controlLayers.filter.filter")})}),i.jsx(Fo,{control:e.control,name:"preprocessor"})]}),i.jsx(Ke,{isDisabled:r,value:o,options:XE,onChange:s})]})});BK.displayName="DefaultPreprocessor";const $K=c.memo(({modelConfig:e})=>{const{t}=M(),n=z8e(e),[s,{isLoading:o}]=ry(),{handleSubmit:r,control:a,formState:l,reset:d}=Am({defaultValues:n}),u=c.useCallback(h=>{const p={preprocessor:h.preprocessor.isEnabled?h.preprocessor.value:null};s({key:e.key,body:{default_settings:p}}).unwrap().then(f=>{ge({id:"DEFAULT_SETTINGS_SAVED",title:t("modelManager.defaultSettingsSaved"),status:"success"}),d(h)}).catch(f=>{f&&ge({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${f.data.detail} `,status:"error"})})},[s,e.key,t,d]);return i.jsxs(i.Fragment,{children:[i.jsxs(T,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[i.jsx(zt,{fontSize:"md",children:t("modelManager.defaultSettings")}),i.jsx(de,{size:"sm",leftIcon:i.jsx(wm,{}),colorScheme:"invokeYellow",isDisabled:!l.isDirty,onClick:r(u),isLoading:o,children:t("common.save")})]}),i.jsx(ay,{columns:2,gap:8,children:i.jsx(BK,{control:a,name:"preprocessor"})})]})});$K.displayName="ControlAdapterModelDefaultSettings";const VK=c.memo(({modelConfig:e})=>{const{t}=M(),[n,{isLoading:s}]=Kae(),{isOpen:o,onOpen:r,onClose:a}=hi(),l=c.useCallback(()=>{if(!e||s)return;const d=`CONVERTING_MODEL_${e.key}`;ge({id:d,title:`${t("modelManager.convertingModelBegin")}: ${e.name}`,status:"info"}),n(e.key).unwrap().then(()=>{ge({id:d,title:`${t("modelManager.modelConverted")}: ${e.name}`,status:"success"})}).catch(()=>{ge({id:d,title:`${t("modelManager.modelConversionFailed")}: ${e.name}`,status:"error"})})},[e,s,t,n]);return i.jsxs(i.Fragment,{children:[i.jsxs(de,{onClick:r,size:"sm","aria-label":t("modelManager.convertToDiffusers"),className:" modal-close-btn",isLoading:s,flexShrink:0,children:[" ",t("modelManager.convert")]}),i.jsx(ho,{title:`${t("modelManager.convert")} ${e.name}`,acceptCallback:l,acceptButtonText:`${t("modelManager.convert")}`,isOpen:o,onClose:a,useInert:!1,children:i.jsxs(T,{flexDirection:"column",rowGap:4,children:[i.jsx(W,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText1")}),i.jsxs(ai,{children:[i.jsx(Ft,{children:i.jsx(W,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText2")})}),i.jsx(Ft,{children:i.jsx(W,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText3")})}),i.jsx(Ft,{children:i.jsx(W,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText4")})}),i.jsx(Ft,{children:i.jsx(W,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText5")})})]}),i.jsx(Ct,{}),i.jsx(W,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText6")})]})})]})});VK.displayName="ModelConvertButton";const zK=c.memo(()=>{const{t:e}=M(),t=G(),n=c.useCallback(()=>{t(fC("edit"))},[t]);return i.jsx(de,{size:"sm",leftIcon:i.jsx(Iy,{}),colorScheme:"invokeYellow",onClick:n,flexShrink:0,children:e("modelManager.edit")})});zK.displayName="ModelEditButton";const GK=c.memo(({modelConfig:e})=>{const{t}=M(),[n,s]=c.useState(""),[o,{isLoading:r}]=ry(),a=c.useCallback(f=>{s(f.target.value)},[]),l=c.useMemo(()=>(e==null?void 0:e.trigger_phrases)||[],[e]),d=c.useMemo(()=>{const f=[];return n.length&&l.includes(n)&&f.push("Phrase is already in list"),f},[n,l]),u=c.useCallback(async()=>{!n.length||l.includes(n)||(s(""),await o({key:e.key,body:{trigger_phrases:[...l,n]}}).unwrap())},[n,l,o,e.key]),h=c.useCallback(async f=>{const m=l.filter(g=>g!==f);await o({key:e.key,body:{trigger_phrases:m}}).unwrap()},[l,o,e]),p=c.useCallback(f=>{f.preventDefault(),u()},[u]);return i.jsxs(T,{flexDir:"column",w:"full",gap:"5",children:[i.jsx("form",{onSubmit:p,children:i.jsxs(Q,{w:"full",isInvalid:!!d.length,orientation:"vertical",children:[i.jsx(J,{children:t("modelManager.triggerPhrases")}),i.jsxs(T,{flexDir:"column",w:"full",children:[i.jsxs(T,{gap:"3",alignItems:"center",w:"full",children:[i.jsx(St,{value:n,onChange:a,placeholder:t("modelManager.typePhraseHere")}),i.jsx(de,{leftIcon:i.jsx(Vt,{}),size:"sm",onClick:u,isDisabled:!n||!!d.length,isLoading:r,children:t("common.add")})]}),d.map(f=>i.jsx(xu,{children:f},f))]})]})}),i.jsx(T,{gap:"4",flexWrap:"wrap",children:l.map((f,m)=>i.jsxs(ey,{size:"md",py:2,px:4,bg:"base.700",children:[i.jsx(nk,{children:f}),i.jsx(ty,{onClick:h.bind(null,f),isDisabled:r})]},m))})]})});GK.displayName="TriggerPhrases";const G8e=fn(Ri,e=>{const{steps:t,guidance:n,scheduler:s,cfgRescaleMultiplier:o,vaePrecision:r,width:a,height:l}=e.sd,{guidance:d}=e.flux;return{initialSteps:t.initial,initialCfg:n.initial,initialScheduler:s,initialCfgRescaleMultiplier:o.initial,initialVaePrecision:r,initialWidth:a.initial,initialHeight:l.initial,initialGuidance:d.initial}}),H8e=e=>{const{initialSteps:t,initialCfg:n,initialScheduler:s,initialCfgRescaleMultiplier:o,initialVaePrecision:r,initialWidth:a,initialHeight:l,initialGuidance:d}=A(G8e);return c.useMemo(()=>{var h,p,f,m,g,x,b,C,y,v,w,k,S,P,E,L,I,O;return{vae:{isEnabled:!He((h=e==null?void 0:e.default_settings)==null?void 0:h.vae),value:((p=e==null?void 0:e.default_settings)==null?void 0:p.vae)||"default"},vaePrecision:{isEnabled:!He((f=e==null?void 0:e.default_settings)==null?void 0:f.vae_precision),value:((m=e==null?void 0:e.default_settings)==null?void 0:m.vae_precision)||r||"fp32"},scheduler:{isEnabled:!He((g=e==null?void 0:e.default_settings)==null?void 0:g.scheduler),value:((x=e==null?void 0:e.default_settings)==null?void 0:x.scheduler)||s||"dpmpp_3m_k"},steps:{isEnabled:!He((b=e==null?void 0:e.default_settings)==null?void 0:b.steps),value:((C=e==null?void 0:e.default_settings)==null?void 0:C.steps)||t},cfgScale:{isEnabled:!He((y=e==null?void 0:e.default_settings)==null?void 0:y.cfg_scale),value:((v=e==null?void 0:e.default_settings)==null?void 0:v.cfg_scale)||n},cfgRescaleMultiplier:{isEnabled:!He((w=e==null?void 0:e.default_settings)==null?void 0:w.cfg_rescale_multiplier),value:((k=e==null?void 0:e.default_settings)==null?void 0:k.cfg_rescale_multiplier)||o},width:{isEnabled:!He((S=e==null?void 0:e.default_settings)==null?void 0:S.width),value:((P=e==null?void 0:e.default_settings)==null?void 0:P.width)||a},height:{isEnabled:!He((E=e==null?void 0:e.default_settings)==null?void 0:E.height),value:((L=e==null?void 0:e.default_settings)==null?void 0:L.height)||l},guidance:{isEnabled:!He((I=e==null?void 0:e.default_settings)==null?void 0:I.guidance),value:((O=e==null?void 0:e.default_settings)==null?void 0:O.guidance)||d}}},[e,r,s,t,n,o,a,l,d])},HK=c.memo(({control:e,optimalDimension:t})=>{const{field:n}=ws({control:e,name:"height"}),s=A(pD),{t:o}=M(),r=c.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),a=c.useCallback(u=>{const h={...n.value,value:u};n.onChange(h)},[n]),l=c.useMemo(()=>n.value.value,[n.value]),d=c.useMemo(()=>!n.value.isEnabled,[n.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramHeight",children:i.jsx(J,{children:o("parameters.height")})}),i.jsx(Fo,{control:e,name:"height"})]}),i.jsxs(T,{w:"full",gap:4,children:[i.jsx(Ze,{value:l,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:r,isDisabled:d}),i.jsx(_e,{value:l,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,isDisabled:d})]})]})});HK.displayName="DefaultHeight";const WK=c.memo(({control:e,optimalDimension:t})=>{const{field:n}=ws({control:e,name:"width"}),s=A(fD),{t:o}=M(),r=c.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),a=c.useCallback(u=>{const h={...n.value,value:u};n.onChange(h)},[n]),l=c.useMemo(()=>n.value.value,[n.value]),d=c.useMemo(()=>!n.value.isEnabled,[n.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramWidth",children:i.jsx(J,{children:o("parameters.width")})}),i.jsx(Fo,{control:e,name:"width"})]}),i.jsxs(T,{w:"full",gap:4,children:[i.jsx(Ze,{value:l,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:r,isDisabled:d}),i.jsx(_e,{value:l,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,isDisabled:d})]})]})});WK.displayName="DefaultWidth";const UK=c.memo(e=>{const{field:t}=ws(e),n=A(tD),{t:s}=M(),o=c.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),r=c.useCallback(d=>{const u={...t.value,value:d};t.onChange(u)},[t]),a=c.useMemo(()=>t.value.value,[t.value]),l=c.useMemo(()=>!t.value.isEnabled,[t.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramCFGRescaleMultiplier",children:i.jsx(J,{children:s("parameters.cfgRescaleMultiplier")})}),i.jsx(Fo,{control:e.control,name:"cfgRescaleMultiplier"})]}),i.jsxs(T,{w:"full",gap:4,children:[i.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:r,marks:o,isDisabled:l}),i.jsx(_e,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:r,isDisabled:l})]})]})});UK.displayName="DefaultCfgRescaleMultiplier";const qK=c.memo(e=>{const{field:t}=ws(e),n=A(oy),{t:s}=M(),o=c.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),r=c.useCallback(d=>{const u={...t.value,value:d};t.onChange(u)},[t]),a=c.useMemo(()=>t.value.value,[t.value]),l=c.useMemo(()=>!t.value.isEnabled,[t.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramCFGScale",children:i.jsx(J,{children:s("parameters.cfgScale")})}),i.jsx(Fo,{control:e.control,name:"cfgScale"})]}),i.jsxs(T,{w:"full",gap:4,children:[i.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:r,marks:o,isDisabled:l}),i.jsx(_e,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:r,isDisabled:l})]})]})});qK.displayName="DefaultCfgScale";const KK=c.memo(e=>{const{field:t}=ws(e),n=A(dD),{t:s}=M(),o=c.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax-(n.sliderMax-n.sliderMin)/2),n.sliderMax],[n.sliderMax,n.sliderMin]),r=c.useCallback(d=>{const u={...t.value,value:d};t.onChange(u)},[t]),a=c.useMemo(()=>t.value.value,[t.value]),l=c.useMemo(()=>!t.value.isEnabled,[t.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramGuidance",children:i.jsx(J,{children:s("parameters.guidance")})}),i.jsx(Fo,{control:e.control,name:"guidance"})]}),i.jsxs(T,{w:"full",gap:4,children:[i.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:r,marks:o,isDisabled:l}),i.jsx(_e,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:r,isDisabled:l})]})]})});KK.displayName="DefaultGuidance";const ZK=c.memo(e=>{const{t}=M(),{field:n}=ws(e),s=c.useCallback(a=>{if(!um(a==null?void 0:a.value))return;const l={...n.value,value:a.value};n.onChange(l)},[n]),o=c.useMemo(()=>fr.find(a=>a.value===n.value.value),[n]),r=c.useMemo(()=>!n.value.isEnabled,[n.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramScheduler",children:i.jsx(J,{children:t("parameters.scheduler")})}),i.jsx(Fo,{control:e.control,name:"scheduler"})]}),i.jsx(Ke,{isDisabled:r,value:o,options:fr,onChange:s})]})});ZK.displayName="DefaultScheduler";const YK=c.memo(e=>{const{field:t}=ws(e),n=A(bk),{t:s}=M(),o=c.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),r=c.useCallback(d=>{const u={...t.value,value:d};t.onChange(u)},[t]),a=c.useMemo(()=>t.value.value,[t.value]),l=c.useMemo(()=>!t.value.isEnabled,[t.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramSteps",children:i.jsx(J,{children:s("parameters.steps")})}),i.jsx(Fo,{control:e.control,name:"steps"})]}),i.jsxs(T,{w:"full",gap:4,children:[i.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:r,marks:o,isDisabled:l}),i.jsx(_e,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:r,isDisabled:l})]})]})});YK.displayName="DefaultSteps";const XK=c.memo(e=>{const{t}=M(),{field:n}=ws(e),s=A(mm),{data:o}=lm(s??cs),[r]=Oy(),a=c.useMemo(()=>{const h=r.filter(f=>f.base===(o==null?void 0:o.base)).map(f=>({label:f.name,value:f.key}));return[{label:"Default VAE",value:"default"},...h]},[o==null?void 0:o.base,r]),l=c.useCallback(h=>{const p=h!=null&&h.value?h.value:"default",f={...n.value,value:p};n.onChange(f)},[n]),d=c.useMemo(()=>a.find(h=>h.value===n.value.value),[a,n.value]),u=c.useMemo(()=>!n.value.isEnabled,[n.value]);return i.jsxs(Q,{flexDir:"column",gap:2,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramVAE",children:i.jsx(J,{children:t("modelManager.vae")})}),i.jsx(Fo,{control:e.control,name:"vae"})]}),i.jsx(Ke,{isDisabled:u,value:d,options:a,onChange:l})]})});XK.displayName="DefaultVae";const QE=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],QK=c.memo(e=>{const{t}=M(),{field:n}=ws(e),s=c.useCallback(a=>{if(!rD(a==null?void 0:a.value))return;const l={...n.value,value:a.value};n.onChange(l)},[n]),o=c.useMemo(()=>QE.find(a=>a.value===n.value.value),[n]),r=c.useMemo(()=>!n.value.isEnabled,[n.value]);return i.jsxs(Q,{flexDir:"column",gap:1,alignItems:"flex-start",children:[i.jsxs(T,{justifyContent:"space-between",w:"full",children:[i.jsx($e,{feature:"paramVAEPrecision",children:i.jsx(J,{children:t("modelManager.vaePrecision")})}),i.jsx(Fo,{control:e.control,name:"vaePrecision"})]}),i.jsx(Ke,{isDisabled:r,value:o,options:QE,onChange:s})]})});QK.displayName="DefaultVaePrecision";const JK=c.memo(({modelConfig:e})=>{const t=A(mm),{t:n}=M(),s=c.useMemo(()=>e.base==="flux",[e]),o=H8e(e),r=c.useMemo(()=>{const m=e==null?void 0:e.base;return sP(m??null)},[e]),[a,{isLoading:l}]=ry(),{handleSubmit:d,control:u,formState:h,reset:p}=Am({defaultValues:o}),f=c.useCallback(m=>{if(!t)return;const g={vae:m.vae.isEnabled?m.vae.value:null,vae_precision:m.vaePrecision.isEnabled?m.vaePrecision.value:null,cfg_scale:m.cfgScale.isEnabled?m.cfgScale.value:null,cfg_rescale_multiplier:m.cfgRescaleMultiplier.isEnabled?m.cfgRescaleMultiplier.value:null,steps:m.steps.isEnabled?m.steps.value:null,scheduler:m.scheduler.isEnabled?m.scheduler.value:null,width:m.width.isEnabled?m.width.value:null,height:m.height.isEnabled?m.height.value:null,guidance:m.guidance.isEnabled?m.guidance.value:null};a({key:t,body:{default_settings:g}}).unwrap().then(x=>{ge({id:"DEFAULT_SETTINGS_SAVED",title:n("modelManager.defaultSettingsSaved"),status:"success"}),p(m)}).catch(x=>{x&&ge({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${x.data.detail} `,status:"error"})})},[t,p,a,n]);return i.jsxs(i.Fragment,{children:[i.jsxs(T,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[i.jsx(zt,{fontSize:"md",children:n("modelManager.defaultSettings")}),i.jsx(de,{size:"sm",leftIcon:i.jsx(wm,{}),colorScheme:"invokeYellow",isDisabled:!h.isDirty,onClick:d(f),isLoading:l,children:n("common.save")})]}),i.jsxs(ay,{columns:2,gap:8,children:[i.jsx(XK,{control:u,name:"vae"}),!s&&i.jsx(QK,{control:u,name:"vaePrecision"}),!s&&i.jsx(ZK,{control:u,name:"scheduler"}),i.jsx(YK,{control:u,name:"steps"}),s&&i.jsx(KK,{control:u,name:"guidance"}),!s&&i.jsx(qK,{control:u,name:"cfgScale"}),!s&&i.jsx(UK,{control:u,name:"cfgRescaleMultiplier"}),i.jsx(WK,{control:u,optimalDimension:r}),i.jsx(HK,{control:u,optimalDimension:r})]})]})});JK.displayName="MainModelDefaultSettings";const qi=c.memo(({label:e,value:t})=>i.jsxs(Q,{flexDir:"column",alignItems:"flex-start",gap:0,children:[i.jsx(J,{children:e}),i.jsx(W,{fontSize:"md",noOfLines:1,wordBreak:"break-all",children:t||"-"})]}));qi.displayName="ModelAttrView";const W8e=(e,t)=>e.base==="any"||t.base==="any"?!0:e.base===t.base,eZ=e=>{switch(e){case"main":case"checkpoint":return"orange";case"lora":case"lycoris":return"purple";case"embedding":case"embedding_file":return"teal";case"vae":return"blue";case"controlnet":case"ip_adapter":case"t2i_adapter":return"cyan";case"onnx":case"bnb_quantized_int8b":case"bnb_quantized_nf4b":case"gguf_quantized":return"pink";case"t5_encoder":case"clip_embed":case"clip_vision":case"siglip":return"green";default:return"base"}},JE=e=>{var t;return((t=e.split("/")[1])==null?void 0:t.trim().toLowerCase())||""},tZ=c.memo(({modelConfig:e})=>{const{t}=M(),[n,{isLoading:s}]=lEe(),[o,{isLoading:r}]=cEe(),a=s||r,[l,d]=c.useState(""),{data:u}=gu(),{data:h=[]}=aEe(e.key),p=c.useMemo(()=>new Set(h),[h]),f=c.useMemo(()=>["main","lora"],[]),m=c.useMemo(()=>new Set(["main|main","vae|vae","controlnet|controlnet","clip_vision|clip_vision","control_lora|control_lora","clip_embed|clip_embed","spandrel_image_to_image|spandrel_image_to_image","siglip|siglip","flux_redux|flux_redux"]),[]),g=c.useCallback((I,O)=>{const N=f.indexOf(I),_=f.indexOf(O);return(N===-1?99:N)-(_===-1?99:_)},[f]),x=c.useMemo(()=>{if(!u)return[];const I=(O,N)=>m.has(`${O}|${N}`)||m.has(`${N}|${O}`);return Object.values(u.entities).filter(O=>!!O&&O.key!==e.key&&!p.has(O.key)&&W8e(e,O)&&!I(e.type,O.type))},[u,e,p,m]),b=c.useMemo(()=>{const I=[];return l&&p.has(l)&&I.push("Item already promoted"),I},[l,p]),C=c.useCallback(async()=>{const I=x.find(O=>O.key===l);I&&(d(""),await n({model_key_1:e.key,model_key_2:I.key}))},[e,x,n,l]),{options:y,onChange:v,placeholder:w,noOptionsMessage:k}=ma({modelConfigs:x,selectedModel:null,onChange:I=>{I&&d(I.key)},groupByType:!0}),S=c.useMemo(()=>y.flatMap(I=>I.options).find(I=>I.value===l)??null,[l,y]),P=c.useMemo(()=>[...y].sort((I,O)=>g(JE(I.label??""),JE(O.label??""))),[y,g]),E=c.useMemo(()=>{if(!u)return[];const I=[...h].map(N=>u.entities[N]).filter(N=>!!N);I.sort((N,_)=>g(N.type,_.type)||N.type.localeCompare(_.type)||N.name.localeCompare(_.name));const O=new Map;for(const N of I)O.has(N.type)||O.set(N.type,{type:N.type,label:N.type.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase()),color:eZ(N.type),models:[]}),O.get(N.type).models.push(N);return Array.from(O.values())},[u,h,g]),L=c.useMemo(()=>{const I=new Map;if(!u)return I;for(const O of E)for(const N of O.models)I.set(N.key,()=>{u.entities[N.key]&&o({model_key_1:e.key,model_key_2:N.key}).unwrap()});return I},[E,e.key,u,o]);return i.jsxs(T,{direction:"column",gap:"5",w:"full",children:[i.jsx(J,{children:t("modelManager.relatedModels")}),i.jsxs(Q,{isInvalid:b.length>0,children:[i.jsxs(T,{gap:"3",alignItems:"center",w:"full",children:[i.jsx(Ke,{value:S,placeholder:w,options:P,onChange:v,noOptionsMessage:k}),i.jsx(de,{leftIcon:i.jsx(Vt,{}),size:"sm",onClick:C,isDisabled:!l||b.length>0,isLoading:a,children:t("common.add")})]}),b.map(I=>i.jsx(xu,{children:I},I))]}),i.jsx(Ce,{children:i.jsx(T,{gap:"2",flexWrap:"wrap",children:E.map((I,O)=>{const N=O<E.length-1;return i.jsxs(Ce,{mb:4,children:[i.jsx(q8e,{group:I,isLoading:a,removeHandlers:L}),N&&i.jsx(Ct,{my:4,opacity:.3})]},I.type)})})})]})}),U8e=({model:e,onRemove:t,isLoading:n})=>i.jsxs(ey,{py:2,px:4,bg:`${eZ(e.type)}.700`,children:[i.jsx(Oe,{label:`${e.type}: ${e.name}`,hasArrow:!0,children:i.jsx(nk,{maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:e.name})}),i.jsx(ty,{onClick:t,isDisabled:n})]}),q8e=({group:e,isLoading:t,removeHandlers:n})=>i.jsx(T,{gap:"2",flexWrap:"wrap",alignItems:"center",children:e.models.map(s=>i.jsx(U8e,{model:s,onRemove:n.get(s.key),isLoading:t},s.key))});tZ.displayName="RelatedModels";const nZ=c.memo(({modelConfig:e})=>{const{t}=M(),n=c.useMemo(()=>e.type==="main"&&e.base!=="sdxl-refiner"||e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora"||e.type==="main"||e.type==="lora",[e.base,e.type]);return i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsxs(GI,{modelConfig:e,children:[e.format==="checkpoint"&&e.type==="main"&&i.jsx(VK,{modelConfig:e}),i.jsx(zK,{})]}),i.jsxs(T,{flexDir:"column",h:"full",gap:4,children:[i.jsx(Ce,{layerStyle:"second",borderRadius:"base",p:4,children:i.jsxs(ay,{columns:2,gap:4,children:[i.jsx(qi,{label:t("modelManager.baseModel"),value:e.base}),i.jsx(qi,{label:t("modelManager.modelType"),value:e.type}),i.jsx(qi,{label:t("common.format"),value:e.format}),i.jsx(qi,{label:t("modelManager.path"),value:e.path}),i.jsx(qi,{label:t("modelManager.fileSize"),value:$I(e.file_size)}),e.type==="main"&&i.jsx(qi,{label:t("modelManager.variant"),value:e.variant}),e.type==="main"&&e.format==="diffusers"&&e.repo_variant&&i.jsx(qi,{label:t("modelManager.repoVariant"),value:e.repo_variant}),e.type==="main"&&e.format==="checkpoint"&&i.jsxs(i.Fragment,{children:[i.jsx(qi,{label:t("modelManager.pathToConfig"),value:e.config_path}),i.jsx(qi,{label:t("modelManager.predictionType"),value:e.prediction_type}),i.jsx(qi,{label:t("modelManager.upcastAttention"),value:`${e.upcast_attention}`})]}),e.type==="ip_adapter"&&e.format==="invokeai"&&i.jsx(qi,{label:t("modelManager.imageEncoderModelId"),value:e.image_encoder_model_id})]})}),n&&i.jsxs(Ce,{layerStyle:"second",borderRadius:"base",p:4,children:[e.type==="main"&&e.base!=="sdxl-refiner"&&i.jsx(JK,{modelConfig:e}),(e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora")&&i.jsx($K,{modelConfig:e}),(e.type==="main"||e.type==="lora")&&i.jsx(GK,{modelConfig:e})]}),i.jsx(Ce,{maxH:"200px",overflowY:"auto",layerStyle:"second",borderRadius:"base",p:4,children:i.jsx(tZ,{modelConfig:e})})]})]})});nZ.displayName="ModelView";const sZ=c.memo(()=>{const{t:e}=M(),t=A(Zae),n=A(mm),{data:s,isLoading:o}=gu(),r=c.useMemo(()=>{if(!s||n===null)return null;const a=aa.selectById(s,n);return a||null},[s,n]);return o?i.jsx(Ny,{label:e("common.loading")}):r?t==="view"?i.jsx(nZ,{modelConfig:r}):i.jsx(FK,{modelConfig:r}):i.jsx(Ot,{label:e("common.somethingWentWrong"),icon:I7})});sZ.displayName="Model";const iZ=c.memo(()=>{const e=A(mm);return i.jsx(Ce,{layerStyle:"first",p:4,borderRadius:"base",w:"50%",h:"full",children:e?i.jsx(sZ,{},e):i.jsx(j9,{})})});iZ.displayName="ModelPane";const K8e=()=>i.jsxs(T,{layerStyle:"body",w:"full",h:"full",gap:"2",children:[i.jsx(NK,{}),i.jsx(iZ,{})]}),Z8e=c.memo(K8e),Y8e=()=>{const{t:e}=M(),{data:t}=gm(),n=re(Jn),[s,{isLoading:o}]=Yae({fixedCacheKey:"clearInvocationCache"}),r=c.useMemo(()=>!(t!=null&&t.size)||!n,[t==null?void 0:t.size,n]);return{clearInvocationCache:c.useCallback(async()=>{if(!r)try{await s().unwrap(),ge({id:"INVOCATION_CACHE_CLEAR_SUCCEEDED",title:e("invocationCache.clearSucceeded"),status:"success"})}catch{ge({id:"INVOCATION_CACHE_CLEAR_FAILED",title:e("invocationCache.clearFailed"),status:"error"})}},[r,s,e]),isLoading:o,cacheStatus:t,isDisabled:r}},X8e=()=>{const{t:e}=M(),{clearInvocationCache:t,isDisabled:n,isLoading:s}=Y8e();return i.jsx(de,{isDisabled:n,isLoading:s,onClick:t,children:e("invocationCache.clear")})},Q8e=c.memo(X8e),J8e=({children:e,...t})=>i.jsx(Xae,{alignItems:"center",justifyContent:"center",w:"full",h:"full",layerStyle:"first",borderRadius:"base",py:2,px:3,gap:6,flexWrap:"nowrap",...t,children:e}),oZ=c.memo(J8e),ePe={'&[aria-disabled="true"]':{color:"base.500"}},tPe=({label:e,value:t,isDisabled:n=!1,...s})=>i.jsxs(Qae,{flexGrow:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","aria-disabled":n,sx:ePe,...s,children:[i.jsx(Jae,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:e}),i.jsx(ele,{children:t})]}),Zo=c.memo(tPe),nPe=()=>{const{t:e}=M(),{data:t}=gm(),n=re(Jn),[s,{isLoading:o}]=tle({fixedCacheKey:"disableInvocationCache"}),r=c.useMemo(()=>!(t!=null&&t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{disableInvocationCache:c.useCallback(async()=>{if(!r)try{await s().unwrap(),ge({id:"INVOCATION_CACHE_DISABLE_SUCCEEDED",title:e("invocationCache.disableSucceeded"),status:"success"})}catch{ge({id:"INVOCATION_CACHE_DISABLE_FAILED",title:e("invocationCache.disableFailed"),status:"error"})}},[r,s,e]),isLoading:o,cacheStatus:t,isDisabled:r}},sPe=()=>{const{t:e}=M(),{data:t}=gm(),n=re(Jn),[s,{isLoading:o}]=nle({fixedCacheKey:"enableInvocationCache"}),r=c.useMemo(()=>(t==null?void 0:t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{enableInvocationCache:c.useCallback(async()=>{if(!r)try{await s().unwrap(),ge({id:"INVOCATION_CACHE_ENABLE_SUCCEEDED",title:e("invocationCache.enableSucceeded"),status:"success"})}catch{ge({id:"INVOCATION_CACHE_ENABLE_FAILED",title:e("invocationCache.enableFailed"),status:"error"})}},[r,s,e]),isLoading:o,cacheStatus:t,isDisabled:r}},iPe=()=>{const{t:e}=M(),{data:t}=gm(),{enableInvocationCache:n,isDisabled:s,isLoading:o}=sPe(),{disableInvocationCache:r,isDisabled:a,isLoading:l}=nPe();return t!=null&&t.enabled?i.jsx(de,{isDisabled:a,isLoading:l,onClick:r,children:e("invocationCache.disable")}):i.jsx(de,{isDisabled:s,isLoading:o,onClick:n,children:e("invocationCache.enable")})},oPe=c.memo(iPe),rPe=()=>{const{t:e}=M(),{data:t}=gm(void 0);return i.jsxs(oZ,{children:[i.jsx(Zo,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.cacheSize"),value:(t==null?void 0:t.size)??0}),i.jsx(Zo,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.hits"),value:(t==null?void 0:t.hits)??0}),i.jsx(Zo,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.misses"),value:(t==null?void 0:t.misses)??0}),i.jsx(Zo,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.maxCacheSize"),value:(t==null?void 0:t.max_size)??0}),i.jsxs(Qn,{w:24,orientation:"vertical",size:"sm",children:[i.jsx(Q8e,{}),i.jsx(oPe,{})]})]})},aPe=c.memo(rPe),Tb=0,Cl=1,ah=2,rZ=4;function e3(e){return()=>e}function lPe(e){e()}function aZ(e,t){return n=>e(t(n))}function t3(e,t){return()=>e(t)}function lZ(e,t){return n=>e(t,n)}function HI(e){return e!==void 0}function cPe(...e){return()=>{e.map(lPe)}}function lh(){}function Ab(e,t){return t(e),e}function dPe(e,t){return t(e)}function mn(...e){return e}function Kt(e,t){return e(Cl,t)}function wt(e,t){e(Tb,t)}function WI(e){e(ah)}function Ds(e){return e(rZ)}function qe(e,t){return Kt(e,lZ(t,Tb))}function vr(e,t){const n=e(Cl,s=>{n(),t(s)});return n}function n3(e){let t,n;return s=>o=>{t=o,n&&clearTimeout(n),n=setTimeout(()=>{s(t)},e)}}function cZ(e,t){return e===t}function hn(e=cZ){let t;return n=>s=>{e(t,s)||(t=s,n(s))}}function ct(e){return t=>n=>{e(n)&&t(n)}}function Ge(e){return t=>aZ(t,e)}function Yo(e){return t=>()=>{t(e)}}function Se(e,...t){const n=uPe(...t);return(s,o)=>{switch(s){case ah:WI(e);return;case Cl:return Kt(e,n(o))}}}function sr(e,t){return n=>s=>{n(t=e(t,s))}}function uu(e){return t=>n=>{e>0?e--:t(n)}}function Ga(e){let t=null,n;return s=>o=>{t=o,!n&&(n=setTimeout(()=>{n=void 0,s(t)},e))}}function kt(...e){const t=new Array(e.length);let n=0,s=null;const o=Math.pow(2,e.length)-1;return e.forEach((r,a)=>{const l=Math.pow(2,a);Kt(r,d=>{const u=n;n=n|l,t[a]=d,u!==o&&n===o&&s&&(s(),s=null)})}),r=>a=>{const l=()=>{r([a].concat(t))};n===o?l():s=l}}function uPe(...e){return t=>e.reduceRight(dPe,t)}function hPe(e){let t,n;const s=()=>t==null?void 0:t();return function(o,r){switch(o){case Cl:return r?n===r?void 0:(s(),n=r,t=Kt(e,r),t):(s(),lh);case ah:s(),n=null;return}}}function Ae(e){let t=e;const n=Dt();return(s,o)=>{switch(s){case Tb:t=o;break;case Cl:{o(t);break}case rZ:return t}return n(s,o)}}function Rs(e,t){return Ab(Ae(t),n=>qe(e,n))}function Dt(){const e=[];return(t,n)=>{switch(t){case Tb:e.slice().forEach(s=>{s(n)});return;case ah:e.splice(0,e.length);return;case Cl:return e.push(n),()=>{const s=e.indexOf(n);s>-1&&e.splice(s,1)}}}}function Ii(e){return Ab(Dt(),t=>qe(e,t))}function Ht(e,t=[],{singleton:n}={singleton:!0}){return{constructor:e,dependencies:t,id:pPe(),singleton:n}}const pPe=()=>Symbol();function fPe(e){const t=new Map,n=({constructor:s,dependencies:o,id:r,singleton:a})=>{if(a&&t.has(r))return t.get(r);const l=s(o.map(d=>n(d)));return a&&t.set(r,l),l};return n(e)}function Yn(...e){const t=Dt(),n=new Array(e.length);let s=0;const o=Math.pow(2,e.length)-1;return e.forEach((r,a)=>{const l=Math.pow(2,a);Kt(r,d=>{n[a]=d,s=s|l,s===o&&wt(t,n)})}),function(r,a){switch(r){case ah:{WI(t);return}case Cl:return s===o&&a(n),Kt(t,a)}}}function dt(e,t=cZ){return Se(e,hn(t))}function s3(...e){return function(t,n){switch(t){case ah:return;case Cl:return cPe(...e.map(s=>Kt(s,n)))}}}var Ti=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(Ti||{});const mPe={0:"debug",3:"error",1:"log",2:"warn"},gPe=()=>typeof globalThis>"u"?window:globalThis,wl=Ht(()=>{const e=Ae(3);return{log:Ae((t,n,s=1)=>{var o;const r=(o=gPe().VIRTUOSO_LOG_LEVEL)!=null?o:Ds(e);s>=r&&console[mPe[s]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",t,n)}),logLevel:e}},[],{singleton:!0});function Vc(e,t,n){return UI(e,t,n).callbackRef}function UI(e,t,n){const s=xe.useRef(null);let o=r=>{};if(typeof ResizeObserver<"u"){const r=xe.useMemo(()=>new ResizeObserver(a=>{const l=()=>{const d=a[0].target;d.offsetParent!==null&&e(d)};n?l():requestAnimationFrame(l)}),[e]);o=a=>{a&&t?(r.observe(a),s.current=a):(s.current&&r.unobserve(s.current),s.current=null)}}return{callbackRef:o,ref:s}}function xPe(e,t,n,s,o,r,a,l,d){const u=xe.useCallback(h=>{const p=yPe(h.children,t,l?"offsetWidth":"offsetHeight",o);let f=h.parentElement;for(;!f.dataset.virtuosoScroller;)f=f.parentElement;const m=f.lastElementChild.dataset.viewportType==="window";let g;m&&(g=f.ownerDocument.defaultView);const x=a?l?a.scrollLeft:a.scrollTop:m?l?g.scrollX||g.document.documentElement.scrollLeft:g.scrollY||g.document.documentElement.scrollTop:l?f.scrollLeft:f.scrollTop,b=a?l?a.scrollWidth:a.scrollHeight:m?l?g.document.documentElement.scrollWidth:g.document.documentElement.scrollHeight:l?f.scrollWidth:f.scrollHeight,C=a?l?a.offsetWidth:a.offsetHeight:m?l?g.innerWidth:g.innerHeight:l?f.offsetWidth:f.offsetHeight;s({scrollHeight:b,scrollTop:Math.max(x,0),viewportHeight:C}),r==null||r(l?i3("column-gap",getComputedStyle(h).columnGap,o):i3("row-gap",getComputedStyle(h).rowGap,o)),p!==null&&e(p)},[e,t,o,r,a,s]);return UI(u,n,d)}function yPe(e,t,n,s){const o=e.length;if(o===0)return null;const r=[];for(let a=0;a<o;a++){const l=e.item(a);if(l.dataset.index===void 0)continue;const d=parseInt(l.dataset.index),u=parseFloat(l.dataset.knownSize),h=t(l,n);if(h===0&&s("Zero-sized element, this should not happen",{child:l},Ti.ERROR),h===u)continue;const p=r[r.length-1];r.length===0||p.size!==h||p.endIndex!==d-1?r.push({endIndex:d,size:h,startIndex:d}):r[r.length-1].endIndex++}return r}function i3(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Ti.WARN),t==="normal"?0:parseInt(t??"0",10)}function dZ(e,t,n){const s=xe.useRef(null),o=xe.useCallback(d=>{if(!(d!=null&&d.offsetParent))return;const u=d.getBoundingClientRect(),h=u.width;let p,f;if(t){const m=t.getBoundingClientRect(),g=u.top-m.top;f=m.height-Math.max(0,g),p=g+t.scrollTop}else{const m=a.current.ownerDocument.defaultView;f=m.innerHeight-Math.max(0,u.top),p=u.top+m.scrollY}s.current={offsetTop:p,visibleHeight:f,visibleWidth:h},e(s.current)},[e,t]),{callbackRef:r,ref:a}=UI(o,!0,n),l=xe.useCallback(()=>{o(a.current)},[o,a]);return xe.useEffect(()=>{var d;if(t){t.addEventListener("scroll",l);const u=new ResizeObserver(()=>{requestAnimationFrame(l)});return u.observe(t),()=>{t.removeEventListener("scroll",l),u.unobserve(t)}}else{const u=(d=a.current)==null?void 0:d.ownerDocument.defaultView;return u==null||u.addEventListener("scroll",l),u==null||u.addEventListener("resize",l),()=>{u==null||u.removeEventListener("scroll",l),u==null||u.removeEventListener("resize",l)}}},[l,t]),r}const Ys=Ht(()=>{const e=Dt(),t=Dt(),n=Ae(0),s=Dt(),o=Ae(0),r=Dt(),a=Dt(),l=Ae(0),d=Ae(0),u=Ae(0),h=Ae(0),p=Dt(),f=Dt(),m=Ae(!1),g=Ae(!1),x=Ae(!1);return qe(Se(e,Ge(({scrollTop:b})=>b)),t),qe(Se(e,Ge(({scrollHeight:b})=>b)),a),qe(t,o),{deviation:n,fixedFooterHeight:u,fixedHeaderHeight:d,footerHeight:h,headerHeight:l,horizontalDirection:g,scrollBy:f,scrollContainerState:e,scrollHeight:a,scrollingInProgress:m,scrollTo:p,scrollTop:t,skipAnimationFrameInResizeObserver:x,smoothScrollTargetReached:s,statefulScrollTop:o,viewportHeight:r}},[],{singleton:!0}),Df={lvl:0};function uZ(e,t){const n=e.length;if(n===0)return[];let{index:s,value:o}=t(e[0]);const r=[];for(let a=1;a<n;a++){const{index:l,value:d}=t(e[a]);r.push({end:l-1,start:s,value:o}),s=l,o=d}return r.push({end:1/0,start:s,value:o}),r}function sn(e){return e===Df}function Rf(e,t){if(!sn(e))return t===e.k?e.v:t<e.k?Rf(e.l,t):Rf(e.r,t)}function Lo(e,t,n="k"){if(sn(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const s=Lo(e.r,t,n);return s[0]===-1/0?[e.k,e.v]:s}return Lo(e.l,t,n)}function Si(e,t,n){return sn(e)?fZ(t,n,1):t===e.k?Kn(e,{k:t,v:n}):t<e.k?o3(Kn(e,{l:Si(e.l,t,n)})):o3(Kn(e,{r:Si(e.r,t,n)}))}function Hd(){return Df}function Mb(e,t,n){if(sn(e))return[];const s=Lo(e,t)[0];return bPe(oS(e,s,n))}function iS(e,t){if(sn(e))return Df;const{k:n,l:s,r:o}=e;if(t===n){if(sn(s))return o;if(sn(o))return s;{const[r,a]=pZ(s);return z0(Kn(e,{k:r,l:hZ(s),v:a}))}}else return t<n?z0(Kn(e,{l:iS(s,t)})):z0(Kn(e,{r:iS(o,t)}))}function Zl(e){return sn(e)?[]:[...Zl(e.l),{k:e.k,v:e.v},...Zl(e.r)]}function oS(e,t,n){if(sn(e))return[];const{k:s,l:o,r,v:a}=e;let l=[];return s>t&&(l=l.concat(oS(o,t,n))),s>=t&&s<=n&&l.push({k:s,v:a}),s<=n&&(l=l.concat(oS(r,t,n))),l}function z0(e){const{l:t,lvl:n,r:s}=e;if(s.lvl>=n-1&&t.lvl>=n-1)return e;if(n>s.lvl+1){if(I2(t))return mZ(Kn(e,{lvl:n-1}));if(!sn(t)&&!sn(t.r))return Kn(t.r,{l:Kn(t,{r:t.r.l}),lvl:n,r:Kn(e,{l:t.r.r,lvl:n-1})});throw new Error("Unexpected empty nodes")}else{if(I2(e))return rS(Kn(e,{lvl:n-1}));if(!sn(s)&&!sn(s.l)){const o=s.l,r=I2(o)?s.lvl-1:s.lvl;return Kn(o,{l:Kn(e,{lvl:n-1,r:o.l}),lvl:o.lvl+1,r:rS(Kn(s,{l:o.r,lvl:r}))})}else throw new Error("Unexpected empty nodes")}}function Kn(e,t){return fZ(t.k!==void 0?t.k:e.k,t.v!==void 0?t.v:e.v,t.lvl!==void 0?t.lvl:e.lvl,t.l!==void 0?t.l:e.l,t.r!==void 0?t.r:e.r)}function hZ(e){return sn(e.r)?e.l:z0(Kn(e,{r:hZ(e.r)}))}function I2(e){return sn(e)||e.lvl>e.r.lvl}function pZ(e){return sn(e.r)?[e.k,e.v]:pZ(e.r)}function fZ(e,t,n,s=Df,o=Df){return{k:e,l:s,lvl:n,r:o,v:t}}function o3(e){return rS(mZ(e))}function mZ(e){const{l:t}=e;return!sn(t)&&t.lvl===e.lvl?Kn(t,{r:Kn(e,{l:t.r})}):e}function rS(e){const{lvl:t,r:n}=e;return!sn(n)&&!sn(n.r)&&n.lvl===t&&n.r.lvl===t?Kn(n,{l:Kn(e,{r:n.l}),lvl:t+1}):e}function bPe(e){return uZ(e,({k:t,v:n})=>({index:t,value:n}))}function gZ(e,t){return!!(e&&e.startIndex===t.startIndex&&e.endIndex===t.endIndex)}function Of(e,t){return!!(e&&e[0]===t[0]&&e[1]===t[1])}const qI=Ht(()=>({recalcInProgress:Ae(!1)}),[],{singleton:!0});function xZ(e,t,n){return e[bx(e,t,n)]}function bx(e,t,n,s=0){let o=e.length-1;for(;s<=o;){const r=Math.floor((s+o)/2),a=e[r],l=n(a,t);if(l===0)return r;if(l===-1){if(o-s<2)return r-1;o=r-1}else{if(o===s)return r;s=r+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function vPe(e,t,n,s){const o=bx(e,t,s),r=bx(e,n,s,o);return e.slice(o,r+1)}function sl(e,t){return Math.round(e.getBoundingClientRect()[t])}function Eb(e){return!sn(e.groupOffsetTree)}function KI({index:e},t){return t===e?0:t<e?-1:1}function CPe(){return{groupIndices:[],groupOffsetTree:Hd(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:Hd()}}function wPe(e,t){let n=sn(e)?0:1/0;for(const s of t){const{endIndex:o,size:r,startIndex:a}=s;if(n=Math.min(n,a),sn(e)){e=Si(e,0,r);continue}const l=Mb(e,a-1,o+1);if(l.some(APe(s)))continue;let d=!1,u=!1;for(const{end:h,start:p,value:f}of l)d?(o>=p||r===f)&&(e=iS(e,p)):(u=f!==r,d=!0),h>o&&o>=p&&f!==r&&(e=Si(e,o+1,f));u&&(e=Si(e,a,r))}return[e,n]}function SPe(e){return typeof e.groupIndex<"u"}function kPe({offset:e},t){return t===e?0:t<e?-1:1}function Nf(e,t,n){if(t.length===0)return 0;const{index:s,offset:o,size:r}=xZ(t,e,KI),a=e-s,l=r*a+(a-1)*n+o;return l>0?l+n:l}function yZ(e,t){if(!Eb(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function bZ(e,t,n){if(SPe(e))return t.groupIndices[e.groupIndex]+1;{const s=e.index==="LAST"?n:e.index;let o=yZ(s,t);return o=Math.max(0,o,Math.min(n,o)),o}}function jPe(e,t,n,s=0){return s>0&&(t=Math.max(t,xZ(e,s,KI).offset)),uZ(vPe(e,t,n,kPe),TPe)}function _Pe(e,[t,n,s,o]){t.length>0&&s("received item sizes",t,Ti.DEBUG);const r=e.sizeTree;let a=r,l=0;if(n.length>0&&sn(r)&&t.length===2){const f=t[0].size,m=t[1].size;a=n.reduce((g,x)=>Si(Si(g,x,f),x+1,m),a)}else[a,l]=wPe(a,t);if(a===r)return e;const{lastIndex:d,lastOffset:u,lastSize:h,offsetTree:p}=aS(e.offsetTree,l,a,o);return{groupIndices:n,groupOffsetTree:n.reduce((f,m)=>Si(f,m,Nf(m,p,o)),Hd()),lastIndex:d,lastOffset:u,lastSize:h,offsetTree:p,sizeTree:a}}function IPe(e){return Zl(e).map(({k:t,v:n},s,o)=>{const r=o[s+1];return{endIndex:r?r.k-1:1/0,size:n,startIndex:t}})}function r3(e,t){let n=0,s=0;for(;n<e;)n+=t[s+1]-t[s]-1,s++;return s-(n===e?0:1)}function aS(e,t,n,s){let o=e,r=0,a=0,l=0,d=0;if(t!==0){d=bx(o,t-1,KI),l=o[d].offset;const u=Lo(n,t-1);r=u[0],a=u[1],o.length&&o[d].size===Lo(n,t)[1]&&(d-=1),o=o.slice(0,d+1)}else o=[];for(const{start:u,value:h}of Mb(n,t,1/0)){const p=u-r,f=p*a+l+p*s;o.push({index:u,offset:f,size:h}),r=u,l=f,a=h}return{lastIndex:r,lastOffset:l,lastSize:a,offsetTree:o}}function TPe(e){return{index:e.index,value:e}}function APe(e){const{endIndex:t,size:n,startIndex:s}=e;return o=>o.start===s&&(o.end===t||o.end===1/0)&&o.value===n}const MPe={offsetHeight:"height",offsetWidth:"width"},Ar=Ht(([{log:e},{recalcInProgress:t}])=>{const n=Dt(),s=Dt(),o=Rs(s,0),r=Dt(),a=Dt(),l=Ae(0),d=Ae([]),u=Ae(void 0),h=Ae(void 0),p=Ae((k,S)=>sl(k,MPe[S])),f=Ae(void 0),m=Ae(0),g=CPe(),x=Rs(Se(n,kt(d,e,m),sr(_Pe,g),hn()),g),b=Rs(Se(d,hn(),sr((k,S)=>({current:S,prev:k.current}),{current:[],prev:[]}),Ge(({prev:k})=>k)),[]);qe(Se(d,ct(k=>k.length>0),kt(x,m),Ge(([k,S,P])=>{const E=k.reduce((L,I,O)=>Si(L,I,Nf(I,S.offsetTree,P)||O),Hd());return{...S,groupIndices:k,groupOffsetTree:E}})),x),qe(Se(s,kt(x),ct(([k,{lastIndex:S}])=>k<S),Ge(([k,{lastIndex:S,lastSize:P}])=>[{endIndex:S,size:P,startIndex:k}])),n),qe(u,h);const C=Rs(Se(u,Ge(k=>k===void 0)),!0);qe(Se(h,ct(k=>k!==void 0&&sn(Ds(x).sizeTree)),Ge(k=>[{endIndex:0,size:k,startIndex:0}])),n);const y=Ii(Se(n,kt(x),sr(({sizes:k},[S,P])=>({changed:P!==k,sizes:P}),{changed:!1,sizes:g}),Ge(k=>k.changed)));Kt(Se(l,sr((k,S)=>({diff:k.prev-S,prev:S}),{diff:0,prev:0}),Ge(k=>k.diff)),k=>{const{groupIndices:S}=Ds(x);if(k>0)wt(t,!0),wt(r,k+r3(k,S));else if(k<0){const P=Ds(b);P.length>0&&(k-=r3(-k,P)),wt(a,k)}}),Kt(Se(l,kt(e)),([k,S])=>{k<0&&S("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:l},Ti.ERROR)});const v=Ii(r);qe(Se(r,kt(x),Ge(([k,S])=>{const P=S.groupIndices.length>0,E=[],L=S.lastSize;if(P){const I=Rf(S.sizeTree,0);let O=0,N=0;for(;O<k;){const R=S.groupIndices[N],D=S.groupIndices.length===N+1?1/0:S.groupIndices[N+1]-R-1;E.push({endIndex:R,size:I,startIndex:R}),E.push({endIndex:R+1+D-1,size:L,startIndex:R+1}),N++,O+=D+1}const _=Zl(S.sizeTree);return O!==k&&_.shift(),_.reduce((R,{k:D,v:B})=>{let V=R.ranges;return R.prevSize!==0&&(V=[...R.ranges,{endIndex:D+k-1,size:R.prevSize,startIndex:R.prevIndex}]),{prevIndex:D+k,prevSize:B,ranges:V}},{prevIndex:k,prevSize:0,ranges:E}).ranges}return Zl(S.sizeTree).reduce((I,{k:O,v:N})=>({prevIndex:O+k,prevSize:N,ranges:[...I.ranges,{endIndex:O+k-1,size:I.prevSize,startIndex:I.prevIndex}]}),{prevIndex:0,prevSize:L,ranges:[]}).ranges})),n);const w=Ii(Se(a,kt(x,m),Ge(([k,{offsetTree:S},P])=>{const E=-k;return Nf(E,S,P)})));return qe(Se(a,kt(x,m),Ge(([k,S,P])=>{if(S.groupIndices.length>0){if(sn(S.sizeTree))return S;let E=Hd();const L=Ds(b);let I=0,O=0,N=0;for(;I<-k;){N=L[O];const _=L[O+1]-N-1;O++,I+=_+1}if(E=Zl(S.sizeTree).reduce((_,{k:R,v:D})=>Si(_,Math.max(0,R+k),D),E),I!==-k){const _=Rf(S.sizeTree,N);E=Si(E,0,_);const R=Lo(S.sizeTree,-k+1)[1];E=Si(E,1,R)}return{...S,sizeTree:E,...aS(S.offsetTree,0,E,P)}}else{const E=Zl(S.sizeTree).reduce((L,{k:I,v:O})=>Si(L,Math.max(0,I+k),O),Hd());return{...S,sizeTree:E,...aS(S.offsetTree,0,E,P)}}})),x),{beforeUnshiftWith:v,data:f,defaultItemSize:h,firstItemIndex:l,fixedItemSize:u,gap:m,groupIndices:d,itemSize:p,listRefresh:y,shiftWith:a,shiftWithOffset:w,sizeRanges:n,sizes:x,statefulTotalCount:o,totalCount:s,trackItemSizes:C,unshiftWith:r}},mn(wl,qI),{singleton:!0});function EPe(e){return e.reduce((t,n)=>(t.groupIndices.push(t.totalCount),t.totalCount+=n+1,t),{groupIndices:[],totalCount:0})}const vZ=Ht(([{groupIndices:e,sizes:t,totalCount:n},{headerHeight:s,scrollTop:o}])=>{const r=Dt(),a=Dt(),l=Ii(Se(r,Ge(EPe)));return qe(Se(l,Ge(d=>d.totalCount)),n),qe(Se(l,Ge(d=>d.groupIndices)),e),qe(Se(Yn(o,t,s),ct(([d,u])=>Eb(u)),Ge(([d,u,h])=>Lo(u.groupOffsetTree,Math.max(d-h,0),"v")[0]),hn(),Ge(d=>[d])),a),{groupCounts:r,topItemsIndexes:a}},mn(Ar,Ys)),Sl=Ht(([{log:e}])=>{const t=Ae(!1),n=Ii(Se(t,ct(s=>s),hn()));return Kt(t,s=>{s&&Ds(e)("props updated",{},Ti.DEBUG)}),{didMount:n,propsReady:t}},mn(wl),{singleton:!0}),PPe=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function CZ(e){const t=typeof e=="number"?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!PPe)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const ug=Ht(([{gap:e,listRefresh:t,sizes:n,totalCount:s},{fixedFooterHeight:o,fixedHeaderHeight:r,footerHeight:a,headerHeight:l,scrollingInProgress:d,scrollTo:u,smoothScrollTargetReached:h,viewportHeight:p},{log:f}])=>{const m=Dt(),g=Dt(),x=Ae(0);let b=null,C=null,y=null;function v(){b&&(b(),b=null),y&&(y(),y=null),C&&(clearTimeout(C),C=null),wt(d,!1)}return qe(Se(m,kt(n,p,s,x,l,a,f),kt(e,r,o),Ge(([[w,k,S,P,E,L,I,O],N,_,R])=>{const D=CZ(w),{align:B,behavior:V,offset:ee}=D,se=P-1,oe=bZ(D,k,se);let te=Nf(oe,k.offsetTree,N)+L;B==="end"?(te+=_+Lo(k.sizeTree,oe)[1]-S+R,oe===se&&(te+=I)):B==="center"?te+=(_+Lo(k.sizeTree,oe)[1]-S+R)/2:te-=E,ee&&(te+=ee);const H=z=>{v(),z?(O("retrying to scroll to",{location:w},Ti.DEBUG),wt(m,w)):(wt(g,!0),O("list did not change, scroll successful",{},Ti.DEBUG))};if(v(),V==="smooth"){let z=!1;y=Kt(t,Z=>{z=z||Z}),b=vr(h,()=>{H(z)})}else b=vr(Se(t,LPe(150)),H);return C=setTimeout(()=>{v()},1200),wt(d,!0),O("scrolling from index to",{behavior:V,index:oe,top:te},Ti.DEBUG),{behavior:V,top:te}})),u),{scrollTargetReached:g,scrollToIndex:m,topListHeight:x}},mn(Ar,Ys,wl),{singleton:!0});function LPe(e){return t=>{const n=setTimeout(()=>{t(!1)},e);return s=>{s&&(t(!0),clearTimeout(n))}}}function ZI(e,t){e==0?t():requestAnimationFrame(()=>{ZI(e-1,t)})}function YI(e,t){const n=t-1;return typeof e=="number"?e:e.index==="LAST"?n:e.index}const hg=Ht(([{defaultItemSize:e,listRefresh:t,sizes:n},{scrollTop:s},{scrollTargetReached:o,scrollToIndex:r},{didMount:a}])=>{const l=Ae(!0),d=Ae(0),u=Ae(!0);return qe(Se(a,kt(d),ct(([h,p])=>!!p),Yo(!1)),l),qe(Se(a,kt(d),ct(([h,p])=>!!p),Yo(!1)),u),Kt(Se(Yn(t,a),kt(l,n,e,u),ct(([[,h],p,{sizeTree:f},m,g])=>h&&(!sn(f)||HI(m))&&!p&&!g),kt(d)),([,h])=>{vr(o,()=>{wt(u,!0)}),ZI(4,()=>{vr(s,()=>{wt(l,!0)}),wt(r,h)})}),{initialItemFinalLocationReached:u,initialTopMostItemIndex:d,scrolledToInitialItem:l}},mn(Ar,Ys,ug,Sl),{singleton:!0});function wZ(e,t){return Math.abs(e-t)<1.01}const Ff="up",ef="down",DPe="none",RPe={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},OPe=0,pg=Ht(([{footerHeight:e,headerHeight:t,scrollBy:n,scrollContainerState:s,scrollTop:o,viewportHeight:r}])=>{const a=Ae(!1),l=Ae(!0),d=Dt(),u=Dt(),h=Ae(4),p=Ae(OPe),f=Rs(Se(s3(Se(dt(o),uu(1),Yo(!0)),Se(dt(o),uu(1),Yo(!1),n3(100))),hn()),!1),m=Rs(Se(s3(Se(n,Yo(!0)),Se(n,Yo(!1),n3(200))),hn()),!1);qe(Se(Yn(dt(o),dt(p)),Ge(([y,v])=>y<=v),hn()),l),qe(Se(l,Ga(50)),u);const g=Ii(Se(Yn(s,dt(r),dt(t),dt(e),dt(h)),sr((y,[{scrollHeight:v,scrollTop:w},k,S,P,E])=>{const L=w+k-v>-E,I={scrollHeight:v,scrollTop:w,viewportHeight:k};if(L){let N,_;return w>y.state.scrollTop?(N="SCROLLED_DOWN",_=y.state.scrollTop-w):(N="SIZE_DECREASED",_=y.state.scrollTop-w||y.scrollTopDelta),{atBottom:!0,atBottomBecause:N,scrollTopDelta:_,state:I}}let O;return I.scrollHeight>y.state.scrollHeight?O="SIZE_INCREASED":k<y.state.viewportHeight?O="VIEWPORT_HEIGHT_DECREASING":w<y.state.scrollTop?O="SCROLLING_UPWARDS":O="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:O,state:I}},RPe),hn((y,v)=>y&&y.atBottom===v.atBottom))),x=Rs(Se(s,sr((y,{scrollHeight:v,scrollTop:w,viewportHeight:k})=>{if(wZ(y.scrollHeight,v))return{changed:!1,jump:0,scrollHeight:v,scrollTop:w};{const S=v-(w+k)<1;return y.scrollTop!==w&&S?{changed:!0,jump:y.scrollTop-w,scrollHeight:v,scrollTop:w}:{changed:!0,jump:0,scrollHeight:v,scrollTop:w}}},{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),ct(y=>y.changed),Ge(y=>y.jump)),0);qe(Se(g,Ge(y=>y.atBottom)),a),qe(Se(a,Ga(50)),d);const b=Ae(ef);qe(Se(s,Ge(({scrollTop:y})=>y),hn(),sr((y,v)=>Ds(m)?{direction:y.direction,prevScrollTop:v}:{direction:v<y.prevScrollTop?Ff:ef,prevScrollTop:v},{direction:ef,prevScrollTop:0}),Ge(y=>y.direction)),b),qe(Se(s,Ga(50),Yo(DPe)),b);const C=Ae(0);return qe(Se(f,ct(y=>!y),Yo(0)),C),qe(Se(o,Ga(100),kt(f),ct(([y,v])=>!!v),sr(([y,v],[w])=>[v,w],[0,0]),Ge(([y,v])=>v-y)),C),{atBottomState:g,atBottomStateChange:d,atBottomThreshold:h,atTopStateChange:u,atTopThreshold:p,isAtBottom:a,isAtTop:l,isScrolling:f,lastJumpDueToItemResize:x,scrollDirection:b,scrollVelocity:C}},mn(Ys)),vx="top",Cx="bottom",a3="none";function l3(e,t,n){return typeof e=="number"?n===Ff&&t===vx||n===ef&&t===Cx?e:0:n===Ff?t===vx?e.main:e.reverse:t===Cx?e.main:e.reverse}function c3(e,t){var n;return typeof e=="number"?e:(n=e[t])!=null?n:0}const XI=Ht(([{deviation:e,fixedHeaderHeight:t,headerHeight:n,scrollTop:s,viewportHeight:o}])=>{const r=Dt(),a=Ae(0),l=Ae(0),d=Ae(0),u=Rs(Se(Yn(dt(s),dt(o),dt(n),dt(r,Of),dt(d),dt(a),dt(t),dt(e),dt(l)),Ge(([h,p,f,[m,g],x,b,C,y,v])=>{const w=h-y,k=b+C,S=Math.max(f-w,0);let P=a3;const E=c3(v,vx),L=c3(v,Cx);return m-=y,m+=f+C,g+=f+C,g-=y,m>h+k-E&&(P=Ff),g<h-S+p+L&&(P=ef),P!==a3?[Math.max(w-f-l3(x,vx,P)-E,0),w-S-C+p+l3(x,Cx,P)+L]:null}),ct(h=>h!=null),hn(Of)),[0,0]);return{increaseViewportBy:l,listBoundary:r,overscan:d,topListHeight:a,visibleRange:u}},mn(Ys),{singleton:!0});function NPe(e,t,n){if(Eb(t)){const s=yZ(e,t);return[{index:Lo(t.groupOffsetTree,s)[0],offset:0,size:0},{data:n==null?void 0:n[0],index:s,offset:0,size:0}]}return[{data:n==null?void 0:n[0],index:e,offset:0,size:0}]}const T2={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function G0(e,t,n,s,o,r){const{lastIndex:a,lastOffset:l,lastSize:d}=o;let u=0,h=0;if(e.length>0){u=e[0].offset;const x=e[e.length-1];h=x.offset+x.size}const p=n-a,f=l+p*d+(p-1)*s,m=u,g=f-h;return{bottom:h,firstItemIndex:r,items:d3(e,o,r),offsetBottom:g,offsetTop:u,top:m,topItems:d3(t,o,r),topListHeight:t.reduce((x,b)=>b.size+x,0),totalCount:n}}function SZ(e,t,n,s,o,r){let a=0;if(n.groupIndices.length>0)for(const h of n.groupIndices){if(h-a>=e)break;a++}const l=e+a,d=YI(t,l),u=Array.from({length:l}).map((h,p)=>({data:r[p+d],index:p+d,offset:0,size:0}));return G0(u,[],l,o,n,s)}function d3(e,t,n){if(e.length===0)return[];if(!Eb(t))return e.map(u=>({...u,index:u.index+n,originalIndex:u.index}));const s=e[0].index,o=e[e.length-1].index,r=[],a=Mb(t.groupOffsetTree,s,o);let l,d=0;for(const u of e){(!l||l.end<u.index)&&(l=a.shift(),d=t.groupIndices.indexOf(l.start));let h;u.index===l.start?h={index:d,type:"group"}:h={groupIndex:d,index:u.index-(d+1)+n},r.push({...h,data:u.data,offset:u.offset,originalIndex:u.index,size:u.size})}return r}const zc=Ht(([{data:e,firstItemIndex:t,gap:n,sizes:s,totalCount:o},r,{listBoundary:a,topListHeight:l,visibleRange:d},{initialTopMostItemIndex:u,scrolledToInitialItem:h},{topListHeight:p},f,{didMount:m},{recalcInProgress:g}])=>{const x=Ae([]),b=Ae(0),C=Dt();qe(r.topItemsIndexes,x);const y=Rs(Se(Yn(m,g,dt(d,Of),dt(o),dt(s),dt(u),h,dt(x),dt(t),dt(n),e),ct(([S,P,,E,,,,,,,L])=>{const I=L&&L.length!==E;return S&&!P&&!I}),Ge(([,,[S,P],E,L,I,O,N,_,R,D])=>{const B=L,{offsetTree:V,sizeTree:ee}=B,se=Ds(b);if(E===0)return{...T2,totalCount:E};if(S===0&&P===0)return se===0?{...T2,totalCount:E}:SZ(se,I,L,_,R,D||[]);if(sn(ee))return se>0?null:G0(NPe(YI(I,E),B,D),[],E,R,B,_);const oe=[];if(N.length>0){const U=N[0],Y=N[N.length-1];let $=0;for(const F of Mb(ee,U,Y)){const q=F.value,ie=Math.max(F.start,U),ce=Math.min(F.end,Y);for(let me=ie;me<=ce;me++)oe.push({data:D==null?void 0:D[me],index:me,offset:$,size:q}),$+=q}}if(!O)return G0([],oe,E,R,B,_);const te=N.length>0?N[N.length-1]+1:0,H=jPe(V,S,P,te);if(H.length===0)return null;const z=E-1,Z=Ab([],U=>{for(const Y of H){const $=Y.value;let F=$.offset,q=Y.start;const ie=$.size;if($.offset<S){q+=Math.floor((S-$.offset+R)/(ie+R));const me=q-Y.start;F+=me*ie+me*R}q<te&&(F+=(te-q)*ie,q=te);const ce=Math.min(Y.end,z);for(let me=q;me<=ce&&!(F>=P);me++)U.push({data:D==null?void 0:D[me],index:me,offset:F,size:ie}),F+=ie+R}});return G0(Z,oe,E,R,B,_)}),ct(S=>S!==null),hn()),T2);qe(Se(e,ct(HI),Ge(S=>S==null?void 0:S.length)),o),qe(Se(y,Ge(S=>S.topListHeight)),p),qe(p,l),qe(Se(y,Ge(S=>[S.top,S.bottom])),a),qe(Se(y,Ge(S=>S.items)),C);const v=Ii(Se(y,ct(({items:S})=>S.length>0),kt(o,e),ct(([{items:S},P])=>S[S.length-1].originalIndex===P-1),Ge(([,S,P])=>[S-1,P]),hn(Of),Ge(([S])=>S))),w=Ii(Se(y,Ga(200),ct(({items:S,topItems:P})=>S.length>0&&S[0].originalIndex===P.length),Ge(({items:S})=>S[0].index),hn())),k=Ii(Se(y,ct(({items:S})=>S.length>0),Ge(({items:S})=>{let P=0,E=S.length-1;for(;S[P].type==="group"&&P<E;)P++;for(;S[E].type==="group"&&E>P;)E--;return{endIndex:S[E].index,startIndex:S[P].index}}),hn(gZ)));return{endReached:v,initialItemCount:b,itemsRendered:C,listState:y,rangeChanged:k,startReached:w,topItemsIndexes:x,...f}},mn(Ar,vZ,XI,hg,ug,pg,Sl,qI),{singleton:!0}),kZ=Ht(([{fixedFooterHeight:e,fixedHeaderHeight:t,footerHeight:n,headerHeight:s},{listState:o}])=>{const r=Dt(),a=Rs(Se(Yn(n,e,s,t,o),Ge(([l,d,u,h,p])=>l+d+u+h+p.offsetBottom+p.bottom)),0);return qe(dt(a),r),{totalListHeight:a,totalListHeightChanged:r}},mn(Ys,zc),{singleton:!0}),FPe=Ht(([{viewportHeight:e},{totalListHeight:t}])=>{const n=Ae(!1),s=Rs(Se(Yn(n,e,t),ct(([o])=>o),Ge(([,o,r])=>Math.max(0,o-r)),Ga(0),hn()),0);return{alignToBottom:n,paddingTopAddition:s}},mn(Ys,kZ),{singleton:!0});function u3(e){return e?e==="smooth"?"smooth":"auto":!1}const BPe=(e,t)=>typeof e=="function"?u3(e(t)):t&&u3(e),$Pe=Ht(([{listRefresh:e,totalCount:t},{atBottomState:n,isAtBottom:s},{scrollToIndex:o},{scrolledToInitialItem:r},{didMount:a,propsReady:l},{log:d},{scrollingInProgress:u}])=>{const h=Ae(!1),p=Dt();let f=null;function m(x){wt(o,{align:"end",behavior:x,index:"LAST"})}Kt(Se(Yn(Se(dt(t),uu(1)),a),kt(dt(h),s,r,u),Ge(([[x,b],C,y,v,w])=>{let k=b&&v,S="auto";return k&&(S=BPe(C,y||w),k=k&&!!S),{followOutputBehavior:S,shouldFollow:k,totalCount:x}}),ct(({shouldFollow:x})=>x)),({followOutputBehavior:x,totalCount:b})=>{f&&(f(),f=null),f=vr(e,()=>{Ds(d)("following output to ",{totalCount:b},Ti.DEBUG),m(x),f=null})});function g(x){const b=vr(n,C=>{x&&!C.atBottom&&C.notAtBottomBecause==="SIZE_INCREASED"&&!f&&(Ds(d)("scrolling to bottom due to increased size",{},Ti.DEBUG),m("auto"))});setTimeout(b,100)}return Kt(Se(Yn(dt(h),t,l),ct(([x,,b])=>x&&b),sr(({value:x},[,b])=>({refreshed:x===b,value:b}),{refreshed:!1,value:0}),ct(({refreshed:x})=>x),kt(h,t)),([,x])=>{Ds(r)&&g(x!==!1)}),Kt(p,()=>{g(Ds(h)!==!1)}),Kt(Yn(dt(h),n),([x,b])=>{x&&!b.atBottom&&b.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&m("auto")}),{autoscrollToBottom:p,followOutput:h}},mn(Ar,pg,ug,hg,Sl,wl,Ys)),VPe=Ht(([{data:e,firstItemIndex:t,gap:n,sizes:s},{initialTopMostItemIndex:o},{initialItemCount:r,listState:a},{didMount:l}])=>(qe(Se(l,kt(r),ct(([,d])=>d!==0),kt(o,s,t,n,e),Ge(([[,d],u,h,p,f,m=[]])=>SZ(d,u,h,p,f,m))),a),{}),mn(Ar,hg,zc,Sl),{singleton:!0}),zPe=Ht(([{didMount:e},{scrollTo:t},{listState:n}])=>{const s=Ae(0);return Kt(Se(e,kt(s),ct(([,o])=>o!==0),Ge(([,o])=>({top:o}))),o=>{vr(Se(n,uu(1),ct(r=>r.items.length>1)),()=>{requestAnimationFrame(()=>{wt(t,o)})})}),{initialScrollTop:s}},mn(Sl,Ys,zc),{singleton:!0}),GPe=({itemBottom:e,itemTop:t,locationParams:{align:n,behavior:s,...o},viewportBottom:r,viewportTop:a})=>t<a?{...o,align:n??"start",behavior:s}:e>r?{...o,align:n??"end",behavior:s}:null,HPe=Ht(([{gap:e,sizes:t,totalCount:n},{fixedFooterHeight:s,fixedHeaderHeight:o,headerHeight:r,scrollingInProgress:a,scrollTop:l,viewportHeight:d},{scrollToIndex:u}])=>{const h=Dt();return qe(Se(h,kt(t,d,n,r,o,s,l),kt(e),Ge(([[p,f,m,g,x,b,C,y],v])=>{const{align:w,behavior:k,calculateViewLocation:S=GPe,done:P,...E}=p,L=bZ(p,f,g-1),I=Nf(L,f.offsetTree,v)+x+b,O=I+Lo(f.sizeTree,L)[1],N=y+b,_=y+m-C,R=S({itemBottom:O,itemTop:I,locationParams:{align:w,behavior:k,...E},viewportBottom:_,viewportTop:N});return R?P&&vr(Se(a,ct(D=>!D),uu(Ds(a)?1:2)),P):P&&P(),R}),ct(p=>p!==null)),u),{scrollIntoView:h}},mn(Ar,Ys,ug,zc,wl),{singleton:!0}),jZ=Ht(([{scrollVelocity:e}])=>{const t=Ae(!1),n=Dt(),s=Ae(!1);return qe(Se(e,kt(s,t,n),ct(([o,r])=>!!r),Ge(([o,r,a,l])=>{const{enter:d,exit:u}=r;if(a){if(u(o,l))return!1}else if(d(o,l))return!0;return a}),hn()),t),Kt(Se(Yn(t,e,n),kt(s)),([[o,r,a],l])=>{o&&l&&l.change&&l.change(r,a)}),{isSeeking:t,scrollSeekConfiguration:s,scrollSeekRangeChanged:n,scrollVelocity:e}},mn(pg),{singleton:!0}),QI=Ht(([{scrollContainerState:e,scrollTo:t}])=>{const n=Dt(),s=Dt(),o=Dt(),r=Ae(!1),a=Ae(void 0);return qe(Se(Yn(n,s),Ge(([{scrollHeight:l,scrollTop:d,viewportHeight:u},{offsetTop:h}])=>({scrollHeight:l,scrollTop:Math.max(0,d-h),viewportHeight:u}))),e),qe(Se(t,kt(s),Ge(([l,{offsetTop:d}])=>({...l,top:l.top+d}))),o),{customScrollParent:a,useWindowScroll:r,windowScrollContainerState:n,windowScrollTo:o,windowViewportRect:s}},mn(Ys)),WPe=Ht(([{sizeRanges:e,sizes:t},{headerHeight:n,scrollTop:s},{initialTopMostItemIndex:o},{didMount:r},{useWindowScroll:a,windowScrollContainerState:l,windowViewportRect:d}])=>{const u=Dt(),h=Ae(void 0),p=Ae(null),f=Ae(null);return qe(l,p),qe(d,f),Kt(Se(u,kt(t,s,a,p,f,n)),([m,g,x,b,C,y,v])=>{const w=IPe(g.sizeTree);b&&C!==null&&y!==null&&(x=C.scrollTop-y.offsetTop),x-=v,m({ranges:w,scrollTop:x})}),qe(Se(h,ct(HI),Ge(UPe)),o),qe(Se(r,kt(h),ct(([,m])=>m!==void 0),hn(),Ge(([,m])=>m.ranges)),e),{getState:u,restoreStateFrom:h}},mn(Ar,Ys,hg,Sl,QI));function UPe(e){return{align:"start",index:0,offset:e.scrollTop}}const qPe=Ht(([{topItemsIndexes:e}])=>{const t=Ae(0);return qe(Se(t,ct(n=>n>=0),Ge(n=>Array.from({length:n}).map((s,o)=>o))),e),{topItemCount:t}},mn(zc));function _Z(e){let t=!1,n;return()=>(t||(t=!0,n=e()),n)}const KPe=_Z(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),ZPe=Ht(([{deviation:e,scrollBy:t,scrollingInProgress:n,scrollTop:s},{isAtBottom:o,isScrolling:r,lastJumpDueToItemResize:a,scrollDirection:l},{listState:d},{beforeUnshiftWith:u,gap:h,shiftWithOffset:p,sizes:f},{log:m},{recalcInProgress:g}])=>{const x=Ii(Se(d,kt(a),sr(([,C,y,v],[{bottom:w,items:k,offsetBottom:S,totalCount:P},E])=>{const L=w+S;let I=0;return y===P&&C.length>0&&k.length>0&&(k[0].originalIndex===0&&C[0].originalIndex===0||(I=L-v,I!==0&&(I+=E))),[I,k,P,L]},[0,[],0,0]),ct(([C])=>C!==0),kt(s,l,n,o,m,g),ct(([,C,y,v,,,w])=>!w&&!v&&C!==0&&y===Ff),Ge(([[C],,,,,y])=>(y("Upward scrolling compensation",{amount:C},Ti.DEBUG),C))));function b(C){C>0?(wt(t,{behavior:"auto",top:-C}),wt(e,0)):(wt(e,0),wt(t,{behavior:"auto",top:-C}))}return Kt(Se(x,kt(e,r)),([C,y,v])=>{v&&KPe()?wt(e,y-C):b(-C)}),Kt(Se(Yn(Rs(r,!1),e,g),ct(([C,y,v])=>!C&&!v&&y!==0),Ge(([C,y])=>y),Ga(1)),b),qe(Se(p,Ge(C=>({top:-C}))),t),Kt(Se(u,kt(f,h),Ge(([C,{groupIndices:y,lastSize:v,sizeTree:w},k])=>{function S(P){return P*(v+k)}if(y.length===0)return S(C);{let P=0;const E=Rf(w,0);let L=0,I=0;for(;L<C;){L++,P+=E;let O=y.length===I+1?1/0:y[I+1]-y[I]-1;L+O>C&&(P-=E,O=C-L+1),L+=O,P+=S(O),I++}return P}})),C=>{wt(e,C),requestAnimationFrame(()=>{wt(t,{top:C}),requestAnimationFrame(()=>{wt(e,0),wt(g,!1)})})}),{deviation:e}},mn(Ys,pg,zc,Ar,wl,qI)),YPe=Ht(([e,t,n,s,o,r,a,l,d,u])=>({...e,...t,...n,...s,...o,...r,...a,...l,...d,...u}),mn(XI,VPe,Sl,jZ,kZ,zPe,FPe,QI,HPe,wl)),IZ=Ht(([{data:e,defaultItemSize:t,firstItemIndex:n,fixedItemSize:s,gap:o,groupIndices:r,itemSize:a,sizeRanges:l,sizes:d,statefulTotalCount:u,totalCount:h,trackItemSizes:p},{initialItemFinalLocationReached:f,initialTopMostItemIndex:m,scrolledToInitialItem:g},x,b,C,{listState:y,topItemsIndexes:v,...w},{scrollToIndex:k},S,{topItemCount:P},{groupCounts:E},L])=>(qe(w.rangeChanged,L.scrollSeekRangeChanged),qe(Se(L.windowViewportRect,Ge(I=>I.visibleHeight)),x.viewportHeight),{data:e,defaultItemHeight:t,firstItemIndex:n,fixedItemHeight:s,gap:o,groupCounts:E,initialItemFinalLocationReached:f,initialTopMostItemIndex:m,scrolledToInitialItem:g,sizeRanges:l,topItemCount:P,topItemsIndexes:v,totalCount:h,...C,groupIndices:r,itemSize:a,listState:y,scrollToIndex:k,statefulTotalCount:u,trackItemSizes:p,...w,...L,...x,sizes:d,...b}),mn(Ar,hg,Ys,WPe,$Pe,zc,ug,ZPe,qPe,vZ,YPe));function XPe(e,t){const n={},s={};let o=0;const r=e.length;for(;o<r;)s[e[o]]=1,o+=1;for(const a in t)Object.hasOwn(s,a)||(n[a]=t[a]);return n}const d0=typeof document<"u"?xe.useLayoutEffect:xe.useEffect;function TZ(e,t,n){const s=Object.keys(t.required||{}),o=Object.keys(t.optional||{}),r=Object.keys(t.methods||{}),a=Object.keys(t.events||{}),l=xe.createContext({});function d(b,C){b.propsReady&&wt(b.propsReady,!1);for(const y of s){const v=b[t.required[y]];wt(v,C[y])}for(const y of o)if(y in C){const v=b[t.optional[y]];wt(v,C[y])}b.propsReady&&wt(b.propsReady,!0)}function u(b){return r.reduce((C,y)=>(C[y]=v=>{const w=b[t.methods[y]];wt(w,v)},C),{})}function h(b){return a.reduce((C,y)=>(C[y]=hPe(b[t.events[y]]),C),{})}const p=xe.forwardRef((b,C)=>{const{children:y,...v}=b,[w]=xe.useState(()=>Ab(fPe(e),P=>{d(P,v)})),[k]=xe.useState(t3(h,w));d0(()=>{for(const P of a)P in v&&Kt(k[P],v[P]);return()=>{Object.values(k).map(WI)}},[v,k,w]),d0(()=>{d(w,v)}),xe.useImperativeHandle(C,e3(u(w)));const S=n;return i.jsx(l.Provider,{value:w,children:n?i.jsx(S,{...XPe([...s,...o,...a],v),children:y}):y})}),f=b=>xe.useCallback(lZ(wt,xe.useContext(l)[b]),[b]),m=b=>{const C=xe.useContext(l)[b],y=xe.useCallback(v=>Kt(C,v),[C]);return xe.useSyncExternalStore(y,()=>Ds(C),()=>Ds(C))},g=b=>{const C=xe.useContext(l)[b],[y,v]=xe.useState(t3(Ds,C));return d0(()=>Kt(C,w=>{w!==y&&v(e3(w))}),[C,y]),y},x=xe.version.startsWith("18")?m:g;return{Component:p,useEmitter:(b,C)=>{const y=xe.useContext(l)[b];d0(()=>Kt(y,C),[C,y])},useEmitterValue:x,usePublisher:f}}const AZ=xe.createContext(void 0),MZ=xe.createContext(void 0),EZ=typeof document<"u"?xe.useLayoutEffect:xe.useEffect;function A2(e){return"self"in e}function QPe(e){return"body"in e}function PZ(e,t,n,s=lh,o,r){const a=xe.useRef(null),l=xe.useRef(null),d=xe.useRef(null),u=xe.useCallback(f=>{let m,g,x;const b=f.target;if(QPe(b)||A2(b)){const y=A2(b)?b:b.defaultView;x=r?y.scrollX:y.scrollY,m=r?y.document.documentElement.scrollWidth:y.document.documentElement.scrollHeight,g=r?y.innerWidth:y.innerHeight}else x=r?b.scrollLeft:b.scrollTop,m=r?b.scrollWidth:b.scrollHeight,g=r?b.offsetWidth:b.offsetHeight;const C=()=>{e({scrollHeight:m,scrollTop:Math.max(x,0),viewportHeight:g})};f.suppressFlushSync?C():xD.flushSync(C),l.current!==null&&(x===l.current||x<=0||x===m-g)&&(l.current=null,t(!0),d.current&&(clearTimeout(d.current),d.current=null))},[e,t]);xe.useEffect(()=>{const f=o||a.current;return s(o||a.current),u({suppressFlushSync:!0,target:f}),f.addEventListener("scroll",u,{passive:!0}),()=>{s(null),f.removeEventListener("scroll",u)}},[a,u,n,s,o]);function h(f){const m=a.current;if(!m||(r?"offsetWidth"in m&&m.offsetWidth===0:"offsetHeight"in m&&m.offsetHeight===0))return;const g=f.behavior==="smooth";let x,b,C;A2(m)?(b=Math.max(sl(m.document.documentElement,r?"width":"height"),r?m.document.documentElement.scrollWidth:m.document.documentElement.scrollHeight),x=r?m.innerWidth:m.innerHeight,C=r?window.scrollX:window.scrollY):(b=m[r?"scrollWidth":"scrollHeight"],x=sl(m,r?"width":"height"),C=m[r?"scrollLeft":"scrollTop"]);const y=b-x;if(f.top=Math.ceil(Math.max(Math.min(y,f.top),0)),wZ(x,b)||f.top===C){e({scrollHeight:b,scrollTop:C,viewportHeight:x}),g&&t(!0);return}g?(l.current=f.top,d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{d.current=null,l.current=null,t(!0)},1e3)):l.current=null,r&&(f={behavior:f.behavior,left:f.top}),m.scrollTo(f)}function p(f){r&&(f={behavior:f.behavior,left:f.top}),a.current.scrollBy(f)}return{scrollByCallback:p,scrollerRef:a,scrollToCallback:h}}const M2="-webkit-sticky",h3="sticky",LZ=_Z(()=>{if(typeof document>"u")return h3;const e=document.createElement("div");return e.style.position=M2,e.style.position===M2?M2:h3});function JI(e){return e}const JPe=Ht(()=>{const e=Ae(d=>`Item ${d}`),t=Ae(null),n=Ae(d=>`Group ${d}`),s=Ae({}),o=Ae(JI),r=Ae("div"),a=Ae(lh),l=(d,u=null)=>Rs(Se(s,Ge(h=>h[d]),hn()),u);return{components:s,computeItemKey:o,context:t,EmptyPlaceholder:l("EmptyPlaceholder"),FooterComponent:l("Footer"),GroupComponent:l("Group","div"),groupContent:n,HeaderComponent:l("Header"),HeaderFooterTag:r,ItemComponent:l("Item","div"),itemContent:e,ListComponent:l("List","div"),ScrollerComponent:l("Scroller","div"),scrollerRef:a,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),TopItemListComponent:l("TopItemList")}}),eLe=Ht(([e,t])=>({...e,...t}),mn(IZ,JPe)),tLe=({height:e})=>i.jsx("div",{style:{height:e}}),nLe={overflowAnchor:"none",position:LZ(),zIndex:1},DZ={overflowAnchor:"none"},sLe={...DZ,display:"inline-block",height:"100%"},p3=xe.memo(function({showTopList:e=!1}){const t=mt("listState"),n=so("sizeRanges"),s=mt("useWindowScroll"),o=mt("customScrollParent"),r=so("windowScrollContainerState"),a=so("scrollContainerState"),l=o||s?r:a,d=mt("itemContent"),u=mt("context"),h=mt("groupContent"),p=mt("trackItemSizes"),f=mt("itemSize"),m=mt("log"),g=so("gap"),x=mt("horizontalDirection"),{callbackRef:b}=xPe(n,f,p,e?lh:l,m,g,o,x,mt("skipAnimationFrameInResizeObserver")),[C,y]=xe.useState(0);e4("deviation",R=>{C!==R&&y(R)});const v=mt("EmptyPlaceholder"),w=mt("ScrollSeekPlaceholder")||tLe,k=mt("ListComponent"),S=mt("ItemComponent"),P=mt("GroupComponent"),E=mt("computeItemKey"),L=mt("isSeeking"),I=mt("groupIndices").length>0,O=mt("alignToBottom"),N=mt("initialItemFinalLocationReached"),_=e?{}:{boxSizing:"border-box",...x?{display:"inline-block",height:"100%",marginLeft:C!==0?C:O?"auto":0,paddingLeft:t.offsetTop,paddingRight:t.offsetBottom,whiteSpace:"nowrap"}:{marginTop:C!==0?C:O?"auto":0,paddingBottom:t.offsetBottom,paddingTop:t.offsetTop},...N?{}:{visibility:"hidden"}};return!e&&t.totalCount===0&&v?i.jsx(v,{...ys(v,u)}):i.jsx(k,{...ys(k,u),"data-testid":e?"virtuoso-top-item-list":"virtuoso-item-list",ref:b,style:_,children:(e?t.topItems:t.items).map(R=>{const D=R.originalIndex,B=E(D+t.firstItemIndex,R.data,u);return L?c.createElement(w,{...ys(w,u),height:R.size,index:R.index,key:B,type:R.type||"item",...R.type==="group"?{}:{groupIndex:R.groupIndex}}):R.type==="group"?c.createElement(P,{...ys(P,u),"data-index":D,"data-item-index":R.index,"data-known-size":R.size,key:B,style:nLe},h(R.index,u)):c.createElement(S,{...ys(S,u),...aLe(S,R.data),"data-index":D,"data-item-group-index":R.groupIndex,"data-item-index":R.index,"data-known-size":R.size,key:B,style:x?sLe:DZ},I?d(R.index,R.groupIndex,R.data,u):d(R.index,R.data,u))})})}),iLe={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},oLe={outline:"none",overflowX:"auto",position:"relative"},Pb=e=>({height:"100%",position:"absolute",top:0,width:"100%",...e?{display:"flex",flexDirection:"column"}:{}}),rLe={position:LZ(),top:0,width:"100%",zIndex:1};function ys(e,t){if(typeof e!="string")return{context:t}}function aLe(e,t){return{item:typeof e=="string"?void 0:t}}const lLe=xe.memo(function(){const e=mt("HeaderComponent"),t=so("headerHeight"),n=mt("HeaderFooterTag"),s=Vc(xe.useMemo(()=>r=>{t(sl(r,"height"))},[t]),!0,mt("skipAnimationFrameInResizeObserver")),o=mt("context");return e?i.jsx(n,{ref:s,children:i.jsx(e,{...ys(e,o)})}):null}),cLe=xe.memo(function(){const e=mt("FooterComponent"),t=so("footerHeight"),n=mt("HeaderFooterTag"),s=Vc(xe.useMemo(()=>r=>{t(sl(r,"height"))},[t]),!0,mt("skipAnimationFrameInResizeObserver")),o=mt("context");return e?i.jsx(n,{ref:s,children:i.jsx(e,{...ys(e,o)})}):null});function RZ({useEmitter:e,useEmitterValue:t,usePublisher:n}){return xe.memo(function({children:s,style:o,...r}){const a=n("scrollContainerState"),l=t("ScrollerComponent"),d=n("smoothScrollTargetReached"),u=t("scrollerRef"),h=t("context"),p=t("horizontalDirection")||!1,{scrollByCallback:f,scrollerRef:m,scrollToCallback:g}=PZ(a,d,l,u,void 0,p);return e("scrollTo",g),e("scrollBy",f),i.jsx(l,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:m,style:{...p?oLe:iLe,...o},tabIndex:0,...r,...ys(l,h),children:s})})}function OZ({useEmitter:e,useEmitterValue:t,usePublisher:n}){return xe.memo(function({children:s,style:o,...r}){const a=n("windowScrollContainerState"),l=t("ScrollerComponent"),d=n("smoothScrollTargetReached"),u=t("totalListHeight"),h=t("deviation"),p=t("customScrollParent"),f=t("context"),m=xe.useRef(null),g=t("scrollerRef"),{scrollByCallback:x,scrollerRef:b,scrollToCallback:C}=PZ(a,d,l,g,p);return EZ(()=>{var y;return b.current=p||((y=m.current)==null?void 0:y.ownerDocument.defaultView),()=>{b.current=null}},[b,p]),e("windowScrollTo",C),e("scrollBy",x),i.jsx(l,{ref:m,"data-virtuoso-scroller":!0,style:{position:"relative",...o,...u!==0?{height:u+h}:{}},...r,...ys(l,f),children:s})})}const dLe=({children:e})=>{const t=xe.useContext(AZ),n=so("viewportHeight"),s=so("fixedItemHeight"),o=mt("alignToBottom"),r=mt("horizontalDirection"),a=xe.useMemo(()=>aZ(n,d=>sl(d,r?"width":"height")),[n,r]),l=Vc(a,!0,mt("skipAnimationFrameInResizeObserver"));return xe.useEffect(()=>{t&&(n(t.viewportHeight),s(t.itemHeight))},[t,n,s]),i.jsx("div",{"data-viewport-type":"element",ref:l,style:Pb(o),children:e})},uLe=({children:e})=>{const t=xe.useContext(AZ),n=so("windowViewportRect"),s=so("fixedItemHeight"),o=mt("customScrollParent"),r=dZ(n,o,mt("skipAnimationFrameInResizeObserver")),a=mt("alignToBottom");return xe.useEffect(()=>{t&&(s(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))},[t,n,s]),i.jsx("div",{"data-viewport-type":"window",ref:r,style:Pb(a),children:e})},hLe=({children:e})=>{const t=mt("TopItemListComponent")||"div",n=mt("headerHeight"),s={...rLe,marginTop:`${n}px`},o=mt("context");return i.jsx(t,{style:s,...ys(t,o),children:e})},pLe=xe.memo(function(e){const t=mt("useWindowScroll"),n=mt("topItemsIndexes").length>0,s=mt("customScrollParent"),o=mt("context"),r=s||t?gLe:mLe,a=s||t?uLe:dLe;return i.jsxs(r,{...e,...ys(r,o),children:[n&&i.jsx(hLe,{children:i.jsx(p3,{showTopList:!0})}),i.jsxs(a,{children:[i.jsx(lLe,{}),i.jsx(p3,{}),i.jsx(cLe,{})]})]})}),{Component:fLe,useEmitter:e4,useEmitterValue:mt,usePublisher:so}=TZ(eLe,{events:{atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",endReached:"endReached",groupIndices:"groupIndices",isScrolling:"isScrolling",itemsRendered:"itemsRendered",rangeChanged:"rangeChanged",startReached:"startReached",totalListHeightChanged:"totalListHeightChanged"},methods:{autoscrollToBottom:"autoscrollToBottom",getState:"getState",scrollBy:"scrollBy",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollToIndex:"scrollToIndex"},optional:{alignToBottom:"alignToBottom",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",components:"components",computeItemKey:"computeItemKey",context:"context",customScrollParent:"customScrollParent",data:"data",defaultItemHeight:"defaultItemHeight",firstItemIndex:"firstItemIndex",fixedItemHeight:"fixedItemHeight",followOutput:"followOutput",groupContent:"groupContent",groupCounts:"groupCounts",headerFooterTag:"HeaderFooterTag",horizontalDirection:"horizontalDirection",increaseViewportBy:"increaseViewportBy",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",initialTopMostItemIndex:"initialTopMostItemIndex",itemContent:"itemContent",itemSize:"itemSize",logLevel:"logLevel",overscan:"overscan",restoreStateFrom:"restoreStateFrom",scrollerRef:"scrollerRef",scrollSeekConfiguration:"scrollSeekConfiguration",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver",topItemCount:"topItemCount",totalCount:"totalCount",useWindowScroll:"useWindowScroll"},required:{}},pLe),mLe=RZ({useEmitter:e4,useEmitterValue:mt,usePublisher:so}),gLe=OZ({useEmitter:e4,useEmitterValue:mt,usePublisher:so}),xLe=fLe,yLe=Ht(()=>{const e=Ae(d=>i.jsxs("td",{children:["Item $",d]})),t=Ae(null),n=Ae(null),s=Ae(null),o=Ae({}),r=Ae(JI),a=Ae(lh),l=(d,u=null)=>Rs(Se(o,Ge(h=>h[d]),hn()),u);return{components:o,computeItemKey:r,context:t,EmptyPlaceholder:l("EmptyPlaceholder"),FillerRow:l("FillerRow"),fixedFooterContent:s,fixedHeaderContent:n,itemContent:e,ScrollerComponent:l("Scroller","div"),scrollerRef:a,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),TableBodyComponent:l("TableBody","tbody"),TableComponent:l("Table","table"),TableFooterComponent:l("TableFoot","tfoot"),TableHeadComponent:l("TableHead","thead"),TableRowComponent:l("TableRow","tr")}});mn(IZ,yLe);const f3={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},bLe={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:m3,floor:wx,max:tf,min:E2,round:g3}=Math;function x3(e,t,n){return Array.from({length:t-e+1}).map((s,o)=>({data:n===null?null:n[o+e],index:o+e}))}function vLe(e){return{...bLe,items:e}}function u0(e,t){return e&&e.width===t.width&&e.height===t.height}function CLe(e,t){return e&&e.column===t.column&&e.row===t.row}const wLe=Ht(([{increaseViewportBy:e,listBoundary:t,overscan:n,visibleRange:s},{footerHeight:o,headerHeight:r,scrollBy:a,scrollContainerState:l,scrollTo:d,scrollTop:u,smoothScrollTargetReached:h,viewportHeight:p},f,m,{didMount:g,propsReady:x},{customScrollParent:b,useWindowScroll:C,windowScrollContainerState:y,windowScrollTo:v,windowViewportRect:w},k])=>{const S=Ae(0),P=Ae(0),E=Ae(f3),L=Ae({height:0,width:0}),I=Ae({height:0,width:0}),O=Dt(),N=Dt(),_=Ae(0),R=Ae(null),D=Ae({column:0,row:0}),B=Dt(),V=Dt(),ee=Ae(!1),se=Ae(0),oe=Ae(!0),te=Ae(!1),H=Ae(!1);Kt(Se(g,kt(se),ct(([F,q])=>!!q)),()=>{wt(oe,!1)}),Kt(Se(Yn(g,oe,I,L,se,te),ct(([F,q,ie,ce,,me])=>F&&!q&&ie.height!==0&&ce.height!==0&&!me)),([,,,,F])=>{wt(te,!0),ZI(1,()=>{wt(O,F)}),vr(Se(u),()=>{wt(t,[0,0]),wt(oe,!0)})}),qe(Se(V,ct(F=>F!=null&&F.scrollTop>0),Yo(0)),P),Kt(Se(g,kt(V),ct(([,F])=>F!=null)),([,F])=>{F&&(wt(L,F.viewport),wt(I,F.item),wt(D,F.gap),F.scrollTop>0&&(wt(ee,!0),vr(Se(u,uu(1)),q=>{wt(ee,!1)}),wt(d,{top:F.scrollTop})))}),qe(Se(L,Ge(({height:F})=>F)),p),qe(Se(Yn(dt(L,u0),dt(I,u0),dt(D,(F,q)=>F&&F.column===q.column&&F.row===q.row),dt(u)),Ge(([F,q,ie,ce])=>({gap:ie,item:q,scrollTop:ce,viewport:F}))),B),qe(Se(Yn(dt(S),s,dt(D,CLe),dt(I,u0),dt(L,u0),dt(R),dt(P),dt(ee),dt(oe),dt(se)),ct(([,,,,,,,F])=>!F),Ge(([F,[q,ie],ce,me,Ie,we,Ee,,ot,Fe])=>{const{column:Be,row:ut}=ce,{height:rt,width:ht}=me,{width:K}=Ie;if(Ee===0&&(F===0||K===0))return f3;if(ht===0){const _t=YI(Fe,F),vn=_t+Math.max(Ee-1,0);return vLe(x3(_t,vn,we))}const ae=NZ(K,ht,Be);let ne,ue;ot?q===0&&ie===0&&Ee>0?(ne=0,ue=Ee-1):(ne=ae*wx((q+ut)/(rt+ut)),ue=ae*m3((ie+ut)/(rt+ut))-1,ue=E2(F-1,tf(ue,ae-1)),ne=E2(ue,tf(0,ne))):(ne=0,ue=-1);const be=x3(ne,ue,we),{bottom:ye,top:ke}=y3(Ie,ce,me,be),Ue=m3(F/ae),pt=Ue*rt+(Ue-1)*ut-ye;return{bottom:ye,itemHeight:rt,items:be,itemWidth:ht,offsetBottom:pt,offsetTop:ke,top:ke}})),E),qe(Se(R,ct(F=>F!==null),Ge(F=>F.length)),S),qe(Se(Yn(L,I,E,D),ct(([F,q,{items:ie}])=>ie.length>0&&q.height!==0&&F.height!==0),Ge(([F,q,{items:ie},ce])=>{const{bottom:me,top:Ie}=y3(F,ce,q,ie);return[Ie,me]}),hn(Of)),t);const z=Ae(!1);qe(Se(u,kt(z),Ge(([F,q])=>q||F!==0)),z);const Z=Ii(Se(Yn(E,S),ct(([{items:F}])=>F.length>0),kt(z),ct(([[F,q],ie])=>{const ce=F.items[F.items.length-1].index===q-1;return(ie||F.bottom>0&&F.itemHeight>0&&F.offsetBottom===0&&F.items.length===q)&&ce}),Ge(([[,F]])=>F-1),hn())),U=Ii(Se(dt(E),ct(({items:F})=>F.length>0&&F[0].index===0),Yo(0),hn())),Y=Ii(Se(dt(E),kt(ee),ct(([{items:F},q])=>F.length>0&&!q),Ge(([{items:F}])=>({endIndex:F[F.length-1].index,startIndex:F[0].index})),hn(gZ),Ga(0)));qe(Y,m.scrollSeekRangeChanged),qe(Se(O,kt(L,I,S,D),Ge(([F,q,ie,ce,me])=>{const Ie=CZ(F),{align:we,behavior:Ee,offset:ot}=Ie;let Fe=Ie.index;Fe==="LAST"&&(Fe=ce-1),Fe=tf(0,Fe,E2(ce-1,Fe));let Be=lS(q,me,ie,Fe);return we==="end"?Be=g3(Be-q.height+ie.height):we==="center"&&(Be=g3(Be-q.height/2+ie.height/2)),ot&&(Be+=ot),{behavior:Ee,top:Be}})),d);const $=Rs(Se(E,Ge(F=>F.offsetBottom+F.bottom)),0);return qe(Se(w,Ge(F=>({height:F.visibleHeight,width:F.visibleWidth}))),L),{customScrollParent:b,data:R,deviation:_,footerHeight:o,gap:D,headerHeight:r,increaseViewportBy:e,initialItemCount:P,itemDimensions:I,overscan:n,restoreStateFrom:V,scrollBy:a,scrollContainerState:l,scrollHeight:N,scrollTo:d,scrollToIndex:O,scrollTop:u,smoothScrollTargetReached:h,totalCount:S,useWindowScroll:C,viewportDimensions:L,windowScrollContainerState:y,windowScrollTo:v,windowViewportRect:w,...m,gridState:E,horizontalDirection:H,initialTopMostItemIndex:se,totalListHeight:$,...f,endReached:Z,propsReady:x,rangeChanged:Y,startReached:U,stateChanged:B,stateRestoreInProgress:ee,...k}},mn(XI,Ys,pg,jZ,Sl,QI,wl));function NZ(e,t,n){return tf(1,wx((e+n)/(wx(t)+n)))}function y3(e,t,n,s){const{height:o}=n;if(o===void 0||s.length===0)return{bottom:0,top:0};const r=lS(e,t,n,s[0].index);return{bottom:lS(e,t,n,s[s.length-1].index)+o,top:r}}function lS(e,t,n,s){const o=NZ(e.width,n.width,t.column),r=wx(s/o),a=r*n.height+tf(0,r-1)*t.row;return a>0?a+t.row:a}const SLe=Ht(()=>{const e=Ae(p=>`Item ${p}`),t=Ae({}),n=Ae(null),s=Ae("virtuoso-grid-item"),o=Ae("virtuoso-grid-list"),r=Ae(JI),a=Ae("div"),l=Ae(lh),d=(p,f=null)=>Rs(Se(t,Ge(m=>m[p]),hn()),f),u=Ae(!1),h=Ae(!1);return qe(dt(h),u),{components:t,computeItemKey:r,context:n,FooterComponent:d("Footer"),HeaderComponent:d("Header"),headerFooterTag:a,itemClassName:s,ItemComponent:d("Item","div"),itemContent:e,listClassName:o,ListComponent:d("List","div"),readyStateChanged:u,reportReadyState:h,ScrollerComponent:d("Scroller","div"),scrollerRef:l,ScrollSeekPlaceholder:d("ScrollSeekPlaceholder","div")}}),kLe=Ht(([e,t])=>({...e,...t}),mn(wLe,SLe)),jLe=xe.memo(function(){const e=yn("gridState"),t=yn("listClassName"),n=yn("itemClassName"),s=yn("itemContent"),o=yn("computeItemKey"),r=yn("isSeeking"),a=io("scrollHeight"),l=yn("ItemComponent"),d=yn("ListComponent"),u=yn("ScrollSeekPlaceholder"),h=yn("context"),p=io("itemDimensions"),f=io("gap"),m=yn("log"),g=yn("stateRestoreInProgress"),x=io("reportReadyState"),b=Vc(xe.useMemo(()=>C=>{const y=C.parentElement.parentElement.scrollHeight;a(y);const v=C.firstChild;if(v){const{height:w,width:k}=v.getBoundingClientRect();p({height:w,width:k})}f({column:b3("column-gap",getComputedStyle(C).columnGap,m),row:b3("row-gap",getComputedStyle(C).rowGap,m)})},[a,p,f,m]),!0,!1);return EZ(()=>{e.itemHeight>0&&e.itemWidth>0&&x(!0)},[e]),g?null:i.jsx(d,{className:t,ref:b,...ys(d,h),"data-testid":"virtuoso-item-list",style:{paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},children:e.items.map(C=>{const y=o(C.index,C.data,h);return r?i.jsx(u,{...ys(u,h),height:e.itemHeight,index:C.index,width:e.itemWidth},y):c.createElement(l,{...ys(l,h),className:n,"data-index":C.index,key:y},s(C.index,C.data,h))})})}),_Le=xe.memo(function(){const e=yn("HeaderComponent"),t=io("headerHeight"),n=yn("headerFooterTag"),s=Vc(xe.useMemo(()=>r=>{t(sl(r,"height"))},[t]),!0,!1),o=yn("context");return e?i.jsx(n,{ref:s,children:i.jsx(e,{...ys(e,o)})}):null}),ILe=xe.memo(function(){const e=yn("FooterComponent"),t=io("footerHeight"),n=yn("headerFooterTag"),s=Vc(xe.useMemo(()=>r=>{t(sl(r,"height"))},[t]),!0,!1),o=yn("context");return e?i.jsx(n,{ref:s,children:i.jsx(e,{...ys(e,o)})}):null}),TLe=({children:e})=>{const t=xe.useContext(MZ),n=io("itemDimensions"),s=io("viewportDimensions"),o=Vc(xe.useMemo(()=>r=>{s(r.getBoundingClientRect())},[s]),!0,!1);return xe.useEffect(()=>{t&&(s({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))},[t,s,n]),i.jsx("div",{ref:o,style:Pb(!1),children:e})},ALe=({children:e})=>{const t=xe.useContext(MZ),n=io("windowViewportRect"),s=io("itemDimensions"),o=yn("customScrollParent"),r=dZ(n,o,!1);return xe.useEffect(()=>{t&&(s({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))},[t,n,s]),i.jsx("div",{ref:r,style:Pb(!1),children:e})},MLe=xe.memo(function({...e}){const t=yn("useWindowScroll"),n=yn("customScrollParent"),s=n||t?PLe:ELe,o=n||t?ALe:TLe,r=yn("context");return i.jsx(s,{...e,...ys(s,r),children:i.jsxs(o,{children:[i.jsx(_Le,{}),i.jsx(jLe,{}),i.jsx(ILe,{})]})})}),{useEmitter:FZ,useEmitterValue:yn,usePublisher:io}=TZ(kLe,{events:{atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",endReached:"endReached",isScrolling:"isScrolling",rangeChanged:"rangeChanged",readyStateChanged:"readyStateChanged",startReached:"startReached",stateChanged:"stateChanged"},methods:{scrollBy:"scrollBy",scrollTo:"scrollTo",scrollToIndex:"scrollToIndex"},optional:{components:"components",computeItemKey:"computeItemKey",context:"context",customScrollParent:"customScrollParent",data:"data",headerFooterTag:"headerFooterTag",increaseViewportBy:"increaseViewportBy",initialItemCount:"initialItemCount",initialTopMostItemIndex:"initialTopMostItemIndex",itemClassName:"itemClassName",itemContent:"itemContent",listClassName:"listClassName",logLevel:"logLevel",overscan:"overscan",restoreStateFrom:"restoreStateFrom",scrollerRef:"scrollerRef",scrollSeekConfiguration:"scrollSeekConfiguration",totalCount:"totalCount",useWindowScroll:"useWindowScroll"}},MLe),ELe=RZ({useEmitter:FZ,useEmitterValue:yn,usePublisher:io}),PLe=OZ({useEmitter:FZ,useEmitterValue:yn,usePublisher:io});function b3(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Ti.WARN),t==="normal"?0:parseInt(t??"0",10)}const v3={pending:{colorScheme:"cyan",translationKey:"queue.pending"},in_progress:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},failed:{colorScheme:"red",translationKey:"queue.failed"},canceled:{colorScheme:"orange",translationKey:"queue.canceled"}},LLe=({status:e})=>{const{t}=M();return i.jsx(Hn,{colorScheme:v3[e].colorScheme,children:t(v3[e].translationKey)})},DLe=c.memo(LLe),BZ=e=>{const{t}=M();return t(e==="canvas"?"queue.canvas":e==="gallery"?"queue.gallery":"queue.other")},$Z=e=>{const{t}=M();return t(e==="generation"?"queue.generation":e==="workflows"?"queue.workflows":e==="upscaling"?"queue.upscaling":"queue.other")},VZ=e=>{const t=re(Jn),[n,{isLoading:s}]=pS(),{t:o}=M();return{cancelQueueItem:c.useCallback(async()=>{try{await n(e).unwrap(),ge({id:"QUEUE_CANCEL_SUCCEEDED",title:o("queue.cancelSucceeded"),status:"success"})}catch{ge({id:"QUEUE_CANCEL_FAILED",title:o("queue.cancelFailed"),status:"error"})}},[e,o,n]),isLoading:s,isDisabled:!t}},zZ=e=>{const t=re(Jn),[n,{isLoading:s}]=sle(),{t:o}=M();return{retryQueueItem:c.useCallback(async()=>{try{if(!(await n([e]).unwrap()).retried_item_ids.includes(e))throw new Error("Failed to retry item");ge({id:"QUEUE_RETRY_SUCCEEDED",title:o("queue.retrySucceeded"),status:"success"})}catch{ge({id:"QUEUE_RETRY_FAILED",title:o("queue.retryFailed"),status:"error"})}},[e,o,n]),isLoading:s,isDisabled:!t}},GZ=(e,t)=>Number(((Date.parse(t)-Date.parse(e))/1e3).toFixed(2)),gs={number:"3rem",statusBadge:"5.7rem",time:"4rem",credits:"4rem",origin:"5rem",destination:"6rem",batchId:"5rem",fieldValues:"auto",validationRun:"auto",actions:"auto"},RLe=e=>{const t=re(Jn),{isCanceled:n}=h8({batch_id:e},{selectFromResult:({data:l})=>l?{isCanceled:(l==null?void 0:l.in_progress)===0&&(l==null?void 0:l.pending)===0}:{isCanceled:!0}}),[s,{isLoading:o}]=ile({fixedCacheKey:"cancelByBatchIds"}),{t:r}=M();return{cancelBatch:c.useCallback(async()=>{if(!n)try{await s({batch_ids:[e]}).unwrap(),ge({id:"CANCEL_BATCH_SUCCEEDED",title:r("queue.cancelBatchSucceeded"),status:"success"})}catch{ge({id:"CANCEL_BATCH_FAILED",title:r("queue.cancelBatchFailed"),status:"error"})}},[e,n,r,s]),isLoading:o,isCanceled:n,isDisabled:!t}},OLe=({queueItemDTO:e})=>{const{session_id:t,batch_id:n,item_id:s,origin:o,destination:r}=e,{t:a}=M(),l=Bt("retryQueueItem"),{cancelBatch:d,isLoading:u,isCanceled:h}=RLe(n),{cancelQueueItem:p,isLoading:f}=VZ(s),{retryQueueItem:m,isLoading:g}=zZ(s),{data:x}=ole(s),b=$Z(o),C=BZ(r),y=c.useMemo(()=>{if(!x)return a("common.loading");if(!x.completed_at||!x.started_at)return a(`queue.${x.status}`);const k=GZ(x.started_at,x.completed_at);return x.status==="completed"?`${a("queue.completedIn")} ${k}${k===1?"":"s"}`:`${k}s`},[x,a]),v=c.useMemo(()=>!!x&&["canceled","completed","failed"].includes(x.status),[x]),w=c.useMemo(()=>!!x&&["canceled","failed"].includes(x.status),[x]);return i.jsxs(T,{layerStyle:"third",flexDir:"column",p:2,pt:0,borderRadius:"base",gap:2,children:[i.jsxs(T,{layerStyle:"second",p:2,gap:2,justifyContent:"space-between",alignItems:"center",borderRadius:"base",h:20,children:[i.jsx(nd,{label:a("queue.status"),data:y}),i.jsx(nd,{label:a("queue.origin"),data:b}),i.jsx(nd,{label:a("queue.destination"),data:C}),i.jsx(nd,{label:a("queue.item"),data:s}),i.jsx(nd,{label:a("queue.batch"),data:n}),i.jsx(nd,{label:a("queue.session"),data:t}),i.jsxs(Qn,{size:"xs",orientation:"vertical",children:[(!w||!l)&&i.jsx(de,{onClick:p,isLoading:f,isDisabled:x?v:!0,"aria-label":a("queue.cancelItem"),leftIcon:i.jsx(Rt,{}),colorScheme:"error",children:a("queue.cancelItem")}),w&&l&&i.jsx(de,{onClick:m,isLoading:g,isDisabled:!x,"aria-label":a("queue.retryItem"),leftIcon:i.jsx(Zs,{}),colorScheme:"invokeBlue",children:a("queue.retryItem")}),i.jsx(de,{onClick:d,isLoading:u,isDisabled:h,"aria-label":a("queue.cancelBatch"),leftIcon:i.jsx(Rt,{}),colorScheme:"error",children:a("queue.cancelBatch")})]})]}),((x==null?void 0:x.error_traceback)||(x==null?void 0:x.error_message))&&i.jsxs(T,{layerStyle:"second",p:3,gap:1,justifyContent:"space-between",alignItems:"flex-start",borderRadius:"base",flexDir:"column",children:[i.jsx(zt,{size:"sm",color:"error.400",children:a("common.error")}),i.jsx("pre",{children:(x==null?void 0:x.error_traceback)||(x==null?void 0:x.error_message)})]}),i.jsx(T,{layerStyle:"second",h:512,w:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:x?i.jsx(br,{label:"Queue Item",data:x,extraCopyActions:[{label:"Graph",getData:k=>tP(k,"session.graph")}]}):i.jsx(ci,{opacity:.5})})]})},NLe=c.memo(OLe),nd=({label:e,data:t})=>i.jsxs(T,{flexDir:"column",justifyContent:"flex-start",p:1,gap:1,overflow:"hidden",h:"full",w:"full",children:[i.jsx(zt,{size:"md",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:e}),i.jsx(W,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t})]}),C3={bg:"base.700"},FLe={_hover:C3,"&[aria-selected='true']":C3},BLe=({index:e,item:t,context:n})=>{const{t:s}=M(),o=Bt("retryQueueItem"),r=c.useCallback(()=>{n.toggleQueueItem(t.item_id)},[n,t.item_id]),{cancelQueueItem:a,isLoading:l}=VZ(t.item_id),d=c.useCallback(w=>{w.stopPropagation(),a()},[a]),{retryQueueItem:u,isLoading:h}=zZ(t.item_id),p=c.useCallback(w=>{w.stopPropagation(),u()},[u]),f=c.useMemo(()=>n.openQueueItems.includes(t.item_id),[n.openQueueItems,t.item_id]),m=c.useMemo(()=>!t.completed_at||!t.started_at?void 0:`${GZ(t.started_at,t.completed_at)}s`,[t]),g=JS(yD),x=c.useMemo(()=>["canceled","completed","failed"].includes(t.status),[t.status]),b=c.useMemo(()=>["canceled","failed"].includes(t.status),[t.status]),C=c.useMemo(()=>t.is_api_validation_run===!0,[t.is_api_validation_run]),y=$Z(t.origin),v=BZ(t.destination);return i.jsxs(T,{flexDir:"column","aria-selected":f,fontSize:"sm",borderRadius:"base",justifyContent:"center",sx:FLe,"data-testid":"queue-item",children:[i.jsxs(T,{minH:9,alignItems:"center",gap:4,p:1.5,cursor:"pointer",onClick:r,children:[i.jsx(T,{w:gs.number,justifyContent:"flex-end",alignItems:"center",flexShrink:0,children:i.jsx(W,{variant:"subtext",children:e+1})}),i.jsx(T,{w:gs.statusBadge,alignItems:"center",flexShrink:0,children:i.jsx(DLe,{status:t.status})}),i.jsx(T,{w:gs.origin,flexShrink:0,children:i.jsx(W,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:y})}),i.jsx(T,{w:gs.destination,flexShrink:0,children:i.jsx(W,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:v})}),i.jsx(T,{w:gs.time,alignItems:"center",flexShrink:0,children:m||"-"}),g&&i.jsx(T,{w:gs.credits,alignItems:"center",flexShrink:0,children:t.credits||"-"}),i.jsx(T,{w:gs.batchId,flexShrink:0,children:i.jsx(W,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:t.batch_id})}),i.jsx(T,{alignItems:"center",overflow:"hidden",flexGrow:1,children:t.field_values&&i.jsx(T,{gap:2,w:"full",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:t.field_values.filter(w=>w.node_path!=="metadata_accumulator").map(({node_path:w,field_name:k,value:S})=>i.jsxs(W,{as:"span",children:[i.jsxs(W,{as:"span",fontWeight:"semibold",children:[w,".",k]}),": ",JSON.stringify(S)]},`${t.item_id}.${w}.${k}.${S}`))})}),i.jsx(T,{alignItems:"center",w:gs.validationRun,flexShrink:0,children:C&&i.jsx(Hn,{children:s("workflows.builder.publishingValidationRun")})}),i.jsx(T,{alignItems:"center",w:gs.actions,pe:3,children:i.jsxs(Qn,{size:"xs",variant:"ghost",children:[(!b||!o||C)&&i.jsx(le,{onClick:d,isDisabled:x,isLoading:l,"aria-label":s("queue.cancelItem"),icon:i.jsx(Rt,{})}),b&&o&&!C&&i.jsx(le,{onClick:p,isLoading:h,"aria-label":s("queue.retryItem"),icon:i.jsx(Zs,{})})]})})]}),i.jsx(ll,{in:f,transition:$Le,unmountOnExit:!0,children:i.jsx(NLe,{queueItemDTO:t})})]})},$Le={enter:{duration:.1},exit:{duration:.1}},VLe=c.memo(BLe),HZ=am(NL((e,t)=>i.jsx(T,{...e,ref:t,flexDirection:"column",gap:.5,children:e.children})));HZ.displayName="QueueListComponent";const zLe=()=>{const{t:e}=M(),t=JS(yD);return i.jsxs(T,{alignItems:"center",gap:4,p:1,pb:2,textTransform:"uppercase",fontWeight:"bold",fontSize:"sm",letterSpacing:1,children:[i.jsx(T,{w:gs.number,justifyContent:"flex-end",alignItems:"center",children:i.jsx(W,{variant:"subtext",children:"#"})}),i.jsx(T,{ps:.5,w:gs.statusBadge,alignItems:"center",children:i.jsx(W,{variant:"subtext",children:e("queue.status")})}),i.jsx(T,{ps:.5,w:gs.origin,alignItems:"center",children:i.jsx(W,{variant:"subtext",children:e("queue.origin")})}),i.jsx(T,{ps:.5,w:gs.destination,alignItems:"center",children:i.jsx(W,{variant:"subtext",children:e("queue.destination")})}),i.jsx(T,{ps:.5,w:gs.time,alignItems:"center",children:i.jsx(W,{variant:"subtext",children:e("queue.time")})}),t&&i.jsx(T,{ps:.5,w:gs.credits,alignItems:"center",children:i.jsx(W,{variant:"subtext",children:e("queue.credits")})}),i.jsx(T,{ps:.5,w:gs.batchId,alignItems:"center",children:i.jsx(W,{variant:"subtext",children:e("queue.batch")})}),i.jsx(T,{ps:.5,w:gs.fieldValues,alignItems:"center",children:i.jsx(W,{variant:"subtext",children:e("queue.batchFieldValues")})})]})},GLe=c.memo(zLe),HLe=(e,t)=>t.item_id,WLe={List:HZ},ULe=(e,t,n)=>i.jsx(VLe,{index:e,item:t,context:n}),qLe=()=>{const e=A(rle),t=A(ale),n=G(),s=c.useRef(null),[o,r]=c.useState(null),[a,l]=f7(rc),{t:d}=M();c.useEffect(()=>{const{current:C}=s;return o&&C&&a({target:C,elements:{viewport:o}}),()=>{var y;return(y=l())==null?void 0:y.destroy()}},[o,a,l]);const{data:u,isLoading:h}=lle({cursor:e,priority:t},{refetchOnMountOrArgChange:!0}),p=c.useMemo(()=>u?cle.selectAll(u):[],[u]),f=c.useCallback(()=>{if(!(u!=null&&u.has_more))return;const C=p[p.length-1];C&&(n(fS(C.item_id)),n(mS(C.priority)))},[n,u==null?void 0:u.has_more,p]),[m,g]=c.useState([]),x=c.useCallback(C=>{g(y=>y.includes(C)?y.filter(v=>v!==C):[...y,C])},[]),b=c.useMemo(()=>({openQueueItems:m,toggleQueueItem:x}),[m,x]);return h?i.jsx(Ny,{}):p.length?i.jsxs(T,{w:"full",h:"full",flexDir:"column",children:[i.jsx(GLe,{}),i.jsx(T,{ref:s,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(xLe,{data:p,endReached:f,scrollerRef:r,itemContent:ULe,computeItemKey:HLe,components:WLe,context:b})})]}):i.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:i.jsx(zt,{color:"base.500",children:d("queue.queueEmpty")})})},KLe=c.memo(qLe),ZLe=()=>{const{data:e}=uo(),{t}=M();return i.jsxs(oZ,{"data-testid":"queue-status",children:[i.jsx(Zo,{label:t("queue.in_progress"),value:(e==null?void 0:e.queue.in_progress)??0}),i.jsx(Zo,{label:t("queue.pending"),value:(e==null?void 0:e.queue.pending)??0}),i.jsx(Zo,{label:t("queue.completed"),value:(e==null?void 0:e.queue.completed)??0}),i.jsx(Zo,{label:t("queue.failed"),value:(e==null?void 0:e.queue.failed)??0}),i.jsx(Zo,{label:t("queue.canceled"),value:(e==null?void 0:e.queue.canceled)??0}),i.jsx(Zo,{label:t("queue.total"),value:(e==null?void 0:e.queue.total)??0})]})},YLe=c.memo(ZLe),WZ=c.memo(e=>{const{t}=M(),n=Lm();return i.jsx(i.Fragment,{children:i.jsx(de,{onClick:n.openDialog,isLoading:n.isLoading,isDisabled:n.isDisabled,tooltip:t("queue.cancelAllExceptCurrentTooltip"),leftIcon:i.jsx(Ey,{}),colorScheme:"error","data-testid":t("queue.clear"),...e,children:t("queue.clear")})})});WZ.displayName="CancelAllExceptCurrentButton";const XLe=()=>{const e=Bt("modelCache"),[t,{isLoading:n}]=dle(),{t:s}=M(),o=c.useCallback(async()=>{try{await t().unwrap(),ge({status:"success",title:s("modelCache.clearSucceeded")})}catch{ge({status:"error",title:s("modelCache.clearFailed")})}},[t,s]);return e?i.jsx(de,{size:"sm",colorScheme:"red",onClick:o,isLoading:n,children:s("modelCache.clear")}):i.jsx(i.Fragment,{})},QLe=c.memo(XLe),JLe=e=>{const{t}=M(),n=Dm();return i.jsx(i.Fragment,{children:i.jsx(de,{isDisabled:n.isDisabled,isLoading:n.isLoading,tooltip:t("queue.clearTooltip"),leftIcon:i.jsx(My,{}),colorScheme:"error",onClick:n.openDialog,"data-testid":t("queue.clear"),...e,children:t("queue.clear")})})},eDe=c.memo(JLe),tDe=({label:e,tooltip:t,icon:n,onClick:s,isDisabled:o,colorScheme:r,asIconButton:a,isLoading:l,loadingText:d,sx:u})=>a?i.jsx(le,{"aria-label":e,tooltip:t,icon:n,onClick:s,isDisabled:o,colorScheme:r,isLoading:l,sx:u,"data-testid":e}):i.jsx(de,{"aria-label":e,tooltip:t,leftIcon:n,onClick:s,isDisabled:o,colorScheme:r,isLoading:l,loadingText:d??e,flexGrow:1,sx:u,"data-testid":e,children:e}),t4=c.memo(tDe),nDe=({asIconButton:e})=>{const{t}=M(),{pauseProcessor:n,isLoading:s,isDisabled:o}=lq();return i.jsx(t4,{asIconButton:e,label:t("queue.pause"),tooltip:t("queue.pauseTooltip"),isDisabled:o,isLoading:s,icon:i.jsx(G7,{}),onClick:n,colorScheme:"gold"})},sDe=c.memo(nDe),iDe=()=>{const e=G(),{t}=M(),n=re(Jn),[s,{isLoading:o}]=CL({fixedCacheKey:"pruneQueue"}),{finishedCount:r}=uo(void 0,{selectFromResult:({data:d})=>d?{finishedCount:d.queue.completed+d.queue.canceled+d.queue.failed}:{finishedCount:0}}),a=c.useCallback(async()=>{if(r)try{const d=await s().unwrap();ge({id:"PRUNE_SUCCEEDED",title:t("queue.pruneSucceeded",{item_count:d.deleted}),status:"success"}),e(fS(void 0)),e(mS(void 0))}catch{ge({id:"PRUNE_FAILED",title:t("queue.pruneFailed"),status:"error"})}},[r,s,e,t]),l=c.useMemo(()=>!n||!r,[r,n]);return{pruneQueue:a,isLoading:o,finishedCount:r,isDisabled:l}},oDe=({asIconButton:e})=>{const{t}=M(),{pruneQueue:n,isLoading:s,finishedCount:o,isDisabled:r}=iDe();return i.jsx(t4,{isDisabled:r,isLoading:s,asIconButton:e,label:t("queue.prune"),tooltip:t("queue.pruneTooltip",{item_count:o}),icon:i.jsx(Npe,{}),onClick:n,colorScheme:"invokeBlue"})},rDe=c.memo(oDe),aDe=({asIconButton:e})=>{const{t}=M(),{resumeProcessor:n,isLoading:s,isDisabled:o}=cq();return i.jsx(t4,{asIconButton:e,label:t("queue.resume"),tooltip:t("queue.resumeTooltip"),isDisabled:o,isLoading:s,icon:i.jsx(H7,{}),onClick:n,colorScheme:"green"})},lDe=c.memo(aDe),cDe=()=>{const e=Bt("pauseQueue"),t=Bt("resumeQueue"),n=Bt("cancelAndClearAll");return i.jsxs(T,{flexDir:"column",layerStyle:"first",borderRadius:"base",p:2,gap:2,children:[i.jsxs(T,{gap:2,children:[e||t?i.jsxs(Qn,{w:28,orientation:"vertical",size:"sm",children:[t?i.jsx(lDe,{}):i.jsx(i.Fragment,{}),e?i.jsx(sDe,{}):i.jsx(i.Fragment,{})]}):i.jsx(i.Fragment,{}),i.jsxs(Qn,{w:28,orientation:"vertical",size:"sm",children:[i.jsx(rDe,{}),n&&i.jsx(eDe,{}),!n&&i.jsx(WZ,{})]})]}),i.jsx(QLe,{})]})},dDe=c.memo(cDe),uDe=()=>{const e=Bt("invocationCache"),t=A(On);return i.jsxs(T,{display:t==="queue"?void 0:"none",hidden:t!=="queue",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:2,children:[i.jsxs(T,{gap:2,w:"full",children:[i.jsx(dDe,{}),i.jsx(YLe,{}),e&&i.jsx(aPe,{})]}),i.jsx(Ce,{layerStyle:"first",p:2,borderRadius:"base",w:"full",h:"full",children:i.jsx(KLe,{})})]})},hDe=c.memo(uDe),pDe=()=>i.jsx(T,{layerStyle:"body",w:"full",h:"full",children:i.jsx(hDe,{})}),fDe=c.memo(pDe);var w3=1,mDe=.9,gDe=.8,xDe=.17,P2=.1,L2=.999,yDe=.9999,bDe=.99,vDe=/[\\\/_+.#"@\[\(\{&]/,CDe=/[\\\/_+.#"@\[\(\{&]/g,wDe=/[\s-]/,UZ=/[\s-]/g;function cS(e,t,n,s,o,r,a){if(r===t.length)return o===e.length?w3:bDe;var l=`${o},${r}`;if(a[l]!==void 0)return a[l];for(var d=s.charAt(r),u=n.indexOf(d,o),h=0,p,f,m,g;u>=0;)p=cS(e,t,n,s,u+1,r+1,a),p>h&&(u===o?p*=w3:vDe.test(e.charAt(u-1))?(p*=gDe,m=e.slice(o,u-1).match(CDe),m&&o>0&&(p*=Math.pow(L2,m.length))):wDe.test(e.charAt(u-1))?(p*=mDe,g=e.slice(o,u-1).match(UZ),g&&o>0&&(p*=Math.pow(L2,g.length))):(p*=xDe,o>0&&(p*=Math.pow(L2,u-o))),e.charAt(u)!==t.charAt(r)&&(p*=yDe)),(p<P2&&n.charAt(u-1)===s.charAt(r+1)||s.charAt(r+1)===s.charAt(r)&&n.charAt(u-1)!==s.charAt(r))&&(f=cS(e,t,n,s,u+1,r+2,a),f*P2>p&&(p=f*P2)),p>h&&(h=p),u=n.indexOf(d,u+1);return a[l]=h,h}function S3(e){return e.toLowerCase().replace(UZ," ")}function SDe(e,t,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,cS(e,t,S3(e),S3(t),0,0,{})}function qa(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e==null||e(o),n===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function k3(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function pc(...e){return t=>{let n=!1;const s=e.map(o=>{const r=k3(o,t);return!n&&typeof r=="function"&&(n=!0),r});if(n)return()=>{for(let o=0;o<s.length;o++){const r=s[o];typeof r=="function"?r():k3(e[o],null)}}}}function Gc(...e){return c.useCallback(pc(...e),e)}function kDe(e,t){const n=c.createContext(t),s=r=>{const{children:a,...l}=r,d=c.useMemo(()=>l,Object.values(l));return i.jsx(n.Provider,{value:d,children:a})};s.displayName=e+"Provider";function o(r){const a=c.useContext(n);if(a)return a;if(t!==void 0)return t;throw new Error(`\`${r}\` must be used within \`${e}\``)}return[s,o]}function jDe(e,t=[]){let n=[];function s(r,a){const l=c.createContext(a),d=n.length;n=[...n,a];const u=p=>{var C;const{scope:f,children:m,...g}=p,x=((C=f==null?void 0:f[e])==null?void 0:C[d])||l,b=c.useMemo(()=>g,Object.values(g));return i.jsx(x.Provider,{value:b,children:m})};u.displayName=r+"Provider";function h(p,f){var x;const m=((x=f==null?void 0:f[e])==null?void 0:x[d])||l,g=c.useContext(m);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${p}\` must be used within \`${r}\``)}return[u,h]}const o=()=>{const r=n.map(a=>c.createContext(a));return function(l){const d=(l==null?void 0:l[e])||r;return c.useMemo(()=>({[`__scope${e}`]:{...l,[e]:d}}),[l,d])}};return o.scopeName=e,[s,_De(o,...t)]}function _De(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const s=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(r){const a=s.reduce((l,{useScope:d,scopeName:u})=>{const p=d(r)[`__scope${u}`];return{...l,...p}},{});return c.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}var Sx=globalThis!=null&&globalThis.document?c.useLayoutEffect:()=>{},IDe=gL[" useId ".trim().toString()]||(()=>{}),TDe=0;function ta(e){const[t,n]=c.useState(IDe());return Sx(()=>{n(s=>s??String(TDe++))},[e]),t?`radix-${t}`:""}function fc(e){const t=c.useRef(e);return c.useEffect(()=>{t.current=e}),c.useMemo(()=>(...n)=>{var s;return(s=t.current)==null?void 0:s.call(t,...n)},[])}function ADe({prop:e,defaultProp:t,onChange:n=()=>{}}){const[s,o]=MDe({defaultProp:t,onChange:n}),r=e!==void 0,a=r?e:s,l=fc(n),d=c.useCallback(u=>{if(r){const p=typeof u=="function"?u(e):u;p!==e&&l(p)}else o(u)},[r,e,o,l]);return[a,d]}function MDe({defaultProp:e,onChange:t}){const n=c.useState(e),[s]=n,o=c.useRef(s),r=fc(t);return c.useEffect(()=>{o.current!==s&&(r(s),o.current=s)},[s,o,r]),n}function qZ(e){const t=EDe(e),n=c.forwardRef((s,o)=>{const{children:r,...a}=s,l=c.Children.toArray(r),d=l.find(LDe);if(d){const u=d.props.children,h=l.map(p=>p===d?c.Children.count(u)>1?c.Children.only(null):c.isValidElement(u)?u.props.children:null:p);return i.jsx(t,{...a,ref:o,children:c.isValidElement(u)?c.cloneElement(u,void 0,h):null})}return i.jsx(t,{...a,ref:o,children:r})});return n.displayName=`${e}.Slot`,n}function EDe(e){const t=c.forwardRef((n,s)=>{const{children:o,...r}=n;if(c.isValidElement(o)){const a=RDe(o),l=DDe(r,o.props);return o.type!==c.Fragment&&(l.ref=s?pc(s,a):a),c.cloneElement(o,l)}return c.Children.count(o)>1?c.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var PDe=Symbol("radix.slottable");function LDe(e){return c.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===PDe}function DDe(e,t){const n={...t};for(const s in t){const o=e[s],r=t[s];/^on[A-Z]/.test(s)?o&&r?n[s]=(...l)=>{r(...l),o(...l)}:o&&(n[s]=o):s==="style"?n[s]={...o,...r}:s==="className"&&(n[s]=[o,r].filter(Boolean).join(" "))}return{...e,...n}}function RDe(e){var s,o;let t=(s=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:s.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var ODe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ks=ODe.reduce((e,t)=>{const n=qZ(`Primitive.${t}`),s=c.forwardRef((o,r)=>{const{asChild:a,...l}=o,d=a?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(d,{...l,ref:r})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{});function NDe(e,t){e&&wu.flushSync(()=>e.dispatchEvent(t))}function FDe(e,t=globalThis==null?void 0:globalThis.document){const n=fc(e);c.useEffect(()=>{const s=o=>{o.key==="Escape"&&n(o)};return t.addEventListener("keydown",s,{capture:!0}),()=>t.removeEventListener("keydown",s,{capture:!0})},[n,t])}var BDe="DismissableLayer",dS="dismissableLayer.update",$De="dismissableLayer.pointerDownOutside",VDe="dismissableLayer.focusOutside",j3,KZ=c.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ZZ=c.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:r,onInteractOutside:a,onDismiss:l,...d}=e,u=c.useContext(KZ),[h,p]=c.useState(null),f=(h==null?void 0:h.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,m]=c.useState({}),g=Gc(t,P=>p(P)),x=Array.from(u.layers),[b]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),C=x.indexOf(b),y=h?x.indexOf(h):-1,v=u.layersWithOutsidePointerEventsDisabled.size>0,w=y>=C,k=HDe(P=>{const E=P.target,L=[...u.branches].some(I=>I.contains(E));!w||L||(o==null||o(P),a==null||a(P),P.defaultPrevented||l==null||l())},f),S=WDe(P=>{const E=P.target;[...u.branches].some(I=>I.contains(E))||(r==null||r(P),a==null||a(P),P.defaultPrevented||l==null||l())},f);return FDe(P=>{y===u.layers.size-1&&(s==null||s(P),!P.defaultPrevented&&l&&(P.preventDefault(),l()))},f),c.useEffect(()=>{if(h)return n&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(j3=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),_3(),()=>{n&&u.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=j3)}},[h,f,n,u]),c.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),_3())},[h,u]),c.useEffect(()=>{const P=()=>m({});return document.addEventListener(dS,P),()=>document.removeEventListener(dS,P)},[]),i.jsx(ks.div,{...d,ref:g,style:{pointerEvents:v?w?"auto":"none":void 0,...e.style},onFocusCapture:qa(e.onFocusCapture,S.onFocusCapture),onBlurCapture:qa(e.onBlurCapture,S.onBlurCapture),onPointerDownCapture:qa(e.onPointerDownCapture,k.onPointerDownCapture)})});ZZ.displayName=BDe;var zDe="DismissableLayerBranch",GDe=c.forwardRef((e,t)=>{const n=c.useContext(KZ),s=c.useRef(null),o=Gc(t,s);return c.useEffect(()=>{const r=s.current;if(r)return n.branches.add(r),()=>{n.branches.delete(r)}},[n.branches]),i.jsx(ks.div,{...e,ref:o})});GDe.displayName=zDe;function HDe(e,t=globalThis==null?void 0:globalThis.document){const n=fc(e),s=c.useRef(!1),o=c.useRef(()=>{});return c.useEffect(()=>{const r=l=>{if(l.target&&!s.current){let d=function(){YZ($De,n,u,{discrete:!0})};const u={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=d,t.addEventListener("click",o.current,{once:!0})):d()}else t.removeEventListener("click",o.current);s.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",r),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>s.current=!0}}function WDe(e,t=globalThis==null?void 0:globalThis.document){const n=fc(e),s=c.useRef(!1);return c.useEffect(()=>{const o=r=>{r.target&&!s.current&&YZ(VDe,n,{originalEvent:r},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function _3(){const e=new CustomEvent(dS);document.dispatchEvent(e)}function YZ(e,t,n,{discrete:s}){const o=n.originalEvent.target,r=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),s?NDe(o,r):o.dispatchEvent(r)}var D2="focusScope.autoFocusOnMount",R2="focusScope.autoFocusOnUnmount",I3={bubbles:!1,cancelable:!0},UDe="FocusScope",XZ=c.forwardRef((e,t)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:o,onUnmountAutoFocus:r,...a}=e,[l,d]=c.useState(null),u=fc(o),h=fc(r),p=c.useRef(null),f=Gc(t,x=>d(x)),m=c.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;c.useEffect(()=>{if(s){let x=function(v){if(m.paused||!l)return;const w=v.target;l.contains(w)?p.current=w:ja(p.current,{select:!0})},b=function(v){if(m.paused||!l)return;const w=v.relatedTarget;w!==null&&(l.contains(w)||ja(p.current,{select:!0}))},C=function(v){if(document.activeElement===document.body)for(const k of v)k.removedNodes.length>0&&ja(l)};document.addEventListener("focusin",x),document.addEventListener("focusout",b);const y=new MutationObserver(C);return l&&y.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",b),y.disconnect()}}},[s,l,m.paused]),c.useEffect(()=>{if(l){A3.add(m);const x=document.activeElement;if(!l.contains(x)){const C=new CustomEvent(D2,I3);l.addEventListener(D2,u),l.dispatchEvent(C),C.defaultPrevented||(qDe(QDe(QZ(l)),{select:!0}),document.activeElement===x&&ja(l))}return()=>{l.removeEventListener(D2,u),setTimeout(()=>{const C=new CustomEvent(R2,I3);l.addEventListener(R2,h),l.dispatchEvent(C),C.defaultPrevented||ja(x??document.body,{select:!0}),l.removeEventListener(R2,h),A3.remove(m)},0)}}},[l,u,h,m]);const g=c.useCallback(x=>{if(!n&&!s||m.paused)return;const b=x.key==="Tab"&&!x.altKey&&!x.ctrlKey&&!x.metaKey,C=document.activeElement;if(b&&C){const y=x.currentTarget,[v,w]=KDe(y);v&&w?!x.shiftKey&&C===w?(x.preventDefault(),n&&ja(v,{select:!0})):x.shiftKey&&C===v&&(x.preventDefault(),n&&ja(w,{select:!0})):C===y&&x.preventDefault()}},[n,s,m.paused]);return i.jsx(ks.div,{tabIndex:-1,...a,ref:f,onKeyDown:g})});XZ.displayName=UDe;function qDe(e,{select:t=!1}={}){const n=document.activeElement;for(const s of e)if(ja(s,{select:t}),document.activeElement!==n)return}function KDe(e){const t=QZ(e),n=T3(t,e),s=T3(t.reverse(),e);return[n,s]}function QZ(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const o=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||o?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function T3(e,t){for(const n of e)if(!ZDe(n,{upTo:t}))return n}function ZDe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function YDe(e){return e instanceof HTMLInputElement&&"select"in e}function ja(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&YDe(e)&&t&&e.select()}}var A3=XDe();function XDe(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=M3(e,t),e.unshift(t)},remove(t){var n;e=M3(e,t),(n=e[0])==null||n.resume()}}}function M3(e,t){const n=[...e],s=n.indexOf(t);return s!==-1&&n.splice(s,1),n}function QDe(e){return e.filter(t=>t.tagName!=="A")}var JDe="Portal",JZ=c.forwardRef((e,t)=>{var l;const{container:n,...s}=e,[o,r]=c.useState(!1);Sx(()=>r(!0),[]);const a=n||o&&((l=globalThis==null?void 0:globalThis.document)==null?void 0:l.body);return a?xD.createPortal(i.jsx(ks.div,{...s,ref:t}),a):null});JZ.displayName=JDe;function eRe(e,t){return c.useReducer((n,s)=>t[n][s]??n,e)}var Lb=e=>{const{present:t,children:n}=e,s=tRe(t),o=typeof n=="function"?n({present:s.isPresent}):c.Children.only(n),r=Gc(s.ref,nRe(o));return typeof n=="function"||s.isPresent?c.cloneElement(o,{ref:r}):null};Lb.displayName="Presence";function tRe(e){const[t,n]=c.useState(),s=c.useRef({}),o=c.useRef(e),r=c.useRef("none"),a=e?"mounted":"unmounted",[l,d]=eRe(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return c.useEffect(()=>{const u=h0(s.current);r.current=l==="mounted"?u:"none"},[l]),Sx(()=>{const u=s.current,h=o.current;if(h!==e){const f=r.current,m=h0(u);e?d("MOUNT"):m==="none"||(u==null?void 0:u.display)==="none"?d("UNMOUNT"):d(h&&f!==m?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,d]),Sx(()=>{if(t){let u;const h=t.ownerDocument.defaultView??window,p=m=>{const x=h0(s.current).includes(m.animationName);if(m.target===t&&x&&(d("ANIMATION_END"),!o.current)){const b=t.style.animationFillMode;t.style.animationFillMode="forwards",u=h.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=b)})}},f=m=>{m.target===t&&(r.current=h0(s.current))};return t.addEventListener("animationstart",f),t.addEventListener("animationcancel",p),t.addEventListener("animationend",p),()=>{h.clearTimeout(u),t.removeEventListener("animationstart",f),t.removeEventListener("animationcancel",p),t.removeEventListener("animationend",p)}}else d("ANIMATION_END")},[t,d]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:c.useCallback(u=>{u&&(s.current=getComputedStyle(u)),n(u)},[])}}function h0(e){return(e==null?void 0:e.animationName)||"none"}function nRe(e){var s,o;let t=(s=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:s.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var O2=0;function sRe(){c.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??E3()),document.body.insertAdjacentElement("beforeend",e[1]??E3()),O2++,()=>{O2===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),O2--}},[])}function E3(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var H0="right-scroll-bar-position",W0="width-before-scroll-bar",iRe="with-scroll-bars-hidden",oRe="--removed-body-scroll-bar-size";function N2(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function rRe(e,t){var n=c.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(s){var o=n.value;o!==s&&(n.value=s,n.callback(s,o))}}}})[0];return n.callback=t,n.facade}var aRe=typeof window<"u"?c.useLayoutEffect:c.useEffect,P3=new WeakMap;function lRe(e,t){var n=rRe(null,function(s){return e.forEach(function(o){return N2(o,s)})});return aRe(function(){var s=P3.get(n);if(s){var o=new Set(s),r=new Set(e),a=n.current;o.forEach(function(l){r.has(l)||N2(l,null)}),r.forEach(function(l){o.has(l)||N2(l,a)})}P3.set(n,e)},[e]),n}function cRe(e){return e}function dRe(e,t){t===void 0&&(t=cRe);var n=[],s=!1,o={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(r){var a=t(r,s);return n.push(a),function(){n=n.filter(function(l){return l!==a})}},assignSyncMedium:function(r){for(s=!0;n.length;){var a=n;n=[],a.forEach(r)}n={push:function(l){return r(l)},filter:function(){return n}}},assignMedium:function(r){s=!0;var a=[];if(n.length){var l=n;n=[],l.forEach(r),a=n}var d=function(){var h=a;a=[],h.forEach(r)},u=function(){return Promise.resolve().then(d)};u(),n={push:function(h){a.push(h),u()},filter:function(h){return a=a.filter(h),n}}}};return o}function uRe(e){e===void 0&&(e={});var t=dRe(null);return t.options=Jo({async:!0,ssr:!1},e),t}var eY=function(e){var t=e.sideCar,n=QO(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return c.createElement(s,Jo({},n))};eY.isSideCarExport=!0;function hRe(e,t){return e.useMedium(t),eY}var tY=uRe(),F2=function(){},Db=c.forwardRef(function(e,t){var n=c.useRef(null),s=c.useState({onScrollCapture:F2,onWheelCapture:F2,onTouchMoveCapture:F2}),o=s[0],r=s[1],a=e.forwardProps,l=e.children,d=e.className,u=e.removeScrollBar,h=e.enabled,p=e.shards,f=e.sideCar,m=e.noIsolation,g=e.inert,x=e.allowPinchZoom,b=e.as,C=b===void 0?"div":b,y=e.gapMode,v=QO(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=f,k=lRe([n,t]),S=Jo(Jo({},v),o);return c.createElement(c.Fragment,null,h&&c.createElement(w,{sideCar:tY,removeScrollBar:u,shards:p,noIsolation:m,inert:g,setCallbacks:r,allowPinchZoom:!!x,lockRef:n,gapMode:y}),a?c.cloneElement(c.Children.only(l),Jo(Jo({},S),{ref:k})):c.createElement(C,Jo({},S,{className:d,ref:k}),l))});Db.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Db.classNames={fullWidth:W0,zeroRight:H0};var pRe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function fRe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=pRe();return t&&e.setAttribute("nonce",t),e}function mRe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function gRe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var xRe=function(){var e=0,t=null;return{add:function(n){e==0&&(t=fRe())&&(mRe(t,n),gRe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},yRe=function(){var e=xRe();return function(t,n){c.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},nY=function(){var e=yRe(),t=function(n){var s=n.styles,o=n.dynamic;return e(s,o),null};return t},bRe={left:0,top:0,right:0,gap:0},B2=function(e){return parseInt(e||"",10)||0},vRe=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[B2(n),B2(s),B2(o)]},CRe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return bRe;var t=vRe(e),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-n+t[2]-t[0])}},wRe=nY(),Wd="data-scroll-locked",SRe=function(e,t,n,s){var o=e.left,r=e.top,a=e.right,l=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(iRe,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(Wd,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(r,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(H0,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(W0,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(H0," .").concat(H0,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(W0," .").concat(W0,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(Wd,`] {
    `).concat(oRe,": ").concat(l,`px;
  }
`)},L3=function(){var e=parseInt(document.body.getAttribute(Wd)||"0",10);return isFinite(e)?e:0},kRe=function(){c.useEffect(function(){return document.body.setAttribute(Wd,(L3()+1).toString()),function(){var e=L3()-1;e<=0?document.body.removeAttribute(Wd):document.body.setAttribute(Wd,e.toString())}},[])},jRe=function(e){var t=e.noRelative,n=e.noImportant,s=e.gapMode,o=s===void 0?"margin":s;kRe();var r=c.useMemo(function(){return CRe(o)},[o]);return c.createElement(wRe,{styles:SRe(r,!t,o,n?"":"!important")})},uS=!1;if(typeof window<"u")try{var p0=Object.defineProperty({},"passive",{get:function(){return uS=!0,!0}});window.addEventListener("test",p0,p0),window.removeEventListener("test",p0,p0)}catch{uS=!1}var sd=uS?{passive:!1}:!1,_Re=function(e){return e.tagName==="TEXTAREA"},sY=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!_Re(e)&&n[t]==="visible")},IRe=function(e){return sY(e,"overflowY")},TRe=function(e){return sY(e,"overflowX")},D3=function(e,t){var n=t.ownerDocument,s=t;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var o=iY(e,s);if(o){var r=oY(e,s),a=r[1],l=r[2];if(a>l)return!0}s=s.parentNode}while(s&&s!==n.body);return!1},ARe=function(e){var t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[t,n,s]},MRe=function(e){var t=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[t,n,s]},iY=function(e,t){return e==="v"?IRe(t):TRe(t)},oY=function(e,t){return e==="v"?ARe(t):MRe(t)},ERe=function(e,t){return e==="h"&&t==="rtl"?-1:1},PRe=function(e,t,n,s,o){var r=ERe(e,window.getComputedStyle(t).direction),a=r*s,l=n.target,d=t.contains(l),u=!1,h=a>0,p=0,f=0;do{var m=oY(e,l),g=m[0],x=m[1],b=m[2],C=x-b-r*g;(g||C)&&iY(e,l)&&(p+=C,f+=g),l instanceof ShadowRoot?l=l.host:l=l.parentNode}while(!d&&l!==document.body||d&&(t.contains(l)||t===l));return(h&&Math.abs(p)<1||!h&&Math.abs(f)<1)&&(u=!0),u},f0=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},R3=function(e){return[e.deltaX,e.deltaY]},O3=function(e){return e&&"current"in e?e.current:e},LRe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},DRe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},RRe=0,id=[];function ORe(e){var t=c.useRef([]),n=c.useRef([0,0]),s=c.useRef(),o=c.useState(RRe++)[0],r=c.useState(nY)[0],a=c.useRef(e);c.useEffect(function(){a.current=e},[e]),c.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var x=L1e([e.lockRef.current],(e.shards||[]).map(O3),!0).filter(Boolean);return x.forEach(function(b){return b.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),x.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var l=c.useCallback(function(x,b){if("touches"in x&&x.touches.length===2||x.type==="wheel"&&x.ctrlKey)return!a.current.allowPinchZoom;var C=f0(x),y=n.current,v="deltaX"in x?x.deltaX:y[0]-C[0],w="deltaY"in x?x.deltaY:y[1]-C[1],k,S=x.target,P=Math.abs(v)>Math.abs(w)?"h":"v";if("touches"in x&&P==="h"&&S.type==="range")return!1;var E=D3(P,S);if(!E)return!0;if(E?k=P:(k=P==="v"?"h":"v",E=D3(P,S)),!E)return!1;if(!s.current&&"changedTouches"in x&&(v||w)&&(s.current=k),!k)return!0;var L=s.current||k;return PRe(L,b,x,L==="h"?v:w)},[]),d=c.useCallback(function(x){var b=x;if(!(!id.length||id[id.length-1]!==r)){var C="deltaY"in b?R3(b):f0(b),y=t.current.filter(function(k){return k.name===b.type&&(k.target===b.target||b.target===k.shadowParent)&&LRe(k.delta,C)})[0];if(y&&y.should){b.cancelable&&b.preventDefault();return}if(!y){var v=(a.current.shards||[]).map(O3).filter(Boolean).filter(function(k){return k.contains(b.target)}),w=v.length>0?l(b,v[0]):!a.current.noIsolation;w&&b.cancelable&&b.preventDefault()}}},[]),u=c.useCallback(function(x,b,C,y){var v={name:x,delta:b,target:C,should:y,shadowParent:NRe(C)};t.current.push(v),setTimeout(function(){t.current=t.current.filter(function(w){return w!==v})},1)},[]),h=c.useCallback(function(x){n.current=f0(x),s.current=void 0},[]),p=c.useCallback(function(x){u(x.type,R3(x),x.target,l(x,e.lockRef.current))},[]),f=c.useCallback(function(x){u(x.type,f0(x),x.target,l(x,e.lockRef.current))},[]);c.useEffect(function(){return id.push(r),e.setCallbacks({onScrollCapture:p,onWheelCapture:p,onTouchMoveCapture:f}),document.addEventListener("wheel",d,sd),document.addEventListener("touchmove",d,sd),document.addEventListener("touchstart",h,sd),function(){id=id.filter(function(x){return x!==r}),document.removeEventListener("wheel",d,sd),document.removeEventListener("touchmove",d,sd),document.removeEventListener("touchstart",h,sd)}},[]);var m=e.removeScrollBar,g=e.inert;return c.createElement(c.Fragment,null,g?c.createElement(r,{styles:DRe(o)}):null,m?c.createElement(jRe,{gapMode:e.gapMode}):null)}function NRe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const FRe=hRe(tY,ORe);var rY=c.forwardRef(function(e,t){return c.createElement(Db,Jo({},e,{ref:t,sideCar:FRe}))});rY.classNames=Db.classNames;var BRe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},od=new WeakMap,m0=new WeakMap,g0={},$2=0,aY=function(e){return e&&(e.host||aY(e.parentNode))},$Re=function(e,t){return t.map(function(n){if(e.contains(n))return n;var s=aY(n);return s&&e.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},VRe=function(e,t,n,s){var o=$Re(t,Array.isArray(e)?e:[e]);g0[n]||(g0[n]=new WeakMap);var r=g0[n],a=[],l=new Set,d=new Set(o),u=function(p){!p||l.has(p)||(l.add(p),u(p.parentNode))};o.forEach(u);var h=function(p){!p||d.has(p)||Array.prototype.forEach.call(p.children,function(f){if(l.has(f))h(f);else try{var m=f.getAttribute(s),g=m!==null&&m!=="false",x=(od.get(f)||0)+1,b=(r.get(f)||0)+1;od.set(f,x),r.set(f,b),a.push(f),x===1&&g&&m0.set(f,!0),b===1&&f.setAttribute(n,"true"),g||f.setAttribute(s,"true")}catch(C){console.error("aria-hidden: cannot operate on ",f,C)}})};return h(t),l.clear(),$2++,function(){a.forEach(function(p){var f=od.get(p)-1,m=r.get(p)-1;od.set(p,f),r.set(p,m),f||(m0.has(p)||p.removeAttribute(s),m0.delete(p)),m||p.removeAttribute(n)}),$2--,$2||(od=new WeakMap,od=new WeakMap,m0=new WeakMap,g0={})}},zRe=function(e,t,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),o=BRe(e);return o?(s.push.apply(s,Array.from(o.querySelectorAll("[aria-live]"))),VRe(s,o,n,"aria-hidden")):function(){return null}},n4="Dialog",[lY,OFe]=jDe(n4),[GRe,Bo]=lY(n4),cY=e=>{const{__scopeDialog:t,children:n,open:s,defaultOpen:o,onOpenChange:r,modal:a=!0}=e,l=c.useRef(null),d=c.useRef(null),[u=!1,h]=ADe({prop:s,defaultProp:o,onChange:r});return i.jsx(GRe,{scope:t,triggerRef:l,contentRef:d,contentId:ta(),titleId:ta(),descriptionId:ta(),open:u,onOpenChange:h,onOpenToggle:c.useCallback(()=>h(p=>!p),[h]),modal:a,children:n})};cY.displayName=n4;var dY="DialogTrigger",HRe=c.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=Bo(dY,n),r=Gc(t,o.triggerRef);return i.jsx(ks.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":o4(o.open),...s,ref:r,onClick:qa(e.onClick,o.onOpenToggle)})});HRe.displayName=dY;var s4="DialogPortal",[WRe,uY]=lY(s4,{forceMount:void 0}),hY=e=>{const{__scopeDialog:t,forceMount:n,children:s,container:o}=e,r=Bo(s4,t);return i.jsx(WRe,{scope:t,forceMount:n,children:c.Children.map(s,a=>i.jsx(Lb,{present:n||r.open,children:i.jsx(JZ,{asChild:!0,container:o,children:a})}))})};hY.displayName=s4;var kx="DialogOverlay",pY=c.forwardRef((e,t)=>{const n=uY(kx,e.__scopeDialog),{forceMount:s=n.forceMount,...o}=e,r=Bo(kx,e.__scopeDialog);return r.modal?i.jsx(Lb,{present:s||r.open,children:i.jsx(qRe,{...o,ref:t})}):null});pY.displayName=kx;var URe=qZ("DialogOverlay.RemoveScroll"),qRe=c.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=Bo(kx,n);return i.jsx(rY,{as:URe,allowPinchZoom:!0,shards:[o.contentRef],children:i.jsx(ks.div,{"data-state":o4(o.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),mc="DialogContent",fY=c.forwardRef((e,t)=>{const n=uY(mc,e.__scopeDialog),{forceMount:s=n.forceMount,...o}=e,r=Bo(mc,e.__scopeDialog);return i.jsx(Lb,{present:s||r.open,children:r.modal?i.jsx(KRe,{...o,ref:t}):i.jsx(ZRe,{...o,ref:t})})});fY.displayName=mc;var KRe=c.forwardRef((e,t)=>{const n=Bo(mc,e.__scopeDialog),s=c.useRef(null),o=Gc(t,n.contentRef,s);return c.useEffect(()=>{const r=s.current;if(r)return zRe(r)},[]),i.jsx(mY,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:qa(e.onCloseAutoFocus,r=>{var a;r.preventDefault(),(a=n.triggerRef.current)==null||a.focus()}),onPointerDownOutside:qa(e.onPointerDownOutside,r=>{const a=r.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&r.preventDefault()}),onFocusOutside:qa(e.onFocusOutside,r=>r.preventDefault())})}),ZRe=c.forwardRef((e,t)=>{const n=Bo(mc,e.__scopeDialog),s=c.useRef(!1),o=c.useRef(!1);return i.jsx(mY,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{var a,l;(a=e.onCloseAutoFocus)==null||a.call(e,r),r.defaultPrevented||(s.current||(l=n.triggerRef.current)==null||l.focus(),r.preventDefault()),s.current=!1,o.current=!1},onInteractOutside:r=>{var d,u;(d=e.onInteractOutside)==null||d.call(e,r),r.defaultPrevented||(s.current=!0,r.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const a=r.target;((u=n.triggerRef.current)==null?void 0:u.contains(a))&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&o.current&&r.preventDefault()}})}),mY=c.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:r,...a}=e,l=Bo(mc,n),d=c.useRef(null),u=Gc(t,d);return sRe(),i.jsxs(i.Fragment,{children:[i.jsx(XZ,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:o,onUnmountAutoFocus:r,children:i.jsx(ZZ,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":o4(l.open),...a,ref:u,onDismiss:()=>l.onOpenChange(!1)})}),i.jsxs(i.Fragment,{children:[i.jsx(JRe,{titleId:l.titleId}),i.jsx(t7e,{contentRef:d,descriptionId:l.descriptionId})]})]})}),i4="DialogTitle",YRe=c.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=Bo(i4,n);return i.jsx(ks.h2,{id:o.titleId,...s,ref:t})});YRe.displayName=i4;var gY="DialogDescription",XRe=c.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=Bo(gY,n);return i.jsx(ks.p,{id:o.descriptionId,...s,ref:t})});XRe.displayName=gY;var xY="DialogClose",QRe=c.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,o=Bo(xY,n);return i.jsx(ks.button,{type:"button",...s,ref:t,onClick:qa(e.onClick,()=>o.onOpenChange(!1))})});QRe.displayName=xY;function o4(e){return e?"open":"closed"}var yY="DialogTitleWarning",[NFe,bY]=kDe(yY,{contentName:mc,titleName:i4,docsSlug:"dialog"}),JRe=({titleId:e})=>{const t=bY(yY),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return c.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},e7e="DialogDescriptionWarning",t7e=({contentRef:e,descriptionId:t})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${bY(e7e).contentName}}.`;return c.useEffect(()=>{var r;const o=(r=e.current)==null?void 0:r.getAttribute("aria-describedby");t&&o&&(document.getElementById(t)||console.warn(s))},[s,e,t]),null},n7e=cY,s7e=hY,i7e=pY,o7e=fY,Cp='[cmdk-group=""]',V2='[cmdk-group-items=""]',r7e='[cmdk-group-heading=""]',vY='[cmdk-item=""]',N3=`${vY}:not([aria-disabled="true"])`,hS="cmdk-item-select",fd="data-value",a7e=(e,t,n)=>SDe(e,t,n),CY=c.createContext(void 0),fg=()=>c.useContext(CY),wY=c.createContext(void 0),r4=()=>c.useContext(wY),SY=c.createContext(void 0),a4=c.forwardRef((e,t)=>{let n=md(()=>{var H,z;return{search:"",value:(z=(H=e.value)!=null?H:e.defaultValue)!=null?z:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),s=md(()=>new Set),o=md(()=>new Map),r=md(()=>new Map),a=md(()=>new Set),l=IY(e),{label:d,children:u,value:h,onValueChange:p,filter:f,shouldFilter:m,loop:g,disablePointerSelection:x=!1,vimBindings:b=!0,...C}=e,y=ta(),v=ta(),w=ta(),k=c.useRef(null),S=m7e();gc(()=>{if(h!==void 0){let H=h.trim();n.current.value=H,P.emit()}},[h]),gc(()=>{S(6,_)},[]);let P=c.useMemo(()=>({subscribe:H=>(a.current.add(H),()=>a.current.delete(H)),snapshot:()=>n.current,setState:(H,z,Z)=>{var U,Y,$,F;if(!Object.is(n.current[H],z)){if(n.current[H]=z,H==="search")N(),I(),S(1,O);else if(H==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let q=document.getElementById(w);q?q.focus():(U=document.getElementById(y))==null||U.focus()}if(S(7,()=>{var q;n.current.selectedItemId=(q=R())==null?void 0:q.id,P.emit()}),Z||S(5,_),((Y=l.current)==null?void 0:Y.value)!==void 0){let q=z??"";(F=($=l.current).onValueChange)==null||F.call($,q);return}}P.emit()}},emit:()=>{a.current.forEach(H=>H())}}),[]),E=c.useMemo(()=>({value:(H,z,Z)=>{var U;z!==((U=r.current.get(H))==null?void 0:U.value)&&(r.current.set(H,{value:z,keywords:Z}),n.current.filtered.items.set(H,L(z,Z)),S(2,()=>{I(),P.emit()}))},item:(H,z)=>(s.current.add(H),z&&(o.current.has(z)?o.current.get(z).add(H):o.current.set(z,new Set([H]))),S(3,()=>{N(),I(),n.current.value||O(),P.emit()}),()=>{r.current.delete(H),s.current.delete(H),n.current.filtered.items.delete(H);let Z=R();S(4,()=>{N(),(Z==null?void 0:Z.getAttribute("id"))===H&&O(),P.emit()})}),group:H=>(o.current.has(H)||o.current.set(H,new Set),()=>{r.current.delete(H),o.current.delete(H)}),filter:()=>l.current.shouldFilter,label:d||e["aria-label"],getDisablePointerSelection:()=>l.current.disablePointerSelection,listId:y,inputId:w,labelId:v,listInnerRef:k}),[]);function L(H,z){var Z,U;let Y=(U=(Z=l.current)==null?void 0:Z.filter)!=null?U:a7e;return H?Y(H,n.current.search,z):0}function I(){if(!n.current.search||l.current.shouldFilter===!1)return;let H=n.current.filtered.items,z=[];n.current.filtered.groups.forEach(U=>{let Y=o.current.get(U),$=0;Y.forEach(F=>{let q=H.get(F);$=Math.max(q,$)}),z.push([U,$])});let Z=k.current;D().sort((U,Y)=>{var $,F;let q=U.getAttribute("id"),ie=Y.getAttribute("id");return(($=H.get(ie))!=null?$:0)-((F=H.get(q))!=null?F:0)}).forEach(U=>{let Y=U.closest(V2);Y?Y.appendChild(U.parentElement===Y?U:U.closest(`${V2} > *`)):Z.appendChild(U.parentElement===Z?U:U.closest(`${V2} > *`))}),z.sort((U,Y)=>Y[1]-U[1]).forEach(U=>{var Y;let $=(Y=k.current)==null?void 0:Y.querySelector(`${Cp}[${fd}="${encodeURIComponent(U[0])}"]`);$==null||$.parentElement.appendChild($)})}function O(){let H=D().find(Z=>Z.getAttribute("aria-disabled")!=="true"),z=H==null?void 0:H.getAttribute(fd);P.setState("value",z||void 0)}function N(){var H,z,Z,U;if(!n.current.search||l.current.shouldFilter===!1){n.current.filtered.count=s.current.size;return}n.current.filtered.groups=new Set;let Y=0;for(let $ of s.current){let F=(z=(H=r.current.get($))==null?void 0:H.value)!=null?z:"",q=(U=(Z=r.current.get($))==null?void 0:Z.keywords)!=null?U:[],ie=L(F,q);n.current.filtered.items.set($,ie),ie>0&&Y++}for(let[$,F]of o.current)for(let q of F)if(n.current.filtered.items.get(q)>0){n.current.filtered.groups.add($);break}n.current.filtered.count=Y}function _(){var H,z,Z;let U=R();U&&(((H=U.parentElement)==null?void 0:H.firstChild)===U&&((Z=(z=U.closest(Cp))==null?void 0:z.querySelector(r7e))==null||Z.scrollIntoView({block:"nearest"})),U.scrollIntoView({block:"nearest"}))}function R(){var H;return(H=k.current)==null?void 0:H.querySelector(`${vY}[aria-selected="true"]`)}function D(){var H;return Array.from(((H=k.current)==null?void 0:H.querySelectorAll(N3))||[])}function B(H){let z=D()[H];z&&P.setState("value",z.getAttribute(fd))}function V(H){var z;let Z=R(),U=D(),Y=U.findIndex(F=>F===Z),$=U[Y+H];(z=l.current)!=null&&z.loop&&($=Y+H<0?U[U.length-1]:Y+H===U.length?U[0]:U[Y+H]),$&&P.setState("value",$.getAttribute(fd))}function ee(H){let z=R(),Z=z==null?void 0:z.closest(Cp),U;for(;Z&&!U;)Z=H>0?p7e(Z,Cp):f7e(Z,Cp),U=Z==null?void 0:Z.querySelector(N3);U?P.setState("value",U.getAttribute(fd)):V(H)}let se=()=>B(D().length-1),oe=H=>{H.preventDefault(),H.metaKey?se():H.altKey?ee(1):V(1)},te=H=>{H.preventDefault(),H.metaKey?B(0):H.altKey?ee(-1):V(-1)};return c.createElement(ks.div,{ref:t,tabIndex:-1,...C,"cmdk-root":"",onKeyDown:H=>{var z;(z=C.onKeyDown)==null||z.call(C,H);let Z=H.nativeEvent.isComposing||H.keyCode===229;if(!(H.defaultPrevented||Z))switch(H.key){case"n":case"j":{b&&H.ctrlKey&&oe(H);break}case"ArrowDown":{oe(H);break}case"p":case"k":{b&&H.ctrlKey&&te(H);break}case"ArrowUp":{te(H);break}case"Home":{H.preventDefault(),B(0);break}case"End":{H.preventDefault(),se();break}case"Enter":{H.preventDefault();let U=R();if(U){let Y=new Event(hS);U.dispatchEvent(Y)}}}}},c.createElement("label",{"cmdk-label":"",htmlFor:E.inputId,id:E.labelId,style:x7e},d),Rb(e,H=>c.createElement(wY.Provider,{value:P},c.createElement(CY.Provider,{value:E},H))))}),kY=c.forwardRef((e,t)=>{var n,s;let o=ta(),r=c.useRef(null),a=c.useContext(SY),l=fg(),d=IY(e),u=(s=(n=d.current)==null?void 0:n.forceMount)!=null?s:a==null?void 0:a.forceMount;gc(()=>{if(!u)return l.item(o,a==null?void 0:a.id)},[u]);let h=TY(o,r,[e.value,e.children,r],e.keywords),p=r4(),f=il(S=>S.value&&S.value===h.current),m=il(S=>u||l.filter()===!1?!0:S.search?S.filtered.items.get(o)>0:!0);c.useEffect(()=>{let S=r.current;if(!(!S||e.disabled))return S.addEventListener(hS,g),()=>S.removeEventListener(hS,g)},[m,e.onSelect,e.disabled]);function g(){var S,P;x(),(P=(S=d.current).onSelect)==null||P.call(S,h.current)}function x(){p.setState("value",h.current,!0)}if(!m)return null;let{disabled:b,value:C,onSelect:y,forceMount:v,keywords:w,...k}=e;return c.createElement(ks.div,{ref:pc(r,t),...k,id:o,"cmdk-item":"",role:"option","aria-disabled":!!b,"aria-selected":!!f,"data-disabled":!!b,"data-selected":!!f,onPointerMove:b||l.getDisablePointerSelection()?void 0:x,onClick:b?void 0:g},e.children)}),l7e=c.forwardRef((e,t)=>{let{heading:n,children:s,forceMount:o,...r}=e,a=ta(),l=c.useRef(null),d=c.useRef(null),u=ta(),h=fg(),p=il(m=>o||h.filter()===!1?!0:m.search?m.filtered.groups.has(a):!0);gc(()=>h.group(a),[]),TY(a,l,[e.value,e.heading,d]);let f=c.useMemo(()=>({id:a,forceMount:o}),[o]);return c.createElement(ks.div,{ref:pc(l,t),...r,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},n&&c.createElement("div",{ref:d,"cmdk-group-heading":"","aria-hidden":!0,id:u},n),Rb(e,m=>c.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?u:void 0},c.createElement(SY.Provider,{value:f},m))))}),c7e=c.forwardRef((e,t)=>{let{alwaysRender:n,...s}=e,o=c.useRef(null),r=il(a=>!a.search);return!n&&!r?null:c.createElement(ks.div,{ref:pc(o,t),...s,"cmdk-separator":"",role:"separator"})}),d7e=c.forwardRef((e,t)=>{let{onValueChange:n,...s}=e,o=e.value!=null,r=r4(),a=il(u=>u.search),l=il(u=>u.selectedItemId),d=fg();return c.useEffect(()=>{e.value!=null&&r.setState("search",e.value)},[e.value]),c.createElement(ks.input,{ref:t,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":d.listId,"aria-labelledby":d.labelId,"aria-activedescendant":l,id:d.inputId,type:"text",value:o?e.value:a,onChange:u=>{o||r.setState("search",u.target.value),n==null||n(u.target.value)}})}),jY=c.forwardRef((e,t)=>{let{children:n,label:s="Suggestions",...o}=e,r=c.useRef(null),a=c.useRef(null),l=il(u=>u.selectedItemId),d=fg();return c.useEffect(()=>{if(a.current&&r.current){let u=a.current,h=r.current,p,f=new ResizeObserver(()=>{p=requestAnimationFrame(()=>{let m=u.offsetHeight;h.style.setProperty("--cmdk-list-height",m.toFixed(1)+"px")})});return f.observe(u),()=>{cancelAnimationFrame(p),f.unobserve(u)}}},[]),c.createElement(ks.div,{ref:pc(r,t),...o,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":l,"aria-label":s,id:d.listId},Rb(e,u=>c.createElement("div",{ref:pc(a,d.listInnerRef),"cmdk-list-sizer":""},u)))}),u7e=c.forwardRef((e,t)=>{let{open:n,onOpenChange:s,overlayClassName:o,contentClassName:r,container:a,...l}=e;return c.createElement(n7e,{open:n,onOpenChange:s},c.createElement(s7e,{container:a},c.createElement(i7e,{"cmdk-overlay":"",className:o}),c.createElement(o7e,{"aria-label":e.label,"cmdk-dialog":"",className:r},c.createElement(a4,{ref:t,...l}))))}),_Y=c.forwardRef((e,t)=>il(n=>n.filtered.count===0)?c.createElement(ks.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),h7e=c.forwardRef((e,t)=>{let{progress:n,children:s,label:o="Loading...",...r}=e;return c.createElement(ks.div,{ref:t,...r,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},Rb(e,a=>c.createElement("div",{"aria-hidden":!0},a)))});Object.assign(a4,{List:jY,Item:kY,Input:d7e,Group:l7e,Separator:c7e,Dialog:u7e,Empty:_Y,Loading:h7e});function p7e(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function f7e(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function IY(e){let t=c.useRef(e);return gc(()=>{t.current=e}),t}var gc=typeof window>"u"?c.useEffect:c.useLayoutEffect;function md(e){let t=c.useRef();return t.current===void 0&&(t.current=e()),t}function il(e){let t=r4(),n=()=>e(t.snapshot());return c.useSyncExternalStore(t.subscribe,n,n)}function TY(e,t,n,s=[]){let o=c.useRef(),r=fg();return gc(()=>{var a;let l=(()=>{var u;for(let h of n){if(typeof h=="string")return h.trim();if(typeof h=="object"&&"current"in h)return h.current?(u=h.current.textContent)==null?void 0:u.trim():o.current}})(),d=s.map(u=>u.trim());r.value(e,l,d),(a=t.current)==null||a.setAttribute(fd,l),o.current=l}),o}var m7e=()=>{let[e,t]=c.useState(),n=md(()=>new Map);return gc(()=>{n.current.forEach(s=>s()),n.current=new Map},[e]),(s,o)=>{n.current.set(s,o),t({})}};function g7e(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function Rb({asChild:e,children:t},n){return e&&c.isValidElement(t)?c.cloneElement(g7e(t),{ref:t.ref},n(t.props.children)):n(t)}var x7e={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const y7e=e=>{const t=of();return{...bD,id:t,type:"current_image",position:e,data:{id:t,type:"current_image",isOpen:!0,label:"Current Image"}}},b7e=e=>{const t=of();return{...bD,id:t,type:"notes",position:e,data:{id:t,isOpen:!0,label:"Notes",notes:"",type:"notes"}}},v7e=()=>{const e=re(ln);return c.useCallback(t=>{var d;const n=Op.get();ve(n!==null);let s=window.innerWidth/2,o=window.innerHeight/2;const r=(d=document.querySelector("#workflow-editor"))==null?void 0:d.getBoundingClientRect();r&&(s=r.width/2-mC/2+r.left,o=r.height/2-mC/2+r.top);const a=n.screenToFlowPosition({x:s,y:o});if(t==="current_image")return y7e(a);if(t==="notes")return b7e(a);const l=e[t];return ule(a,l)},[e])},AY=(e,t,n)=>{let s=t,o=n;for(;e.find(r=>r.position.x===s&&r.position.y===o);)s=Math.floor(s+50),o=Math.floor(o+50);return{x:s,y:o}},MY=(e,t)=>{const n="originalType"in e?na(e,"originalType"):e,s="originalType"in t?na(t,"originalType"):t,o="originalType"in e?e.originalType:null,r="originalType"in t?t.originalType:null;return!!(Vl(n,s)||r&&Vl(n,r)||o&&Vl(o,s)||o&&r&&Vl(o,r))},C7e=(e,t,n,s)=>{const o=n.find(d=>d.target===s&&d.targetHandle==="item");if(!(o!=null&&o.sourceHandle))return null;const r=t.find(d=>d.id===o.source);if(!r)return null;const a=e[r.data.type];if(!a)return null;const l=a.outputs[o.sourceHandle];return l?l.type:null};var w7e=hle();const F3=hu(w7e),S7e=(e,t,n,s)=>{const o=new F3.Graph;return n.forEach(r=>{o.setNode(r.id)}),s.forEach(r=>{o.setEdge(r.source,r.target)}),o.setEdge(e,t),!F3.alg.isAcyclic(o)},EY=(e,t)=>{if(MY(e,t))return!0;if(e.batch!==t.batch)return!1;const n=e.name==="CollectionItemField"&&!ad(t),s=kg(e)&&t.name==="CollectionItemField",o=Aa(t)&&e.name===t.name,r=e.name==="CollectionField"&&!kg(t),a=t.name==="CollectionField"&&ad(e),l=kg(e),d=kg(t),u=l&&d,h=l&&Aa(t),p=ad(e)&&ad(t),f=ad(e)&&Aa(t),m=Aa(e)&&Aa(t),g=u||p||f||m||h,x=e.name==="IntegerField"&&t.name==="FloatField",b=e.name==="IntegerField"&&t.name==="StringField",C=e.name==="FloatField"&&t.name==="StringField",y=g&&(x||b||C),v=t.name==="AnyField";return n||s||o||r||a||y||v},k7e=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle&&t.source===e.source&&t.sourceHandle===e.sourceHandle,j7e=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle,mg=(e,t,n,s,o,r=!0)=>{if(e.source===e.target)return"nodes.cannotConnectToSelf";if(r){const a=n.filter(m=>m.id!==(o==null?void 0:o.id));if(a.some(k7e(e)))return"nodes.cannotDuplicateConnection";const l=t.find(m=>m.id===e.source);if(!l)return"nodes.missingNode";const d=t.find(m=>m.id===e.target);if(!d)return"nodes.missingNode";const u=s[l.data.type];if(!u)return"nodes.missingInvocationTemplate";const h=s[d.data.type];if(!h)return"nodes.missingInvocationTemplate";const p=u.outputs[e.sourceHandle];if(!p)return"nodes.missingFieldTemplate";const f=h.inputs[e.targetHandle];if(!f)return"nodes.missingFieldTemplate";if(f.input==="direct")return"nodes.cannotConnectToDirectInput";if(d.data.type==="collect"&&e.targetHandle==="item"){const m=C7e(s,t,n,d.id);if(m&&!MY(p.type,m))return"nodes.cannotMixAndMatchCollectionItemTypes"}if(a.find(j7e(e))&&f.type.name!=="CollectionItemField")return"nodes.inputMayOnlyHaveOneConnection";if(!EY(p.type,f.type))return"nodes.fieldTypesMustMatch"}return S7e(e.source,e.target,t,n)?"nodes.connectionWouldCreateCycle":null},PY=(e,t,n,s,o,r,a,l)=>{if(e===n)return null;if(t&&s)return{source:e,sourceHandle:t,target:n,targetHandle:s};if(t&&!s){const u=_7e(e,t,n,o,r,a,l)[0];return u?{source:e,sourceHandle:t,target:n,targetHandle:u.name}:null}if(!t&&s){const u=I7e(n,s,e,o,r,a,l)[0];return u?{source:e,sourceHandle:u.name,target:n,targetHandle:s}:null}return null},_7e=(e,t,n,s,o,r,a)=>{const l=s.find(m=>m.id===e),d=s.find(m=>m.id===n);if(!l||!d)return[];const u=r[l.data.type],h=r[d.data.type];return!u||!h?[]:u.outputs[t]?mr(h.inputs).filter(m=>{const g={source:e,sourceHandle:t,target:n,targetHandle:m.name};return mg(g,s,o,r,a,!0)===null}):[]},I7e=(e,t,n,s,o,r,a)=>{const l=s.find(m=>m.id===e),d=s.find(m=>m.id===n);if(!d||!l)return[];const u=r[d.data.type],h=r[l.data.type];return!u||!h?[]:h.inputs[t]?mr(u.outputs).filter(m=>{const g={source:n,sourceHandle:m.name,target:e,targetHandle:t};return mg(g,s,o,r,a,!0)===null}):[]},T7e=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:o}=e;return`reactflow__edge-${t}${n||""}-${s}${o||""}`},jx=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:o}=e;return ve(t&&n&&s&&o,"Invalid connection"),{source:t,sourceHandle:n,target:s,targetHandle:o,id:T7e({source:t,sourceHandle:n,target:s,targetHandle:o})}},A7e=()=>{const{t:e}=M(),t=Tc(),n=v7e(),s=re(ln),o=re(Ci);return c.useCallback(a=>{const l=n(a);if(!l){const m=e("nodes.unknownNode",{nodeType:a});ge({status:"error",title:m});return}const d=_k.get(),{nodes:u,edges:h}=Xe(t.getState());l.position=AY(u,(d==null?void 0:d.x)??l.position.x,(d==null?void 0:d.y)??l.position.y),l.selected=!0;const p=[{type:"add",item:l}],f=[];if(u.forEach(({id:m,selected:g})=>{g&&p.push({type:"select",id:m,selected:!1})}),h.forEach(({id:m,selected:g})=>{g&&f.push({type:"select",id:m,selected:!1})}),p.length>0&&t.dispatch(Od(p)),f.length>0&&t.dispatch(Qo(f)),o&&Rn(l)){const m=ec.get(),{handleType:g}=o,x=g==="source"?o.nodeId:l.id,b=g==="source"?o.handleId:null,C=g==="target"?o.nodeId:l.id,y=g==="target"?o.handleId:null,{nodes:v,edges:w}=Xe(t.getState()),k=PY(x,b,C,y,v,w,s,m);if(k){const S=jx(k);t.dispatch(Qo([{type:"add",item:S}]))}}},[n,o,t,e,s])},M7e={"[cmdk-root]":{w:"full",h:"full"},"[cmdk-list]":{w:"full",h:"full"}},LY=c.memo(()=>{const{t:e}=M(),t=c.useRef(null),[n,s]=c.useState(""),o=A7e(),r=A(On),a=jr(),[l]=ml(n,300),d=re(Rd),u=c.useCallback(()=>{Rd.set(!0)},[]),h=c.useCallback(()=>{Rd.set(!1)},[]);De({id:"addNode",category:"workflows",callback:u,options:{enabled:r==="workflows"&&!a,preventDefault:!0},dependencies:[u,r,a]});const p=c.useCallback(g=>{s(g.target.value)},[]),f=c.useCallback(()=>{h(),s(""),Ci.set(null)},[h]),m=c.useCallback(g=>{o(g),f()},[o,f]);return i.jsxs(Oi,{isOpen:d,onClose:f,useInert:!1,initialFocusRef:t,size:"xl",isCentered:!0,children:[i.jsx(di,{}),i.jsx(Ni,{h:"512",maxH:"70%",children:i.jsx(Ks,{p:2,h:"full",sx:M7e,children:i.jsx(a4,{loop:!0,shouldFilter:!1,children:i.jsxs(T,{flexDir:"column",h:"full",gap:2,children:[i.jsx(St,{ref:t,value:n,onChange:p,placeholder:e("nodes.nodeSearch")}),i.jsx(Ce,{w:"full",h:"full",children:i.jsxs(ns,{children:[i.jsx(_Y,{children:i.jsx(Ot,{position:"absolute",top:0,right:0,bottom:0,left:0,icon:null,label:"No matching items"})}),i.jsx(jY,{children:i.jsx(DY,{searchTerm:l,onSelect:m})})]})})]})})})})]})});LY.displayName="AddNodeCmdk";const E7e={'&[data-selected="true"]':{bg:"base.700"}},P7e=jn(ln,e=>Object.values(e).filter(t=>t.classification!=="deprecated")),L7e=vD(e=>new RegExp(e.trim().replace(/[-[\]{}()*+!<=:?./\\^$|#,]/g,"").split(" ").join(".*"),"gi")),z2=vD((e,t)=>{const n=L7e(t);if(!t||e.title.includes(t)||n.test(e.title)||e.type.includes(t)||n.test(e.type)||e.description.includes(t)||n.test(e.description)||e.nodePack.includes(t)||n.test(e.nodePack)||e.classification.includes(t)||n.test(e.classification))return!0;for(const s of e.tags)if(s.includes(t)||n.test(s))return!0;return!1},(e,t)=>`${e.type}-${t}`),DY=c.memo(({searchTerm:e,onSelect:t})=>{const{t:n}=M(),s=re(P7e),o=re(Ci),r=c.useMemo(()=>({type:"current_image",title:n("nodes.currentImage"),description:n("nodes.currentImageDescription"),tags:["progress","image","current"],classification:"stable",nodePack:"invokeai"}),[n]),a=c.useMemo(()=>({type:"notes",title:n("nodes.notes"),description:n("nodes.notesDescription"),tags:["notes"],classification:"stable",nodePack:"invokeai"}),[n]),l=c.useMemo(()=>{const d=[];if(o){for(const u of s)if(z2(u,e)){const h=o.handleType==="source"?u.inputs:u.outputs;for(const[p,f]of gC(h)){const m=o.handleType==="source"?o.fieldTemplate.type:f.type,g=o.handleType==="target"?o.fieldTemplate.type:f.type;if(EY(m,g)){d.push({label:u.title,value:u.type,description:u.description,classification:u.classification,nodePack:u.nodePack});break}}}}else{for(const u of s)z2(u,e)&&d.push({label:u.title,value:u.type,description:u.description,classification:u.classification,nodePack:u.nodePack});for(const u of[r,a])z2(u,e)&&d.push({label:u.title,value:u.type,description:u.description,classification:u.classification,nodePack:u.nodePack})}return d},[o,s,e,r,a]);return i.jsx(i.Fragment,{children:l.map(d=>i.jsx(kY,{value:d.value,onSelect:t,asChild:!0,children:i.jsxs(T,{role:"button",flexDir:"column",sx:E7e,py:1,px:2,borderRadius:"base",children:[i.jsxs(T,{alignItems:"center",gap:2,children:[d.classification==="beta"&&i.jsx(at,{boxSize:4,color:"invokeYellow.300",as:A7}),d.classification==="prototype"&&i.jsx(at,{boxSize:4,color:"invokeRed.300",as:oj}),d.classification==="internal"&&i.jsx(at,{boxSize:4,color:"invokePurple.300",as:w7}),d.classification==="special"&&i.jsx(at,{boxSize:4,color:"invokeGreen.300",as:Ou}),i.jsx(W,{fontWeight:"semibold",children:d.label}),i.jsx(Je,{}),i.jsx(W,{variant:"subtext",fontWeight:"semibold",children:d.nodePack})]}),d.description&&i.jsx(W,{color:"base.200",children:d.description})]})},d.value))})});DY.displayName="CommandListItems";const D7e=fn(Xe,e=>({name:e.name,description:e.description,notes:e.notes,author:e.author,tags:e.tags})),R7e=()=>{const{name:e,description:t,notes:n,author:s,tags:o}=A(D7e),{t:r}=M();return i.jsxs(T,{flexDir:"column",gap:"2",children:[!!e.length&&i.jsxs(Ce,{children:[i.jsx(W,{fontWeight:"semibold",children:r("nodes.workflowName")}),i.jsx(W,{opacity:.7,fontStyle:"oblique 5deg",children:e})]}),!!s.length&&i.jsxs(Ce,{children:[i.jsx(W,{fontWeight:"semibold",children:r("nodes.workflowAuthor")}),i.jsx(W,{opacity:.7,fontStyle:"oblique 5deg",children:s})]}),!!o.length&&i.jsxs(Ce,{children:[i.jsx(W,{fontWeight:"semibold",children:r("nodes.workflowTags")}),i.jsx(W,{opacity:.7,fontStyle:"oblique 5deg",children:o})]}),!!t.length&&i.jsxs(Ce,{children:[i.jsx(W,{fontWeight:"semibold",children:r("nodes.workflowDescription")}),i.jsx(W,{opacity:.7,fontStyle:"oblique 5deg",children:t})]}),!!n.length&&i.jsxs(Ce,{children:[i.jsx(W,{fontWeight:"semibold",children:r("nodes.workflowNotes")}),i.jsx(W,{opacity:.7,fontStyle:"oblique 5deg",children:n})]})]})},O7e=c.memo(R7e),RY=()=>{const e=re(ln),t=c.useMemo(()=>he(Xe,s=>s.nodes.filter(Rn).some(o=>{const r=e[o.data.type];return r?CD(o.data,r):!1})),[e]);return A(t)},N7e=()=>{const{t:e}=M();return i.jsx(T,{flexDir:"column",gap:"2",children:i.jsxs(T,{flexDir:"column",gap:"2",children:[i.jsx(W,{fontWeight:"semibold",children:e("toast.loadedWithWarnings")}),i.jsxs(T,{flexDir:"column",children:[i.jsxs(W,{children:[e("common.toResolve"),":"]}),i.jsxs(W,{children:[e("nodes.editMode")," >> ",e("nodes.updateAllNodes")," >> ",e("common.save")]})]})]})})},F7e=()=>RY()?i.jsx(Oe,{label:i.jsx(N7e,{}),children:i.jsx(T,{h:"full",alignItems:"center",gap:"2",children:i.jsx(at,{color:"warning.400",as:_m})})}):i.jsx(i.Fragment,{}),B7e=()=>{const{t:e}=M(),t=A(sy),n=_c(),s=A(kr);return i.jsxs(T,{gap:"1",alignItems:"center",children:[t.length?i.jsx(Oe,{label:i.jsx(O7e,{}),placement:"top",children:i.jsx(W,{fontSize:"lg",userSelect:"none",noOfLines:1,wordBreak:"break-all",fontWeight:"semibold",children:t})}):i.jsx(W,{fontSize:"lg",fontStyle:"italic",fontWeight:"semibold",children:e("workflows.unnamedWorkflow")}),n&&s==="edit"&&i.jsx(Oe,{label:e("nodes.newWorkflowDesc2"),children:i.jsx(T,{children:i.jsx(at,{as:yfe,boxSize:"20px",color:"invokeYellow.500"})})}),i.jsx(F7e,{})]})},OY=c.memo(()=>{const e=A(sy);return i.jsx(T,{gap:2,top:2,left:"50%",transform:"translateX(-50%)",position:"absolute",pointerEvents:"none",children:!!e.length&&i.jsx(B7e,{})})});OY.displayName="TopCenterPanel";const $7e=()=>{const{t:e}=M(),t=c.useCallback(()=>{Rd.set(!0)},[]);return i.jsx(le,{tooltip:e("nodes.addNodeToolTip"),"aria-label":e("nodes.addNode"),icon:i.jsx(Vt,{}),onClick:t,pointerEvents:"auto"})},V7e=c.memo($7e),z7e=Wn("workflows"),G7e=()=>{const e=Tc(),{t}=M();return c.useCallback(()=>{const s=pu(e.getState()),o=ln.get();let r=0;s.filter(Rn).forEach(a=>{const l=o[a.data.type];if(!l){r++;return}if(CD(a.data,l))try{const d=ple(a,l);e.dispatch(Od([{type:"remove",id:d.id},{type:"add",item:d}]))}catch(d){d instanceof fle&&r++}}),r?(z7e.warn(t("nodes.unableToUpdateNodes",{count:r})),ge({id:"UNABLE_TO_UPDATE_NODES",title:t("nodes.unableToUpdateNodes",{count:r})})):ge({id:"ALL_NODES_UPDATED",title:t("nodes.allNodesUpdated"),status:"success"})},[e,t])},H7e=()=>{const{t:e}=M(),t=RY(),n=G7e();return t?i.jsx(le,{tooltip:e("nodes.updateAllNodes"),"aria-label":e("nodes.updateAllNodes"),icon:i.jsx(_m,{}),onClick:n,pointerEvents:"auto",colorScheme:"warning"}):null},W7e=c.memo(H7e),NY=c.memo(()=>{const e=jr(),t=re(ca),n=Mc(),s=UD(),o=re(Xa),{t:r}=M();return i.jsxs(T,{gap:2,top:2,left:2,position:"absolute",alignItems:"flex-start",pointerEvents:"none",children:[!e&&i.jsxs(T,{gap:"2",children:[i.jsx(V7e,{}),i.jsx(W7e,{})]}),e&&i.jsxs(wc,{status:"info",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[i.jsx(Sc,{}),i.jsxs(Ce,{children:[i.jsx(nm,{children:r("workflows.builder.workflowLocked")}),s&&i.jsx(Ra,{whiteSpace:"pre-wrap",children:r("workflows.builder.publishingValidationRunInProgress")}),t&&!s&&!o&&i.jsx(Ra,{whiteSpace:"pre-wrap",children:r("workflows.builder.workflowLockedDuringPublishing")}),t&&!s&&o&&i.jsx(Ra,{whiteSpace:"pre-wrap",children:r("workflows.builder.selectingOutputNodeDesc")}),n&&i.jsx(Ra,{whiteSpace:"pre-wrap",children:r("workflows.builder.workflowLockedPublished")})]})]})]})});NY.displayName="TopLeftPanel";const U7e=()=>{const e=G(),{t}=M(),{isOpen:n,onOpen:s,onClose:o}=hi(),r=_c(),a=c.useCallback(()=>{e(xP()),ge({id:"WORKFLOW_CLEARED",title:t("workflows.workflowCleared"),status:"success"}),o()},[e,o,t]),l=c.useCallback(()=>{if(r){a();return}s()},[r,a,s]);return i.jsxs(i.Fragment,{children:[i.jsx(le,{tooltip:t("nodes.clearWorkflow"),"aria-label":t("nodes.clearWorkflow"),icon:i.jsx(My,{}),onClick:l,pointerEvents:"auto"}),i.jsx(ho,{isOpen:n,onClose:o,title:t("nodes.clearWorkflow"),acceptCallback:a,useInert:!1,children:i.jsxs(T,{flexDir:"column",gap:2,children:[i.jsx(W,{children:t("nodes.clearWorkflowDesc")}),i.jsx(W,{variant:"subtext",children:t("nodes.clearWorkflowDesc2")})]})})]})},q7e=c.memo(U7e),K7e=()=>{const{t:e}=M(),t=_c(),n=Sb();return i.jsx(le,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:i.jsx(ar,{}),isDisabled:!t,onClick:n,pointerEvents:"auto"})},Z7e=c.memo(K7e),Y7e=()=>{const{t:e}=M(),[t]=mle(),n=c.useCallback(()=>{t()},[t]);return i.jsx(de,{leftIcon:i.jsx(Mpe,{}),tooltip:e("nodes.reloadNodeTemplates"),"aria-label":e("nodes.reloadNodeTemplates"),onClick:n,children:e("nodes.reloadNodeTemplates")})},X7e=c.memo(Y7e),Q7e={flexGrow:1},[FY]=jc(!1),J7e=()=>{const e=G(),t=FY(),n=A(wD),s=A(SD),o=A(kD),r=A(ly),a=A(jD),l=A(_D),d=c.useCallback(x=>{e(gle(x.target.checked))},[e]),u=c.useCallback(x=>{e(xle(x.target.checked))},[e]),h=c.useCallback(x=>{e(yle(x.target.checked))},[e]),p=c.useCallback(x=>{e(ble(x.target.checked))},[e]),f=c.useCallback(x=>{e(vle(x.target.checked))},[e]),m=c.useCallback(x=>{e(Cle(x.target.checked))},[e]),{t:g}=M();return i.jsxs(Oi,{isOpen:t.isTrue,onClose:t.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[i.jsx(di,{}),i.jsxs(Ni,{children:[i.jsx(ui,{children:g("nodes.workflowSettings")}),i.jsx(Do,{}),i.jsx(Ks,{children:i.jsxs(T,{flexDirection:"column",gap:4,py:4,children:[i.jsx(zt,{size:"sm",children:g("parameters.general")}),i.jsxs(Es,{orientation:"vertical",formLabelProps:Q7e,children:[i.jsxs(Q,{children:[i.jsxs(T,{w:"full",children:[i.jsx(J,{children:g("nodes.animatedEdges")}),i.jsx(et,{onChange:u,isChecked:r})]}),i.jsx(Js,{children:g("nodes.animatedEdgesHelp")})]}),i.jsx(Ct,{}),i.jsxs(Q,{children:[i.jsxs(T,{w:"full",children:[i.jsx(J,{children:g("nodes.snapToGrid")}),i.jsx(et,{isChecked:n,onChange:h})]}),i.jsx(Js,{children:g("nodes.snapToGridHelp")})]}),i.jsx(Ct,{}),i.jsxs(Q,{children:[i.jsxs(T,{w:"full",children:[i.jsx(J,{children:g("nodes.colorCodeEdges")}),i.jsx(et,{isChecked:o,onChange:p})]}),i.jsx(Js,{children:g("nodes.colorCodeEdgesHelp")})]}),i.jsx(Ct,{}),i.jsxs(Q,{children:[i.jsxs(T,{w:"full",children:[i.jsx(J,{children:g("nodes.fullyContainNodes")}),i.jsx(et,{isChecked:s===wle.Full,onChange:f})]}),i.jsx(Js,{children:g("nodes.fullyContainNodesHelp")})]}),i.jsx(Ct,{}),i.jsxs(Q,{children:[i.jsxs(T,{w:"full",children:[i.jsx(J,{children:g("nodes.showEdgeLabels")}),i.jsx(et,{isChecked:a,onChange:m})]}),i.jsx(Js,{children:g("nodes.showEdgeLabelsHelp")})]}),i.jsx(Ct,{}),i.jsx(zt,{size:"sm",pt:4,children:g("common.advanced")}),i.jsxs(Q,{children:[i.jsxs(T,{w:"full",children:[i.jsx(J,{children:g("nodes.validateConnections")}),i.jsx(et,{isChecked:l,onChange:d})]}),i.jsx(Js,{children:g("nodes.validateConnectionsHelp")})]}),i.jsx(Ct,{})]}),i.jsx(X7e,{})]})})]})]})},e9e=c.memo(J7e),BY=c.memo(()=>{const e=FY(),t=jr(),{t:n}=M();return t?null:i.jsxs(T,{gap:2,top:2,right:2,position:"absolute",alignItems:"flex-end",pointerEvents:"none",children:[i.jsx(q7e,{}),i.jsx(Z7e,{}),i.jsx(le,{pointerEvents:"auto","aria-label":n("workflows.workflowEditorMenu"),icon:i.jsx(Im,{}),onClick:e.setTrue})]})});BY.displayName="TopRightPanel";const t9e=()=>{const e=Tc(),t=re(ln),n=Ik(),s=c.useCallback((l,{nodeId:d,handleId:u,handleType:h})=>{ve(d&&u&&h,"Invalid connection start event");const f=pu(e.getState()).find(b=>b.id===d);if(!f)return;const m=t[f.data.type];if(!m)return;const x=m[h==="source"?"outputs":"inputs"][u];x&&Ci.set({nodeId:d,handleId:u,handleType:h,fieldTemplate:x})},[e,t]),o=c.useCallback(l=>{const{dispatch:d}=e,u=jx(l);d(Qo([{type:"add",item:u}])),n([u.source,u.target]),Ci.set(null)},[e,n]),r=c.useCallback(()=>{const{dispatch:l}=e,d=Ci.get(),u=ec.get(),h=$0.get();if(u&&!h||Cd.get()){Ci.set(null);return}if(!d)return;const{nodes:p,edges:f}=Xe(e.getState());if(h){const{handleType:m}=d,g=m==="source"?d.nodeId:h,x=m==="source"?d.handleId:null,b=m==="target"?d.nodeId:h,C=m==="target"?d.handleId:null,y=PY(g,x,b,C,p,f,t,u);if(y){const v=jx(y),w=[{type:"add",item:v}],k=[v.source,v.target];u&&(Cd.set(!0),w.push({type:"remove",id:u.id}),k.push(u.source,u.target)),l(Qo(w)),n(k)}Ci.set(null)}else Rd.set(!0)},[e,t,n]);return c.useMemo(()=>({onConnectStart:s,onConnect:o,onConnectEnd:r}),[s,o,r])},n9e=()=>{const e=Tc(),t=re(ln),n=A(_D);return c.useCallback(({source:o,sourceHandle:r,target:a,targetHandle:l})=>{if(!(o&&r&&a&&l))return!1;const d=ec.get(),{nodes:u,edges:h}=Xe(e.getState());return mg({source:o,sourceHandle:r,target:a,targetHandle:l},u,h,t,d,n)===null},[t,n,e])},x0=Wn("workflows"),s9e=()=>{const{getState:e}=em(),{nodes:t,edges:n}=Xe(e()),s=t.filter(a=>a.selected),o=n.filter(a=>a.selected),r=n.filter(a=>s.some(l=>l.id===a.target));ID.set(s),TD.set(o),AD.set(r)},$Y=e=>{const{getState:t,dispatch:n}=em(),{nodes:s,edges:o}=Xe(t()),r=ln.get(),a=_k.get(),l=gt(ID.get());let d=gt(TD.get());if(e){const v=gt(AD.get());d=GD([...d,...v],Vl)}const u=l.map(v=>v.position.x),h=l.map(v=>v.position.y),p=Math.min(...u),f=Math.min(...h),m=a?a.x-p:50,g=a?a.y-f:50;l.forEach(v=>{const{x:w,y:k}=AY(s,v.position.x+m,v.position.y+g);v.position.x=w,v.position.y=k,v.selected=!0;const S=of();for(const P of d)P.source===v.id?P.source=S:P.target===v.id&&(P.target=S);v.id=S,v.data.id=S}),d.forEach(v=>{v.id=of()});const x=[],b=[];s.forEach(({id:v,selected:w})=>{w&&x.push({type:"select",id:v,selected:!1})}),l.forEach(v=>{x.push({type:"add",item:v})}),o.forEach(({id:v,selected:w})=>{w&&b.push({type:"select",id:v,selected:!1})});const C=[...s,...l],y=[...o];d.forEach(v=>{if(v.type==="collapsed"){const{type:w,source:k,target:S}=v;if(C.find(P=>P.id===v.source)===void 0||C.find(P=>P.id===v.target)===void 0){x0.warn({edge:{type:w,source:k,target:S}},`Invalid collapsed edge, cannot paste: ${Me("nodes.missingSourceOrTargetNode")}`);return}}else if(v.type==="default"){const{type:w,source:k,sourceHandle:S,target:P,targetHandle:E}=v;if(!S||!E){x0.warn({edge:{type:w,source:k,sourceHandle:S,target:P,targetHandle:E}},`Invalid edge, cannot paste: ${Me("nodes.missingSourceOrTargetHandle")}`);return}const L=mg({source:k,sourceHandle:S,target:P,targetHandle:E},C,y,r,null,!0);if(L!==null){x0.warn({edge:{source:k,sourceHandle:S,target:P,targetHandle:E}},`Invalid edge, cannot paste: ${Me(L)}`);return}}else{const{type:w}=v;x0.warn({edge:{type:w}},"Invalid edge type, cannot paste");return}b.push({type:"add",item:v}),y.push(v)}),x.length>0&&n(Od(x)),b.length>0&&n(Qo(b))},i9e=()=>{$Y(!1)},o9e=()=>{$Y(!0)},r9e={copySelection:s9e,pasteSelection:i9e,pasteSelectionWithEdges:o9e},a9e=()=>r9e,Ob=e=>{if(!e)return hr("base.500");const t=Sle[e.name];return hr(t||"base.500")},l9e={opacity:.8},c9e=({fromX:e,fromY:t,fromPosition:n,toX:s,toY:o,toPosition:r})=>{const a=re(Ci),l=A(kD),d=A(ly),u=c.useMemo(()=>l&&a?Ob(a.fieldTemplate.type):hr("base.500"),[a,l]),h=c.useMemo(()=>d?"react-flow__custom_connection-path animated":"react-flow__custom_connection-path",[d]),p={sourceX:e,sourceY:t,sourcePosition:n,targetX:s,targetY:o,targetPosition:r},[f]=Tk(p);return i.jsx("g",{children:i.jsx("path",{fill:"none",stroke:u,strokeWidth:2,className:h,d:f,style:l9e})})},d9e=c.memo(c9e),VY=(e,t)=>he(Xe,n=>{const s=n.nodes.find(r=>r.id===e),o=n.nodes.find(r=>r.id===t);return!!(s!=null&&s.selected||o!=null&&o.selected)}),u9e=(e,t,n,s,o)=>he(Xe,L8,(r,a)=>{const{shouldColorEdges:l}=a,d=r.nodes.find(g=>g.id===t),u=r.nodes.find(g=>g.id===s);if(!d||!n||!u||!o)return hr("base.500");const h=e[d.data.type],p=Rn(d)&&Rn(u),f=h==null?void 0:h.outputs[n],m=p?f==null?void 0:f.type:void 0;return m&&l?Ob(m):hr("base.500")}),h9e=(e,t,n,s,o)=>he(Xe,r=>{var h,p;const a=r.nodes.find(f=>f.id===t),l=r.nodes.find(f=>f.id===s);if(!a||!n||!l||!o)return null;const d=e[a.data.type],u=e[l.data.type];return`${(d==null?void 0:d.title)||((h=a.data)==null?void 0:h.label)} -> ${(u==null?void 0:u.title)||((p=l.data)==null?void 0:p.label)}`}),p9e=Sr(ED),f9e={strokeWidth:"3px !important",stroke:"base.500 !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important"}},m9e={bg:"base.500",opacity:.5,shadow:"base",'&[data-selected="true"]':{opacity:1}},g9e=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:o,targetPosition:r,markerEnd:a,data:l,selected:d=!1,source:u,target:h})=>{const p=A(ly),f=c.useMemo(()=>VY(u,h),[u,h]),m=A(f),[g,x,b]=Tk({sourceX:e,sourceY:t,sourcePosition:o,targetX:n,targetY:s,targetPosition:r});return i.jsxs(i.Fragment,{children:[i.jsx(p9e,{path:g,markerEnd:a,sx:f9e,"data-selected":d,"data-are-connected-nodes-selected":m,"data-should-animate-edges":p}),(l==null?void 0:l.count)!==void 0&&i.jsx(MD,{children:i.jsx(Ce,{position:"absolute",transform:`translate(-50%, -50%) translate(${x}px,${b}px)`,className:`edge-label-renderer__custom-edge ${tt} ${co}`,zIndex:1001,children:i.jsx(Hn,{variant:"solid",sx:m9e,"data-selected":d,children:l.count})})})]})},x9e=c.memo(g9e),y9e=Sr(ED),b9e={strokeWidth:"3px !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important",'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"}}},v9e={pointerEvents:"all",position:"absolute",bg:"base.800",borderRadius:"base",borderWidth:1,opacity:.5,borderColor:"transparent",py:1,px:3,shadow:"md",'&[data-selected="true"]':{opacity:1,borderColor:void 0}},C9e={fontWeight:"semibold",color:"base.300",'&[data-selected="true"]':{color:"base.100"}},w9e=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:o,targetPosition:r,markerEnd:a,selected:l=!1,source:d,target:u,sourceHandleId:h,targetHandleId:p})=>{const f=re(ln),m=A(ly),g=A(jD),x=c.useMemo(()=>VY(d,u),[d,u]),b=c.useMemo(()=>u9e(f,d,h,u,p),[f,d,h,u,p]),C=c.useMemo(()=>h9e(f,d,h,u,p),[f,d,h,u,p]),y=A(x),v=A(b),w=A(C),[k,S,P]=Tk({sourceX:e,sourceY:t,sourcePosition:o,targetX:n,targetY:s,targetPosition:r});return i.jsxs(i.Fragment,{children:[i.jsx(y9e,{path:k,markerEnd:a,sx:b9e,stroke:`${v} !important`,"data-selected":l,"data-are-connected-nodes-selected":y,"data-should-animate-edges":m}),w&&g&&i.jsx(MD,{children:i.jsx(T,{className:`${tt} ${co}`,transform:`translate(-50%, -50%) translate(${S}px,${P}px)`,"data-selected":l,sx:v9e,children:i.jsx(W,{size:"sm",sx:C9e,"data-selected":l,children:w})})})]})},S9e=c.memo(w9e),k9e={h:"full",position:"relative",borderRadius:"base",transitionProperty:"none",cursor:"grab","& .node-selection-overlay":{display:"none",position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"none",pointerEvents:"none",opacity:.5},'&[data-is-mouse-over-node="true"] .node-selection-overlay':{opacity:1,display:"block"},'&[data-is-mouse-over-form-field="true"] .node-selection-overlay':{opacity:1,display:"block",bg:"invokeBlueAlpha.100"},_hover:{"& .node-selection-overlay":{display:"block",shadow:"0 0 0 2px var(--invoke-colors-blue-300)"},'&[data-is-selected="true"] .node-selection-overlay':{display:"block",opacity:1,shadow:"0 0 0 3px var(--invoke-colors-blue-300)"}},'&[data-is-selected="true"] .node-selection-overlay':{display:"block",shadow:"0 0 0 3px var(--invoke-colors-blue-300)"},'&[data-is-editor-locked="true"]':{"& *":{cursor:"not-allowed",pointerEvents:"none"}}},j9e={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",pointerEvents:"none",zIndex:-1,shadow:"var(--invoke-shadows-xl), var(--invoke-shadows-base), var(--invoke-shadows-base)"},_9e={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"md",pointerEvents:"none",transitionProperty:"none",opacity:.7,zIndex:-1,display:"none",shadow:"0 0 0 2px var(--invoke-colors-yellow-400), 0 0 20px 2px var(--invoke-colors-orange-700)",'&[data-is-in-progress="true"]':{display:"block"}},I9e=e=>{const{nodeId:t,width:n,children:s,selected:o}=e,r=uW(t),a=sg(t),l=gb(t),d=jr(),u=ok(t),h=(u==null?void 0:u.status)===ti.enum.IN_PROGRESS,p=A(PD),f=tm(),m=c.useCallback(g=>{g.target instanceof HTMLElement&&(g.target instanceof HTMLInputElement||g.target instanceof HTMLTextAreaElement||g.target instanceof HTMLSelectElement||g.target instanceof HTMLButtonElement||g.target instanceof HTMLAnchorElement||g.target.closest(`.${Ac}`)===null&&l())},[l]);return i.jsxs(Ce,{onClick:f.onCloseGlobal,onDoubleClick:m,onMouseOver:r.handleMouseOver,onMouseOut:r.handleMouseOut,className:xm,sx:k9e,width:n||mC,opacity:p,"data-is-editor-locked":d,"data-is-selected":o,"data-is-mouse-over-form-field":a.isMouseOverFormField,children:[i.jsx(Ce,{sx:j9e}),i.jsx(Ce,{sx:_9e,"data-is-in-progress":h}),s,i.jsx(Ce,{className:"node-selection-overlay"})]})},_x=c.memo(I9e),T9e=e=>{const t=A(Yf),n=re(zr);return n!=null&&n.image?i.jsx(G2,{nodeProps:e,children:i.jsx(Zt,{src:n==null?void 0:n.image.dataURL,w:"full",h:"full",objectFit:"contain",borderRadius:"base"})}):t?i.jsx(G2,{nodeProps:e,children:i.jsx(vl,{imageDTO:t})}):i.jsx(G2,{nodeProps:e,children:i.jsx(Ot,{})})},A9e=c.memo(T9e),G2=e=>{const[t,n]=c.useState(!1),s=c.useCallback(()=>{n(!0)},[]),o=c.useCallback(()=>{n(!1)},[]),{t:r}=M();return i.jsx(_x,{nodeId:e.nodeProps.id,selected:e.nodeProps.selected,width:384,children:i.jsxs(T,{onMouseEnter:s,onMouseLeave:o,className:xm,position:"relative",flexDirection:"column",children:[i.jsx(T,{layerStyle:"nodeHeader",borderTopRadius:"base",alignItems:"center",justifyContent:"center",h:8,children:i.jsx(W,{fontSize:"sm",fontWeight:"semibold",color:"base.200",children:r("nodes.currentImage")})}),i.jsxs(T,{layerStyle:"nodeBody",w:"full",h:"full",borderBottomRadius:"base",p:2,children:[e.children,t&&i.jsx(k_.div,{initial:M9e,animate:E9e,exit:P9e,style:L9e,children:i.jsx(kz,{inset:2})},"nextPrevButtons")]})]})})},M9e={opacity:0},E9e={opacity:1,transition:{duration:.1}},P9e={opacity:0,transition:{duration:.1}},L9e={position:"absolute",top:40,left:-2,right:-2,bottom:0,pointerEvents:"none"},D9e={position:"relative",minH:8,py:.5,alignItems:"center",justifyContent:"flex-end"},l4=c.memo(({children:e})=>i.jsx(T,{sx:D9e,children:e}));l4.displayName="OutputFieldWrapper";const R9e=(e,t)=>{const n=re(ln),s=c.useMemo(()=>he(Xe,r=>{const a=sk(r,e),l=n[a.data.type],d=l==null?void 0:l.outputs[t];return(d==null?void 0:d.title)||t}),[t,e,n]);return A(s)},O9e=(e,t)=>{const n=re(ln),s=c.useMemo(()=>he(Xe,r=>{const a=ju(r,e);if(!a)return!1;const l=n[a.data.type];return!!(l==null?void 0:l.outputs[t])}),[t,e,n]);return A(s)},zY=c.memo(({nodeId:e,fieldName:t,children:n})=>O9e(e,t)?n:i.jsx(GY,{nodeId:e,fieldName:t}));zY.displayName="OutputFieldGate";const GY=c.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),s=R9e(e,t);return i.jsx(l4,{children:i.jsx(Q,{isInvalid:!0,alignItems:"stretch",justifyContent:"space-between",gap:2,h:"full",w:"full",children:i.jsx(J,{display:"flex",alignItems:"center",h:"full",color:"error.300",mb:0,px:1,gap:2,children:n("nodes.unexpectedField_withName",{name:s})})})})});GY.displayName="Fallback";const N9e=(e,t,n,s,o,r)=>he(Xe,a=>{const{nodes:l,edges:d}=a;if(!o)return"nodes.noConnectionInProgress";if(s===o.handleType)return s==="source"?"nodes.cannotConnectOutputToOutput":"nodes.cannotConnectInputToInput";const u=s==="source"?t:o.nodeId,h=s==="source"?n:o.handleId,p=s==="target"?t:o.nodeId,f=s==="target"?n:o.handleId;return mg({source:u,sourceHandle:h,target:p,targetHandle:f},l,d,e,r)}),Nb=(e,t,n)=>{const s=re(Ci),o=re(ln),r=re(ec),a=c.useMemo(()=>N9e(o,e,t,n,s,r),[o,e,t,n,s,r]);return A(a)},Fb=(e,t,n)=>{const s=re(Ci);return c.useMemo(()=>!s||s.nodeId!==e||s.handleId!==t?!1:n==="source"&&s.fieldTemplate.fieldKind==="output"||n==="target"&&s.fieldTemplate.fieldKind==="input",[t,n,e,s])},Bb=()=>re(kle),$b=e=>{const{t}=M();return c.useMemo(()=>{const{name:s}=e;return ad(e)?t("nodes.collectionFieldType",{name:s}):Aa(e)?t("nodes.collectionOrScalarFieldType",{name:s}):t("nodes.singleFieldType",{name:s})},[e,t])},HY={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},WY={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineEnd:"-0.5rem"},UY=c.memo(({nodeId:e,fieldName:t})=>{const n=wb(e,t),s=$b(n.type),o=c.useMemo(()=>Ob(n.type),[n.type]),r=c.useMemo(()=>LD(n.type),[n.type]);return Bb()?i.jsx(KY,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:o,isModelField:r}):i.jsx(qY,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:o,isModelField:r})});UY.displayName="OutputFieldHandle";const qY=c.memo(({fieldTemplate:e,fieldTypeName:t,fieldColor:n,isModelField:s})=>{const o=jr();return i.jsx(Oe,{label:t,placement:"start",openDelay:Tu,children:i.jsx(Oa,{type:"source",id:e.name,position:Na.Right,style:WY,isConnectable:!o,children:i.jsx(Ce,{sx:HY,"data-cardinality":e.type.cardinality,"data-is-batch-field":e.type.batch,"data-is-model-field":s,"data-is-connection-in-progress":!1,"data-is-connection-start-field":!1,"data-is-connection-valid":!1,backgroundColor:e.type.cardinality==="SINGLE"?n:"base.900",borderColor:n})})})});qY.displayName="IdleHandle";const KY=c.memo(({nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:o,isModelField:r})=>{const{t:a}=M(),l=Fb(e,t,"target"),d=Nb(e,t,"target"),u=jr(),h=c.useMemo(()=>d!==null?a(d):s,[s,a,d]);return i.jsx(Oe,{label:h,placement:"start",openDelay:Tu,children:i.jsx(Oa,{type:"source",id:n.name,position:Na.Right,style:WY,isConnectable:!u,children:i.jsx(Ce,{sx:HY,"data-cardinality":n.type.cardinality,"data-is-batch-field":n.type.batch,"data-is-model-field":r,"data-is-connection-in-progress":!0,"data-is-connection-start-field":l,"data-is-connection-valid":d===null,backgroundColor:n.type.cardinality==="SINGLE"?o:"base.900",borderColor:o})})})});KY.displayName="ConnectionInProgressHandle";const ZY=c.memo(({nodeId:e,fieldName:t})=>{const n=wb(e,t),s=$b(n.type),{t:o}=M();return i.jsxs(T,{flexDir:"column",children:[i.jsx(W,{fontWeight:"semibold",children:n.title}),i.jsx(W,{opacity:.7,fontStyle:"oblique 5deg",children:n.description}),i.jsxs(W,{children:[o("parameters.type"),": ",s]})]})});ZY.displayName="OutputFieldTooltipContent";const c4=(e,t)=>{const n=c.useMemo(()=>he(Xe,o=>o.edges.find(a=>a.target===e&&a.targetHandle===t)!==void 0),[t,e]);return A(n)},F9e={fontSize:"sm",color:"base.300",fontWeight:"semibold",pe:2,'&[data-is-disabled="true"]':{opacity:.5}},YY=c.memo(({nodeId:e,fieldName:t})=>{const n=wb(e,t),s=c4(e,t),o=Fb(e,t,"source"),r=Bb(),a=Nb(e,t,"source");return i.jsx(Oe,{label:i.jsx(ZY,{nodeId:e,fieldName:t}),openDelay:Tu,placement:"top",children:i.jsx(W,{"data-is-disabled":r&&a!==null&&!o||s,sx:F9e,children:n.title})})});YY.displayName="OutputFieldTitle";const XY=c.memo(({nodeId:e,fieldName:t})=>i.jsxs(l4,{children:[i.jsx(YY,{nodeId:e,fieldName:t}),i.jsx(UY,{nodeId:e,fieldName:t})]}));XY.displayName="OutputFieldNodesEditorView";const B9e=e=>{const t=c.useMemo(()=>he(Xe,s=>fu(s,e)),[e]);return A(t)},$9e=e=>e.input==="connection"&&!Aa(e.type)||!(e.type.name in DD),V9e=e=>(["any","direct"].includes(e.input)||Aa(e.type))&&e.type.name in DD,z9e=e=>{const t=Bs(e),n=B9e(e);return c.useMemo(()=>{const o=new Set(Object.keys(n.inputs)),r=new Set(Object.keys(t.inputs));return Array.from(o.difference(r))},[n.inputs,t.inputs])},G9e=e=>{const t=Bs(e);return c.useMemo(()=>{const s=[];for(const[o,r]of Object.entries(t.inputs))V9e(r)&&s.push(o);return s},[t.inputs])},H9e=e=>{const t=Bs(e);return c.useMemo(()=>{const s=[];for(const[o,r]of Object.entries(t.inputs))$9e(r)&&s.push(o);return s},[t.inputs])},QY=e=>{const t=Bs(e);return c.useMemo(()=>!jle(t.type)&&!_le(t.type),[t])},d4=e=>{const t=Bs(e);return c.useMemo(()=>As(t==null?void 0:t.outputs,s=>s.type.name==="ImageField"&&(t==null?void 0:t.type)!=="image"),[t])},W9e=e=>{const t=d4(e),n=QY(e),s=Bt("invocationCache");return c.useMemo(()=>n&&(t||s),[t,s,n])},U9e=(e,t)=>{const n=G(),s=A(ak),o=No(e,t),r=Bc(e,t);return c.useCallback(()=>{const l=PL(e,t,o.type);n(cC({element:l,parentId:s,initialValue:r.value}))},[e,t,o.type,n,s,r.value])},JY=c.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),s=U9e(e,t);return i.jsx(le,{variant:"ghost",tooltip:n("workflows.builder.addToForm"),"aria-label":n("workflows.builder.addToForm"),icon:i.jsx(Vt,{}),pointerEvents:"auto",size:"xs",onClick:s})});JY.displayName="InputFieldAddToFormRoot";const eX=c.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M();return i.jsxs(es,{isLazy:!0,lazyBehavior:"unmount",children:[i.jsx(ds,{children:i.jsx(le,{variant:"ghost",tooltip:n("nodes.description"),"aria-label":n("nodes.description"),icon:i.jsx(afe,{}),pointerEvents:"auto",size:"xs"})}),i.jsx(ts,{p:2,w:256,children:i.jsx(tX,{nodeId:e,fieldName:t})})]})});eX.displayName="InputFieldDescriptionPopover";const tX=c.memo(({nodeId:e,fieldName:t})=>{const n=G(),{t:s}=M(),o=vb(e,t),r=c.useCallback(a=>{n(zL({nodeId:e,fieldName:t,val:a.target.value}))},[n,t,e]);return i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:s("nodes.description")}),i.jsx(ls,{className:`${tt} ${co} ${Gt}`,fontSize:"sm",value:o??"",onChange:r,p:2,resize:"none",rows:5})]})});tX.displayName="Content";const nX={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},sX={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineStart:"-0.5rem"},u4=c.memo(({nodeId:e,fieldName:t})=>{const n=No(e,t),s=$b(n.type),o=c.useMemo(()=>Ob(n.type),[n.type]),r=c.useMemo(()=>LD(n.type),[n.type]);return Bb()?i.jsx(oX,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:o,isModelField:r}):i.jsx(iX,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:o,isModelField:r})});u4.displayName="InputFieldHandle";const iX=c.memo(({fieldTemplate:e,fieldTypeName:t,fieldColor:n,isModelField:s})=>{const o=jr();return i.jsx(Oe,{label:t,placement:"start",openDelay:Tu,children:i.jsx(Oa,{type:"target",id:e.name,position:Na.Left,style:sX,isConnectable:!o,children:i.jsx(Ce,{sx:nX,"data-cardinality":e.type.cardinality,"data-is-batch-field":e.type.batch,"data-is-model-field":s,"data-is-connection-in-progress":!1,"data-is-connection-start-field":!1,"data-is-connection-valid":!1,backgroundColor:e.type.cardinality==="SINGLE"?n:"base.900",borderColor:n})})})});iX.displayName="IdleHandle";const oX=c.memo(({nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:o,isModelField:r})=>{const{t:a}=M(),l=Fb(e,t,"target"),d=Nb(e,t,"target"),u=jr(),h=c.useMemo(()=>d!==null?a(d):s,[s,a,d]);return i.jsx(Oe,{label:h,placement:"start",openDelay:Tu,children:i.jsx(Oa,{type:"target",id:n.name,position:Na.Left,style:sX,isConnectable:!u,children:i.jsx(Ce,{sx:nX,"data-cardinality":n.type.cardinality,"data-is-batch-field":n.type.batch,"data-is-model-field":r,"data-is-connection-in-progress":!0,"data-is-connection-start-field":l,"data-is-connection-valid":d===null,backgroundColor:n.type.cardinality==="SINGLE"?o:"base.900",borderColor:o})})})});oX.displayName="ConnectionInProgressHandle";const q9e=(e,t)=>{const n=G(),s=No(e,t),o=c.useMemo(()=>he(Xe,l=>{var h;const d=l.nodes.find(p=>p.id===e);if(!Rn(d))return;const u=(h=d.data.inputs[t])==null?void 0:h.value;return!Vl(u,s.default)}),[t,s.default,e]),r=A(o),a=c.useCallback(()=>{n(hk({nodeId:e,fieldName:t,value:s.default}))},[n,t,s.default,e]);return{defaultValue:s.default,isValueChanged:r,resetToDefaultValue:a}},rX=c.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),{isValueChanged:s,resetToDefaultValue:o}=q9e(e,t);return i.jsx(le,{variant:"ghost",tooltip:n("nodes.resetToDefaultValue"),"aria-label":n("nodes.resetToDefaultValue"),icon:i.jsx(Zs,{}),pointerEvents:"auto",size:"xs",onClick:o,isDisabled:!s})});rX.displayName="InputFieldResetToDefaultValueIconButton";const K9e=(e,t)=>{const n=re(ln),s=c.useMemo(()=>he(Xe,r=>{const a=ju(r,e);if(!a)return[];const l=uk(r,e,t),d=n[a.data.type];ve(d,`Template for input node type ${a.data.type} not found.`);const u=d.inputs[t];return ve(u,`Template for input field ${t} not found.`),Ek(a,d,l,u,r)}),[e,t,n]);return RW(s)},aX=c.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),s=Bc(e,t),o=No(e,t),r=$b(o.type),a=K9e(e,t),l=c.useMemo(()=>s.label&&o.title?`${s.label} (${o.title})`:s.label&&!o.title?s.label:o.title,[s,o]);return i.jsxs(T,{flexDir:"column",children:[i.jsx(W,{fontWeight:"semibold",children:l}),i.jsx(W,{opacity:.7,fontStyle:"oblique 5deg",children:o.description}),i.jsxs(W,{children:[n("parameters.type"),": ",r]}),i.jsxs(W,{children:[n("common.input"),": ",v0(o.input)]}),a.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs(W,{color:"error.500",children:[n("common.error_withCount",{count:a.length}),":"]}),i.jsx(ai,{children:a.map(({issue:d})=>i.jsx(Ft,{children:d},d))})]})]})});aX.displayName="InputFieldTooltipContent";const Z9e={p:0,fontWeight:"semibold",textAlign:"left",color:"base.300",_hover:{fontWeight:"semibold !important"},'&[data-is-invalid="true"]':{color:"error.300"},'&[data-is-disabled="true"]':{opacity:.5}},h4=c.memo(e=>{const{nodeId:t,fieldName:n,isInvalid:s,isDragging:o}=e,r=c.useRef(null),a=MI(t,n),l=DU(t,n),{t:d}=M(),u=c4(t,n),h=Fb(t,n,"target"),p=Bb(),f=Nb(t,n,"target"),m=G(),g=c.useMemo(()=>l||d("nodes.unknownField"),[l,d]),x=c.useCallback(v=>{m(GL({nodeId:t,fieldName:n,label:v}))},[m,t,n]),b=fa({value:a||g,defaultValue:g,onChange:x,inputRef:r}),C=c.useMemo(()=>p&&f!==null&&!h||u,[p,f,h,u]),y=c.useCallback(v=>{v.stopPropagation(),b.startEditing()},[b]);return b.isEditing?i.jsx(St,{ref:r,variant:"outline",...b.inputProps,_focusVisible:{borderRadius:"base",h:"unset",px:2}}):i.jsx(Oe,{label:i.jsx(aX,{nodeId:t,fieldName:n}),openDelay:Tu,placement:"top",isDisabled:o,children:i.jsx(W,{className:Ac,sx:Z9e,noOfLines:1,"data-is-invalid":s,"data-is-disabled":C,onDoubleClick:y,children:b.value})})});h4.displayName="InputFieldTitle";const Vb=c.memo(({nodeId:e,fieldName:t})=>{const n=No(e,t),s=ag(e,t),o=c4(e,t);return n.input==="connection"||o?i.jsx(lX,{nodeId:e,fieldName:t,isInvalid:s,isConnected:o,fieldTemplate:n}):i.jsx(cX,{nodeId:e,fieldName:t,isInvalid:s,isConnected:o,fieldTemplate:n})});Vb.displayName="InputFieldEditModeNodes";const lX=c.memo(({nodeId:e,fieldName:t,isInvalid:n})=>i.jsxs(mb,{children:[i.jsx(T,{px:2,children:i.jsx(h4,{nodeId:e,fieldName:t,isInvalid:n})}),i.jsx(u4,{nodeId:e,fieldName:t})]}));lX.displayName="ConnectedOrConnectionField";const Y9e={w:"full",px:2,flexDir:"column",gap:1,'&[data-is-dragging="true"]':{opacity:.3},pointerEvents:"auto",'&[data-is-connected="true"]':{pointerEvents:"none"},"& .direct-field-action-buttons":{display:"none"},_hover:{"& .direct-field-action-buttons":{display:"inline-flex"}}},cX=c.memo(({nodeId:e,fieldName:t,isInvalid:n,isConnected:s,fieldTemplate:o})=>{const r=c.useRef(null),a=c.useRef(null),l=T5e(e,t,o,r,a);return i.jsxs(mb,{children:[i.jsxs(T,{ref:r,sx:Y9e,"data-is-connected":s,"data-is-dragging":l,children:[i.jsxs(T,{gap:1,children:[i.jsx(T,{className:tt,ref:a,children:i.jsx(h4,{nodeId:e,fieldName:t,isInvalid:n,isDragging:l})}),i.jsx(Je,{}),i.jsxs(T,{className:"direct-field-action-buttons",children:[i.jsx(eX,{nodeId:e,fieldName:t}),i.jsx(rX,{nodeId:e,fieldName:t}),i.jsx(JY,{nodeId:e,fieldName:t})]})]}),i.jsx(bb,{nodeId:e,fieldName:t})]}),o.input!=="direct"&&i.jsx(u4,{nodeId:e,fieldName:t})]})});cX.displayName="DirectField";const X9e=e=>{const t=c.useMemo(()=>he(Xe,s=>{var o;return((o=fu(s,e))==null?void 0:o.isIntermediate)??!1}),[e]);return A(t)},Q9e=({nodeId:e})=>{const{t}=M(),n=G(),s=d4(e),o=X9e(e),r=c.useCallback(a=>{n(Ile({nodeId:e,isIntermediate:!a.target.checked}))},[n,e]);return s?i.jsxs(Q,{className:co,children:[i.jsxs(J,{m:0,children:[t("nodes.saveToGallery")," "]}),i.jsx(_n,{onChange:r,isChecked:!o})]}):null},J9e=c.memo(Q9e),eOe=e=>{const t=c.useMemo(()=>he(Xe,s=>{var o;return((o=fu(s,e))==null?void 0:o.useCache)??!1}),[e]);return A(t)},tOe=({nodeId:e})=>{const t=G(),n=eOe(e),s=c.useCallback(r=>{t(Tle({nodeId:e,useCache:r.target.checked}))},[t,e]),{t:o}=M();return i.jsxs(Q,{className:Ac,children:[i.jsx(J,{m:0,children:o("invocationCache.useCache")}),i.jsx(_n,{className:co,onChange:s,isChecked:n})]})},nOe=c.memo(tOe),B3={w:"unset"},sOe=({nodeId:e})=>{const t=d4(e),n=QY(e),s=Bt("invocationCache");return i.jsx(T,{className:xm,layerStyle:"nodeFooter",w:"full",borderBottomRadius:"base",gap:4,px:2,py:0,h:8,justifyContent:"space-between",children:i.jsxs(Es,{formControlProps:B3,formLabelProps:B3,children:[n&&s&&i.jsx(nOe,{nodeId:e}),n&&t&&i.jsx(J9e,{nodeId:e})]})})},iOe=c.memo(sOe),oOe={transitionProperty:"transform",transitionDuration:"normal",transform:"rotate(180deg)",'&[data-is-open="true"]':{transform:"rotate(0deg)"}},rOe=({nodeId:e,isOpen:t})=>{const n=G(),s=Ik(),o=c.useCallback(()=>{n(Ale({nodeId:e,isOpen:!t})),s(e)},[n,t,e,s]);return i.jsx(le,{className:`${tt} ${Ac}`,onClick:o,"aria-label":"Minimize",minW:8,w:8,h:8,variant:"link",icon:i.jsx(at,{as:C7,sx:oOe,"data-is-open":t})})},p4=c.memo(rOe),aOe=e=>c.useMemo(()=>{switch(e){case"Group 1":return"invokeGreen.300";case"Group 2":return"invokeBlue.300";case"Group 3":return"invokePurple.200";case"Group 4":return"invokeRed.300";case"Group 5":return"invokeYellow.300";default:return}},[e]),lOe=e=>{const t=c.useMemo(()=>he(Xe,s=>{var r;const o=Mle(s,e);if(Rn(o)&&Vf(o))return(r=o.data.inputs.batch_group_id)==null?void 0:r.value}),[e]);return A(t)},cOe=({nodeId:e,title:t})=>{const n=G(),s=gI(e),o=lOe(e),r=aOe(o),a=$H(e),{t:l}=M(),d=c.useRef(null),u=c.useCallback(f=>{n(EL({nodeId:e,label:f}))},[n,e]),h=fa({value:s||t||a||l("nodes.problemSettingTitle"),defaultValue:t||a||l("nodes.problemSettingTitle"),onChange:u,inputRef:d}),p=c.useMemo(()=>o?o==="None"?`${h.value} (${l("nodes.noBatchGroup")})`:`${h.value} (${o})`:h.value,[o,h.value,l]);return i.jsxs(T,{overflow:"hidden",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:[!h.isEditing&&i.jsx(W,{className:Ac,fontWeight:"semibold",color:r,onDoubleClick:h.startEditing,noOfLines:1,children:p}),h.isEditing&&i.jsx(St,{ref:d,...h.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},dX=c.memo(cOe),dOe=e=>{const t=Bs(e);return c.useMemo(()=>t.classification,[t])},uOe=({nodeId:e})=>{const t=dOe(e);return!t||t==="stable"?null:i.jsx(Oe,{label:i.jsx(uX,{classification:t}),placement:"top",shouldWrapChildren:!0,children:i.jsx(pOe,{classification:t})})},hOe=c.memo(uOe),uX=c.memo(({classification:e})=>{const{t}=M();return e==="beta"?t("nodes.betaDesc"):e==="prototype"?t("nodes.prototypeDesc"):e==="internal"?t("nodes.internalDesc"):e==="special"?t("nodes.specialDesc"):null});uX.displayName="ClassificationTooltipContent";const pOe=({classification:e})=>e==="beta"?i.jsx(at,{as:A7,display:"block",boxSize:4,color:"invokeYellow.300"}):e==="prototype"?i.jsx(at,{as:oj,display:"block",boxSize:4,color:"invokeRed.300"}):e==="internal"?i.jsx(at,{as:w7,display:"block",boxSize:4,color:"invokePurple.300"}):e==="special"?i.jsx(at,{as:Ou,display:"block",boxSize:4,color:"invokeGreen.300"}):null,fOe=e=>{const t=re(ln),n=c.useMemo(()=>he(Xe,o=>XD(e,t,o).length>0),[e,t]);return A(n)},$3={visibility:"hidden"},V3={borderWidth:0,borderRadius:"3px",width:"1rem",height:"1rem",backgroundColor:"var(--invoke-colors-base-600)",zIndex:-1},mOe=({nodeId:e})=>{const t=Bs(e);return t?i.jsxs(i.Fragment,{children:[i.jsx(Oa,{type:"target",id:`${e}-collapsed-target`,isConnectable:!1,position:Na.Left,style:V3}),mr(t.inputs,n=>i.jsx(Oa,{type:"target",id:n.name,isConnectable:!1,position:Na.Left,style:$3},`${e}-${n.name}-collapsed-input-handle`)),i.jsx(Oa,{type:"source",id:`${e}-collapsed-source`,isConnectable:!1,position:Na.Right,style:V3}),mr(t.outputs,n=>i.jsx(Oa,{type:"source",id:n.name,isConnectable:!1,position:Na.Right,style:$3},`${e}-${n.name}-collapsed-output-handle`))]}):null},gOe=c.memo(mOe),hX=c.memo(({nodeId:e})=>{const t=BH(e);return i.jsx(Oe,{label:i.jsx(pX,{nodeId:e}),placement:"top",shouldWrapChildren:!0,children:i.jsx(at,{as:Ru,display:"block",boxSize:4,w:8,color:t?"error.400":"base.400"})})});hX.displayName="InvocationNodeInfoIcon";const pX=c.memo(({nodeId:e})=>{const t=OH(e),n=gI(e),s=mI(e),o=Bs(e),{t:r}=M(),a=c.useMemo(()=>n?`${n} (${o.title})`:o.title,[n,o.title]);return i.jsxs(T,{flexDir:"column",children:[i.jsx(W,{as:"span",fontWeight:"semibold",children:a}),i.jsxs(W,{opacity:.7,children:[r("nodes.nodePack"),": ",o.nodePack]}),i.jsx(W,{opacity:.7,fontStyle:"oblique 5deg",children:o.description}),i.jsx(xOe,{nodeVersion:s,templateVersion:o.version}),t&&i.jsx(W,{children:t})]})});pX.displayName="TooltipContent";const xOe=({nodeVersion:e,templateVersion:t})=>{const{t:n}=M();return d5(e,t,"<")?i.jsxs(W,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateNode"),")"]}):d5(e,t,">")?i.jsxs(W,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateApp"),")"]}):i.jsxs(W,{as:"span",children:[n("nodes.version")," ",e]})},H2=3,z3={circle:{transitionProperty:"none",transitionDuration:"0s"},".chakra-progress__track":{stroke:"transparent"}},yOe=({nodeId:e})=>{const t=ok(e);return t?i.jsx(Oe,{label:i.jsx(fX,{nodeExecutionState:t}),placement:"top",children:i.jsx(T,{className:xm,w:5,h:"full",alignItems:"center",justifyContent:"flex-end",children:i.jsx(mX,{nodeExecutionState:t})})}):null},bOe=c.memo(yOe),fX=c.memo(({nodeExecutionState:e})=>{const{status:t,progress:n,progressImage:s}=e,{t:o}=M();return t===ti.enum.PENDING?i.jsx(W,{children:o("queue.pending")}):t===ti.enum.IN_PROGRESS?s?i.jsxs(T,{pos:"relative",pt:1.5,pb:.5,children:[i.jsx(Zt,{src:s.dataURL,w:32,h:32,borderRadius:"base",objectFit:"contain"}),n!==null&&i.jsxs(Hn,{variant:"solid",pos:"absolute",top:2.5,insetInlineEnd:1,children:[Math.round(n*100),"%"]})]}):n!==null?i.jsxs(W,{children:[o("nodes.executionStateInProgress")," (",Math.round(n*100),"%)"]}):i.jsx(W,{children:o("nodes.executionStateInProgress")}):t===ti.enum.COMPLETED?i.jsx(W,{children:o("nodes.executionStateCompleted")}):t===ti.enum.FAILED?i.jsx(W,{children:o("nodes.executionStateError")}):null});fX.displayName="TooltipLabel";const mX=c.memo(e=>{const{progress:t,status:n}=e.nodeExecutionState;return n===ti.enum.PENDING?i.jsx(at,{as:dj,boxSize:H2,color:"base.300"}):n===ti.enum.IN_PROGRESS?t===null?i.jsx(u5,{isIndeterminate:!0,size:"14px",color:"base.500",thickness:14,sx:z3}):i.jsx(u5,{value:Math.round(t*100),size:"14px",color:"base.500",thickness:14,sx:z3}):n===ti.enum.COMPLETED?i.jsx(at,{as:wm,boxSize:H2,color:"ok.300"}):n===ti.enum.FAILED?i.jsx(at,{as:_m,boxSize:H2,color:"error.300"}):null});mX.displayName="StatusIcon";const vOe={borderTopRadius:"base",alignItems:"center",justifyContent:"space-between",h:8,textAlign:"center",color:"base.200",borderBottomRadius:"base",'&[data-is-open="true"]':{borderBottomRadius:0},'&[data-is-invalid="true"]':{color:"error.300"}},COe=({nodeId:e,isOpen:t})=>{const n=fOe(e);return i.jsxs(T,{layerStyle:"nodeHeader",sx:vOe,"data-is-open":t,"data-is-invalid":n,children:[i.jsx(p4,{nodeId:e,isOpen:t}),i.jsx(hOe,{nodeId:e}),i.jsx(dX,{nodeId:e}),i.jsxs(T,{alignItems:"center",children:[i.jsx(bOe,{nodeId:e}),i.jsx(hX,{nodeId:e})]}),!t&&i.jsx(gOe,{nodeId:e})]})},wOe=c.memo(COe),SOe={flexDirection:"column",w:"full",h:"full",py:2,gap:1,borderBottomRadius:"base",'&[data-with-footer="true"]':{borderBottomRadius:0},'&[data-with-footer="false"]':{pb:4}},kOe=({nodeId:e,isOpen:t})=>{const n=W9e(e);return i.jsxs(i.Fragment,{children:[i.jsx(wOe,{nodeId:e,isOpen:t}),t&&i.jsxs(i.Fragment,{children:[i.jsx(T,{layerStyle:"nodeBody",sx:SOe,"data-with-footer":n,children:i.jsxs(T,{flexDir:"column",px:2,w:"full",h:"full",children:[i.jsxs(Mi,{gridTemplateColumns:"1fr auto",gridAutoRows:"1fr",children:[i.jsx(gX,{nodeId:e}),i.jsx(bX,{nodeId:e})]}),i.jsx(xX,{nodeId:e}),i.jsx(yX,{nodeId:e})]})}),n&&i.jsx(iOe,{nodeId:e})]})]})},jOe=c.memo(kOe),gX=c.memo(({nodeId:e})=>{const t=H9e(e);return i.jsx(i.Fragment,{children:t.map((n,s)=>i.jsx(vt,{gridColumnStart:1,gridRowStart:s+1,children:i.jsx(Fc,{nodeId:e,fieldName:n,children:i.jsx(Vb,{nodeId:e,fieldName:n})})},`${e}.${n}.input-field`))})});gX.displayName="ConnectionFields";const xX=c.memo(({nodeId:e})=>{const t=G9e(e);return i.jsx(i.Fragment,{children:t.map(n=>i.jsx(Fc,{nodeId:e,fieldName:n,children:i.jsx(Vb,{nodeId:e,fieldName:n})},`${e}.${n}.input-field`))})});xX.displayName="AnyOrDirectFields";const yX=c.memo(({nodeId:e})=>{const t=z9e(e);return i.jsx(i.Fragment,{children:t.map(n=>i.jsx(Fc,{nodeId:e,fieldName:n,children:i.jsx(Vb,{nodeId:e,fieldName:n})},`${e}.${n}.input-field`))})});yX.displayName="MissingFields";const bX=c.memo(({nodeId:e})=>{const t=NU(e);return i.jsx(i.Fragment,{children:t.map((n,s)=>i.jsx(vt,{gridColumnStart:2,gridRowStart:s+1,children:i.jsx(zY,{nodeId:e,fieldName:n,children:i.jsx(XY,{nodeId:e,fieldName:n})})},`${e}.${n}.output-field`))})});bX.displayName="OutputFields";const _Oe=e=>{const t=c.useMemo(()=>he(Xe,s=>{var o;return((o=fu(s,e))==null?void 0:o.nodePack)??null}),[e]);return A(t)},IOe=({nodeId:e,isOpen:t,label:n,type:s})=>{const{t:o}=M(),r=_Oe(e);return i.jsxs(i.Fragment,{children:[i.jsxs(T,{className:xm,layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:t?0:"base",alignItems:"center",h:8,fontWeight:"semibold",fontSize:"sm",children:[i.jsx(p4,{nodeId:e,isOpen:t}),i.jsx(W,{w:"full",textAlign:"center",pe:8,color:"error.300",children:n?`${n} (${s})`:s})]}),t&&i.jsx(T,{layerStyle:"nodeBody",userSelect:"auto",flexDirection:"column",w:"full",h:"full",p:4,gap:1,borderBottomRadius:"base",fontSize:"sm",children:i.jsxs(T,{gap:2,flexDir:"column",children:[i.jsxs(W,{as:"span",children:[o("nodes.unknownNodeType"),":"," ",i.jsx(W,{as:"span",fontWeight:"semibold",children:s})]}),r&&i.jsxs(W,{as:"span",children:[o("nodes.nodePack"),":"," ",i.jsx(W,{as:"span",fontWeight:"semibold",children:r})]})]})})]})},TOe=c.memo(IOe),AOe=e=>{const{data:t,selected:n}=e,{id:s,type:o,isOpen:r,label:a}=t,l=re(ln),d=c.useMemo(()=>!!l[o],[l,o]),u=c.useMemo(()=>he(pu,p=>!!p.find(f=>f.id===s)),[s]);return A(u)?d?i.jsx(_x,{nodeId:s,selected:n,children:i.jsx(jOe,{nodeId:s,isOpen:r})}):i.jsx(_x,{nodeId:s,selected:n,children:i.jsx(TOe,{nodeId:s,isOpen:r,label:a,type:o})}):null},MOe=c.memo(AOe),EOe=e=>{const{id:t,data:n,selected:s}=e,{notes:o,isOpen:r}=n,a=G(),l=c.useCallback(h=>{a(Ele({nodeId:t,value:h.target.value}))},[a,t]),d=c.useMemo(()=>he(pu,h=>!!h.find(p=>p.id===t)),[t]);return A(d)?i.jsxs(_x,{nodeId:t,selected:s,children:[i.jsxs(T,{layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:r?0:"base",alignItems:"center",justifyContent:"space-between",h:8,children:[i.jsx(p4,{nodeId:t,isOpen:r}),i.jsx(dX,{nodeId:t,title:"Notes"}),i.jsx(Ce,{minW:8})]}),r&&i.jsx(i.Fragment,{children:i.jsx(T,{layerStyle:"nodeBody",className:co,cursor:"auto",flexDirection:"column",borderBottomRadius:"base",w:"full",h:"full",p:2,gap:1,children:i.jsx(T,{className:co,w:"full",h:"full",flexDir:"column",children:i.jsx(ls,{className:tt,value:o,onChange:l,rows:8,resize:"none",fontSize:"sm"})})})})]}):null},POe=c.memo(EOe),LOe={collapsed:x9e,default:S9e},DOe={invocation:MOe,current_image:A9e,notes:POe},ROe={hideAttribution:!0},OOe=[25,25],NOe=e=>e.cancelConnection,vX=c.memo(()=>{const e=G(),t=A(pu),n=A(Ple),s=re(h5),o=re(p5),r=A(Lle),a=A(Dle),l=A(wD),d=A(SD),{onConnectStart:u,onConnect:h,onConnectEnd:p}=t9e(),f=c.useRef(null),m=n9e(),g=Rle(NOe),x=Ik(),b=Tc(),C=Os("workflows"),y=jr();bm("workflows",f),Ole();const[v]=ek("radii",["base"]),w=c.useMemo(()=>({borderRadius:v}),[v]),k=c.useCallback(H=>{e(Od(H));const z=Op.get();z&&o&&(p5.set(!1),z.fitView())},[e,o]),S=c.useCallback(H=>{H.length>0&&e(Qo(H))},[e]),P=c.useCallback((H,z)=>{h5.set(z)},[]),{onCloseGlobal:E}=tm(),L=c.useCallback(()=>{E()},[E]),I=c.useCallback(H=>{Op.set(H),H.fitView()},[]),O=c.useCallback(H=>{var z,Z;(z=f.current)!=null&&z.getBoundingClientRect()&&_k.set(((Z=Op.get())==null?void 0:Z.screenToFlowPosition({x:H.clientX,y:H.clientY}))??null)},[]),N=c.useCallback((H,z,Z)=>{ec.set(z),Cd.set(!1),Qb.set(H)},[]),_=c.useCallback((H,z)=>{Cd.set(!0);const Z=jx(z);e(Qo([{type:"remove",id:H.id},{type:"add",item:Z}])),x([H.source,H.target,Z.source,Z.target])},[e,x]),R=c.useCallback((H,z,Z)=>{const U=Cd.get(),Y=Qb.get()??{clientX:0,clientY:0},$=!("touches"in H)&&Math.hypot(H.clientX-Y.clientX,H.clientY-Y.clientY)>5;!U&&$&&e(Qo([{type:"remove",id:z.id}])),ec.set(null),Cd.set(!1),Ci.set(null),Qb.set(null)},[e]),{copySelection:D,pasteSelection:B,pasteSelectionWithEdges:V}=a9e();De({id:"copySelection",category:"workflows",callback:D,options:{enabled:C&&!y,preventDefault:!0},dependencies:[D]});const ee=c.useCallback(()=>{const{nodes:H,edges:z}=Xe(b.getState()),Z=[],U=[];H.forEach(({id:Y,selected:$})=>{$||Z.push({type:"select",id:Y,selected:!0})}),z.forEach(({id:Y,selected:$})=>{$||U.push({type:"select",id:Y,selected:!0})}),Z.length>0&&e(Od(Z)),U.length>0&&e(Qo(U))},[e,b]);De({id:"selectAll",category:"workflows",callback:ee,options:{enabled:C&&!y,preventDefault:!0},dependencies:[ee,C,y]}),De({id:"pasteSelection",category:"workflows",callback:B,options:{enabled:C&&!y,preventDefault:!0},dependencies:[B,y,C]}),De({id:"pasteSelectionWithEdges",category:"workflows",callback:V,options:{enabled:C&&!y,preventDefault:!0},dependencies:[V,y,C]}),De({id:"undo",category:"workflows",callback:()=>{e(Nle())},options:{enabled:C&&!y&&r,preventDefault:!0},dependencies:[r,y,C]}),De({id:"redo",category:"workflows",callback:()=>{e(Fle())},options:{enabled:C&&!y&&a,preventDefault:!0},dependencies:[a,y,C]});const se=c.useCallback(()=>{ec.get()||(Ci.set(null),Rd.set(!1),g())},[g]);Eo("esc",se);const oe=c.useCallback(()=>{const{nodes:H,edges:z}=Xe(b.getState()),Z=[],U=[];H.filter(Y=>Y.selected).forEach(({id:Y})=>{Z.push({type:"remove",id:Y})}),z.filter(Y=>Y.selected).forEach(({id:Y})=>{U.push({type:"remove",id:Y})}),Z.length>0&&e(Od(Z)),U.length>0&&e(Qo(U))},[e,b]);De({id:"deleteSelection",category:"workflows",callback:oe,options:{preventDefault:!0,enabled:C&&!y},dependencies:[oe,C,y]});const te=c.useCallback((H,z)=>{if(!Xa.get()||!Rn(z))return;const{id:Z}=z.data;sa.set(Z),Xa.set(!1)},[]);return i.jsx(Ble,{id:"workflow-editor",ref:f,defaultViewport:s,nodeTypes:DOe,edgeTypes:LOe,nodes:t,edges:n,onInit:I,onNodeClick:te,onMouseMove:O,onNodesChange:k,onEdgesChange:S,onReconnect:_,onReconnectStart:N,onReconnectEnd:R,onConnectStart:u,onConnect:h,onConnectEnd:p,onMoveEnd:P,connectionLineComponent:d9e,isValidConnection:m,edgesFocusable:!y,edgesReconnectable:!y,nodesDraggable:!y,nodesConnectable:!y,nodesFocusable:!y,elementsSelectable:!y,minZoom:.1,snapToGrid:l,snapGrid:OOe,connectionRadius:30,proOptions:ROe,style:w,onPaneClick:L,deleteKeyCode:null,selectionMode:d,elevateEdgesOnSelect:!0,nodeDragThreshold:1,noDragClassName:tt,noWheelClassName:Gt,noPanClassName:co,children:i.jsx($le,{})})});vX.displayName="Flow";const FOe=()=>{const e=G(),t=A(PD),{t:n}=M(),s=c.useCallback(o=>{e(Vle(o))},[e]);return i.jsx(T,{alignItems:"center",children:i.jsx(Ze,{"aria-label":n("nodes.nodeOpacity"),value:t,defaultValue:1,min:.5,max:1,step:.01,onChange:s,orientation:"vertical",h:"calc(100% - 0.5rem)"})})},BOe=c.memo(FOe),$Oe=()=>{const{t:e}=M(),{zoomIn:t,zoomOut:n,fitView:s}=zle(),o=G(),r=A(RD),a=c.useCallback(()=>{t({duration:300})},[t]),l=c.useCallback(()=>{n({duration:300})},[n]),d=c.useCallback(()=>{s({duration:300})},[s]),u=c.useCallback(()=>{o(Gle(!r))},[r,o]);return i.jsxs(Qn,{orientation:"vertical",children:[i.jsx(le,{tooltip:e("nodes.zoomInNodes"),"aria-label":e("nodes.zoomInNodes"),onClick:a,icon:i.jsx(D7,{})}),i.jsx(le,{tooltip:e("nodes.zoomOutNodes"),"aria-label":e("nodes.zoomOutNodes"),onClick:l,icon:i.jsx(L7,{})}),i.jsx(le,{tooltip:e("nodes.fitViewportNodes"),"aria-label":e("nodes.fitViewportNodes"),onClick:d,icon:i.jsx(Sm,{})}),i.jsx(le,{tooltip:e(r?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),"aria-label":e(r?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),isChecked:r,onClick:u,icon:i.jsx(rfe,{})})]})},VOe=c.memo($Oe),zOe=()=>i.jsxs(T,{gap:2,position:"absolute",bottom:2,insetInlineStart:2,children:[i.jsx(VOe,{}),i.jsx(BOe,{})]}),GOe=c.memo(zOe),HOe=Sr(Hle),WOe={m:"0 !important",borderRadius:"base",backgroundColor:"base.500 !important",svg:{borderRadius:"inherit"}},UOe=()=>{const e=A(RD);return i.jsx(T,{gap:2,position:"absolute",bottom:2,insetInlineEnd:2,children:e&&i.jsx(HOe,{pannable:!0,zoomable:!0,nodeBorderRadius:15,sx:WOe,nodeColor:"var(--invoke-colors-base-600)",maskColor:"var(--invoke-colors-blackAlpha-600)"})})},qOe=c.memo(UOe),KOe={display:"flex",position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center"},ZOe=()=>{const{data:e,isLoading:t}=Rx(),{t:n}=M();return i.jsxs($u,{region:"workflows",layerStyle:"first",sx:KOe,children:[e&&i.jsxs(i.Fragment,{children:[i.jsx(vX,{}),i.jsx(LY,{}),i.jsx(NY,{}),i.jsx(OY,{}),i.jsx(BY,{}),i.jsx(GOe,{}),i.jsx(qOe,{})]}),i.jsx(e9e,{}),t&&i.jsx(Ot,{label:n("nodes.loadingNodes"),icon:_y})]})},YOe=c.memo(ZOe),CX=c.memo(()=>A(kr)==="edit"?i.jsx(Wle,{children:i.jsx(YOe,{})}):i.jsx(cb,{}));CX.displayName="WorkflowsMainPanel";const wX="data:image/svg+xml,%3csvg%20width='44'%20height='44'%20viewBox='0%200%2044%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.1951%2010.6667H42V2H2V10.6667H14.8049L29.1951%2033.3333H42V42H2V33.3333H14.8049'%20stroke='%23E6FD13'%20stroke-width='2.8'/%3e%3c/svg%3e",XOe=()=>{const{data:e}=cy(),t=c.useRef(null),n=re(Ule),s=c.useMemo(()=>e?i.jsxs(W,{fontWeight:"semibold",children:["v",e.version]}):null,[e]);return n||i.jsx(Oe,{placement:"right",label:s,p:1,px:2,gutter:16,children:i.jsx(Zt,{ref:t,src:wX,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"})})},QOe=c.memo(XOe),JOe="data:image/svg+xml,%3csvg%20width='231'%20height='100'%20viewBox='0%200%20231%20100'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_659_3578)'%3e%3crect%20width='100'%20height='100'%20fill='%23E6FD13'/%3e%3cpath%20d='M57.1951%2038.6667H70V30H30V38.6667H42.8049L57.1951%2061.3333H70V70H30V61.3333H42.8049'%20stroke='%23181818'%20stroke-width='2.8'/%3e%3crect%20width='131'%20height='100'%20transform='translate(100)'%20fill='%23E6FD13'/%3e%3cpath%20d='M111.37%2043.34H107.89V39.65H111.37V43.34ZM116.38%2060.5H102.76V58.16H108.22V47.84H103.36V45.5H111.07V58.16H116.38V60.5ZM120.538%2060.5V45.5H123.388V47.6C124.288%2046.25%20125.788%2045.2%20128.188%2045.2C131.638%2045.2%20133.588%2047.3%20133.588%2050.45V60.5H130.738V51.05C130.738%2048.95%20129.838%2047.6%20127.708%2047.6H127.468C125.338%2047.6%20123.388%2049.25%20123.388%2052.1V60.5H120.538ZM141.786%2060.5L136.236%2045.5H139.176L143.526%2057.71L147.876%2045.5H150.786L145.236%2060.5H141.786ZM159.723%2060.8C155.673%2060.8%20152.523%2057.65%20152.523%2053C152.523%2048.35%20155.673%2045.2%20159.723%2045.2C163.773%2045.2%20166.923%2048.35%20166.923%2053C166.923%2057.65%20163.773%2060.8%20159.723%2060.8ZM155.373%2053C155.373%2056.45%20157.173%2058.4%20159.603%2058.4H159.843C162.273%2058.4%20164.073%2056.45%20164.073%2053C164.073%2049.55%20162.273%2047.6%20159.843%2047.6H159.603C157.173%2047.6%20155.373%2049.55%20155.373%2053ZM170.804%2060.5V39.5H173.654V51.98L180.254%2045.5H184.004L177.764%2051.47L184.304%2060.5H180.794L175.724%2053.42L173.654%2055.43V60.5H170.804ZM192.459%2060.8C188.739%2060.8%20185.379%2058.22%20185.379%2052.97C185.379%2047.78%20188.829%2045.2%20192.369%2045.2C196.269%2045.2%20198.729%2047.9%20198.729%2051.8V53.45H188.229C188.409%2056.87%20190.599%2058.4%20192.429%2058.4H192.669C194.139%2058.4%20195.549%2057.65%20195.849%2056.06H198.699C198.159%2059.09%20195.549%2060.8%20192.459%2060.8ZM188.409%2051.2H195.879C195.759%2048.59%20194.199%2047.6%20192.489%2047.6H192.249C190.689%2047.6%20188.949%2048.53%20188.409%2051.2Z'%20fill='%23181818'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_659_3578'%3e%3crect%20width='231'%20height='100'%20rx='5'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",eNe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=hi(),{t:o}=M(),{data:r}=qle(),{data:a}=Kle(),{data:l}=cy(),d=c.useMemo(()=>{const u=gt(r);return u&&u.config.remote_api_tokens&&u.config.remote_api_tokens.forEach(h=>{h.token="REDACTED"}),{version:l==null?void 0:l.version,dependencies:a,config:u==null?void 0:u.config,set_config_fields:u==null?void 0:u.set_fields}},[l,a,r]);return i.jsxs(i.Fragment,{children:[c.cloneElement(e,{onClick:n}),i.jsxs(Oi,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,children:[i.jsx(di,{}),i.jsxs(Ni,{maxH:"80vh",h:"34rem",children:[i.jsx(ui,{children:o("accessibility.about")}),i.jsx(Do,{}),i.jsx(Ks,{display:"flex",flexDir:"column",gap:4,children:i.jsxs(Mi,{templateColumns:"repeat(2, 1fr)",h:"full",children:[i.jsx(vt,{backgroundColor:"base.750",borderRadius:"base",p:"4",h:"full",children:i.jsx(br,{label:o("common.systemInformation"),data:d})}),i.jsx(vt,{children:i.jsxs(T,{flexDir:"column",gap:3,justifyContent:"center",alignItems:"center",h:"full",children:[i.jsx(Zt,{src:JOe,alt:"invoke-logo",w:"120px"}),l&&i.jsx(W,{children:`v${l==null?void 0:l.version}`}),i.jsxs(Mi,{templateColumns:"repeat(2, 1fr)",gap:"3",children:[i.jsx(vt,{children:i.jsx(ii,{href:ow,label:o("common.githubLabel")})}),i.jsx(vt,{children:i.jsx(ii,{href:Hj,label:o("common.discordLabel")})})]}),i.jsx(zt,{fontSize:"large",children:o("common.aboutHeading")}),i.jsx(W,{fontSize:"sm",children:o("common.aboutDesc")}),i.jsx(ii,{href:l6,label:l6})]})})]})}),i.jsx(wr,{})]})]})]})},tNe=c.memo(eNe),nNe=({hotkey:e})=>{const{t}=M(),{id:n,platformKeys:s,title:o,desc:r}=e;return i.jsxs(T,{flexDir:"column",gap:2,px:2,children:[i.jsxs(T,{lineHeight:1,gap:1,alignItems:"center",children:[i.jsx(W,{fontWeight:"semibold",children:o}),i.jsx(Je,{}),s.map((a,l)=>i.jsxs(c.Fragment,{children:[a.map((d,u)=>i.jsxs(c.Fragment,{children:[i.jsx(kp,{textTransform:"lowercase",children:d}),u!==a.length-1&&i.jsx(W,{as:"span",fontWeight:"semibold",children:"+"})]},`${n}-${d}-${l}-${u}`)),l!==s.length-1&&i.jsx(W,{as:"span",px:2,variant:"subtext",fontWeight:"semibold",children:t("common.or")})]},`${n}-${l}`))]}),i.jsx(W,{variant:"subtext",children:r})]})},sNe=c.memo(nNe),iNe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=hi(),{t:o}=M(),[r,a]=c.useState(""),l=c.useRef(null),d=c.useCallback(()=>a(""),[]),u=c.useCallback(f=>a(f.target.value),[]),h=oR(),p=c.useMemo(()=>{const f=r.trim().toLowerCase(),m=[];return Object.values(h).forEach(g=>{const x={title:g.title,hotkeys:[]};Object.values(g.hotkeys).forEach(b=>{b.isEnabled&&(f.length?(b.title.toLowerCase().includes(f)||b.desc.toLowerCase().includes(f)||b.category.toLowerCase().includes(f)||b.platformKeys.some(C=>C.some(y=>y.toLowerCase().includes(f))))&&x.hotkeys.push(b):x.hotkeys.push(b))}),x.hotkeys.length&&m.push(x)}),m},[h,r]);return i.jsxs(i.Fragment,{children:[c.cloneElement(e,{onClick:n}),i.jsxs(Oi,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,initialFocusRef:l,children:[i.jsx(di,{}),i.jsxs(Ni,{maxH:"80vh",h:"80vh",children:[i.jsx(ui,{children:o("hotkeys.hotkeys")}),i.jsx(Do,{}),i.jsxs(Ks,{display:"flex",flexDir:"column",gap:4,children:[i.jsxs(Cr,{children:[i.jsx(St,{ref:l,placeholder:o("hotkeys.searchHotkeys"),value:r,onChange:u}),r.length&&i.jsx(Mo,{h:"full",pe:2,children:i.jsx(le,{onClick:d,size:"sm",variant:"ghost","aria-label":o("hotkeys.clearSearch"),boxSize:4,icon:i.jsx(Rt,{})})})]}),i.jsx(ns,{children:i.jsxs(T,{flexDir:"column",gap:4,children:[p.map(f=>i.jsx(Ko,{title:f.title,children:f.hotkeys.map((m,g)=>i.jsxs(c.Fragment,{children:[i.jsx(sNe,{hotkey:m}),g<f.hotkeys.length-1&&i.jsx(Ct,{})]},m.id))},f.title)),!p.length&&i.jsx(Ot,{label:o("hotkeys.noHotkeysFound"),icon:null})]})})]}),i.jsx(wr,{})]})]})]})},oNe=c.memo(iNe);function rNe(e){return pe({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M19.3034 5.33716C17.9344 4.71103 16.4805 4.2547 14.9629 4C14.7719 4.32899 14.5596 4.77471 14.411 5.12492C12.7969 4.89144 11.1944 4.89144 9.60255 5.12492C9.45397 4.77471 9.2311 4.32899 9.05068 4C7.52251 4.2547 6.06861 4.71103 4.70915 5.33716C1.96053 9.39111 1.21766 13.3495 1.5891 17.2549C3.41443 18.5815 5.17612 19.388 6.90701 19.9187C7.33151 19.3456 7.71356 18.73 8.04255 18.0827C7.41641 17.8492 6.82211 17.5627 6.24904 17.2231C6.39762 17.117 6.5462 17.0003 6.68416 16.8835C10.1438 18.4648 13.8911 18.4648 17.3082 16.8835C17.4568 17.0003 17.5948 17.117 17.7434 17.2231C17.1703 17.5627 16.576 17.8492 15.9499 18.0827C16.2789 18.73 16.6609 19.3456 17.0854 19.9187C18.8152 19.388 20.5875 18.5815 22.4033 17.2549C22.8596 12.7341 21.6806 8.80747 19.3034 5.33716ZM8.5201 14.8459C7.48007 14.8459 6.63107 13.9014 6.63107 12.7447C6.63107 11.5879 7.45884 10.6434 8.5201 10.6434C9.57071 10.6434 10.4303 11.5879 10.4091 12.7447C10.4091 13.9014 9.57071 14.8459 8.5201 14.8459ZM15.4936 14.8459C14.4535 14.8459 13.6034 13.9014 13.6034 12.7447C13.6034 11.5879 14.4323 10.6434 15.4936 10.6434C16.5442 10.6434 17.4038 11.5879 17.3825 12.7447C17.3825 13.9014 16.5548 14.8459 15.4936 14.8459Z"},child:[]}]})(e)}function aNe(e){return pe({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.001 2C6.47598 2 2.00098 6.475 2.00098 12C2.00098 16.425 4.86348 20.1625 8.83848 21.4875C9.33848 21.575 9.52598 21.275 9.52598 21.0125C9.52598 20.775 9.51348 19.9875 9.51348 19.15C7.00098 19.6125 6.35098 18.5375 6.15098 17.975C6.03848 17.6875 5.55098 16.8 5.12598 16.5625C4.77598 16.375 4.27598 15.9125 5.11348 15.9C5.90098 15.8875 6.46348 16.625 6.65098 16.925C7.55098 18.4375 8.98848 18.0125 9.56348 17.75C9.65098 17.1 9.91348 16.6625 10.201 16.4125C7.97598 16.1625 5.65098 15.3 5.65098 11.475C5.65098 10.3875 6.03848 9.4875 6.67598 8.7875C6.57598 8.5375 6.22598 7.5125 6.77598 6.1375C6.77598 6.1375 7.61348 5.875 9.52598 7.1625C10.326 6.9375 11.176 6.825 12.026 6.825C12.876 6.825 13.726 6.9375 14.526 7.1625C16.4385 5.8625 17.276 6.1375 17.276 6.1375C17.826 7.5125 17.476 8.5375 17.376 8.7875C18.0135 9.4875 18.401 10.375 18.401 11.475C18.401 15.3125 16.0635 16.1625 13.8385 16.4125C14.201 16.725 14.5135 17.325 14.5135 18.2625C14.5135 19.6 14.501 20.675 14.501 21.0125C14.501 21.275 14.6885 21.5875 15.1885 21.4875C19.259 20.1133 21.9999 16.2963 22.001 12C22.001 6.475 17.526 2 12.001 2Z"},child:[]}]})(e)}const SX=c.memo(()=>{const{t:e}=M(),t=Gx(),n=A(c8),s=c.useCallback(o=>{t(Zle(o.target.checked))},[t]);return i.jsxs(Q,{children:[i.jsx(J,{children:e("system.enableLogging")}),i.jsx(et,{isChecked:n,onChange:s})]})});SX.displayName="SettingsDeveloperLogIsEnabled";const kX=c.memo(()=>{const{t:e}=M(),t=G(),n=A(a8),s=c.useMemo(()=>Yle.options.map(a=>({label:e(`system.logLevel.${a}`),value:a})),[e]),o=c.useMemo(()=>s.find(a=>a.value===n),[n,s]),r=c.useCallback(a=>{Xle(a==null?void 0:a.value)&&t(Qle(a.value))},[t]);return i.jsxs(Q,{children:[i.jsx(J,{children:e("system.logLevel.logLevel")}),i.jsx(Ke,{value:o,options:s,onChange:r,isSearchable:!1})]})});kX.displayName="SettingsDeveloperLogLevel";const jX=c.memo(()=>{const{t:e}=M(),t=A(l8),n=c.useMemo(()=>ede(Jle.options,t),[t]);return i.jsxs(Q,{orientation:"vertical",children:[i.jsx(J,{children:e("system.logNamespaces.logNamespaces")}),i.jsx(T,{w:"full",gap:2,flexWrap:"wrap",minH:"32px",borderRadius:"base",borderWidth:1,p:2,alignItems:"center",children:t.map(s=>i.jsx(G3,{namespace:s,isEnabled:!0},`enabled-${s}`))}),i.jsx(T,{gap:2,flexWrap:"wrap",children:n.map(s=>i.jsx(G3,{namespace:s,isEnabled:!1},`disabled-${s}`))})]})});jX.displayName="SettingsDeveloperLogNamespaces";const G3=({namespace:e,isEnabled:t})=>{const{t:n}=M(),s=Gx(),o=c.useCallback(()=>{s(ece(e))},[s,e]);return i.jsxs(ey,{h:"min-content",borderRadius:"base",onClick:o,colorScheme:t?"invokeBlue":"base",userSelect:"none",role:"button",size:"md",color:"base.900",bg:t?"invokeBlue.300":"base.300",children:[i.jsx(W,{fontSize:"sm",fontWeight:"semibold",children:n(`system.logNamespaces.${e}`)}),t&&i.jsx(ty,{})]})},lNe=e=>{const{t}=M(),{data:n,refetch:s}=tce(void 0,{refetchOnMountOrArgChange:!0,skip:!e}),[o,{isLoading:r}]=nce(),{data:a}=uo(),l=c.useMemo(()=>!!(a&&(a.queue.in_progress>0||a.queue.pending>0)),[a]),d=c.useCallback(()=>{l||o().unwrap().then(u=>{ge({id:"INTERMEDIATES_CLEARED",title:t("settings.intermediatesCleared",{count:u}),status:"info"})}).catch(()=>{ge({id:"INTERMEDIATES_CLEAR_FAILED",title:t("settings.intermediatesClearedFailed"),status:"error"})})},[t,o,l]);return{intermediatesCount:n,clearIntermediates:d,isLoading:r,hasPendingItems:l,refetchIntermediatesCount:s}},cNe=Ve.enum(["ar","az","de","en","es","fi","fr","he","hu","it","ja","ko","nl","pl","pt","pt_BR","ru","sv","tr","ua","vi","zh_CN","zh_Hant"]),dNe=e=>cNe.safeParse(e).success,uNe={ar:"",az:"Azrbaycan dili",de:"Deutsch",en:"English",es:"Espaol",fi:"Suomi",fr:"Franais",he:"",hu:"Magyar Nyelv",it:"Italiano",ja:"",ko:"",nl:"Nederlands",pl:"Polski",pt:"Portugus",pt_BR:"Portugus do Brasil",ru:"",sv:"Svenska",tr:"Trke",ua:"",vi:"Ting Vit",zh_CN:"",zh_Hant:""},H3=mr(uNe,(e,t)=>({label:e,value:t})),_X=c.memo(()=>{const{t:e}=M(),t=G(),n=A(D9),s=Bt("localization"),o=c.useMemo(()=>H3.find(a=>a.value===n),[n]),r=c.useCallback(a=>{dNe(a==null?void 0:a.value)&&t(sce(a.value))},[t]);return i.jsxs(Q,{isDisabled:!s,children:[i.jsx(J,{children:e("common.languagePickerLabel")}),i.jsx(Ke,{value:o,options:H3,onChange:r})]})});_X.displayName="SettingsLanguageSelect";const hNe={shouldShowDeveloperSettings:!0,shouldShowResetWebUiText:!0,shouldShowClearIntermediates:!0,shouldShowLocalizationToggle:!0,shouldShowInvocationProgressDetailSetting:!0},[pNe]=jc(!1),fNe=({config:e=hNe,children:t})=>{const n=G(),{t:s}=M(),{isNSFWCheckerAvailable:o,isWatermarkerAvailable:r}=aD(void 0,{selectFromResult:({data:te})=>({isNSFWCheckerAvailable:(te==null?void 0:te.nsfw_methods.includes("nsfw_checker"))??!1,isWatermarkerAvailable:(te==null?void 0:te.watermarking_methods.includes("invisible_watermark"))??!1})}),{clearIntermediates:a,hasPendingItems:l,intermediatesCount:d,isLoading:u,refetchIntermediatesCount:h}=lNe(!!(e!=null&&e.shouldShowClearIntermediates)),p=pNe(),f=AN(),m=A(ice),g=A(oce),x=A(Pk),b=A(rce),C=A(ace),y=A(lce),v=A(cce),w=A(Ux),k=A(IP),S=A(Jf),P=A(fL),E=c.useCallback(()=>{n(LS())},[n]),L=zN();c.useEffect(()=>{p.isTrue&&(e!=null&&e.shouldShowClearIntermediates)&&h()},[e==null?void 0:e.shouldShowClearIntermediates,h,p.isTrue]);const I=c.useCallback(()=>{L(),p.setFalse(),f.setTrue()},[L,p,f]),O=c.useCallback(te=>{n(oP(te.target.checked))},[n]),N=c.useCallback(te=>{n(dce(te.target.checked))},[n]),_=c.useCallback(te=>{n(uce(te.target.checked))},[n]),R=c.useCallback(te=>{n(xL(te.target.checked))},[n]),D=c.useCallback(te=>{n(hce(te.target.checked))},[n]),B=c.useCallback(te=>{n(dP(te.target.checked))},[n]),V=c.useCallback(te=>{n(pce(te.target.checked))},[n]),ee=c.useCallback(te=>{n(fce(te.target.checked))},[n]),se=c.useCallback(te=>{n(mce(te.target.checked))},[n]),oe=c.useCallback(te=>{n(gce(te.target.checked))},[n]);return i.jsxs(i.Fragment,{children:[c.cloneElement(t,{onClick:p.setTrue}),i.jsxs(Oi,{isOpen:p.isTrue,onClose:p.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[i.jsx(di,{}),i.jsxs(Ni,{maxH:"80vh",h:"68rem",children:[i.jsx(ui,{bg:"none",children:s("common.settingsLabel")}),i.jsx(Do,{}),i.jsx(Ks,{display:"flex",flexDir:"column",gap:4,children:i.jsx(ns,{children:i.jsx(T,{flexDir:"column",gap:4,children:i.jsxs(Es,{formLabelProps:{flexGrow:1},children:[i.jsxs(Ko,{title:s("settings.general"),children:[i.jsxs(Q,{children:[i.jsx(J,{children:s("settings.confirmOnDelete")}),i.jsx(et,{isChecked:g,onChange:O})]}),i.jsxs(Q,{children:[i.jsx(J,{children:s("settings.confirmOnNewSession")}),i.jsx(et,{isChecked:S,onChange:E})]})]}),i.jsxs(Ko,{title:s("settings.generation"),children:[i.jsxs(Q,{isDisabled:!o,children:[i.jsx(J,{children:s("settings.enableNSFWChecker")}),i.jsx(et,{isChecked:C,onChange:N})]}),i.jsxs(Q,{isDisabled:!r,children:[i.jsx(J,{children:s("settings.enableInvisibleWatermark")}),i.jsx(et,{isChecked:y,onChange:_})]})]}),i.jsxs(Ko,{title:s("settings.ui"),children:[i.jsxs(Q,{children:[i.jsx(J,{children:s("settings.showProgressInViewer")}),i.jsx(et,{isChecked:x,onChange:R})]}),i.jsxs(Q,{children:[i.jsx(J,{children:s("settings.antialiasProgressImages")}),i.jsx(et,{isChecked:b,onChange:D})]}),!!(e!=null&&e.shouldShowInvocationProgressDetailSetting)&&i.jsxs(Q,{children:[i.jsx(J,{children:s("settings.showDetailedInvocationProgress")}),i.jsx(et,{isChecked:P,onChange:se})]}),i.jsxs(Q,{children:[i.jsx($e,{feature:"noiseUseCPU",inPortal:!1,children:i.jsx(J,{children:s("parameters.useCpuNoise")})}),i.jsx(et,{isChecked:m,onChange:ee})]}),!!(e!=null&&e.shouldShowLocalizationToggle)&&i.jsx(_X,{}),i.jsxs(Q,{children:[i.jsx(J,{children:s("settings.enableInformationalPopovers")}),i.jsx(et,{isChecked:v,onChange:B})]}),i.jsxs(Q,{children:[i.jsx(J,{children:s("settings.enableModelDescriptions")}),i.jsx(et,{isChecked:w,onChange:V})]}),i.jsxs(Q,{children:[i.jsx(J,{children:s("settings.enableHighlightFocusedRegions")}),i.jsx(et,{isChecked:k,onChange:oe})]})]}),!!(e!=null&&e.shouldShowDeveloperSettings)&&i.jsxs(Ko,{title:s("settings.developer"),children:[i.jsx(SX,{}),i.jsx(kX,{}),i.jsx(jX,{})]}),!!(e!=null&&e.shouldShowClearIntermediates)&&i.jsxs(Ko,{title:s("settings.clearIntermediates"),children:[i.jsx(de,{tooltip:l?s("settings.clearIntermediatesDisabled"):void 0,colorScheme:"warning",onClick:a,isLoading:u,isDisabled:!d||l,children:s("settings.clearIntermediatesWithCount",{count:d??0})}),i.jsx(W,{fontWeight:"bold",children:s("settings.clearIntermediatesDesc1")}),i.jsx(W,{variant:"subtext",children:s("settings.clearIntermediatesDesc2")}),i.jsx(W,{variant:"subtext",children:s("settings.clearIntermediatesDesc3")})]}),i.jsxs(Ko,{title:s("settings.resetWebUI"),children:[i.jsx(de,{colorScheme:"error",onClick:I,children:s("settings.resetWebUI")}),!!(e!=null&&e.shouldShowResetWebUiText)&&i.jsxs(i.Fragment,{children:[i.jsx(W,{variant:"subtext",children:s("settings.resetWebUIDesc1")}),i.jsx(W,{variant:"subtext",children:s("settings.resetWebUIDesc2")})]})]})]})})})}),i.jsx(wr,{})]})]})]})},mNe=c.memo(fNe),W3=({menuText:e,menuIcon:t})=>{const{t:n}=M();return i.jsx(Oe,{label:n("upsell.professionalUpsell"),placement:"right",gutter:16,children:i.jsx(fe,{as:"a",href:"http://invoke.com/pricing",target:"_blank",icon:t,children:i.jsxs(T,{gap:"1",alignItems:"center",justifyContent:"space-between",children:[i.jsx(W,{children:e}),i.jsx(at,{as:b7,color:"invokeYellow.500"})]})})})},gNe=()=>{const{t:e}=M(),{isOpen:t,onOpen:n,onClose:s}=hi();tm(s);const o=Bt("bugLink"),r=Bt("discordLink"),a=Bt("githubLink");return i.jsxs(on,{isOpen:t,onOpen:n,onClose:s,autoSelect:!1,children:[i.jsx(rn,{as:le,variant:"link","aria-label":e("accessibility.menu"),icon:i.jsx(Im,{fontSize:20}),boxSize:8}),i.jsx(al,{children:i.jsxs(Et,{children:[i.jsxs(ki,{title:e("upsell.professional"),children:[i.jsx(W3,{menuText:e("upsell.inviteTeammates"),menuIcon:i.jsx(cj,{})}),i.jsx(W3,{menuText:e("upsell.shareAccess"),menuIcon:i.jsx(Sfe,{})})]}),i.jsxs(ki,{title:e("common.communityLabel"),children:[a&&i.jsx(fe,{as:"a",href:ow,target:"_blank",icon:i.jsx(aNe,{}),children:e("common.githubLabel")}),o&&i.jsx(fe,{as:"a",href:`${ow}/issues`,target:"_blank",icon:i.jsx(Fpe,{}),children:e("common.reportBugLabel")}),r&&i.jsx(fe,{as:"a",href:Hj,target:"_blank",icon:i.jsx(rNe,{}),children:e("common.discordLabel")})]}),i.jsxs(ki,{title:e("common.settingsLabel"),children:[i.jsx(oNe,{children:i.jsx(fe,{as:"button",icon:i.jsx(Jpe,{}),children:e("common.hotkeysLabel")})}),i.jsx(mNe,{children:i.jsx(fe,{as:"button",icon:i.jsx(kfe,{}),children:e("common.settingsLabel")})})]}),i.jsx(ki,{title:e("accessibility.about"),children:i.jsx(tNe,{children:i.jsx(fe,{as:"button",icon:i.jsx(Ru,{}),children:e("accessibility.about")})})})]})})]})},xNe=c.memo(gNe),yNe=()=>{const e=re(Jn),{t}=M();return e?null:i.jsx(Oe,{label:t("common.statusDisconnected"),placement:"end",shouldWrapChildren:!0,gutter:10,children:i.jsx(at,{as:_m,color:"error.300"})})},bNe=c.memo(yNe),IX=c.memo(()=>{const{t:e}=M(),t=G(),n=DN(),s=c.useCallback(()=>{t(fye()),n.open()},[n,t]);return i.jsx(le,{"aria-label":e("supportVideos.supportVideos"),variant:"link",icon:i.jsx(_fe,{fontSize:20}),boxSize:8,onClick:s})});IX.displayName="VideosModalButton";const gd=c.memo(({tab:e,children:t})=>{const n=c.useMemo(()=>he(Ri,o=>!o.disabledTabs.includes(e)),[e]);return A(n)?t:null});gd.displayName="TabMountGate";const vNe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANISURBVHgB7ZvBSxRRHMe/763rmolu1CEjcaWjB4WgyEuuEHRTQroGgtcyvLdud1O7Ch46RoHegqDyIhQE+w+EE0J2KBhNMl13Xu83pc6sovMcZ97gmw8s7Lx97PL77e/7e7/3ezMMdayKS/3CwSAghuRlAWcAwVgFQlQ4z5bb2XfL+xnbfbMsCvkc1ktw2BjOMpxNb6Gl3MUsmy5dB5DxjWLjPROiFwZAEbHNWorkBE4D9M+bYjxBtuawUXLfr4rLBeFUl2EgzGFFDqdagqHUuBjiAsyY0K9H6n+QfatdFDAYDsNJHQDDMd4BDVDkSuYnkoxM6krzUwnAcNIcgJCoau60CZuTUgnAcEJLYGlxJ9C8tjaG7t4MgrJiOVj56iBqQjtgeGAt0LzWPMPbz3l0FIIF3csXW5gs/0bUxCaBdVvg8cgGkkasOWBpsYo3C9tIEsoS6OvPKs13tWzV9q7HZBR8+nLBlcRRXO3kyr91EiJviJAD7lxfkxLYT2ijD5tQnjqPJBC5BCjpjT7K+cZmn/8JvHpETWwtsZvXbJ8UyDG0KhwnhaiJLQlOzflDnqRBkaCb2BzQdzsrpdDkG6N1nhyhk1iXwfEnzTL0/dWg7togVgeQ3svPmn1jVBvMzuiTgpZzgeGBddfwXVTL5NNEy25waq5FGr3/0zrLZC0OoH96vHTON6arTNZ6NFYvBR21gdaGCEnBCy2JcWyBvWh1wGFSiLtM1n46TAmQNkv1ZfJHuWOMA+09QdL7YWXy5NNNxEEimqKHlcmzM5uxlMnKEqDMrcr9Bzn3dRQkhRtyx+jtG5AUOjqDN1KJV+9aleYrd4S8y1ZQbgXo7JAUpqUURu792hv7102KNgoSdS5wd7DRlUOcJO5gpL5MjprQ5wJBNKeiY9L9a/mda3aw0D9JTvIS2gFRhGx3DzlMLfmdlPRwFIYTWgJJv2foOFIJwHDSHABFdN8TdNqkEoDhpA6A4ZADLJgKYxUu91wLMBRBT5NmHDYPQ+G8Vubt2R8fHAczMAyyuZ3ZlpsEqw21CTBRgSHQo7Ouzfi/CnQx295iTtGESCAbt9lOkWym6wOnkKsiXxC1zAQ468HZeZ7YkoYvZMDmSfLeD/4CAK41g1vx5woAAAAASUVORK5CYII=",CNe=he(Ri,e=>e.isLocal),wNe={StrongComponent:i.jsx(W,{as:"span",color:"white",fontSize:"sm",fontWeight:"semibold"})},SNe=()=>{const{t:e}=M(),{data:t}=cy(),n=A(CNe),s=re(xce),o=c.useMemo(()=>{var a;return s||((a=t==null?void 0:t.highlights)!=null&&a.length?t.highlights.map((l,d)=>i.jsx(Ft,{children:l},`${l}-${d}`)):e("whatsNew.items",{returnObjects:!0}).map((l,d)=>i.jsx(Ft,{children:i.jsx(Wt,{i18nKey:l,components:wNe})},`${l}-${d}`)))},[t==null?void 0:t.highlights,e,s]);return i.jsxs(T,{gap:4,flexDir:"column",children:[i.jsx(ai,{fontSize:"sm",children:o}),i.jsxs(T,{flexDir:"column",gap:1,children:[i.jsx(ii,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.readReleaseNotes"),href:n?`https://github.com/invoke-ai/InvokeAI/releases/tag/v${t==null?void 0:t.version}`:"https://support.invoke.ai/support/solutions/articles/151000178246"}),i.jsx(ii,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.watchRecentReleaseVideos"),href:"https://www.youtube.com/@invokeai/videos"})]})]})},kNe=he(Ri,e=>e.isLocal),jNe=()=>{const{t:e}=M(),t=re(OD),n=G(),s=A(l=>l.ui.shouldShowNotificationV2),o=c.useCallback(()=>{n(yce(!1))},[n]),{data:r}=cy(),a=A(kNe);return!r||!t?null:i.jsxs(es,{onClose:o,placement:"top-start",autoFocus:!1,defaultIsOpen:s,children:[i.jsx(ds,{children:i.jsx(T,{pos:"relative",children:i.jsx(le,{"aria-label":"Notifications",variant:"link",icon:i.jsx(efe,{fontSize:20}),boxSize:8})})}),i.jsxs(ts,{p:2,children:[i.jsx(po,{}),i.jsx(uP,{}),i.jsx(bce,{fontSize:"md",fontWeight:"semibold",pt:5,children:i.jsxs(T,{alignItems:"center",gap:3,children:[i.jsx(Zt,{src:vNe,boxSize:6}),e("whatsNew.whatsNewInInvoke"),!!r.version.length&&(a?i.jsx(W,{variant:"subtext",children:`v${r.version}`}):i.jsx(W,{variant:"subtext",children:r.version}))]})}),i.jsx(us,{p:2,maxW:300,children:i.jsx(SNe,{})})]})]})},xd=c.memo(c.forwardRef(({tab:e,icon:t,label:n},s)=>{const o=G(),r=A(On),a=c.useCallback(()=>{o(Yt(e))},[o,e]);return i.jsx(Oe,{label:n,placement:"end",children:i.jsx(le,{ref:s,p:0,onClick:a,icon:t,size:"md",fontSize:"24px",variant:"appTab","data-selected":r===e,"aria-label":n,"data-testid":n})})}));xd.displayName="TabButton";const TX=c.memo(()=>{const{t:e}=M(),t=re(vce);return i.jsxs(T,{flexDir:"column",alignItems:"center",py:2,gap:4,minW:0,children:[i.jsx(QOe,{}),i.jsxs(T,{gap:4,pt:6,h:"full",flexDir:"column",children:[i.jsx(gd,{tab:"canvas",children:i.jsx(xd,{tab:"canvas",icon:i.jsx(pl,{}),label:e("ui.tabs.canvas")})}),i.jsx(gd,{tab:"upscaling",children:i.jsx(xd,{tab:"upscaling",icon:i.jsx(Sm,{}),label:e("ui.tabs.upscaling")})}),i.jsx(gd,{tab:"workflows",children:i.jsx(xd,{tab:"workflows",icon:i.jsx(_y,{}),label:e("ui.tabs.workflows")})}),i.jsx(gd,{tab:"models",children:i.jsx(xd,{tab:"models",icon:i.jsx(k7,{}),label:e("ui.tabs.models")})}),i.jsx(gd,{tab:"queue",children:i.jsx(xd,{tab:"queue",icon:i.jsx(O7,{}),label:e("ui.tabs.queue")})})]}),i.jsx(Je,{}),i.jsx(bNe,{}),i.jsx(jNe,{}),i.jsx(IX,{}),t||i.jsx(xNe,{})]})});TX.displayName="VerticalNavBar";const U3=0,AX=-10,MX=10,_Ne=-10,INe=10,q3=1,K3=1,TNe=[AX,0,MX],ANe=()=>{const e=A(Cce),t=G(),{t:n}=M(),s=c.useCallback(o=>{t(wce(o))},[t]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"creativity",children:i.jsx(J,{children:n("upscaling.creativity")})}),i.jsx(Ze,{value:e,defaultValue:U3,min:AX,max:MX,step:q3,fineStep:K3,onChange:s,marks:TNe}),i.jsx(_e,{value:e,defaultValue:U3,min:_Ne,max:INe,step:q3,fineStep:K3,onChange:s})]})},MNe=c.memo(ANe),ENe=()=>{const{t:e}=M(),[t,{isLoading:n}]=Mm(),s=A(ND),o=G(),r=c.useMemo(()=>{var f;if(!(!t.length||!s))return(f=t.find(m=>m.key===(s==null?void 0:s.key)))==null?void 0:f.description},[t,s]),a=c.useCallback(f=>{o(Sce(f))},[o]),{options:l,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=yl({modelConfigs:t,onChange:a,selectedModel:s,isLoading:n});return i.jsxs(Q,{orientation:"vertical",children:[i.jsx($e,{feature:"upscaleModel",children:i.jsx(J,{children:e("upscaling.upscaleModel")})}),i.jsx(T,{w:"full",alignItems:"center",gap:2,children:i.jsx(Oe,{label:r,children:i.jsx(Ce,{w:"full",children:i.jsx(Ke,{value:d,placeholder:h,options:l,onChange:u,noOptionsMessage:p,isDisabled:l.length===0})})})})]})},PNe=c.memo(ENe),Z3=0,EX=-10,PX=10,LNe=-10,DNe=10,Y3=1,X3=1,RNe=[EX,0,PX],ONe=()=>{const e=A(kce),t=G(),{t:n}=M(),s=c.useCallback(o=>{t(jce(o))},[t]);return i.jsxs(Q,{children:[i.jsx($e,{feature:"structure",children:i.jsx(J,{children:n("upscaling.structure")})}),i.jsx(Ze,{value:e,defaultValue:Z3,min:EX,max:PX,step:Y3,fineStep:X3,onChange:s,marks:RNe}),i.jsx(_e,{value:e,defaultValue:Z3,min:LNe,max:DNe,step:Y3,fineStep:X3,onChange:s})]})},NNe=c.memo(ONe),FNe=[2,4,8],Q3=e=>`${e}x`,LX=c.memo(()=>{const e=G(),{t}=M(),n=A(_ce),s=c.useCallback(o=>{e(Ice(o))},[e]);return i.jsxs(Q,{orientation:"vertical",gap:0,children:[i.jsx($e,{feature:"scale",children:i.jsx(J,{m:0,children:t("upscaling.scale")})}),i.jsxs(T,{w:"full",gap:4,children:[i.jsx(Ze,{min:2,max:8,value:n,onChange:s,marks:FNe,formatValue:Q3,defaultValue:4}),i.jsx(_e,{maxW:20,value:n,onChange:s,defaultValue:4,min:2,max:16,format:Q3})]})]})});LX.displayName="UpscaleScaleSlider";const BNe=()=>{const e=G(),t=A(FD),n=c.useMemo(()=>ww.getData(),[]),s=c.useCallback(()=>{e(X0(null))},[e]),o=c.useCallback(r=>{e(X0(r))},[e]);return i.jsx(T,{justifyContent:"flex-start",children:i.jsxs(T,{position:"relative",w:36,h:36,alignItems:"center",justifyContent:"center",children:[!t&&i.jsx(iI,{w:"full",h:"full",isError:!t,onUpload:o,fontSize:36}),t&&i.jsxs(i.Fragment,{children:[i.jsx(vl,{imageDTO:t}),i.jsx(T,{position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1,children:i.jsx(oa,{onClick:s,icon:i.jsx(Zs,{size:16}),tooltip:Me("common.reset")})}),i.jsx(W,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:0,left:0,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",borderBottomStartRadius:"base",pointerEvents:"none",children:`${t.width}x${t.height}`})]}),i.jsx(Ls,{dndTarget:ww,dndTargetData:n,label:Me("gallery.drop")})]})})},$Ne=e=>fn(Gf,Ri,(t,n)=>{const{upscaleModel:s,scale:o}=t,{maxUpscaleDimension:r}=n;if(!r||!s||!e)return!1;const{width:a,height:l}=e,d=r**2;return a*o*l*o>d}),VNe=e=>{const t=c.useMemo(()=>$Ne(e),[e]);return A(t)},zNe=()=>{const{t:e}=M(),t=A(oc),n=A(ND),s=A(Tce),o=A(FD),r=G(),[a,{isLoading:l}]=yj(),d=A(wk),u=A(Ace),h=VNe(o);c.useEffect(()=>{const b=a.find(C=>C.base===(t==null?void 0:t.base)&&C.name.toLowerCase().includes("tile"));r(Mce(b||null))},[t==null?void 0:t.base,a,r]);const p=c.useMemo(()=>t&&["sd-1","sdxl"].includes(t.base),[t]),f=c.useMemo(()=>{const b=[];return p&&(t||b.push(e("upscaling.mainModelDesc")),s||b.push(e("upscaling.tileControlNetModelDesc")),n||b.push(e("upscaling.upscaleModelDesc"))),b},[p,t,s,n,e]),m=c.useMemo(()=>{const b=[];return h&&u&&b.push(e("upscaling.exceedsMaxSizeDetails",{maxUpscaleDimension:u.toLocaleString()})),b},[h,e,u]),g=c.useMemo(()=>[...f,...m],[f,m]),x=c.useCallback(()=>{r(Yt("models")),Qa.set(3)},[r]);return p&&f.length>0&&d||p&&g.length===0||l?null:i.jsxs(T,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:[!p&&i.jsx(W,{children:e("upscaling.incompatibleBaseModelDesc")}),f.length>0&&i.jsx(W,{children:i.jsx(Wt,{i18nKey:"upscaling.missingModelsWarning",components:{LinkComponent:i.jsx(de,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:x})}})}),g.length>0&&i.jsx(ai,{children:g.map(b=>i.jsx(Ft,{children:b},b))})]})},GNe=fn([Gf],e=>{const{upscaleModel:t,upscaleInitialImage:n,scale:s}=e,o=[];if(t&&o.push(t.name),n){const r=t?K0(t.base):K0(null),a=Qd(n.width*s,r),l=Qd(n.height*s,r);o.push(`${a}${l}`)}return{badges:o}}),DX=c.memo(()=>{const{t:e}=M(),{badges:t}=A(GNe),{isOpen:n,onToggle:s}=rh({id:"upscale-settings",defaultIsOpen:!0}),{isOpen:o,onToggle:r}=VI({id:"upscale-settings-advanced",defaultIsOpen:!1});return i.jsx(Iu,{label:e("upscaling.upscale"),badges:t,isOpen:n,onToggle:s,children:i.jsxs(T,{pt:4,px:4,w:"full",h:"full",flexDir:"column","data-testid":"upscale-settings-accordion",children:[i.jsxs(T,{flexDir:"column",gap:4,children:[i.jsxs(T,{gap:4,children:[i.jsx(BNe,{}),i.jsxs(T,{direction:"column",w:"full",alignItems:"center",gap:2,minW:0,children:[i.jsx(PNe,{}),i.jsx(LX,{})]})]}),i.jsx(zNe,{})]}),i.jsx(kk,{label:e("accordions.advanced.options"),isOpen:o,onToggle:r,children:i.jsxs(T,{gap:4,pb:4,flexDir:"column",children:[i.jsx(MNe,{}),i.jsx(NNe,{})]})})]})})});DX.displayName="UpscaleSettingsAccordion";const J3={height:"100%",width:"100%"},HNe=()=>{const e=re(cf);return i.jsxs(T,{w:"full",h:"full",flexDir:"column",gap:2,children:[i.jsx(DK,{}),i.jsx(T,{w:"full",h:"full",position:"relative",children:i.jsxs(Ce,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[e&&i.jsx(vs,{defer:!0,style:J3,options:rc.options,children:i.jsx(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:i.jsx(LK,{})})}),i.jsx(vs,{defer:!0,style:J3,options:rc.options,children:i.jsxs(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:[i.jsx(RI,{}),i.jsx(DX,{}),i.jsx(zI,{}),i.jsx(NI,{})]})})]})})]})},WNe=c.memo(HNe),y0={position:"relative",height:"100%",width:"100%",minWidth:0},UNe=e=>hC.set(!e),qNe=e=>Lce.set(!e),RX=c.memo(()=>{const e=c.useRef(null);t5e();const t=A(Ece),n=c.useMemo(()=>({id:"left-panel",minSizePx:f5,defaultSizePx:f5,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:UNe}),[]),s=zw(n);De({id:"toggleLeftPanel",category:"app",callback:s.toggle,options:{enabled:t},dependencies:[s.toggle,t]});const o=A(Pce),r=c.useMemo(()=>({id:"right-panel",minSizePx:m5,defaultSizePx:m5,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:qNe}),[]),a=zw(r);return De({id:"toggleRightPanel",category:"app",callback:a.toggle,options:{enabled:o},dependencies:[a.toggle,o]}),De({id:"resetPanelLayout",category:"app",callback:()=>{s.reset(),a.reset()},dependencies:[s.reset,a.reset]}),De({id:"togglePanels",category:"app",callback:()=>{s.isCollapsed||a.isCollapsed?(s.expand(),a.expand()):(s.collapse(),a.collapse())},dependencies:[s.isCollapsed,a.isCollapsed,s.expand,a.expand,s.collapse,a.collapse]}),i.jsxs(T,{id:"invoke-app-tabs",w:"full",h:"full",gap:4,p:4,overflow:"hidden",children:[i.jsx(TX,{}),i.jsxs(qm,{ref:e,id:"app-panel-group",autoSaveId:"app-panel-group",direction:"horizontal",style:y0,children:[t&&i.jsxs(i.Fragment,{children:[i.jsx(ur,{order:0,collapsible:!0,style:y0,...s.panelProps,children:i.jsxs(T,{flexDir:"column",w:"full",h:"full",gap:2,children:[i.jsx(iMe,{}),i.jsx(Ce,{position:"relative",w:"full",h:"full",children:i.jsx(NX,{})})]})}),i.jsx(H1,{id:"left-main-handle",...s.resizeHandleProps})]}),i.jsxs(ur,{id:"main-panel",order:1,minSize:20,style:y0,children:[i.jsx(FX,{}),t&&i.jsx(cMe,{togglePanel:s.toggle}),o&&i.jsx(rMe,{panelApi:a})]}),o&&i.jsxs(i.Fragment,{children:[i.jsx(H1,{id:"main-right-handle",...a.resizeHandleProps}),i.jsx(ur,{order:2,style:y0,collapsible:!0,...a.panelProps,children:i.jsx(OX,{})})]})]})]})});RX.displayName="AppContent";const OX=c.memo(()=>{const e=A(On);return e==="canvas"?i.jsx(DH,{}):e==="upscaling"||e==="workflows"?i.jsx(LH,{}):null});OX.displayName="RightPanelContent";const NX=c.memo(()=>{const e=A(On);return e==="canvas"?i.jsx(S8e,{}):e==="upscaling"?i.jsx(WNe,{}):e==="workflows"?i.jsx(J6e,{}):null});NX.displayName="LeftPanelContent";const FX=c.memo(()=>{const e=A(On);return e==="canvas"?i.jsx(lG,{}):e==="upscaling"?i.jsx(cb,{}):e==="workflows"?i.jsx(CX,{}):e==="models"?i.jsx(Z8e,{}):e==="queue"?i.jsx(fDe,{}):null});FX.displayName="MainPanelContent";const KNe=c.createContext(null),W2={didCatch:!1,error:null};class ZNe extends c.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=W2}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var n,s,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];(n=(s=this.props).onReset)===null||n===void 0||n.call(s,{args:r,reason:"imperative-api"}),this.setState(W2)}}componentDidCatch(t,n){var s,o;(s=(o=this.props).onError)===null||s===void 0||s.call(o,t,n)}componentDidUpdate(t,n){const{didCatch:s}=this.state,{resetKeys:o}=this.props;if(s&&n.error!==null&&YNe(t.resetKeys,o)){var r,a;(r=(a=this.props).onReset)===null||r===void 0||r.call(a,{next:o,prev:t.resetKeys,reason:"keys"}),this.setState(W2)}}render(){const{children:t,fallbackRender:n,FallbackComponent:s,fallback:o}=this.props,{didCatch:r,error:a}=this.state;let l=t;if(r){const d={error:a,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")l=n(d);else if(s)l=c.createElement(s,d);else if(o!==void 0)l=o;else throw a}return c.createElement(KNe.Provider,{value:{didCatch:r,error:a,resetErrorBoundary:this.resetErrorBoundary}},l)}}function YNe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.length!==t.length||e.some((n,s)=>!Object.is(n,t[s]))}function XNe(e={}){let t;if(e.repoUrl)t=e.repoUrl;else if(e.user&&e.repo)t=`https://github.com/${e.user}/${e.repo}`;else throw new Error("You need to specify either the `repoUrl` option or both the `user` and `repo` options");const n=new URL(`${t}/issues/new`),s=["body","title","labels","template","milestone","assignee","projects","type"];for(const o of s){let r=e[o];if(r!==void 0){if(o==="labels"||o==="projects"){if(!Array.isArray(r))throw new TypeError(`The \`${o}\` option should be an array`);r=r.join(",")}n.searchParams.set(o,r)}}return n.toString()}const QNe=he(Ri,e=>e.isLocal),JNe=({error:e,resetErrorBoundary:t})=>{const{t:n}=M(),s=A(QNe),o=fl(),r=c.useCallback(()=>{const l=JSON.stringify($n(e),null,2);o.writeText(`\`\`\`
${l}
\`\`\``,()=>{ge({id:"ERROR_COPIED",title:n("toast.errorCopied")})})},[o,e,n]),a=c.useMemo(()=>s?XNe({user:"invoke-ai",repo:"InvokeAI",template:"BUG_REPORT.yml",title:`[bug]: ${e.name}: ${e.message}`}):"https://support.invoke.ai/support/tickets/new",[e.message,e.name,s]);return i.jsx(T,{layerStyle:"body",w:"100dvw",h:"100dvh",alignItems:"center",justifyContent:"center",p:4,children:i.jsxs(T,{layerStyle:"first",flexDir:"column",borderRadius:"base",justifyContent:"center",gap:8,p:16,children:[i.jsxs(T,{alignItems:"center",gap:"2",children:[i.jsx(Zt,{src:wX,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"}),i.jsx(zt,{fontSize:"2xl",children:n("common.somethingWentWrong")})]}),i.jsx(T,{layerStyle:"second",px:8,py:4,gap:4,borderRadius:"base",justifyContent:"space-between",alignItems:"center",children:i.jsxs(W,{fontWeight:"semibold",color:"error.400",children:[e.name,": ",e.message]})}),i.jsxs(T,{gap:4,children:[i.jsx(de,{leftIcon:i.jsx(Zs,{}),onClick:t,children:n("accessibility.resetUI")}),i.jsx(de,{leftIcon:i.jsx(pn,{}),onClick:r,children:n("common.copyError")}),i.jsx(Wf,{href:a,isExternal:!0,children:i.jsx(de,{leftIcon:i.jsx(Sy,{}),children:n(s?"accessibility.createIssue":"accessibility.submitSupportTicket")})})]})]})})},eFe=c.memo(JNe),tFe={},nFe=({config:e=tFe,studioInitAction:t})=>{const n=re(OD),s=zN(),o=c.useCallback(()=>(s(),location.reload(),!1),[s]);return i.jsxs(ZNe,{onReset:o,FallbackComponent:eFe,children:[i.jsxs(Ce,{id:"invoke-app-wrapper",w:"100dvw",h:"100dvh",position:"relative",overflow:"hidden",children:[i.jsx(RX,{}),!n&&i.jsx(Dce,{})]}),i.jsx(X9,{config:e,studioInitAction:t}),i.jsx(VN,{})]})},FFe=c.memo(nFe);export{FFe as default};
